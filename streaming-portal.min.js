/*! For license information please see streaming-portal.min.js.LICENSE.txt */
(()=>{var t={152:(e,t)=>{"use strict";class n{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=n.toUint8Array(e),i=n.toUint8Array(t);if(r.length!==i.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==i[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let n=0;for(const e of t)n+=e.byteLength;const r=new Uint8Array(n);let i=0;for(const e of t){const t=this.toUint8Array(e);r.set(t,i),i+=t.length}return e[e.length-1]instanceof Function?this.toView(r,e[e.length-1]):r.buffer}}const r="string",i=/^[0-9a-f\s]+$/i,s=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,a=/^[a-zA-Z0-9-_]+$/;class o{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n.buffer}static toString(e){const t=n.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return decodeURIComponent(escape(r))}}class l{static toString(e,t=!1){const r=n.toArrayBuffer(e),i=new DataView(r);let s="";for(let e=0;e<r.byteLength;e+=2){const n=i.getUint16(e,t);s+=String.fromCharCode(n)}return s}static fromString(e,t=!1){const n=new ArrayBuffer(2*e.length),r=new DataView(n);for(let n=0;n<e.length;n++)r.setUint16(2*n,e.charCodeAt(n),t);return n}}class c{static isHex(e){return typeof e===r&&i.test(e)}static isBase64(e){return typeof e===r&&s.test(e)}static isBase64Url(e){return typeof e===r&&a.test(e)}static ToString(e,t="utf8"){const r=n.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return l.toString(r,!0);case"utf16":case"utf16be":return l.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return l.fromString(e,!0);case"utf16":case"utf16be":return l.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=n.toUint8Array(e);if("undefined"!=typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=c.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return o.fromString(e);case"utf16":case"utf16be":return l.fromString(e);case"utf16le":case"usc2":return l.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=c.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return o.toString(e);case"utf16":case"utf16be":return l.toString(e);case"utf16le":case"usc2":return l.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}static ToBinary(e){const t=n.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r}static ToHex(e){const t=n.toUint8Array(e);let r="";const i=t.length;for(let e=0;e<i;e++){const n=t[e];n<16&&(r+="0"),r+=n.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const r=t.slice(e,e+2);n[e/2]=parseInt(r,16)}return n.buffer}static ToUtf16String(e,t=!1){return l.toString(e,t)}static FromUtf16String(e,t=!1){return l.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}c.DEFAULT_UTF8_ENCODING="utf8",t._H=n,t.U$=c},616:e=>{var t;self,t=()=>(()=>{"use strict";var e,t={};return e=t,Object.defineProperty(e,"__esModule",{value:!0}),e.FitAddon=void 0,e.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const n=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),i=parseInt(r.getPropertyValue("height")),s=Math.max(0,parseInt(r.getPropertyValue("width"))),a=window.getComputedStyle(this._terminal.element),o=i-(parseInt(a.getPropertyValue("padding-top"))+parseInt(a.getPropertyValue("padding-bottom"))),l=s-(parseInt(a.getPropertyValue("padding-right"))+parseInt(a.getPropertyValue("padding-left")))-n;return{cols:Math.max(2,Math.floor(l/t.css.cell.width)),rows:Math.max(1,Math.floor(o/t.css.cell.height))}}},t})(),e.exports=t()},856:e=>{var t;globalThis,t=()=>(()=>{"use strict";var e={4567:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const s=n(9042),a=n(9924),o=n(844),l=n(4725),c=n(2585),u=n(3656);let h=t.AccessibilityManager=class extends o.Disposable{constructor(e,t,n,r){super(),this._terminal=e,this._coreBrowserService=n,this._renderService=r,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let e=0;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);if(this._topBoundaryFocusListener=e=>this._handleBoundaryFocus(e,0),this._bottomBoundaryFocusListener=e=>this._handleBoundaryFocus(e,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new a.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(e=>this._handleResize(e.rows))),this.register(this._terminal.onRender(e=>this._refreshRows(e.start,e.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(e=>this._handleChar(e))),this.register(this._terminal.onLineFeed(()=>this._handleChar("\n"))),this.register(this._terminal.onA11yTab(e=>this._handleTab(e))),this.register(this._terminal.onKey(e=>this._handleKey(e.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,u.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,o.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,"\n"===e&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=s.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){const n=this._terminal.buffer,r=n.lines.length.toString();for(let i=e;i<=t;i++){const e=n.lines.get(n.ydisp+i),t=[],s=e?.translateToString(!0,void 0,void 0,t)||"",a=(n.ydisp+i+1).toString(),o=this._rowElements[i];o&&(0===s.length?(o.innerText=" ",this._rowColumns.set(o,[0,1])):(o.textContent=s,this._rowColumns.set(o,t)),o.setAttribute("aria-posinset",a),o.setAttribute("aria-setsize",r))}this._announceCharacters()}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){const n=e.target,r=this._rowElements[0===t?1:this._rowElements.length-2];if(n.getAttribute("aria-posinset")===(0===t?"1":`${this._terminal.buffer.lines.length}`))return;if(e.relatedTarget!==r)return;let i,s;if(0===t?(i=n,s=this._rowElements.pop(),this._rowContainer.removeChild(s)):(i=this._rowElements.shift(),s=n,this._rowContainer.removeChild(i)),i.removeEventListener("focus",this._topBoundaryFocusListener),s.removeEventListener("focus",this._bottomBoundaryFocusListener),0===t){const e=this._createAccessibilityTreeNode();this._rowElements.unshift(e),this._rowContainer.insertAdjacentElement("afterbegin",e)}else{const e=this._createAccessibilityTreeNode();this._rowElements.push(e),this._rowContainer.appendChild(e)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===t?-1:1),this._rowElements[0===t?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){if(0===this._rowElements.length)return;const e=document.getSelection();if(!e)return;if(e.isCollapsed)return void(this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection());if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let t={node:e.anchorNode,offset:e.anchorOffset},n={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(n.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===n.node&&t.offset>n.offset)&&([t,n]=[n,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;const r=this._rowElements.slice(-1)[0];if(n.node.compareDocumentPosition(r)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(n={node:r,offset:r.textContent?.length??0}),!this._rowContainer.contains(n.node))return;const i=({node:e,offset:t})=>{const n=e instanceof Text?e.parentNode:e;let r=parseInt(n?.getAttribute("aria-posinset"),10)-1;if(isNaN(r))return console.warn("row is invalid. Race condition?"),null;const i=this._rowColumns.get(n);if(!i)return console.warn("columns is null. Race condition?"),null;let s=t<i.length?i[t]:i.slice(-1)[0]+1;return s>=this._terminal.cols&&(++r,s=0),{row:r,column:s}},s=i(t),a=i(n);if(s&&a){if(s.row>a.row||s.row===a.row&&s.column>=a.column)throw new Error("invalid range");this._terminal.select(s.column,s.row,(a.row-s.row)*this._terminal.cols-s.column+a.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let e=this._rowContainer.children.length;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};t.AccessibilityManager=h=r([i(1,c.IInstantiationService),i(2,l.ICoreBrowserService),i(3,l.IRenderService)],h)},3614:(e,t)=>{function n(e){return e.replace(/\r?\n/g,"\r")}function r(e,t){return t?"[200~"+e+"[201~":e}function i(e,t,i,s){e=r(e=n(e),i.decPrivateModes.bracketedPasteMode&&!0!==s.rawOptions.ignoreBracketedPasteMode),i.triggerDataEvent(e,!0),t.value=""}function s(e,t,n){const r=n.getBoundingClientRect(),i=e.clientX-r.left-10,s=e.clientY-r.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${i}px`,t.style.top=`${s}px`,t.style.zIndex="1000",t.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=n,t.bracketTextForPaste=r,t.copyHandler=function(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()},t.handlePasteEvent=function(e,t,n,r){e.stopPropagation(),e.clipboardData&&i(e.clipboardData.getData("text/plain"),t,n,r)},t.paste=i,t.moveTextAreaUnderMouseCursor=s,t.rightClickHandler=function(e,t,n,r,i){s(e,t,n),i&&r.rightClickSelect(e),t.value=r.selectionText,t.select()}},7239:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const r=n(1505);t.ColorContrastCache=class{constructor(){this._color=new r.TwoKeyMap,this._css=new r.TwoKeyMap}setCss(e,t,n){this._css.set(e,t,n)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,n){this._color.set(e,t,n)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}}},3656:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(e,t,n,r){e.addEventListener(t,n,r);let i=!1;return{dispose:()=>{i||(i=!0,e.removeEventListener(t,n,r))}}}},3551:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier=void 0;const s=n(3656),a=n(8460),o=n(844),l=n(2585),c=n(4725);let u=t.Linkifier=class extends o.Disposable{get currentLink(){return this._currentLink}constructor(e,t,n,r,i){super(),this._element=e,this._mouseService=t,this._renderService=n,this._bufferService=r,this._linkProviderService=i,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new a.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new a.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,o.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,o.toDisposable)(()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,s.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,s.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,s.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,s.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){this._lastMouseEvent=e;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;const n=e.composedPath();for(let e=0;e<n.length;e++){const t=n[e];if(t.classList.contains("xterm"))break;if(t.classList.contains("xterm-hover"))return}this._lastBufferCell&&t.x===this._lastBufferCell.x&&t.y===this._lastBufferCell.y||(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){this._activeProviderReplies&&t||(this._activeProviderReplies?.forEach(e=>{e?.forEach(e=>{e.link.dispose&&e.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let n=!1;for(const[r,i]of this._linkProviderService.linkProviders.entries())if(t){const t=this._activeProviderReplies?.get(r);t&&(n=this._checkLinkProviderResult(r,e,n))}else i.provideLinks(e.y,t=>{if(this._isMouseOut)return;const i=t?.map(e=>({link:e}));this._activeProviderReplies?.set(r,i),n=this._checkLinkProviderResult(r,e,n),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){const n=new Set;for(let r=0;r<t.size;r++){const i=t.get(r);if(i)for(let t=0;t<i.length;t++){const r=i[t],s=r.link.range.start.y<e?0:r.link.range.start.x,a=r.link.range.end.y>e?this._bufferService.cols:r.link.range.end.x;for(let e=s;e<=a;e++){if(n.has(e)){i.splice(t--,1);break}n.add(e)}}}}_checkLinkProviderResult(e,t,n){if(!this._activeProviderReplies)return n;const r=this._activeProviderReplies.get(e);let i=!1;for(let t=0;t<e;t++)this._activeProviderReplies.has(t)&&!this._activeProviderReplies.get(t)||(i=!0);if(!i&&r){const e=r.find(e=>this._linkAtPosition(e.link,t));e&&(n=!0,this._handleNewLink(e))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!n)for(let e=0;e<this._activeProviderReplies.size;e++){const r=this._activeProviderReplies.get(e)?.find(e=>this._linkAtPosition(e.link,t));if(r){n=!0,this._handleNewLink(r);break}}return n}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){this._currentLink&&this._lastMouseEvent&&(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,o.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._lastMouseEvent)return;const t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:void 0===e.link.decorations||e.link.decorations.underline,pointerCursor:void 0===e.link.decorations||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:e=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==e&&(this._currentLink.state.decorations.pointerCursor=e,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",e))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:t=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(e=>{if(!this._currentLink)return;const t=0===e.start?0:e.start+1+this._bufferService.buffer.ydisp,n=this._bufferService.buffer.ydisp+1+e.end;if(this._currentLink.link.range.start.y>=t&&this._currentLink.link.range.end.y<=n&&(this._clearCurrentLink(t,n),this._lastMouseEvent)){const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._askForLink(e,!1)}})))}_linkHover(e,t,n){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(n,t.text)}_fireUnderlineEvent(e,t){const n=e.range,r=this._bufferService.buffer.ydisp,i=this._createLinkUnderlineEvent(n.start.x-1,n.start.y-r-1,n.end.x,n.end.y-r-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(i)}_linkLeave(e,t,n){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(n,t.text)}_linkAtPosition(e,t){const n=e.range.start.y*this._bufferService.cols+e.range.start.x,r=e.range.end.y*this._bufferService.cols+e.range.end.x,i=t.y*this._bufferService.cols+t.x;return n<=i&&i<=r}_positionFromMouseEvent(e,t,n){const r=n.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(r)return{x:r[0],y:r[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,n,r,i){return{x1:e,y1:t,x2:n,y2:r,cols:this._bufferService.cols,fg:i}}};t.Linkifier=u=r([i(1,c.IMouseService),i(2,c.IRenderService),i(3,l.IBufferService),i(4,c.ILinkProviderService)],u)},9042:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const s=n(511),a=n(2585);let o=t.OscLinkProvider=class{constructor(e,t,n){this._bufferService=e,this._optionsService=t,this._oscLinkService=n}provideLinks(e,t){const n=this._bufferService.buffer.lines.get(e-1);if(!n)return void t(void 0);const r=[],i=this._optionsService.rawOptions.linkHandler,a=new s.CellData,o=n.getTrimmedLength();let c=-1,u=-1,h=!1;for(let t=0;t<o;t++)if(-1!==u||n.hasContent(t)){if(n.loadCell(t,a),a.hasExtendedAttrs()&&a.extended.urlId){if(-1===u){u=t,c=a.extended.urlId;continue}h=a.extended.urlId!==c}else-1!==u&&(h=!0);if(h||-1!==u&&t===o-1){const n=this._oscLinkService.getLinkData(c)?.uri;if(n){const s={start:{x:u+1,y:e},end:{x:t+(h||t!==o-1?0:1),y:e}};let a=!1;if(!i?.allowNonHttpProtocols)try{const e=new URL(n);["http:","https:"].includes(e.protocol)||(a=!0)}catch(e){a=!0}a||r.push({text:n,range:s,activate:(e,t)=>i?i.activate(e,t,s):l(0,t),hover:(e,t)=>i?.hover?.(e,t,s),leave:(e,t)=>i?.leave?.(e,t,s)})}h=!1,a.hasExtendedAttrs()&&a.extended.urlId?(u=t,c=a.extended.urlId):(u=-1,c=-1)}}t(r)}};function l(e,t){if(confirm(`Do you want to navigate to ${t}?\n\nWARNING: This link could potentially be dangerous`)){const e=window.open();if(e){try{e.opener=null}catch{}e.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}t.OscLinkProvider=o=r([i(0,a.IBufferService),i(1,a.IOptionsService),i(2,a.IOscLinkService)],o)},6193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,n){this._rowCount=n,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}}},3236:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const r=n(3614),i=n(3656),s=n(3551),a=n(9042),o=n(3730),l=n(1680),c=n(3107),u=n(5744),h=n(2950),d=n(1296),f=n(428),p=n(4269),m=n(5114),g=n(8934),v=n(3230),_=n(9312),b=n(4725),y=n(6731),w=n(8055),S=n(8969),x=n(8460),E=n(844),C=n(6114),A=n(8437),M=n(2584),k=n(7399),T=n(5941),R=n(9074),P=n(2585),I=n(5435),D=n(4567),O=n(779);class L extends S.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(e={}){super(e),this.browser=C,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new E.MutableDisposable),this._onCursorMove=this.register(new x.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new x.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new x.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new x.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new x.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new x.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new x.EventEmitter),this._onBlur=this.register(new x.EventEmitter),this._onA11yCharEmitter=this.register(new x.EventEmitter),this._onA11yTabEmitter=this.register(new x.EventEmitter),this._onWillOpen=this.register(new x.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(R.DecorationService),this._instantiationService.setService(P.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(O.LinkProviderService),this._instantiationService.setService(b.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(o.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((e,t)=>this.refresh(e,t))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(e=>this._reportWindowsOptions(e))),this.register(this._inputHandler.onColor(e=>this._handleColorEvent(e))),this.register((0,x.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,x.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,x.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,x.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(e=>this._afterResize(e.cols,e.rows))),this.register((0,E.toDisposable)(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}_handleColorEvent(e){if(this._themeService)for(const t of e){let e,n="";switch(t.index){case 256:e="foreground",n="10";break;case 257:e="background",n="11";break;case 258:e="cursor",n="12";break;default:e="ansi",n="4;"+t.index}switch(t.type){case 0:const r=w.color.toColorRGB("ansi"===e?this._themeService.colors.ansi[t.index]:this._themeService.colors[e]);this.coreService.triggerDataEvent(`${M.C0.ESC}]${n};${(0,T.toRgbString)(r)}${M.C1_ESCAPED.ST}`);break;case 1:if("ansi"===e)this._themeService.modifyColors(e=>e.ansi[t.index]=w.channels.toColor(...t.color));else{const n=e;this._themeService.modifyColors(e=>e[n]=w.channels.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(D.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(M.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(M.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;const n=Math.min(this.buffer.x,this.cols-1),r=this._renderService.dimensions.css.cell.height,i=t.getWidth(n),s=this._renderService.dimensions.css.cell.width*i,a=this.buffer.y*this._renderService.dimensions.css.cell.height,o=n*this._renderService.dimensions.css.cell.width;this.textarea.style.left=o+"px",this.textarea.style.top=a+"px",this.textarea.style.width=s+"px",this.textarea.style.height=r+"px",this.textarea.style.lineHeight=r+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,i.addDisposableDomListener)(this.element,"copy",e=>{this.hasSelection()&&(0,r.copyHandler)(e,this._selectionService)}));const e=e=>(0,r.handlePasteEvent)(e,this.textarea,this.coreService,this.optionsService);this.register((0,i.addDisposableDomListener)(this.textarea,"paste",e)),this.register((0,i.addDisposableDomListener)(this.element,"paste",e)),C.isFirefox?this.register((0,i.addDisposableDomListener)(this.element,"mousedown",e=>{2===e.button&&(0,r.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,i.addDisposableDomListener)(this.element,"contextmenu",e=>{(0,r.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),C.isLinux&&this.register((0,i.addDisposableDomListener)(this.element,"auxclick",e=>{1===e.button&&(0,r.moveTextAreaUnderMouseCursor)(e,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,i.addDisposableDomListener)(this.textarea,"keyup",e=>this._keyUp(e),!0)),this.register((0,i.addDisposableDomListener)(this.textarea,"keydown",e=>this._keyDown(e),!0)),this.register((0,i.addDisposableDomListener)(this.textarea,"keypress",e=>this._keyPress(e),!0)),this.register((0,i.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,i.addDisposableDomListener)(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this.register((0,i.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,i.addDisposableDomListener)(this.textarea,"input",e=>this._inputEvent(e),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);const t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,i.addDisposableDomListener)(this.screenElement,"mousemove",e=>this.updateCursorStyle(e))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",a.promptLabel),C.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(m.CoreBrowserService,this.textarea,e.ownerDocument.defaultView??window,this._document??"undefined"!=typeof window?window.document:null)),this._instantiationService.setService(b.ICoreBrowserService,this._coreBrowserService),this.register((0,i.addDisposableDomListener)(this.textarea,"focus",e=>this._handleTextAreaFocus(e))),this.register((0,i.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(f.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(b.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(y.ThemeService),this._instantiationService.setService(b.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(p.CharacterJoinerService),this._instantiationService.setService(b.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(v.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(b.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(e=>this._onRender.fire(e))),this.onResize(e=>this._renderService.resize(e.cols,e.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(h.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(g.MouseService),this._instantiationService.setService(b.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(s.Linkifier,this.screenElement)),this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(l.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(e=>this.scrollLines(e.amount,e.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(_.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(b.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(e=>this.scrollLines(e.amount,e.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(e=>this._renderService.handleSelectionChanged(e.start,e.end,e.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(e=>{this.textarea.value=e,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(e=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,i.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(c.BufferDecorationRenderer,this.screenElement)),this.register((0,i.addDisposableDomListener)(this.element,"mousedown",e=>this._selectionService.handleMouseDown(e))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(D.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",e=>this._handleScreenReaderModeOptionChange(e))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(u.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",e=>{!this._overviewRulerRenderer&&e&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(u.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(d.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const e=this,t=this.element;function n(t){const n=e._mouseService.getMouseReportCoords(t,e.screenElement);if(!n)return!1;let r,i;switch(t.overrideType||t.type){case"mousemove":i=32,void 0===t.buttons?(r=3,void 0!==t.button&&(r=t.button<3?t.button:3)):r=1&t.buttons?0:4&t.buttons?1:2&t.buttons?2:3;break;case"mouseup":i=0,r=t.button<3?t.button:3;break;case"mousedown":i=1,r=t.button<3?t.button:3;break;case"wheel":if(e._customWheelEventHandler&&!1===e._customWheelEventHandler(t))return!1;if(0===e.viewport.getLinesScrolled(t))return!1;i=t.deltaY<0?0:1,r=4;break;default:return!1}return!(void 0===i||void 0===r||r>4)&&e.coreMouseService.triggerMouseEvent({col:n.col,row:n.row,x:n.x,y:n.y,button:r,action:i,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey})}const r={mouseup:null,wheel:null,mousedrag:null,mousemove:null},s={mouseup:e=>(n(e),e.buttons||(this._document.removeEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.removeEventListener("mousemove",r.mousedrag)),this.cancel(e)),wheel:e=>(n(e),this.cancel(e,!0)),mousedrag:e=>{e.buttons&&n(e)},mousemove:e=>{e.buttons||n(e)}};this.register(this.coreMouseService.onProtocolChange(e=>{e?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(e)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&e?r.mousemove||(t.addEventListener("mousemove",s.mousemove),r.mousemove=s.mousemove):(t.removeEventListener("mousemove",r.mousemove),r.mousemove=null),16&e?r.wheel||(t.addEventListener("wheel",s.wheel,{passive:!1}),r.wheel=s.wheel):(t.removeEventListener("wheel",r.wheel),r.wheel=null),2&e?r.mouseup||(r.mouseup=s.mouseup):(this._document.removeEventListener("mouseup",r.mouseup),r.mouseup=null),4&e?r.mousedrag||(r.mousedrag=s.mousedrag):(this._document.removeEventListener("mousemove",r.mousedrag),r.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,i.addDisposableDomListener)(t,"mousedown",e=>{if(e.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(e))return n(e),r.mouseup&&this._document.addEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.addEventListener("mousemove",r.mousedrag),this.cancel(e)})),this.register((0,i.addDisposableDomListener)(t,"wheel",e=>{if(!r.wheel){if(this._customWheelEventHandler&&!1===this._customWheelEventHandler(e))return!1;if(!this.buffer.hasScrollback){const t=this.viewport.getLinesScrolled(e);if(0===t)return;const n=M.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(e.deltaY<0?"A":"B");let r="";for(let e=0;e<Math.abs(t);e++)r+=n;return this.coreService.triggerDataEvent(r,!0),this.cancel(e,!0)}return this.viewport.handleWheel(e)?this.cancel(e):void 0}},{passive:!1})),this.register((0,i.addDisposableDomListener)(t,"touchstart",e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(e),this.cancel(e)},{passive:!0})),this.register((0,i.addDisposableDomListener)(t,"touchmove",e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(e)?void 0:this.cancel(e)},{passive:!1}))}refresh(e,t){this._renderService?.refreshRows(e,t)}updateCursorStyle(e){this._selectionService?.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t,n=0){1===n?(super.scrollLines(e,t,n),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(e)}paste(e){(0,r.paste)(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(e,t,n){this._selectionService.setSelection(e,t,n)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(e,t){this._selectionService?.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;const t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;t||"Dead"!==e.key&&"AltGraph"!==e.key||(this._unprocessedDeadKey=!0);const n=(0,k.evaluateKeyboardEvent)(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),3===n.type||2===n.type){const t=this.rows-1;return this.scrollLines(2===n.type?-t:t),this.cancel(e,!0)}return 1===n.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,e)||(n.cancel&&this.cancel(e,!0),!n.key||!!(e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&1===e.key.length&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(n.key!==M.C0.ETX&&n.key!==M.C0.CR||(this.textarea.value=""),this._onKey.fire({key:n.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(n.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey?this.cancel(e,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(e,t){const n=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return"keypress"===t.type?n:n&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e)||(function(e){return 16===e.keyCode||17===e.keyCode||18===e.keyCode}(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(null===e.which||void 0===e.which)t=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;t=e.which}return!(!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)||(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(e){if(e.data&&"insertText"===e.inputType&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){e!==this.cols||t!==this.rows?super.resize(e,t):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(e,t){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(A.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const e=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(M.C0.ESC+"[I"):this.coreService.triggerDataEvent(M.C0.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const e=this._renderService.dimensions.css.canvas.width.toFixed(0),t=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${M.C0.ESC}[4;${t};${e}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const n=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${M.C0.ESC}[6;${r};${n}t`)}}cancel(e,t){if(this.options.cancelEvents||t)return e.preventDefault(),e.stopPropagation(),!1}}t.Terminal=L},9924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(e,t=1e3){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,n){this._rowCount=n,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t;const r=Date.now();if(r-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=r,this._innerRefresh();else if(!this._additionalRefreshRequested){const e=r-this._lastRefreshMs,t=this._debounceThresholdMS-e;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},t)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}}},1680:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const s=n(3656),a=n(4725),o=n(8460),l=n(844),c=n(2585);let u=t.Viewport=class extends l.Disposable{constructor(e,t,n,r,i,a,l,c){super(),this._viewportElement=e,this._scrollArea=t,this._bufferService=n,this._optionsService=r,this._charSizeService=i,this._renderService=a,this._coreBrowserService=l,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new o.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,s.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(e=>this._activeBuffer=e.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(e=>this._renderDimensions=e)),this._handleThemeChange(c.colors),this.register(c.onChangeColors(e=>this._handleThemeChange(e))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(e){this._viewportElement.style.backgroundColor=e.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(e){if(e)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null}syncScrollArea(e=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(e);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(e)}_handleScroll(e){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const e=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(e*(this._smoothScrollState.target-this._smoothScrollState.origin)),e<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(e,t){const n=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&0!==this._viewportElement.scrollTop||t>0&&n<this._lastRecordedBufferHeight)||(e.cancelable&&e.preventDefault(),!1)}handleWheel(e){const t=this._getPixelsScrolled(e);return 0!==t&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}scrollLines(e){if(0!==e)if(this._optionsService.rawOptions.smoothScrollDuration){const t=e*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!1})}_getPixelsScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(e,t){let n,r="";const i=[],s=t??this._bufferService.buffer.lines.length,a=this._bufferService.buffer.lines;for(let t=e;t<s;t++){const e=a.get(t);if(!e)continue;const s=a.get(t+1)?.isWrapped;if(r+=e.translateToString(!s),!s||t===a.length-1){const e=document.createElement("div");e.textContent=r,i.push(e),r.length>0&&(n=e),r=""}}return{bufferElements:i,cursorElement:n}}getLinesScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(e,t){const n=this._optionsService.rawOptions.fastScrollModifier;return"alt"===n&&t.altKey||"ctrl"===n&&t.ctrlKey||"shift"===n&&t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(e){this._lastTouchY=e.touches[0].pageY}handleTouchMove(e){const t=this._lastTouchY-e.touches[0].pageY;return this._lastTouchY=e.touches[0].pageY,0!==t&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}};t.Viewport=u=r([i(2,c.IBufferService),i(3,c.IOptionsService),i(4,a.ICharSizeService),i(5,a.IRenderService),i(6,a.ICoreBrowserService),i(7,a.IThemeService)],u)},3107:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const s=n(4725),a=n(844),o=n(2585);let l=t.BufferDecorationRenderer=class extends a.Disposable{constructor(e,t,n,r,i){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=n,this._decorationService=r,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(e=>this._removeDecoration(e))),this.register((0,a.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){const t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer","top"===e?.options?.layer),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",t.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const n=e.options.x??0;return n&&n>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){const t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let n=this._decorationElements.get(e);n||(n=this._createElement(e),e.element=n,this._decorationElements.set(e,n),this._container.appendChild(n),e.onDispose(()=>{this._decorationElements.delete(e),n.remove()})),n.style.top=t*this._renderService.dimensions.css.cell.height+"px",n.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(n)}}_refreshXPosition(e,t=e.element){if(!t)return;const n=e.options.x??0;"right"===(e.options.anchor||"left")?t.style.right=n?n*this._renderService.dimensions.css.cell.width+"px":"":t.style.left=n?n*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){this._decorationElements.get(e)?.remove(),this._decorationElements.delete(e),e.dispose()}};t.BufferDecorationRenderer=l=r([i(1,o.IBufferService),i(2,s.ICoreBrowserService),i(3,o.IDecorationService),i(4,s.IRenderService)],l)},5871:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(const t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position))return void this._addLineToZone(t,e.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,n){return t>=e.startBufferLine-this._linePadding[n||"full"]&&t<=e.endBufferLine+this._linePadding[n||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}}},5744:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const s=n(5871),a=n(4725),o=n(844),l=n(2585),c={full:0,left:0,center:0,right:0},u={full:0,left:0,center:0,right:0},h={full:0,left:0,center:0,right:0};let d=t.OverviewRulerRenderer=class extends o.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(e,t,n,r,i,a,l){super(),this._viewportElement=e,this._screenElement=t,this._bufferService=n,this._decorationService=r,this._renderService=i,this._optionsService=a,this._coreBrowserService=l,this._colorZoneStore=new s.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const c=this._canvas.getContext("2d");if(!c)throw new Error("Ctx cannot be null");this._ctx=c,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,o.toDisposable)(()=>{this._canvas?.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const e=Math.floor(this._canvas.width/3),t=Math.ceil(this._canvas.width/3);u.full=this._canvas.width,u.left=e,u.center=t,u.right=e,this._refreshDrawHeightConstants(),h.full=0,h.left=0,h.center=u.left,h.right=u.left+u.center}_refreshDrawHeightConstants(){c.full=Math.round(2*this._coreBrowserService.dpr);const e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);c.left=t,c.center=t,c.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const e of this._decorationService.decorations)this._colorZoneStore.addDecoration(e);this._ctx.lineWidth=1;const e=this._colorZoneStore.zones;for(const t of e)"full"!==t.position&&this._renderColorZone(t);for(const t of e)"full"===t.position&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(h[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-c[e.position||"full"]/2),u[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+c[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};t.OverviewRulerRenderer=d=r([i(2,l.IBufferService),i(3,l.IDecorationService),i(4,a.IRenderService),i(5,l.IOptionsService),i(6,a.ICoreBrowserService)],d)},2950:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const s=n(4725),a=n(2585),o=n(2584);let l=t.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(e,t,n,r,i,s){this._textarea=e,this._compositionView=t,this._bufferService=n,this._optionsService=r,this._coreService=i,this._renderService=s,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(229===e.keyCode)return!1;if(16===e.keyCode||17===e.keyCode||18===e.keyCode)return!1;this._finalizeComposition(!1)}return 229!==e.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let t;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,t=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),t.length>0&&this._coreService.triggerDataEvent(t,!0)}},0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const t=this._textarea.value,n=t.replace(e,"");this._dataAlreadySent=n,t.length>e.length?this._coreService.triggerDataEvent(n,!0):t.length<e.length?this._coreService.triggerDataEvent(`${o.C0.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),t=this._renderService.dimensions.css.cell.height,n=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=n+"px",this._compositionView.style.height=t+"px",this._compositionView.style.lineHeight=t+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const i=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=n+"px",this._textarea.style.width=Math.max(i.width,1)+"px",this._textarea.style.height=Math.max(i.height,1)+"px",this._textarea.style.lineHeight=i.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};t.CompositionHelper=l=r([i(2,a.IBufferService),i(3,a.IOptionsService),i(4,a.ICoreService),i(5,s.IRenderService)],l)},9806:(e,t)=>{function n(e,t,n){const r=n.getBoundingClientRect(),i=e.getComputedStyle(n),s=parseInt(i.getPropertyValue("padding-left")),a=parseInt(i.getPropertyValue("padding-top"));return[t.clientX-r.left-s,t.clientY-r.top-a]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=n,t.getCoords=function(e,t,r,i,s,a,o,l,c){if(!a)return;const u=n(e,t,r);return u?(u[0]=Math.ceil((u[0]+(c?o/2:0))/o),u[1]=Math.ceil(u[1]/l),u[0]=Math.min(Math.max(u[0],1),i+(c?1:0)),u[1]=Math.min(Math.max(u[1],1),s),u):void 0}},9504:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const r=n(2584);function i(e,t,n,r){const i=e-s(e,n),o=t-s(t,n),u=Math.abs(i-o)-function(e,t,n){let r=0;const i=e-s(e,n),o=t-s(t,n);for(let s=0;s<Math.abs(i-o);s++){const o="A"===a(e,t)?-1:1,l=n.buffer.lines.get(i+o*s);l?.isWrapped&&r++}return r}(e,t,n);return c(u,l(a(e,t),r))}function s(e,t){let n=0,r=t.buffer.lines.get(e),i=r?.isWrapped;for(;i&&e>=0&&e<t.rows;)n++,r=t.buffer.lines.get(--e),i=r?.isWrapped;return n}function a(e,t){return e>t?"A":"B"}function o(e,t,n,r,i,s){let a=e,o=t,l="";for(;a!==n||o!==r;)a+=i?1:-1,i&&a>s.cols-1?(l+=s.buffer.translateBufferLineToString(o,!1,e,a),a=0,e=0,o++):!i&&a<0&&(l+=s.buffer.translateBufferLineToString(o,!1,0,e+1),a=s.cols-1,e=a,o--);return l+s.buffer.translateBufferLineToString(o,!1,e,a)}function l(e,t){const n=t?"O":"[";return r.C0.ESC+n+e}function c(e,t){e=Math.floor(e);let n="";for(let r=0;r<e;r++)n+=t;return n}t.moveToCellSequence=function(e,t,n,r){const a=n.buffer.x,u=n.buffer.y;if(!n.buffer.hasScrollback)return function(e,t,n,r,a,u){return 0===i(t,r,a,u).length?"":c(o(e,t,e,t-s(t,a),!1,a).length,l("D",u))}(a,u,0,t,n,r)+i(u,t,n,r)+function(e,t,n,r,a,u){let h;h=i(t,r,a,u).length>0?r-s(r,a):t;const d=r,f=function(e,t,n,r,a,o){let l;return l=i(n,r,a,o).length>0?r-s(r,a):t,e<n&&l<=r||e>=n&&l<r?"C":"D"}(e,t,n,r,a,u);return c(o(e,h,n,d,"C"===f,a).length,l(f,u))}(a,u,e,t,n,r);let h;if(u===t)return h=a>e?"D":"C",c(Math.abs(a-e),l(h,r));h=u>t?"D":"C";const d=Math.abs(u-t);return c(function(e,t){return t.cols-e}(u>t?e:a,n)+(d-1)*n.cols+1+((u>t?a:e)-1),l(h,r))}},1296:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const s=n(3787),a=n(2550),o=n(2223),l=n(6171),c=n(6052),u=n(4725),h=n(8055),d=n(8460),f=n(844),p=n(2585),m="xterm-dom-renderer-owner-",g="xterm-rows",v="xterm-fg-",_="xterm-bg-",b="xterm-focus",y="xterm-selection";let w=1,S=t.DomRenderer=class extends f.Disposable{constructor(e,t,n,r,i,o,u,h,p,v,_,b,S){super(),this._terminal=e,this._document=t,this._element=n,this._screenElement=r,this._viewportElement=i,this._helperContainer=o,this._linkifier2=u,this._charSizeService=p,this._optionsService=v,this._bufferService=_,this._coreBrowserService=b,this._themeService=S,this._terminalClass=w++,this._rowElements=[],this._selectionRenderModel=(0,c.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new d.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(g),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(y),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,l.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(e=>this._injectCss(e))),this._injectCss(this._themeService.colors),this._rowFactory=h.createInstance(s.DomRendererRowFactory,document),this._element.classList.add(m+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(e=>this._handleLinkHover(e))),this.register(this._linkifier2.onHideLinkUnderline(e=>this._handleLinkLeave(e))),this.register((0,f.toDisposable)(()=>{this._element.classList.remove(m+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new a.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const e of this._rowElements)e.style.width=`${this.dimensions.css.canvas.width}px`,e.style.height=`${this.dimensions.css.cell.height}px`,e.style.lineHeight=`${this.dimensions.css.cell.height}px`,e.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const t=`${this._terminalSelector} .${g} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${g} { color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${g} .xterm-dim { color: ${h.color.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const n=`blink_underline_${this._terminalClass}`,r=`blink_bar_${this._terminalClass}`,i=`blink_block_${this._terminalClass}`;t+=`@keyframes ${n} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${r} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${i} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${g}.${b} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${n} 1s step-end infinite;}${this._terminalSelector} .${g}.${b} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${g}.${b} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${y} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${y} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${y} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(const[n,r]of e.ansi.entries())t+=`${this._terminalSelector} .${v}${n} { color: ${r.css}; }${this._terminalSelector} .${v}${n}.xterm-dim { color: ${h.color.multiplyOpacity(r,.5).css}; }${this._terminalSelector} .${_}${n} { background-color: ${r.css}; }`;t+=`${this._terminalSelector} .${v}${o.INVERTED_DEFAULT_COLOR} { color: ${h.color.opaque(e.background).css}; }${this._terminalSelector} .${v}${o.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${h.color.multiplyOpacity(h.color.opaque(e.background),.5).css}; }${this._terminalSelector} .${_}${o.INVERTED_DEFAULT_COLOR} { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){const e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let e=this._rowElements.length;e<=t;e++){const e=this._document.createElement("div");this._rowContainer.appendChild(e),this._rowElements.push(e)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(b),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(b),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,n){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,n),this.renderRows(0,this._bufferService.rows-1),!e||!t)return;this._selectionRenderModel.update(this._terminal,e,t,n);const r=this._selectionRenderModel.viewportStartRow,i=this._selectionRenderModel.viewportEndRow,s=this._selectionRenderModel.viewportCappedStartRow,a=this._selectionRenderModel.viewportCappedEndRow;if(s>=this._bufferService.rows||a<0)return;const o=this._document.createDocumentFragment();if(n){const n=e[0]>t[0];o.appendChild(this._createSelectionElement(s,n?t[0]:e[0],n?e[0]:t[0],a-s+1))}else{const n=r===s?e[0]:0,l=s===i?t[0]:this._bufferService.cols;o.appendChild(this._createSelectionElement(s,n,l));const c=a-s-1;if(o.appendChild(this._createSelectionElement(s+1,0,this._bufferService.cols,c)),s!==a){const e=i===a?t[0]:this._bufferService.cols;o.appendChild(this._createSelectionElement(a,0,e))}}this._selectionContainer.appendChild(o)}_createSelectionElement(e,t,n,r=1){const i=this._document.createElement("div"),s=t*this.dimensions.css.cell.width;let a=this.dimensions.css.cell.width*(n-t);return s+a>this.dimensions.css.canvas.width&&(a=this.dimensions.css.canvas.width-s),i.style.height=r*this.dimensions.css.cell.height+"px",i.style.top=e*this.dimensions.css.cell.height+"px",i.style.left=`${s}px`,i.style.width=`${a}px`,i}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const e of this._rowElements)e.replaceChildren()}renderRows(e,t){const n=this._bufferService.buffer,r=n.ybase+n.y,i=Math.min(n.x,this._bufferService.cols-1),s=this._optionsService.rawOptions.cursorBlink,a=this._optionsService.rawOptions.cursorStyle,o=this._optionsService.rawOptions.cursorInactiveStyle;for(let l=e;l<=t;l++){const e=l+n.ydisp,t=this._rowElements[l],c=n.lines.get(e);if(!t||!c)break;t.replaceChildren(...this._rowFactory.createRow(c,e,e===r,a,o,i,s,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${m}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,n,r,i,s){n<0&&(e=0),r<0&&(t=0);const a=this._bufferService.rows-1;n=Math.max(Math.min(n,a),0),r=Math.max(Math.min(r,a),0),i=Math.min(i,this._bufferService.cols);const o=this._bufferService.buffer,l=o.ybase+o.y,c=Math.min(o.x,i-1),u=this._optionsService.rawOptions.cursorBlink,h=this._optionsService.rawOptions.cursorStyle,d=this._optionsService.rawOptions.cursorInactiveStyle;for(let a=n;a<=r;++a){const f=a+o.ydisp,p=this._rowElements[a],m=o.lines.get(f);if(!p||!m)break;p.replaceChildren(...this._rowFactory.createRow(m,f,f===l,h,d,c,u,this.dimensions.css.cell.width,this._widthCache,s?a===n?e:0:-1,s?(a===r?t:i)-1:-1))}}};t.DomRenderer=S=r([i(7,p.IInstantiationService),i(8,u.ICharSizeService),i(9,p.IOptionsService),i(10,p.IBufferService),i(11,u.ICoreBrowserService),i(12,u.IThemeService)],S)},3787:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=void 0;const s=n(2223),a=n(643),o=n(511),l=n(2585),c=n(8055),u=n(4725),h=n(4269),d=n(6171),f=n(3734);let p=t.DomRendererRowFactory=class{constructor(e,t,n,r,i,s,a){this._document=e,this._characterJoinerService=t,this._optionsService=n,this._coreBrowserService=r,this._coreService=i,this._decorationService=s,this._themeService=a,this._workCell=new o.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,n){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=n}createRow(e,t,n,r,i,o,l,u,d,p,g){const v=[],_=this._characterJoinerService.getJoinedCharacters(t),b=this._themeService.colors;let y,w=e.getNoBgTrimmedLength();n&&w<o+1&&(w=o+1);let S=0,x="",E=0,C=0,A=0,M=!1,k=0,T=!1,R=0;const P=[],I=-1!==p&&-1!==g;for(let D=0;D<w;D++){e.loadCell(D,this._workCell);let w=this._workCell.getWidth();if(0===w)continue;let O=!1,L=D,B=this._workCell;if(_.length>0&&D===_[0][0]){O=!0;const t=_.shift();B=new h.JoinedCellData(this._workCell,e.translateToString(!0,t[0],t[1]),t[1]-t[0]),L=t[1]-1,w=B.getWidth()}const N=this._isCellInSelection(D,t),U=n&&D===o,H=I&&D>=p&&D<=g;let F=!1;this._decorationService.forEachDecorationAtCell(D,t,void 0,e=>{F=!0});let j=B.getChars()||a.WHITESPACE_CELL_CHAR;if(" "===j&&(B.isUnderline()||B.isOverline())&&(j=" "),R=w*u-d.get(j,B.isBold(),B.isItalic()),y){if(S&&(N&&T||!N&&!T&&B.bg===E)&&(N&&T&&b.selectionForeground||B.fg===C)&&B.extended.ext===A&&H===M&&R===k&&!U&&!O&&!F){B.isInvisible()?x+=a.WHITESPACE_CELL_CHAR:x+=j,S++;continue}S&&(y.textContent=x),y=this._document.createElement("span"),S=0,x=""}else y=this._document.createElement("span");if(E=B.bg,C=B.fg,A=B.extended.ext,M=H,k=R,T=N,O&&o>=D&&o<=L&&(o=D),!this._coreService.isCursorHidden&&U&&this._coreService.isCursorInitialized)if(P.push("xterm-cursor"),this._coreBrowserService.isFocused)l&&P.push("xterm-cursor-blink"),P.push("bar"===r?"xterm-cursor-bar":"underline"===r?"xterm-cursor-underline":"xterm-cursor-block");else if(i)switch(i){case"outline":P.push("xterm-cursor-outline");break;case"block":P.push("xterm-cursor-block");break;case"bar":P.push("xterm-cursor-bar");break;case"underline":P.push("xterm-cursor-underline")}if(B.isBold()&&P.push("xterm-bold"),B.isItalic()&&P.push("xterm-italic"),B.isDim()&&P.push("xterm-dim"),x=B.isInvisible()?a.WHITESPACE_CELL_CHAR:B.getChars()||a.WHITESPACE_CELL_CHAR,B.isUnderline()&&(P.push(`xterm-underline-${B.extended.underlineStyle}`)," "===x&&(x=" "),!B.isUnderlineColorDefault()))if(B.isUnderlineColorRGB())y.style.textDecorationColor=`rgb(${f.AttributeData.toColorRGB(B.getUnderlineColor()).join(",")})`;else{let e=B.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&B.isBold()&&e<8&&(e+=8),y.style.textDecorationColor=b.ansi[e].css}B.isOverline()&&(P.push("xterm-overline")," "===x&&(x=" ")),B.isStrikethrough()&&P.push("xterm-strikethrough"),H&&(y.style.textDecoration="underline");let z=B.getFgColor(),V=B.getFgColorMode(),G=B.getBgColor(),W=B.getBgColorMode();const q=!!B.isInverse();if(q){const e=z;z=G,G=e;const t=V;V=W,W=t}let K,$,X,Y=!1;switch(this._decorationService.forEachDecorationAtCell(D,t,void 0,e=>{"top"!==e.options.layer&&Y||(e.backgroundColorRGB&&(W=50331648,G=e.backgroundColorRGB.rgba>>8&16777215,K=e.backgroundColorRGB),e.foregroundColorRGB&&(V=50331648,z=e.foregroundColorRGB.rgba>>8&16777215,$=e.foregroundColorRGB),Y="top"===e.options.layer)}),!Y&&N&&(K=this._coreBrowserService.isFocused?b.selectionBackgroundOpaque:b.selectionInactiveBackgroundOpaque,G=K.rgba>>8&16777215,W=50331648,Y=!0,b.selectionForeground&&(V=50331648,z=b.selectionForeground.rgba>>8&16777215,$=b.selectionForeground)),Y&&P.push("xterm-decoration-top"),W){case 16777216:case 33554432:X=b.ansi[G],P.push(`xterm-bg-${G}`);break;case 50331648:X=c.channels.toColor(G>>16,G>>8&255,255&G),this._addStyle(y,`background-color:#${m((G>>>0).toString(16),"0",6)}`);break;default:q?(X=b.foreground,P.push(`xterm-bg-${s.INVERTED_DEFAULT_COLOR}`)):X=b.background}switch(K||B.isDim()&&(K=c.color.multiplyOpacity(X,.5)),V){case 16777216:case 33554432:B.isBold()&&z<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(z+=8),this._applyMinimumContrast(y,X,b.ansi[z],B,K,void 0)||P.push(`xterm-fg-${z}`);break;case 50331648:const e=c.channels.toColor(z>>16&255,z>>8&255,255&z);this._applyMinimumContrast(y,X,e,B,K,$)||this._addStyle(y,`color:#${m(z.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(y,X,b.foreground,B,K,$)||q&&P.push(`xterm-fg-${s.INVERTED_DEFAULT_COLOR}`)}P.length&&(y.className=P.join(" "),P.length=0),U||O||F?y.textContent=x:S++,R!==this.defaultSpacing&&(y.style.letterSpacing=`${R}px`),v.push(y),D=L}return y&&S&&(y.textContent=x),v}_applyMinimumContrast(e,t,n,r,i,s){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,d.treatGlyphAsBackgroundColor)(r.getCode()))return!1;const a=this._getContrastCache(r);let o;if(i||s||(o=a.getColor(t.rgba,n.rgba)),void 0===o){const e=this._optionsService.rawOptions.minimumContrastRatio/(r.isDim()?2:1);o=c.color.ensureContrastRatio(i||t,s||n,e),a.setColor((i||t).rgba,(s||n).rgba,o??null)}return!!o&&(this._addStyle(e,`color:${o.css}`),!0)}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){const n=this._selectionStart,r=this._selectionEnd;return!(!n||!r)&&(this._columnSelectMode?n[0]<=r[0]?e>=n[0]&&t>=n[1]&&e<r[0]&&t<=r[1]:e<n[0]&&t>=n[1]&&e>=r[0]&&t<=r[1]:t>n[1]&&t<r[1]||n[1]===r[1]&&t===n[1]&&e>=n[0]&&e<r[0]||n[1]<r[1]&&t===r[1]&&e<r[0]||n[1]<r[1]&&t===n[1]&&e>=n[0])}};function m(e,t,n){for(;e.length<n;)e=t+e;return e}t.DomRendererRowFactory=p=r([i(1,u.ICharacterJoinerService),i(2,l.IOptionsService),i(3,u.ICoreBrowserService),i(4,l.ICoreService),i(5,l.IDecorationService),i(6,u.IThemeService)],p)},2550:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WidthCache=void 0,t.WidthCache=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const n=e.createElement("span");n.classList.add("xterm-char-measure-element");const r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontWeight="bold";const i=e.createElement("span");i.classList.add("xterm-char-measure-element"),i.style.fontStyle="italic";const s=e.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontWeight="bold",s.style.fontStyle="italic",this._measureElements=[n,r,i,s],this._container.appendChild(n),this._container.appendChild(r),this._container.appendChild(i),this._container.appendChild(s),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,n,r){e===this._font&&t===this._fontSize&&n===this._weight&&r===this._weightBold||(this._font=e,this._fontSize=t,this._weight=n,this._weightBold=r,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${n}`,this._measureElements[1].style.fontWeight=`${r}`,this._measureElements[2].style.fontWeight=`${n}`,this._measureElements[3].style.fontWeight=`${r}`,this.clear())}get(e,t,n){let r=0;if(!t&&!n&&1===e.length&&(r=e.charCodeAt(0))<256){if(-9999!==this._flat[r])return this._flat[r];const t=this._measure(e,0);return t>0&&(this._flat[r]=t),t}let i=e;t&&(i+="B"),n&&(i+="I");let s=this._holey.get(i);if(void 0===s){let r=0;t&&(r|=1),n&&(r|=2),s=this._measure(e,r),s>0&&this._holey.set(i,s)}return s}_measure(e,t){const n=this._measureElements[t];return n.textContent=e.repeat(32),n.offsetWidth/32}}},2223:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const r=n(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=r.isFirefox||r.isLegacyEdge?"bottom":"ideographic"},6171:(e,t)=>{function n(e){return 57508<=e&&e<=57558}function r(e){return e>=128512&&e<=128591||e>=127744&&e<=128511||e>=128640&&e<=128767||e>=9728&&e<=9983||e>=9984&&e<=10175||e>=65024&&e<=65039||e>=129280&&e<=129535||e>=127462&&e<=127487}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNextVariantOffset=t.createRenderDimensions=t.treatGlyphAsBackgroundColor=t.allowRescaling=t.isEmoji=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(e){if(!e)throw new Error("value must not be falsy");return e},t.isPowerlineGlyph=n,t.isRestrictedPowerlineGlyph=function(e){return 57520<=e&&e<=57527},t.isEmoji=r,t.allowRescaling=function(e,t,i,s){return 1===t&&i>Math.ceil(1.5*s)&&void 0!==e&&e>255&&!r(e)&&!n(e)&&!function(e){return 57344<=e&&e<=63743}(e)},t.treatGlyphAsBackgroundColor=function(e){return n(e)||function(e){return 9472<=e&&e<=9631}(e)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},t.computeNextVariantOffset=function(e,t,n=0){return(e-(2*Math.round(t)-n))%(2*Math.round(t))}},6052:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class n{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,n,r=!1){if(this.selectionStart=t,this.selectionEnd=n,!t||!n||t[0]===n[0]&&t[1]===n[1])return void this.clear();const i=e.buffers.active.ydisp,s=t[1]-i,a=n[1]-i,o=Math.max(s,0),l=Math.min(a,e.rows-1);o>=e.rows||l<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=s,this.viewportEndRow=a,this.viewportCappedStartRow=o,this.viewportCappedEndRow=l,this.startCol=t[0],this.endCol=n[0])}isCellSelected(e,t,n){return!!this.hasSelection&&(n-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&n>=this.viewportCappedStartRow&&t<this.endCol&&n<=this.viewportCappedEndRow:t<this.startCol&&n>=this.viewportCappedStartRow&&t>=this.endCol&&n<=this.viewportCappedEndRow:n>this.viewportStartRow&&n<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&n===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&n===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&n===this.viewportStartRow&&t>=this.startCol)}}t.createSelectionRenderModel=function(){return new n}},456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const e=this.selectionStart,t=this.selectionEnd;return!(!e||!t)&&(e[1]>t[1]||e[1]===t[1]&&e[0]>t[0])}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const s=n(2585),a=n(8460),o=n(844);let l=t.CharSizeService=class extends o.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,t,n){super(),this._optionsService=n,this.width=0,this.height=0,this._onCharSizeChange=this.register(new a.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new h(this._optionsService))}catch{this._measureStrategy=this.register(new u(e,t,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};t.CharSizeService=l=r([i(2,s.IOptionsService)],l);class c extends o.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){void 0!==e&&e>0&&void 0!==t&&t>0&&(this._result.width=e,this._result.height=t)}}class u extends c{constructor(e,t,n){super(),this._document=e,this._parentElement=t,this._optionsService=n,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class h extends c{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}}},4269:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const s=n(3734),a=n(643),o=n(511),l=n(2585);class c extends s.AttributeData{constructor(e,t,n){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=n}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=c;let u=t.CharacterJoinerService=class e{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new o.CellData}register(e){const t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(0===this._characterJoiners.length)return[];const t=this._bufferService.buffer.lines.get(e);if(!t||0===t.length)return[];const n=[],r=t.translateToString(!0);let i=0,s=0,o=0,l=t.getFg(0),c=t.getBg(0);for(let e=0;e<t.getTrimmedLength();e++)if(t.loadCell(e,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==l||this._workCell.bg!==c){if(e-i>1){const e=this._getJoinedRanges(r,o,s,t,i);for(let t=0;t<e.length;t++)n.push(e[t])}i=e,o=s,l=this._workCell.fg,c=this._workCell.bg}s+=this._workCell.getChars().length||a.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-i>1){const e=this._getJoinedRanges(r,o,s,t,i);for(let t=0;t<e.length;t++)n.push(e[t])}return n}_getJoinedRanges(t,n,r,i,s){const a=t.substring(n,r);let o=[];try{o=this._characterJoiners[0].handler(a)}catch(e){console.error(e)}for(let t=1;t<this._characterJoiners.length;t++)try{const n=this._characterJoiners[t].handler(a);for(let t=0;t<n.length;t++)e._mergeRanges(o,n[t])}catch(e){console.error(e)}return this._stringRangesToCellRanges(o,i,s),o}_stringRangesToCellRanges(e,t,n){let r=0,i=!1,s=0,o=e[r];if(o){for(let l=n;l<this._bufferService.cols;l++){const n=t.getWidth(l),c=t.getString(l).length||a.WHITESPACE_CELL_CHAR.length;if(0!==n){if(!i&&o[0]<=s&&(o[0]=l,i=!0),o[1]<=s){if(o[1]=l,o=e[++r],!o)break;o[0]<=s?(o[0]=l,i=!0):i=!1}s+=c}}o&&(o[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let n=!1;for(let r=0;r<e.length;r++){const i=e[r];if(n){if(t[1]<=i[0])return e[r-1][1]=t[1],e;if(t[1]<=i[1])return e[r-1][1]=Math.max(t[1],i[1]),e.splice(r,1),e;e.splice(r,1),r--}else{if(t[1]<=i[0])return e.splice(r,0,t),e;if(t[1]<=i[1])return i[0]=Math.min(t[0],i[0]),e;t[0]<i[1]&&(i[0]=Math.min(t[0],i[0]),n=!0)}}return n?e[e.length-1][1]=t[1]:e.push(t),e}};t.CharacterJoinerService=u=r([i(0,l.IBufferService)],u)},5114:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0;const r=n(844),i=n(8460),s=n(3656);class a extends r.Disposable{constructor(e,t,n){super(),this._textarea=e,this._window=t,this.mainDocument=n,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new o(this._window),this._onDprChange=this.register(new i.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new i.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(e=>this._screenDprMonitor.setWindow(e))),this.register((0,i.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}t.CoreBrowserService=a;class o extends r.Disposable{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this.register(new r.MutableDisposable),this._onDprChange=this.register(new i.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,r.toDisposable)(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,s.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkProviderService=void 0;const r=n(844);class i extends r.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,r.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{const t=this.linkProviders.indexOf(e);-1!==t&&this.linkProviders.splice(t,1)}}}}t.LinkProviderService=i},8934:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const s=n(4725),a=n(9806);let o=t.MouseService=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,n,r,i){return(0,a.getCoords)(window,e,t,n,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,i)}getMouseReportCoords(e,t){const n=(0,a.getCoordsRelativeToElement)(window,e,t);if(this._charSizeService.hasValidSize)return n[0]=Math.min(Math.max(n[0],0),this._renderService.dimensions.css.canvas.width-1),n[1]=Math.min(Math.max(n[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(n[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(n[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(n[0]),y:Math.floor(n[1])}}};t.MouseService=o=r([i(0,s.IRenderService),i(1,s.ICharSizeService)],o)},3230:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const s=n(6193),a=n(4725),o=n(8460),l=n(844),c=n(7226),u=n(2585);let h=t.RenderService=class extends l.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,t,n,r,i,a,u,h){super(),this._rowCount=e,this._charSizeService=r,this._renderer=this.register(new l.MutableDisposable),this._pausedResizeTask=new c.DebouncedIdleTask,this._observerDisposable=this.register(new l.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new o.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new o.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new o.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new o.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new s.RenderDebouncer((e,t)=>this._renderRows(e,t),u),this.register(this._renderDebouncer),this.register(u.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(a.onResize(()=>this._fullRefresh())),this.register(a.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this.register(n.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(i.onDecorationRegistered(()=>this._fullRefresh())),this.register(i.onDecorationRemoved(()=>this._fullRefresh())),this.register(n.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(a.cols,a.rows),this._fullRefresh()})),this.register(n.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(a.buffer.y,a.buffer.y,!0))),this.register(h.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(u.window,t),this.register(u.onWindowChange(e=>this._registerIntersectionObserver(e,t)))}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){const n=new e.IntersectionObserver(e=>this._handleIntersectionChange(e[e.length-1]),{threshold:0});n.observe(t),this._observerDisposable.value=(0,l.toDisposable)(()=>n.disconnect())}}_handleIntersectionChange(e){this._isPaused=void 0===e.isIntersecting?0===e.intersectionRatio:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,n=!1){this._isPaused?this._needsFullRefresh=!0:(n||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount))}_renderRows(e,t){this._renderer.value&&(e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0)}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(e=>this.refreshRows(e.start,e.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(e,t)):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,t,n){this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=n,this._renderer.value?.handleSelectionChanged(e,t,n)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};t.RenderService=h=r([i(2,u.IOptionsService),i(3,a.ICharSizeService),i(4,u.IDecorationService),i(5,u.IBufferService),i(6,a.ICoreBrowserService),i(7,a.IThemeService)],h)},9312:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const s=n(9806),a=n(9504),o=n(456),l=n(4725),c=n(8460),u=n(844),h=n(6114),d=n(4841),f=n(511),p=n(2585),m=String.fromCharCode(160),g=new RegExp(m,"g");let v=t.SelectionService=class extends u.Disposable{constructor(e,t,n,r,i,s,a,l,h){super(),this._element=e,this._screenElement=t,this._linkifier=n,this._bufferService=r,this._coreService=i,this._mouseService=s,this._optionsService=a,this._renderService=l,this._coreBrowserService=h,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new f.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new c.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new c.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new c.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new c.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=e=>this._handleMouseMove(e),this._mouseUpListener=e=>this._handleMouseUp(e),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(e=>this._handleTrim(e)),this.register(this._bufferService.buffers.onBufferActivate(e=>this._handleBufferActivate(e))),this.enable(),this._model=new o.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,u.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!(!e||!t||e[0]===t[0]&&e[1]===t[1])}get selectionText(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";const n=this._bufferService.buffer,r=[];if(3===this._activeSelectionMode){if(e[0]===t[0])return"";const i=e[0]<t[0]?e[0]:t[0],s=e[0]<t[0]?t[0]:e[0];for(let a=e[1];a<=t[1];a++){const e=n.translateBufferLineToString(a,!0,i,s);r.push(e)}}else{const i=e[1]===t[1]?t[0]:void 0;r.push(n.translateBufferLineToString(e[1],!0,e[0],i));for(let i=e[1]+1;i<=t[1]-1;i++){const e=n.lines.get(i),t=n.translateBufferLineToString(i,!0);e?.isWrapped?r[r.length-1]+=t:r.push(t)}if(e[1]!==t[1]){const e=n.lines.get(t[1]),i=n.translateBufferLineToString(t[1],!0,0,t[0]);e&&e.isWrapped?r[r.length-1]+=i:r.push(i)}}return r.map(e=>e.replace(g," ")).join(h.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),h.isLinux&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(e){const t=this._getMouseBufferCoords(e),n=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!!(n&&r&&t)&&this._areCoordsInSelection(t,n,r)}isCellInSelection(e,t){const n=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!(!n||!r)&&this._areCoordsInSelection([e,t],n,r)}_areCoordsInSelection(e,t,n){return e[1]>t[1]&&e[1]<n[1]||t[1]===n[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<n[0]||t[1]<n[1]&&e[1]===n[1]&&e[0]<n[0]||t[1]<n[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){const n=this._linkifier.currentLink?.link?.range;if(n)return this._model.selectionStart=[n.start.x-1,n.start.y-1],this._model.selectionStartLength=(0,d.getRangeLength)(n,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const r=this._getMouseBufferCoords(e);return!!r&&(this._selectWordAt(r,t),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){const t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=(0,s.getCoordsRelativeToElement)(this._coreBrowserService.window,e,this._screenElement)[1];const n=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=n?0:(t>n&&(t-=n),t=Math.min(Math.max(t,-50),50),t/=50,t/Math.abs(t)+Math.round(14*t))}shouldForceSelection(e){return h.isMac?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,(2!==e.button||!this.hasSelection)&&0===e.button){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):1===e.detail?this._handleSingleClick(e):2===e.detail?this._handleDoubleClick(e):3===e.detail&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&0===t.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){const t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(h.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;const t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const n=this._bufferService.buffer;if(this._model.selectionEnd[1]<n.lines.length){const e=n.lines.get(this._model.selectionEnd[1]);e&&0===e.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}t&&t[0]===this._model.selectionEnd[0]&&t[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const e=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){const t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<500&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const t=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(t&&void 0!==t[0]&&void 0!==t[1]){const e=(0,a.moveToCellSequence)(t[0]-1,t[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(e,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,n=!(!e||!t||e[0]===t[0]&&e[1]===t[1]);n?e&&t&&(this._oldSelectionStart&&this._oldSelectionEnd&&e[0]===this._oldSelectionStart[0]&&e[1]===this._oldSelectionStart[1]&&t[0]===this._oldSelectionEnd[0]&&t[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(e,t,n)):this._oldHasSelection&&this._fireOnSelectionChange(e,t,n)}_fireOnSelectionChange(e,t,n){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=n,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(e=>this._handleTrim(e))}_convertViewportColToCharacterIndex(e,t){let n=t;for(let r=0;t>=r;r++){const i=e.loadCell(r,this._workCell).getChars().length;0===this._workCell.getWidth()?n--:i>1&&t!==r&&(n+=i-1)}return n}setSelection(e,t,n){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=n,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,n=!0,r=!0){if(e[0]>=this._bufferService.cols)return;const i=this._bufferService.buffer,s=i.lines.get(e[1]);if(!s)return;const a=i.translateBufferLineToString(e[1],!1);let o=this._convertViewportColToCharacterIndex(s,e[0]),l=o;const c=e[0]-o;let u=0,h=0,d=0,f=0;if(" "===a.charAt(o)){for(;o>0&&" "===a.charAt(o-1);)o--;for(;l<a.length&&" "===a.charAt(l+1);)l++}else{let t=e[0],n=e[0];0===s.getWidth(t)&&(u++,t--),2===s.getWidth(n)&&(h++,n++);const r=s.getString(n).length;for(r>1&&(f+=r-1,l+=r-1);t>0&&o>0&&!this._isCharWordSeparator(s.loadCell(t-1,this._workCell));){s.loadCell(t-1,this._workCell);const e=this._workCell.getChars().length;0===this._workCell.getWidth()?(u++,t--):e>1&&(d+=e-1,o-=e-1),o--,t--}for(;n<s.length&&l+1<a.length&&!this._isCharWordSeparator(s.loadCell(n+1,this._workCell));){s.loadCell(n+1,this._workCell);const e=this._workCell.getChars().length;2===this._workCell.getWidth()?(h++,n++):e>1&&(f+=e-1,l+=e-1),l++,n++}}l++;let p=o+c-u+d,m=Math.min(this._bufferService.cols,l-o+u+h-d-f);if(t||""!==a.slice(o,l).trim()){if(n&&0===p&&32!==s.getCodePoint(0)){const t=i.lines.get(e[1]-1);if(t&&s.isWrapped&&32!==t.getCodePoint(this._bufferService.cols-1)){const t=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(t){const e=this._bufferService.cols-t.start;p-=e,m+=e}}}if(r&&p+m===this._bufferService.cols&&32!==s.getCodePoint(this._bufferService.cols-1)){const t=i.lines.get(e[1]+1);if(t?.isWrapped&&32!==t.getCodePoint(0)){const t=this._getWordAt([0,e[1]+1],!1,!1,!0);t&&(m+=t.length)}}return{start:p,length:m}}}_selectWordAt(e,t){const n=this._getWordAt(e,t);if(n){for(;n.start<0;)n.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[n.start,e[1]],this._model.selectionStartLength=n.length}}_selectToWordAt(e){const t=this._getWordAt(e,!0);if(t){let n=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,n--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,n++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,n]}}_isCharWordSeparator(e){return 0!==e.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){const t=this._bufferService.buffer.getWrappedRangeForLine(e),n={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,d.getRangeLength)(n,this._bufferService.cols)}};t.SelectionService=v=r([i(3,p.IBufferService),i(4,p.ICoreService),i(5,l.IMouseService),i(6,p.IOptionsService),i(7,l.IRenderService),i(8,l.ICoreBrowserService)],v)},4725:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ILinkProviderService=t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const r=n(8343);t.ICharSizeService=(0,r.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,r.createDecorator)("CoreBrowserService"),t.IMouseService=(0,r.createDecorator)("MouseService"),t.IRenderService=(0,r.createDecorator)("RenderService"),t.ISelectionService=(0,r.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,r.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,r.createDecorator)("ThemeService"),t.ILinkProviderService=(0,r.createDecorator)("LinkProviderService")},6731:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const s=n(7239),a=n(8055),o=n(8460),l=n(844),c=n(2585),u=a.css.toColor("#ffffff"),h=a.css.toColor("#000000"),d=a.css.toColor("#ffffff"),f=a.css.toColor("#000000"),p={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const e=[a.css.toColor("#2e3436"),a.css.toColor("#cc0000"),a.css.toColor("#4e9a06"),a.css.toColor("#c4a000"),a.css.toColor("#3465a4"),a.css.toColor("#75507b"),a.css.toColor("#06989a"),a.css.toColor("#d3d7cf"),a.css.toColor("#555753"),a.css.toColor("#ef2929"),a.css.toColor("#8ae234"),a.css.toColor("#fce94f"),a.css.toColor("#729fcf"),a.css.toColor("#ad7fa8"),a.css.toColor("#34e2e2"),a.css.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let n=0;n<216;n++){const r=t[n/36%6|0],i=t[n/6%6|0],s=t[n%6];e.push({css:a.channels.toCss(r,i,s),rgba:a.channels.toRgba(r,i,s)})}for(let t=0;t<24;t++){const n=8+10*t;e.push({css:a.channels.toCss(n,n,n),rgba:a.channels.toRgba(n,n,n)})}return e})());let m=t.ThemeService=class extends l.Disposable{get colors(){return this._colors}constructor(e){super(),this._optionsService=e,this._contrastCache=new s.ColorContrastCache,this._halfContrastCache=new s.ColorContrastCache,this._onChangeColors=this.register(new o.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:u,background:h,cursor:d,cursorAccent:f,selectionForeground:void 0,selectionBackgroundTransparent:p,selectionBackgroundOpaque:a.color.blend(h,p),selectionInactiveBackgroundTransparent:p,selectionInactiveBackgroundOpaque:a.color.blend(h,p),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(e={}){const n=this._colors;if(n.foreground=g(e.foreground,u),n.background=g(e.background,h),n.cursor=g(e.cursor,d),n.cursorAccent=g(e.cursorAccent,f),n.selectionBackgroundTransparent=g(e.selectionBackground,p),n.selectionBackgroundOpaque=a.color.blend(n.background,n.selectionBackgroundTransparent),n.selectionInactiveBackgroundTransparent=g(e.selectionInactiveBackground,n.selectionBackgroundTransparent),n.selectionInactiveBackgroundOpaque=a.color.blend(n.background,n.selectionInactiveBackgroundTransparent),n.selectionForeground=e.selectionForeground?g(e.selectionForeground,a.NULL_COLOR):void 0,n.selectionForeground===a.NULL_COLOR&&(n.selectionForeground=void 0),a.color.isOpaque(n.selectionBackgroundTransparent)){const e=.3;n.selectionBackgroundTransparent=a.color.opacity(n.selectionBackgroundTransparent,e)}if(a.color.isOpaque(n.selectionInactiveBackgroundTransparent)){const e=.3;n.selectionInactiveBackgroundTransparent=a.color.opacity(n.selectionInactiveBackgroundTransparent,e)}if(n.ansi=t.DEFAULT_ANSI_COLORS.slice(),n.ansi[0]=g(e.black,t.DEFAULT_ANSI_COLORS[0]),n.ansi[1]=g(e.red,t.DEFAULT_ANSI_COLORS[1]),n.ansi[2]=g(e.green,t.DEFAULT_ANSI_COLORS[2]),n.ansi[3]=g(e.yellow,t.DEFAULT_ANSI_COLORS[3]),n.ansi[4]=g(e.blue,t.DEFAULT_ANSI_COLORS[4]),n.ansi[5]=g(e.magenta,t.DEFAULT_ANSI_COLORS[5]),n.ansi[6]=g(e.cyan,t.DEFAULT_ANSI_COLORS[6]),n.ansi[7]=g(e.white,t.DEFAULT_ANSI_COLORS[7]),n.ansi[8]=g(e.brightBlack,t.DEFAULT_ANSI_COLORS[8]),n.ansi[9]=g(e.brightRed,t.DEFAULT_ANSI_COLORS[9]),n.ansi[10]=g(e.brightGreen,t.DEFAULT_ANSI_COLORS[10]),n.ansi[11]=g(e.brightYellow,t.DEFAULT_ANSI_COLORS[11]),n.ansi[12]=g(e.brightBlue,t.DEFAULT_ANSI_COLORS[12]),n.ansi[13]=g(e.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),n.ansi[14]=g(e.brightCyan,t.DEFAULT_ANSI_COLORS[14]),n.ansi[15]=g(e.brightWhite,t.DEFAULT_ANSI_COLORS[15]),e.extendedAnsi){const r=Math.min(n.ansi.length-16,e.extendedAnsi.length);for(let i=0;i<r;i++)n.ansi[i+16]=g(e.extendedAnsi[i],t.DEFAULT_ANSI_COLORS[i+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(void 0!==e)switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}else for(let e=0;e<this._restoreColors.ansi.length;++e)this._colors.ansi[e]=this._restoreColors.ansi[e]}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function g(e,t){if(void 0!==e)try{return a.css.toColor(e)}catch{}return t}t.ThemeService=m=r([i(0,c.IOptionsService)],m)},6349:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const r=n(8460),i=n(844);class s extends i.Disposable{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this.register(new r.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new r.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new r.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;const t=new Array(e);for(let n=0;n<Math.min(e,this.length);n++)t[n]=this._array[this._getCyclicIndex(n)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...n){if(t){for(let n=e;n<this._length-t;n++)this._array[this._getCyclicIndex(n)]=this._array[this._getCyclicIndex(n+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let t=this._length-1;t>=e;t--)this._array[this._getCyclicIndex(t+n.length)]=this._array[this._getCyclicIndex(t)];for(let t=0;t<n.length;t++)this._array[this._getCyclicIndex(e+t)]=n[t];if(n.length&&this.onInsertEmitter.fire({index:e,amount:n.length}),this._length+n.length>this._maxLength){const e=this._length+n.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=n.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,n){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+n<0)throw new Error("Cannot shift elements in list beyond index 0");if(n>0){for(let r=t-1;r>=0;r--)this.set(e+r+n,this.get(e+r));const r=e+t+n-this._length;if(r>0)for(this._length+=r;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let r=0;r<t;r++)this.set(e+r+n,this.get(e+r))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}}t.CircularList=s},1439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function e(t,n=5){if("object"!=typeof t)return t;const r=Array.isArray(t)?[]:{};for(const i in t)r[i]=n<=1?t[i]:t[i]&&e(t[i],n-1);return r}},8055:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let n=0,r=0,i=0,s=0;var a,o,l,c,u;function h(e){const t=e.toString(16);return t.length<2?"0"+t:t}function d(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(e){e.toCss=function(e,t,n,r){return void 0!==r?`#${h(e)}${h(t)}${h(n)}${h(r)}`:`#${h(e)}${h(t)}${h(n)}`},e.toRgba=function(e,t,n,r=255){return(e<<24|t<<16|n<<8|r)>>>0},e.toColor=function(t,n,r,i){return{css:e.toCss(t,n,r,i),rgba:e.toRgba(t,n,r,i)}}}(a||(t.channels=a={})),function(e){function t(e,t){return s=Math.round(255*t),[n,r,i]=u.toChannels(e.rgba),{css:a.toCss(n,r,i,s),rgba:a.toRgba(n,r,i,s)}}e.blend=function(e,t){if(s=(255&t.rgba)/255,1===s)return{css:t.css,rgba:t.rgba};const o=t.rgba>>24&255,l=t.rgba>>16&255,c=t.rgba>>8&255,u=e.rgba>>24&255,h=e.rgba>>16&255,d=e.rgba>>8&255;return n=u+Math.round((o-u)*s),r=h+Math.round((l-h)*s),i=d+Math.round((c-d)*s),{css:a.toCss(n,r,i),rgba:a.toRgba(n,r,i)}},e.isOpaque=function(e){return!(255&~e.rgba)},e.ensureContrastRatio=function(e,t,n){const r=u.ensureContrastRatio(e.rgba,t.rgba,n);if(r)return a.toColor(r>>24&255,r>>16&255,r>>8&255)},e.opaque=function(e){const t=(255|e.rgba)>>>0;return[n,r,i]=u.toChannels(t),{css:a.toCss(n,r,i),rgba:t}},e.opacity=t,e.multiplyOpacity=function(e,n){return s=255&e.rgba,t(e,s*n/255)},e.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]}}(o||(t.color=o={})),function(e){let t,o;try{const e=document.createElement("canvas");e.width=1,e.height=1;const n=e.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",o=t.createLinearGradient(0,0,1,1))}catch{}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return n=parseInt(e.slice(1,2).repeat(2),16),r=parseInt(e.slice(2,3).repeat(2),16),i=parseInt(e.slice(3,4).repeat(2),16),a.toColor(n,r,i);case 5:return n=parseInt(e.slice(1,2).repeat(2),16),r=parseInt(e.slice(2,3).repeat(2),16),i=parseInt(e.slice(3,4).repeat(2),16),s=parseInt(e.slice(4,5).repeat(2),16),a.toColor(n,r,i,s);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}const l=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(l)return n=parseInt(l[1]),r=parseInt(l[2]),i=parseInt(l[3]),s=Math.round(255*(void 0===l[5]?1:parseFloat(l[5]))),a.toColor(n,r,i,s);if(!t||!o)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=o,t.fillStyle=e,"string"!=typeof t.fillStyle)throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[n,r,i,s]=t.getImageData(0,0,1,1).data,255!==s)throw new Error("css.toColor: Unsupported css format");return{rgba:a.toRgba(n,r,i,s),css:e}}}(l||(t.css=l={})),function(e){function t(e,t,n){const r=e/255,i=t/255,s=n/255;return.2126*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.7152*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.0722*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))}e.relativeLuminance=function(e){return t(e>>16&255,e>>8&255,255&e)},e.relativeLuminance2=t}(c||(t.rgb=c={})),function(e){function t(e,t,n){const r=e>>24&255,i=e>>16&255,s=e>>8&255;let a=t>>24&255,o=t>>16&255,l=t>>8&255,u=d(c.relativeLuminance2(a,o,l),c.relativeLuminance2(r,i,s));for(;u<n&&(a>0||o>0||l>0);)a-=Math.max(0,Math.ceil(.1*a)),o-=Math.max(0,Math.ceil(.1*o)),l-=Math.max(0,Math.ceil(.1*l)),u=d(c.relativeLuminance2(a,o,l),c.relativeLuminance2(r,i,s));return(a<<24|o<<16|l<<8|255)>>>0}function o(e,t,n){const r=e>>24&255,i=e>>16&255,s=e>>8&255;let a=t>>24&255,o=t>>16&255,l=t>>8&255,u=d(c.relativeLuminance2(a,o,l),c.relativeLuminance2(r,i,s));for(;u<n&&(a<255||o<255||l<255);)a=Math.min(255,a+Math.ceil(.1*(255-a))),o=Math.min(255,o+Math.ceil(.1*(255-o))),l=Math.min(255,l+Math.ceil(.1*(255-l))),u=d(c.relativeLuminance2(a,o,l),c.relativeLuminance2(r,i,s));return(a<<24|o<<16|l<<8|255)>>>0}e.blend=function(e,t){if(s=(255&t)/255,1===s)return t;const o=t>>24&255,l=t>>16&255,c=t>>8&255,u=e>>24&255,h=e>>16&255,d=e>>8&255;return n=u+Math.round((o-u)*s),r=h+Math.round((l-h)*s),i=d+Math.round((c-d)*s),a.toRgba(n,r,i)},e.ensureContrastRatio=function(e,n,r){const i=c.relativeLuminance(e>>8),s=c.relativeLuminance(n>>8);if(d(i,s)<r){if(s<i){const s=t(e,n,r),a=d(i,c.relativeLuminance(s>>8));if(a<r){const t=o(e,n,r);return a>d(i,c.relativeLuminance(t>>8))?s:t}return s}const a=o(e,n,r),l=d(i,c.relativeLuminance(a>>8));if(l<r){const s=t(e,n,r);return l>d(i,c.relativeLuminance(s>>8))?a:s}return a}},e.reduceLuminance=t,e.increaseLuminance=o,e.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}}(u||(t.rgba=u={})),t.toPaddedHex=h,t.contrastRatio=d},8969:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const r=n(844),i=n(2585),s=n(4348),a=n(7866),o=n(744),l=n(7302),c=n(6975),u=n(8460),h=n(1753),d=n(1480),f=n(7994),p=n(9282),m=n(5435),g=n(5981),v=n(2660);let _=!1;class b extends r.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new u.EventEmitter),this._onScroll.event(e=>{this._onScrollApi?.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(const t in e)this.optionsService.options[t]=e[t]}constructor(e){super(),this._windowsWrappingHeuristics=this.register(new r.MutableDisposable),this._onBinary=this.register(new u.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new u.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new u.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new u.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new u.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new u.EventEmitter),this._instantiationService=new s.InstantiationService,this.optionsService=this.register(new l.OptionsService(e)),this._instantiationService.setService(i.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(o.BufferService)),this._instantiationService.setService(i.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(a.LogService)),this._instantiationService.setService(i.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(c.CoreService)),this._instantiationService.setService(i.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(h.CoreMouseService)),this._instantiationService.setService(i.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(d.UnicodeService)),this._instantiationService.setService(i.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(f.CharsetService),this._instantiationService.setService(i.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(v.OscLinkService),this._instantiationService.setService(i.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new m.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,u.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,u.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,u.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,u.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new g.WriteBuffer((e,t)=>this._inputHandler.parse(e,t))),this.register((0,u.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=i.LogLevelEnum.WARN&&!_&&(this._logService.warn("writeSync is unreliable and will be removed soon."),_=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,o.MINIMUM_COLS),t=Math.max(t,o.MINIMUM_ROWS),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t,n){this._bufferService.scrollLines(e,t,n)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){const t=e-this._bufferService.buffer.ydisp;0!==t&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1;const t=this.optionsService.rawOptions.windowsPty;t&&void 0!==t.buildNumber&&void 0!==t.buildNumber?e=!!("conpty"===t.backend&&t.buildNumber<21376):this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const e=[];e.push(this.onLineFeed(p.updateWindowsModeWrappedState.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>((0,p.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,r.toDisposable)(()=>{for(const t of e)t.dispose()})}}}t.CoreTerminal=b},8460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed)for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}})),this._event}fire(e,t){const n=[];for(let e=0;e<this._listeners.length;e++)n.push(this._listeners[e]);for(let r=0;r<n.length;r++)n[r].call(void 0,e,t)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(e,t){return e(e=>t.fire(e))},t.runAndSubscribe=function(e,t){return t(void 0),e(e=>t(e))}},5435:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const s=n(2584),a=n(7116),o=n(2015),l=n(844),c=n(482),u=n(8437),h=n(8460),d=n(643),f=n(511),p=n(3734),m=n(2585),g=n(1480),v=n(6242),_=n(6351),b=n(5941),y={"(":0,")":1,"*":2,"+":3,"-":1,".":2},w=131072;function S(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var x;!function(e){e[e.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",e[e.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"}(x||(t.WindowsOptionsReportType=x={}));let E=0;class C extends l.Disposable{getAttrData(){return this._curAttrData}constructor(e,t,n,r,i,l,d,p,m=new o.EscapeSequenceParser){super(),this._bufferService=e,this._charsetService=t,this._coreService=n,this._logService=r,this._optionsService=i,this._oscLinkService=l,this._coreMouseService=d,this._unicodeService=p,this._parser=m,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new c.StringToUtf32,this._utf8Decoder=new c.Utf8ToUtf32,this._workCell=new f.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=u.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=u.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new h.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new h.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new h.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new h.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new h.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new h.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new h.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new h.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new h.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new h.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new h.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new h.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new h.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new A(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(e=>this._activeBuffer=e.activeBuffer)),this._parser.setCsiHandlerFallback((e,t)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(e),params:t.toArray()})}),this._parser.setEscHandlerFallback(e=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(e)})}),this._parser.setExecuteHandlerFallback(e=>{this._logService.debug("Unknown EXECUTE code: ",{code:e})}),this._parser.setOscHandlerFallback((e,t,n)=>{this._logService.debug("Unknown OSC code: ",{identifier:e,action:t,data:n})}),this._parser.setDcsHandlerFallback((e,t,n)=>{"HOOK"===t&&(n=n.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(e),action:t,payload:n})}),this._parser.setPrintHandler((e,t,n)=>this.print(e,t,n)),this._parser.registerCsiHandler({final:"@"},e=>this.insertChars(e)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},e=>this.scrollLeft(e)),this._parser.registerCsiHandler({final:"A"},e=>this.cursorUp(e)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},e=>this.scrollRight(e)),this._parser.registerCsiHandler({final:"B"},e=>this.cursorDown(e)),this._parser.registerCsiHandler({final:"C"},e=>this.cursorForward(e)),this._parser.registerCsiHandler({final:"D"},e=>this.cursorBackward(e)),this._parser.registerCsiHandler({final:"E"},e=>this.cursorNextLine(e)),this._parser.registerCsiHandler({final:"F"},e=>this.cursorPrecedingLine(e)),this._parser.registerCsiHandler({final:"G"},e=>this.cursorCharAbsolute(e)),this._parser.registerCsiHandler({final:"H"},e=>this.cursorPosition(e)),this._parser.registerCsiHandler({final:"I"},e=>this.cursorForwardTab(e)),this._parser.registerCsiHandler({final:"J"},e=>this.eraseInDisplay(e,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},e=>this.eraseInDisplay(e,!0)),this._parser.registerCsiHandler({final:"K"},e=>this.eraseInLine(e,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},e=>this.eraseInLine(e,!0)),this._parser.registerCsiHandler({final:"L"},e=>this.insertLines(e)),this._parser.registerCsiHandler({final:"M"},e=>this.deleteLines(e)),this._parser.registerCsiHandler({final:"P"},e=>this.deleteChars(e)),this._parser.registerCsiHandler({final:"S"},e=>this.scrollUp(e)),this._parser.registerCsiHandler({final:"T"},e=>this.scrollDown(e)),this._parser.registerCsiHandler({final:"X"},e=>this.eraseChars(e)),this._parser.registerCsiHandler({final:"Z"},e=>this.cursorBackwardTab(e)),this._parser.registerCsiHandler({final:"`"},e=>this.charPosAbsolute(e)),this._parser.registerCsiHandler({final:"a"},e=>this.hPositionRelative(e)),this._parser.registerCsiHandler({final:"b"},e=>this.repeatPrecedingCharacter(e)),this._parser.registerCsiHandler({final:"c"},e=>this.sendDeviceAttributesPrimary(e)),this._parser.registerCsiHandler({prefix:">",final:"c"},e=>this.sendDeviceAttributesSecondary(e)),this._parser.registerCsiHandler({final:"d"},e=>this.linePosAbsolute(e)),this._parser.registerCsiHandler({final:"e"},e=>this.vPositionRelative(e)),this._parser.registerCsiHandler({final:"f"},e=>this.hVPosition(e)),this._parser.registerCsiHandler({final:"g"},e=>this.tabClear(e)),this._parser.registerCsiHandler({final:"h"},e=>this.setMode(e)),this._parser.registerCsiHandler({prefix:"?",final:"h"},e=>this.setModePrivate(e)),this._parser.registerCsiHandler({final:"l"},e=>this.resetMode(e)),this._parser.registerCsiHandler({prefix:"?",final:"l"},e=>this.resetModePrivate(e)),this._parser.registerCsiHandler({final:"m"},e=>this.charAttributes(e)),this._parser.registerCsiHandler({final:"n"},e=>this.deviceStatus(e)),this._parser.registerCsiHandler({prefix:"?",final:"n"},e=>this.deviceStatusPrivate(e)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},e=>this.softReset(e)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},e=>this.setCursorStyle(e)),this._parser.registerCsiHandler({final:"r"},e=>this.setScrollRegion(e)),this._parser.registerCsiHandler({final:"s"},e=>this.saveCursor(e)),this._parser.registerCsiHandler({final:"t"},e=>this.windowOptions(e)),this._parser.registerCsiHandler({final:"u"},e=>this.restoreCursor(e)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},e=>this.insertColumns(e)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},e=>this.deleteColumns(e)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},e=>this.selectProtected(e)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},e=>this.requestMode(e,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},e=>this.requestMode(e,!1)),this._parser.setExecuteHandler(s.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(s.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(s.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(s.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(s.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(s.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(s.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(s.C1.IND,()=>this.index()),this._parser.setExecuteHandler(s.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(s.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new v.OscHandler(e=>(this.setTitle(e),this.setIconName(e),!0))),this._parser.registerOscHandler(1,new v.OscHandler(e=>this.setIconName(e))),this._parser.registerOscHandler(2,new v.OscHandler(e=>this.setTitle(e))),this._parser.registerOscHandler(4,new v.OscHandler(e=>this.setOrReportIndexedColor(e))),this._parser.registerOscHandler(8,new v.OscHandler(e=>this.setHyperlink(e))),this._parser.registerOscHandler(10,new v.OscHandler(e=>this.setOrReportFgColor(e))),this._parser.registerOscHandler(11,new v.OscHandler(e=>this.setOrReportBgColor(e))),this._parser.registerOscHandler(12,new v.OscHandler(e=>this.setOrReportCursorColor(e))),this._parser.registerOscHandler(104,new v.OscHandler(e=>this.restoreIndexedColor(e))),this._parser.registerOscHandler(110,new v.OscHandler(e=>this.restoreFgColor(e))),this._parser.registerOscHandler(111,new v.OscHandler(e=>this.restoreBgColor(e))),this._parser.registerOscHandler(112,new v.OscHandler(e=>this.restoreCursorColor(e))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const e in a.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:e},()=>this.selectCharset("("+e)),this._parser.registerEscHandler({intermediates:")",final:e},()=>this.selectCharset(")"+e)),this._parser.registerEscHandler({intermediates:"*",final:e},()=>this.selectCharset("*"+e)),this._parser.registerEscHandler({intermediates:"+",final:e},()=>this.selectCharset("+"+e)),this._parser.registerEscHandler({intermediates:"-",final:e},()=>this.selectCharset("-"+e)),this._parser.registerEscHandler({intermediates:".",final:e},()=>this.selectCharset("."+e)),this._parser.registerEscHandler({intermediates:"/",final:e},()=>this.selectCharset("/"+e));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(e=>(this._logService.error("Parsing error: ",e),e)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new _.DcsHandler((e,t)=>this.requestStatusString(e,t)))}_preserveStack(e,t,n,r){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=n,this._parseStack.position=r}_logSlowResolvingAsync(e){this._logService.logLevel<=m.LogLevelEnum.WARN&&Promise.race([e,new Promise((e,t)=>setTimeout(()=>t("#SLOW_TIMEOUT"),5e3))]).catch(e=>{if("#SLOW_TIMEOUT"!==e)throw e;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let n,r=this._activeBuffer.x,i=this._activeBuffer.y,s=0;const a=this._parseStack.paused;if(a){if(n=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(n),n;r=this._parseStack.cursorStartX,i=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>w&&(s=this._parseStack.position+w)}if(this._logService.logLevel<=m.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof e?` "${e}"`:` "${Array.prototype.map.call(e,e=>String.fromCharCode(e)).join("")}"`),"string"==typeof e?e.split("").map(e=>e.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<w&&(this._parseBuffer=new Uint32Array(Math.min(e.length,w))),a||this._dirtyRowTracker.clearRange(),e.length>w)for(let t=s;t<e.length;t+=w){const s=t+w<e.length?t+w:e.length,a="string"==typeof e?this._stringDecoder.decode(e.substring(t,s),this._parseBuffer):this._utf8Decoder.decode(e.subarray(t,s),this._parseBuffer);if(n=this._parser.parse(this._parseBuffer,a))return this._preserveStack(r,i,a,t),this._logSlowResolvingAsync(n),n}else if(!a){const t="string"==typeof e?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(n=this._parser.parse(this._parseBuffer,t))return this._preserveStack(r,i,t,0),this._logSlowResolvingAsync(n),n}this._activeBuffer.x===r&&this._activeBuffer.y===i||this._onCursorMove.fire();const o=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),l=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);l<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(l,this._bufferService.rows-1),Math.min(o,this._bufferService.rows-1))}print(e,t,n){let r,i;const s=this._charsetService.charset,a=this._optionsService.rawOptions.screenReaderMode,o=this._bufferService.cols,l=this._coreService.decPrivateModes.wraparound,h=this._coreService.modes.insertMode,f=this._curAttrData;let p=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&n-t>0&&2===p.getWidth(this._activeBuffer.x-1)&&p.setCellFromCodepoint(this._activeBuffer.x-1,0,1,f);let m=this._parser.precedingJoinState;for(let v=t;v<n;++v){if(r=e[v],r<127&&s){const e=s[String.fromCharCode(r)];e&&(r=e.charCodeAt(0))}const t=this._unicodeService.charProperties(r,m);i=g.UnicodeService.extractWidth(t);const n=g.UnicodeService.extractShouldJoin(t),_=n?g.UnicodeService.extractWidth(m):0;if(m=t,a&&this._onA11yChar.fire((0,c.stringFromCodePoint)(r)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+i-_>o)if(l){const e=p;let t=this._activeBuffer.x-_;for(this._activeBuffer.x=_,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),p=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),_>0&&p instanceof u.BufferLine&&p.copyCellsFrom(e,t,0,_,!1);t<o;)e.setCellFromCodepoint(t++,0,1,f)}else if(this._activeBuffer.x=o-1,2===i)continue;if(n&&this._activeBuffer.x){const e=p.getWidth(this._activeBuffer.x-1)?1:2;p.addCodepointToCell(this._activeBuffer.x-e,r,i);for(let e=i-_;--e>=0;)p.setCellFromCodepoint(this._activeBuffer.x++,0,0,f)}else if(h&&(p.insertCells(this._activeBuffer.x,i-_,this._activeBuffer.getNullCell(f)),2===p.getWidth(o-1)&&p.setCellFromCodepoint(o-1,d.NULL_CELL_CODE,d.NULL_CELL_WIDTH,f)),p.setCellFromCodepoint(this._activeBuffer.x++,r,i,f),i>0)for(;--i;)p.setCellFromCodepoint(this._activeBuffer.x++,0,0,f)}this._parser.precedingJoinState=m,this._activeBuffer.x<o&&n-t>0&&0===p.getWidth(this._activeBuffer.x)&&!p.hasContent(this._activeBuffer.x)&&p.setCellFromCodepoint(this._activeBuffer.x,0,1,f),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return"t"!==e.final||e.prefix||e.intermediates?this._parser.registerCsiHandler(e,t):this._parser.registerCsiHandler(e,e=>!S(e.params[0],this._optionsService.rawOptions.windowOptions)||t(e))}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new _.DcsHandler(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new v.OscHandler(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){const t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){const t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){const t=e.params[0];return 0===t?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===t&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){const t=e.params[0];return 1===t&&(this._curAttrData.bg|=536870912),2!==t&&0!==t||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,n,r=!1,i=!1){const s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s.replaceCells(t,n,this._activeBuffer.getNullCell(this._eraseAttrData()),i),r&&(s.isWrapped=!1)}_resetBufferLine(e,t=!1){const n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n&&(n.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),n.isWrapped=!1)}eraseInDisplay(e,t=!1){let n;switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:for(n=this._activeBuffer.y,this._dirtyRowTracker.markDirty(n),this._eraseInBufferLine(n++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);n<this._bufferService.rows;n++)this._resetBufferLine(n,t);this._dirtyRowTracker.markDirty(n);break;case 1:for(n=this._activeBuffer.y,this._dirtyRowTracker.markDirty(n),this._eraseInBufferLine(n,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(n+1).isWrapped=!1);n--;)this._resetBufferLine(n,t);this._dirtyRowTracker.markDirty(0);break;case 2:for(n=this._bufferService.rows,this._dirtyRowTracker.markDirty(n-1);n--;)this._resetBufferLine(n,t);this._dirtyRowTracker.markDirty(0);break;case 3:const e=this._activeBuffer.lines.length-this._bufferService.rows;e>0&&(this._activeBuffer.lines.trimStart(e),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-e,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-e,0),this._onScroll.fire(0))}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const n=this._activeBuffer.ybase+this._activeBuffer.y,r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,i=this._bufferService.rows-1+this._activeBuffer.ybase-r+1;for(;t--;)this._activeBuffer.lines.splice(i-1,1),this._activeBuffer.lines.splice(n,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const n=this._activeBuffer.ybase+this._activeBuffer.y;let r;for(r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-r;t--;)this._activeBuffer.lines.splice(n,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(u.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),n.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){const t=this._parser.precedingJoinState;if(!t)return!0;const n=e.params[0]||1,r=g.UnicodeService.extractWidth(t),i=this._activeBuffer.x-r,s=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(i),a=new Uint32Array(s.length*n);let o=0;for(let e=0;e<s.length;){const t=s.codePointAt(e)||0;a[o++]=t,e+=t>65535?2:1}let l=o;for(let e=1;e<n;++e)a.copyWithin(l,0,o),l+=o;return this.print(a,0,l),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(s.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(s.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(s.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(s.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(s.C0.ESC+"[>83;40003;0c")),!0}_is(e){return 0===(this._optionsService.rawOptions.termName+"").indexOf(e)}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,a.DEFAULT_CHARSET),this._charsetService.setgCharset(1,a.DEFAULT_CHARSET),this._charsetService.setgCharset(2,a.DEFAULT_CHARSET),this._charsetService.setgCharset(3,a.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===e.params[t]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(e,t){const n=this._coreService.decPrivateModes,{activeProtocol:r,activeEncoding:i}=this._coreMouseService,a=this._coreService,{buffers:o,cols:l}=this._bufferService,{active:c,alt:u}=o,h=this._optionsService.rawOptions,d=e=>e?1:2,f=e.params[0];return p=f,m=t?2===f?4:4===f?d(a.modes.insertMode):12===f?3:20===f?d(h.convertEol):0:1===f?d(n.applicationCursorKeys):3===f?h.windowOptions.setWinLines?80===l?2:132===l?1:0:0:6===f?d(n.origin):7===f?d(n.wraparound):8===f?3:9===f?d("X10"===r):12===f?d(h.cursorBlink):25===f?d(!a.isCursorHidden):45===f?d(n.reverseWraparound):66===f?d(n.applicationKeypad):67===f?4:1e3===f?d("VT200"===r):1002===f?d("DRAG"===r):1003===f?d("ANY"===r):1004===f?d(n.sendFocus):1005===f?4:1006===f?d("SGR"===i):1015===f?4:1016===f?d("SGR_PIXELS"===i):1048===f?1:47===f||1047===f||1049===f?d(c===u):2004===f?d(n.bracketedPasteMode):0,a.triggerDataEvent(`${s.C0.ESC}[${t?"":"?"}${p};${m}$y`),!0;var p,m}_updateAttrColor(e,t,n,r,i){return 2===t?(e|=50331648,e&=-16777216,e|=p.AttributeData.fromColorRGB([n,r,i])):5===t&&(e&=-50331904,e|=33554432|255&n),e}_extractColor(e,t,n){const r=[0,0,-1,0,0,0];let i=0,s=0;do{if(r[s+i]=e.params[t+s],e.hasSubParams(t+s)){const n=e.getSubParams(t+s);let a=0;do{5===r[1]&&(i=1),r[s+a+1+i]=n[a]}while(++a<n.length&&a+s+1+i<r.length);break}if(5===r[1]&&s+i>=2||2===r[1]&&s+i>=5)break;r[1]&&(i=1)}while(++s+t<e.length&&s+i<r.length);for(let e=2;e<r.length;++e)-1===r[e]&&(r[e]=0);switch(r[0]){case 38:n.fg=this._updateAttrColor(n.fg,r[1],r[3],r[4],r[5]);break;case 48:n.bg=this._updateAttrColor(n.bg,r[1],r[3],r[4],r[5]);break;case 58:n.extended=n.extended.clone(),n.extended.underlineColor=this._updateAttrColor(n.extended.underlineColor,r[1],r[3],r[4],r[5])}return s}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,0===e&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=u.DEFAULT_ATTR_DATA.fg,e.bg=u.DEFAULT_ATTR_DATA.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(1===e.length&&0===e.params[0])return this._processSGR0(this._curAttrData),!0;const t=e.length;let n;const r=this._curAttrData;for(let i=0;i<t;i++)n=e.params[i],n>=30&&n<=37?(r.fg&=-50331904,r.fg|=16777216|n-30):n>=40&&n<=47?(r.bg&=-50331904,r.bg|=16777216|n-40):n>=90&&n<=97?(r.fg&=-50331904,r.fg|=16777224|n-90):n>=100&&n<=107?(r.bg&=-50331904,r.bg|=16777224|n-100):0===n?this._processSGR0(r):1===n?r.fg|=134217728:3===n?r.bg|=67108864:4===n?(r.fg|=268435456,this._processUnderline(e.hasSubParams(i)?e.getSubParams(i)[0]:1,r)):5===n?r.fg|=536870912:7===n?r.fg|=67108864:8===n?r.fg|=1073741824:9===n?r.fg|=2147483648:2===n?r.bg|=134217728:21===n?this._processUnderline(2,r):22===n?(r.fg&=-134217729,r.bg&=-134217729):23===n?r.bg&=-67108865:24===n?(r.fg&=-268435457,this._processUnderline(0,r)):25===n?r.fg&=-536870913:27===n?r.fg&=-67108865:28===n?r.fg&=-1073741825:29===n?r.fg&=2147483647:39===n?(r.fg&=-67108864,r.fg|=16777215&u.DEFAULT_ATTR_DATA.fg):49===n?(r.bg&=-67108864,r.bg|=16777215&u.DEFAULT_ATTR_DATA.bg):38===n||48===n||58===n?i+=this._extractColor(e,i,r):53===n?r.bg|=1073741824:55===n?r.bg&=-1073741825:59===n?(r.extended=r.extended.clone(),r.extended.underlineColor=-1,r.updateExtended()):100===n?(r.fg&=-67108864,r.fg|=16777215&u.DEFAULT_ATTR_DATA.fg,r.bg&=-67108864,r.bg|=16777215&u.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",n);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${s.C0.ESC}[0n`);break;case 6:const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[${e};${t}R`)}return!0}deviceStatusPrivate(e){if(6===e.params[0]){const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s.C0.ESC}[?${e};${t}R`)}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=u.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){const t=e.params[0]||1;switch(t){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const n=t%2==1;return this._optionsService.options.cursorBlink=n,!0}setScrollRegion(e){const t=e.params[0]||1;let n;return(e.length<2||(n=e.params[1])>this._bufferService.rows||0===n)&&(n=this._bufferService.rows),n>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=n-1,this._setCursor(0,0)),!0}windowOptions(e){if(!S(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;const t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:2!==t&&this._onRequestWindowsOptionsReport.fire(x.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(x.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${s.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==t&&2!==t||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==t&&1!==t||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==t&&2!==t||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==t&&1!==t||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){const t=[],n=e.split(";");for(;n.length>1;){const e=n.shift(),r=n.shift();if(/^\d+$/.exec(e)){const n=parseInt(e);if(M(n))if("?"===r)t.push({type:0,index:n});else{const e=(0,b.parseColor)(r);e&&t.push({type:1,index:n,color:e})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){const t=e.split(";");return!(t.length<2)&&(t[1]?this._createHyperlink(t[0],t[1]):!t[0]&&this._finishHyperlink())}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();const n=e.split(":");let r;const i=n.findIndex(e=>e.startsWith("id="));return-1!==i&&(r=n[i].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:r,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){const n=e.split(";");for(let e=0;e<n.length&&!(t>=this._specialColors.length);++e,++t)if("?"===n[e])this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{const r=(0,b.parseColor)(n[e]);r&&this._onColor.fire([{type:1,index:this._specialColors[t],color:r}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;const t=[],n=e.split(";");for(let e=0;e<n.length;++e)if(/^\d+$/.exec(n[e])){const r=parseInt(n[e]);M(r)&&t.push({type:2,index:r})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,a.DEFAULT_CHARSET),!0}selectCharset(e){return 2!==e.length?(this.selectDefaultCharset(),!0):("/"===e[0]||this._charsetService.setgCharset(y[e[0]],a.CHARSETS[e[1]]||a.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=u.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=u.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){const e=new f.CellData;e.content=1<<22|"E".charCodeAt(0),e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){const n=this._activeBuffer.ybase+this._activeBuffer.y+t,r=this._activeBuffer.lines.get(n);r&&(r.fill(e),r.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){const n=this._bufferService.buffer,r=this._optionsService.rawOptions;return(e=>(this._coreService.triggerDataEvent(`${s.C0.ESC}${e}${s.C0.ESC}\\`),!0))('"q'===e?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===e?'P1$r61;1"p':"r"===e?`P1$r${n.scrollTop+1};${n.scrollBottom+1}r`:"m"===e?"P1$r0m":" q"===e?`P1$r${{block:2,underline:4,bar:6}[r.cursorStyle]-(r.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}}t.InputHandler=C;let A=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(E=e,e=t,t=E),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function M(e){return 0<=e&&e<256}A=r([i(0,m.IBufferService)],A)},844:(e,t)=>{function n(e){for(const t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=n,t.getDisposeArrayDisposable=function(e){return{dispose:()=>n(e)}}},1505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class n{constructor(){this._data={}}set(e,t,n){this._data[e]||(this._data[e]={}),this._data[e][t]=n}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}}t.TwoKeyMap=n,t.FourKeyMap=class{constructor(){this._data=new n}set(e,t,r,i,s){this._data.get(e,t)||this._data.set(e,t,new n),this._data.get(e,t).set(r,i,s)}get(e,t,n,r){return this._data.get(e,t)?.get(n,r)}clear(){this._data.clear()}}},6114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode="undefined"!=typeof process&&"title"in process;const n=t.isNode?"node":navigator.userAgent,r=t.isNode?"node":navigator.platform;t.isFirefox=n.includes("Firefox"),t.isLegacyEdge=n.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(n),t.getSafariVersion=function(){if(!t.isSafari)return 0;const e=n.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(r),t.isIpad="iPad"===r,t.isIphone="iPhone"===r,t.isWindows=["Windows","Win16","Win32","WinCE"].includes(r),t.isLinux=r.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(n)},6106:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let n=0;t.SortedList=class{constructor(e){this._getKey=e,this._array=[]}clear(){this._array.length=0}insert(e){0!==this._array.length?(n=this._search(this._getKey(e)),this._array.splice(n,0,e)):this._array.push(e)}delete(e){if(0===this._array.length)return!1;const t=this._getKey(e);if(void 0===t)return!1;if(n=this._search(t),-1===n)return!1;if(this._getKey(this._array[n])!==t)return!1;do{if(this._array[n]===e)return this._array.splice(n,1),!0}while(++n<this._array.length&&this._getKey(this._array[n])===t);return!1}*getKeyIterator(e){if(0!==this._array.length&&(n=this._search(e),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===e))do{yield this._array[n]}while(++n<this._array.length&&this._getKey(this._array[n])===e)}forEachByKey(e,t){if(0!==this._array.length&&(n=this._search(e),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===e))do{t(this._array[n])}while(++n<this._array.length&&this._getKey(this._array[n])===e)}values(){return[...this._array].values()}_search(e){let t=0,n=this._array.length-1;for(;n>=t;){let r=t+n>>1;const i=this._getKey(this._array[r]);if(i>e)n=r-1;else{if(!(i<e)){for(;r>0&&this._getKey(this._array[r-1])===e;)r--;return r}t=r+1}}return t}}},7226:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const r=n(6114);class i{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,n=0,r=e.timeRemaining(),i=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),n=Math.max(t,n),i=e.timeRemaining(),1.5*n>i)return r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),void this._start();r=i}this.clear()}}class s extends i{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){const t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}}t.PriorityTaskQueue=s,t.IdleTaskQueue=!r.isNode&&"requestIdleCallback"in window?class extends i{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}}:s,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}}},9282:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const r=n(643);t.updateWindowsModeWrappedState=function(e){const t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1),n=t?.get(e.cols-1),i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);i&&n&&(i.isWrapped=n[r.CHAR_DATA_CODE_INDEX]!==r.NULL_CELL_CODE&&n[r.CHAR_DATA_CODE_INDEX]!==r.WHITESPACE_CELL_CODE)}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new r}static toColorRGB(e){return[e>>>16&255,e>>>8&255,255&e]}static fromColorRGB(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}clone(){const e=new n;return e.fg=this.fg,e.bg=this.bg,e.extended=this.extended.clone(),e}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return!(50331648&~this.fg)}isBgRGB(){return!(50331648&~this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return!(50331648&this.fg)}isBgDefault(){return!(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&~this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}t.AttributeData=n;class r{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(e){this._ext&=-469762049,this._ext|=e<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(e){this._ext&=-67108864,this._ext|=67108863&e}get urlId(){return this._urlId}set urlId(e){this._urlId=e}get underlineVariantOffset(){const e=(3758096384&this._ext)>>29;return e<0?4294967288^e:e}set underlineVariantOffset(e){this._ext&=536870911,this._ext|=e<<29&3758096384}constructor(e=0,t=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=t}clone(){return new r(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}t.ExtendedAttrs=r},9092:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.MAX_BUFFER_SIZE=void 0;const r=n(6349),i=n(7226),s=n(3734),a=n(8437),o=n(4634),l=n(511),c=n(643),u=n(4863),h=n(7116);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(e,t,n){this._hasScrollback=e,this._optionsService=t,this._bufferService=n,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=a.DEFAULT_ATTR_DATA.clone(),this.savedCharset=h.DEFAULT_CHARSET,this.markers=[],this._nullCell=l.CellData.fromCharData([0,c.NULL_CELL_CHAR,c.NULL_CELL_WIDTH,c.NULL_CELL_CODE]),this._whitespaceCell=l.CellData.fromCharData([0,c.WHITESPACE_CELL_CHAR,c.WHITESPACE_CELL_WIDTH,c.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new i.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new s.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new s.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,t){return new a.BufferLine(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const n=e+this._optionsService.rawOptions.scrollback;return n>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:n}fillViewportRows(e){if(0===this.lines.length){void 0===e&&(e=a.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){const n=this.getNullCell(a.DEFAULT_ATTR_DATA);let r=0;const i=this._getCorrectBufferLength(t);if(i>this.lines.maxLength&&(this.lines.maxLength=i),this.lines.length>0){if(this._cols<e)for(let t=0;t<this.lines.length;t++)r+=+this.lines.get(t).resize(e,n);let s=0;if(this._rows<t)for(let r=this._rows;r<t;r++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new a.BufferLine(e,n)):this.ybase>0&&this.lines.length<=this.ybase+this.y+s+1?(this.ybase--,s++,this.ydisp>0&&this.ydisp--):this.lines.push(new a.BufferLine(e,n)));else for(let e=this._rows;e>t;e--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(i<this.lines.maxLength){const e=this.lines.length-i;e>0&&(this.lines.trimStart(e),this.ybase=Math.max(this.ybase-e,0),this.ydisp=Math.max(this.ydisp-e,0),this.savedY=Math.max(this.savedY-e,0)),this.lines.maxLength=i}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),s&&(this.y+=s),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let t=0;t<this.lines.length;t++)r+=+this.lines.get(t).resize(e,n);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),r>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&"conpty"===e.backend&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){const n=(0,o.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(a.DEFAULT_ATTR_DATA));if(n.length>0){const r=(0,o.reflowLargerCreateNewLayout)(this.lines,n);(0,o.reflowLargerApplyNewLayout)(this.lines,r.layout),this._reflowLargerAdjustViewport(e,t,r.countRemoved)}}_reflowLargerAdjustViewport(e,t,n){const r=this.getNullCell(a.DEFAULT_ATTR_DATA);let i=n;for(;i-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new a.BufferLine(e,r))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-n,0)}_reflowSmaller(e,t){const n=this.getNullCell(a.DEFAULT_ATTR_DATA),r=[];let i=0;for(let s=this.lines.length-1;s>=0;s--){let l=this.lines.get(s);if(!l||!l.isWrapped&&l.getTrimmedLength()<=e)continue;const c=[l];for(;l.isWrapped&&s>0;)l=this.lines.get(--s),c.unshift(l);const u=this.ybase+this.y;if(u>=s&&u<s+c.length)continue;const h=c[c.length-1].getTrimmedLength(),d=(0,o.reflowSmallerGetNewLineLengths)(c,this._cols,e),f=d.length-c.length;let p;p=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+f):Math.max(0,this.lines.length-this.lines.maxLength+f);const m=[];for(let e=0;e<f;e++){const e=this.getBlankLine(a.DEFAULT_ATTR_DATA,!0);m.push(e)}m.length>0&&(r.push({start:s+c.length+i,newLines:m}),i+=m.length),c.push(...m);let g=d.length-1,v=d[g];0===v&&(g--,v=d[g]);let _=c.length-f-1,b=h;for(;_>=0;){const e=Math.min(b,v);if(void 0===c[g])break;if(c[g].copyCellsFrom(c[_],b-e,v-e,e,!0),v-=e,0===v&&(g--,v=d[g]),b-=e,0===b){_--;const e=Math.max(_,0);b=(0,o.getWrappedLineTrimmedLength)(c,e,this._cols)}}for(let t=0;t<c.length;t++)d[t]<e&&c[t].setCell(d[t],n);let y=f-p;for(;y-- >0;)0===this.ybase?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+i)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+f,this.ybase+t-1)}if(r.length>0){const e=[],t=[];for(let e=0;e<this.lines.length;e++)t.push(this.lines.get(e));const n=this.lines.length;let s=n-1,a=0,o=r[a];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+i);let l=0;for(let c=Math.min(this.lines.maxLength-1,n+i-1);c>=0;c--)if(o&&o.start>s+l){for(let e=o.newLines.length-1;e>=0;e--)this.lines.set(c--,o.newLines[e]);c++,e.push({index:s+1,amount:o.newLines.length}),l+=o.newLines.length,o=r[++a]}else this.lines.set(c,t[s--]);let c=0;for(let t=e.length-1;t>=0;t--)e[t].index+=c,this.lines.onInsertEmitter.fire(e[t]),c+=e[t].amount;const u=Math.max(0,n+i-this.lines.maxLength);u>0&&this.lines.onTrimEmitter.fire(u)}}translateBufferLineToString(e,t,n=0,r){const i=this.lines.get(e);return i?i.translateToString(t,n,r):""}getWrappedRangeForLine(e){let t=e,n=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;n+1<this.lines.length&&this.lines.get(n+1).isWrapped;)n++;return{first:t,last:n}}setupTabStops(e){for(null!=e?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(null==e&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(null==e&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const t=new u.Marker(e);return this.markers.push(t),t.register(this.lines.onTrim(e=>{t.line-=e,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(e=>{t.line>=e.index&&(t.line+=e.amount)})),t.register(this.lines.onDelete(e=>{t.line>=e.index&&t.line<e.index+e.amount&&t.dispose(),t.line>e.index&&(t.line-=e.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const r=n(3734),i=n(511),s=n(643),a=n(482);t.DEFAULT_ATTR_DATA=Object.freeze(new r.AttributeData);let o=0;class l{constructor(e,t,n=!1){this.isWrapped=n,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const r=t||i.CellData.fromCharData([0,s.NULL_CELL_CHAR,s.NULL_CELL_WIDTH,s.NULL_CELL_CODE]);for(let t=0;t<e;++t)this.setCell(t,r);this.length=e}get(e){const t=this._data[3*e+0],n=2097151&t;return[this._data[3*e+1],2097152&t?this._combined[e]:n?(0,a.stringFromCodePoint)(n):"",t>>22,2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):n]}set(e,t){this._data[3*e+1]=t[s.CHAR_DATA_ATTR_INDEX],t[s.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=t[1],this._data[3*e+0]=2097152|e|t[s.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=t[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[s.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&t}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e]:2097151&t?(0,a.stringFromCodePoint)(2097151&t):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,t){return o=3*e,t.content=this._data[o+0],t.fg=this._data[o+1],t.bg=this._data[o+2],2097152&t.content&&(t.combinedData=this._combined[e]),268435456&t.bg&&(t.extended=this._extendedAttrs[e]),t}setCell(e,t){2097152&t.content&&(this._combined[e]=t.combinedData),268435456&t.bg&&(this._extendedAttrs[e]=t.extended),this._data[3*e+0]=t.content,this._data[3*e+1]=t.fg,this._data[3*e+2]=t.bg}setCellFromCodepoint(e,t,n,r){268435456&r.bg&&(this._extendedAttrs[e]=r.extended),this._data[3*e+0]=t|n<<22,this._data[3*e+1]=r.fg,this._data[3*e+2]=r.bg}addCodepointToCell(e,t,n){let r=this._data[3*e+0];2097152&r?this._combined[e]+=(0,a.stringFromCodePoint)(t):2097151&r?(this._combined[e]=(0,a.stringFromCodePoint)(2097151&r)+(0,a.stringFromCodePoint)(t),r&=-2097152,r|=2097152):r=t|1<<22,n&&(r&=-12582913,r|=n<<22),this._data[3*e+0]=r}insertCells(e,t,n){if((e%=this.length)&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,n),t<this.length-e){const r=new i.CellData;for(let n=this.length-e-t-1;n>=0;--n)this.setCell(e+t+n,this.loadCell(e+n,r));for(let r=0;r<t;++r)this.setCell(e+r,n)}else for(let t=e;t<this.length;++t)this.setCell(t,n);2===this.getWidth(this.length-1)&&this.setCellFromCodepoint(this.length-1,0,1,n)}deleteCells(e,t,n){if(e%=this.length,t<this.length-e){const r=new i.CellData;for(let n=0;n<this.length-e-t;++n)this.setCell(e+n,this.loadCell(e+t+n,r));for(let e=this.length-t;e<this.length;++e)this.setCell(e,n)}else for(let t=e;t<this.length;++t)this.setCell(t,n);e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,n),0!==this.getWidth(e)||this.hasContent(e)||this.setCellFromCodepoint(e,0,1,n)}replaceCells(e,t,n,r=!1){if(r)for(e&&2===this.getWidth(e-1)&&!this.isProtected(e-1)&&this.setCellFromCodepoint(e-1,0,1,n),t<this.length&&2===this.getWidth(t-1)&&!this.isProtected(t)&&this.setCellFromCodepoint(t,0,1,n);e<t&&e<this.length;)this.isProtected(e)||this.setCell(e,n),e++;else for(e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,n),t<this.length&&2===this.getWidth(t-1)&&this.setCellFromCodepoint(t,0,1,n);e<t&&e<this.length;)this.setCell(e++,n)}resize(e,t){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const n=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*n)this._data=new Uint32Array(this._data.buffer,0,n);else{const e=new Uint32Array(n);e.set(this._data),this._data=e}for(let n=this.length;n<e;++n)this.setCell(n,t)}else{this._data=this._data.subarray(0,n);const t=Object.keys(this._combined);for(let n=0;n<t.length;n++){const r=parseInt(t[n],10);r>=e&&delete this._combined[r]}const r=Object.keys(this._extendedAttrs);for(let t=0;t<r.length;t++){const n=parseInt(r[t],10);n>=e&&delete this._extendedAttrs[n]}}return this.length=e,4*n*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,t=!1){if(t)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const t in e._combined)this._combined[t]=e._combined[t];this._extendedAttrs={};for(const t in e._extendedAttrs)this._extendedAttrs[t]=e._extendedAttrs[t];this.isWrapped=e.isWrapped}clone(){const e=new l(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const t in this._combined)e._combined[t]=this._combined[t];for(const t in this._extendedAttrs)e._extendedAttrs[t]=this._extendedAttrs[t];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,t,n,r,i){const s=e._data;if(i)for(let i=r-1;i>=0;i--){for(let e=0;e<3;e++)this._data[3*(n+i)+e]=s[3*(t+i)+e];268435456&s[3*(t+i)+2]&&(this._extendedAttrs[n+i]=e._extendedAttrs[t+i])}else for(let i=0;i<r;i++){for(let e=0;e<3;e++)this._data[3*(n+i)+e]=s[3*(t+i)+e];268435456&s[3*(t+i)+2]&&(this._extendedAttrs[n+i]=e._extendedAttrs[t+i])}const a=Object.keys(e._combined);for(let r=0;r<a.length;r++){const i=parseInt(a[r],10);i>=t&&(this._combined[i-t+n]=e._combined[i])}}translateToString(e,t,n,r){t=t??0,n=n??this.length,e&&(n=Math.min(n,this.getTrimmedLength())),r&&(r.length=0);let i="";for(;t<n;){const e=this._data[3*t+0],n=2097151&e,o=2097152&e?this._combined[t]:n?(0,a.stringFromCodePoint)(n):s.WHITESPACE_CELL_CHAR;if(i+=o,r)for(let e=0;e<o.length;++e)r.push(t);t+=e>>22||1}return r&&r.push(t),i}}t.BufferLine=l},4841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}},4634:(e,t)=>{function n(e,t,n){if(t===e.length-1)return e[t].getTrimmedLength();const r=!e[t].hasContent(n-1)&&1===e[t].getWidth(n-1),i=2===e[t+1].getWidth(0);return r&&i?n-1:n}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(e,t,r,i,s){const a=[];for(let o=0;o<e.length-1;o++){let l=o,c=e.get(++l);if(!c.isWrapped)continue;const u=[e.get(o)];for(;l<e.length&&c.isWrapped;)u.push(c),c=e.get(++l);if(i>=o&&i<l){o+=u.length-1;continue}let h=0,d=n(u,h,t),f=1,p=0;for(;f<u.length;){const e=n(u,f,t),i=e-p,a=r-d,o=Math.min(i,a);u[h].copyCellsFrom(u[f],p,d,o,!1),d+=o,d===r&&(h++,d=0),p+=o,p===e&&(f++,p=0),0===d&&0!==h&&2===u[h-1].getWidth(r-1)&&(u[h].copyCellsFrom(u[h-1],r-1,d++,1,!1),u[h-1].setCell(r-1,s))}u[h].replaceCells(d,r,s);let m=0;for(let e=u.length-1;e>0&&(e>h||0===u[e].getTrimmedLength());e--)m++;m>0&&(a.push(o+u.length-m),a.push(m)),o+=u.length-1}return a},t.reflowLargerCreateNewLayout=function(e,t){const n=[];let r=0,i=t[r],s=0;for(let a=0;a<e.length;a++)if(i===a){const n=t[++r];e.onDeleteEmitter.fire({index:a-s,amount:n}),a+=n-1,s+=n,i=t[++r]}else n.push(a);return{layout:n,countRemoved:s}},t.reflowLargerApplyNewLayout=function(e,t){const n=[];for(let r=0;r<t.length;r++)n.push(e.get(t[r]));for(let t=0;t<n.length;t++)e.set(t,n[t]);e.length=t.length},t.reflowSmallerGetNewLineLengths=function(e,t,r){const i=[],s=e.map((r,i)=>n(e,i,t)).reduce((e,t)=>e+t);let a=0,o=0,l=0;for(;l<s;){if(s-l<r){i.push(s-l);break}a+=r;const c=n(e,o,t);a>c&&(a-=c,o++);const u=2===e[o].getWidth(a-1);u&&a--;const h=u?r-1:r;i.push(h),l+=h}return i},t.getWrappedLineTrimmedLength=n},5295:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const r=n(8460),i=n(844),s=n(9092);class a extends i.Disposable{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this.register(new r.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new s.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new s.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}t.BufferSet=a},511:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const r=n(482),i=n(643),s=n(3734);class a extends s.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new s.ExtendedAttrs,this.combinedData=""}static fromCharData(e){const t=new a;return t.setFromCharData(e),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,r.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[i.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(e[i.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(2===e[i.CHAR_DATA_CHAR_INDEX].length){const n=e[i.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=n&&n<=56319){const r=e[i.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=r&&r<=57343?this.content=1024*(n-55296)+r-56320+65536|e[i.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=e[i.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[i.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=e[i.CHAR_DATA_CHAR_INDEX],this.content=2097152|e[i.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=a},643:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const r=n(8460),i=n(844);class s{get id(){return this._id}constructor(e){this.line=e,this.isDisposed=!1,this._disposables=[],this._id=s._nextId++,this._onDispose=this.register(new r.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,i.disposeArray)(this._disposables),this._disposables.length=0)}register(e){return this._disposables.push(e),e}}t.Marker=s,s._nextId=1},7116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},t.CHARSETS.A={"#":"£"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},t.CHARSETS.C=t.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},t.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},t.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},t.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},t.CHARSETS.E=t.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},t.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},t.CHARSETS.H=t.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(e,t)=>{var n,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(e){e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="",e.BS="\b",e.HT="\t",e.LF="\n",e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""}(n||(t.C0=n={})),function(e){e.PAD="",e.HOP="",e.BPH="",e.NBH="",e.IND="",e.NEL="",e.SSA="",e.ESA="",e.HTS="",e.HTJ="",e.VTS="",e.PLD="",e.PLU="",e.RI="",e.SS2="",e.SS3="",e.DCS="",e.PU1="",e.PU2="",e.STS="",e.CCH="",e.MW="",e.SPA="",e.EPA="",e.SOS="",e.SGCI="",e.SCI="",e.CSI="",e.ST="",e.OSC="",e.PM="",e.APC=""}(r||(t.C1=r={})),function(e){e.ST=`${n.ESC}\\`}(i||(t.C1_ESCAPED=i={}))},7399:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const r=n(2584),i={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(e,t,n,s){const a={type:0,cancel:!1,key:void 0},o=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:"UIKeyInputUpArrow"===e.key?a.key=t?r.C0.ESC+"OA":r.C0.ESC+"[A":"UIKeyInputLeftArrow"===e.key?a.key=t?r.C0.ESC+"OD":r.C0.ESC+"[D":"UIKeyInputRightArrow"===e.key?a.key=t?r.C0.ESC+"OC":r.C0.ESC+"[C":"UIKeyInputDownArrow"===e.key&&(a.key=t?r.C0.ESC+"OB":r.C0.ESC+"[B");break;case 8:a.key=e.ctrlKey?"\b":r.C0.DEL,e.altKey&&(a.key=r.C0.ESC+a.key);break;case 9:if(e.shiftKey){a.key=r.C0.ESC+"[Z";break}a.key=r.C0.HT,a.cancel=!0;break;case 13:a.key=e.altKey?r.C0.ESC+r.C0.CR:r.C0.CR,a.cancel=!0;break;case 27:a.key=r.C0.ESC,e.altKey&&(a.key=r.C0.ESC+r.C0.ESC),a.cancel=!0;break;case 37:if(e.metaKey)break;o?(a.key=r.C0.ESC+"[1;"+(o+1)+"D",a.key===r.C0.ESC+"[1;3D"&&(a.key=r.C0.ESC+(n?"b":"[1;5D"))):a.key=t?r.C0.ESC+"OD":r.C0.ESC+"[D";break;case 39:if(e.metaKey)break;o?(a.key=r.C0.ESC+"[1;"+(o+1)+"C",a.key===r.C0.ESC+"[1;3C"&&(a.key=r.C0.ESC+(n?"f":"[1;5C"))):a.key=t?r.C0.ESC+"OC":r.C0.ESC+"[C";break;case 38:if(e.metaKey)break;o?(a.key=r.C0.ESC+"[1;"+(o+1)+"A",n||a.key!==r.C0.ESC+"[1;3A"||(a.key=r.C0.ESC+"[1;5A")):a.key=t?r.C0.ESC+"OA":r.C0.ESC+"[A";break;case 40:if(e.metaKey)break;o?(a.key=r.C0.ESC+"[1;"+(o+1)+"B",n||a.key!==r.C0.ESC+"[1;3B"||(a.key=r.C0.ESC+"[1;5B")):a.key=t?r.C0.ESC+"OB":r.C0.ESC+"[B";break;case 45:e.shiftKey||e.ctrlKey||(a.key=r.C0.ESC+"[2~");break;case 46:a.key=o?r.C0.ESC+"[3;"+(o+1)+"~":r.C0.ESC+"[3~";break;case 36:a.key=o?r.C0.ESC+"[1;"+(o+1)+"H":t?r.C0.ESC+"OH":r.C0.ESC+"[H";break;case 35:a.key=o?r.C0.ESC+"[1;"+(o+1)+"F":t?r.C0.ESC+"OF":r.C0.ESC+"[F";break;case 33:e.shiftKey?a.type=2:e.ctrlKey?a.key=r.C0.ESC+"[5;"+(o+1)+"~":a.key=r.C0.ESC+"[5~";break;case 34:e.shiftKey?a.type=3:e.ctrlKey?a.key=r.C0.ESC+"[6;"+(o+1)+"~":a.key=r.C0.ESC+"[6~";break;case 112:a.key=o?r.C0.ESC+"[1;"+(o+1)+"P":r.C0.ESC+"OP";break;case 113:a.key=o?r.C0.ESC+"[1;"+(o+1)+"Q":r.C0.ESC+"OQ";break;case 114:a.key=o?r.C0.ESC+"[1;"+(o+1)+"R":r.C0.ESC+"OR";break;case 115:a.key=o?r.C0.ESC+"[1;"+(o+1)+"S":r.C0.ESC+"OS";break;case 116:a.key=o?r.C0.ESC+"[15;"+(o+1)+"~":r.C0.ESC+"[15~";break;case 117:a.key=o?r.C0.ESC+"[17;"+(o+1)+"~":r.C0.ESC+"[17~";break;case 118:a.key=o?r.C0.ESC+"[18;"+(o+1)+"~":r.C0.ESC+"[18~";break;case 119:a.key=o?r.C0.ESC+"[19;"+(o+1)+"~":r.C0.ESC+"[19~";break;case 120:a.key=o?r.C0.ESC+"[20;"+(o+1)+"~":r.C0.ESC+"[20~";break;case 121:a.key=o?r.C0.ESC+"[21;"+(o+1)+"~":r.C0.ESC+"[21~";break;case 122:a.key=o?r.C0.ESC+"[23;"+(o+1)+"~":r.C0.ESC+"[23~";break;case 123:a.key=o?r.C0.ESC+"[24;"+(o+1)+"~":r.C0.ESC+"[24~";break;default:if(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)if(n&&!s||!e.altKey||e.metaKey)!n||e.altKey||e.ctrlKey||e.shiftKey||!e.metaKey?e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&1===e.key.length?a.key=e.key:e.key&&e.ctrlKey&&("_"===e.key&&(a.key=r.C0.US),"@"===e.key&&(a.key=r.C0.NUL)):65===e.keyCode&&(a.type=1);else{const t=i[e.keyCode],n=t?.[e.shiftKey?1:0];if(n)a.key=r.C0.ESC+n;else if(e.keyCode>=65&&e.keyCode<=90){const t=e.ctrlKey?e.keyCode-64:e.keyCode+32;let n=String.fromCharCode(t);e.shiftKey&&(n=n.toUpperCase()),a.key=r.C0.ESC+n}else if(32===e.keyCode)a.key=r.C0.ESC+(e.ctrlKey?r.C0.NUL:" ");else if("Dead"===e.key&&e.code.startsWith("Key")){let t=e.code.slice(3,4);e.shiftKey||(t=t.toLowerCase()),a.key=r.C0.ESC+t,a.cancel=!0}}else e.keyCode>=65&&e.keyCode<=90?a.key=String.fromCharCode(e.keyCode-64):32===e.keyCode?a.key=r.C0.NUL:e.keyCode>=51&&e.keyCode<=55?a.key=String.fromCharCode(e.keyCode-51+27):56===e.keyCode?a.key=r.C0.DEL:219===e.keyCode?a.key=r.C0.ESC:220===e.keyCode?a.key=r.C0.FS:221===e.keyCode&&(a.key=r.C0.GS)}return a}},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10))+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)},t.utf32ToString=function(e,t=0,n=e.length){let r="";for(let i=t;i<n;++i){let t=e[i];t>65535?(t-=65536,r+=String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):r+=String.fromCharCode(t)}return r},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){const n=e.length;if(!n)return 0;let r=0,i=0;if(this._interim){const n=e.charCodeAt(i++);56320<=n&&n<=57343?t[r++]=1024*(this._interim-55296)+n-56320+65536:(t[r++]=this._interim,t[r++]=n),this._interim=0}for(let s=i;s<n;++s){const i=e.charCodeAt(s);if(55296<=i&&i<=56319){if(++s>=n)return this._interim=i,r;const a=e.charCodeAt(s);56320<=a&&a<=57343?t[r++]=1024*(i-55296)+a-56320+65536:(t[r++]=i,t[r++]=a)}else 65279!==i&&(t[r++]=i)}return r}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){const n=e.length;if(!n)return 0;let r,i,s,a,o=0,l=0,c=0;if(this.interim[0]){let r=!1,i=this.interim[0];i&=192==(224&i)?31:224==(240&i)?15:7;let s,a=0;for(;(s=63&this.interim[++a])&&a<4;)i<<=6,i|=s;const l=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,u=l-a;for(;c<u;){if(c>=n)return 0;if(s=e[c++],128!=(192&s)){c--,r=!0;break}this.interim[a++]=s,i<<=6,i|=63&s}r||(2===l?i<128?c--:t[o++]=i:3===l?i<2048||i>=55296&&i<=57343||65279===i||(t[o++]=i):i<65536||i>1114111||(t[o++]=i)),this.interim.fill(0)}const u=n-4;let h=c;for(;h<n;){for(;!(!(h<u)||128&(r=e[h])||128&(i=e[h+1])||128&(s=e[h+2])||128&(a=e[h+3]));)t[o++]=r,t[o++]=i,t[o++]=s,t[o++]=a,h+=4;if(r=e[h++],r<128)t[o++]=r;else if(192==(224&r)){if(h>=n)return this.interim[0]=r,o;if(i=e[h++],128!=(192&i)){h--;continue}if(l=(31&r)<<6|63&i,l<128){h--;continue}t[o++]=l}else if(224==(240&r)){if(h>=n)return this.interim[0]=r,o;if(i=e[h++],128!=(192&i)){h--;continue}if(h>=n)return this.interim[0]=r,this.interim[1]=i,o;if(s=e[h++],128!=(192&s)){h--;continue}if(l=(15&r)<<12|(63&i)<<6|63&s,l<2048||l>=55296&&l<=57343||65279===l)continue;t[o++]=l}else if(240==(248&r)){if(h>=n)return this.interim[0]=r,o;if(i=e[h++],128!=(192&i)){h--;continue}if(h>=n)return this.interim[0]=r,this.interim[1]=i,o;if(s=e[h++],128!=(192&s)){h--;continue}if(h>=n)return this.interim[0]=r,this.interim[1]=i,this.interim[2]=s,o;if(a=e[h++],128!=(192&a)){h--;continue}if(l=(7&r)<<18|(63&i)<<12|(63&s)<<6|63&a,l<65536||l>1114111)continue;t[o++]=l}}return o}}},225:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const r=n(1480),i=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],s=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let a;t.UnicodeV6=class{constructor(){if(this.version="6",!a){a=new Uint8Array(65536),a.fill(1),a[0]=0,a.fill(0,1,32),a.fill(0,127,160),a.fill(2,4352,4448),a[9001]=2,a[9002]=2,a.fill(2,11904,42192),a[12351]=1,a.fill(2,44032,55204),a.fill(2,63744,64256),a.fill(2,65040,65050),a.fill(2,65072,65136),a.fill(2,65280,65377),a.fill(2,65504,65511);for(let e=0;e<i.length;++e)a.fill(0,i[e][0],i[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?a[e]:function(e,t){let n,r=0,i=t.length-1;if(e<t[0][0]||e>t[i][1])return!1;for(;i>=r;)if(n=r+i>>1,e>t[n][1])r=n+1;else{if(!(e<t[n][0]))return!0;i=n-1}return!1}(e,s)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let n=this.wcwidth(e),i=0===n&&0!==t;if(i){const e=r.UnicodeService.extractWidth(t);0===e?i=!1:e>n&&(n=e)}return r.UnicodeService.createPropertyValue(0,n,i)}}},5981:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const r=n(8460),i=n(844);class s extends i.Disposable{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new r.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(void 0!==t&&this._syncCalls>t)return void(this._syncCalls=0);if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let n;for(this._isSyncWriting=!0;n=this._writeBuffer.shift();){this._action(n);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){const n=e||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],r=this._action(e,t);if(r){const e=e=>Date.now()-n>=12?setTimeout(()=>this._innerWrite(0,e)):this._innerWrite(n,e);return void r.catch(e=>(queueMicrotask(()=>{throw e}),Promise.resolve(!1))).then(e)}const i=this._callbacks[this._bufferOffset];if(i&&i(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-n>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=s},5941:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const n=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,r=/^[\da-f]+$/;function i(e,t){const n=e.toString(16),r=n.length<2?"0"+n:n;switch(t){case 4:return n[0];case 8:return r;case 12:return(r+r).slice(0,3);default:return r+r}}t.parseColor=function(e){if(!e)return;let t=e.toLowerCase();if(0===t.indexOf("rgb:")){t=t.slice(4);const e=n.exec(t);if(e){const t=e[1]?15:e[4]?255:e[7]?4095:65535;return[Math.round(parseInt(e[1]||e[4]||e[7]||e[10],16)/t*255),Math.round(parseInt(e[2]||e[5]||e[8]||e[11],16)/t*255),Math.round(parseInt(e[3]||e[6]||e[9]||e[12],16)/t*255)]}}else if(0===t.indexOf("#")&&(t=t.slice(1),r.exec(t)&&[3,6,9,12].includes(t.length))){const e=t.length/3,n=[0,0,0];for(let r=0;r<3;++r){const i=parseInt(t.slice(e*r,e*r+e),16);n[r]=1===e?i<<4:2===e?i:3===e?i>>4:i>>8}return n}},t.toRgbString=function(e,t=16){const[n,r,s]=e;return`rgb:${i(n,t)}/${i(r,t)}/${i(s,t)}`}},5770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const r=n(482),i=n(8742),s=n(5770),a=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=a,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=a}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const n=this._handlers[e];return n.push(t),{dispose:()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=a,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||a,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(t);else this._handlerFb(this._ident,"HOOK",t)}put(e,t,n){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,n);else this._handlerFb(this._ident,"PUT",(0,r.utf32ToString)(e,t,n))}unhook(e,t=!0){if(this._active.length){let n=!1,r=this._active.length-1,i=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,n=t,i=this._stack.fallThrough,this._stack.paused=!1),!i&&!1===n){for(;r>=0&&(n=this._active[r].unhook(e),!0!==n);r--)if(n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,n;r--}for(;r>=0;r--)if(n=this._active[r].unhook(!1),n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,n}else this._handlerFb(this._ident,"UNHOOK",e);this._active=a,this._ident=0}};const o=new i.Params;o.addParam(0),t.DcsHandler=class{constructor(e){this._handler=e,this._data="",this._params=o,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():o,this._data="",this._hitLimit=!1}put(e,t,n){this._hitLimit||(this._data+=(0,r.utf32ToString)(e,t,n),this._data.length>s.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(e=>(this._params=o,this._data="",this._hitLimit=!1,e));return this._params=o,this._data="",this._hitLimit=!1,t}}},2015:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const r=n(844),i=n(8742),s=n(6242),a=n(6351);class o{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,n,r){this.table[t<<8|e]=n<<4|r}addMany(e,t,n,r){for(let i=0;i<e.length;i++)this.table[t<<8|e[i]]=n<<4|r}}t.TransitionTable=o;const l=160;t.VT500_TRANSITION_TABLE=function(){const e=new o(4095),t=Array.apply(null,Array(256)).map((e,t)=>t),n=(e,n)=>t.slice(e,n),r=n(32,127),i=n(0,24);i.push(25),i.push.apply(i,n(28,32));const s=n(0,14);let a;for(a in e.setDefault(1,0),e.addMany(r,0,2,0),s)e.addMany([24,26,153,154],a,3,0),e.addMany(n(128,144),a,3,0),e.addMany(n(144,152),a,3,0),e.add(156,a,0,0),e.add(27,a,11,1),e.add(157,a,4,8),e.addMany([152,158,159],a,0,7),e.add(155,a,11,3),e.add(144,a,11,9);return e.addMany(i,0,3,0),e.addMany(i,1,3,1),e.add(127,1,0,1),e.addMany(i,8,0,8),e.addMany(i,3,3,3),e.add(127,3,0,3),e.addMany(i,4,3,4),e.add(127,4,0,4),e.addMany(i,6,3,6),e.addMany(i,5,3,5),e.add(127,5,0,5),e.addMany(i,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(r,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(n(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(r,7,0,7),e.addMany(i,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(n(64,127),3,7,0),e.addMany(n(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(n(48,60),4,8,4),e.addMany(n(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(n(32,64),6,0,6),e.add(127,6,0,6),e.addMany(n(64,127),6,0,0),e.addMany(n(32,48),3,9,5),e.addMany(n(32,48),5,9,5),e.addMany(n(48,64),5,0,6),e.addMany(n(64,127),5,7,0),e.addMany(n(32,48),4,9,5),e.addMany(n(32,48),1,9,2),e.addMany(n(32,48),2,9,2),e.addMany(n(48,127),2,10,0),e.addMany(n(48,80),1,10,0),e.addMany(n(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(n(96,127),1,10,0),e.add(80,1,11,9),e.addMany(i,9,0,9),e.add(127,9,0,9),e.addMany(n(28,32),9,0,9),e.addMany(n(32,48),9,9,12),e.addMany(n(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(i,11,0,11),e.addMany(n(32,128),11,0,11),e.addMany(n(28,32),11,0,11),e.addMany(i,10,0,10),e.add(127,10,0,10),e.addMany(n(28,32),10,0,10),e.addMany(n(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(n(32,48),10,9,12),e.addMany(i,12,0,12),e.add(127,12,0,12),e.addMany(n(28,32),12,0,12),e.addMany(n(32,48),12,9,12),e.addMany(n(48,64),12,0,11),e.addMany(n(64,127),12,12,13),e.addMany(n(64,127),10,12,13),e.addMany(n(64,127),9,12,13),e.addMany(i,13,13,13),e.addMany(r,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(l,0,2,0),e.add(l,8,5,8),e.add(l,6,0,6),e.add(l,11,0,11),e.add(l,13,13,13),e}();class c extends r.Disposable{constructor(e=t.VT500_TRANSITION_TABLE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new i.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,t,n)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,t)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,r.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new s.OscParser),this._dcsParser=this.register(new a.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let n=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(n=e.prefix.charCodeAt(0),n&&60>n||n>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let t=0;t<e.intermediates.length;++t){const r=e.intermediates.charCodeAt(t);if(32>r||r>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");n<<=8,n|=r}}if(1!==e.final.length)throw new Error("final must be a single byte");const r=e.final.charCodeAt(0);if(t[0]>r||r>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return n<<=8,n|=r,n}identToString(e){const t=[];for(;e;)t.push(String.fromCharCode(255&e)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){const n=this._identifier(e,[48,126]);void 0===this._escHandlers[n]&&(this._escHandlers[n]=[]);const r=this._escHandlers[n];return r.push(t),{dispose:()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){const n=this._identifier(e);void 0===this._csiHandlers[n]&&(this._csiHandlers[n]=[]);const r=this._csiHandlers[n];return r.push(t),{dispose:()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,n,r,i){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=n,this._parseStack.transition=r,this._parseStack.chunkPos=i}parse(e,t,n){let r,i=0,s=0,a=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,a=this._parseStack.chunkPos+1;else{if(void 0===n||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const t=this._parseStack.handlers;let s=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===n&&s>-1)for(;s>=0&&(r=t[s](this._params),!0!==r);s--)if(r instanceof Promise)return this._parseStack.handlerPos=s,r;this._parseStack.handlers=[];break;case 4:if(!1===n&&s>-1)for(;s>=0&&(r=t[s](),!0!==r);s--)if(r instanceof Promise)return this._parseStack.handlerPos=s,r;this._parseStack.handlers=[];break;case 6:if(i=e[this._parseStack.chunkPos],r=this._dcsParser.unhook(24!==i&&26!==i,n),r)return r;27===i&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(i=e[this._parseStack.chunkPos],r=this._oscParser.end(24!==i&&26!==i,n),r)return r;27===i&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,a=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let n=a;n<t;++n){switch(i=e[n],s=this._transitions.table[this.currentState<<8|(i<160?i:l)],s>>4){case 2:for(let r=n+1;;++r){if(r>=t||(i=e[r])<32||i>126&&i<l){this._printHandler(e,n,r),n=r-1;break}if(++r>=t||(i=e[r])<32||i>126&&i<l){this._printHandler(e,n,r),n=r-1;break}if(++r>=t||(i=e[r])<32||i>126&&i<l){this._printHandler(e,n,r),n=r-1;break}if(++r>=t||(i=e[r])<32||i>126&&i<l){this._printHandler(e,n,r),n=r-1;break}}break;case 3:this._executeHandlers[i]?this._executeHandlers[i]():this._executeHandlerFb(i),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:n,code:i,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const a=this._csiHandlers[this._collect<<8|i];let o=a?a.length-1:-1;for(;o>=0&&(r=a[o](this._params),!0!==r);o--)if(r instanceof Promise)return this._preserveStack(3,a,o,s,n),r;o<0&&this._csiHandlerFb(this._collect<<8|i,this._params),this.precedingJoinState=0;break;case 8:do{switch(i){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(i-48)}}while(++n<t&&(i=e[n])>47&&i<60);n--;break;case 9:this._collect<<=8,this._collect|=i;break;case 10:const c=this._escHandlers[this._collect<<8|i];let u=c?c.length-1:-1;for(;u>=0&&(r=c[u](),!0!==r);u--)if(r instanceof Promise)return this._preserveStack(4,c,u,s,n),r;u<0&&this._escHandlerFb(this._collect<<8|i),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|i,this._params);break;case 13:for(let r=n+1;;++r)if(r>=t||24===(i=e[r])||26===i||27===i||i>127&&i<l){this._dcsParser.put(e,n,r),n=r-1;break}break;case 14:if(r=this._dcsParser.unhook(24!==i&&26!==i),r)return this._preserveStack(6,[],0,s,n),r;27===i&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let r=n+1;;r++)if(r>=t||(i=e[r])<32||i>127&&i<l){this._oscParser.put(e,n,r),n=r-1;break}break;case 6:if(r=this._oscParser.end(24!==i&&26!==i),r)return this._preserveStack(5,[],0,s,n),r;27===i&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&s}}}t.EscapeSequenceParser=c},6242:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const r=n(5770),i=n(482),s=[];t.OscParser=class{constructor(){this._state=0,this._active=s,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const n=this._handlers[e];return n.push(t),{dispose:()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=s}reset(){if(2===this._state)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=s,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||s,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].start();else this._handlerFb(this._id,"START")}_put(e,t,n){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,n);else this._handlerFb(this._id,"PUT",(0,i.utf32ToString)(e,t,n))}start(){this.reset(),this._state=1}put(e,t,n){if(3!==this._state){if(1===this._state)for(;t<n;){const n=e[t++];if(59===n){this._state=2,this._start();break}if(n<48||57<n)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+n-48}2===this._state&&n-t>0&&this._put(e,t,n)}}end(e,t=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let n=!1,r=this._active.length-1,i=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,n=t,i=this._stack.fallThrough,this._stack.paused=!1),!i&&!1===n){for(;r>=0&&(n=this._active[r].end(e),!0!==n);r--)if(n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,n;r--}for(;r>=0;r--)if(n=this._active[r].end(!1),n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,n}else this._handlerFb(this._id,"END",e);this._active=s,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,n){this._hitLimit||(this._data+=(0,i.utf32ToString)(e,t,n),this._data.length>r.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(e=>(this._data="",this._hitLimit=!1,e));return this._data="",this._hitLimit=!1,t}}},8742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const n=2147483647;class r{static fromArray(e){const t=new r;if(!e.length)return t;for(let n=Array.isArray(e[0])?1:0;n<e.length;++n){const r=e[n];if(Array.isArray(r))for(let e=0;e<r.length;++e)t.addSubParam(r[e]);else t.addParam(r)}return t}constructor(e=32,t=32){if(this.maxLength=e,this.maxSubParamsLength=t,t>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(e),this.length=0,this._subParams=new Int32Array(t),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(e),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const e=new r(this.maxLength,this.maxSubParamsLength);return e.params.set(this.params),e.length=this.length,e._subParams.set(this._subParams),e._subParamsLength=this._subParamsLength,e._subParamsIdx.set(this._subParamsIdx),e._rejectDigits=this._rejectDigits,e._rejectSubDigits=this._rejectSubDigits,e._digitIsSub=this._digitIsSub,e}toArray(){const e=[];for(let t=0;t<this.length;++t){e.push(this.params[t]);const n=this._subParamsIdx[t]>>8,r=255&this._subParamsIdx[t];r-n>0&&e.push(Array.prototype.slice.call(this._subParams,n,r))}return e}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(e){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>n?n:e}}addSubParam(e){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>n?n:e,this._subParamsIdx[this.length-1]++}}hasSubParams(e){return(255&this._subParamsIdx[e])-(this._subParamsIdx[e]>>8)>0}getSubParams(e){const t=this._subParamsIdx[e]>>8,n=255&this._subParamsIdx[e];return n-t>0?this._subParams.subarray(t,n):null}getSubParamsAll(){const e={};for(let t=0;t<this.length;++t){const n=this._subParamsIdx[t]>>8,r=255&this._subParamsIdx[t];r-n>0&&(e[t]=this._subParams.slice(n,r))}return e}addDigit(e){let t;if(this._rejectDigits||!(t=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const r=this._digitIsSub?this._subParams:this.params,i=r[t-1];r[t-1]=~i?Math.min(10*i+e,n):e}}t.Params=r},5741:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){const n={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(n),t.dispose=()=>this._wrappedAddonDispose(n),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let n=0;n<this._addons.length;n++)if(this._addons[n]===e){t=n;break}if(-1===t)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}}},8771:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const r=n(3785),i=n(511);t.BufferApiView=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){const t=this._buffer.lines.get(e);if(t)return new r.BufferLineApiView(t)}getNullCell(){return new i.CellData}}},3785:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const r=n(511);t.BufferLineApiView=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new r.CellData)}translateToString(e,t,n){return this._line.translateToString(e,t,n)}}},8285:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const r=n(8771),i=n(8460),s=n(844);class a extends s.Disposable{constructor(e){super(),this._core=e,this._onBufferChange=this.register(new i.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new r.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new r.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}t.BufferNamespaceApi=a},7975:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,e=>t(e.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(e,n)=>t(e,n.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}}},7090:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}}},744:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const s=n(8460),a=n(844),o=n(5295),l=n(2585);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let c=t.BufferService=class extends a.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new s.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new o.BufferSet(e,this))}resize(e,t){this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){const n=this.buffer;let r;r=this._cachedBlankLine,r&&r.length===this.cols&&r.getFg(0)===e.fg&&r.getBg(0)===e.bg||(r=n.getBlankLine(e,t),this._cachedBlankLine=r),r.isWrapped=t;const i=n.ybase+n.scrollTop,s=n.ybase+n.scrollBottom;if(0===n.scrollTop){const e=n.lines.isFull;s===n.lines.length-1?e?n.lines.recycle().copyFrom(r):n.lines.push(r.clone()):n.lines.splice(s+1,0,r.clone()),e?this.isUserScrolling&&(n.ydisp=Math.max(n.ydisp-1,0)):(n.ybase++,this.isUserScrolling||n.ydisp++)}else{const e=s-i+1;n.lines.shiftElements(i+1,e-1,-1),n.lines.set(s,r.clone())}this.isUserScrolling||(n.ydisp=n.ybase),this._onScroll.fire(n.ydisp)}scrollLines(e,t,n){const r=this.buffer;if(e<0){if(0===r.ydisp)return;this.isUserScrolling=!0}else e+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);const i=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+e,r.ybase),0),i!==r.ydisp&&(t||this._onScroll.fire(r.ydisp))}};t.BufferService=c=r([i(0,l.IOptionsService)],c)},7994:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}}},1753:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const s=n(2585),a=n(8460),o=n(844),l={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>4!==e.button&&1===e.action&&(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>32!==e.action},DRAG:{events:23,restrict:e=>32!==e.action||3!==e.button},ANY:{events:31,restrict:e=>!0}};function c(e,t){let n=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return 4===e.button?(n|=64,n|=e.action):(n|=3&e.button,4&e.button&&(n|=64),8&e.button&&(n|=128),32===e.action?n|=32:0!==e.action||t||(n|=3)),n}const u=String.fromCharCode,h={DEFAULT:e=>{const t=[c(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`[M${u(t[0])}${u(t[1])}${u(t[2])}`},SGR:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.x};${e.y}${t}`}};let d=t.CoreMouseService=class extends o.Disposable{constructor(e,t){super(),this._bufferService=e,this._coreService=t,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new a.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const e of Object.keys(l))this.addProtocol(e,l[e]);for(const e of Object.keys(h))this.addEncoding(e,h[e]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows)return!1;if(4===e.button&&32===e.action)return!1;if(3===e.button&&32!==e.action)return!1;if(4!==e.button&&(2===e.action||3===e.action))return!1;if(e.col++,e.row++,32===e.action&&this._lastEvent&&this._equalEvents(this._lastEvent,e,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(e))return!1;const t=this._encodings[this._activeEncoding](e);return t&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(1&e),up:!!(2&e),drag:!!(4&e),move:!!(8&e),wheel:!!(16&e)}}_equalEvents(e,t,n){if(n){if(e.x!==t.x)return!1;if(e.y!==t.y)return!1}else{if(e.col!==t.col)return!1;if(e.row!==t.row)return!1}return e.button===t.button&&e.action===t.action&&e.ctrl===t.ctrl&&e.alt===t.alt&&e.shift===t.shift}};t.CoreMouseService=d=r([i(0,s.IBufferService),i(1,s.ICoreService)],d)},6975:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const s=n(1439),a=n(8460),o=n(844),l=n(2585),c=Object.freeze({insertMode:!1}),u=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let h=t.CoreService=class extends o.Disposable{constructor(e,t,n){super(),this._bufferService=e,this._logService=t,this._optionsService=n,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new a.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new a.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new a.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new a.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,s.clone)(c),this.decPrivateModes=(0,s.clone)(u)}reset(){this.modes=(0,s.clone)(c),this.decPrivateModes=(0,s.clone)(u)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;const n=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&n.ybase!==n.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,()=>e.split("").map(e=>e.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,()=>e.split("").map(e=>e.charCodeAt(0))),this._onBinary.fire(e))}};t.CoreService=h=r([i(0,l.IBufferService),i(1,l.ILogService),i(2,l.IOptionsService)],h)},9074:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const r=n(8055),i=n(8460),s=n(844),a=n(6106);let o=0,l=0;class c extends s.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new a.SortedList(e=>e?.marker.line),this._onDecorationRegistered=this.register(new i.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new i.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,s.toDisposable)(()=>this.reset()))}registerDecoration(e){if(e.marker.isDisposed)return;const t=new u(e);if(t){const e=t.marker.onDispose(()=>t.dispose());t.onDispose(()=>{t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),e.dispose())}),this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,n){let r=0,i=0;for(const s of this._decorations.getKeyIterator(t))r=s.options.x??0,i=r+(s.options.width??1),e>=r&&e<i&&(!n||(s.options.layer??"bottom")===n)&&(yield s)}forEachDecorationAtCell(e,t,n,r){this._decorations.forEachByKey(t,t=>{o=t.options.x??0,l=o+(t.options.width??1),e>=o&&e<l&&(!n||(t.options.layer??"bottom")===n)&&r(t)})}}t.DecorationService=c;class u extends s.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=r.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=r.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new i.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new i.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const r=n(2585),i=n(8343);class s{constructor(...e){this._entries=new Map;for(const[t,n]of e)this.set(t,n)}set(e,t){const n=this._entries.get(e);return this._entries.set(e,t),n}forEach(e){for(const[t,n]of this._entries.entries())e(t,n)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}}t.ServiceCollection=s,t.InstantiationService=class{constructor(){this._services=new s,this._services.set(r.IInstantiationService,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){const n=(0,i.getServiceDependencies)(e).sort((e,t)=>e.index-t.index),r=[];for(const t of n){const n=this._services.get(t.id);if(!n)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${t.id}.`);r.push(n)}const s=n.length>0?n[0].index:t.length;if(t.length!==s)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${s+1} conflicts with ${t.length} static arguments`);return new e(...[...t,...r])}}},7866:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;const s=n(844),a=n(2585),o={trace:a.LogLevelEnum.TRACE,debug:a.LogLevelEnum.DEBUG,info:a.LogLevelEnum.INFO,warn:a.LogLevelEnum.WARN,error:a.LogLevelEnum.ERROR,off:a.LogLevelEnum.OFF};let l,c=t.LogService=class extends s.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=a.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),l=this}_updateLogLevel(){this._logLevel=o[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)"function"==typeof e[t]&&(e[t]=e[t]())}_log(e,t,n){this._evalLazyOptionalParams(n),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+t,...n)}trace(e,...t){this._logLevel<=a.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=a.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=a.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=a.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=a.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};t.LogService=c=r([i(0,a.IOptionsService)],c),t.setTraceLogger=function(e){l=e},t.traceCall=function(e,t,n){if("function"!=typeof n.value)throw new Error("not supported");const r=n.value;n.value=function(...e){if(l.logLevel!==a.LogLevelEnum.TRACE)return r.apply(this,e);l.trace(`GlyphRenderer#${r.name}(${e.map(e=>JSON.stringify(e)).join(", ")})`);const t=r.apply(this,e);return l.trace(`GlyphRenderer#${r.name} return`,t),t}}},7302:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const r=n(8460),i=n(844),s=n(6114);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:s.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const a=["normal","bold","100","200","300","400","500","600","700","800","900"];class o extends i.Disposable{constructor(e){super(),this._onOptionChange=this.register(new r.EventEmitter),this.onOptionChange=this._onOptionChange.event;const n={...t.DEFAULT_OPTIONS};for(const t in e)if(t in n)try{const r=e[t];n[t]=this._sanitizeAndValidateOption(t,r)}catch(e){console.error(e)}this.rawOptions=n,this.options={...n},this._setupOptions(),this.register((0,i.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,t){return this.onOptionChange(n=>{n===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(n=>{-1!==e.indexOf(n)&&t()})}_setupOptions(){const e=e=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);return this.rawOptions[e]},n=(e,n)=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);n=this._sanitizeAndValidateOption(e,n),this.rawOptions[e]!==n&&(this.rawOptions[e]=n,this._onOptionChange.fire(e))};for(const t in this.rawOptions){const r={get:e.bind(this,t),set:n.bind(this,t)};Object.defineProperty(this.options,t,r)}}_sanitizeAndValidateOption(e,n){switch(e){case"cursorStyle":if(n||(n=t.DEFAULT_OPTIONS[e]),!function(e){return"block"===e||"underline"===e||"bar"===e}(n))throw new Error(`"${n}" is not a valid value for ${e}`);break;case"wordSeparator":n||(n=t.DEFAULT_OPTIONS[e]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof n&&1<=n&&n<=1e3)break;n=a.includes(n)?n:t.DEFAULT_OPTIONS[e];break;case"cursorWidth":n=Math.floor(n);case"lineHeight":case"tabStopWidth":if(n<1)throw new Error(`${e} cannot be less than 1, value: ${n}`);break;case"minimumContrastRatio":n=Math.max(1,Math.min(21,Math.round(10*n)/10));break;case"scrollback":if((n=Math.min(n,4294967295))<0)throw new Error(`${e} cannot be less than 0, value: ${n}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(n<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${n}`);break;case"rows":case"cols":if(!n&&0!==n)throw new Error(`${e} must be numeric, value: ${n}`);break;case"windowsPty":n=n??{}}return n}}t.OptionsService=o},2660:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const s=n(2585);let a=t.OscLinkService=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){const t=this._bufferService.buffer;if(void 0===e.id){const n=t.addMarker(t.ybase+t.y),r={data:e,id:this._nextId++,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(r,n)),this._dataByLinkId.set(r.id,r),r.id}const n=e,r=this._getEntryIdKey(n),i=this._entriesWithId.get(r);if(i)return this.addLineToLink(i.id,t.ybase+t.y),i.id;const s=t.addMarker(t.ybase+t.y),a={id:this._nextId++,key:this._getEntryIdKey(n),data:n,lines:[s]};return s.onDispose(()=>this._removeMarkerFromLink(a,s)),this._entriesWithId.set(a.key,a),this._dataByLinkId.set(a.id,a),a.id}addLineToLink(e,t){const n=this._dataByLinkId.get(e);if(n&&n.lines.every(e=>e.line!==t)){const e=this._bufferService.buffer.addMarker(t);n.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(n,e))}}getLinkData(e){return this._dataByLinkId.get(e)?.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){const n=e.lines.indexOf(t);-1!==n&&(e.lines.splice(n,1),0===e.lines.length&&(void 0!==e.data.id&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};t.OscLinkService=a=r([i(0,s.IBufferService)],a)},8343:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;const n="di$target",r="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(e){return e[r]||[]},t.createDecorator=function(e){if(t.serviceRegistry.has(e))return t.serviceRegistry.get(e);const i=function(e,t,s){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");!function(e,t,i){t[n]===t?t[r].push({id:e,index:i}):(t[r]=[{id:e,index:i}],t[n]=t)}(i,e,s)};return i.toString=()=>e,t.serviceRegistry.set(e,i),i}},2585:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const r=n(8343);var i;t.IBufferService=(0,r.createDecorator)("BufferService"),t.ICoreMouseService=(0,r.createDecorator)("CoreMouseService"),t.ICoreService=(0,r.createDecorator)("CoreService"),t.ICharsetService=(0,r.createDecorator)("CharsetService"),t.IInstantiationService=(0,r.createDecorator)("InstantiationService"),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.OFF=5]="OFF"}(i||(t.LogLevelEnum=i={})),t.ILogService=(0,r.createDecorator)("LogService"),t.IOptionsService=(0,r.createDecorator)("OptionsService"),t.IOscLinkService=(0,r.createDecorator)("OscLinkService"),t.IUnicodeService=(0,r.createDecorator)("UnicodeService"),t.IDecorationService=(0,r.createDecorator)("DecorationService")},1480:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const r=n(8460),i=n(225);class s{static extractShouldJoin(e){return!!(1&e)}static extractWidth(e){return e>>1&3}static extractCharKind(e){return e>>3}static createPropertyValue(e,t,n=!1){return(16777215&e)<<3|(3&t)<<1|(n?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new r.EventEmitter,this.onChange=this._onChange.event;const e=new i.UnicodeV6;this.register(e),this._active=e.version,this._activeProvider=e}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw new Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(e){let t=0,n=0;const r=e.length;for(let i=0;i<r;++i){let a=e.charCodeAt(i);if(55296<=a&&a<=56319){if(++i>=r)return t+this.wcwidth(a);const n=e.charCodeAt(i);56320<=n&&n<=57343?a=1024*(a-55296)+n-56320+65536:t+=this.wcwidth(n)}const o=this.charProperties(a,n);let l=s.extractWidth(o);s.extractShouldJoin(o)&&(l-=s.extractWidth(n)),t+=l,n=o}return t}charProperties(e,t){return this._activeProvider.charProperties(e,t)}}t.UnicodeService=s}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;const t=n(9042),i=n(3236),s=n(844),a=n(5741),o=n(8285),l=n(7975),c=n(7090),u=["cols","rows"];class h extends s.Disposable{constructor(e){super(),this._core=this.register(new i.Terminal(e)),this._addonManager=this.register(new a.AddonManager),this._publicOptions={...this._core.options};const t=e=>this._core.options[e],n=(e,t)=>{this._checkReadonlyOptions(e),this._core.options[e]=t};for(const e in this._core.options){const r={get:t.bind(this,e),set:n.bind(this,e)};Object.defineProperty(this._publicOptions,e,r)}}_checkReadonlyOptions(e){if(u.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new c.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new o.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const e=this._core.coreService.decPrivateModes;let t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(const t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,n){this._verifyIntegers(e,t,n),this._core.select(e,t,n)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write("\r\n",t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return t}_verifyIntegers(...e){for(const t of e)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(const t of e)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}e.Terminal=h})(),r})(),e.exports=t()}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";const t=globalThis,n=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),s=new WeakMap;class a{constructor(e,t,n){if(this._$cssResult$=!0,n!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(n&&void 0===e){const n=void 0!==t&&1===t.length;n&&(e=s.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&s.set(t,e))}return e}toString(){return this.cssText}}const o=(e,...t)=>{const n=1===e.length?e[0]:t.reduce((t,n,r)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+e[r+1],e[0]);return new a(n,e,i)},l=(e,r)=>{if(n)e.adoptedStyleSheets=r.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const n of r){const r=document.createElement("style"),i=t.litNonce;void 0!==i&&r.setAttribute("nonce",i),r.textContent=n.cssText,e.appendChild(r)}},c=n?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new a("string"==typeof e?e:e+"",void 0,i))(t)})(e):e,{is:u,defineProperty:h,getOwnPropertyDescriptor:d,getOwnPropertyNames:f,getOwnPropertySymbols:p,getPrototypeOf:m}=Object,g=globalThis,v=g.trustedTypes,_=v?v.emptyScript:"",b=g.reactiveElementPolyfillSupport,y=(e,t)=>e,w={toAttribute(e,t){switch(t){case Boolean:e=e?_:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},S=(e,t)=>!u(e,t),x={attribute:!0,type:String,converter:w,reflect:!1,useDefault:!1,hasChanged:S};Symbol.metadata??=Symbol("metadata"),g.litPropertyMetadata??=new WeakMap;class E extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=x){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),r=this.getPropertyDescriptor(e,n,t);void 0!==r&&h(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){const{get:r,set:i}=d(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:r,set(t){const s=r?.call(this);i?.call(this,t),this.requestUpdate(e,s,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??x}static _$Ei(){if(this.hasOwnProperty(y("elementProperties")))return;const e=m(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(y("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(y("properties"))){const e=this.properties,t=[...f(e),...p(e)];for(const n of t)this.createProperty(n,e[n])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,n]of t)this.elementProperties.set(e,n)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const n=this._$Eu(e,t);void 0!==n&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(c(e))}else void 0!==e&&t.push(c(e));return t}static _$Eu(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return l(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$ET(e,t){const n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(void 0!==r&&!0===n.reflect){const i=(void 0!==n.converter?.toAttribute?n.converter:w).toAttribute(t,n.type);this._$Em=e,null==i?this.removeAttribute(r):this.setAttribute(r,i),this._$Em=null}}_$AK(e,t){const n=this.constructor,r=n._$Eh.get(e);if(void 0!==r&&this._$Em!==r){const e=n.getPropertyOptions(r),i="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:w;this._$Em=r;const s=i.fromAttribute(t,e.type);this[r]=s??this._$Ej?.get(r)??s,this._$Em=null}}requestUpdate(e,t,n){if(void 0!==e){const r=this.constructor,i=this[e];if(n??=r.getPropertyOptions(e),!((n.hasChanged??S)(i,t)||n.useDefault&&n.reflect&&i===this._$Ej?.get(e)&&!this.hasAttribute(r._$Eu(e,n))))return;this.C(e,t,n)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:n,reflect:r,wrapped:i},s){n&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,s??t??this[e]),!0!==i||void 0!==s)||(this._$AL.has(e)||(this.hasUpdated||n||(t=void 0),this._$AL.set(e,t)),!0===r&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,n]of e){const{wrapped:e}=n,r=this[t];!0!==e||this._$AL.has(t)||void 0===r||this.C(t,void 0,n,r)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}}E.elementStyles=[],E.shadowRootOptions={mode:"open"},E[y("elementProperties")]=new Map,E[y("finalized")]=new Map,b?.({ReactiveElement:E}),(g.reactiveElementVersions??=[]).push("2.1.1");const C=globalThis,A=C.trustedTypes,M=A?A.createPolicy("lit-html",{createHTML:e=>e}):void 0,k="$lit$",T=`lit$${Math.random().toFixed(9).slice(2)}$`,R="?"+T,P=`<${R}>`,I=document,D=()=>I.createComment(""),O=e=>null===e||"object"!=typeof e&&"function"!=typeof e,L=Array.isArray,B="[ \t\n\f\r]",N=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,U=/-->/g,H=/>/g,F=RegExp(`>|${B}(?:([^\\s"'>=/]+)(${B}*=${B}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),j=/'/g,z=/"/g,V=/^(?:script|style|textarea|title)$/i,G=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),W=G(1),q=(G(2),G(3),Symbol.for("lit-noChange")),K=Symbol.for("lit-nothing"),$=new WeakMap,X=I.createTreeWalker(I,129);function Y(e,t){if(!L(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==M?M.createHTML(t):t}const Z=(e,t)=>{const n=e.length-1,r=[];let i,s=2===t?"<svg>":3===t?"<math>":"",a=N;for(let t=0;t<n;t++){const n=e[t];let o,l,c=-1,u=0;for(;u<n.length&&(a.lastIndex=u,l=a.exec(n),null!==l);)u=a.lastIndex,a===N?"!--"===l[1]?a=U:void 0!==l[1]?a=H:void 0!==l[2]?(V.test(l[2])&&(i=RegExp("</"+l[2],"g")),a=F):void 0!==l[3]&&(a=F):a===F?">"===l[0]?(a=i??N,c=-1):void 0===l[1]?c=-2:(c=a.lastIndex-l[2].length,o=l[1],a=void 0===l[3]?F:'"'===l[3]?z:j):a===z||a===j?a=F:a===U||a===H?a=N:(a=F,i=void 0);const h=a===F&&e[t+1].startsWith("/>")?" ":"";s+=a===N?n+P:c>=0?(r.push(o),n.slice(0,c)+k+n.slice(c)+T+h):n+T+(-2===c?t:h)}return[Y(e,s+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),r]};class J{constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let i=0,s=0;const a=e.length-1,o=this.parts,[l,c]=Z(e,t);if(this.el=J.createElement(l,n),X.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(r=X.nextNode())&&o.length<a;){if(1===r.nodeType){if(r.hasAttributes())for(const e of r.getAttributeNames())if(e.endsWith(k)){const t=c[s++],n=r.getAttribute(e).split(T),a=/([.?@])?(.*)/.exec(t);o.push({type:1,index:i,name:a[2],strings:n,ctor:"."===a[1]?re:"?"===a[1]?ie:"@"===a[1]?se:ne}),r.removeAttribute(e)}else e.startsWith(T)&&(o.push({type:6,index:i}),r.removeAttribute(e));if(V.test(r.tagName)){const e=r.textContent.split(T),t=e.length-1;if(t>0){r.textContent=A?A.emptyScript:"";for(let n=0;n<t;n++)r.append(e[n],D()),X.nextNode(),o.push({type:2,index:++i});r.append(e[t],D())}}}else if(8===r.nodeType)if(r.data===R)o.push({type:2,index:i});else{let e=-1;for(;-1!==(e=r.data.indexOf(T,e+1));)o.push({type:7,index:i}),e+=T.length-1}i++}}static createElement(e,t){const n=I.createElement("template");return n.innerHTML=e,n}}function Q(e,t,n=e,r){if(t===q)return t;let i=void 0!==r?n._$Co?.[r]:n._$Cl;const s=O(t)?void 0:t._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),void 0===s?i=void 0:(i=new s(e),i._$AT(e,n,r)),void 0!==r?(n._$Co??=[])[r]=i:n._$Cl=i),void 0!==i&&(t=Q(e,i._$AS(e,t.values),i,r)),t}class ee{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,r=(e?.creationScope??I).importNode(t,!0);X.currentNode=r;let i=X.nextNode(),s=0,a=0,o=n[0];for(;void 0!==o;){if(s===o.index){let t;2===o.type?t=new te(i,i.nextSibling,this,e):1===o.type?t=new o.ctor(i,o.name,o.strings,this,e):6===o.type&&(t=new ae(i,this,e)),this._$AV.push(t),o=n[++a]}s!==o?.index&&(i=X.nextNode(),s++)}return X.currentNode=I,r}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class te{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,n,r){this.type=2,this._$AH=K,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cv=r?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Q(this,e,t),O(e)?e===K||null==e||""===e?(this._$AH!==K&&this._$AR(),this._$AH=K):e!==this._$AH&&e!==q&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>L(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==K&&O(this._$AH)?this._$AA.nextSibling.data=e:this.T(I.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:n}=e,r="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=J.createElement(Y(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===r)this._$AH.p(t);else{const e=new ee(r,this),n=e.u(this.options);e.p(t),this.T(n),this._$AH=e}}_$AC(e){let t=$.get(e.strings);return void 0===t&&$.set(e.strings,t=new J(e)),t}k(e){L(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,r=0;for(const i of e)r===t.length?t.push(n=new te(this.O(D()),this.O(D()),this,this.options)):n=t[r],n._$AI(i),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class ne{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,r,i){this.type=1,this._$AH=K,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=K}_$AI(e,t=this,n,r){const i=this.strings;let s=!1;if(void 0===i)e=Q(this,e,t,0),s=!O(e)||e!==this._$AH&&e!==q,s&&(this._$AH=e);else{const r=e;let a,o;for(e=i[0],a=0;a<i.length-1;a++)o=Q(this,r[n+a],t,a),o===q&&(o=this._$AH[a]),s||=!O(o)||o!==this._$AH[a],o===K?e=K:e!==K&&(e+=(o??"")+i[a+1]),this._$AH[a]=o}s&&!r&&this.j(e)}j(e){e===K?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class re extends ne{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===K?void 0:e}}class ie extends ne{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==K)}}class se extends ne{constructor(e,t,n,r,i){super(e,t,n,r,i),this.type=5}_$AI(e,t=this){if((e=Q(this,e,t,0)??K)===q)return;const n=this._$AH,r=e===K&&n!==K||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==K&&(n===K||r);r&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ae{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Q(this,e)}}const oe=C.litHtmlPolyfillSupport;oe?.(J,te),(C.litHtmlVersions??=[]).push("3.3.1");const le=globalThis;class ce extends E{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,n)=>{const r=n?.renderBefore??t;let i=r._$litPart$;if(void 0===i){const e=n?.renderBefore??null;r._$litPart$=i=new te(t.insertBefore(D(),e),e,void 0,n??{})}return i._$AI(e),i})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return q}}ce._$litElement$=!0,ce.finalized=!0,le.litElementHydrateSupport?.({LitElement:ce});const ue=le.litElementPolyfillSupport;ue?.({LitElement:ce}),(le.litElementVersions??=[]).push("4.2.1");var he=r(152);function de(e,t,n){var r;return e instanceof Object==0?n:null!==(r=e[t])&&void 0!==r?r:n}function fe(e,t=0,n=e.byteLength-t,r=!1){let i="";for(const s of new Uint8Array(e,t,n)){const e=s.toString(16).toUpperCase();1===e.length&&(i+="0"),i+=e,r&&(i+=" ")}return i.trim()}function pe(e,t){let n=0;if(1===e.length)return e[0];for(let r=e.length-1;r>=0;r--)n+=e[e.length-1-r]*Math.pow(2,t*r);return n}function me(e,t,n=-1){const r=n;let i=e,s=0,a=Math.pow(2,t);for(let n=1;n<8;n++){if(e<a){let e;if(r<0)e=new ArrayBuffer(n),s=n;else{if(r<n)return new ArrayBuffer(0);e=new ArrayBuffer(r),s=r}const a=new Uint8Array(e);for(let e=n-1;e>=0;e--){const n=Math.pow(2,e*t);a[s-e-1]=Math.floor(i/n),i-=a[s-e-1]*n}return e}a*=Math.pow(2,t)}return new ArrayBuffer(0)}function ge(...e){let t=0,n=0;for(const n of e)t+=n.byteLength;const r=new ArrayBuffer(t),i=new Uint8Array(r);for(const t of e)i.set(new Uint8Array(t),n),n+=t.byteLength;return r}function ve(...e){let t=0,n=0;for(const n of e)t+=n.length;const r=new ArrayBuffer(t),i=new Uint8Array(r);for(const t of e)i.set(t,n),n+=t.length;return i}function _e(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],n=0===e[0]&&!(128&e[1]);(t||n)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(t);for(let e=0;e<this.valueHex.byteLength;e++)n[e]=0;n[0]=128&e[0];const r=pe(n,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let t=0;t<this.valueHex.byteLength;t++)s[t]=e[t];return s[0]&=127,pe(s,8)-r}function be(e,t){if(e.byteLength!==t.byteLength)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<n.length;e++)if(n[e]!==r[e])return!1;return!0}function ye(e,t){const n=e.toString(10);if(t<n.length)return"";const r=t-n.length,i=new Array(r);for(let e=0;e<r;e++)i[e]="0";return i.join("").concat(n)}const we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function xe(e,t=!1,n=!1,r=!1){let i=0,s=0,a=0,o="";const l=t?Se:we;if(r){let t=0;for(let n=0;n<e.length;n++)if(0!==e.charCodeAt(n)){t=n;break}e=e.slice(t)}for(;i<e.length;){const t=e.charCodeAt(i++);i>=e.length&&(s=1);const r=e.charCodeAt(i++);i>=e.length&&(a=1);const c=e.charCodeAt(i++),u=t>>2,h=(3&t)<<4|r>>4;let d=(15&r)<<2|c>>6,f=63&c;1===s?d=f=64:1===a&&(f=64),o+=n?64===d?`${l.charAt(u)}${l.charAt(h)}`:64===f?`${l.charAt(u)}${l.charAt(h)}${l.charAt(d)}`:`${l.charAt(u)}${l.charAt(h)}${l.charAt(d)}${l.charAt(f)}`:`${l.charAt(u)}${l.charAt(h)}${l.charAt(d)}${l.charAt(f)}`}return o}function Ee(e,t=!1,n=!1){const r=t?Se:we;function i(e){for(let t=0;t<64;t++)if(r.charAt(t)===e)return t;return 64}function s(e){return 64===e?0:e}let a=0,o="";for(;a<e.length;){const t=i(e.charAt(a++)),n=a>=e.length?0:i(e.charAt(a++)),r=a>=e.length?0:i(e.charAt(a++)),l=a>=e.length?0:i(e.charAt(a++)),c=s(t)<<2|s(n)>>4,u=(15&s(n))<<4|s(r)>>2,h=(3&s(r))<<6|s(l);o+=String.fromCharCode(c),64!==r&&(o+=String.fromCharCode(u)),64!==l&&(o+=String.fromCharCode(h))}if(n){let e=-1;for(let t=o.length-1;t>=0;t--)if(0!==o.charCodeAt(t)){e=t;break}o=-1!==e?o.slice(0,e+1):""}return o}function Ce(e){let t="";const n=new Uint8Array(e);for(const e of n)t+=String.fromCharCode(e);return t}function Ae(e){const t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return n}const Me=Math.log(2);function ke(e){const t=Math.log(e)/Me,n=Math.floor(t),r=Math.round(t);return n===r?n:r}function Te(e,t){for(const n of t)delete e[n]}function Re(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Pe(e){let t=0,n=0;for(let n=0;n<e.length;n++)t+=e[n].byteLength;const r=new Uint8Array(t);for(let t=0;t<e.length;t++){const i=e[t];r.set(new Uint8Array(i),n),n+=i.byteLength}return r.buffer}function Ie(e,t,n,r){return t instanceof Uint8Array?t.byteLength?n<0?(e.error="Wrong parameter: inputOffset less than zero",!1):r<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-n-r<0&&(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",1)):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class De{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Pe(this.items)}}const Oe=[new Uint8Array([1])],Le="0123456789",Be="name",Ne="valueHexView",Ue="",He=new ArrayBuffer(0),Fe=new Uint8Array(0),je="EndOfContent",ze="OCTET STRING",Ve="BIT STRING";function Ge(e){var t;return t=class extends e{constructor(...e){var t;super(...e);const n=e[0]||{};this.isHexOnly=null!==(t=n.isHexOnly)&&void 0!==t&&t,this.valueHexView=n.valueHex?he._H.toUint8Array(n.valueHex):Fe}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,n){const r=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Ie(this,r,t,n))return-1;const i=t+n;return this.valueHexView=r.subarray(t,i),this.valueHexView.length?(this.blockLength=n,i):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",He)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:he.U$.ToHex(this.valueHexView)}}},t.NAME="hexBlock",t}class We{constructor({blockLength:e=0,error:t="",warnings:n=[],valueBeforeDecode:r=Fe}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=he._H.toUint8Array(r)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:he.U$.ToHex(this.valueBeforeDecodeView)}}}We.NAME="baseBlock";class qe extends We{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}qe.NAME="valueBlock";class Ke extends(Ge(We)){constructor({idBlock:e={}}={}){var t,n,r,i;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?he._H.toUint8Array(e.valueHex):Fe,this.tagClass=null!==(n=e.tagClass)&&void 0!==n?n:-1,this.tagNumber=null!==(r=e.tagNumber)&&void 0!==r?r:-1,this.isConstructed=null!==(i=e.isConstructed)&&void 0!==i&&i):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",He}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const n=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,n[0]=t}return n.buffer}if(!this.isHexOnly){const n=me(this.tagNumber,7),r=new Uint8Array(n),i=n.byteLength,s=new Uint8Array(i+1);if(s[0]=31|t,!e){for(let e=0;e<i-1;e++)s[e+1]=128|r[e];s[i]=r[i-1]}return s.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=31|t,!e){const e=this.valueHexView;for(let t=0;t<e.length-1;t++)n[t+1]=128|e[t];n[this.valueHexView.byteLength]=e[e.length-1]}return n.buffer}fromBER(e,t,n){const r=he._H.toUint8Array(e);if(!Ie(this,r,t,n))return-1;const i=r.subarray(t,t+n);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=!(32&~i[0]),this.isHexOnly=!1;const s=31&i[0];if(31!==s)this.tagNumber=s,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),n=255;for(;128&i[e];){if(t[e-1]=127&i[e],e++,e>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(e===n){n+=255;const e=new Uint8Array(n);for(let n=0;n<t.length;n++)e[n]=t[n];t=this.valueHexView=new Uint8Array(n)}}this.blockLength=e+1,t[e-1]=127&i[e];const r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=t[n];t=this.valueHexView=new Uint8Array(e),t.set(r),this.blockLength<=9?this.tagNumber=pe(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}Ke.NAME="identificationBlock";class $e extends We{constructor({lenBlock:e={}}={}){var t,n,r;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(n=e.longFormUsed)&&void 0!==n&&n,this.length=null!==(r=e.length)&&void 0!==r?r:0}fromBER(e,t,n){const r=he._H.toUint8Array(e);if(!Ie(this,r,t,n))return-1;const i=r.subarray(t,t+n);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;const s=127&i[0];if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,o=r.subarray(a,a+s);return 0===o[s-1]&&this.warnings.push("Needlessly long encoded length"),this.length=pe(o,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const r=me(this.length,8);if(r.byteLength>127)return this.error="Too big length",He;if(t=new ArrayBuffer(r.byteLength+1),e)return t;const i=new Uint8Array(r);n=new Uint8Array(t),n[0]=128|r.byteLength;for(let e=0;e<r.byteLength;e++)n[e+1]=i[e];return t}return t=new ArrayBuffer(1),!1===e&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}$e.NAME="lengthBlock";const Xe={};class Ye extends We{constructor({name:e="",optional:t=!1,primitiveSchema:n,...r}={},i){super(r),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new Ke(r),this.lenBlock=new $e(r),this.valueBlock=i?new i(r):new qe(r)}fromBER(e,t,n){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}toBER(e,t){const n=t||new De;t||Ze(this);const r=this.idBlock.toBER(e);if(n.write(r),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;const r=this.lenBlock.toBER(e);n.write(r),n.write(t)}return t?He:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():he.U$.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${he.U$.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){return this===e||e instanceof this.constructor&&be(this.toBER(),e.toBER())}}function Ze(e){if(e instanceof Xe.Constructed)for(const t of e.valueBlock.value)Ze(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}Ye.NAME="BaseBlock";class Je extends Ye{constructor({value:e="",...t}={},n){super(t,n),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,n){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}Je.NAME="BaseStringBlock";class Qe extends(Ge(qe)){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}var et,tt,nt,rt,it,st,at,ot,lt,ct,ut,ht,dt,ft,pt,mt,gt,vt,_t,bt,yt,wt,St,xt,Et,Ct,At,Mt,kt,Tt,Rt,Pt,It;Qe.NAME="PrimitiveValueBlock";class Dt extends Ye{constructor(e={}){super(e,Qe),this.idBlock.isConstructed=!1}}function Ot(e,t=0,n=e.length){const r=t;let i=new Ye({},qe);const s=new We;if(!Ie(s,e,t,n))return i.error=s.error,{offset:-1,result:i};if(!e.subarray(t,t+n).length)return i.error="Zero buffer length",{offset:-1,result:i};let a=i.idBlock.fromBER(e,t,n);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),-1===a)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=a,n-=i.idBlock.blockLength,a=i.lenBlock.fromBER(e,t,n),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),-1===a)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=a,n-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let o=Ye;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};o=Xe.EndOfContent;break;case 1:o=Xe.Boolean;break;case 2:o=Xe.Integer;break;case 3:o=Xe.BitString;break;case 4:o=Xe.OctetString;break;case 5:o=Xe.Null;break;case 6:o=Xe.ObjectIdentifier;break;case 10:o=Xe.Enumerated;break;case 12:o=Xe.Utf8String;break;case 13:o=Xe.RelativeObjectIdentifier;break;case 14:o=Xe.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:o=Xe.Sequence;break;case 17:o=Xe.Set;break;case 18:o=Xe.NumericString;break;case 19:o=Xe.PrintableString;break;case 20:o=Xe.TeletexString;break;case 21:o=Xe.VideotexString;break;case 22:o=Xe.IA5String;break;case 23:o=Xe.UTCTime;break;case 24:o=Xe.GeneralizedTime;break;case 25:o=Xe.GraphicString;break;case 26:o=Xe.VisibleString;break;case 27:o=Xe.GeneralString;break;case 28:o=Xe.UniversalString;break;case 29:o=Xe.CharacterString;break;case 30:o=Xe.BmpString;break;case 31:o=Xe.DATE;break;case 32:o=Xe.TimeOfDay;break;case 33:o=Xe.DateTime;break;case 34:o=Xe.Duration;break;default:{const e=i.idBlock.isConstructed?new Xe.Constructed:new Xe.Primitive;e.idBlock=i.idBlock,e.lenBlock=i.lenBlock,e.warnings=i.warnings,i=e}}}else o=i.idBlock.isConstructed?Xe.Constructed:Xe.Primitive;return i=function(e,t){if(e instanceof t)return e;const n=new t;return n.idBlock=e.idBlock,n.lenBlock=e.lenBlock,n.warnings=e.warnings,n.valueBeforeDecodeView=e.valueBeforeDecodeView,n}(i,o),a=i.fromBER(e,t,i.lenBlock.isIndefiniteForm?n:i.lenBlock.length),i.valueBeforeDecodeView=e.subarray(r,r+i.blockLength),{offset:a,result:i}}function Lt(e){if(!e.byteLength){const e=new Ye({},qe);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Ot(he._H.toUint8Array(e).slice(),0,e.byteLength)}function Bt(e,t){return e?1:t}et=Dt,Xe.Primitive=et,Dt.NAME="PRIMITIVE";class Nt extends qe{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const r=he._H.toUint8Array(e);if(!Ie(this,r,t,n))return-1;if(this.valueBeforeDecodeView=r.subarray(t,t+n),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let i=t;for(;Bt(this.isIndefiniteForm,n)>0;){const e=Ot(r,i,n);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(i=e.offset,this.blockLength+=e.result.blockLength,n-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===je)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===je?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){const n=t||new De;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,n);return t?He:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Nt.NAME="ConstructedValueBlock";class Ut extends Ye{constructor(e={}){super(e,Nt),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){const e=[];for(const t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map(e=>`  ${e}`).join("\n"));const t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :\n${e.join("\n")}`:`${t} :`}}tt=Ut,Xe.Constructed=tt,Ut.NAME="CONSTRUCTED";class Ht extends qe{fromBER(e,t,n){return t}toBER(e){return He}}Ht.override="EndOfContentValueBlock";class Ft extends Ye{constructor(e={}){super(e,Ht),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}nt=Ft,Xe.EndOfContent=nt,Ft.NAME=je;class jt extends Ye{constructor(e={}){super(e,qe),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const e=new Uint8Array(n);e[0]=5,e[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}rt=jt,Xe.Null=rt,jt.NAME="NULL";class zt extends(Ge(qe)){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=he._H.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,n){const r=he._H.toUint8Array(e);return Ie(this,r,t,n)?(this.valueHexView=r.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,_e.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}zt.NAME="BooleanValueBlock";class Vt extends Ye{constructor(e={}){super(e,zt),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}it=Vt,Xe.Boolean=it,Vt.NAME="BOOLEAN";class Gt extends(Ge(Nt)){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let r=0;if(this.isConstructed){if(this.isHexOnly=!1,r=Nt.prototype.fromBER.call(this,e,t,n),-1===r)return r;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.NAME;if(t===je){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==ze)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,r=super.fromBER(e,t,n),this.blockLength=n;return r}toBER(e,t){return this.isConstructed?Nt.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}Gt.NAME="OctetStringValueBlock";class Wt extends Ye{constructor({idBlock:e={},lenBlock:t={},...n}={}){var r,i;null!==(r=n.isConstructed)&&void 0!==r||(n.isConstructed=!!(null===(i=n.value)||void 0===i?void 0:i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},Gt),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const r=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(r.byteLength){const e=Ot(r,0,r.byteLength);-1!==e.offset&&e.offset===n&&(this.valueBlock.value=[e.result])}}catch(e){}}return super.fromBER(e,t,n)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Ut.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${he.U$.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Wt&&e.push(t.valueBlock.valueHexView);return he._H.concat(e)}}st=Wt,Xe.OctetString=st,Wt.NAME=ze;class qt extends(Ge(Nt)){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let r=-1;if(this.isConstructed){if(r=Nt.prototype.fromBER.call(this,e,t,n),-1===r)return r;for(const e of this.value){const t=e.constructor.NAME;if(t===je){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==Ve)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const n=e.valueBlock;if(this.unusedBits>0&&n.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=n.unusedBits}return r}const i=he._H.toUint8Array(e);if(!Ie(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const e=s.subarray(1);try{if(e.byteLength){const t=Ot(e,0,e.byteLength);-1!==t.offset&&t.offset===n-1&&(this.value=[t.result])}}catch(e){}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,t+n}toBER(e,t){if(this.isConstructed)return Nt.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return He;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}qt.NAME="BitStringValueBlock";class Kt extends Ye{constructor({idBlock:e={},lenBlock:t={},...n}={}){var r,i;null!==(r=n.isConstructed)&&void 0!==r||(n.isConstructed=!!(null===(i=n.value)||void 0===i?void 0:i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},qt),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Ut.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const n of t)e.push(n.toString(2).padStart(8,"0"));const n=e.join("");return`${this.constructor.NAME} : ${n.substring(0,n.length-this.valueBlock.unusedBits)}`}}}function $t(e,t){const n=new Uint8Array([0]),r=new Uint8Array(e),i=new Uint8Array(t);let s=r.slice(0);const a=s.length-1,o=i.slice(0),l=o.length-1;let c=0,u=0;for(let e=l<a?a:l;e>=0;e--,u++)c=1==u<o.length?s[a-u]+o[l-u]+n[0]:s[a-u]+n[0],n[0]=c/10,1==u>=s.length?s=ve(new Uint8Array([c%10]),s):s[a-u]=c%10;return n[0]>0&&(s=ve(n,s)),s}function Xt(e){if(e>=Oe.length)for(let t=Oe.length;t<=e;t++){const e=new Uint8Array([0]);let n=Oe[t-1].slice(0);for(let t=n.length-1;t>=0;t--){const r=new Uint8Array([(n[t]<<1)+e[0]]);e[0]=r[0]/10,n[t]=r[0]%10}e[0]>0&&(n=ve(e,n)),Oe.push(n)}return Oe[e]}function Yt(e,t){let n=0;const r=new Uint8Array(e),i=new Uint8Array(t),s=r.slice(0),a=s.length-1,o=i.slice(0),l=o.length-1;let c,u=0;for(let e=l;e>=0;e--,u++)c=s[a-u]-o[l-u]-n,1==c<0?(n=1,s[a-u]=c+10):(n=0,s[a-u]=c);if(n>0)for(let e=a-l+1;e>=0;e--,u++){if(c=s[a-u]-n,!(c<0)){n=0,s[a-u]=c;break}n=1,s[a-u]=c+10}return s.slice()}at=Kt,Xe.BitString=at,Kt.NAME=Ve;class Zt extends(Ge(qe)){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=_e.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){const t=e<0?-1*e:e;let n=128;for(let r=1;r<8;r++){if(t<=n){if(e<0){const e=me(n-t,8,r);return new Uint8Array(e)[0]|=128,e}let i=me(t,8,r),s=new Uint8Array(i);if(128&s[0]){const e=i.slice(0),t=new Uint8Array(e);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let n=0;n<e.byteLength;n++)s[n+1]=t[n];s[0]=0}return i}n*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,r=0){const i=this.fromBER(e,t,n);if(-1===i)return i;const s=this.valueHexView;return 0===s[0]&&128&s[1]?this.valueHexView=s.subarray(1):0!==r&&s.length<r&&(r-s.length>1&&(r=s.length+1),this.valueHexView=s.subarray(r-s.length)),i}toDER(e=!1){const t=this.valueHexView;switch(!0){case!!(128&t[0]):{const e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&!(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,n){const r=super.fromBER(e,t,n);return-1===r||this.setValueHex(),r}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=8*this.valueHexView.length-1;let t,n=new Uint8Array(8*this.valueHexView.length/3),r=0;const i=this.valueHexView;let s="",a=!1;for(let a=i.byteLength-1;a>=0;a--){t=i[a];for(let i=0;i<8;i++)1&~t||(r===e?(n=Yt(Xt(r),n),s="-"):n=$t(n,Xt(r))),r++,t>>=1}for(let e=0;e<n.length;e++)n[e]&&(a=!0),a&&(s+=Le.charAt(n[e]));return!1===a&&(s+=Le.charAt(0)),s}}ot=Zt,Zt.NAME="IntegerValueBlock",Object.defineProperty(ot.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class Jt extends Ye{constructor(e={}){super(e,Zt),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Re(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Re();const t=BigInt(e),n=new De,r=t.toString(16).replace(/^-/,""),i=new Uint8Array(he.U$.FromHex(r));if(t<0){const e=new Uint8Array(i.length+(128&i[0]?1:0));e[0]|=128;const r=BigInt(`0x${he.U$.ToHex(e)}`)+t,s=he._H.toUint8Array(he.U$.FromHex(r.toString(16)));s[0]|=128,n.write(s)}else 128&i[0]&&n.write(new Uint8Array([0])),n.write(i);return new Jt({valueHex:n.final()})}convertToDER(){const e=new Jt({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Jt({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}lt=Jt,Xe.Integer=lt,Jt.NAME="INTEGER";class Qt extends Jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}ct=Qt,Xe.Enumerated=ct,Qt.NAME="ENUMERATED";class en extends(Ge(qe)){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const r=he._H.toUint8Array(e);if(!Ie(this,r,t,n))return-1;const i=r.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let e=0;e<n&&(this.valueHexView[e]=127&i[e],this.blockLength++,128&i[e]);e++);const s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return this.valueHexView=s,128&i[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=pe(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Re();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let e=0;e<n.length;e++)n[e]=parseInt(t.slice(7*e,7*e+7),2)+(e+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,n=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)n[e]=128|t[e];return n[this.blockLength-1]=t[this.blockLength-1],n.buffer}const t=me(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",He;const n=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),r=t.byteLength-1;for(let t=0;t<r;t++)n[t]=128|e[t];n[r]=e[r]}return n}toString(){let e="";if(this.isHexOnly)e=he.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}en.NAME="sidBlock";class tn extends qe{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let r=t;for(;n>0;){const t=new en;if(r=t.fromBER(e,r,n),-1===r)return this.blockLength=0,this.error=t.error,r;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,n-=t.blockLength,this.value.push(t)}return r}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const r=this.value[n].toBER(e);if(0===r.byteLength)return this.error=this.value[n].error,He;t.push(r)}return Pe(t)}fromString(e){this.value=[];let t=0,n=0,r="",i=!1;do{if(n=e.indexOf(".",t),r=-1===n?e.substring(t):e.substring(t,n),t=n+1,i){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return void(this.value=[])}const n=parseInt(r,10);if(isNaN(n))return;e.valueDec=n+t,i=!1}else{const e=new en;if(r>Number.MAX_SAFE_INTEGER){Re();const t=BigInt(r);e.valueBigInt=t}else if(e.valueDec=parseInt(r,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,i=!0),this.value.push(e)}}while(-1!==n)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let r=this.value[n].toString();0!==n&&(e=`${e}.`),t?(r=`{${r}}`,this.value[n].isFirstSid?e=`2.{${r} - 80}`:e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}tn.NAME="ObjectIdentifierValueBlock";class nn extends Ye{constructor(e={}){super(e,tn),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ut=nn,Xe.ObjectIdentifier=ut,nn.NAME="OBJECT IDENTIFIER";class rn extends(Ge(We)){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(0===n)return t;const r=he._H.toUint8Array(e);if(!Ie(this,r,t,n))return-1;const i=r.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let e=0;e<n&&(this.valueHexView[e]=127&i[e],this.blockLength++,128&i[e]);e++);const s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)s[e]=this.valueHexView[e];return this.valueHexView=s,128&i[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=pe(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,n=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)n[e]=128|t[e];return n[this.blockLength-1]=t[this.blockLength-1],n.buffer}const t=me(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",He;const n=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),r=t.byteLength-1;for(let t=0;t<r;t++)n[t]=128|e[t];n[r]=e[r]}return n.buffer}toString(){let e="";return e=this.isHexOnly?he.U$.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}rn.NAME="relativeSidBlock";class sn extends qe{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let r=t;for(;n>0;){const t=new rn;if(r=t.fromBER(e,r,n),-1===r)return this.blockLength=0,this.error=t.error,r;this.blockLength+=t.blockLength,n-=t.blockLength,this.value.push(t)}return r}toBER(e,t){const n=[];for(let t=0;t<this.value.length;t++){const r=this.value[t].toBER(e);if(0===r.byteLength)return this.error=this.value[t].error,He;n.push(r)}return Pe(n)}fromString(e){this.value=[];let t=0,n=0,r="";do{n=e.indexOf(".",t),r=-1===n?e.substring(t):e.substring(t,n),t=n+1;const i=new rn;if(i.valueDec=parseInt(r,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(-1!==n);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let r=this.value[n].toString();0!==n&&(e=`${e}.`),t?(r=`{${r}}`,e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}sn.NAME="RelativeObjectIdentifierValueBlock";class an extends Ye{constructor(e={}){super(e,sn),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ht=an,Xe.RelativeObjectIdentifier=ht,an.NAME="RelativeObjectIdentifier";class on extends Ut{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}dt=on,Xe.Sequence=dt,on.NAME="SEQUENCE";class ln extends Ut{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}ft=ln,Xe.Set=ft,ln.NAME="SET";class cn extends(Ge(qe)){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Ue}toJSON(){return{...super.toJSON(),value:this.value}}}cn.NAME="StringValueBlock";class un extends cn{}un.NAME="SimpleStringValueBlock";class hn extends Je{constructor({...e}={}){super(e,un)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,he._H.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);this.valueBlock.value=e}}hn.NAME="SIMPLE STRING";class dn extends hn{fromBuffer(e){this.valueBlock.valueHexView=he._H.toUint8Array(e);try{this.valueBlock.value=he.U$.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=he.U$.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(he.U$.FromUtf8String(e)),this.valueBlock.value=e}}dn.NAME="Utf8StringValueBlock";class fn extends dn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}pt=fn,Xe.Utf8String=pt,fn.NAME="UTF8String";class pn extends hn{fromBuffer(e){this.valueBlock.value=he.U$.ToUtf16String(e),this.valueBlock.valueHexView=he._H.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(he.U$.FromUtf16String(e))}}pn.NAME="BmpStringValueBlock";class mn extends pn{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}mt=mn,Xe.BmpString=mt,mn.NAME="BMPString";class gn extends hn{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let e=0;e<n.length;e+=4)n[e]=n[e+3],n[e+1]=n[e+2],n[e+2]=0,n[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let r=0;r<t;r++){const t=me(e.charCodeAt(r),8),i=new Uint8Array(t);if(i.length>4)continue;const s=4-i.length;for(let e=i.length-1;e>=0;e--)n[4*r+e+s]=i[e]}this.valueBlock.value=e}}gn.NAME="UniversalStringValueBlock";class vn extends gn{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}gt=vn,Xe.UniversalString=gt,vn.NAME="UniversalString";class _n extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}vt=_n,Xe.NumericString=vt,_n.NAME="NumericString";class bn extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}_t=bn,Xe.PrintableString=_t,bn.NAME="PrintableString";class yn extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}bt=yn,Xe.TeletexString=bt,yn.NAME="TeletexString";class wn extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}yt=wn,Xe.VideotexString=yt,wn.NAME="VideotexString";class Sn extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}wt=Sn,Xe.IA5String=wt,Sn.NAME="IA5String";class xn extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}St=xn,Xe.GraphicString=St,xn.NAME="GraphicString";class En extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}xt=En,Xe.VisibleString=xt,En.NAME="VisibleString";class Cn extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Et=Cn,Xe.GeneralString=Et,Cn.NAME="GeneralString";class An extends hn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}Ct=An,Xe.CharacterString=Ct,An.NAME="CharacterString";class Mn extends En{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,he._H.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for conversion");const n=parseInt(t[1],10);this.year=n>=50?1900+n:2e3+n,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){const e=new Array(7);return e[0]=ye(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=ye(this.month,2),e[2]=ye(this.day,2),e[3]=ye(this.hour,2),e[4]=ye(this.minute,2),e[5]=ye(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}At=Mn,Xe.UTCTime=At,Mn.NAME="UTCTime";class kn extends Mn{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,n=!1,r="",i="",s=0,a=0,o=0;if("Z"===e[e.length-1])r=e.substring(0,e.length-1),n=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(n){if(-1!==r.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==r.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let e=1,t=r.indexOf("+"),n="";if(-1===t&&(t=r.indexOf("-"),e=-1),-1!==t){if(n=r.substring(t+1),r=r.substring(0,t),2!==n.length&&4!==n.length)throw new Error("Wrong input string for conversion");let i=parseInt(n.substring(0,2),10);if(isNaN(i.valueOf()))throw new Error("Wrong input string for conversion");if(a=e*i,4===n.length){if(i=parseInt(n.substring(2,4),10),isNaN(i.valueOf()))throw new Error("Wrong input string for conversion");o=e*i}}}let l=r.indexOf(".");if(-1===l&&(l=r.indexOf(",")),-1!==l){const e=new Number(`0${r.substring(l)}`);if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");s=e.valueOf(),i=r.substring(0,l)}else i=r;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==l)throw new Error("Wrong input string for conversion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==l){let e=60*s;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==l){let e=60*s;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==l){const e=1e3*s;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for conversion")}const c=t.exec(i);if(null===c)throw new Error("Wrong input string for conversion");for(let e=1;e<c.length;e++)switch(e){case 1:this.year=parseInt(c[e],10);break;case 2:this.month=parseInt(c[e],10);break;case 3:this.day=parseInt(c[e],10);break;case 4:this.hour=parseInt(c[e],10)+a;break;case 5:this.minute=parseInt(c[e],10)+o;break;case 6:this.second=parseInt(c[e],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===n){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){const e=[];return e.push(ye(this.year,4)),e.push(ye(this.month,2)),e.push(ye(this.day,2)),e.push(ye(this.hour,2)),e.push(ye(this.minute,2)),e.push(ye(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(ye(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Mt=kn,Xe.GeneralizedTime=Mt,kn.NAME="GeneralizedTime";class Tn extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}kt=Tn,Xe.DATE=kt,Tn.NAME="DATE";class Rn extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Tt=Rn,Xe.TimeOfDay=Tt,Rn.NAME="TimeOfDay";class Pn extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}Rt=Pn,Xe.DateTime=Rt,Pn.NAME="DateTime";class In extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Pt=In,Xe.Duration=Pt,In.NAME="Duration";class Dn extends fn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}It=Dn,Xe.TIME=It,Dn.NAME="TIME";class On{constructor({name:e="",optional:t=!1}={}){this.name=e,this.optional=t}}class Ln extends On{constructor({value:e=[],...t}={}){super(t),this.value=e}}class Bn extends On{constructor({value:e=new On,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class Nn{constructor({data:e=Fe}={}){this.dataView=he._H.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=he._H.toUint8Array(e)}fromBER(e,t,n){const r=t+n;return this.dataView=he._H.toUint8Array(e).subarray(t,r),r}toBER(e){return this.dataView.slice().buffer}}function Un(e,t,n){if(n instanceof Ln){for(let r=0;r<n.value.length;r++)if(Un(e,t,n.value[r]).verified)return{verified:!0,result:e};{const e={verified:!1,result:{error:"Wrong values for Choice type"}};return n.hasOwnProperty(Be)&&(e.name=n.name),e}}if(n instanceof On)return n.hasOwnProperty(Be)&&(e[n.name]=t),{verified:!0,result:e};if(e instanceof Object==0)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(n instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in n==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in n.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in n.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const r=n.idBlock.toBER(!1);if(0===r.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===n.idBlock.fromBER(r,0,r.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===n.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(n.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===n.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(n.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===n.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(n.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in n.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(n.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(n.idBlock.isHexOnly){if(Ne in n.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const r=n.idBlock.valueHexView,i=t.idBlock.valueHexView;if(r.length!==i.length)return{verified:!1,result:e};for(let t=0;t<r.length;t++)if(r[t]!==i[1])return{verified:!1,result:e}}if(n.name&&(n.name=n.name.replace(/^\s+|\s+$/g,Ue),n.name&&(e[n.name]=t)),n instanceof Xe.Constructed){let r=0,i={verified:!1,result:{error:"Unknown error"}},s=n.valueBlock.value.length;if(s>0&&n.valueBlock.value[0]instanceof Bn&&(s=t.valueBlock.value.length),0===s)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==n.valueBlock.value.length){let t=!0;for(let e=0;e<n.valueBlock.value.length;e++)t=t&&(n.valueBlock.value[e].optional||!1);return t?{verified:!0,result:e}:(n.name&&(n.name=n.name.replace(/^\s+|\s+$/g,Ue),n.name&&delete e[n.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let a=0;a<s;a++)if(a-r>=t.valueBlock.value.length){if(!1===n.valueBlock.value[a].optional){const t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",n.name&&(n.name=n.name.replace(/^\s+|\s+$/g,Ue),n.name&&(delete e[n.name],t.name=n.name)),t}}else if(n.valueBlock.value[0]instanceof Bn){if(i=Un(e,t.valueBlock.value[a],n.valueBlock.value[0].value),!1===i.verified){if(!n.valueBlock.value[0].optional)return n.name&&(n.name=n.name.replace(/^\s+|\s+$/g,Ue),n.name&&delete e[n.name]),i;r++}if(Be in n.valueBlock.value[0]&&n.valueBlock.value[0].name.length>0){let r={};r="local"in n.valueBlock.value[0]&&n.valueBlock.value[0].local?t:e,void 0===r[n.valueBlock.value[0].name]&&(r[n.valueBlock.value[0].name]=[]),r[n.valueBlock.value[0].name].push(t.valueBlock.value[a])}}else if(i=Un(e,t.valueBlock.value[a-r],n.valueBlock.value[a]),!1===i.verified){if(!n.valueBlock.value[a].optional)return n.name&&(n.name=n.name.replace(/^\s+|\s+$/g,Ue),n.name&&delete e[n.name]),i;r++}if(!1===i.verified){const t={verified:!1,result:e};return n.name&&(n.name=n.name.replace(/^\s+|\s+$/g,Ue),n.name&&(delete e[n.name],t.name=n.name)),t}return{verified:!0,result:e}}if(n.primitiveSchema&&Ne in t.valueBlock){const r=Ot(t.valueBlock.valueHexView);if(-1===r.offset){const t={verified:!1,result:r.result};return n.name&&(n.name=n.name.replace(/^\s+|\s+$/g,Ue),n.name&&(delete e[n.name],t.name=n.name)),t}return Un(e,r.result,n.primitiveSchema)}return{verified:!0,result:e}}class Hn{constructor(e={}){this.algorithmId=de(e,"algorithmId",Hn.defaultValues("algorithmId")),"algorithmParams"in e&&(this.algorithmParams=de(e,"algorithmParams",Hn.defaultValues("algorithmParams"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new On;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof On;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",optional:t.optional||!1,value:[new nn({name:t.algorithmIdentifier||""}),new On({name:t.algorithmParams||"",optional:!0})]})}fromSchema(e){Te(e,["algorithm","params"]);const t=Un(e,e,Hn.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=t.result.algorithm.valueBlock.toString(),"params"in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new nn({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof On==0&&e.push(this.algorithmParams),new on({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof On==0&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return e instanceof Hn!=0&&this.algorithmId===e.algorithmId&&("algorithmParams"in this?"algorithmParams"in e&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!("algorithmParams"in e))}}class Fn{constructor(e={}){this.x=de(e,"x",Fn.defaultValues("x")),this.y=de(e,"y",Fn.defaultValues("y")),this.namedCurve=de(e,"namedCurve",Fn.defaultValues("namedCurve")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"x":case"y":return be(t,Fn.defaultValues(e));case"namedCurve":return""===t;default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static schema(e={}){return new Nn}fromSchema(e){if(e instanceof ArrayBuffer==0)throw new Error("Object's schema was not verified against input data for ECPublicKey");if(4!==new Uint8Array(e)[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");let t;switch(this.namedCurve){case"1.2.840.10045.3.1.7":t=32;break;case"1.3.132.0.34":t=48;break;case"1.3.132.0.35":t=66;break;default:throw new Error(`Incorrect curve OID: ${this.namedCurve}`)}if(e.byteLength!==2*t+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,t+1),this.y=e.slice(1+t,2*t+1)}toSchema(){return new Nn({data:ge(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){let e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}return{crv:e,x:xe(Ce(this.x),!0,!0,!1),y:xe(Ce(this.y),!0,!0,!1)}}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("x"in e))throw new Error('Absent mandatory parameter "x"');{const n=Ae(Ee(e.x,!0));if(n.byteLength<t){this.x=new ArrayBuffer(t);const e=new Uint8Array(this.x),r=new Uint8Array(n);e.set(r,1)}else this.x=n.slice(0,t)}if(!("y"in e))throw new Error('Absent mandatory parameter "y"');{const n=Ae(Ee(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const e=new Uint8Array(this.y),r=new Uint8Array(n);e.set(r,1)}else this.y=n.slice(0,t)}}}class jn{constructor(e={}){this.modulus=de(e,"modulus",jn.defaultValues("modulus")),this.publicExponent=de(e,"publicExponent",jn.defaultValues("publicExponent")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"modulus":case"publicExponent":return new Jt;default:throw new Error(`Invalid member name for RSAPublicKey class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Jt({name:t.modulus||""}),new Jt({name:t.publicExponent||""})]})}fromSchema(e){Te(e,["modulus","publicExponent"]);const t=Un(e,e,jn.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new on({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:xe(Ce(this.modulus.valueBlock.valueHex),!0,!0,!0),e:xe(Ce(this.publicExponent.valueBlock.valueHex),!0,!0,!0)}}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');{const t=Ae(Ee(e.n,!0));this.modulus=new Jt({valueHex:t.slice(0,Math.pow(2,ke(t.byteLength)))})}if(!("e"in e))throw new Error('Absent mandatory parameter "e"');this.publicExponent=new Jt({valueHex:Ae(Ee(e.e,!0)).slice(0,3)})}}class zn{constructor(e={}){this.algorithm=de(e,"algorithm",zn.defaultValues("algorithm")),this.subjectPublicKey=de(e,"subjectPublicKey",zn.defaultValues("subjectPublicKey")),"parsedKey"in e&&(this.parsedKey=de(e,"parsedKey",zn.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"algorithm":return new Hn;case"subjectPublicKey":return new Kt;default:throw new Error(`Invalid member name for PublicKeyInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[Hn.schema(t.algorithm||{}),new Kt({name:t.subjectPublicKey||""})]})}fromSchema(e){Te(e,["algorithm","subjectPublicKey"]);const t=Un(e,e,zn.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PublicKeyInfo");switch(this.algorithm=new Hn({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey,this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams instanceof nn)try{this.parsedKey=new Fn({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Lt(this.subjectPublicKey.valueBlock.valueHex);if(-1!==e.offset)try{this.parsedKey=new jn({schema:e.result})}catch(e){}}}}toSchema(){return new on({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if("parsedKey"in this==0)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const n of Object.keys(t))e[n]=t[n];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Fn({json:e}),this.algorithm=new Hn({algorithmId:"1.2.840.10045.2.1",algorithmParams:new nn({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new jn({json:e}),this.algorithm=new Hn({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new jt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new Kt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}importKey(e){let t=Promise.resolve();const n=this;if(void 0===e)return Promise.reject("Need to provide publicKey input parameter");const r=nr();return void 0===r?Promise.reject("Unable to create WebCrypto object"):(t=t.then(()=>r.exportKey("spki",e)),t=t.then(e=>{const t=Lt(e);try{n.fromSchema(t.result)}catch(e){return Promise.reject("Error during initializing object from schema")}},e=>Promise.reject(`Error during exporting public key: ${e}`)),t)}}class Vn{constructor(e={}){this.type=de(e,"type",Vn.defaultValues("type")),this.values=de(e,"values",Vn.defaultValues("values")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"values":return[];default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return""===t;case"values":return 0===t.length;default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.type||""}),new ln({name:t.setName||"",value:[new Bn({name:t.values||"",value:new On})]})]})}fromSchema(e){Te(e,["type","values"]);const t=Un(e,e,Vn.schema({names:{type:"type",values:"values"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Attribute");this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new on({value:[new nn({value:this.type}),new ln({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}class Gn{constructor(e={}){this.version=de(e,"version",Gn.defaultValues("version")),this.privateKey=de(e,"privateKey",Gn.defaultValues("privateKey")),"namedCurve"in e&&(this.namedCurve=de(e,"namedCurve",Gn.defaultValues("namedCurve"))),"publicKey"in e&&(this.publicKey=de(e,"publicKey",Gn.defaultValues("publicKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 1;case"privateKey":return new Wt;case"namedCurve":return"";case"publicKey":return new Fn;default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return t===Gn.defaultValues(e);case"privateKey":return t.isEqual(Gn.defaultValues(e));case"namedCurve":return""===t;case"publicKey":return Fn.compareWithDefault("namedCurve",t.namedCurve)&&Fn.compareWithDefault("x",t.x)&&Fn.compareWithDefault("y",t.y);default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Jt({name:t.version||""}),new Wt({name:t.privateKey||""}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new nn({name:t.namedCurve||""})]}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Kt({name:t.publicKey||""})]})]})}fromSchema(e){Te(e,["version","privateKey","namedCurve","publicKey"]);const t=Un(e,e,Gn.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ECPrivateKey");if(this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,"namedCurve"in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),"publicKey"in t.result){const e={schema:t.result.publicKey.valueBlock.valueHex};"namedCurve"in this&&(e.namedCurve=this.namedCurve),this.publicKey=new Fn(e)}}toSchema(){const e=[new Jt({value:this.version}),this.privateKey];return"namedCurve"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:0},value:[new nn({value:this.namedCurve})]})),"publicKey"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:1},value:[new Kt({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new on({value:e})}toJSON(){if("namedCurve"in this==0||Gn.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');let e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}const t={crv:e,d:xe(Ce(this.privateKey.valueBlock.valueHex),!0,!0,!1)};if("publicKey"in this){const e=this.publicKey.toJSON();t.x=e.x,t.y=e.y}return t}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("d"in e))throw new Error('Absent mandatory parameter "d"');{const n=Ae(Ee(e.d,!0));if(n.byteLength<t){const e=new ArrayBuffer(t),r=new Uint8Array(e),i=new Uint8Array(n);r.set(i,1),this.privateKey=new Wt({valueHex:e})}else this.privateKey=new Wt({valueHex:n.slice(0,t)})}"x"in e&&"y"in e&&(this.publicKey=new Fn({json:e}))}}class Wn{constructor(e={}){this.prime=de(e,"prime",Wn.defaultValues("prime")),this.exponent=de(e,"exponent",Wn.defaultValues("exponent")),this.coefficient=de(e,"coefficient",Wn.defaultValues("coefficient")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"prime":case"exponent":case"coefficient":return new Jt;default:throw new Error(`Invalid member name for OtherPrimeInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Jt({name:t.prime||""}),new Jt({name:t.exponent||""}),new Jt({name:t.coefficient||""})]})}fromSchema(e){Te(e,["prime","exponent","coefficient"]);const t=Un(e,e,Wn.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new on({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:xe(Ce(this.prime.valueBlock.valueHex),!0,!0),d:xe(Ce(this.exponent.valueBlock.valueHex),!0,!0),t:xe(Ce(this.coefficient.valueBlock.valueHex),!0,!0)}}fromJSON(e){if(!("r"in e))throw new Error('Absent mandatory parameter "r"');if(this.prime=new Jt({valueHex:Ae(Ee(e.r,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.exponent=new Jt({valueHex:Ae(Ee(e.d,!0))}),!("t"in e))throw new Error('Absent mandatory parameter "t"');this.coefficient=new Jt({valueHex:Ae(Ee(e.t,!0))})}}class qn{constructor(e={}){this.version=de(e,"version",qn.defaultValues("version")),this.modulus=de(e,"modulus",qn.defaultValues("modulus")),this.publicExponent=de(e,"publicExponent",qn.defaultValues("publicExponent")),this.privateExponent=de(e,"privateExponent",qn.defaultValues("privateExponent")),this.prime1=de(e,"prime1",qn.defaultValues("prime1")),this.prime2=de(e,"prime2",qn.defaultValues("prime2")),this.exponent1=de(e,"exponent1",qn.defaultValues("exponent1")),this.exponent2=de(e,"exponent2",qn.defaultValues("exponent2")),this.coefficient=de(e,"coefficient",qn.defaultValues("coefficient")),"otherPrimeInfos"in e&&(this.otherPrimeInfos=de(e,"otherPrimeInfos",qn.defaultValues("otherPrimeInfos"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"modulus":case"publicExponent":case"privateExponent":case"prime1":case"prime2":case"exponent1":case"exponent2":case"coefficient":return new Jt;case"otherPrimeInfos":return[];default:throw new Error(`Invalid member name for RSAPrivateKey class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Jt({name:t.version||""}),new Jt({name:t.modulus||""}),new Jt({name:t.publicExponent||""}),new Jt({name:t.privateExponent||""}),new Jt({name:t.prime1||""}),new Jt({name:t.prime2||""}),new Jt({name:t.exponent1||""}),new Jt({name:t.exponent2||""}),new Jt({name:t.coefficient||""}),new on({optional:!0,value:[new Bn({name:t.otherPrimeInfosName||"",value:Wn.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){Te(e,["version","modulus","publicExponent","privateExponent","prime1","prime2","exponent1","exponent2","coefficient","otherPrimeInfos"]);const t=Un(e,e,qn.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),"otherPrimeInfos"in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,e=>new Wn({schema:e})))}toSchema(){const e=[];return e.push(new Jt({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),"otherPrimeInfos"in this&&e.push(new on({value:Array.from(this.otherPrimeInfos,e=>e.toSchema())})),new on({value:e})}toJSON(){const e={n:xe(Ce(this.modulus.valueBlock.valueHex),!0,!0,!0),e:xe(Ce(this.publicExponent.valueBlock.valueHex),!0,!0,!0),d:xe(Ce(this.privateExponent.valueBlock.valueHex),!0,!0,!0),p:xe(Ce(this.prime1.valueBlock.valueHex),!0,!0,!0),q:xe(Ce(this.prime2.valueBlock.valueHex),!0,!0,!0),dp:xe(Ce(this.exponent1.valueBlock.valueHex),!0,!0,!0),dq:xe(Ce(this.exponent2.valueBlock.valueHex),!0,!0,!0),qi:xe(Ce(this.coefficient.valueBlock.valueHex),!0,!0,!0)};return"otherPrimeInfos"in this&&(e.oth=Array.from(this.otherPrimeInfos,e=>e.toJSON())),e}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new Jt({valueHex:Ae(Ee(e.n,!0,!0))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');if(this.publicExponent=new Jt({valueHex:Ae(Ee(e.e,!0,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.privateExponent=new Jt({valueHex:Ae(Ee(e.d,!0,!0))}),!("p"in e))throw new Error('Absent mandatory parameter "p"');if(this.prime1=new Jt({valueHex:Ae(Ee(e.p,!0,!0))}),!("q"in e))throw new Error('Absent mandatory parameter "q"');if(this.prime2=new Jt({valueHex:Ae(Ee(e.q,!0,!0))}),!("dp"in e))throw new Error('Absent mandatory parameter "dp"');if(this.exponent1=new Jt({valueHex:Ae(Ee(e.dp,!0,!0))}),!("dq"in e))throw new Error('Absent mandatory parameter "dq"');if(this.exponent2=new Jt({valueHex:Ae(Ee(e.dq,!0,!0))}),!("qi"in e))throw new Error('Absent mandatory parameter "qi"');this.coefficient=new Jt({valueHex:Ae(Ee(e.qi,!0,!0))}),"oth"in e&&(this.otherPrimeInfos=Array.from(e.oth,e=>new Wn({json:e})))}}class Kn{constructor(e={}){this.version=de(e,"version",Kn.defaultValues("version")),this.privateKeyAlgorithm=de(e,"privateKeyAlgorithm",Kn.defaultValues("privateKeyAlgorithm")),this.privateKey=de(e,"privateKey",Kn.defaultValues("privateKey")),"attributes"in e&&(this.attributes=de(e,"attributes",Kn.defaultValues("attributes"))),"parsedKey"in e&&(this.parsedKey=de(e,"parsedKey",Kn.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new Hn;case"privateKey":return new Wt;case"attributes":return[];case"parsedKey":return{};default:throw new Error(`Invalid member name for PrivateKeyInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Jt({name:t.version||""}),Hn.schema(t.privateKeyAlgorithm||{}),new Wt({name:t.privateKey||""}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Bn({name:t.attributes||"",value:Vn.schema()})]})]})}fromSchema(e){Te(e,["version","privateKeyAlgorithm","privateKey","attributes"]);const t=Un(e,e,Kn.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyInfo");switch(this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Hn({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,"attributes"in t.result&&(this.attributes=Array.from(t.result.attributes,e=>new Vn({schema:e}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const e=Lt(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new qn({schema:e.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof nn){const e=Lt(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new Gn({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:e.result}))}}}toSchema(){const e=[new Jt({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return"attributes"in this&&e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,e=>e.toSchema())})),new on({value:e})}toJSON(){if("parsedKey"in this==0){const e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,e=>e.toJSON())),e}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const n of Object.keys(t))e[n]=t[n];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Gn({json:e}),this.privateKeyAlgorithm=new Hn({algorithmId:"1.2.840.10045.2.1",algorithmParams:new nn({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new qn({json:e}),this.privateKeyAlgorithm=new Hn({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new jt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new Wt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}class $n{constructor(e={}){if(this.contentType=de(e,"contentType",$n.defaultValues("contentType")),this.contentEncryptionAlgorithm=de(e,"contentEncryptionAlgorithm",$n.defaultValues("contentEncryptionAlgorithm")),"encryptedContent"in e&&(this.encryptedContent=e.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed)){const e=new Wt({idBlock:{isConstructed:!0},isConstructed:!0});let t=0,n=this.encryptedContent.valueBlock.valueHex.byteLength;for(;n>0;){const r=new Uint8Array(this.encryptedContent.valueBlock.valueHex,t,t+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-t:1024),i=new ArrayBuffer(r.length),s=new Uint8Array(i);for(let e=0;e<s.length;e++)s[e]=r[e];e.valueBlock.value.push(new Wt({valueHex:i})),n-=r.length,t+=r.length}this.encryptedContent=e}"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new Hn;case"encryptedContent":return new Wt;default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"contentType":return""===t;case"contentEncryptionAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==0;case"encryptedContent":return t.isEqual($n.defaultValues(e));default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.contentType||""}),Hn.schema(t.contentEncryptionAlgorithm||{}),new Ln({value:[new Ut({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new Bn({value:new Wt})]}),new Dt({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){Te(e,["contentType","contentEncryptionAlgorithm","encryptedContent"]);const t=Un(e,e,$n.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Hn({schema:t.result.contentEncryptionAlgorithm}),"encryptedContent"in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new nn({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const n=this.encryptedContent;n.idBlock.tagClass=3,n.idBlock.tagNumber=0,n.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(n)}return new on({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e}}class Xn{constructor(e={}){this.hashAlgorithm=de(e,"hashAlgorithm",Xn.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=de(e,"maskGenAlgorithm",Xn.defaultValues("maskGenAlgorithm")),this.saltLength=de(e,"saltLength",Xn.defaultValues("saltLength")),this.trailerField=de(e,"trailerField",Xn.defaultValues("trailerField")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"hashAlgorithm":return new Hn({algorithmId:"1.3.14.3.2.26",algorithmParams:new jt});case"maskGenAlgorithm":return new Hn({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Hn({algorithmId:"1.3.14.3.2.26",algorithmParams:new jt}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error(`Invalid member name for RSASSAPSSParams class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Ut({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Hn.schema(t.hashAlgorithm||{})]}),new Ut({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Hn.schema(t.maskGenAlgorithm||{})]}),new Ut({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new Jt({name:t.saltLength||""})]}),new Ut({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new Jt({name:t.trailerField||""})]})]})}fromSchema(e){Te(e,["hashAlgorithm","maskGenAlgorithm","saltLength","trailerField"]);const t=Un(e,e,Xn.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSASSAPSSParams");"hashAlgorithm"in t.result&&(this.hashAlgorithm=new Hn({schema:t.result.hashAlgorithm})),"maskGenAlgorithm"in t.result&&(this.maskGenAlgorithm=new Hn({schema:t.result.maskGenAlgorithm})),"saltLength"in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),"trailerField"in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Xn.defaultValues("hashAlgorithm"))||e.push(new Ut({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Xn.defaultValues("maskGenAlgorithm"))||e.push(new Ut({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==Xn.defaultValues("saltLength")&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:2},value:[new Jt({value:this.saltLength})]})),this.trailerField!==Xn.defaultValues("trailerField")&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:3},value:[new Jt({value:this.trailerField})]})),new on({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Xn.defaultValues("hashAlgorithm"))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Xn.defaultValues("maskGenAlgorithm"))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==Xn.defaultValues("saltLength")&&(e.saltLength=this.saltLength),this.trailerField!==Xn.defaultValues("trailerField")&&(e.trailerField=this.trailerField),e}}class Yn{constructor(e={}){this.salt=de(e,"salt",Yn.defaultValues("salt")),this.iterationCount=de(e,"iterationCount",Yn.defaultValues("iterationCount")),"keyLength"in e&&(this.keyLength=de(e,"keyLength",Yn.defaultValues("keyLength"))),"prf"in e&&(this.prf=de(e,"prf",Yn.defaultValues("prf"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new Hn({algorithmId:"1.3.14.3.2.26",algorithmParams:new jt});default:throw new Error(`Invalid member name for PBKDF2Params class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Ln({value:[new Wt({name:t.saltPrimitive||""}),Hn.schema(t.saltConstructed||{})]}),new Jt({name:t.iterationCount||""}),new Jt({name:t.keyLength||"",optional:!0}),Hn.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){Te(e,["salt","iterationCount","keyLength","prf"]);const t=Un(e,e,Yn.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:!0}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBKDF2Params");this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,"keyLength"in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),"prf"in t.result&&(this.prf=new Hn({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new Jt({value:this.iterationCount})),"keyLength"in this&&Yn.defaultValues("keyLength")!==this.keyLength&&e.push(new Jt({value:this.keyLength})),"prf"in this&&!1===Yn.defaultValues("prf").isEqual(this.prf)&&e.push(this.prf.toSchema()),new on({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return"keyLength"in this&&Yn.defaultValues("keyLength")!==this.keyLength&&(e.keyLength=this.keyLength),"prf"in this&&!1===Yn.defaultValues("prf").isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}class Zn{constructor(e={}){this.keyDerivationFunc=de(e,"keyDerivationFunc",Zn.defaultValues("keyDerivationFunc")),this.encryptionScheme=de(e,"encryptionScheme",Zn.defaultValues("encryptionScheme")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyDerivationFunc":case"encryptionScheme":return new Hn;default:throw new Error(`Invalid member name for PBES2Params class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[Hn.schema(t.keyDerivationFunc||{}),Hn.schema(t.encryptionScheme||{})]})}fromSchema(e){Te(e,["keyDerivationFunc","encryptionScheme"]);const t=Un(e,e,Zn.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBES2Params");this.keyDerivationFunc=new Hn({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new Hn({schema:t.result.encryptionScheme})}toSchema(){return new on({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}function Jn(e,t,n,r,i,s){let a,o;const l=[];switch(t.toUpperCase()){case"SHA-1":a=20,o=64;break;case"SHA-256":a=32,o=64;break;case"SHA-384":a=48,o=128;break;case"SHA-512":a=64,o=128;break;default:throw new Error("Unsupported hashing algorithm")}const c=new Uint8Array(r),u=new ArrayBuffer(2*r.byteLength+2),h=new Uint8Array(u);for(let e=0;e<c.length;e++)h[2*e]=0,h[2*e+1]=c[e];h[h.length-2]=0,h[h.length-1]=0,r=u.slice(0);const d=new ArrayBuffer(o),f=new Uint8Array(d);for(let e=0;e<d.byteLength;e++)f[e]=3;const p=i.byteLength,m=o*Math.ceil(p/o),g=new ArrayBuffer(m),v=new Uint8Array(g),_=new Uint8Array(i);for(let e=0;e<m;e++)v[e]=_[e%p];const b=r.byteLength,y=o*Math.ceil(b/o),w=new ArrayBuffer(y),S=new Uint8Array(w),x=new Uint8Array(r);for(let e=0;e<y;e++)S[e]=x[e%b];const E=g.byteLength+w.byteLength;let C=new ArrayBuffer(E),A=new Uint8Array(C);A.set(v),A.set(S,v.length);const M=Math.ceil((n>>3)/a);let k=Promise.resolve(C);for(let n=0;n<=M;n++){k=k.then(e=>{const t=new ArrayBuffer(d.byteLength+e.byteLength),n=new Uint8Array(t);return n.set(f),n.set(A,f.length),t});for(let n=0;n<s;n++)k=k.then(n=>e.digest({name:t},new Uint8Array(n)));k=k.then(e=>{const t=new ArrayBuffer(o),n=new Uint8Array(t);for(let r=0;r<t.byteLength;r++)n[r]=e[r%e.length];const r=Math.ceil(p/o)+Math.ceil(b/o),i=[];let s=0,a=o;for(let e=0;e<r;e++){const e=Array.from(new Uint8Array(C.slice(s,s+a)));s+=o,s+o>C.byteLength&&(a=C.byteLength-s);let r=511;for(let i=t.byteLength-1;i>=0;i--)r>>=8,r+=n[i]+e[i],e[i]=255&r;i.push(...e)}return C=new ArrayBuffer(i.length),A=new Uint8Array(C),A.set(i),l.push(...new Uint8Array(e)),C})}return k=k.then(()=>{const e=new ArrayBuffer(n>>3);return new Uint8Array(e).set(new Uint8Array(l).slice(0,n>>3)),e}),k}class Qn{constructor(e={}){this.crypto=de(e,"crypto",{}),this.subtle=de(e,"subtle",{}),this.name=de(e,"name","")}importKey(e,t,n,r,i){let s={};switch(t instanceof Uint8Array&&(t=t.buffer),e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,n,r,i);case"spki":{const e=Lt(t);if(-1===e.offset)return Promise.reject("Incorrect keyData");const a=new zn;try{a.fromSchema(e.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(n.name.toUpperCase()){case"RSA-PSS":switch(n.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${n.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(i=["verify"],s.kty="RSA",s.ext=r,s.key_ops=i,"1.2.840.113549.1.1.1"!==a.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`);if("alg"in s==0)switch(n.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`)}const e=a.toJSON();for(const t of Object.keys(e))s[t]=e[t]}break;case"ECDSA":i=["verify"];case"ECDH":{if(s={kty:"EC",ext:r,key_ops:i},"1.2.840.10045.2.1"!==a.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`);const e=a.toJSON();for(const t of Object.keys(e))s[t]=e[t]}break;case"RSA-OAEP":{if(s.kty="RSA",s.ext=r,s.key_ops=i,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(n.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`)}const e=a.toJSON();for(const t of Object.keys(e))s[t]=e[t]}break;default:return Promise.reject(`Incorrect algorithm name: ${n.name.toUpperCase()}`)}}break;case"pkcs8":{const e=new Kn,a=Lt(t);if(-1===a.offset)return Promise.reject("Incorrect keyData");try{e.fromSchema(a.result)}catch(e){return Promise.reject("Incorrect keyData")}if("parsedKey"in e==0)return Promise.reject("Incorrect keyData");switch(n.name.toUpperCase()){case"RSA-PSS":switch(n.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${n.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(i=["sign"],s.kty="RSA",s.ext=r,s.key_ops=i,"1.2.840.113549.1.1.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect private key algorithm: ${e.privateKeyAlgorithm.algorithmId}`);if("alg"in s==0)switch(n.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${n.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))s[e]=t[e]}break;case"ECDSA":i=["sign"];case"ECDH":{if(s={kty:"EC",ext:r,key_ops:i},"1.2.840.10045.2.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect algorithm: ${e.privateKeyAlgorithm.algorithmId}`);const t=e.toJSON();for(const e of Object.keys(t))s[e]=t[e]}break;case"RSA-OAEP":{if(s.kty="RSA",s.ext=r,s.key_ops=i,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(n.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect hash algorithm: ${n.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))s[e]=t[e]}break;default:return Promise.reject(`Incorrect algorithm name: ${n.name.toUpperCase()}`)}}break;case"jwk":s=t;break;default:return Promise.reject(`Incorrect format: ${e}`)}return"safari"===this.name.toLowerCase()?Promise.resolve().then(()=>this.subtle.importKey("jwk",Ae(JSON.stringify(s)),n,r,i)).then(e=>e,()=>this.subtle.importKey("jwk",s,n,r,i)):this.subtle.importKey("jwk",s,n,r,i)}exportKey(e,t){let n=this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&(n=n.then(e=>e instanceof ArrayBuffer?JSON.parse(Ce(e)):e)),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":n=n.then(e=>{const t=new zn;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"pkcs8":n=n.then(e=>{const t=new Kn;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"jwk":break;default:return Promise.reject(`Incorrect format: ${e}`)}return n}convert(e,t,n,r,i,s){switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(n);case"spki":return Promise.resolve().then(()=>this.importKey("raw",n,r,i,s)).then(e=>this.exportKey("spki",e));case"pkcs8":return Promise.resolve().then(()=>this.importKey("raw",n,r,i,s)).then(e=>this.exportKey("pkcs8",e));case"jwk":return Promise.resolve().then(()=>this.importKey("raw",n,r,i,s)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("spki",n,r,i,s)).then(e=>this.exportKey("raw",e));case"spki":return Promise.resolve(n);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then(()=>this.importKey("spki",n,r,i,s)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("pkcs8",n,r,i,s)).then(e=>this.exportKey("raw",e));case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(n);case"jwk":return Promise.resolve().then(()=>this.importKey("pkcs8",n,r,i,s)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("jwk",n,r,i,s)).then(e=>this.exportKey("raw",e));case"spki":return Promise.resolve().then(()=>this.importKey("jwk",n,r,i,s)).then(e=>this.exportKey("spki",e));case"pkcs8":return Promise.resolve().then(()=>this.importKey("jwk",n,r,i,s)).then(e=>this.exportKey("pkcs8",e));case"jwk":return Promise.resolve(n);default:return Promise.reject(`Incorrect outputFormat: ${t}`)}default:return Promise.reject(`Incorrect inputFormat: ${e}`)}}encrypt(...e){return this.subtle.encrypt(...e)}decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}verify(...e){return this.subtle.verify(...e)}digest(...e){return this.subtle.digest(...e)}generateKey(...e){return this.subtle.generateKey(...e)}deriveKey(...e){return this.subtle.deriveKey(...e)}deriveBits(...e){return this.subtle.deriveBits(...e)}wrapKey(...e){return this.subtle.wrapKey(...e)}unwrapKey(...e){return this.subtle.unwrapKey(...e)}getRandomValues(e){if("getRandomValues"in this.crypto==0)throw new Error("No support for getRandomValues");return this.crypto.getRandomValues(e)}getAlgorithmByOID(e){switch(e){case"1.2.840.113549.1.1.1":case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}}getOIDByAlgorithm(e){let t="";switch(e.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13"}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11"}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35"}return t}getAlgorithmParameters(e,t){let n={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":n={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":n={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":n={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":n={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":n={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":n={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":n={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":n={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":n={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":n={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":n={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":n={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":n={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":n={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":n={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":n={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":n={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":n={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":n={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":n={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":n={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":n={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};n={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};n={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return n}getHashAlgorithm(e){let t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const n=new Xn({schema:e.algorithmParams});if("hashAlgorithm"in n){const e=this.getAlgorithmByOID(n.hashAlgorithm.algorithmId);if("name"in e==0)return"";t=e.name}else t="SHA-1"}catch(e){}}return t}encryptEncryptedContentInfo(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e==0)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');if("contentType"in e==0)return Promise.reject('Absent mandatory parameter "contentType"');const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm);if(""===t)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');const n=this.getOIDByAlgorithm({name:"PBKDF2"});if(""===n)return Promise.reject("Can not find OID for PBKDF2");const r=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(""===r)return Promise.reject(`Incorrect value for "hmacHashAlgorithm": ${e.hmacHashAlgorithm}`);let i=Promise.resolve();const s=new ArrayBuffer(16),a=new Uint8Array(s);this.getRandomValues(a);const o=new ArrayBuffer(64),l=new Uint8Array(o);this.getRandomValues(l);const c=new Uint8Array(e.contentToEncrypt),u=new Yn({salt:new Wt({valueHex:o}),iterationCount:e.iterationCount,prf:new Hn({algorithmId:r,algorithmParams:new jt})});return i=i.then(()=>{const t=new Uint8Array(e.password);return this.importKey("raw",t,"PBKDF2",!1,["deriveKey"])},e=>Promise.reject(e)),i=i.then(t=>this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},t,e.contentEncryptionAlgorithm,!1,["encrypt"]),e=>Promise.reject(e)),i=i.then(t=>this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:a},t,c),e=>Promise.reject(e)),i=i.then(r=>{const i=new Zn({keyDerivationFunc:new Hn({algorithmId:n,algorithmParams:u.toSchema()}),encryptionScheme:new Hn({algorithmId:t,algorithmParams:new Wt({valueHex:s})})});return new $n({contentType:e.contentType,contentEncryptionAlgorithm:new Hn({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:i.toSchema()}),encryptedContent:new Wt({valueHex:r})})},e=>Promise.reject(e)),i}decryptEncryptedContentInfo(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("encryptedContentInfo"in e==0)return Promise.reject('Absent mandatory parameter "encryptedContentInfo"');if("1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)return Promise.reject(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t,n,r=Promise.resolve();try{t=new Zn({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}try{n=new Yn({schema:t.keyDerivationFunc.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}const i=this.getAlgorithmByOID(t.encryptionScheme.algorithmId);if("name"in i==0)return Promise.reject(`Incorrect OID for "contentEncryptionAlgorithm": ${t.encryptionScheme.algorithmId}`);const s=t.encryptionScheme.algorithmParams.valueBlock.valueHex,a=new Uint8Array(s),o=n.salt.valueBlock.valueHex,l=new Uint8Array(o),c=n.iterationCount;let u="SHA-1";if("prf"in n){const e=this.getAlgorithmByOID(n.prf.algorithmId);if("name"in e==0)return Promise.reject("Incorrect OID for HMAC hash algorithm");u=e.hash.name}return r=r.then(()=>this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),e=>Promise.reject(e)),r=r.then(e=>this.deriveKey({name:"PBKDF2",hash:{name:u},salt:l,iterations:c},e,i,!1,["decrypt"]),e=>Promise.reject(e)),r=r.then(t=>{let n=new ArrayBuffer(0);if(!1===e.encryptedContentInfo.encryptedContent.idBlock.isConstructed)n=e.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else for(const t of e.encryptedContentInfo.encryptedContent.valueBlock.value)n=ge(n,t.valueBlock.valueHex);return this.decrypt({name:i.name,iv:a},t,n)},e=>Promise.reject(e)),r}stampDataWithPassword(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "salt"');if("contentToStamp"in e==0)return Promise.reject('Absent mandatory parameter "contentToStamp"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let n=Promise.resolve();const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return n=n.then(()=>Jn(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)),n=n.then(e=>this.importKey("raw",new Uint8Array(e),r,!1,["sign"])),n=n.then(t=>this.sign(r,t,new Uint8Array(e.contentToStamp)),e=>Promise.reject(e)),n}verifyDataStampedWithPassword(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "salt"');if("contentToVerify"in e==0)return Promise.reject('Absent mandatory parameter "contentToVerify"');if("signatureToVerify"in e==0)return Promise.reject('Absent mandatory parameter "signatureToVerify"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let n=Promise.resolve();const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return n=n.then(()=>Jn(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)),n=n.then(e=>this.importKey("raw",new Uint8Array(e),r,!1,["verify"])),n=n.then(t=>this.verify(r,t,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify)),e=>Promise.reject(e)),n}getSignatureParameters(e,t="SHA-1"){if(""===this.getOIDByAlgorithm({name:t}))return Promise.reject(`Unsupported hash algorithm: ${t}`);const n=new Hn,r=this.getAlgorithmParameters(e.algorithm.name,"sign");switch(r.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":n.algorithmId=this.getOIDByAlgorithm(r.algorithm);break;case"RSA-PSS":{switch(t.toUpperCase()){case"SHA-256":r.algorithm.saltLength=32;break;case"SHA-384":r.algorithm.saltLength=48;break;case"SHA-512":r.algorithm.saltLength=64}const e={};if("SHA-1"!==t.toUpperCase()){const n=this.getOIDByAlgorithm({name:t});if(""===n)return Promise.reject(`Unsupported hash algorithm: ${t}`);e.hashAlgorithm=new Hn({algorithmId:n,algorithmParams:new jt}),e.maskGenAlgorithm=new Hn({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.hashAlgorithm.toSchema()})}20!==r.algorithm.saltLength&&(e.saltLength=r.algorithm.saltLength);const i=new Xn(e);n.algorithmId="1.2.840.113549.1.1.10",n.algorithmParams=i.toSchema()}break;default:return Promise.reject(`Unsupported signature algorithm: ${e.algorithm.name}`)}return Promise.resolve().then(()=>({signatureAlgorithm:n,parameters:r}))}signWithPrivateKey(e,t,n){return this.sign(n.algorithm,t,new Uint8Array(e)).then(e=>("ECDSA"===n.algorithm.name&&(e=function(e){if(e.byteLength%2!=0)return new ArrayBuffer(0);const t=e.byteLength/2,n=new ArrayBuffer(t);new Uint8Array(n).set(new Uint8Array(e,0,t));const r=new Jt({valueHex:n}),i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(e,t,t));const s=new Jt({valueHex:i});return new on({value:[r.convertToDER(),s.convertToDER()]}).toBER(!1)}(e)),e),e=>Promise.reject(`Signing error: ${e}`))}fillPublicKeyParameters(e,t){const n={},r=this.getHashAlgorithm(t);if(""===r)return Promise.reject(`Unsupported signature algorithm: ${t.algorithmId}`);let i;i="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;const s=this.getAlgorithmByOID(i);if("name"in s==="")return Promise.reject(`Unsupported public key algorithm: ${t.algorithmId}`);if(n.algorithm=this.getAlgorithmParameters(s.name,"importkey"),"hash"in n.algorithm.algorithm&&(n.algorithm.algorithm.hash.name=r),"ECDSA"===s.name){let t=!1;if("algorithmParams"in e.algorithm==1&&"idBlock"in e.algorithm.algorithmParams&&1===e.algorithm.algorithmParams.idBlock.tagClass&&6===e.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const r=this.getAlgorithmByOID(e.algorithm.algorithmParams.valueBlock.toString());if("name"in r==0)return Promise.reject(`Unsupported named curve algorithm: ${e.algorithm.algorithmParams.valueBlock.toString()}`);n.algorithm.algorithm.namedCurve=r.name}return n}getPublicKey(e,t,n=null){null===n&&(n=this.fillPublicKeyParameters(e,t));const r=e.toSchema().toBER(!1),i=new Uint8Array(r);return this.importKey("spki",i,n.algorithm.algorithm,!0,n.algorithm.usages)}verifyWithPublicKey(e,t,n,r,i=null){let s=Promise.resolve();if(null===i){if(""===(i=this.getHashAlgorithm(r)))return Promise.reject(`Unsupported signature algorithm: ${r.algorithmId}`);s=s.then(()=>this.getPublicKey(n,r))}else{const e={};let t;t="1.2.840.113549.1.1.10"===r.algorithmId?r.algorithmId:n.algorithm.algorithmId;const a=this.getAlgorithmByOID(t);if("name"in a==="")return Promise.reject(`Unsupported public key algorithm: ${r.algorithmId}`);if(e.algorithm=this.getAlgorithmParameters(a.name,"importkey"),"hash"in e.algorithm.algorithm&&(e.algorithm.algorithm.hash.name=i),"ECDSA"===a.name){let t=!1;if("algorithmParams"in n.algorithm==1&&"idBlock"in n.algorithm.algorithmParams&&1===n.algorithm.algorithmParams.idBlock.tagClass&&6===n.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const r=this.getAlgorithmByOID(n.algorithm.algorithmParams.valueBlock.toString());if("name"in r==0)return Promise.reject(`Unsupported named curve algorithm: ${n.algorithm.algorithmParams.valueBlock.toString()}`);e.algorithm.algorithm.namedCurve=r.name}s=s.then(()=>this.getPublicKey(n,null,e))}return s=s.then(n=>{const s=this.getAlgorithmParameters(n.algorithm.name,"verify");"hash"in s.algorithm&&(s.algorithm.hash.name=i);let a=t.valueBlock.valueHex;if("ECDSA"===n.algorithm.name&&(a=function(e){if(e instanceof on==0)return new ArrayBuffer(0);if(2!==e.valueBlock.value.length)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof Jt==0)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof Jt==0)return new ArrayBuffer(0);const t=e.valueBlock.value[0].convertFromDER(),n=e.valueBlock.value[1].convertFromDER();switch(!0){case t.valueBlock.valueHex.byteLength<n.valueBlock.valueHex.byteLength:{if(n.valueBlock.valueHex.byteLength-t.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");const e=n.valueBlock.valueHex.byteLength,r=new Uint8Array(t.valueBlock.valueHex),i=new ArrayBuffer(e),s=new Uint8Array(i);return s.set(r,1),s[0]=0,ge(i,n.valueBlock.valueHex)}case t.valueBlock.valueHex.byteLength>n.valueBlock.valueHex.byteLength:{if(t.valueBlock.valueHex.byteLength-n.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");const e=t.valueBlock.valueHex.byteLength,r=new Uint8Array(n.valueBlock.valueHex),i=new ArrayBuffer(e),s=new Uint8Array(i);return s.set(r,1),s[0]=0,ge(t.valueBlock.valueHex,i)}default:if(t.valueBlock.valueHex.byteLength%2){const e=t.valueBlock.valueHex.byteLength+1,r=new Uint8Array(t.valueBlock.valueHex),i=new ArrayBuffer(e),s=new Uint8Array(i);s.set(r,1),s[0]=0;const a=new Uint8Array(n.valueBlock.valueHex),o=new ArrayBuffer(e),l=new Uint8Array(o);return l.set(a,1),l[0]=0,ge(i,o)}}return ge(t.valueBlock.valueHex,n.valueBlock.valueHex)}(Lt(a).result)),"RSA-PSS"===n.algorithm.name){let e;try{e=new Xn({schema:r.algorithmParams})}catch(e){return Promise.reject(e)}s.algorithm.saltLength="saltLength"in e?e.saltLength:20;let t="SHA-1";if("hashAlgorithm"in e){const n=this.getAlgorithmByOID(e.hashAlgorithm.algorithmId);if("name"in n==0)return Promise.reject(`Unrecognized hash algorithm: ${e.hashAlgorithm.algorithmId}`);t=n.name}s.algorithm.hash.name=t}return this.verify(s.algorithm,n,new Uint8Array(a),new Uint8Array(e))}),s}}let er={name:"none",crypto:null,subtle:null};function tr(){if("undefined"!=typeof process&&"pid"in process&&void 0!==r.g){let e;try{e=r.g[process.pid].pkijs.engine}catch(e){throw new Error('Please call "setEngine" before call to "getEngine"')}return e}return er}function nr(){const e=tr();if(null!==e.subtle)return e.subtle}function rr(e){let t=!1,n="";const r=e.trim();for(let e=0;e<r.length;e++)32===r.charCodeAt(e)?!1===t&&(t=!0):(t&&(n+=" ",t=!1),n+=r[e]);return n.toLowerCase()}!function(){if("undefined"!=typeof self&&"crypto"in self){let e="webcrypto";const t=self.crypto;let n;if("webkitSubtle"in self.crypto){try{n=self.crypto.webkitSubtle}catch(e){n=self.crypto.subtle}e="safari"}"subtle"in self.crypto&&(n=self.crypto.subtle),er=void 0===n?{name:e,crypto:t,subtle:null}:{name:e,crypto:t,subtle:new Qn({name:e,crypto:self.crypto,subtle:n})}}!function(e,t,n){if("undefined"!=typeof process&&"pid"in process&&void 0!==r.g&&"undefined"==typeof window){if(void 0===r.g[process.pid])r.g[process.pid]={};else if("object"!=typeof r.g[process.pid])throw new Error(`Name global.${process.pid} already exists and it is not an object`);if(void 0===r.g[process.pid].pkijs)r.g[process.pid].pkijs={};else if("object"!=typeof r.g[process.pid].pkijs)throw new Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);r.g[process.pid].pkijs.engine={name:e,crypto:t,subtle:n}}else er={name:e,crypto:t,subtle:n}}(er.name,er.crypto,er.subtle)}();class ir{constructor(e={}){this.type=de(e,"type",ir.defaultValues("type")),this.value=de(e,"value",ir.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"value":return{};default:throw new Error(`Invalid member name for AttributeTypeAndValue class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.type||""}),new On({name:t.value||""})]})}fromSchema(e){Te(e,["type","typeValue"]);const t=Un(e,e,ir.schema({names:{type:"type",value:"typeValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeTypeAndValue");this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new on({value:[new nn({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){if(e instanceof ir){if(this.type!==e.type)return!1;if(this.value instanceof fn&&e.value instanceof fn||this.value instanceof mn&&e.value instanceof mn||this.value instanceof vn&&e.value instanceof vn||this.value instanceof _n&&e.value instanceof _n||this.value instanceof bn&&e.value instanceof bn||this.value instanceof yn&&e.value instanceof yn||this.value instanceof wn&&e.value instanceof wn||this.value instanceof Sn&&e.value instanceof Sn||this.value instanceof xn&&e.value instanceof xn||this.value instanceof En&&e.value instanceof En||this.value instanceof Cn&&e.value instanceof Cn||this.value instanceof An&&e.value instanceof An){const t=rr(this.value.valueBlock.value),n=rr(e.value.valueBlock.value);if(0!==t.localeCompare(n))return!1}else if(!1===be(this.value.valueBeforeDecode,e.value.valueBeforeDecode))return!1;return!0}return e instanceof ArrayBuffer&&be(this.value.valueBeforeDecode,e)}}class sr{constructor(e={}){this.typesAndValues=de(e,"typesAndValues",sr.defaultValues("typesAndValues")),this.valueBeforeDecode=de(e,"valueBeforeDecode",sr.defaultValues("valueBeforeDecode")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"typesAndValues":return 0===t.length;case"valueBeforeDecode":return 0===t.byteLength;default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.repeatedSequence||"",value:new ln({value:[new Bn({name:t.repeatedSet||"",value:ir.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){Te(e,["RDN","typesAndValues"]);const t=Un(e,e,sr.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RelativeDistinguishedNames");"typesAndValues"in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,e=>new ir({schema:e}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecode}toSchema(){return 0===this.valueBeforeDecode.byteLength?new on({value:[new ln({value:Array.from(this.typesAndValues,e=>e.toSchema())})]}):Lt(this.valueBeforeDecode).result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof sr){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,n]of this.typesAndValues.entries())if(!1===n.isEqual(e.typesAndValues[t]))return!1;return!0}return e instanceof ArrayBuffer&&be(this.valueBeforeDecode,e)}}function ar(e={},t=!1){const n=de(e,"names",{});return new on({optional:t,value:[new Ut({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:n.country_name||"",value:[new Ln({value:[new _n,new bn]})]}),new Ut({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:n.administration_domain_name||"",value:[new Ln({value:[new _n,new bn]})]}),new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:n.network_address||"",isHexOnly:!0}),new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:n.terminal_identifier||"",isHexOnly:!0}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:n.private_domain_name||"",value:[new Ln({value:[new _n,new bn]})]}),new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:n.organization_name||"",isHexOnly:!0}),new Dt({optional:!0,name:n.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new Ut({optional:!0,name:n.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new Dt({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new Ut({optional:!0,name:n.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new Bn({value:new bn})]})]})}function or(e=!1){return new on({optional:e,value:[new bn,new bn]})}function lr(e=!1){return new ln({optional:e,value:[new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new On]})]})}class cr{constructor(e={}){this.type=de(e,"type",cr.defaultValues("type")),this.value=de(e,"value",cr.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return t===cr.defaultValues(e);case"value":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new Ln({value:[new Ut({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||"",value:[new nn,new Ut({idBlock:{tagClass:3,tagNumber:0},value:[new On]})]}),new Dt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new Dt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new Ut({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||"",value:[ar(t.builtInStandardAttributes||{},!1),or(!0),lr(!0)]}),new Ut({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||"",value:[sr.schema(t.directoryName||{})]}),new Ut({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||"",value:[new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ln({value:[new yn,new bn,new vn,new fn,new mn]})]}),new Ut({idBlock:{tagClass:3,tagNumber:1},value:[new Ln({value:[new yn,new bn,new vn,new fn,new mn]})]})]}),new Dt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new Dt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new Dt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){Te(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=Un(e,e,cr.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralName");switch(this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=22;const n=e.toBER(!1);this.value=Lt(n).result.valueBlock.value}break;case 4:this.value=new sr({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new Wt({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=6;const n=e.toBER(!1);this.value=Lt(n).result.valueBlock.toString()}}}toSchema(){switch(this.type){case 0:case 3:case 5:return new Ut({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new Sn({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new Ut({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new nn({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return cr.schema()}}toJSON(){const e={type:this.type,value:""};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}class ur{constructor(e={}){this.accessMethod=de(e,"accessMethod",ur.defaultValues("accessMethod")),this.accessLocation=de(e,"accessLocation",ur.defaultValues("accessLocation")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"accessMethod":return"";case"accessLocation":return new cr;default:throw new Error(`Invalid member name for AccessDescription class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.accessMethod||""}),cr.schema(t.accessLocation||{})]})}fromSchema(e){Te(e,["accessMethod","accessLocation"]);const t=Un(e,e,ur.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new cr({schema:t.result.accessLocation})}toSchema(){return new on({value:[new nn({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}class hr{constructor(e={}){this.altNames=de(e,"altNames",hr.defaultValues("altNames")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("altNames"===e)return[];throw new Error(`Invalid member name for AltName class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.altNames||"",value:cr.schema()})]})}fromSchema(e){Te(e,["altNames"]);const t=Un(e,e,hr.schema({names:{altNames:"altNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AltName");"altNames"in t.result&&(this.altNames=Array.from(t.result.altNames,e=>new cr({schema:e})))}toSchema(){return new on({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}class dr{constructor(e={}){this.type=de(e,"type",dr.defaultValues("type")),this.value=de(e,"value",dr.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error(`Invalid member name for Time class: ${e}`)}}static schema(e={},t=!1){const n=de(e,"names",{});return new Ln({optional:t,value:[new Mn({name:n.utcTimeName||""}),new kn({name:n.generalTimeName||""})]})}fromSchema(e){Te(e,["utcTimeName","generalTimeName"]);const t=Un(e,e,dr.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Time");"utcTimeName"in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),"generalTimeName"in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){let e={};return 0===this.type&&(e=new Mn({valueDate:this.value})),1===this.type&&(e=new kn({valueDate:this.value})),e}toJSON(){return{type:this.type,value:this.value}}}class fr{constructor(e={}){this.attributes=de(e,"attributes",fr.defaultValues("attributes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("attributes"===e)return[];throw new Error(`Invalid member name for SubjectDirectoryAttributes class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.attributes||"",value:Vn.schema()})]})}fromSchema(e){Te(e,["attributes"]);const t=Un(e,e,fr.schema({names:{attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(t.result.attributes,e=>new Vn({schema:e}))}toSchema(){return new on({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}class pr{constructor(e={}){"notBefore"in e&&(this.notBefore=de(e,"notBefore",pr.defaultValues("notBefore"))),"notAfter"in e&&(this.notAfter=de(e,"notAfter",pr.defaultValues("notAfter"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"notBefore":case"notAfter":return new Date;default:throw new Error(`Invalid member name for PrivateKeyUsagePeriod class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Dt({name:t.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Dt({name:t.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){Te(e,["notBefore","notAfter"]);const t=Un(e,e,pr.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in t.result){const e=new kn;e.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=e.toDate()}if("notAfter"in t.result){const e=new kn({valueHex:t.result.notAfter.valueBlock.valueHex});e.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=e.toDate()}}toSchema(){const e=[];return"notBefore"in this&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:0},valueHex:new kn({valueDate:this.notBefore}).valueBlock.valueHex})),"notAfter"in this&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:1},valueHex:new kn({valueDate:this.notAfter}).valueBlock.valueHex})),new on({value:e})}toJSON(){const e={};return"notBefore"in this&&(e.notBefore=this.notBefore),"notAfter"in this&&(e.notAfter=this.notAfter),e}}class mr{constructor(e={}){this.cA=de(e,"cA",!1),"pathLenConstraint"in e&&(this.pathLenConstraint=de(e,"pathLenConstraint",0)),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("cA"===e)return!1;throw new Error(`Invalid member name for BasicConstraints class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Vt({optional:!0,name:t.cA||""}),new Jt({optional:!0,name:t.pathLenConstraint||""})]})}fromSchema(e){Te(e,["cA","pathLenConstraint"]);const t=Un(e,e,mr.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for BasicConstraints");"cA"in t.result&&(this.cA=t.result.cA.valueBlock.value),"pathLenConstraint"in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==mr.defaultValues("cA")&&e.push(new Vt({value:this.cA})),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof Jt?e.push(this.pathLenConstraint):e.push(new Jt({value:this.pathLenConstraint}))),new on({value:e})}toJSON(){const e={};return this.cA!==mr.defaultValues("cA")&&(e.cA=this.cA),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof Jt?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}class gr{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=de(e,"distributionPoint",gr.defaultValues("distributionPoint"))),this.onlyContainsUserCerts=de(e,"onlyContainsUserCerts",gr.defaultValues("onlyContainsUserCerts")),this.onlyContainsCACerts=de(e,"onlyContainsCACerts",gr.defaultValues("onlyContainsCACerts")),"onlySomeReasons"in e&&(this.onlySomeReasons=de(e,"onlySomeReasons",gr.defaultValues("onlySomeReasons"))),this.indirectCRL=de(e,"indirectCRL",gr.defaultValues("indirectCRL")),this.onlyContainsAttributeCerts=de(e,"onlyContainsAttributeCerts",gr.defaultValues("onlyContainsAttributeCerts")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":case"onlyContainsCACerts":case"indirectCRL":case"onlyContainsAttributeCerts":return!1;case"onlySomeReasons":return 0;default:throw new Error(`Invalid member name for IssuingDistributionPoint class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ln({value:[new Ut({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new Bn({name:t.distributionPointNames||"",value:cr.schema()})]}),new Ut({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:sr.schema().valueBlock.value})]})]}),new Dt({name:t.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Dt({name:t.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Dt({name:t.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Dt({name:t.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Dt({name:t.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){Te(e,["distributionPoint","distributionPointNames","onlyContainsUserCerts","onlyContainsCACerts","onlySomeReasons","indirectCRL","onlyContainsAttributeCerts"]);const t=Un(e,e,gr.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new cr({schema:e}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new sr({schema:new on({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if("onlyContainsUserCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==e[0]}if("onlyContainsCACerts"in t.result){const e=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==e[0]}if("onlySomeReasons"in t.result){const e=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=e[0]}if("indirectCRL"in t.result){const e=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==e[0]}if("onlyContainsAttributeCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==e[0]}}toSchema(){const e=[];if("distributionPoint"in this){let t;this.distributionPoint instanceof Array?t=new Ut({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(t)}if(this.onlyContainsUserCerts!==gr.defaultValues("onlyContainsUserCerts")&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==gr.defaultValues("onlyContainsCACerts")&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),"onlySomeReasons"in this){const t=new ArrayBuffer(1);new Uint8Array(t)[0]=this.onlySomeReasons,e.push(new Dt({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==gr.defaultValues("indirectCRL")&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==gr.defaultValues("onlyContainsAttributeCerts")&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new on({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==gr.defaultValues("onlyContainsUserCerts")&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==gr.defaultValues("onlyContainsCACerts")&&(e.onlyContainsCACerts=this.onlyContainsCACerts),"onlySomeReasons"in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==gr.defaultValues("indirectCRL")&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==gr.defaultValues("onlyContainsAttributeCerts")&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}class vr{constructor(e={}){this.names=de(e,"names",vr.defaultValues("names")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("names"===e)return[];throw new Error(`Invalid member name for GeneralNames class: ${e}`)}static schema(e={},t=!1){const n=de(e,"names",{});return new on({optional:t,name:n.blockName||"",value:[new Bn({name:n.generalNames||"",value:cr.schema()})]})}fromSchema(e){Te(e,["names","generalNames"]);const t=Un(e,e,vr.schema({names:{blockName:"names",generalNames:"generalNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(t.result.generalNames,e=>new cr({schema:e}))}toSchema(){return new on({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}class _r{constructor(e={}){this.base=de(e,"base",_r.defaultValues("base")),this.minimum=de(e,"minimum",_r.defaultValues("minimum")),"maximum"in e&&(this.maximum=de(e,"maximum",_r.defaultValues("maximum"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"base":return new cr;case"minimum":case"maximum":return 0;default:throw new Error(`Invalid member name for GeneralSubtree class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[cr.schema(t.base||{}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Jt({name:t.minimum||""})]}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Jt({name:t.maximum||""})]})]})}fromSchema(e){Te(e,["base","minimum","maximum"]);const t=Un(e,e,_r.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralSubtree");this.base=new cr({schema:t.result.base}),"minimum"in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),"maximum"in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),0!==this.minimum){let t=0;t=this.minimum instanceof Jt?this.minimum:new Jt({value:this.minimum}),e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){let t=0;t=this.maximum instanceof Jt?this.maximum:new Jt({value:this.maximum}),e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new on({value:e})}toJSON(){const e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),"maximum"in this&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}class br{constructor(e={}){"permittedSubtrees"in e&&(this.permittedSubtrees=de(e,"permittedSubtrees",br.defaultValues("permittedSubtrees"))),"excludedSubtrees"in e&&(this.excludedSubtrees=de(e,"excludedSubtrees",br.defaultValues("excludedSubtrees"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"permittedSubtrees":case"excludedSubtrees":return[];default:throw new Error(`Invalid member name for NameConstraints class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Bn({name:t.permittedSubtrees||"",value:_r.schema()})]}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Bn({name:t.excludedSubtrees||"",value:_r.schema()})]})]})}fromSchema(e){Te(e,["permittedSubtrees","excludedSubtrees"]);const t=Un(e,e,br.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for NameConstraints");"permittedSubtrees"in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,e=>new _r({schema:e}))),"excludedSubtrees"in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,e=>new _r({schema:e})))}toSchema(){const e=[];return"permittedSubtrees"in this&&e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new on({value:Array.from(this.permittedSubtrees,e=>e.toSchema())})]})),"excludedSubtrees"in this&&e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new on({value:Array.from(this.excludedSubtrees,e=>e.toSchema())})]})),new on({value:e})}toJSON(){const e={};return"permittedSubtrees"in this&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,e=>e.toJSON())),"excludedSubtrees"in this&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,e=>e.toJSON())),e}}class yr{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=de(e,"distributionPoint",yr.defaultValues("distributionPoint"))),"reasons"in e&&(this.reasons=de(e,"reasons",yr.defaultValues("reasons"))),"cRLIssuer"in e&&(this.cRLIssuer=de(e,"cRLIssuer",yr.defaultValues("cRLIssuer"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":case"cRLIssuer":return[];case"reasons":return new Kt;default:throw new Error(`Invalid member name for DistributionPoint class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ln({value:[new Ut({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Bn({name:t.distributionPointNames||"",value:cr.schema()})]}),new Ut({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:sr.schema().valueBlock.value})]})]}),new Dt({name:t.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ut({name:t.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Bn({name:t.cRLIssuerNames||"",value:cr.schema()})]})]})}fromSchema(e){Te(e,["distributionPoint","distributionPointNames","reasons","cRLIssuer","cRLIssuerNames"]);const t=Un(e,e,yr.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for DistributionPoint");"distributionPoint"in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new cr({schema:e}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new sr({schema:new on({value:t.result.distributionPoint.valueBlock.value})}))),"reasons"in t.result&&(this.reasons=new Kt({valueHex:t.result.reasons.valueBlock.valueHex})),"cRLIssuer"in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,e=>new cr({schema:e})))}toSchema(){const e=[];if("distributionPoint"in this){let t;t=this.distributionPoint instanceof Array?new Ut({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):new Ut({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new Ut({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return"reasons"in this&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex})),"cRLIssuer"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,e=>e.toSchema())})),new on({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),"reasons"in this&&(e.reasons=this.reasons.toJSON()),"cRLIssuer"in this&&(e.cRLIssuer=Array.from(this.cRLIssuer,e=>e.toJSON())),e}}class wr{constructor(e={}){this.distributionPoints=de(e,"distributionPoints",wr.defaultValues("distributionPoints")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("distributionPoints"===e)return[];throw new Error(`Invalid member name for CRLDistributionPoints class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.distributionPoints||"",value:yr.schema()})]})}fromSchema(e){Te(e,["distributionPoints"]);const t=Un(e,e,wr.schema({names:{distributionPoints:"distributionPoints"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(t.result.distributionPoints,e=>new yr({schema:e}))}toSchema(){return new on({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}class Sr{constructor(e={}){this.policyQualifierId=de(e,"policyQualifierId",Sr.defaultValues("policyQualifierId")),this.qualifier=de(e,"qualifier",Sr.defaultValues("qualifier")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new On;default:throw new Error(`Invalid member name for PolicyQualifierInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.policyQualifierId||""}),new On({name:t.qualifier||""})]})}fromSchema(e){Te(e,["policyQualifierId","qualifier"]);const t=Un(e,e,Sr.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new on({value:[new nn({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}class xr{constructor(e={}){this.policyIdentifier=de(e,"policyIdentifier",xr.defaultValues("policyIdentifier")),"policyQualifiers"in e&&(this.policyQualifiers=de(e,"policyQualifiers",xr.defaultValues("policyQualifiers"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error(`Invalid member name for PolicyInformation class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.policyIdentifier||""}),new on({optional:!0,value:[new Bn({name:t.policyQualifiers||"",value:Sr.schema()})]})]})}fromSchema(e){Te(e,["policyIdentifier","policyQualifiers"]);const t=Un(e,e,xr.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),"policyQualifiers"in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,e=>new Sr({schema:e})))}toSchema(){const e=[];return e.push(new nn({value:this.policyIdentifier})),"policyQualifiers"in this&&e.push(new on({value:Array.from(this.policyQualifiers,e=>e.toSchema())})),new on({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return"policyQualifiers"in this&&(e.policyQualifiers=Array.from(this.policyQualifiers,e=>e.toJSON())),e}}class Er{constructor(e={}){this.certificatePolicies=de(e,"certificatePolicies",Er.defaultValues("certificatePolicies")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("certificatePolicies"===e)return[];throw new Error(`Invalid member name for CertificatePolicies class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.certificatePolicies||"",value:xr.schema()})]})}fromSchema(e){Te(e,["certificatePolicies"]);const t=Un(e,e,Er.schema({names:{certificatePolicies:"certificatePolicies"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(t.result.certificatePolicies,e=>new xr({schema:e}))}toSchema(){return new on({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}class Cr{constructor(e={}){this.issuerDomainPolicy=de(e,"issuerDomainPolicy",Cr.defaultValues("issuerDomainPolicy")),this.subjectDomainPolicy=de(e,"subjectDomainPolicy",Cr.defaultValues("subjectDomainPolicy")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"issuerDomainPolicy":case"subjectDomainPolicy":return"";default:throw new Error(`Invalid member name for PolicyMapping class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.issuerDomainPolicy||""}),new nn({name:t.subjectDomainPolicy||""})]})}fromSchema(e){Te(e,["issuerDomainPolicy","subjectDomainPolicy"]);const t=Un(e,e,Cr.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new on({value:[new nn({value:this.issuerDomainPolicy}),new nn({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}class Ar{constructor(e={}){this.mappings=de(e,"mappings",Ar.defaultValues("mappings")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("mappings"===e)return[];throw new Error(`Invalid member name for PolicyMappings class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.mappings||"",value:Cr.schema()})]})}fromSchema(e){Te(e,["mappings"]);const t=Un(e,e,Ar.schema({names:{mappings:"mappings"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(t.result.mappings,e=>new Cr({schema:e}))}toSchema(){return new on({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}class Mr{constructor(e={}){"keyIdentifier"in e&&(this.keyIdentifier=de(e,"keyIdentifier",Mr.defaultValues("keyIdentifier"))),"authorityCertIssuer"in e&&(this.authorityCertIssuer=de(e,"authorityCertIssuer",Mr.defaultValues("authorityCertIssuer"))),"authorityCertSerialNumber"in e&&(this.authorityCertSerialNumber=de(e,"authorityCertSerialNumber",Mr.defaultValues("authorityCertSerialNumber"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyIdentifier":return new Wt;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new Jt;default:throw new Error(`Invalid member name for AuthorityKeyIdentifier class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Dt({name:t.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Bn({name:t.authorityCertIssuer||"",value:cr.schema()})]}),new Dt({name:t.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){Te(e,["keyIdentifier","authorityCertIssuer","authorityCertSerialNumber"]);const t=Un(e,e,Mr.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");"keyIdentifier"in t.result&&(this.keyIdentifier=new Wt({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,e=>new cr({schema:e}))),"authorityCertSerialNumber"in t.result&&(this.authorityCertSerialNumber=new Jt({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return"keyIdentifier"in this&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,e=>e.toSchema())})),"authorityCertSerialNumber"in this&&e.push(new Dt({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHex})),new on({value:e})}toJSON(){const e={};return"keyIdentifier"in this&&(e.keyIdentifier=this.keyIdentifier.toJSON()),"authorityCertIssuer"in this&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,e=>e.toJSON())),"authorityCertSerialNumber"in this&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}class kr{constructor(e={}){"requireExplicitPolicy"in e&&(this.requireExplicitPolicy=de(e,"requireExplicitPolicy",kr.defaultValues("requireExplicitPolicy"))),"inhibitPolicyMapping"in e&&(this.inhibitPolicyMapping=de(e,"inhibitPolicyMapping",kr.defaultValues("inhibitPolicyMapping"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"requireExplicitPolicy":case"inhibitPolicyMapping":return 0;default:throw new Error(`Invalid member name for PolicyConstraints class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Dt({name:t.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Dt({name:t.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){Te(e,["requireExplicitPolicy","inhibitPolicyMapping"]);const t=Un(e,e,kr.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in t.result){const e=t.result.requireExplicitPolicy;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const n=Lt(e.toBER(!1));this.requireExplicitPolicy=n.result.valueBlock.valueDec}if("inhibitPolicyMapping"in t.result){const e=t.result.inhibitPolicyMapping;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const n=Lt(e.toBER(!1));this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if("requireExplicitPolicy"in this){const t=new Jt({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("inhibitPolicyMapping"in this){const t=new Jt({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new on({value:e})}toJSON(){const e={};return"requireExplicitPolicy"in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),"inhibitPolicyMapping"in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}class Tr{constructor(e={}){this.keyPurposes=de(e,"keyPurposes",Tr.defaultValues("keyPurposes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("keyPurposes"===e)return[];throw new Error(`Invalid member name for ExtKeyUsage class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.keyPurposes||"",value:new nn})]})}fromSchema(e){Te(e,["keyPurposes"]);const t=Un(e,e,Tr.schema({names:{keyPurposes:"keyPurposes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(t.result.keyPurposes,e=>e.valueBlock.toString())}toSchema(){return new on({value:Array.from(this.keyPurposes,e=>new nn({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}class Rr{constructor(e={}){this.accessDescriptions=de(e,"accessDescriptions",Rr.defaultValues("accessDescriptions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("accessDescriptions"===e)return[];throw new Error(`Invalid member name for InfoAccess class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new Bn({name:t.accessDescriptions||"",value:ur.schema()})]})}fromSchema(e){Te(e,["accessDescriptions"]);const t=Un(e,e,Rr.schema({names:{accessDescriptions:"accessDescriptions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(t.result.accessDescriptions,e=>new ur({schema:e}))}toSchema(){return new on({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}class Pr{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let n=0;n<t;n++)this.view[n]=e.charCodeAt(n)}toString(e=0,t=this.view.length-e){let n="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let r=e;r<e+t;r++)n+=String.fromCharCode(this.view[r]);return n}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const n=new Map;n.set("0",0),n.set("1",1),n.set("2",2),n.set("3",3),n.set("4",4),n.set("5",5),n.set("6",6),n.set("7",7),n.set("8",8),n.set("9",9),n.set("A",10),n.set("a",10),n.set("B",11),n.set("b",11),n.set("C",12),n.set("c",12),n.set("D",13),n.set("d",13),n.set("E",14),n.set("e",14),n.set("F",15),n.set("f",15);let r=0,i=0;for(let s=0;s<t;s++)s%2?(i|=n.get(e.charAt(s)),this.view[r]=i,r++):i=n.get(e.charAt(s))<<4}toHexString(e=0,t=this.view.length-e){let n="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let r=e;r<e+t;r++){const e=this.view[r].toString(16).toUpperCase();n=n+(1==e.length?"0":"")+e}return n}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Pr;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Pr({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Pr;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Pr({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),n=new Uint8Array(t);e>this._view.length?n.set(this._view):n.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,n=e.length,r=e._view.subarray();this.realloc(t+n),this._view.set(r,t)}insert(e,t=0,n=this.length-t){return!(t>this.length-1||(n>this.length-t&&(n=this.length-t),n>e.length&&(n=e.length),n==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,n),t),0))}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,n,r){const{start:i,length:s,backward:a}=this.prepareFindParameters(t,n,r),o=e.length;if(o>s)return-1;const l=[];for(let t=0;t<o;t++)l.push(e.view[t]);for(let e=0;e<=s-o;e++){let t=!0;const n=a?i-o-e:i+e;for(let e=0;e<o;e++)if(this.view[e+n]!=l[e]){t=!1;break}if(t)return a?i-o-e:i+o+e}return-1}findFirstIn(e,t,n,r){const{start:i,length:s,backward:a}=this.prepareFindParameters(t,n,r),o={id:-1,position:a?0:i+s,length:0};for(let t=0;t<e.length;t++){const n=this.findPattern(e[t],i,s,a);if(-1!=n){let r=!1;const i=e[t].length;a?n-i>=o.position-o.length&&(r=!0):n-i<=o.position-o.length&&(r=!0),r&&(o.position=n,o.id=t,o.length=i)}}return o}findAllIn(e,t,n){let{start:r,length:i}=this.prepareFindParameters(t,n);const s=[];let a={id:-1,position:r};for(;;){const t=a.position;if(a=this.findFirstIn(e,a.position,i),-1==a.id)break;i-=a.position-t,s.push({id:a.id,position:a.position})}return s}findAllPatternIn(e,t,n){const{start:r,length:i}=this.prepareFindParameters(t,n),s=[],a=e.length;if(a>i)return-1;const o=Array.from(e.view);for(let e=0;e<=i-a;e++){let t=!0;const n=r+e;for(let e=0;e<a;e++)if(this.view[e+n]!=o[e]){t=!1;break}t&&(s.push(r+a+e),e+=a-1)}return s}findFirstNotIn(e,t,n,r){let{start:i,length:s,backward:a}=this.prepareFindParameters(t,n,r);const o={left:{id:-1,position:i},right:{id:-1,position:0},value:new Pr};let l=s;for(;l>0;){if(o.right=this.findFirstIn(e,a?i-s+l:i+s-l,l,a),-1==o.right.id){s=l,a?i-=s:i=o.left.position,o.value=new Pr({buffer:this._buffer.slice(i,i+s)});break}if(o.right.position!=(a?o.left.position-e[o.right.id].length:o.left.position+e[o.right.id].length)){a?(i=o.right.position+e[o.right.id].length,s=o.left.position-o.right.position-e[o.right.id].length):(i=o.left.position,s=o.right.position-o.left.position-e[o.right.id].length),o.value=new Pr({buffer:this._buffer.slice(i,i+s)});break}o.left=o.right,l-=e[o.right.id].length}if(a){const e=o.right;o.right=o.left,o.left=e}return o}findAllNotIn(e,t,n){let{start:r,length:i}=this.prepareFindParameters(t,n);const s=[];let a={left:{id:-1,position:r},right:{id:-1,position:r},value:new Pr};do{const t=a.right.position;a=this.findFirstNotIn(e,a.right.position,i),i-=a.right.position-t,s.push({left:{id:a.left.id,position:a.left.position},right:{id:a.right.id,position:a.right.position},value:a.value})}while(-1!=a.right.id);return s}findFirstSequence(e,t,n,r){let{start:i,length:s,backward:a}=this.prepareFindParameters(t,n,r);const o=this.skipNotPatterns(e,i,s,a);if(-1==o)return{position:-1,value:new Pr};const l=this.skipPatterns(e,o,s-(a?i-o:o-i),a);return a?(i=l,s=o-l):(i=o,s=l-o),{position:l,value:new Pr({buffer:this._buffer.slice(i,i+s)})}}findAllSequences(e,t,n){let{start:r,length:i}=this.prepareFindParameters(t,n);const s=[];let a={position:r,value:new Pr};do{const t=a.position;a=this.findFirstSequence(e,a.position,i),-1!=a.position&&(i-=a.position-t,s.push({position:a.position,value:a.value}))}while(-1!=a.position);return s}findPairedPatterns(e,t,n,r){const i=[];if(e.isEqual(t))return i;const{start:s,length:a}=this.prepareFindParameters(n,r);let o=0;const l=this.findAllPatternIn(e,s,a);if(!Array.isArray(l)||0==l.length)return i;const c=this.findAllPatternIn(t,s,a);if(!Array.isArray(c)||0==c.length)return i;for(;o<l.length&&0!=c.length;)if(l[0]!=c[0]){if(l[o]>c[0])break;for(;l[o]<c[0]&&(o++,!(o>=l.length)););i.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else i.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return i.sort((e,t)=>e.left-t.left),i}findPairedArrays(e,t,n,r){const{start:i,length:s}=this.prepareFindParameters(n,r),a=[];let o=0;const l=this.findAllIn(e,i,s);if(0==l.length)return a;const c=this.findAllIn(t,i,s);if(0==c.length)return a;for(;o<l.length&&0!=c.length;)if(l[0].position!=c[0].position){if(l[o].position>c[0].position)break;for(;l[o].position<c[0].position&&(o++,!(o>=l.length)););a.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else a.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return a.sort((e,t)=>e.left.position-t.left.position),a}replacePattern(e,t,n,r,i=null){let s,a=[];const o={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:l,length:c}=this.prepareFindParameters(n,r);if(null==i){if(a=this.findAllIn([e],l,c),0==a.length)return o}else a=i;o.searchPatternPositions.push(...Array.from(a,e=>e.position));const u=e.length-t.length,h=new ArrayBuffer(this.view.length-a.length*u),d=new Uint8Array(h);for(d.set(new Uint8Array(this.buffer,0,l)),s=0;s<a.length;s++){const n=0==s?l:a[s-1].position;d.set(new Uint8Array(this.buffer,n,a[s].position-e.length-n),n-s*u),d.set(t.view,a[s].position-e.length-s*u),o.replacePatternPositions.push(a[s].position-e.length-s*u)}return s--,d.set(new Uint8Array(this.buffer,a[s].position,this.length-a[s].position),a[s].position-e.length+t.length-s*u),this.buffer=h,this.view=new Uint8Array(this.buffer),o.status=1,o}skipPatterns(e,t,n,r){const{start:i,length:s,backward:a}=this.prepareFindParameters(t,n,r);let o=i;for(let t=0;t<e.length;t++){const n=e[t].length,r=a?o-n:o;let l=!0;for(let i=0;i<n;i++)if(this.view[i+r]!=e[t].view[i]){l=!1;break}if(l)if(t=-1,a){if(o-=n,o<=0)return o}else if(o+=n,o>=i+s)return o}return o}skipNotPatterns(e,t,n,r){const{start:i,length:s,backward:a}=this.prepareFindParameters(t,n,r);let o=-1;for(let t=0;t<s;t++){for(let n=0;n<e.length;n++){const r=e[n].length,s=a?i-t-r:i+t;let l=!0;for(let t=0;t<r;t++)if(this.view[t+s]!=e[n].view[t]){l=!1;break}if(l){o=a?i-t:i+t;break}}if(-1!=o)break}return o}prepareFindParameters(e=null,t=null,n=!1){return null===e&&(e=n?this.length:0),e>this.length&&(e=this.length),n?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:n}}}class Ir{constructor(e={}){this._stream=new Pr,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in e?new Pr({view:e.view}):"buffer"in e?new Pr({buffer:e.buffer}):"string"in e?new Pr({string:e.string}):"hexstring"in e?new Pr({hexstring:e.hexstring}):"stream"in e?e.stream.slice():new Pr,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(null==t||t>this.length)&&(t=this.length);const n=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==n)return n;if(this.backward){if(n<this.start-e.length-t)return-1}else if(n>this.start+e.length+t)return-1;return this.start=n,n}findFirstIn(e,t=null){(null==t||t>this.length)&&(t=this.length);const n=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==n.id)return n;if(this.backward){if(n.position<this.start-e[n.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(n.position>this.start+e[n.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=n.position,n}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(null==t||t>this._length)&&(t=this._length);const n=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==n.left.id&&-1==n.right.id)return n;if(this.backward){if(-1!=n.right.id&&n.right.position<this._start-e[n.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Pr}}else if(-1!=n.left.id&&n.left.position>this._start+e[n.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Pr};return this.backward?-1==n.left.id?this.start=0:this.start=n.left.position:-1==n.right.id?this.start=this._start+this._length:this.start=n.right.position,n}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,n=null){(null==t||t>this._length)&&(t=this._length),(null==n||n>t)&&(n=t);const r=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==r.value.length)return r;if(this.backward){if(r.position<this._start-r.value.length-n)return{position:-1,value:new Pr}}else if(r.position>this._start+r.value.length+n)return{position:-1,value:new Pr};return this.start=r.position,r}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,n=null){(null==n||n>this.length)&&(n=this.length);const r=this.backward?this.start-this.length:this.start,i=this.stream.findPairedPatterns(e,t,r,this.length);if(i.length)if(this.backward){if(i[0].right<this.start-t.length-n)return[]}else if(i[0].left>this.start+e.length+n)return[];return i}findPairedArrays(e,t,n=null){(null==n||n>this.length)&&(n=this.length);const r=this.backward?this.start-this.length:this.start,i=this.stream.findPairedArrays(e,t,r,this.length);if(i.length)if(this.backward){if(i[0].right.position<this.start-t[i[0].right.id].length-n)return[]}else if(i[0].left.position>this.start+e[i[0].left.id].length+n)return[];return i}replacePattern(e,t){const n=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,n,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),n=new Uint8Array(t.buffer);this.stream.view[this._start]=n[1],this._stream.view[this._start+1]=n[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[2],this._stream.view[this._start+1]=n[1],this._stream.view[this._start+2]=n[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[3],this._stream.view[this._start+1]=n[2],this._stream.view[this._start+2]=n[1],this._stream.view[this._start+3]=n[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[1],this._stream.view[this._start+1]=n[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[3],this._stream.view[this._start+1]=n[2],this._stream.view[this._start+2]=n[1],this._stream.view[this._start+3]=n[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);let n;if(this._length<e&&(e=this._length),this.backward){const t=this._stream.view.subarray(this._length-e,this._length);n=new Uint8Array(e);for(let r=0;r<e;r++)n[e-1-r]=t[r]}else n=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),n}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),n=32768;return t&n?-(n-(t^n)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:16777216*t[0]+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),n=2147483648;return t&n?-(n-(t^n)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Ir.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Ir.APPEND_BLOCK=1e3;class Dr{constructor(e={}){this.version=de(e,"version",Dr.defaultValues("version")),this.logID=de(e,"logID",Dr.defaultValues("logID")),this.timestamp=de(e,"timestamp",Dr.defaultValues("timestamp")),this.extensions=de(e,"extensions",Dr.defaultValues("extensions")),this.hashAlgorithm=de(e,"hashAlgorithm",Dr.defaultValues("hashAlgorithm")),this.signatureAlgorithm=de(e,"signatureAlgorithm",Dr.defaultValues("signatureAlgorithm")),this.signature=de(e,"signature",Dr.defaultValues("signature")),"schema"in e&&this.fromSchema(e.schema),"stream"in e&&this.fromStream(e.stream)}static defaultValues(e){switch(e){case"version":return 0;case"logID":case"extensions":return new ArrayBuffer(0);case"timestamp":return new Date(0);case"hashAlgorithm":case"signatureAlgorithm":return"";case"signature":return new On;default:throw new Error(`Invalid member name for SignedCertificateTimestamp class: ${e}`)}}fromSchema(e){if(e instanceof Nn==0)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Ir({stream:new Pr({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(pe(new Uint8Array(e.getBlock(8)),8));const n=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(n)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm="none";break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm="sha1";break;case 3:this.hashAlgorithm="sha224";break;case 4:this.hashAlgorithm="sha256";break;case 5:this.hashAlgorithm="sha384";break;case 6:this.hashAlgorithm="sha512";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm="anonymous";break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm="ecdsa";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const r=e.getUint16(),i=Lt(new Uint8Array(e.getBlock(r)).buffer.slice(0));if(-1===i.offset)throw new Error("Object's stream was not correct for SignedCertificateTimestamp");if(this.signature=i.result,t!==47+n+r)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Nn({data:e.stream.buffer})}toStream(){const e=new Ir;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecode.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),n=new Uint8Array(t),r=me(this.timestamp.valueOf(),8);let i,s;switch(n.set(new Uint8Array(r),8-r.byteLength),e.appendView(n),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case"none":i=0;break;case"md5":i=1;break;case"sha1":i=2;break;case"sha224":i=3;break;case"sha256":i=4;break;case"sha384":i=5;break;case"sha512":i=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}switch(e.appendChar(i),this.signatureAlgorithm.toLowerCase()){case"anonymous":s=0;break;case"rsa":s=1;break;case"dsa":s=2;break;case"ecdsa":s=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(s);const a=this.signature.toBER(!1);return e.appendUint16(a.byteLength),e.appendView(new Uint8Array(a)),e}toJSON(){return{version:this.version,logID:fe(this.logID),timestamp:this.timestamp,extensions:fe(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,n=0){let r,i=xe(Ce(this.logID)),s=null,a=new Ir;for(const t of e)if(t.log_id===i){s=t.key;break}if(null===s)throw new Error(`Public key not found for CT with logId: ${i}`);const o=Lt(Ae(Ee(s)));if(-1===o.offset)throw new Error(`Incorrect key value for CT Log with logId: ${i}`);r=new zn({schema:o.result}),a.appendChar(0),a.appendChar(0);const l=new ArrayBuffer(8),c=new Uint8Array(l),u=me(this.timestamp.valueOf(),8);return c.set(new Uint8Array(u),8-u.byteLength),a.appendView(c),a.appendUint16(n),0===n&&a.appendUint24(t.byteLength),a.appendView(new Uint8Array(t)),a.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&a.appendView(new Uint8Array(this.extensions)),tr().subtle.verifyWithPublicKey(a._stream._buffer.slice(0,a._length),{valueBlock:{valueHex:this.signature.toBER(!1)}},r,{algorithmId:""},"SHA-256")}}class Or{constructor(e={}){this.timestamps=de(e,"timestamps",Or.defaultValues("timestamps")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("timestamps"===e)return[];throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static compareWithDefault(e,t){if("timestamps"===e)return 0===t.length;throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return"optional"in t==0&&(t.optional=!1),new Wt({name:t.blockName||"SignedCertificateTimestampList",optional:t.optional})}fromSchema(e){if(e instanceof Wt==0)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Ir({stream:new Pr({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Dr({stream:t}))}toSchema(){const e=new Ir;let t=0;const n=[];for(const e of this.timestamps){const r=e.toStream();n.push(r),t+=r.stream.buffer.byteLength}e.appendUint16(t);for(const t of n)e.appendView(t.stream.view);return new Wt({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}class Lr{constructor(e={}){this.extnID=de(e,"extnID",Lr.defaultValues("extnID")),this.critical=de(e,"critical",Lr.defaultValues("critical")),this.extnValue="extnValue"in e?new Wt({valueHex:e.extnValue}):Lr.defaultValues("extnValue"),"parsedValue"in e&&(this.parsedValue=de(e,"parsedValue",Lr.defaultValues("parsedValue"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"extnID":return"";case"critical":return!1;case"extnValue":return new Wt;case"parsedValue":return{};default:throw new Error(`Invalid member name for Extension class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[new nn({name:t.extnID||""}),new Vt({name:t.critical||"",optional:!0}),new Wt({name:t.extnValue||""})]})}fromSchema(e){Te(e,["extnID","critical","extnValue"]);let t=Un(e,e,Lr.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extension");if(this.extnID=t.result.extnID.valueBlock.toString(),"critical"in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue,t=Lt(this.extnValue.valueBlock.valueHex),-1!==t.offset)switch(this.extnID){case"2.5.29.9":try{this.parsedValue=new fr({schema:t.result})}catch(e){this.parsedValue=new fr,this.parsedValue.parsingError="Incorrectly formated SubjectDirectoryAttributes"}break;case"2.5.29.14":case"2.5.29.15":case"2.5.29.20":case"2.5.29.27":case"2.5.29.21":case"2.5.29.24":case"2.5.29.54":this.parsedValue=t.result;break;case"2.5.29.16":try{this.parsedValue=new pr({schema:t.result})}catch(e){this.parsedValue=new pr,this.parsedValue.parsingError="Incorrectly formated PrivateKeyUsagePeriod"}break;case"2.5.29.17":case"2.5.29.18":try{this.parsedValue=new hr({schema:t.result})}catch(e){this.parsedValue=new hr,this.parsedValue.parsingError="Incorrectly formated AltName"}break;case"2.5.29.19":try{this.parsedValue=new mr({schema:t.result})}catch(e){this.parsedValue=new mr,this.parsedValue.parsingError="Incorrectly formated BasicConstraints"}break;case"2.5.29.28":try{this.parsedValue=new gr({schema:t.result})}catch(e){this.parsedValue=new gr,this.parsedValue.parsingError="Incorrectly formated IssuingDistributionPoint"}break;case"2.5.29.29":try{this.parsedValue=new vr({schema:t.result})}catch(e){this.parsedValue=new vr,this.parsedValue.parsingError="Incorrectly formated GeneralNames"}break;case"2.5.29.30":try{this.parsedValue=new br({schema:t.result})}catch(e){this.parsedValue=new br,this.parsedValue.parsingError="Incorrectly formated NameConstraints"}break;case"2.5.29.31":case"2.5.29.46":try{this.parsedValue=new wr({schema:t.result})}catch(e){this.parsedValue=new wr,this.parsedValue.parsingError="Incorrectly formated CRLDistributionPoints"}break;case"2.5.29.32":try{this.parsedValue=new Er({schema:t.result})}catch(e){this.parsedValue=new Er,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.33":try{this.parsedValue=new Ar({schema:t.result})}catch(e){this.parsedValue=new Ar,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.35":try{this.parsedValue=new Mr({schema:t.result})}catch(e){this.parsedValue=new Mr,this.parsedValue.parsingError="Incorrectly formated AuthorityKeyIdentifier"}break;case"2.5.29.36":try{this.parsedValue=new kr({schema:t.result})}catch(e){this.parsedValue=new kr,this.parsedValue.parsingError="Incorrectly formated PolicyConstraints"}break;case"2.5.29.37":try{this.parsedValue=new Tr({schema:t.result})}catch(e){this.parsedValue=new Tr,this.parsedValue.parsingError="Incorrectly formated ExtKeyUsage"}break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":try{this.parsedValue=new Rr({schema:t.result})}catch(e){this.parsedValue=new Rr,this.parsedValue.parsingError="Incorrectly formated InfoAccess"}break;case"1.3.6.1.4.1.11129.2.4.2":try{this.parsedValue=new Or({schema:t.result})}catch(e){this.parsedValue=new Or,this.parsedValue.parsingError="Incorrectly formated SignedCertificateTimestampList"}}}toSchema(){const e=[];return e.push(new nn({value:this.extnID})),this.critical!==Lr.defaultValues("critical")&&e.push(new Vt({value:this.critical})),e.push(this.extnValue),new on({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Lr.defaultValues("critical")&&(e.critical=this.critical),"parsedValue"in this&&"toJSON"in this.parsedValue&&(e.parsedValue=this.parsedValue.toJSON()),e}}class Br{constructor(e={}){this.extensions=de(e,"extensions",Br.defaultValues("extensions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("extensions"===e)return[];throw new Error(`Invalid member name for Extensions class: ${e}`)}static schema(e={},t=!1){const n=de(e,"names",{});return new on({optional:t,name:n.blockName||"",value:[new Bn({name:n.extensions||"",value:Lr.schema(n.extension||{})})]})}fromSchema(e){Te(e,["extensions"]);const t=Un(e,e,Br.schema({names:{extensions:"extensions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extensions");this.extensions=Array.from(t.result.extensions,e=>new Lr({schema:e}))}toSchema(){return new on({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:Array.from(this.extensions,e=>e.toJSON())}}}function Nr(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"tbsCertificate",value:[new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Jt({name:t.tbsCertificateVersion||"tbsCertificate.version"})]}),new Jt({name:t.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),Hn.schema(t.signature||{names:{blockName:"tbsCertificate.signature"}}),sr.schema(t.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new on({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[dr.schema(t.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),dr.schema(t.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),sr.schema(t.subject||{names:{blockName:"tbsCertificate.subject"}}),zn.schema(t.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new Dt({name:t.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Dt({name:t.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Br.schema(t.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}class Ur{constructor(e={}){this.tbs=de(e,"tbs",Ur.defaultValues("tbs")),this.version=de(e,"version",Ur.defaultValues("version")),this.serialNumber=de(e,"serialNumber",Ur.defaultValues("serialNumber")),this.signature=de(e,"signature",Ur.defaultValues("signature")),this.issuer=de(e,"issuer",Ur.defaultValues("issuer")),this.notBefore=de(e,"notBefore",Ur.defaultValues("notBefore")),this.notAfter=de(e,"notAfter",Ur.defaultValues("notAfter")),this.subject=de(e,"subject",Ur.defaultValues("subject")),this.subjectPublicKeyInfo=de(e,"subjectPublicKeyInfo",Ur.defaultValues("subjectPublicKeyInfo")),"issuerUniqueID"in e&&(this.issuerUniqueID=de(e,"issuerUniqueID",Ur.defaultValues("issuerUniqueID"))),"subjectUniqueID"in e&&(this.subjectUniqueID=de(e,"subjectUniqueID",Ur.defaultValues("subjectUniqueID"))),"extensions"in e&&(this.extensions=de(e,"extensions",Ur.defaultValues("extensions"))),this.signatureAlgorithm=de(e,"signatureAlgorithm",Ur.defaultValues("signatureAlgorithm")),this.signatureValue=de(e,"signatureValue",Ur.defaultValues("signatureValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":case"issuerUniqueID":case"subjectUniqueID":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new Jt;case"signature":case"signatureAlgorithm":return new Hn;case"issuer":case"subject":return new sr;case"notBefore":case"notAfter":return new dr;case"subjectPublicKeyInfo":return new zn;case"extensions":return[];case"signatureValue":return new Kt;default:throw new Error(`Invalid member name for Certificate class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new on({name:t.blockName||"",value:[Nr(t.tbsCertificate),Hn.schema(t.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new Kt({name:t.signatureValue||"signatureValue"})]})}fromSchema(e){Te(e,["tbsCertificate","tbsCertificate.extensions","tbsCertificate.version","tbsCertificate.serialNumber","tbsCertificate.signature","tbsCertificate.issuer","tbsCertificate.notBefore","tbsCertificate.notAfter","tbsCertificate.subject","tbsCertificate.subjectPublicKeyInfo","tbsCertificate.issuerUniqueID","tbsCertificate.subjectUniqueID","signatureAlgorithm","signatureValue"]);const t=Un(e,e,Ur.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Certificate");this.tbs=t.result.tbsCertificate.valueBeforeDecode,"tbsCertificate.version"in t.result&&(this.version=t.result["tbsCertificate.version"].valueBlock.valueDec),this.serialNumber=t.result["tbsCertificate.serialNumber"],this.signature=new Hn({schema:t.result["tbsCertificate.signature"]}),this.issuer=new sr({schema:t.result["tbsCertificate.issuer"]}),this.notBefore=new dr({schema:t.result["tbsCertificate.notBefore"]}),this.notAfter=new dr({schema:t.result["tbsCertificate.notAfter"]}),this.subject=new sr({schema:t.result["tbsCertificate.subject"]}),this.subjectPublicKeyInfo=new zn({schema:t.result["tbsCertificate.subjectPublicKeyInfo"]}),"tbsCertificate.issuerUniqueID"in t.result&&(this.issuerUniqueID=t.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex),"tbsCertificate.subjectUniqueID"in t.result&&(this.subjectUniqueID=t.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex),"tbsCertificate.extensions"in t.result&&(this.extensions=Array.from(t.result["tbsCertificate.extensions"],e=>new Lr({schema:e}))),this.signatureAlgorithm=new Hn({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return"version"in this&&this.version!==Ur.defaultValues("version")&&e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Jt({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new on({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),"issuerUniqueID"in this&&e.push(new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),"subjectUniqueID"in this&&e.push(new Dt({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),"extensions"in this&&e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new on({value:Array.from(this.extensions,e=>e.toSchema())})]})),new on({value:e})}toSchema(e=!1){let t={};if(!1===e){if(0===this.tbs.length)return Ur.schema().value[0];t=Lt(this.tbs).result}else t=this.encodeTBS();return new on({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:fe(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"version"in this&&this.version!==Ur.defaultValues("version")&&(e.version=this.version),"issuerUniqueID"in this&&(e.issuerUniqueID=fe(this.issuerUniqueID,0,this.issuerUniqueID.byteLength)),"subjectUniqueID"in this&&(e.subjectUniqueID=fe(this.subjectUniqueID,0,this.subjectUniqueID.byteLength)),"extensions"in this&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}getPublicKey(e=null){return tr().subtle.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}getKeyHash(e="SHA-1"){const t=nr();return void 0===t?Promise.reject("Unable to create WebCrypto object"):t.digest({name:e},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))}sign(e,t="SHA-1"){if(void 0===e)return Promise.reject("Need to provide a private key for signing");let n,r=Promise.resolve();const i=tr();return r=r.then(()=>i.subtle.getSignatureParameters(e,t)),r=r.then(e=>{n=e.parameters,this.signature=e.signatureAlgorithm,this.signatureAlgorithm=e.signatureAlgorithm}),r=r.then(()=>{this.tbs=this.encodeTBS().toBER(!1)}),r=r.then(()=>i.subtle.signWithPrivateKey(this.tbs,e,n)),r=r.then(e=>{this.signatureValue=new Kt({valueHex:e})}),r}verify(e=null){let t={};return null!==e?t=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(t=this.subjectPublicKeyInfo),t instanceof zn==0?Promise.reject("Please provide issuer certificate as a parameter"):tr().subtle.verifyWithPublicKey(this.tbs,this.signatureValue,t,this.signatureAlgorithm)}}function Hr(e){let t=e.length;for(;--t>=0;)e[t]=0}const Fr=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),zr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Vr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gr=new Array(576);Hr(Gr);const Wr=new Array(60);Hr(Wr);const qr=new Array(512);Hr(qr);const Kr=new Array(256);Hr(Kr);const $r=new Array(29);Hr($r);const Xr=new Array(30);function Yr(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let Zr,Jr,Qr;function ei(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Hr(Xr);const ti=e=>e<256?qr[e]:qr[256+(e>>>7)],ni=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ri=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,ni(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ii=(e,t,n)=>{ri(e,n[2*t],n[2*t+1])},si=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},ai=(e,t,n)=>{const r=new Array(16);let i,s,a=0;for(i=1;i<=15;i++)a=a+n[i-1]<<1,r[i]=a;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=si(r[t]++,t))}},oi=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},li=e=>{e.bi_valid>8?ni(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},ci=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},ui=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&ci(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!ci(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},hi=(e,t,n)=>{let r,i,s,a,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,i=e.pending_buf[e.sym_buf+o++],0===r?ii(e,i,t):(s=Kr[i],ii(e,s+256+1,t),a=Fr[s],0!==a&&(i-=$r[s],ri(e,i,a)),r--,s=ti(r),ii(e,s,n),a=jr[s],0!==a&&(r-=Xr[s],ri(e,r,a)))}while(o<e.sym_next);ii(e,256,t)},di=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let a,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<s;a++)0!==n[2*a]?(e.heap[++e.heap_len]=c=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=c,a=e.heap_len>>1;a>=1;a--)ui(e,n,a);l=s;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ui(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,n[2*l]=n[2*a]+n[2*o],e.depth[l]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,n[2*a+1]=n[2*o+1]=l,e.heap[1]=l++,ui(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,h,d,f,p,m=0;for(d=0;d<=15;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],d=n[2*n[2*u+1]+1]+1,d>l&&(d=l,m++),n[2*u+1]=d,u>r||(e.bl_count[d]++,f=0,u>=o&&(f=a[u-o]),p=n[2*u],e.opt_len+=p*(d+f),s&&(e.static_len+=p*(i[2*u+1]+f)));if(0!==m){do{for(d=l-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(d=l;0!==d;d--)for(u=e.bl_count[d];0!==u;)h=e.heap[--c],h>r||(n[2*h+1]!==d&&(e.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),u--)}})(e,t),ai(n,c,e.bl_count)},fi=(e,t,n)=>{let r,i,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++o<l&&i===a||(o<c?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=i,0===a?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4))},pi=(e,t,n)=>{let r,i,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++o<l&&i===a)){if(o<c)do{ii(e,i,e.bl_tree)}while(0!==--o);else 0!==i?(i!==s&&(ii(e,i,e.bl_tree),o--),ii(e,16,e.bl_tree),ri(e,o-3,2)):o<=10?(ii(e,17,e.bl_tree),ri(e,o-3,3)):(ii(e,18,e.bl_tree),ri(e,o-11,7));o=0,s=i,0===a?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4)}};let mi=!1;const gi=(e,t,n,r)=>{ri(e,0+(r?1:0),3),li(e),ni(e,n),ni(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var vi={_tr_init:e=>{mi||((()=>{let e,t,n,r,i;const s=new Array(16);for(n=0,r=0;r<28;r++)for($r[r]=n,e=0;e<1<<Fr[r];e++)Kr[n++]=r;for(Kr[n-1]=r,i=0,r=0;r<16;r++)for(Xr[r]=i,e=0;e<1<<jr[r];e++)qr[i++]=r;for(i>>=7;r<30;r++)for(Xr[r]=i<<7,e=0;e<1<<jr[r]-7;e++)qr[256+i++]=r;for(t=0;t<=15;t++)s[t]=0;for(e=0;e<=143;)Gr[2*e+1]=8,e++,s[8]++;for(;e<=255;)Gr[2*e+1]=9,e++,s[9]++;for(;e<=279;)Gr[2*e+1]=7,e++,s[7]++;for(;e<=287;)Gr[2*e+1]=8,e++,s[8]++;for(ai(Gr,287,s),e=0;e<30;e++)Wr[2*e+1]=5,Wr[2*e]=si(e,5);Zr=new Yr(Gr,Fr,257,286,15),Jr=new Yr(Wr,jr,0,30,15),Qr=new Yr(new Array(0),zr,0,19,7)})(),mi=!0),e.l_desc=new ei(e.dyn_ltree,Zr),e.d_desc=new ei(e.dyn_dtree,Jr),e.bl_desc=new ei(e.bl_tree,Qr),e.bi_buf=0,e.bi_valid=0,oi(e)},_tr_stored_block:gi,_tr_flush_block:(e,t,n,r)=>{let i,s,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),di(e,e.l_desc),di(e,e.d_desc),a=(e=>{let t;for(fi(e,e.dyn_ltree,e.l_desc.max_code),fi(e,e.dyn_dtree,e.d_desc.max_code),di(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Vr[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&-1!==t?gi(e,t,n,r):4===e.strategy||s===i?(ri(e,2+(r?1:0),3),hi(e,Gr,Wr)):(ri(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(ri(e,t-257,5),ri(e,n-1,5),ri(e,r-4,4),i=0;i<r;i++)ri(e,e.bl_tree[2*Vr[i]+1],3);pi(e,e.dyn_ltree,t-1),pi(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),hi(e,e.dyn_ltree,e.dyn_dtree)),oi(e),r&&li(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Kr[n]+256+1)]++,e.dyn_dtree[2*ti(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{ri(e,2,3),ii(e,256,Gr),(e=>{16===e.bi_valid?(ni(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},_i=(e,t,n,r)=>{let i=65535&e,s=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{i=i+t[r++]|0,s=s+i|0}while(--a);i%=65521,s%=65521}return i|s<<16};const bi=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var yi=(e,t,n,r)=>{const i=bi,s=r+n;e^=-1;for(let n=r;n<s;n++)e=e>>>8^i[255&(e^t[n])];return-1^e},wi={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Si={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:xi,_tr_stored_block:Ei,_tr_flush_block:Ci,_tr_tally:Ai,_tr_align:Mi}=vi,{Z_NO_FLUSH:ki,Z_PARTIAL_FLUSH:Ti,Z_FULL_FLUSH:Ri,Z_FINISH:Pi,Z_BLOCK:Ii,Z_OK:Di,Z_STREAM_END:Oi,Z_STREAM_ERROR:Li,Z_DATA_ERROR:Bi,Z_BUF_ERROR:Ni,Z_DEFAULT_COMPRESSION:Ui,Z_FILTERED:Hi,Z_HUFFMAN_ONLY:Fi,Z_RLE:ji,Z_FIXED:zi,Z_DEFAULT_STRATEGY:Vi,Z_UNKNOWN:Gi,Z_DEFLATED:Wi}=Si,qi=258,Ki=262,$i=42,Xi=113,Yi=666,Zi=(e,t)=>(e.msg=wi[t],t),Ji=e=>2*e-(e>4?9:0),Qi=e=>{let t=e.length;for(;--t>=0;)e[t]=0},es=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let ts=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ns=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},rs=(e,t)=>{Ci(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ns(e.strm)},is=(e,t)=>{e.pending_buf[e.pending++]=t},ss=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},as=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=_i(e.adler,t,i,n):2===e.state.wrap&&(e.adler=yi(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},os=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-Ki?e.strstart-(e.w_size-Ki):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+qi;let f=c[s+a-1],p=c[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,c[n+a]===p&&c[n+a-1]===f&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<d);if(r=qi-(d-s),s=d-qi,r>a){if(e.match_start=t,a=r,r>=o)break;f=c[s+a-1],p=c[s+a]}}}while((t=h[t&u])>l&&0!==--i);return a<=e.lookahead?a:e.lookahead},ls=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ki)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),es(e),r+=t),0===e.strm.avail_in)break;if(n=as(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=ts(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=ts(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ki&&0!==e.strm.avail_in)},cs=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(0===n&&t!==Pi||t===ki||n!==r+e.strm.avail_in))break;a=t===Pi&&n===r+e.strm.avail_in?1:0,Ei(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ns(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(as(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==ki&&t!==Pi&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(as(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===Pi)&&t!==ki&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===Pi&&0===e.strm.avail_in&&n===r?1:0,Ei(e,e.block_start,n,a),e.block_start+=n,ns(e.strm)),a?3:1)},us=(e,t)=>{let n,r;for(;;){if(e.lookahead<Ki){if(ls(e),e.lookahead<Ki&&t===ki)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ts(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Ki&&(e.match_length=os(e,n)),e.match_length>=3)if(r=Ai(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ts(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ts(e,e.ins_h,e.window[e.strstart+1]);else r=Ai(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(rs(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Pi?(rs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rs(e,!1),0===e.strm.avail_out)?1:2},hs=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Ki){if(ls(e),e.lookahead<Ki&&t===ki)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ts(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ki&&(e.match_length=os(e,n),e.match_length<=5&&(e.strategy===Hi||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Ai(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=ts(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(rs(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=Ai(e,0,e.window[e.strstart-1]),r&&rs(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Ai(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Pi?(rs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rs(e,!1),0===e.strm.avail_out)?1:2};function ds(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const fs=[new ds(0,0,0,0,cs),new ds(4,4,8,4,us),new ds(4,5,16,8,us),new ds(4,6,32,32,us),new ds(4,4,16,16,hs),new ds(8,16,32,32,hs),new ds(8,16,128,128,hs),new ds(8,32,128,256,hs),new ds(32,128,258,1024,hs),new ds(32,258,258,4096,hs)];function ps(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Wi,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Qi(this.dyn_ltree),Qi(this.dyn_dtree),Qi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Qi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Qi(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ms=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==$i&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Xi&&t.status!==Yi?1:0},gs=e=>{if(ms(e))return Zi(e,Li);e.total_in=e.total_out=0,e.data_type=Gi;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?$i:Xi,e.adler=2===t.wrap?0:1,t.last_flush=-2,xi(t),Di},vs=e=>{const t=gs(e);return t===Di&&(e=>{e.window_size=2*e.w_size,Qi(e.head),e.max_lazy_match=fs[e.level].max_lazy,e.good_match=fs[e.level].good_length,e.nice_match=fs[e.level].nice_length,e.max_chain_length=fs[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},_s=(e,t,n,r,i,s)=>{if(!e)return Li;let a=1;if(t===Ui&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==Wi||r<8||r>15||t<0||t>9||s<0||s>zi||8===r&&1!==a)return Zi(e,Li);8===r&&(r=9);const o=new ps;return e.state=o,o.strm=e,o.status=$i,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=s,o.method=n,vs(e)};var bs=_s,ys=(e,t)=>ms(e)||2!==e.state.wrap?Li:(e.state.gzhead=t,Di),ws=(e,t)=>{if(ms(e)||t>Ii||t<0)return e?Zi(e,Li):Li;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Yi&&t!==Pi)return Zi(e,0===e.avail_out?Ni:Li);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(ns(e),0===e.avail_out)return n.last_flush=-1,Di}else if(0===e.avail_in&&Ji(t)<=Ji(r)&&t!==Pi)return Zi(e,Ni);if(n.status===Yi&&0!==e.avail_in)return Zi(e,Ni);if(n.status===$i&&0===n.wrap&&(n.status=Xi),n.status===$i){let t=Wi+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=Fi||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,ss(n,t),0!==n.strstart&&(ss(n,e.adler>>>16),ss(n,65535&e.adler)),e.adler=1,n.status=Xi,ns(e),0!==n.pending)return n.last_flush=-1,Di}if(57===n.status)if(e.adler=0,is(n,31),is(n,139),is(n,8),n.gzhead)is(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),is(n,255&n.gzhead.time),is(n,n.gzhead.time>>8&255),is(n,n.gzhead.time>>16&255),is(n,n.gzhead.time>>24&255),is(n,9===n.level?2:n.strategy>=Fi||n.level<2?4:0),is(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(is(n,255&n.gzhead.extra.length),is(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=yi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(is(n,0),is(n,0),is(n,0),is(n,0),is(n,0),is(n,9===n.level?2:n.strategy>=Fi||n.level<2?4:0),is(n,3),n.status=Xi,ns(e),0!==n.pending)return n.last_flush=-1,Di;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=yi(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,ns(e),0!==n.pending)return n.last_flush=-1,Di;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=yi(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=yi(e.adler,n.pending_buf,n.pending-r,r)),ns(e),0!==n.pending)return n.last_flush=-1,Di;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,is(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=yi(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=yi(e.adler,n.pending_buf,n.pending-r,r)),ns(e),0!==n.pending)return n.last_flush=-1,Di;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,is(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=yi(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ns(e),0!==n.pending))return n.last_flush=-1,Di;is(n,255&e.adler),is(n,e.adler>>8&255),e.adler=0}if(n.status=Xi,ns(e),0!==n.pending)return n.last_flush=-1,Di}if(0!==e.avail_in||0!==n.lookahead||t!==ki&&n.status!==Yi){let r=0===n.level?cs(n,t):n.strategy===Fi?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(ls(e),0===e.lookahead)){if(t===ki)return 1;break}if(e.match_length=0,n=Ai(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(rs(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Pi?(rs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rs(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===ji?((e,t)=>{let n,r,i,s;const a=e.window;for(;;){if(e.lookahead<=qi){if(ls(e),e.lookahead<=qi&&t===ki)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){s=e.strstart+qi;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);e.match_length=qi-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Ai(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Ai(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(rs(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Pi?(rs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(rs(e,!1),0===e.strm.avail_out)?1:2})(n,t):fs[n.level].func(n,t);if(3!==r&&4!==r||(n.status=Yi),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),Di;if(2===r&&(t===Ti?Mi(n):t!==Ii&&(Ei(n,0,0,!1),t===Ri&&(Qi(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ns(e),0===e.avail_out))return n.last_flush=-1,Di}return t!==Pi?Di:n.wrap<=0?Oi:(2===n.wrap?(is(n,255&e.adler),is(n,e.adler>>8&255),is(n,e.adler>>16&255),is(n,e.adler>>24&255),is(n,255&e.total_in),is(n,e.total_in>>8&255),is(n,e.total_in>>16&255),is(n,e.total_in>>24&255)):(ss(n,e.adler>>>16),ss(n,65535&e.adler)),ns(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Di:Oi)},Ss=e=>{if(ms(e))return Li;const t=e.state.status;return e.state=null,t===Xi?Zi(e,Bi):Di},xs=(e,t)=>{let n=t.length;if(ms(e))return Li;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==$i||r.lookahead)return Li;if(1===i&&(e.adler=_i(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(Qi(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const s=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,ls(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=ts(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,ls(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=o,e.avail_in=s,r.wrap=i,Di};const Es=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Cs=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Es(n,t)&&(e[t]=n[t])}}return e},As=e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,i=e.length;t<i;t++){let i=e[t];n.set(i,r),r+=i.length}return n};let Ms=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ms=!1}const ks=new Uint8Array(256);for(let e=0;e<256;e++)ks[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ks[254]=ks[254]=1;var Ts=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,s,a=e.length,o=0;for(i=0;i<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),s=0,i=0;s<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},Rs=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){s[i++]=t;continue}let a=ks[t];if(a>4)s[i++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?s[i++]=65533:t<65536?s[i++]=t:(t-=65536,s[i++]=55296|t>>10&1023,s[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ms)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(s,i)},Ps=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+ks[e[n]]>t?n:t},Is=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ds=Object.prototype.toString,{Z_NO_FLUSH:Os,Z_SYNC_FLUSH:Ls,Z_FULL_FLUSH:Bs,Z_FINISH:Ns,Z_OK:Us,Z_STREAM_END:Hs,Z_DEFAULT_COMPRESSION:Fs,Z_DEFAULT_STRATEGY:js,Z_DEFLATED:zs}=Si;function Vs(e){this.options=Cs({level:Fs,method:zs,chunkSize:16384,windowBits:15,memLevel:8,strategy:js},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Is,this.strm.avail_out=0;let n=bs(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Us)throw new Error(wi[n]);if(t.header&&ys(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ts(t.dictionary):"[object ArrayBuffer]"===Ds.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=xs(this.strm,e),n!==Us)throw new Error(wi[n]);this._dict_set=!0}}function Gs(e,t){const n=new Vs(t);if(n.push(e,!0),n.err)throw n.msg||wi[n.err];return n.result}Vs.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Ns:Os,"string"==typeof e?n.input=Ts(e):"[object ArrayBuffer]"===Ds.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Ls||s===Bs)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=ws(n,s),i===Hs)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Ss(this.strm),this.onEnd(i),this.ended=!0,i===Us;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Vs.prototype.onData=function(e){this.chunks.push(e)},Vs.prototype.onEnd=function(e){e===Us&&(this.result=As(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ws={Deflate:Vs,deflate:Gs,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Gs(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Gs(e,t)},constants:Si};const qs=16209;var Ks=function(e,t){let n,r,i,s,a,o,l,c,u,h,d,f,p,m,g,v,_,b,y,w,S,x,E,C;const A=e.state;n=e.next_in,E=e.input,r=n+(e.avail_in-5),i=e.next_out,C=e.output,s=i-(t-e.avail_out),a=i+(e.avail_out-257),o=A.dmax,l=A.wsize,c=A.whave,u=A.wnext,h=A.window,d=A.hold,f=A.bits,p=A.lencode,m=A.distcode,g=(1<<A.lenbits)-1,v=(1<<A.distbits)-1;e:do{f<15&&(d+=E[n++]<<f,f+=8,d+=E[n++]<<f,f+=8),_=p[d&g];t:for(;;){if(b=_>>>24,d>>>=b,f-=b,b=_>>>16&255,0===b)C[i++]=65535&_;else{if(!(16&b)){if(64&b){if(32&b){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=qs;break e}_=p[(65535&_)+(d&(1<<b)-1)];continue t}for(y=65535&_,b&=15,b&&(f<b&&(d+=E[n++]<<f,f+=8),y+=d&(1<<b)-1,d>>>=b,f-=b),f<15&&(d+=E[n++]<<f,f+=8,d+=E[n++]<<f,f+=8),_=m[d&v];;){if(b=_>>>24,d>>>=b,f-=b,b=_>>>16&255,16&b){if(w=65535&_,b&=15,f<b&&(d+=E[n++]<<f,f+=8,f<b&&(d+=E[n++]<<f,f+=8)),w+=d&(1<<b)-1,w>o){e.msg="invalid distance too far back",A.mode=qs;break e}if(d>>>=b,f-=b,b=i-s,w>b){if(b=w-b,b>c&&A.sane){e.msg="invalid distance too far back",A.mode=qs;break e}if(S=0,x=h,0===u){if(S+=l-b,b<y){y-=b;do{C[i++]=h[S++]}while(--b);S=i-w,x=C}}else if(u<b){if(S+=l+u-b,b-=u,b<y){y-=b;do{C[i++]=h[S++]}while(--b);if(S=0,u<y){b=u,y-=b;do{C[i++]=h[S++]}while(--b);S=i-w,x=C}}}else if(S+=u-b,b<y){y-=b;do{C[i++]=h[S++]}while(--b);S=i-w,x=C}for(;y>2;)C[i++]=x[S++],C[i++]=x[S++],C[i++]=x[S++],y-=3;y&&(C[i++]=x[S++],y>1&&(C[i++]=x[S++]))}else{S=i-w;do{C[i++]=C[S++],C[i++]=C[S++],C[i++]=C[S++],y-=3}while(y>2);y&&(C[i++]=C[S++],y>1&&(C[i++]=C[S++]))}break}if(64&b){e.msg="invalid distance code",A.mode=qs;break e}_=m[(65535&_)+(d&(1<<b)-1)]}}break}}while(n<r&&i<a);y=f>>3,n-=y,f-=y<<3,d&=(1<<f)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),A.hold=d,A.bits=f};const $s=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Xs=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ys=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Zs=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Js=(e,t,n,r,i,s,a,o)=>{const l=o.bits;let c,u,h,d,f,p,m=0,g=0,v=0,_=0,b=0,y=0,w=0,S=0,x=0,E=0,C=null;const A=new Uint16Array(16),M=new Uint16Array(16);let k,T,R,P=null;for(m=0;m<=15;m++)A[m]=0;for(g=0;g<r;g++)A[t[n+g]]++;for(b=l,_=15;_>=1&&0===A[_];_--);if(b>_&&(b=_),0===_)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(v=1;v<_&&0===A[v];v++);for(b<v&&(b=v),S=1,m=1;m<=15;m++)if(S<<=1,S-=A[m],S<0)return-1;if(S>0&&(0===e||1!==_))return-1;for(M[1]=0,m=1;m<15;m++)M[m+1]=M[m]+A[m];for(g=0;g<r;g++)0!==t[n+g]&&(a[M[t[n+g]]++]=g);if(0===e?(C=P=a,p=20):1===e?(C=$s,P=Xs,p=257):(C=Ys,P=Zs,p=0),E=0,g=0,m=v,f=s,y=b,w=0,h=-1,x=1<<b,d=x-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){k=m-w,a[g]+1<p?(T=0,R=a[g]):a[g]>=p?(T=P[a[g]-p],R=C[a[g]-p]):(T=96,R=0),c=1<<m-w,u=1<<y,v=u;do{u-=c,i[f+(E>>w)+u]=k<<24|T<<16|R}while(0!==u);for(c=1<<m-1;E&c;)c>>=1;if(0!==c?(E&=c-1,E+=c):E=0,g++,0===--A[m]){if(m===_)break;m=t[n+a[g]]}if(m>b&&(E&d)!==h){for(0===w&&(w=b),f+=v,y=m-w,S=1<<y;y+w<_&&(S-=A[y+w],!(S<=0));)y++,S<<=1;if(x+=1<<y,1===e&&x>852||2===e&&x>592)return 1;h=E&d,i[h]=b<<24|y<<16|f-s}}return 0!==E&&(i[f+E]=m-w<<24|64<<16),o.bits=b,0};const{Z_FINISH:Qs,Z_BLOCK:ea,Z_TREES:ta,Z_OK:na,Z_STREAM_END:ra,Z_NEED_DICT:ia,Z_STREAM_ERROR:sa,Z_DATA_ERROR:aa,Z_MEM_ERROR:oa,Z_BUF_ERROR:la,Z_DEFLATED:ca}=Si,ua=16180,ha=16190,da=16191,fa=16192,pa=16194,ma=16199,ga=16200,va=16206,_a=16209,ba=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function ya(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const wa=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<ua||t.mode>16211?1:0},Sa=e=>{if(wa(e))return sa;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ua,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,na},xa=e=>{if(wa(e))return sa;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Sa(e)},Ea=(e,t)=>{let n;if(wa(e))return sa;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?sa:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,xa(e))},Ca=(e,t)=>{if(!e)return sa;const n=new ya;e.state=n,n.strm=e,n.window=null,n.mode=ua;const r=Ea(e,t);return r!==na&&(e.state=null),r};let Aa,Ma,ka=!0;const Ta=e=>{if(ka){Aa=new Int32Array(512),Ma=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Js(1,e.lens,0,288,Aa,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Js(2,e.lens,0,32,Ma,0,e.work,{bits:5}),ka=!1}e.lencode=Aa,e.lenbits=9,e.distcode=Ma,e.distbits=5},Ra=(e,t,n,r)=>{let i;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var Pa=xa,Ia=Ca,Da=(e,t)=>{let n,r,i,s,a,o,l,c,u,h,d,f,p,m,g,v,_,b,y,w,S,x,E=0;const C=new Uint8Array(4);let A,M;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(wa(e)||!e.output||!e.input&&0!==e.avail_in)return sa;n=e.state,n.mode===da&&(n.mode=fa),a=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,h=o,d=l,x=na;e:for(;;)switch(n.mode){case ua:if(0===n.wrap){n.mode=fa;break}for(;u<16;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&c,C[1]=c>>>8&255,n.check=yi(n.check,C,2,0),c=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=_a;break}if((15&c)!==ca){e.msg="unknown compression method",n.mode=_a;break}if(c>>>=4,u-=4,S=8+(15&c),0===n.wbits&&(n.wbits=S),S>15||S>n.wbits){e.msg="invalid window size",n.mode=_a;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:da,c=0,u=0;break;case 16181:for(;u<16;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(n.flags=c,(255&n.flags)!==ca){e.msg="unknown compression method",n.mode=_a;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=_a;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=yi(n.check,C,2,0)),c=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,n.check=yi(n.check,C,4,0)),c=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=yi(n.check,C,2,0)),c=0,u=0,n.mode=16184;case 16184:if(1024&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=yi(n.check,C,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(f=n.length,f>o&&(f=o),f&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+f),S)),512&n.flags&&4&n.wrap&&(n.check=yi(n.check,r,f,s)),o-=f,s+=f,n.length-=f),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;f=0;do{S=r[s+f++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=yi(n.check,r,f,s)),o-=f,s+=f,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;f=0;do{S=r[s+f++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=yi(n.check,r,f,s)),o-=f,s+=f,S)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=_a;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=da;break;case 16189:for(;u<32;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}e.adler=n.check=ba(c),c=0,u=0,n.mode=ha;case ha:if(0===n.havedict)return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=u,ia;e.adler=n.check=1,n.mode=da;case da:if(t===ea||t===ta)break e;case fa:if(n.last){c>>>=7&u,u-=7&u,n.mode=va;break}for(;u<3;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}switch(n.last=1&c,c>>>=1,u-=1,3&c){case 0:n.mode=16193;break;case 1:if(Ta(n),n.mode=ma,t===ta){c>>>=2,u-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=_a}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=_a;break}if(n.length=65535&c,c=0,u=0,n.mode=pa,t===ta)break e;case pa:n.mode=16195;case 16195:if(f=n.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;i.set(r.subarray(s,s+f),a),o-=f,s+=f,l-=f,a+=f,n.length-=f;break}n.mode=da;break;case 16196:for(;u<14;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=_a;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}n.lens[k[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[k[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},x=Js(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,x){e.msg="invalid code lengths set",n.mode=_a;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;E=n.lencode[c&(1<<n.lenbits)-1],g=E>>>24,v=E>>>16&255,_=65535&E,!(g<=u);){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(_<16)c>>>=g,u-=g,n.lens[n.have++]=_;else{if(16===_){for(M=g+2;u<M;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=_a;break}S=n.lens[n.have-1],f=3+(3&c),c>>>=2,u-=2}else if(17===_){for(M=g+3;u<M;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}c>>>=g,u-=g,S=0,f=3+(7&c),c>>>=3,u-=3}else{for(M=g+7;u<M;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}c>>>=g,u-=g,S=0,f=11+(127&c),c>>>=7,u-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=_a;break}for(;f--;)n.lens[n.have++]=S}}if(n.mode===_a)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=_a;break}if(n.lenbits=9,A={bits:n.lenbits},x=Js(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,x){e.msg="invalid literal/lengths set",n.mode=_a;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},x=Js(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,x){e.msg="invalid distances set",n.mode=_a;break}if(n.mode=ma,t===ta)break e;case ma:n.mode=ga;case ga:if(o>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=u,Ks(e,d),a=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,n.mode===da&&(n.back=-1);break}for(n.back=0;E=n.lencode[c&(1<<n.lenbits)-1],g=E>>>24,v=E>>>16&255,_=65535&E,!(g<=u);){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(v&&!(240&v)){for(b=g,y=v,w=_;E=n.lencode[w+((c&(1<<b+y)-1)>>b)],g=E>>>24,v=E>>>16&255,_=65535&E,!(b+g<=u);){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,n.length=_,0===v){n.mode=16205;break}if(32&v){n.back=-1,n.mode=da;break}if(64&v){e.msg="invalid literal/length code",n.mode=_a;break}n.extra=15&v,n.mode=16201;case 16201:if(n.extra){for(M=n.extra;u<M;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;E=n.distcode[c&(1<<n.distbits)-1],g=E>>>24,v=E>>>16&255,_=65535&E,!(g<=u);){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(!(240&v)){for(b=g,y=v,w=_;E=n.distcode[w+((c&(1<<b+y)-1)>>b)],g=E>>>24,v=E>>>16&255,_=65535&E,!(b+g<=u);){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,64&v){e.msg="invalid distance code",n.mode=_a;break}n.offset=_,n.extra=15&v,n.mode=16203;case 16203:if(n.extra){for(M=n.extra;u<M;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=_a;break}n.mode=16204;case 16204:if(0===l)break e;if(f=d-l,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=_a;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),m=n.window}else m=i,p=a-n.offset,f=n.length;f>l&&(f=l),l-=f,n.length-=f;do{i[a++]=m[p++]}while(--f);0===n.length&&(n.mode=ga);break;case 16205:if(0===l)break e;i[a++]=n.length,l--,n.mode=ga;break;case va:if(n.wrap){for(;u<32;){if(0===o)break e;o--,c|=r[s++]<<u,u+=8}if(d-=l,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?yi(n.check,i,d,a-d):_i(n.check,i,d,a-d)),d=l,4&n.wrap&&(n.flags?c:ba(c))!==n.check){e.msg="incorrect data check",n.mode=_a;break}c=0,u=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;u<32;){if(0===o)break e;o--,c+=r[s++]<<u,u+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=_a;break}c=0,u=0}n.mode=16208;case 16208:x=ra;break e;case _a:x=aa;break e;case 16210:return oa;default:return sa}return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<_a&&(n.mode<va||t!==Qs))&&Ra(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?yi(n.check,i,d,e.next_out-d):_i(n.check,i,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===da?128:0)+(n.mode===ma||n.mode===pa?256:0),(0===h&&0===d||t===Qs)&&x===na&&(x=la),x},Oa=e=>{if(wa(e))return sa;let t=e.state;return t.window&&(t.window=null),e.state=null,na},La=(e,t)=>{if(wa(e))return sa;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,na):sa},Ba=(e,t)=>{const n=t.length;let r,i,s;return wa(e)?sa:(r=e.state,0!==r.wrap&&r.mode!==ha?sa:r.mode===ha&&(i=1,i=_i(i,t,n,0),i!==r.check)?aa:(s=Ra(e,t,n,n),s?(r.mode=16210,oa):(r.havedict=1,na)))},Na=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ua=Object.prototype.toString,{Z_NO_FLUSH:Ha,Z_FINISH:Fa,Z_OK:ja,Z_STREAM_END:za,Z_NEED_DICT:Va,Z_STREAM_ERROR:Ga,Z_DATA_ERROR:Wa,Z_MEM_ERROR:qa}=Si;function Ka(e){this.options=Cs({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Is,this.strm.avail_out=0;let n=Ia(this.strm,t.windowBits);if(n!==ja)throw new Error(wi[n]);if(this.header=new Na,La(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ts(t.dictionary):"[object ArrayBuffer]"===Ua.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ba(this.strm,t.dictionary),n!==ja)))throw new Error(wi[n])}function $a(e,t){const n=new Ka(t);if(n.push(e),n.err)throw n.msg||wi[n.err];return n.result}Ka.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Fa:Ha,"[object ArrayBuffer]"===Ua.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Da(n,a),s===Va&&i&&(s=Ba(n,i),s===ja?s=Da(n,a):s===Wa&&(s=Va));n.avail_in>0&&s===za&&n.state.wrap>0&&0!==e[n.next_in];)Pa(n),s=Da(n,a);switch(s){case Ga:case Wa:case Va:case qa:return this.onEnd(s),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||s===za))if("string"===this.options.to){let e=Ps(n.output,n.next_out),t=n.next_out-e,i=Rs(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==ja||0!==o){if(s===za)return s=Oa(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Ka.prototype.onData=function(e){this.chunks.push(e)},Ka.prototype.onEnd=function(e){e===ja&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=As(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Xa={Inflate:Ka,inflate:$a,inflateRaw:function(e,t){return(t=t||{}).raw=!0,$a(e,t)},ungzip:$a,constants:Si};const{Deflate:Ya,deflate:Za,deflateRaw:Ja,gzip:Qa}=Ws,{Inflate:eo,inflate:to,inflateRaw:no,ungzip:ro}=Xa;var so=ro;function ao(e){return ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ao(e)}function oo(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(ao(e)+" is not iterable")}function lo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s,a,o=[],l=!0,c=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return o}}(e,t)||go(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function co(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return uo(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(uo(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,uo(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,uo(h,"constructor",c),uo(c,"constructor",l),l.displayName="GeneratorFunction",uo(c,i,"GeneratorFunction"),uo(h),uo(h,i,"Generator"),uo(h,r,function(){return this}),uo(h,"toString",function(){return"[object Generator]"}),(co=function(){return{w:s,m:d}})()}function uo(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}uo=function(e,t,n,r){function s(t,n){uo(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},uo(e,t,n,r)}function ho(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function fo(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){ho(s,r,i,a,o,"next",e)}function o(e){ho(s,r,i,a,o,"throw",e)}a(void 0)})}}function po(e){return function(e){if(Array.isArray(e))return vo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||go(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=go(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function go(e,t){if(e){if("string"==typeof e)return vo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vo(e,t):void 0}}function vo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var _o="prod",bo=function(){var e=Date.now(),t=new Date(e),n=t.toLocaleDateString("en-US"),r=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return"".concat(n," ").concat(r)},yo=function(e){"auto"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.setAttribute("data-bs-theme",e)};yo("light");var wo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.querySelector("#bd-theme");if(n){var r=document.querySelector("#bd-theme-text"),i=document.querySelector(".theme-icon-active use"),s=document.querySelector('[data-bs-theme-value="'.concat(e,'"]')),a=s.querySelector("svg use").getAttribute("href");document.querySelectorAll("[data-bs-theme-value]").forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-pressed","false")}),s.classList.add("active"),s.setAttribute("aria-pressed","true"),i.setAttribute("href",a);var o="".concat(r.textContent," (").concat(s.dataset.bsThemeValue,")");n.setAttribute("aria-label",o),t&&n.focus()}};function So(){wo("light"),document.querySelectorAll("[data-bs-theme-value]").forEach(function(e){e.addEventListener("click",function(){var t=e.getAttribute("data-bs-theme-value");localStorage.setItem("theme",t),yo(t),wo(t,!0)})})}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){"light"===storedTheme&&"dark"===storedTheme||yo("light")}),window.addEventListener("DOMContentLoaded",function(){So()});var xo,Eo,Co=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/javascript";return new Promise(function(r,i){try{var s=document.createElement("script");s.type=n,s.async=t,s.src=e,s.addEventListener("load",function(e){r({status:!0})}),s.addEventListener("error",function(e){r({status:!1,message:"Failed to load the script ＄{FILE_URL}"})}),document.body.appendChild(s)}catch(e){r({status:!1,message:"util.js > loadScript> err: ＄{JSON.stringify(error)}"})}})},Ao=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise(function(t){return setTimeout(t,e)})},Mo=function(e,t){if(t){var n=t,r=document.createElement("canvas");r.width=e,r.height=e/(n.width||n.videoWidth)*(n.height||n.videoHeight);var i=r.getContext("2d",{willReadFrequently:!0});i.drawImage(t,0,0,i.canvas.width,i.canvas.height);var s=i.canvas.toDataURL("image/jpeg");return r=null,i=null,s}},ko=function(e,t){var n;if(t[2]&&t[3]){var r=e,i=t,s=r.videoWidth,a=r.videoHeight,o=document.createElement("canvas");o.width=s,o.height=a;var l=o.getContext("2d",{willReadFrequently:!0});l.drawImage(r,0,0);var c=(n=l).getImageData.apply(n,po(i));o.width=i[2],o.height=i[3],l.putImageData(c,0,0);var u=l.canvas.toDataURL("image/jpeg");return o=null,l=null,u}},To=function(e){var t=new Date(e),n=Date.now()-t;return Math.floor(n/6e4)},Ro=function(e,t){var n=t.bbox;Lo(e,t),Po(n[0],n[1],e),Po(n[0]+n[2],n[1],e),Po(n[0]+n[2],n[1]+n[3],e),Po(n[0],n[1]+n[3],e)},Po=function(e,t,n){n.fillStyle="lightgreen",n.globalAlpha=.5,n.strokeStyle="rgba(0, 128, 0, 1)",n.lineWidth=1,n.beginPath(),n.arc(e,t,6,0,2*Math.PI),n.fill(),n.closePath()},Io=function(e,t,n){n.bbox,n.img;var r=Oo.apply(void 0,[e,t].concat(po(n.scissorPos1.map(function(e){return e+2*n.radius})),[2*n.radius]))||Oo.apply(void 0,[e,t].concat(po(n.scissorPos2.map(function(e){return e+2*n.radius})),[2*n.radius]))||Oo.apply(void 0,[e,t].concat(po(n.scissorPos3.map(function(e){return e+2*n.radius})),[2*n.radius]))||Oo.apply(void 0,[e,t].concat(po(n.scissorPos4.map(function(e){return e+2*n.radius})),[2*n.radius]));return!!r},Do=function(e,t,n){return Oo(e,t,n.bbox[0],n.bbox[1],n.radius)?(n.bbox[0]=n.bbox[0]+n.bbox[2],n.bbox[1]=n.bbox[1]+n.bbox[3],!0):Oo(e,t,n.bbox[0]+n.bbox[2],n.bbox[1],n.radius)?(n.bbox[1]=n.bbox[1]+n.bbox[3],!0):Oo(e,t,n.bbox[0],n.bbox[1]+n.bbox[3],n.radius)?(n.bbox[0]=n.bbox[0]+n.bbox[2],!0):!!Oo(e,t,n.bbox[0]+n.bbox[2],n.bbox[1]+n.bbox[3],n.radius)},Oo=function(e,t,n,r,i){return Math.pow(e-n,2)+Math.pow(t-r,2)<Math.pow(i,2)},Lo=function(e,t){var n=t.bbox,r=t.img;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="lightgreen",e.globalAlpha=.2,e.strokeStyle="rgba(0, 128, 0, 1)",e.lineWidth=1,e.roundRect.apply(e,po(n).concat([3])),e.stroke(),e.fillRect.apply(e,po(n)),Math.abs(n[2])>4*t.radius&&Math.abs(n[3])>4*t.radius&&(t.scissorPos1=[n[0]-r.width/2+n[2]/2,n[1]-r.height/2],t.scissorPos2=[n[0]-r.width/2+n[2],n[1]+n[3]/2-r.height/2],t.scissorPos3=[n[0]-r.width/2+n[2]/2,n[1]+n[3]-r.height/2],t.scissorPos4=[n[0]-r.width/2,n[1]+n[3]/2-r.height/2],e.drawImage.apply(e,[r].concat(po(t.scissorPos1),[r.width,r.height])),e.drawImage.apply(e,[r].concat(po(t.scissorPos2),[r.width,r.height])),e.drawImage.apply(e,[r].concat(po(t.scissorPos3),[r.width,r.height])),e.drawImage.apply(e,[r].concat(po(t.scissorPos4),[r.width,r.height])))},Bo=function(){var e=fo(co().m(function e(t,n,r,i){var s,a,o,l,c,u;return co().w(function(e){for(;;)switch(e.n){case 0:return a=r,o=i,l=(s=t).getContext("2d"),c=function(){return new Promise(function(e,t){var n=new Image,r=new Image;n.src="img/scissors.svg",n.width=n.height=24,r.src="img/x-square.svg",r.width=r.height=24;var i={viewportRatio:1,radius:6,bbox:[0,0,0,0],scissorPos1:[0,0],scissorPos2:[0,0],scissorPos3:[0,0],scissorPos4:[0,0],img:n,reset_img:r,isDragging:!1,isScaling:!1,offsetX:0,offsetY:0,reset:function(){i.bbox=[0,0,0,0],i.isDragging=!1,i.isScaling=!1,i.offsetX=0,i.offsetY=0,i.scissorPos1=[0,0],i.scissorPos2=[0,0],i.scissorPos3=[0,0],i.scissorPos4=[0,0],l.clearRect(0,0,l.canvas.width,l.canvas.height)},refactor:function(e,t,n){return!(!i.offsetX||!i.offsetY)&&(i.bbox[0]=i.bbox[2]>0?Math.max(0,i.bbox[0]):i.bbox[0]+i.bbox[2],i.bbox[1]=i.bbox[3]>0?Math.max(0,i.bbox[1]):i.bbox[1]+i.bbox[3],i.bbox[2]=Math.min(e,Math.abs(i.bbox[2])),i.bbox[3]=Math.min(t,Math.abs(i.bbox[3])),i.viewportRatio=n,i.bbox.slice().map(function(e){return e*i.viewportRatio}))}};n.onload=function(){i.img=n,e(i)}})},e.n=1,c();case 1:u=e.v,s.addEventListener("mousedown",function(e){t.width=n.offsetWidth,t.height=n.offsetHeight;var r=e.clientX-s.getBoundingClientRect().left,i=e.clientY-s.getBoundingClientRect().top;if(u.offsetX=r-u.bbox[0],u.offsetY=i-u.bbox[1],Do(r,i,u))return cl("inside a corner; update original"),void(u.isScaling=!0);if(Io(r,i,u)){cl("inside a scissor");var a=u.refactor(n.offsetWidth,n.offsetHeight,n.videoWidth/n.offsetWidth);return clearTimeout(Eo),void(Eo=setTimeout(function(){o&&o(a),u.reset()},100))}r>=u.bbox[0]&&r<u.bbox[0]+u.bbox[2]&&i>=u.bbox[1]&&i<u.bbox[1]+u.bbox[3]||r>=u.bbox[0]+u.bbox[2]&&r<u.bbox[0]&&i>=u.bbox[1]+u.bbox[3]&&i<u.bbox[1]||r>=u.bbox[0]&&r<u.bbox[0]+u.bbox[2]&&i>=u.bbox[1]+u.bbox[3]&&i<u.bbox[1]||r>=u.bbox[0]+u.bbox[2]&&r<u.bbox[0]&&i>=u.bbox[1]&&i<u.bbox[1]+u.bbox[3]?u.isDragging=!0:r>=0&&r<=s.width&&i>=0&&i<=s.height&&(u.reset(),u.isDragging=!0,u.bbox[0]=r,u.bbox[1]=i)}),document.addEventListener("mousemove",function(e){var t=e.clientX-s.getBoundingClientRect().left,n=e.clientY-s.getBoundingClientRect().top;if(Io(t,n,u)?s.style.cursor="pointer":s.style.cursor="auto",u.isScaling)return u.bbox[2]=t-u.bbox[0],u.bbox[3]=n-u.bbox[1],void Ro(l,u);if(u.isDragging){if(0!=u.offsetX&&0!=u.offsetY)return u.bbox[0]=t-u.offsetX,u.bbox[1]=n-u.offsetY,void Ro(l,u);u.bbox[2]=t-u.bbox[0],u.bbox[3]=n-u.bbox[1],Ro(l,u)}}),document.addEventListener("mouseup",function(e){if(t.width=n.offsetWidth,t.height=n.offsetHeight,u.isScaling&&(u.isScaling=!1,u.offsetX&&u.offsetY))cl("scaling completed. rectangle: ".concat(JSON.stringify(u)));else if(u.isDragging){u.isDragging=!1,cl("rectangle ".concat(JSON.stringify(u)));var r=u.refactor(n.offsetWidth,n.offsetHeight,n.videoWidth/n.offsetWidth);r&&(clearTimeout(xo),xo=setTimeout(function(){a&&a(r)},100)),Ro(l,u)}}),Lo(l,u);case 2:return e.a(2)}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}(),No=function(e){var t=new Date(1e3*e);return{year:t.getFullYear(),month:String(t.getMonth()+1).padStart(2,"0"),day:String(t.getDate()).padStart(2,"0"),hours:String(t.getHours()).padStart(2,"0"),minutes:String(t.getMinutes()).padStart(2,"0"),seconds:String(t.getSeconds()).padStart(2,"0")}},Uo=function(e){var t=No(e),n=t.year,r=t.month,i=t.day,s=t.hours,a=t.minutes,o=t.seconds;return"".concat(r,"-").concat(i," '").concat(n-2e3," ").concat(s,":").concat(a,":").concat(o)},Ho=function(e){var t=No(e),n=t.year,r=t.month,i=t.day;return"".concat(r,"-").concat(i," '").concat(n-2e3)},Fo=function(e,t){var n=1e3*e,r=1e3*t,i=Date.now();return i>=n&&i<=r},jo=function(e,t){return Object.keys(e).find(function(n){return e[n]===t})},zo=function(e){var t,n=[],r=mo(e.split("/"));try{for(r.s();!(t=r.n()).done;){var i=t.value;""!==i&&"."!==i&&(".."===i?n.length>0&&n.pop():n.push(i))}}catch(e){r.e(e)}finally{r.f()}return"/"+n.join("/")},Vo=function(e){return(e=(e=e.replace(/\//g,"_").replace(/ /g,"_")).replace(/[^a-zA-Z0-9_]+/g,"")).toLowerCase()},Go=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t},Wo=function(e,t){var n,r=e.map(Number),i=new Set(po(Array(t).keys())),s=new Set(r),a=[],o=mo(i);try{for(o.s();!(n=o.n()).done;){var l=n.value;s.has(l)||a.push(l)}}catch(e){o.e(e)}finally{o.f()}return a},qo="",Ko="",$o={},Xo={},Yo={tenant:{apiKeys:{},subscriptions:{},subject:{},cred:{},ice_offers:{},processors:[],notifications:[],file_map:{},file_info_map:{sum:{},dir:{cert:"/inori/cert",pkey:"/inori/pvtKey",bridge_cert:"/inori/cert_bridge",bridge_pkey:"/inori/pvtKey_bridge",admin_cert:"/inori/cert_admin",admin_pkey:"/inori/pvtKey_admin",tmp_cert:"/inori/tmp_cert",tmp_pkey:"/inori/tmp_pvtKey"},desc:{cert:"tenant's license",pkey:"tenant's private key",bridge_cert:"bridge license",bridge_pkey:"bridge private key",admin_cert:"admin's license",admin_pkey:"admin's private key",tmp_cert:"temporary license",tmp_pkey:"temporary private key"}}},leads:{list:[]},channels:{list:[]},ice_offers:{},ice_services:{},remote_processor_list:{list:[]},tenants:{list:[]},subjects:{list:[]},subject_reqs:{},message_infos:{},directory_list:{root:"",files:[]},mini_files:{path:{}},content:{},geo_locations:{list:[]},file_chunks:{}},Zo={},Jo=!1,Qo=qo,el={},tl=new Map,nl=!1;if("undefined"==typeof Worker)throw"worker is not avaialble in this browser";var rl,il,sl,al,ol,ll=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];!function(e,t,n){var r,i=mo(n);try{for(i.s();!(r=i.n()).done;){var s,a=r.value;if(Array.isArray(a)){var o,l=[],c=mo(a);try{for(c.s();!(o=c.n()).done;){var u=o.value;Array.isArray(u)?l.push.apply(l,po(u)):l.push(u)}}catch(e){c.e(e)}finally{c.f()}(s=console).log.apply(s,["[".concat(e,": ").concat(bo(),"]")].concat(l))}}}catch(e){i.e(e)}finally{i.f()}}(_o,0,t)},cl=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];$o.postMessage({label:"local:system:event:<string>",data:t})},ul=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];$o.postMessage({label:"local:system:event:<string>",data:"exception: ".concat(t.join(" "))})},hl=function(e){return new Promise(function(t){var n=!1;Ao(5e3).then(function(){n||t(!1)});var r="tenant:data:chunk:pub_key:signed:<bytes>";window.addEventListener(r,function(){var e=fo(co().m(function e(i){return co().w(function(e){for(;;)switch(e.n){case 0:return n=!0,e.n=1,Vl(i.detail.content);case 1:if(e.v){e.n=2;break}return ul("received ".concat(r,"; invalid cert")),e.a(2,t(!1));case 2:t(!0);case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),r="tenant:data:x509:content:received:<subject>",window.addEventListener(r,function(){var e=fo(co().m(function e(r){return co().w(function(e){for(;;)switch(e.n){case 0:n=!0,t(!0);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),pl({to:qo,label:"tenant:data:x509:content:<subject>",data:e})})},dl=function(){var e=fo(co().m(function e(){var t;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pl();case 1:return t=e.v,$o.postMessage({from:Qo,to:Qo,label:"local:register:<bytes>",data:t.publicKey.asBuffer()}),e.a(2,new Promise(function(e){var t=!1,n="tenant:data:chunk:pub_key:signed:<bytes>";window.addEventListener(n,function(){var r=fo(co().m(function r(i){return co().w(function(r){for(;;)switch(r.n){case 0:return t=!0,r.n=1,Vl(i.detail.content);case 1:if(r.v){r.n=2;break}return ul("received ".concat(n,"; invalid cert")),r.a(2,e(!1));case 2:e(!0);case 3:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),Ao(5e3).then(function(){t||e(!1)})}))}},e)}));return function(){return e.apply(this,arguments)}}(),fl=function(){var e=fo(co().m(function e(){var t,n,r,i,s;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!Jo){e.n=1;break}return e.a(2);case 1:return e.n=2,kl();case 2:if(!(t=e.v)){e.n=4;break}if(n=t.asCert(),!(r=Ll(n)).serialnumber||!r.serialnumber.val){e.n=4;break}return Yo.tenant.subject=r,e.n=3,Yl(Qo);case 3:return i=e.v,$o.postMessage({from:Qo,to:Qo,label:"local:authenticate:<bytes>",data:{id:r.serialnumber.val,metadata:i}}),e.a(2,new Promise(function(e){var t=!1;window.addEventListener("admin:data:tenant:content:received:<tenant>",function(n){t=!0,Jo=!0,wc().filter(function(e){return e.isLocalVideoStream||e.isLocalScreenStream}).forEach(function(e){e.self_register()}),Yo.tenant.apiKeys.goog=n.detail.content.metadata,e(Yo.tenant.subject)},{once:!0}),Ao(5e3).then(function(){t||e(!1)})}));case 4:e.n=6;break;case 5:return e.p=5,s=e.v,ul(s),e.a(2,Promise.resolve(!1));case 6:return e.a(2)}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}(),pl=function(e){e.label_2_forward=e.label,e.label="local:bridge:send",e.from=e.from||Qo,e.to=e.to||qo,$o.postMessage(e)},ml=function(){var e=fo(co().m(function e(){var t,n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.ipify.org?format=json");case 1:return t=e.v,e.n=2,t.json();case 2:n=e.v,cl("geolocation updated for ".concat(n.ip)),pl({label:"tenant:data:geo:content:<geo_location>",data:{query:n.ip}});case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),gl=function(e){e.label_2_forward=e.label,e.label="local:peer:send",e.from=Qo,$o.postMessage(e)},vl=function(e){e.label="local:peer:rcvd",e.to=Qo,$o.postMessage(e)},_l=function(e,t){var n=bl(e);return"-----BEGIN ".concat(t,"-----\n").concat(Sl(n,64).join("\n"),"\n-----END ").concat(t,"-----\n")},bl=function(e){for(var t=new Uint8Array(e),n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return window.btoa(n)},yl=function(e,t){for(var n="-----BEGIN ".concat(t,"-----\n"),r="\n-----END ".concat(t,"-----\n"),i=e.substring(n.length,e.length-r.length),s=atob(i),a=s.length,o=new ArrayBuffer(a),l=new Uint8Array(o),c=0;c<a;c++)l[c]=s.charCodeAt(c);return o},wl=function(e){var t=Array.from(new Uint8Array(e)).map(function(e){return e.toString(16).padStart(2,"0")});return t.join("")},Sl=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},xl=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,crypto.subtle.digest("SHA-256",t);case 1:return n=e.v,e.a(2,wl(n))}},e)}));return function(t){return e.apply(this,arguments)}}(),El=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ic(t,"application/octet-stream");case 1:if((n=e.v)&&!((null==n?void 0:n.byteLength)<1)){e.n=2;break}return e.a(2,null);case 2:return e.a(2,{sum:function(){var e=fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,xl(n);case 1:return e.a(2,e.v)}},e)}));return function(){return e.apply(this,arguments)}}()})}},e)}));return function(t){return e.apply(this,arguments)}}(),Cl=function(){var e=fo(co().m(function e(){var t;return co().w(function(e){for(;;)switch(e.n){case 0:return t=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,El(t);case 1:if(n=e.v){e.n=2;break}return e.a(2,"");case 2:return e.n=3,n.sum();case 3:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),e.n=1,t(Yo.tenant.file_info_map.dir.cert);case 1:return Yo.tenant.file_info_map.sum.cert=e.v,e.n=2,t(Yo.tenant.file_info_map.dir.pkey);case 2:return Yo.tenant.file_info_map.sum.pkey=e.v,e.n=3,t(Yo.tenant.file_info_map.dir.bridge_cert);case 3:return Yo.tenant.file_info_map.sum.bridge_cert=e.v,e.n=4,t(Yo.tenant.file_info_map.dir.bridge_pkey);case 4:return Yo.tenant.file_info_map.sum.bridge_pkey=e.v,e.n=5,t(Yo.tenant.file_info_map.dir.admin_cert);case 5:return Yo.tenant.file_info_map.sum.admin_cert=e.v,e.n=6,t(Yo.tenant.file_info_map.dir.admin_pkey);case 6:Yo.tenant.file_info_map.sum.admin_pkey=e.v;case 7:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Al=function(){return Yo.subjects.list=Yo.subjects.list.filter(function(e){return e}),Yo.subjects.list},Ml=function(e){var t=Yo.subjects.list.find(function(t){return t.tenantId==e.tenantId});return!!t&&(Yo.subject_reqs[t.tenantId]?(Yo.subject_reqs[t.tenantId].push(e),!0):(Yo.subject_reqs[t.tenantId]=[e],!0))},kl=function(){var e=fo(co().m(function e(){var t,n,r=arguments;return co().w(function(e){for(;;)switch(e.n){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"/inori/cert",e.n=1,Ic(t,"application/octet-stream");case 1:if((n=e.v)&&!((null==n?void 0:n.byteLength)<1)){e.n=2;break}return e.a(2,null);case 2:return e.a(2,Nl(n))}},e)}));return function(){return e.apply(this,arguments)}}(),Tl=function(){var e=fo(co().m(function e(){var t,n,r=arguments;return co().w(function(e){for(;;)switch(e.n){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"/inori/pvtKey",e.n=1,Ic(t,"application/octet-stream");case 1:if(n=e.v){e.n=2;break}return e.a(2,!1);case 2:return e.a(2,Ul(n))}},e)}));return function(){return e.apply(this,arguments)}}(),Rl=function(){var e=fo(co().m(function e(){var t,n,r=arguments;return co().w(function(e){for(;;)switch(e.n){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"/inori/pubKey",e.n=1,Ic(t,"application/octet-stream");case 1:if(n=e.v){e.n=2;break}return e.a(2,!1);case 2:return e.a(2,Hl(n))}},e)}));return function(){return e.apply(this,arguments)}}(),Pl=function(){var e=fo(co().m(function e(){var t,n,r,i,s,a,o,l,c=arguments;return co().w(function(e){for(;;)switch(e.n){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:"/inori/pvtKey",n=c.length>1&&void 0!==c[1]?c[1]:"/inori/pubKey",e.n=1,Tl(t);case 1:return r=e.v,e.n=2,Rl(n);case 2:if(i=e.v,r&&i){e.n=8;break}return e.n=3,Il();case 3:return s=e.v,a=s.publicKey,o=s.privateKey,e.n=4,Fc(o,t);case 4:return e.n=5,Fc(a,n);case 5:return e.n=6,Tl(t);case 6:return r=e.v,e.n=7,Rl(n);case 7:i=e.v;case 8:return l={publicKey:i,privateKey:r},e.a(2,l)}},e)}));return function(){return e.apply(this,arguments)}}(),Il=function(){var e=fo(co().m(function e(){var t,n,r;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]);case 1:return t=e.v,e.n=2,window.crypto.subtle.exportKey("spki",t.publicKey);case 2:return n=e.v,e.n=3,window.crypto.subtle.exportKey("pkcs8",t.privateKey);case 3:return r=e.v,e.a(2,{publicKey:n,privateKey:r})}},e)}));return function(){return e.apply(this,arguments)}}(),Dl=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.importKey("spki",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);case 1:return n=e.v,e.a(2,n)}},e)}));return function(t){return e.apply(this,arguments)}}(),Ol=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.importKey("pkcs8",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]);case 1:return n=e.v,e.a(2,n)}},e)}));return function(t){return e.apply(this,arguments)}}(),Ll=function(e){var t={},n=Zc.getX509Sbj();return e.subject.typesAndValues.forEach(function(e){var r=n[e.type];r&&3==r.length&&(t[r[0].toLowerCase()]={val:e.value.valueBlock.value,desc:r[1],proto:r[2]})}),t},Bl=function(e){var t=Lt(e);return new Ur({schema:t.result})},Nl=function(e){var t={asCert:function(){return Bl(e)},asString:function(){return _l(e,"CERTIFICATE")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=t.asString(),n=new Blob([e],{type:"application/octet-stream"}),r=document.createElement("a"),i=URL.createObjectURL(n);r.href=i,r.download="".concat(Qo,".cer"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}};return t},Ul=function(e){var t,n={asKey:(t=fo(co().m(function t(){return co().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Ol(e);case 1:return t.a(2,t.v)}},t)})),function(){return t.apply(this,arguments)}),asString:function(){return _l(e,"PRIVATE KEY")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=n.asString(),t=new Blob([e],{type:"application/octet-stream"}),r=document.createElement("a"),i=URL.createObjectURL(t);r.href=i,r.download="".concat(Qo,".key"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}};return n},Hl=function(e){var t,n={asKey:(t=fo(co().m(function t(){return co().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Dl(e);case 1:return t.a(2,t.v)}},t)})),function(){return t.apply(this,arguments)}),asString:function(){return _l(e,"PUBLIC KEY")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=n.asString(),t=new Blob([e],{type:"application/octet-stream"}),r=document.createElement("a"),i=URL.createObjectURL(t);r.href=i,r.download="".concat(Qo,".pub"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}};return n},Fl=function(e){var t=yl(e,"CERTIFICATE");return Nl(t)},jl=function(e){var t=yl(e,"PRIVATE KEY");return Ul(t)},zl=function(e){var t=yl(e,"PUBLIC KEY");return Hl(t)},Vl=function(){var e=fo(co().m(function e(t){var n,r,i,s,a,o;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,Ko){e.n=1;break}throw"invalid SYS_CERT";case 1:return e.n=2,Bl(t);case 2:return n=e.v,e.n=3,Kl(Ko,n);case 3:if((r=e.v).certIssuer,r.issuerSubject,i=r.isValidIssuer,s=r.signatureVerified,i&&s){e.n=4;break}return e.a(2,!1);case 4:return e.n=5,Fc(t.buffer,"/inori/cert");case 5:if(!(a=Ll(n)).tid||!a.tid.val){e.n=6;break}return Yo.tenant.subject=a,e.a(2,!0);case 6:return e.a(2,!1);case 7:return e.p=7,o=e.v,ul("_update_cert > err: ".concat(o)),e.a(2,!1)}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),Gl=function(){var e=fo(co().m(function e(t){var n,r,i,s,a;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,Ko){e.n=1;break}throw"invalid SYS_CERT";case 1:return e.n=2,Bl(t);case 2:return n=e.v,e.n=3,Kl(Ko,n);case 3:if((r=e.v).certIssuer,r.issuerSubject,i=r.isValidIssuer,s=r.signatureVerified,i&&s){e.n=4;break}return e.a(2,!1);case 4:return e.n=5,Fc(t.buffer,Yo.tenant.file_info_map.dir.bridge_cert);case 5:return e.a(2,n);case 6:return e.p=6,a=e.v,ul("_add_bridge_cert > err: ".concat(a)),e.a(2,!1)}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),Wl=function(){var e=fo(co().m(function e(t,n){var r,i,s,a,o;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Bl(t);case 1:return r=e.v,e.n=2,Kl(n,r);case 2:if((i=e.v).certIssuer,i.issuerSubject,s=i.isValidIssuer,a=i.signatureVerified,s&&a){e.n=3;break}return e.a(2,!1);case 3:return e.n=4,Fc(t.buffer,"/inori/cert_admin");case 4:return e.a(2,r);case 5:return e.p=5,o=e.v,ul("_add_admin_cert > err: ".concat(o)),e.a(2,!1)}},e,null,[[0,5]])}));return function(t,n){return e.apply(this,arguments)}}(),ql=function(){var e=fo(co().m(function e(t,n,r){var i,s,a,o,l,c,u;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,kl();case 1:return i=e.v,e.n=2,null==i?void 0:i.asCert();case 2:return s=e.v,e.n=3,Bl(t);case 3:if(a=e.v,!s){e.n=5;break}return e.n=4,Kl(a,s);case 4:if((o=e.v).certIssuer,o.issuerSubject,l=o.isValidIssuer,c=o.signatureVerified,l&&c){e.n=5;break}return e.a(2,!1);case 5:return Ko=a,qo=r.toLowerCase(),Qo=n.toLowerCase(),e.n=6,xl(t);case 6:return Yo.tenant.file_info_map.sum.ca_cert=e.v,e.a(2,!0);case 7:return e.p=7,u=e.v,ul("_update_root_cert > err: ".concat(u)),e.a(2,!1)}},e,null,[[0,7]])}));return function(t,n,r){return e.apply(this,arguments)}}(),Kl=function(){var e=fo(co().m(function e(t,n){var r,i,s,a,o;return co().w(function(e){for(;;)switch(e.n){case 0:if(r=n.issuer.typesAndValues.map(function(e){return"".concat(e.type,": ").concat(e.value.valueBlock.value)}).join("\n"),i=t.subject.typesAndValues.map(function(e){return"".concat(e.type,": ").concat(e.value.valueBlock.value)}).join("\n"),s=n.issuer.isEqual(t.subject),a=nr()){e.n=1;break}throw new Error("No WebCrypto extension found");case 1:return e.n=2,t.getPublicKey();case 2:return e.v,e.n=3,n.verify(t,a);case 3:return o=e.v,e.a(2,{certIssuer:r,issuerSubject:i,isValidIssuer:s,signatureVerified:o})}},e)}));return function(t,n){return e.apply(this,arguments)}}(),$l=function(e,t){var n=function(e){var t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!1),t},r=n(e.byteLength),i=n(t.byteLength),s=r.byteLength+e.byteLength+i.byteLength+t.byteLength,a=new ArrayBuffer(s),o=new Uint8Array(a),l=0;return o.set(new Uint8Array(r),l),l+=r.byteLength,o.set(new Uint8Array(e),l),l+=e.byteLength,o.set(new Uint8Array(i),l),l+=i.byteLength,o.set(new Uint8Array(t),l),a},Xl=function(){var e=fo(co().m(function e(t){var n,r,i,s,a,o,l;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pl();case 1:return n=e.v,e.n=2,n.privateKey.asKey();case 2:if(r=e.v){e.n=3;break}return e.a(2,null);case 3:return i=new TextEncoder,s=i.encode(t),e.n=4,crypto.subtle.digest("SHA-256",s);case 4:return a=e.v,e.n=5,crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},r,a);case 5:return o=e.v,l=$l(o,a),e.a(2,{signature:o,hash:a,joined:l})}},e)}));return function(t){return e.apply(this,arguments)}}(),Yl=function(){var e=fo(co().m(function e(t){var n,r;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Xl(Qo);case 1:return(n=e.v).signature,n.hash,r=n.joined,e.a(2,wl(r))}},e)}));return function(t){return e.apply(this,arguments)}}(),Zl=function(){var e=fo(co().m(function e(){var t,n,r,i,s,a;return co().w(function(e){for(;;)switch(e.n){case 0:return t=Yo.tenant.file_info_map.dir,e.n=1,Pl(t.admin_pkey,t.admin_cert);case 1:return n=e.v,r=n.publicKey,n.privateKey,i=new Promise(function(e){window.addEventListener("tenant:data:chunk:pub_key:admin:signed:<bytes>",function(){var t=fo(co().m(function t(n){return co().w(function(t){for(;;)switch(t.n){case 0:e(n.detail.content);case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),{once:!0})}),s=new Promise(function(e){window.addEventListener("tenant:data:chunk:pvt_key:bridge:<bytes>",function(){var n=fo(co().m(function n(r){return co().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,Ol(r.detail.content);case 1:return n.n=2,Fc(r.detail.content,t.bridge_pkey);case 2:e(!0);case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0})}),a=new Promise(function(e){var t="tenant:data:chunk:pub_key:bridge:signed:<bytes>";window.addEventListener(t,function(){var n=fo(co().m(function n(r){var i;return co().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,Gl(r.detail.content);case 1:if(i=n.v){n.n=2;break}return ul("received ".concat(t,"; invalid cert")),n.a(2,e(!1));case 2:e(i);case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0})}),pl({label:"tenant:data:chunk:pub_key:admin:<bytes>",data:r.asBuffer()}),e.a(2,{admCertPms:i,bridgePkeyPms:s,bridgeCertPms:a})}},e)}));return function(){return e.apply(this,arguments)}}(),Jl=function(){var e=!1;return new Promise(function(){var t=fo(co().m(function t(n){var r,i,s,a,o,l,c;return co().w(function(t){for(;;)switch(t.n){case 0:return Ao(5e3).then(function(){e||n(!1)}),t.n=1,Zl();case 1:return r=t.v,i=r.admCertPms,s=r.bridgePkeyPms,a=r.bridgeCertPms,t.n=2,i;case 2:return o=t.v,t.n=3,s;case 3:return l=t.v,t.n=4,a;case 4:return c=t.v,t.n=5,Wl(o,c);case 5:if(t.v){t.n=6;break}return ul("_bootstrap_bridge_keypairs > _upd_admin_cert > invalid cert"),t.a(2,n(!1));case 6:return t.n=7,Cl();case 7:n(o&&l&&c),e=!0;case 8:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())},Ql=function(){var t=fo(co().m(function t(n){return co().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,r){try{FS.mkdir(n),FS.mount(IDBFS,{},n),FS.syncfs(!0,function(i){if(i)r(i);else{var s=!1;if(FS.readdir("".concat(n)).indexOf("logs")<0&&(FS.mkdir("".concat(n,"/logs")),s=!0),FS.readdir("".concat(n)).indexOf("video")<0&&(FS.mkdir("".concat(n,"/video")),s=!0),FS.readdir("".concat(n)).indexOf("model")<0&&(FS.mkdir("".concat(n,"/model")),s=!0),FS.readdir("".concat(n)).indexOf("image")<0&&(FS.mkdir("".concat(n,"/image")),s=!0),FS.readdir("".concat(n,"/image")).indexOf("mini")<0&&(FS.mkdir("".concat(n,"/image/mini")),s=!0),FS.readdir("".concat(n,"/model")).indexOf("json")<0&&(FS.mkdir("".concat(n,"/model/json")),s=!0),FS.readdir("".concat(n,"/model")).indexOf("json")<0&&(FS.mkdir("".concat(n,"/model/json")),s=!0),FS.readdir("".concat(n,"/model")).indexOf("weight")<0&&(FS.mkdir("".concat(n,"/model/weight")),s=!0),s)return FS.syncfs(!1,function(n){return n?(ul("_bootstrap_fs > err: ".concat(e)),r(e),t(!1)):(cl("_bootstrap_fs > files re-sync"),t(!0))}),t(!1);t(!0)}})}catch(e){ul("_bootstrap_fs > err: ".concat(e)),r(e)}}))},t)}));return function(e){return t.apply(this,arguments)}}(),ec=function(){return!!(Yo.tenants&&Yo.tenants.list&&Yo.tenants.list.length>0)&&Yo.tenants.list.filter(function(e){return e})},tc=function(){var e=ec();return e?e.filter(function(e){return e.device}):[]},nc=function(){return Object.keys(Xo.HardwareVendor.values).map(function(e){return{name:e,id:Xo.HardwareVendor.values[e]}})},rc=function(e){var t=lc(e),n=Object.keys(Xo.Role.values).filter(function(e){return Xo.Role.values[e]==t.role});if(n.length>0)return n[0]},ic=function(e){Yo.remote_processor_list.list.find(function(t){return t.id.toLowerCase()==e.id.toLowerCase()})||Yo.remote_processor_list.list.push(e)},sc=function(e){e&&e.list&&e.list.forEach(function(e){ic(e)}),ac()},ac=function(){var e=Yo.remote_processor_list.list.filter(function(e){return Yo.tenants.list.find(function(t){return e.sessionId.toLowerCase()==t.sessionId.toLowerCase()})});Yo.remote_processor_list.list=e.filter(function(e){return e})},oc=function(e){Yo.tenants.list.length?(new Map(Yo.tenants.list.map(function(e){return[e.sessionId.toLowerCase(),e]})),e.list.forEach(function(e){var t=e.sessionId.toLowerCase(),n=(e.id.toLowerCase(),Yo.tenants.list.find(function(e){return e.sessionId.toLowerCase()===t}));n?n.sessionId!==Qo&&(Object.entries(Yo.tenant.subscriptions).forEach(function(e){var r=lo(e,2),i=r[0],s=r[1];i.toLowerCase()===n.sessionId.toLowerCase()&&i.toLowerCase()!==t&&(s.sessionId=t,Yo.tenant.subscriptions[t]=s,delete Yo.tenant.subscriptions[i])}),Object.assign(n,e)):Yo.tenants.list.push(e)}),Yo.tenants.list=Yo.tenants.list.filter(function(t){return!!e.list.some(function(e){return e.sessionId.toLowerCase()===t.sessionId.toLowerCase()})||(delete Yo.tenant.subscriptions[t.sessionId.toLowerCase()],!1)})):Yo.tenants=e},lc=function(e){return Yo.tenants.list.find(function(t){return(null==t?void 0:t.sessionId.toLowerCase())==e.toLowerCase()})},cc=function(){var e=fo(co().m(function e(){var t,n,r;return co().w(function(e){for(;;)switch(e.n){case 0:for(t=wc(),n=0;n<t.length;n++)((r=t[n]).isLocalScreenStream||r.isLocalVideoStream)&&r.mediaStream&&r.dat.sessionId;case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),uc=function(){var e=fo(co().m(function e(t){var n,r;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(n=$c("screen-preview-".concat(Qo))).streamInitCallback=function(){var e=fo(co().m(function e(t){var r,i;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:r=0;case 1:if(!(r<3)){e.n=5;break}return e.p=2,e.n=3,n.self_register();case 3:return e.a(2);case 4:e.p=4,i=e.v,ul("standby_screen_sharing > streamInitCallback > self_register ".concat(i,". #").concat(r+1," re-trying..")),r++,e.n=1;break;case 5:return e.n=6,_c(n);case 6:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}(),e.n=1,n.share_screen();case 1:if(e.v){e.n=3;break}return e.n=2,_c(n);case 2:return e.a(2,null);case 3:return e.a(2,n);case 4:e.p=4,r=e.v,ul("standby_screen_sharing > err",r);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),hc=function(){var e=fo(co().m(function e(){var t,n;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(t=$c("cam-preview-".concat(Qo))).streamInitCallback=function(){var e=fo(co().m(function e(n){var r,i;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:r=0;case 1:if(!(r<3)){e.n=5;break}return e.p=2,e.n=3,t.self_register();case 3:return e.a(2);case 4:e.p=4,i=e.v,ul("standby_video_sharing > streamInitCallback > self_register ".concat(i,". #").concat(r+1," re-trying..")),r++,e.n=1;break;case 5:return e.n=6,_c(t);case 6:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}(),e.n=1,t.share_camera();case 1:if(e.v){e.n=3;break}return e.n=2,_c(t);case 2:return e.a(2,null);case 3:return e.a(2,t);case 4:e.p=4,n=e.v,ul("standby_video_sharing > err",n);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(){return e.apply(this,arguments)}}(),dc=function(e){var t=!1;return pl({to:qo,label:"admin:data:message_info:content:<message_info>",data:e}),new Promise(function(e){window.addEventListener("admin:data:message_info:content:<message_info>:received",function(n){if(n.detail.content.code<0)fc(n.detail.content.label);else{var r=mc(n.label);r?r=n.content:pc(n.detail.content)}e(n.detail.content),t=!0}),Ao(5e3).then(function(){t||(ul("_set_message_info > timeout"),e(!1))})})},fc=function(e){var t=Yo.message_infos&&Yo.message_infos.list&&Yo.message_infos.list.filter(function(t){return t.label!=e});Yo.message_infos.list=t},pc=function(e){mc(e.label)||Yo.message_infos&&Yo.message_infos.list&&Yo.message_infos.list.push(e)},mc=function(e){var t=Yo.message_infos&&Yo.message_infos.list&&Yo.message_infos.list.filter(function(t){return t.label==e});if(1==(null==t?void 0:t.length))return t[0]},gc=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Qo,i=Yo.tenant.notifications.find(function(r){return r.msg===n&&r.from===e&&r.metadata===t});i?i.last_update.push(Date.now()):(i={from:e,to:r,metadata:t,msg:n,last_update:[Date.now()],has_read:!0,has_notified:!(n.indexOf("local:")<0),id:Yo.tenant.notifications.length,htmlTmpl:null},Yo.tenant.notifications.push(i));var s=function(e){var t=mc(e);return t&&t.events?t.events:[]}(n),a={status:n,sender:e,content:t};return s&&s.forEach(function(e){e.msgKey&&t[e.msgKey]&&(n="".concat(n,":").concat(t[e.msgKey])),Ao(500).then(function(t){switch(e.targetType.toLowerCase()){case"dom":var r=document.querySelector(e.targetKey);if(r){var i=n.replace(/[<>]/g,"*");r.dispatchEvent(new CustomEvent(i,{detail:a}))}case"window":window.dispatchEvent(new CustomEvent(n,{detail:a}))}})}),i},vc=function(){var e=fo(co().m(function e(){var t;return co().w(function(e){for(;;)switch(e.n){case 0:return t=JSON.stringify(Yo.tenant.notifications,null,2),FS.writeFile("/inori/logs/".concat(Qo),t),e.n=1,Rc();case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),_c=function(){var e=fo(co().m(function e(t){var n,r,i,s;return co().w(function(e){for(;;)switch(e.n){case 0:return i=Yo.tenant.processors.findIndex(function(e){var n;return!!e&&e.Id().toLowerCase()===(null===(n=t)||void 0===n?void 0:n.Id().toLowerCase())}),-1!==i&&(Yo.tenant.processors[i]=null),cl("processor# ".concat(null===(n=t)||void 0===n?void 0:n.dat.id," removed")),(t.isLocalScreenStream||t.isLocalVideoStream)&&(null===(s=t)||void 0===s||s.stop_mediaStream()),e.n=1,null===(r=t)||void 0===r?void 0:r.deinit();case 1:t=null;case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),bc=function(e,t){var n=wc();if(t&&(n=yc(t)),e)return n.find(function(t){return!!t&&t.Id().toLowerCase()===e.toLowerCase()})},yc=function(e){if(e)return wc().filter(function(t){return t.dat.remoteId.toLowerCase()===e.toLowerCase()})},wc=function(){Yo.tenant.processors=Yo.tenant.processors.filter(function(e){return e});var e=Yo.tenant.processors.sort(function(e,t){return t.dat.lastUpdate-e.dat.lastUpdate});return e},Sc=function(){var e=Yo.remote_processor_list.list&&Yo.remote_processor_list.list.map(function(e){var t=wc().find(function(e){return e.dat.id==e.id});return t&&t._screenshot&&(e.screenshot=t._screenshot),e}).sort(function(e,t){return t.last_update-e.last_update});return e},xc=function(e){var t,n=Sc();return t=e,n.reduce(function(e,n){var r=n[t];return e[r]||(e[r]=[]),e[r].push(n),e},{})},Ec=function(e){if(e){var t,n=null===(t=Yo.remote_processor_list)||void 0===t||null===(t=t.list)||void 0===t?void 0:t.find(function(t){return t.id.toLowerCase()===e.toLowerCase()});if(n){var r=bc(n.id);return r&&(n.screenshot=r._screenshot),n}}},Cc=function(e){var t;Yo.remote_processor_list.list=null===(t=Yo.remote_processor_list)||void 0===t||null===(t=t.list)||void 0===t?void 0:t.filter(function(t){return t.id.toLowerCase()!=e.toLowerCase()})},Ac=function(e){var t=Ec(e);t&&pl({to:t.sessionId,label:"tenant:data:processor:delete:<processor_id>",data:t.id})},Mc=function(e){try{return FS.stat(e)}catch(t){ul("_file_exists > filename: ".concat(e," err ").concat(t))}return!1},kc=function(e,t){return FS.analyzePath(t).exists&&FS.unlink(t),FS.rename(e,t),Rc()},Tc=function(e){return FS.unlink(e),Rc()},Rc=function(){return new Promise(function(e){try{FS.syncfs(!1,function(t){return t?(ul("_sync_files > FS.syncfs err: ".concat(JSON.stringify(t))),e(!1)):(cl("_sync_files > FS.syncfs > successful"),e(!0))})}catch(t){ul("_sync_files > FS.syncfs err: ".concat(JSON.stringify(t))),e(!1)}})},Pc=function(e,t){try{var n=FS.readFile(e,{encoding:"binary"});return n?new Blob([n],{type:t}):new ArrayBuffer(0)}catch(t){ul("_read_file_blob > from ".concat(e," > e: ").concat(t))}return new ArrayBuffer(0)},Ic=function(){var e=fo(co().m(function e(t,n,r){var i;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pc(t,n);case 1:if(!((i=e.v).byteLength<1)){e.n=2;break}return e.a(2,Promise.resolve(!1));case 2:return e.a(2,new Promise(function(e,t){try{var n=new FileReader;n.onload=function(t){var n=t.target.result;if(!r)return e(n);var i=function(e){for(var t=e.toLowerCase().replace(/-/g,""),n=new Uint8Array(16),r=0;r<16;r++)n[r]=parseInt(t.substr(2*r,2),16);return n}(r),s=new Uint8Array(n),a=new Uint8Array(s.length+i.length);return a.set(i,0),a.set(s,i.length),e(a)},n.readAsArrayBuffer(i)}catch(t){return ul("_read_file_buffer > ",t),e(!1)}}))}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Dc=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pc(t,"video/webm");case 1:return n=e.v,e.a(2,URL.createObjectURL(n))}},e)}));return function(t){return e.apply(this,arguments)}}(),Oc=function(e){try{var t=Pc(e,"image/png");if(t.size>0)return URL.createObjectURL(t)}catch(e){ul("read_img_obj > err: ".concat(e))}return!1},Lc=function(e){return new Promise(function(t){try{var n=new FileReader;n.onerror=function(e){ul("_read_blob_2_arraybuffer  > reader.onerror: ".concat(JSON.stringify(e.target.error))),t(!1)},n.onload=function(){var e=n.result;t(e)},n.readAsArrayBuffer(e)}catch(e){ul("_read_blob_2_arraybuffer  > err: ".concat(JSON.stringify(e))),t(!1)}})},Bc=function(){var e=fo(co().m(function e(t){var n,r;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lc(t);case 1:return n=e.v,r=so(new Uint8Array(n)),e.a(2,{decompressedData:r})}},e)}));return function(t){return e.apply(this,arguments)}}(),Nc=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},Uc=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lc(t);case 1:if(!(n=e.v)){e.n=2;break}return e.a(2,Nc(n));case 2:return e.a(2,!1)}},e)}));return function(t){return e.apply(this,arguments)}}(),Hc=function(){var e=fo(co().m(function e(t,n){var r;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lc(t);case 1:if(!(r=e.v)){e.n=3;break}return e.n=2,Fc(r,n);case 2:return e.a(2,!0);case 3:return e.a(2,!1)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Fc=function(){var e=fo(co().m(function e(t,n){var r,i;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,r=new Uint8Array(t),FS.writeFile(n,r,{encoding:"binary"}),nl){e.n=3;break}return nl=!0,e.n=1,Ao(3e3);case 1:return e.n=2,Rc();case 2:nl=!1;case 3:t=null,e.n=5;break;case 4:return e.p=4,i=e.v,ul("_write_arrbuf_2_file > to ".concat(n," e: ").concat(i)),e.a(2,!1);case 5:return e.a(2,!0)}},e,null,[[0,4]])}));return function(t,n){return e.apply(this,arguments)}}(),jc=function(e,t){return new Promise(function(n,r){fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return Fc(e,t).then(function(e){n(!0)})}).catch(function(e){r(e)})})},zc=function(){if(Yo.ice_services&&Yo.ice_services.list&&Yo.ice_services.list.length>0){Yo.ice_services.list=Yo.ice_services.list.map(function(e){return{credential:e.credential,urls:[e.urls],username:e.username}});var e={iceServers:Yo.ice_services.list,iceTransportPolicy:"all"};return new RTCPeerConnection(e)}return!1},Vc=function(){var e=fo(co().m(function e(t,n,r){return co().w(function(e){for(;;)switch(e.n){case 0:if(0!=r.length){e.n=1;break}return e.n=1,Ao(2e3);case 1:return e.a(2,new Promise(function(e,i){var s=!1;if(t.dat.sessionId.toLowerCase()!=qo.toLowerCase()){var a=window.crypto.randomUUID().toLowerCase(),o={id:a,uid:t.dat.sessionId,biStream:!1,processorId:t.Id(),metadata:btoa(JSON.stringify(n)),lastUpdate:(new Date).getTime(),candidates:[],connectionType:Xo.ConnectionType.values.CONN_STREAM};r.forEach(function(e){o.candidates.push({metadata:btoa(JSON.stringify(e)),isOffer:!0,lastUpdate:(new Date).getTime()})});var l="tenant:data:ice_offer:content:answered:<ice_offer>:".concat(a);window.addEventListener(l,function(t){cl("iceoffer: ".concat(t.detail.content.id," answered.")),s=!0,e(t.detail.content)},{once:!0}),Yo.tenant.ice_offers[a]=o,pl({from:t.dat.sessionId,to:t.dat.remoteId,label:"tenant:data:ice_offer:content:<ice_offer>",data:o}),Ao(2e4).then(function(){s||(window.removeEventListener(l,function(e){ul("create_offer > timeout")}),i(!1))})}else reject(!1)}))}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Gc=function(e,t,n){if(Qo.toLowerCase()!=qo.toLowerCase())return e.aid=Qo.toString(),e.answer=btoa(JSON.stringify(t)),n.forEach(function(t){e.candidates.push({id:0,offerId:e.id,metadata:btoa(JSON.stringify(t)),isOffer:!1,lastUpdate:(new Date).getTime()})}),pl({to:e.uid,label:"tenant:data:ice_offer:content:answered:<ice_offer>",data:e}),e;ul("_answer_offer > invalid session id.")},Wc=function(e,t,n){return new Promise(function(r,i){var s={id:window.crypto.randomUUID(),processorId:t.Id(),uid:t.dat.sessionId.toLowerCase(),metadata:btoa(JSON.stringify(e)),biStream:n,lastUpdate:(new Date).getTime(),candidates:[]},a="tenant:data:ice_offer:content:updated:<ice_offer>:".concat(s.id);window.addEventListener(a,function(e){cl("offer# ".concat(e.detail.content.id," updated for processor# ").concat(e.detail.content.processorId)),r(e.detail.content)},{once:!0}),gl({from:t.dat.sessionId,to:t.dat.remoteId,label:msg,data:s})})},qc=function(){var e=fo(co().m(function e(t,n,r){var i,s,a,o,l,c,u,h,d,f,p,m,g,v,_,b,y,w,S,x,E,C,A,M,k,T,R,P,I,D,O,L,B,N,U,H,F,j,z,V,G,W,q,K;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.data.label&&t.data.data){e.n=1;break}return vl({data:t.data}),e.a(2);case 1:if(o=[t.data.from,t.data.to,t.data.label,t.data.data],l=n,c=r,o){e.n=2;break}return ul("".concat(t.data," invalid}")),e.a(2);case 2:if("open"==l.readyState){e.n=3;break}return ul("data channel (".concat(l.label,") invalid}")),e.a(2);case 3:u=o[0]||Qo,h=o[1]||Qo,gc(u,o[3],o[2],h),d=o[2],q=d,e.n="tenant:data:ice_offer:content:<ice_offer>"===q?4:"service:drive:content:dir:<file_descs>"===q?5:"tenant:data:action:content:<action>"===q?6:"service:drive:file:chunk:<file_chunk>"===q?42:"tenant:data:processors:content:<processors>"===q?43:"tenant:data:processor:req:<processor_id>"===q?44:"tenant:data:action:content:completed<action>"===q?46:"tenant:data:prediction:setup:<prediction>:received"===q?47:"tenant:data:prediction:train:<prediction>"===q?48:"tenant:data:prediction:train:<prediction>:received"===q?51:"tenant:data:prediction:setup:<prediction>"===q?52:"tenant:data:prediction:unset:<prediction>:received"===q?55:"tenant:data:prediction:unset:<prediction>"===q?56:"tenant:data:ice_offer:content:updated:<ice_offer>"===q?59:"tenant:data:processor:content:<processor>"===q?60:"tenant:data:chunk:content:<bytes>"===q?61:"tenant:data:processor:content:received:<processor>"===q?62:66;break;case 4:return cl("".concat(d," iceoffer by service: ").concat(u)),e.a(3,67);case 5:return cl("".concat(d," acknowledged by service: ").concat(u)),e.a(3,67);case 6:if(!(f=o[3])){e.n=41;break}cl("cmd:",f),c.add_setting(u,f.setting),K=f.command,e.n=K===Xo.Command.values.NONE?7:K===Xo.Command.values.STANDBY?8:K===Xo.Command.values.STOP_RECORDING?9:K===Xo.Command.values.START_RECORDING?11:K===Xo.Command.values.PAUSE_REPLAY?12:K===Xo.Command.values.RESUME_REPLAY?14:K===Xo.Command.values.DELETE_RECORDING?16:K===Xo.Command.values.START_OD?18:K===Xo.Command.values.STOP_OD?20:K===Xo.Command.values.REGISTER_PROCESSOR?22:K===Xo.Command.values.SWITCH_PROCESSOR?24:K===Xo.Command.values.START_OD_DATA_ONLY?26:K===Xo.Command.values.LANDSCAPE_VIEW?27:K===Xo.Command.values.PORTRAIT_VIEW?28:K===Xo.Command.values.START_BINARY?29:K===Xo.Command.values.STOP_BINARY?31:39;break;case 7:return e.a(3,40);case 8:return null==(p=Yo.tenant.subscriptions[u])||p.unsubscribe(),e.a(3,40);case 9:return e.n=10,c.stopRecording(u);case 10:return e.a(3,40);case 11:return c.startRecording(u),e.a(3,40);case 12:return e.n=13,c.stopReplay();case 13:return e.a(3,40);case 14:return e.n=15,c.resumeReplay();case 15:return e.a(3,40);case 16:return e.n=17,c.delRecording();case 17:return e.a(3,40);case 18:return e.n=19,c.enableOD(!0,null,"mediapipe");case 19:return e.a(3,40);case 20:return e.n=21,c.disableOD(!0);case 21:return e.a(3,40);case 22:return e.n=23,c.self_register();case 23:return e.a(3,40);case 24:return e.n=25,Kc(f.setting.processorId,u);case 25:return e.a(3,40);case 26:return null===(i=c.compute)||void 0===i||i.postMessage({ODData:!0,renderOD:!1,renderFrame:!1,status:"ODData|renderOD|renderFrame"}),e.a(3,40);case 27:return null===(s=c.compute)||void 0===s||s.postMessage({landscape:!0,status:"landscape"}),e.a(3,40);case 28:return null===(a=c.compute)||void 0===a||a.postMessage({landscape:!1,status:"landscape"}),e.a(3,40);case 29:if(m=Yo.file_chunks[f.setting.metadata]){e.n=30;break}return cl("invalid file id ".concat(f.setting.metadata,". transmission discarded.")),e.a(2);case 30:return m.totalChunks=f.setting.metadataExt3,m.fileType=f.setting.metadataExt1,m.chunks={},cl("".concat(d," starting transmitting file# ").concat(f.setting.metadata)),(g=Yo.tenant.subscriptions[u]).onLoadSignal&&g.onLoadSignal(f.setting.metadata),e.a(3,40);case 31:if(!(v=Yo.file_chunks[f.setting.metadata])||!v.chunks){e.n=38;break}if((_=Object.keys(v.chunks)).length===v.totalChunks){e.n=32;break}return b={list:[],metadata:f.setting.metadata,metadataExt1:f.setting.metadataExt1,metadataExt2:f.setting.metadataExt2},Wo(_,v.totalChunks).forEach(function(e){b.list.push({chunkId:"".concat(e)})}),gl({from:h,to:u,label:"service:drive:file:chunk:req:<file_chunks>",data:b}),e.a(3,40);case 32:if(!((y=_.filter(function(e){return!v.chunks[e].verified}))>0)){e.n=33;break}return w={list:[],metadata:f.setting.metadata,metadataExt1:f.setting.metadataExt1,metadataExt2:f.setting.metadataExt2},y.forEach(function(e){w.list.push({chunkId:e})}),gl({from:h,to:u,label:"service:drive:file:chunk:req:<file_chunks>",data:w}),e.a(3,40);case 33:return cl("".concat(d," file# ").concat(f.setting.metadata," path: ").concat(f.setting.metadataExt2," totalChunks: ").concat(_.length," transmitted successully")),gl({from:h,to:u,label:"service:drive:file:chunk:del:<file_chunks>",data:{metadata:f.setting.metadata}}),S=_.map(function(e){return v.chunks[e].data}),x=new Blob(S,{type:"application/octet-stream"}),e.n=34,Bc(x);case 34:if(E=e.v,C=E.decompressedData,A=Yo.tenant.subscriptions[u],f.setting.metadataExt1!=Xo.FileType.values.MINIMUM){e.n=36;break}return e.n=35,Fc(C,"/inori/image/mini/".concat(Vo(f.setting.metadataExt2)),!1);case 35:return A.onLoadedMiniSignal&&A.onLoadedMiniSignal(f.setting.metadataExt2),e.a(3,40);case 36:if(!A.onLoadedSignal){e.n=37;break}return e.n=37,A.onLoadedSignal(f.setting.metadata,C);case 37:delete Yo.file_chunks[f.setting.metadata];case 38:return e.a(3,40);case 39:return ul("invalid command# ".concat(f.command)),e.a(2);case 40:return"open"===l.readyState&&gl({from:h,to:u,label:"tenant:data:action:content:completed<action>",data:f}),e.a(3,67);case 41:return e.a(3,67);case 42:return M=o[3],k=Go(M.chunk),(T=Yo.file_chunks[M.metadata])&&(T.chunks&&(T.chunks[M.chunkId]={data:M.chunk,verified:k===M.checksum}),T.fileType!==Xo.FileType.values.MINIMUM&&(R=Yo.tenant.subscriptions[u]).onLoadingSignal&&R.onLoadingSignal()),e.a(3,67);case 43:return(P=o[3])&&P.list&&(sc(P),cl("".concat(d," by runtime# ").concat(u))),e.a(2);case 44:if(I=o[3]){e.n=45;break}return ul("".concat(d," invalid processor id")),e.a(2);case 45:return D=bc(I),gl({from:h,to:u,label:"tenant:data:processor:content:<processor>",data:D.dat}),e.a(3,67);case 46:return e.a(3,67);case 47:return(O=o[3])&&cl("prediction setup",O,"received by the remote vm"),e.a(3,67);case 48:if(!(L=o[3])){e.n=50;break}return cl("pd: ".concat(JSON.stringify(L))),e.n=49,c.procTrainer(L);case 49:gl({from:Qo,to:u,label:"tenant:data:prediction:train:<prediction>:received",data:N});case 50:return e.a(3,67);case 51:return(B=o[3])&&cl("prediction train ".concat(JSON.stringify(B)," received by the remote vm")),e.a(3,67);case 52:if(!(N=o[3])){e.n=54;break}return cl("pd: ".concat(JSON.stringify(N))),e.n=53,c.configTrainer(N);case 53:gl({from:Qo,to:u,label:"tenant:data:prediction:setup:<prediction>:received",data:N});case 54:return e.a(3,67);case 55:return(U=o[3])&&cl("prediction ".concat(JSON.stringify(U)," setup and vm are received")),e.a(3,67);case 56:if(!(H=o[3])){e.n=58;break}return cl("pd: ".concat(JSON.stringify(H))),e.n=57,c.disableTrainer();case 57:gl({from:Qo,to:u,label:"tenant:data:prediction:unset:<prediction>:received",data:N});case 58:return e.a(3,67);case 59:return pl(t.data),e.a(3,67);case 60:return(F=o[3])&&F.id&&(ic(F),gl({from:o[1],to:o[0],label:"tenant:data:processor:content:received:<processor>",data:F})),e.a(3,67);case 61:return j=new Blob([o[3].slice(16).buffer],{type:"image/png"}),z=URL.createObjectURL(j),(V=lc(u))&&(V._photo_src=z),e.a(3,67);case 62:return G=lc(Qo),e.n=63,Ic("/inori/photo","image/png",G.id);case 63:if(W=e.v){e.n=64;break}return cl("tenant# ".concat(JSON.stringify(G)," snapshot unavailable.")),e.a(3,67);case 64:return gl({from:Qo,to:u,label:"tenant:data:chunk:content:<bytes>",data:W}),e.n=65,Ao();case 65:return c.renderCanvas(Date.now()),e.a(3,67);case 66:return e.a(3,67);case 67:return e.a(2)}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Kc=function(){var e=fo(co().m(function e(t,n){var r,i;return co().w(function(e){for(;;)switch(e.n){case 0:if(!(r=bc(t))){e.n=3;break}if(!(i=Yo.tenant.subscriptions[n])||!i.peerChannel){e.n=2;break}return i.peerChannel.onmessage=function(e){qc(e,i.peerChannel,r)},e.n=1,i.subscribe(r);case 1:return e.a(2);case 2:return ul("invalid subscriber:",i),e.a(2);case 3:ul("to_processor:",r,"invalid");case 4:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),$c=function(e){var t=Yo.tenant.processors.find(function(t){return t.dat.name.toLowerCase()==e.toLowerCase()});if(t)return t;t=function(e){return{messageHistory:"",mediaStream:null,videoObj:document.createElement("video"),shadowCtxObj:new OffscreenCanvas(0,0).getContext("2d",{willReadFrequently:!0}),ctxObj:document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),compute:null,trainer:null,isRemoteVideoStream:!1,isLocalVideoStream:!1,isLocalScreenStream:!1,localFileStream:"",isPilotEnabled:!0,isODEnabled:!1,odInitCallback:null,isTrainerSampling:!1,trainerInitCallback:null,trainerDoneCallback:null,frameNo:0,_viewport:[0,0,0,0],_screenshot:"",dat:{name:"".concat(e),remoteId:Qo,sessionId:Qo,screenshot:"",id:window.crypto.randomUUID(),lastUpdate:(new Date).getTime(),width:0,height:0,status:Xo.ProcessorStatus.values.INIT},subscribers:{},peerChannelCallback:null,streamRcvdCallback:null,streamInitCallback:null}}(e),t.get_subscriber=function(e){var n,r,i;e||(e=t.dat.remoteId);var s=(null===(n=t)||void 0===n?void 0:n.subscribers)&&(null===(r=t)||void 0===r?void 0:r.subscribers[null===(i=e)||void 0===i?void 0:i.toLowerCase()]);if(s)return s},t.get_subscribers=function(){return t.subscribers},t.viewport=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=t._viewport;return 0==e&&0==n&&0==r&&0==i||(s[0]=Math.max(s[0]+e,0),s[1]=Math.max(s[1]+n,0),s[2]=Math.abs(r||t.dat.width),s[3]=Math.abs(i||t.dat.height)),s},t.reset_viewport=function(){return t._viewport=[0,0,t.dat.width,t.dat.height],t._viewport},t.status=function(e){switch(e&&(t.dat.status=e),t.dat.status){case Xo.ProcessorStatus.values.INIT:return"init";case Xo.ProcessorStatus.values.STOP:return"stop";case Xo.ProcessorStatus.values.STREAM:return"stream";case Xo.ProcessorStatus.values.PAUSE:return"pause";default:return"invalid"}},t.canvasObj=function(e){var n;return null===(n=t.get_subscriber(e))||void 0===n?void 0:n.canvasObj()},t.add_subscriber=function(){var e=fo(co().m(function e(n){var r;return co().w(function(e){for(;;)switch(e.n){case 0:return(r={processorId:null,sessionId:n,mediaRecorder:null,recordedChunks:[],peerChannel:null,dataChannel:null,conn:null,mediaStream:new MediaStream,onTerminalSignal:null,onLoadedSignal:null}).Id=function(){var e;return null===(e=r.sessionId)||void 0===e?void 0:e.toLowerCase()},r.processor_id=function(){var e;return null===(e=r.processorId)||void 0===e?void 0:e.toLowerCase()},r.dispose=function(){var e,t;r.processorId=null,r.sessionId=null,r.mediaRecorder=null,r.recordedChunks=null,r.peerChannel=null,r.dataChannel=null,"closed"!=(null===(e=r.conn)||void 0===e?void 0:e.connectionState)&&(null===(t=r.conn)||void 0===t||t.close()),r.conn=null},r.capture_frame=function(e){return Mo(e,r.canvasObj())},r.get_mediaStream=function(){var e,t,n=wc().find(function(e){return e.dat.id==r.processorId});if(!n)return!1;var i=r.mediaStream;if(null==i||null===(e=i.getTracks())||void 0===e||e.forEach(function(e){i.removeTrack(e)}),(null===(t=n.mediaStream)||void 0===t?void 0:t.getAudioTracks().length)>0){var s=n.mediaStream.getAudioTracks()[0];i.addTrack(s)}return n.ctxObj.canvas.captureStream().getTracks().forEach(function(e){return i.addTrack(e)}),i},r.get_4To3_MediaStream=function(){var e,t,n=wc().find(function(e){return e.dat.id==r.processorId});if(!n)return!1;var i=r.mediaStream;if(null==i||null===(e=i.getTracks())||void 0===e||e.forEach(function(e){i.removeTrack(e)}),(null===(t=n.mediaStream)||void 0===t?void 0:t.getAudioTracks().length)>0){var s=n.mediaStream.getAudioTracks()[0];i.addTrack(s)}var a=n.ctxObj.canvas,o=document.createElement("canvas");o.width=640,o.height=480;var l=o.getContext("2d");return function e(){l.fillStyle="black",l.fillRect(0,0,640,480);var t=0,n=0,r=640,i=480;if(640!==a.width||480!==a.height){var s=Math.min(640/a.width,480/a.height);t=(640-(r=a.width*s))/2,n=(480-(i=a.height*s))/2}l.drawImage(a,t,n,r,i),requestAnimationFrame(e)}(),o.captureStream().getTracks().forEach(function(e){return i.addTrack(e)}),i},r.req_processors=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;Ao(1e3).then(function(){gl({from:Qo,to:r.sessionId,label:"tenant:data:processors:req:<processors>",data:{totalNumOfPage:0,totalNumPerPage:t,pageIndex:e,list:[]}})})},r.rebootCtrl=fo(co().m(function e(){var t,n;return co().w(function(e){for(;;)switch(e.n){case 0:return t=Xo.Command.values.REBOOT_CTRL,n={command:t,setting:{metadata:"/dev/video"}},e.n=1,r.sendAction(n);case 1:return e.a(2,e.v)}},e)})),r.liveStream=function(){var e=fo(co().m(function e(t,n){var i,s;return co().w(function(e){for(;;)switch(e.n){case 0:return i=Xo.Command.values.LIVE_STREAM,t.includes("/dev/video")&&(i=Xo.Command.values.START_LIVE_CAM),s={command:i,setting:{metadata:"".concat(t),metadataExt1:n?1:-1}},e.n=1,r.sendAction(s);case 1:return e.a(2,e.v)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),r.stopLiveCam=function(){var e=fo(co().m(function e(t){var n,i;return co().w(function(e){for(;;)switch(e.n){case 0:return n=Xo.Command.values.STOP_LIVE_CAM,i={command:n,setting:{metadata:"".concat(t)}},e.n=1,r.sendAction(i);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.publishStream=function(){var e=fo(co().m(function e(t){var n,i;return co().w(function(e){for(;;)switch(e.n){case 0:if((n=Ec(t)).sessionId.toLowerCase()==r.Id()){e.n=1;break}return ul("processor# ".concat(t," is unavailable for subscriber# ").concat(r.Id())),e.a(2);case 1:return i={command:Xo.Command.values.LIVE_PROCESSOR,setting:{metadata:"vision",processorId:n.id}},e.n=2,r.sendAction(i);case 2:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.subscribe_remote=function(){var e=fo(co().m(function e(t){var n,i;return co().w(function(e){for(;;)switch(e.n){case 0:if(n=Ec(t)){e.n=1;break}return ul("processor# ".concat(t," not found}")),e.a(2);case 1:return i={command:Xo.Command.values.SWITCH_PROCESSOR,setting:{metadata:"vision",processorId:n.id}},e.n=2,r.sendAction(i);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.unsubscribe=function(){var e;Yo.tenant.subscriptions[null===(e=r.Id())||void 0===e?void 0:e.toLowerCase()]=r;for(var t=wc(),n=0;n<t.length;n++)t[n].del_subscriber(r.Id());return r},r.subscribe=function(){var e=fo(co().m(function e(t){var n,i,s,a,o;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r.unsubscribe(),r.processorId=t.Id(),!r.conn||"connected"!==r.conn.connectionState){e.n=8;break}n=r.conn.getSenders(),i=mo(n),e.p=1,a=co().m(function e(){var n,i,a,o;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if((n=s.value).track){e.n=1;break}return e.a(2,1);case 1:if("audio"==n.track.kind&&(null===(a=t.mediaStream)||void 0===a?void 0:a.getAudioTracks().length)>0&&(i=t.mediaStream.getTracks().find(function(e){return e.kind===n.track.kind})),"video"==n.track.kind&&(i=t.ctxObj.canvas.captureStream().getTracks().find(function(e){return e.kind===n.track.kind})),!i){e.n=5;break}return e.p=2,e.n=3,n.replaceTrack(i);case 3:cl("subscriber# ".concat(r.Id()," replaced ").concat(n.track.kind," track from processor# ").concat(t.Id())),e.n=5;break;case 4:e.p=4,o=e.v,ul("subscriber# ".concat(r.Id()," replacing ").concat(n.track.kind," track exception: ").concat(o));case 5:return e.a(2)}},e,null,[[2,4]])}),i.s();case 2:if((s=i.n()).done){e.n=5;break}return e.d(oo(a()),3);case 3:if(!e.v){e.n=4;break}return e.a(3,4);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,o=e.v,i.e(o);case 7:return e.p=7,i.f(),e.f(7);case 8:return t.subscribers[r.Id().toLowerCase()]=r,e.n=9,Ao();case 9:return t.status(Xo.ProcessorStatus.values.STREAM),t.renderCanvas(Date.now()),e.a(2,r)}},e,null,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}(),r.sendAction=function(e){return gl({from:Qo,to:r.sessionId,label:"tenant:data:action:content:<action>",data:e}),new Promise(function(e,t){var n=!1;window.addEventListener("tenant:data:action:content:completed<action>",function(t){cl("sendAction > received ".concat(t.detail)),n=!0,e(!0)},{once:!0}),Ao(5e3).then(function(){n||e(!1)})})},e.n=1,r.subscribe(t);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.peer_channel=function(e){var n;return null===(n=t.get_subscriber(e))||void 0===n?void 0:n.peerChannel},t.data_channel=function(e){var n;return null===(n=t.get_subscriber(e))||void 0===n?void 0:n.dataChannel},t.conn=function(e){var n;return null===(n=t.get_subscriber(e))||void 0===n?void 0:n.conn},t.del_subscriber=function(e){t.get_subscriber(e)&&(delete t.subscribers[e.toLowerCase()],cl("subscriber# ".concat(e," removed from processor# ").concat(t.dat.id)))},t.add_conn=function(){var e=fo(co().m(function e(n){var r,i;return co().w(function(e){for(;;)switch(e.n){case 0:if(r=t.get_subscriber(n)){e.n=2;break}return e.n=1,t.add_subscriber(n);case 1:r=e.v;case 2:if(!r.conn||"connected"!==r.conn.connectionState){e.n=3;break}return r.conn.getSenders().forEach(function(e){r.conn.removeTrack(e)}),r.conn.getReceivers().forEach(function(e){e.track&&e.track.stop()}),e.a(2,r.conn);case 3:return(i=zc()).addEventListener("negotiationneeded",function(e){cl("**** negotiation is needed.")}),i.addEventListener("connectionstatechange",function(){var e=fo(co().m(function e(s){var a;return co().w(function(e){for(;;)switch(e.n){case 0:cl("status changed: ".concat(i.connectionState," subscriber# ").concat(n," processor# ").concat(t.dat.id)),a=i.connectionState,e.n="new"===a||"connecting"===a?1:"connected"===a?2:"disconnected"===a||"failed"===a||"closed"===a?3:6;break;case 1:case 2:case 6:return e.a(3,7);case 3:return e.n=4,Ao(2e4);case 4:if("connected"!=i.connectionState){e.n=5;break}return e.a(2);case 5:return r.unsubscribe(),r.dispose(),e.a(3,7);case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),!1),r.conn=i,e.a(2,i)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.add_peer_channel=function(e,n){var r=t.get_subscriber(e);if(r)return r.peerChannel=n,Zo[e]=n,r},t.add_setting=function(e,n){var r=t.get_subscriber(e);if(r)return r.setting=n,r},t.add_data_channel=function(e,n){var r=t.get_subscriber(e);if(r)return r.dataChannel=n,r},t.Id=function(){return t.dat.id.toLowerCase()},t.stopReplay=fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.reset();case 1:return e.a(2)}},e)})),t.resumeReplay=fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.reset();case 1:return e.a(2,t.playRecording(t.localFileStream))}},e)})),t.playRecording=function(){var e=fo(co().m(function e(n){var r,i;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Dc(n);case 1:return r=e.v,t.set_mediaStream(r,!1),t.localFileStream=n,e.a(2,!0);case 2:return e.p=2,i=e.v,ul("playRecording > _read_video_obj > err: ".concat(i)),e.a(2,!1)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),t.startRecording=function(e){try{var n=t.get_subscriber(e);if(!n)throw"invalid subscription# ${remote_id}";var r=n.get_mediaStream(e);n.mediaRecorder=new MediaRecorder(r,{mimeType:"video/webm; codecs=vp9"}),n.recordedChunks=[],n.mediaRecorder.ondataavailable=function(e){e.data.size>0&&n.recordedChunks.push(e.data)},n.mediaRecorder.start()}catch(e){ul("error stream recording: ".concat(e))}},t.stopRecording=function(e){return new Promise(function(n,r){var i=t.get_subscriber(e);if("inactive"!==i.mediaRecorder.state){var s=!1;i.mediaRecorder.onstop=fo(co().m(function e(){var t,r,a,o;return co().w(function(e){for(;;)switch(e.n){case 0:return t=new Blob(i.recordedChunks,{type:"video/webm"}),r=window.crypto.randomUUID(),a="/inori/video/".concat(r),e.n=1,Hc(t,a);case 1:return i.recordedChunks=[],(o=$c("record_".concat(r.split("-")[0]))).streamInitCallback=function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,o.self_register();case 1:e.n=4;break;case 2:return e.p=2,n=e.v,e.n=3,_c(o);case 3:ul("mediaRecorder.onstop > streamInitCallback > self_register ".concat(n));case 4:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),e.n=2,o.playRecording(a);case 2:n(!0),s=!0,i.mediaRecorder=null;case 3:return e.a(2)}},e)})),i.mediaRecorder.stop(),Ao(1e4).then(function(){s||n(!1)})}})},t.delRecording=fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Tc(t.localFileStream);case 1:return e.a(2)}},e)})),t.capture_frame=function(e){return Mo(e,t.videoObj)},t.retain_screenshot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.videoObj;t._screenshot=function(e){if(e.videoWidth&&e.videoHeight){var t=e.videoWidth/e.videoHeight,n=document.createElement("canvas");n.width=100,n.height=100/t;var r=n.getContext("2d",{willReadFrequently:!0});r.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,n.width,n.height),r.getImageData(0,0,n.width,n.height);var i=r.canvas.toDataURL("image/jpeg");return n=null,r=null,i}}(e)},t.screenshot=function(){return t._screenshot},t.disableTrainer=function(){var e=fo(co().m(function e(n){return co().w(function(e){for(;;)switch(e.n){case 0:if(t.isTrainerSampling=!1,t.trainer){e.n=1;break}return e.a(2);case 1:return e.n=2,t.delTrainer();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.disableOD=fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:if(t.isODEnabled){e.n=1;break}return e.a(2);case 1:return t.isODEnabled=!1,e.n=2,t.delWorker();case 2:return e.a(2)}},e)})),t.pauseTrainer=fo(co().m(function e(){var n,r;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:return r={req:"pause"},null===(n=t.trainer)||void 0===n||n.postMessage(r),e.n=2,Ao();case 2:return e.a(2)}},e)})),t.resumeTrainer=fo(co().m(function e(){var n,r;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:return r={req:"resume"},null===(n=t.trainer)||void 0===n||n.postMessage(r),e.n=2,Ao();case 2:return e.a(2)}},e)})),t.enableTrainer=fo(co().m(function e(){var n,r;return co().w(function(e){for(;;)switch(e.n){case 0:if(!t.trainer){e.n=1;break}return e.a(2);case 1:return t.trainer=new Worker("workers/trainer.".concat("min.","js")),e.n=2,Ao(3e3);case 2:return t.setTrainerEvent(),r={id:window.crypto.randomUUID().toLowerCase(),req:"bootstrap"},null===(n=t.trainer)||void 0===n||n.postMessage(r),e.n=3,Ao();case 3:return e.a(2)}},e)})),t.configTrainer=function(){var e=fo(co().m(function e(n){var r;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.n=1,t.enableTrainer();case 1:return r={bound:n.bbox,objective:n.class,req:"config"},t.trainer.postMessage(r),e.n=2,Ao();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.sampleTrainer=function(){var e=fo(co().m(function e(n,r,i){var s;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:s={source:n,metric:r,tag:i,req:"collect"},t.trainer.postMessage(s);case 2:return e.a(2)}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),t.resumeSampleTrainer=fo(co().m(function e(){var n;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2,!1);case 1:n={source:_imgData,metric:_metric,tag:_tag,req:"collect"},t.trainer.postMessage(n);case 2:return e.a(2)}},e)})),t.procTrainer=fo(co().m(function e(){var n;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:return n={req:"train"},t.trainer.postMessage(n),e.n=2,Ao();case 2:return e.a(2)}},e)})),t.enableOD=fo(co().m(function e(){var n,r,i,s,a,o=arguments;return co().w(function(e){for(;;)switch(e.n){case 0:n=o.length>0&&void 0!==o[0]&&o[0],r=o.length>1?o[1]:void 0,i=o.length>2&&void 0!==o[2]?o[2]:"coco-ssd",t.compute,s={tm:r,width:t.dat.width,height:t.dat.height,ODData:!1,renderOD:!1,renderFrame:!1,landscape:!1,status:"bootstrap"},n?(s.ODData=!0,t.isLocalVideoStream||t.isLocalScreenStream||t.localFileStream?s.renderFrame=!0:s.renderFrame=!1,s.renderOD=!1):(s.renderOD=!0,s.ODData=!1),a=i,e.n="mediapipe"===a?1:2;break;case 1:return t.compute=new Worker("workers/compute-mediapipe.".concat("min.","js"),{type:"module"}),e.a(3,3);case 2:t.compute=new Worker("workers/compute-coco-ssd.".concat("min.","js"),{type:"module"});case 3:return t.setVisionEvent(s),e.a(2,new Promise(function(e,n){var r=!1;t.odInitCallback=function(t){e(!0),r=!0,cl("object detection lauched")},Ao(1e4).then(function(){r||e(!1)})}))}},e)})),t.renderCanvas=function(){var e=fo(co().m(function e(n){var r,i,s,a,o,l,c,u,h,d;return co().w(function(e){for(;;)switch(e.n){case 0:if(0!=(null===(r=t.dat)||void 0===r?void 0:r.width)&&0!=(null===(i=t.dat)||void 0===i?void 0:i.height)){e.n=1;break}return ul("processor# ".concat(t.Id()," returns on invalid render size}")),e.a(2);case 1:if("pause"!=t.status()){e.n=4;break}return e.n=2,t.disableOD();case 2:return e.n=3,t.disableTrainer();case 3:return cl("processor# ".concat(t.Id()," paused")),e.a(2);case 4:if(1==t.frameNo&&(s=t.capture_frame(150),t._screenshot=s,t.streamInitCallback&&t.streamInitCallback(s),t.streamInitCallback=null),t.isLocalScreenStream||t.isLocalVideoStream)t.shadowCtxObj&&t.shadowCtxObj.drawImage(t.videoObj,0,0,t.dat.width,t.dat.height),a=null===(o=t.shadowCtxObj)||void 0===o?void 0:o.getImageData.apply(o,po(t.viewport()));else try{c=t.videoObj.videoWidth/t.videoObj.videoHeight,u=t.shadowCtxObj.canvas.width,h=t.shadowCtxObj.canvas.width/c,t.viewport()[3]=h,t.shadowCtxObj.canvas.height=h,t.shadowCtxObj.drawImage(t.videoObj,0,0,t.videoObj.videoWidth,t.videoObj.videoHeight,0,0,u,h),a=null===(l=t.shadowCtxObj)||void 0===l?void 0:l.getImageData(0,0,u,h)}catch(e){cl("_p.renderCanvas err: ".concat(e," processor: ").concat(t.Id()," paused")),t.status(Xo.ProcessorStatus.values.PAUSE)}t.frameNo++,t.isTrainerSampling&&t.sampleTrainer(a,null,null),t.isODEnabled?null===(d=t.compute)||void 0===d||d.postMessage(a):(Object.values(t.subscribers||[]).length<1&&t.frameNo>1&&t.status(Xo.ProcessorStatus.values.PAUSE),t.ctxObj.canvas.width=t.viewport()[2],t.ctxObj.canvas.height=t.viewport()[3],a&&t.ctxObj.putImageData(a,0,0),requestAnimationFrame(function(){var e=fo(co().m(function e(n){return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.renderCanvas(n);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}()));case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.delWorker=fo(co().m(function e(){var n,r;return co().w(function(e){for(;;)switch(e.n){case 0:return null===(n=t.compute)||void 0===n||n.postMessage({status:"dispose"}),e.n=1,Ao();case 1:return null===(r=t.compute)||void 0===r||r.terminate(),e.n=2,Ao();case 2:delete t.compute;case 3:return e.a(2)}},e)})),t.delTrainer=fo(co().m(function e(){var n,r;return co().w(function(e){for(;;)switch(e.n){case 0:return null===(n=t.trainer)||void 0===n||n.postMessage({req:"dispose"}),e.n=1,Ao();case 1:return null===(r=t.trainer)||void 0===r||r.terminate(),e.n=2,Ao();case 2:delete t.trainer;case 3:return e.a(2)}},e)})),t.deinit=fo(co().m(function e(){var n,r,i,s;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.subscribers)for(n=0,r=Object.entries(t.subscribers);n<r.length;n++)i=lo(r[n],2),s=i[0],i[1],t.del_subscriber(s);return delete t.subscribers,delete t.videoObj,delete t.shadowCtxObj,delete t.mediaRecorder,e.n=1,t.disableOD();case 1:return e.n=2,t.disableTrainer();case 2:return e.a(2)}},e)})),t.reset=fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:return delete t.mediaStream,delete t.videoObj,delete t.shadowCtxObj,e.n=1,t.disableOD();case 1:return e.n=2,t.disableTrainer();case 2:t.isTrackShared=!1,t.isLocalVideoStream=!1,t.isLocalScreenStream=!1,t.isPilotEnabled=!0,t.isODEnabled=!1,t.isTrainerSampling=!1,t.frameNo=2,delete t.peerChannelCallback,delete t.streamInitCallback,t.videoObj=document.createElement("video"),t.shadowCtxObj=new OffscreenCanvas(t.dat.width,t.dat.width).getContext("2d",{willReadFrequently:!0}),t.status(Xo.ProcessorStatus.values.STOP);case 3:return e.a(2)}},e)})),t.stop_mediaStream=function(){var e,n;(null===(e=t.mediaStream)||void 0===e?void 0:e.getTracks)&&(null===(n=t.mediaStream)||void 0===n||null===(n=n.getTracks())||void 0===n||n.forEach(function(e){var n;e.stop(),null===(n=t.mediaStream)||void 0===n||n.removeTrack(e)})),delete t.mediaStream},t.set_mediaStream=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.videoObj?(t.videoObj.addEventListener("play",function(e){var n,r;if(t.videoObj){var i=null===(n=t.videoObj)||void 0===n?void 0:n.videoWidth,s=null===(r=t.videoObj)||void 0===r?void 0:r.videoHeight;t.dat.width=i,t.dat.height=s,t.viewport(0,0,i,s),t.shadowCtxObj.canvas.width=i,t.shadowCtxObj.canvas.height=s,t.status(Xo.ProcessorStatus.values.STREAM),t.renderCanvas(Date.now())}else cl("processor has been terminated")},{once:!0}),t.videoObj.autoplay=!0,n?t.videoObj.srcObject=e:(t.videoObj.loop=!0,t.videoObj.src=e),t.mediaStream=e):cl("processor has been terminated")},t.self_register=function(){return new Promise(function(e,n){var r="tenant:data:processor:content:received:<processor>:".concat(t.Id()),i=!1;window.addEventListener(r,function(n){var r=n.detail.content;cl("processor request: ".concat(r.id," received.")),t.dat=r,t.dat.lastUpdate=(new Date).getTime(),i=!0,Yo.remote_processor_list.list.push(r),e(t)},{once:!0}),t.dat.sessionId=Qo;var s="tenant:data:processor:content:<processor>";pl({to:t.dat.sessionId,label:s,data:t.dat}),Ao(2e4).then(function(){i||(window.removeEventListener(r,function(e){ul("".concat(s," > timeout"))}),n(!1))})})},t.share_camera=function(){var e=fo(co().m(function e(n){var r,i;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!n){e.n=1;break}r=n,e.n=3;break;case 1:return e.n=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 2:r=e.v;case 3:if(r){e.n=4;break}return e.a(2,!1);case 4:return t.set_mediaStream(r),t.isLocalVideoStream=!0,e.a(2,!0);case 5:return e.p=5,i=e.v,ul("Error accessing media devices.",i),e.a(2,!1)}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),t.share_screen=function(){var e=fo(co().m(function e(n){var r,i;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!n){e.n=1;break}r=n,e.n=3;break;case 1:return e.n=2,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});case 2:r=e.v;case 3:if(r){e.n=4;break}return e.a(2,!1);case 4:return t.set_mediaStream(r),t.isLocalScreenStream=!0,e.a(2,!0);case 5:return e.p=5,i=e.v,ul("Error accessing media devices.",i),e.a(2,!1)}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),t.resp2RemoteStream=function(){var e=fo(co().m(function e(n){var r,i,s,a=arguments;return co().w(function(e){for(;;)if(0===e.n)return i=[],s=(r=!(a.length>1&&void 0!==a[1])||a[1])?n.uid:t.dat.remoteId,e.a(2,new Promise(function(){var e=fo(co().m(function e(a,o){var l,c,u,h,d,f;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,t.add_conn(s);case 1:return(l=e.v).addEventListener("icecandidate",function(e){e.candidate&&i.push(e.candidate)}),r&&(c=t.get_subscriber(s))&&(u=c.get_4To3_MediaStream()).getTracks().forEach(function(e){l.addTrack(e,u)}),l.addEventListener("datachannel",function(e){t._onRemoteDataChannel(e,s)}),l.addEventListener("track",function(e){t._onRemoteStream(e,s)}),h=n,d=JSON.parse(atob(h.metadata)),e.a(2,l.setRemoteDescription(d).then(function(e){return l.createAnswer().then(function(e){if(l.addEventListener("icegatheringstatechange",function(n){switch(cl("resp2RemoteStream > _conn.iceGatheringState: ".concat(l.iceGatheringState)),l.iceGatheringState){case"new":case"gathering":return;case"complete":h.candidates.forEach(function(e){if(e.isOffer){var t=JSON.parse(atob(e.metadata));l.addIceCandidate(t)}});var r=Gc(h,e,i);if(!r)return o("invalid answer");cl("finalise offer# ".concat(r.id," for processor# ").concat(t.Id())),a(r)}}),l.setLocalDescription(e),0==h.candidates.length){var n=Gc(h,e,[]);return n?(cl("finalise offer# ".concat(n.id," for processor# ").concat(t.Id())),a(n)):o("invalid answer")}})}).catch(function(e){ul("initRemoteAnswer err: ",e),l.close()}));case 2:e.p=2,f=e.v,a(!1),ul(f);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,n){return e.apply(this,arguments)}}()))},e)}));return function(t){return e.apply(this,arguments)}}(),t.req2RemoteStream=function(){try{return pl({from:t.dat.sessionId,to:t.dat.remoteId,label:"tenant:data:ice_offer:req:<processor_id>",data:t.Id()}),new Promise(function(e,n){var r="tenant:data:ice_offer:content:<ice_offer>:".concat(t.Id());window.addEventListener(r,function(){var n=fo(co().m(function n(r){var i,s,a;return co().w(function(n){for(;;)switch(n.p=n.n){case 0:return i=r.detail.content,n.p=1,n.n=2,t.resp2RemoteStream(i,!1);case 2:(s=t.get_subscriber(t.dat.remoteId))&&(Yo.tenant.subscriptions[s.Id()]=s),e(!0),n.n=5;break;case 3:return n.p=3,a=n.v,ul("req2RemoteStream > err: ".concat(a)),n.n=4,_c(t);case 4:e(!1);case 5:return n.a(2)}},n,null,[[1,3]])}));return function(e){return n.apply(this,arguments)}}())})}catch(e){ul(e)}},t.resp2StreamReq=function(){var e=fo(co().m(function e(n){var r,i,s,a,o,l,c,u,h;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=[],e.p=1,e.n=2,t.add_conn(n);case 2:if((s=e.v).addEventListener("icecandidate",function(e){null!=e.candidate?r.push(e.candidate):cl("icecandidate finalised")}),s.addEventListener("track",function(e){}),!(a=t.get_subscriber(n))){e.n=4;break}if((o=a.get_4To3_MediaStream()).getTracks().forEach(function(e){s.addTrack(e,o)}),l=s.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),l){e.n=3;break}return e.a(2,reje("expected a video transceiver after addTrack()"));case 3:c=RTCRtpSender.getCapabilities("video").codecs,u=c.filter(function(e){return"video/h264"===e.mimeType.toLowerCase()||"video/rtx"===e.mimeType.toLowerCase()&&/apt=\d+/.test(e.sdpFmtpLine)}),l.setCodecPreferences(u);case 4:return i=s.createDataChannel("ProcessorData",{ordered:!0}),t.add_peer_channel(n,i),i.binaryType="arraybuffer",i.addEventListener("open",fo(co().m(function e(){var r;return co().w(function(e){for(;;)switch(e.n){case 0:cl("channel: ".concat(i.label," opened")),i.onmessage=function(e){qc(e,i,t)},t.dat.lastUpdate=(new Date).getTime(),(r=wc().filter(function(e){return e.dat.sessionId==Qo&&(e.isLocalScreenStream||e.isLocalVideoStream)}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}))&&gl({from:t.dat.sessionId,to:n,label:"tenant:data:processors:content:<processors>",data:{list:r}});case 1:return e.a(2)}},e)})),{once:!0}),i.addEventListener("close",fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:cl("channel: ".concat(i.label," closed. closing conn..")),a.unsubscribe();case 1:return e.a(2)}},e)})),{once:!0}),e.a(2,s.createOffer({offerToReceiveVideo:1}).then(function(e){return new Promise(function(i,a){s.setLocalDescription(e).then(function(o){s.addEventListener("icegatheringstatechange",function(){var e=fo(co().m(function e(n){var r;return co().w(function(e){for(;;)switch(e.n){case 0:cl("icegatheringstatechange: ".concat(n.target.iceGatheringState)),r=n.target.iceGatheringState,e.n="new"===r||"complete"===r?1:"gathering"===r?2:4;break;case 1:case 4:return e.a(2);case 2:return e.n=3,Ao(2e3);case 3:return s.dispatchEvent(new CustomEvent("local:connect:icecandidate:complete:".concat(t.Id()),{})),e.a(3,4)}},e)}));return function(t){return e.apply(this,arguments)}}()),s.addEventListener("local:connect:icecandidate:complete:".concat(t.Id()),function(o){t.dat.remoteId=n,Vc(t,e,r).then(function(e){if(cl("register local offer:",e),e&&""!=e.answer&&e.candidates.length>0){var t=JSON.parse(atob(e.answer));return s.setRemoteDescription(t).then(function(t){e.candidates.forEach(function(e){if(!e.isOffer){var t=JSON.parse(atob(e.metadata));s.addIceCandidate(t)}}),i(e)})}}).catch(function(e){a(e)})},{once:!0})})})}));case 5:e.p=5,h=e.v,ul(h);case 6:return e.a(2)}},e,null,[[1,5]])}));return function(t){return e.apply(this,arguments)}}(),t.liveStream=function(e,n){pl({label:"service:stream:live:req:<service>",to:e,data:{sessionId:t.dat.remoteId,metadata:n}})},t.publishStream=function(){var e=fo(co().m(function e(n){var r,i,s,a,o,l;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=[],e.p=1,e.n=2,t.add_conn(n);case 2:if((s=e.v).addEventListener("icecandidate",function(e){null!=e.candidate?r.push(e.candidate):cl("icecandidate finalised")}),a=t.get_subscriber(n)){e.n=3;break}return e.a(2,!1);case 3:return(o=a.get_4To3_MediaStream()).getTracks().forEach(function(e){s.addTrack(e,o)}),i=s.createDataChannel("ProcessorData",{ordered:!0}),t.add_peer_channel(n,i),i.binaryType="arraybuffer",i.addEventListener("open",fo(co().m(function e(){var r;return co().w(function(e){for(;;)switch(e.n){case 0:cl("channel: ".concat(i.label," opened")),i.onmessage=function(e){qc(e,i,t)},t.dat.lastUpdate=(new Date).getTime(),(r=wc().filter(function(e){return e.dat.sessionId==Qo}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}))&&gl({from:t.dat.sessionId,to:n,label:"tenant:data:processors:content:<processors>",data:{list:r}});case 1:return e.a(2)}},e)})),{once:!0}),i.addEventListener("close",fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:cl("channel: ".concat(i.label," closed. closing conn..")),a.unsubscribe();case 1:return e.a(2)}},e)})),{once:!0}),e.a(2,s.createOffer({offerToReceiveVideo:1}).then(function(e){return new Promise(function(i,a){s.setLocalDescription(e).then(function(o){s.addEventListener("local:connect:icecandidate:complete:".concat(t.Id()),function(o){t.dat.remoteId=n,Vc(t,e,r).then(function(e){if(cl("register local offer:",e),e&&""!=e.answer&&e.candidates.length>0){var t=JSON.parse(atob(e.answer));s.setRemoteDescription(t).then(function(t){e.candidates.forEach(function(e){if(!e.isOffer){var t=JSON.parse(atob(e.metadata));s.addIceCandidate(t)}}),i(e)})}}).catch(function(e){a(e)})},{once:!0}),s.addEventListener("icegatheringstatechange",function(){var e=fo(co().m(function e(n){var r;return co().w(function(e){for(;;)switch(e.n){case 0:cl("icegatheringstatechange: ".concat(n.target.iceGatheringState)),r=n.target.iceGatheringState,e.n="new"===r||"complete"===r?1:"gathering"===r?2:4;break;case 1:case 4:return e.a(2);case 2:return e.n=3,Ao(2e3);case 3:return s.dispatchEvent(new CustomEvent("local:connect:icecandidate:complete:".concat(t.Id()),{})),e.a(3,4)}},e)}));return function(t){return e.apply(this,arguments)}}())})})}));case 4:e.p=4,l=e.v,ul(l);case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),t.setTrainerEvent=function(){t.trainer.onmessage=function(e){if(e.data.conf&&"initialised"==e.data.conf.summary.status)return cl("processor# ".concat(t.Id()," trainer initialised")),t.trainer.onmessage=function(){var e=fo(co().m(function e(n){var r,i;return co().w(function(e){for(;;)switch(e.n){case 0:if(n.data){e.n=1;break}return ul("empty message received"),e.a(2);case 1:i=n.data.req,e.n="status"===i?2:"pause"===i?3:"resume"===i?4:"collect"===i?5:"train"===i?6:"dispose"===i?10:"config"===i?11:12;break;case 2:return cl("current config:",n.data.conf),e.a(3,13);case 3:return"paused"==n.data.conf.summary.status&&(t.isTrainerSampling=!1),e.a(3,13);case 4:return cl("trainer resumes sampling",n.data.conf),t.isTrainerSampling=!0,e.a(3,13);case 5:return cl("data collected",n.data.conf),e.a(3,13);case 6:if(t.isTrainerSampling=!1,r=n.data.conf,cl("model trained",r),!r.summary.modelBlob||!r.summary.weightsBlob){e.n=9;break}return e.n=7,jc(r.summary.modelBlob,"/inori/model/json/".concat(r.id));case 7:return e.n=8,jc(r.summary.weightsBlob,"/inori/model/weight/".concat(r.id));case 8:t.trainerDoneCallback&&t.trainerDoneCallback(r);case 9:return e.a(3,13);case 10:return t.isTrainerSampling=!1,cl("trainer disposed",n.data.conf),e.a(3,13);case 11:return cl("config acknowledged:",n.data.conf),t.isTrainerSampling=!0,e.a(3,13);case 12:return cl("unknown message:",n.data.reply),e.a(3,13);case 13:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),void(t.trainerInitCallback&&t.trainerInitCallback(e.data.conf))}},t.setVisionMPEvent=function(e){var n=document.createElement("iframe");n.onload=function(){t.setVisionEvent(e)},n.src="mediapipe.html",n.width=0,n.height=0,n.frameborder=0,document.body.appendChild(n)},t.setVisionEvent=function(e){t.compute||ul("_p.compute: channel invalid"),t.compute.onmessage=function(e){if(e.data.status&&"initialised"==e.data.status){cl("processor# ".concat(t.Id()," vision initialised"));var n=function(e,n){if(t&&t.subscribers)for(var r=0,i=Object.entries(t.subscribers);r<i.length;r++){var s,a=lo(i[r],2),o=a[0],l=a[1],c=l.peerChannel;"open"==(null==c?void 0:c.readyState)&&null!==(s=l.setting)&&void 0!==s&&s.isOd&&gl({from:t.dat.sessionId,to:o,label:"tenant:data:predictions:content:<predictions>",data:{list:e,width:n.width,height:n.height,frameNo:t.frameNo}})}};return t.compute.onmessage=function(e){var r;if((null===(r=e.data)||void 0===r?void 0:r.length)>1)if(e.data[2],e.data[0]instanceof ImageData)Array.isArray(e.data[1])&&e.data[1].length>0&&n(e.data[1],e.data[2]),t.putImageData(e.data[0],0,0,t.viewport()[2],t.viewport()[3]).then(function(){var e=fo(co().m(function e(n){return co().w(function(e){for(;;)switch(e.n){case 0:n||t.status(Xo.ProcessorStatus.values.PAUSE);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());else{if(!Array.isArray(e.data[1]))return void cl("non-frame message received:",e.data);e.data[1].length>0&&n(e.data[1],e.data[2])}else{if("object"!==ao(e.data))return void ul("invalid message received:",e.data);cl("compute message received:",e.data)}t.renderCanvas(Date.now())},t.isODEnabled=!0,t.odInitCallback&&t.odInitCallback(e.data),void t.renderCanvas(Date.now())}},t.compute.postMessage(e)},t._onRemoteDataChannel=function(e,n){cl("onRemoteDataChannel: ".concat(JSON.stringify(e)));var r=e.channel;"ProcessorData"===r.label&&(r.onmessage=function(e){qc(e,r,t)}),r.binaryType="arraybuffer",r.addEventListener("close",function(){var e;cl("channel: ".concat(r.label," closed. closing conn..")),null===(e=t.conn(n))||void 0===e||e.close()},{once:!0}),r.addEventListener("open",function(){cl("channel: ".concat(r.label," opened.")),"ProcessorData"===r.label?t.add_peer_channel(n,r):t.add_data_channel(n,r),t.peerChannelCallback&&t.peerChannelCallback(r),t.peerChannelCallback=null},{once:!0})},t._onRemoteStream=function(){var e=fo(co().m(function e(n,r){return co().w(function(e){for(;;)switch(e.n){case 0:if(!n.streams||!n.streams[0]){e.n=1;break}t.set_mediaStream(n.streams[0]),t.streamRcvdCallback&&t.streamRcvdCallback(n.streams[0]),e.n=2;break;case 1:return ul("invalid remote stream"),e.a(2);case 2:cl("processing remote stream");case 3:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Yo.tenant.processors.push(t);var n=wc().filter(function(e){return!e.dat.name.includes("preview")}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat});return n&&Object.values(Yo.tenant.subscriptions).forEach(function(e){e.conn&&"connected"===e.conn.connectionState&&gl({from:Qo,to:e.Id(),label:"tenant:data:processors:content:<processors>",data:{list:n}})}),t},Xc=function(){var e=fo(co().m(function e(){var t,n,r;return co().w(function(e){for(;;)switch(e.n){case 0:return t=FS.readdir("/inori/model/json"),n=t.slice(2).map(function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Yc(t);case 1:if(n=e.v){e.n=2;break}return e.a(2);case 2:return cl("_model# ".concat(n.tid.val)),e.a(2,n)}},e)}));return function(t){return e.apply(this,arguments)}}()),e.n=1,Promise.all(n);case 1:return r=e.v,e.a(2,r.filter(function(e){return e}))}},e)}));return function(){return e.apply(this,arguments)}}(),Yc=function(){var e=fo(co().m(function e(t){var n,r,i,s,a;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ic("/inori/model/json/".concat(t),"application/json");case 1:return n=e.v,r=new TextDecoder("utf-8"),i=r.decode(n),s=JSON.parse(i),e.n=2,Ic("/inori/model/weight/".concat(t),"application/octet-stream");case 2:return a=e.v,s.weightData=a,s.tid=t,e.a(2,s)}},e)}));return function(t){return e.apply(this,arguments)}}(),Zc={get:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Yo.content.content;return e>-1?t&&t[e]:t&&t[Zc.getIndex()]},getAll:function(){return Yo.content.content},setIndex:function(e){Yo.content.contentIndex=e},getIndexByName:function(e){return Yo.content.content.indexOf(e)},getIndex:function(){return Yo.content.contentIndex},getL1:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Yo.content.contentL1[Zc.getIndex()];return e>-1?t&&t[e]:t&&t[Zc.getL1Index()]},getAllL1:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Yo.content.contentL1[Zc.getIndex()]:Yo.content.contentL1[e]},setL1Index:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t<0?Yo.content.contentL1Index[Zc.getIndex()]=e:Yo.content.contentL1Index[t]=e},getL1Index:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Yo.content.contentL1Index[Zc.getIndex()]:Yo.content.contentL1Index[e]},getL2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Yo.content.contentL2&&Yo.content.contentL2[Zc.getIndex()];return e>-1?t&&t[e]:t&&t[Zc.getL1Index()]},getAllL2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Yo.content.contentL2&&Yo.content.contentL2[Zc.getIndex()]:Yo.content.contentL2&&Yo.content.contentL2[e]},getAllL3:function(){return Yo.content.contentL3},getX509Sbj:function(){return Yo.content.contentX509}},Jc=function(){var e=fo(co().m(function e(t){var n,r,i,s,a,o,l,c,u,h,d,f,p,m,g,v,_,b,y,w,S,x,E,C,A,M,k,T,R,P,I,D,O,L,B,N,U,H,F,j,z;return co().w(function(e){for(;;)switch(e.n){case 0:if(t.data.label){e.n=1;break}return ul("".concat(t.data," invalid}")),e.a(2);case 1:tl.has(t.data.label)||tl.set(t.data.label,[]),n=tl.get(t.data.label),t.data.last_update=Date.now(),n.push(t.data),r=[t.data.from,t.data.to,t.data.label,t.data.data],i=r[0]||Qo,s=r[1]||Qo,gc(i,r[3],r[2],s),a=r[2].split(":"),k=a[0],e.n="admin"===k?2:"tenant"===k?27:"guest"===k?61:"local"===k?68:110;break;case 2:T=a[1],e.n="heartbeat"===T?3:"data"===T?4:"system"===T?17:25;break;case 3:return cl("".concat(a.join(":")," by admin")),e.a(2);case 4:R=a.slice(2).join(":"),e.n="geos:content:<geo_locations>"===R?5:"tenant:content:received:<tenant>"===R?6:"subjects:content:<subjects>"===R?7:"ice_servces:content:<ice_services>"===R?8:"ice_offers:content:<ice_offers>"===R?9:"ice_offers:content:received:<ice_offers>"===R?10:"ice_offer:content:<ice_offer>"===R?11:"invalid_content"===R||"invalid_cred"===R?12:"message_info:content:<message_info>:received"===R?13:"message_infos:content:<message_infos>"===R?14:15;break;case 5:return cl("".concat(a.join(":")," sent by bridge")),Yo.geo_locations=r[3],e.a(3,16);case 6:return cl("".concat(a.join(":")," acknowledged by admin")),e.a(3,16);case 7:return cl("".concat(a.join(":")," sent by bridge")),Yo.subjects=r[3],e.a(3,16);case 8:return cl("".concat(a.join(":")," sent by bridge")),Yo.ice_services=r[3],e.a(3,16);case 9:return e.a(3,16);case 10:return o=r[3],Yo.ice_offers=o,e.a(3,16);case 11:return e.a(3,16);case 12:return cl("".concat(a.join(":")," by cell")),e.a(2);case 13:return Yo.message_infos.list=Yo.message_infos.list.filter(function(e){return e.code!=r[3].code}),Yo.message_infos.list.push(r[3]),e.a(2);case 14:return cl("".concat(a.join(":")," upd msg bus in util")),Yo.message_infos=r[3],e.a(2);case 15:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 16:return e.a(3,26);case 17:P=a.slice(2).join(":"),e.n="profile:metric:<bytes>:confirmed"===P?18:"event:timeout"===P||"event:notice"===P?19:"received:<string>"===P||"event:service:<string>"===P?20:"event:tenant_online"===P||"event:tenant_offline"===P||"event:tenant_exit"===P||"event:tenant_exit:received"===P?21:"error:<string>"===P?22:23;break;case 18:try{l=(new TextDecoder).decode(r[3]),c=JSON.parse(l),cl("".concat(a.join(":"),":"),c)}catch(e){u=new Blob([r[3]],{type:"application/octet-stream"}),h=URL.createObjectURL(u),(d=document.createElement("a")).href=h,d.download="profile.pprof",d.click(),URL.revokeObjectURL(h)}return e.a(3,24);case 19:return e.a(3,24);case 20:return cl("".concat(a.join(":")," > ").concat(r[3])),e.a(3,24);case 21:return cl("".concat(a.join(":")," by ").concat(i)),e.a(3,24);case 22:return ul("".concat(a.join(":")," > ").concat(r[3])),e.a(3,24);case 23:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 24:return e.a(3,26);case 25:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 26:return e.a(3,111);case 27:I=a[1],e.n="data"===I?28:59;break;case 28:D=a.slice(2).join(":"),e.n="x509:content:received:<subject>"===D?29:"x509:content:<subject>"===D?30:"chunk:root_cert:<bytes>"===D?31:"chunk:pub_key:signed:<bytes>"===D?34:"leads:content:<leads>"===D?35:"ice_offer:req:<processor_id>"===D?36:"processor:delete:<processor_id>:received"===D?39:"processor:delete:<processor_id>"===D?41:"ice_offer:content:<ice_offer>"===D?45:"ice_offer:content:updated:<ice_offer>"===D||"ice_offer:content:answered:<ice_offer>"===D?49:"processor:content:<processor>"===D?51:"processor:content:received:<processor>"===D?52:"tenants:content:<active_tenants>"===D?54:"channels:list:<rtmp_channels>"===D?56:57;break;case 29:return cl("received ".concat(a.join(":"))),e.a(2);case 30:return Ml(r[3])||ul("failed updating license info for tenant: ".concat(r[3].tenantId)),cl("received ".concat(a.join(":"))),e.a(2);case 31:return e.n=32,ql(r[3],s,i);case 32:if(e.v){e.n=33;break}return ul("received ".concat(a.join(":"),"; invalid root cert")),e.a(2);case 33:return fl(),cl("received ".concat(a.join(":"))),e.a(2);case 34:return cl("received ".concat(a.join(":"))),e.a(2);case 35:return cl("received ".concat(a.join(":"))),Yo.leads=r[3],e.a(2);case 36:if(f=r[3],!(p=bc(f))||!p.isPilotEnabled){e.n=38;break}return cl("".concat(a.join(":")," for processor# ").concat(f)),e.n=37,p.resp2StreamReq(r[0]);case 37:e.v;case 38:return e.a(2);case 39:if(m=r[3]){e.n=40;break}return ul("".concat(a.join(":")," invalid processor id")),e.a(2);case 40:return Cc(m),cl("".concat(a.join(":")," with processor id: ").concat(m," answered.")),e.a(2);case 41:if(g=r[3]){e.n=42;break}return ul("".concat(a.join(":")," invalid processor id")),e.a(2);case 42:if(cl("".concat(a.join(":")," with processor id: ").concat(g," received.")),!(v=bc(g))){e.n=44;break}return e.n=43,_c(v,!0);case 43:pl({from:r[1],to:r[0],label:"tenant:data:processor:delete:<processor_id>:received",data:r[3]});case 44:return e.a(2);case 45:if(!(_=r[3])||!_.uid){e.n=49;break}if(cl("received ".concat(a.join(":")," with offer# ").concat(_.id," from runtime# ").concat(r[0])),b=lc(r[0])){e.n=46;break}return ul("".concat(a.join(":")," discarded. invalid session# ").concat(r[0])),e.a(2);case 46:if(!bc(_.processorId)){e.n=47;break}return e.a(2);case 47:return(y=$c("live-preview-".concat(b.sessionId.split("-")[0]))).peerChannelCallback=function(){var e=fo(co().m(function e(t){var n,i;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,n=wc().filter(function(e){return e.dat.sessionId==Qo&&(e.isLocalScreenStream||e.isLocalVideoStream)}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}),n&&gl({from:r[1],to:r[0],label:"tenant:data:processors:content:<processors>",data:{list:n}}),e.n=2;break;case 1:return e.p=1,i=e.v,ul("resp2RemoteStream > streamInitCallback > err: ".concat(i)),e.n=2,_c(y);case 2:return e.a(2)}},e,null,[[0,1]])}));return function(t){return e.apply(this,arguments)}}(),e.n=48,y.resp2RemoteStream(_);case 48:return e.a(2);case 49:if(!(w=r[3])||!w.uid){e.n=50;break}return cl("received ".concat(a.join(":")," with offer# ").concat(w.uid," from runtime# ").concat(r[0])),e.a(3,58);case 50:return e.a(2);case 51:return(S=r[3])&&(sc({list:[S]}),x=wc().filter(function(e){return e.Id()==S.id&&0==e.dat.name.indexOf("guest")}),1==x.length&&(x[0].dat=S),cl("".concat(a.join(":")," by runtime# ").concat(r[0]))),e.a(2);case 52:if(!r[3]||!r[3].id){e.n=53;break}return e.a(2);case 53:return ul("".concat(a.join(":")," failed in decoding")),e.a(2);case 54:return E=r[3],oc(E),e.n=55,cc();case 55:return cl("".concat(a.join(":")," by runtime# ").concat(r[0]),E),e.a(3,58);case 56:return Yo.channels=r[3],cl("".concat(a.join(":")," by runtime# ").concat(r[0]),Yo.channels),e.a(3,58);case 57:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 58:return e.a(3,60);case 59:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 60:return e.a(3,111);case 61:O=a[1],e.n="data"===O?62:66;break;case 62:r[3],L=a.slice(2).join(":"),e.n="contact:content:<contact>"===L||"contact:content:<contact>:received"===L||"message:content:<tenant_message>:received"===L||"message:content:<tenant_message>:confirmed"===L?63:64;break;case 63:return e.a(3,65);case 64:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 65:return e.a(3,67);case 66:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 67:return e.a(3,111);case 68:B=a[1],e.n="authenticated"===B?69:"profile"===B?70:"fs"===B?73:"file"===B?77:"intd"===B?78:"init"===B?80:"bootstrapped"===B?81:"bootstrap"===B?82:"logout"===B?83:"conn"===B?87:"dchn"===B?91:"system"===B?95:"peer"===B?104:"content"===B?107:108;break;case 69:return cl("".concat(a.join(":")," tenant authenticated.")),e.a(3,109);case 70:a[2],e.n=71;break;case 71:return cl("".concat(a.join(":")," by local")),e.a(2);case 72:return e.a(3,109);case 73:N=a[2],e.n="bootstrapped"===N?74:75;break;case 74:return e.a(3,76);case 75:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 76:return e.a(3,109);case 77:return C=new CustomEvent("browser-file-saved",{detail:a.join(":")}),document.dispatchEvent(C),e.a(3,109);case 78:return e.n=79,Ql("/inori");case 79:return cl("compute vm initialised."),e.a(3,109);case 80:return cl("compute vm initialising in process."),e.a(3,109);case 81:return cl("compute vm bootstrapped. _this.env.in_session: ".concat(Jo)),e.a(3,109);case 82:return cl("compute vm bootstrap in process."),e.a(3,109);case 83:U=a[2],e.n="done"===U||"timeout"===U?84:85;break;case 84:return cl("".concat(a.join(":")," by local")),e.a(3,86);case 85:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 86:return e.a(3,109);case 87:H=a[2],e.n="timeout"===H||"ice_gather"===H||"ice_gather_completed"===H?88:89;break;case 88:return cl("".concat(a.join(":")," by local")),e.a(3,90);case 89:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 90:return e.a(3,109);case 91:F=a[2],e.n="close"===F||"failed"===F||"error"===F||"closg"===F||"disconnected"===F||"open"===F?92:93;break;case 92:return cl("".concat(a.join(":")," by local")),e.a(3,94);case 93:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 94:return e.a(3,109);case 95:j=a.slice(2).join(":"),e.n="protobuf:<enum>"===j?96:"event:<string>"===j?97:"closed"===j?98:"open"===j?100:102;break;case 96:return cl("".concat(a.join(":"),":"),r[3]),Xo=r[3],e.a(3,103);case 97:return ll(r[3]),e.a(3,103);case 98:return Jo=!1,e.n=99,fl();case 99:return e.a(3,103);case 100:return e.n=101,ml();case 101:return e.a(3,103);case 102:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 103:return e.a(3,109);case 104:z=a[2],e.n="send"===z?105:"rcvd"===z?106:107;break;case 105:return(A=Yo.tenant.subscriptions[s])&&A.peerChannel&&"open"==A.peerChannel.readyState&&A.peerChannel.send(r[3]),e.a(2);case 106:return(M=Yo.tenant.subscriptions[i])&&M.peerChannel&&M.peerChannel.onmessage&&M.peerChannel.onmessage({data:{from:i,to:s,label:t.data.label_2_forward,data:r[3]},type:"message",target:M.peerChannel}),e.a(2);case 107:return Yo.content=r[3],cl("".concat(a.join(":"),":"),r[3]),e.a(2);case 108:return cl("".concat(a.join(":"),":"),"unprocessed"),e.a(2);case 109:return e.a(3,111);case 110:return cl("".concat(a.join(":")," unprocessed")),e.a(2);case 111:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Qc=function(){var e=fo(co().m(function e(){return co().w(function(e){for(;;)switch(e.n){case 0:e.n=1;break;case 1:return e.n=2,Co("workers/inori.js");case 2:return e.a(2,new Promise(function(){var e=fo(co().m(function e(t,n){return co().w(function(e){for(;;)switch(e.n){case 0:Module.onRuntimeInitialized=fo(co().m(function e(){var n;return co().w(function(e){for(;;)switch(e.n){case 0:($o=new Worker("workers/mq-worker.".concat("min.","js"))).onmessage=Jc,n={env:{channels:function(){return Yo.channels.list},scenes:{earth:!1,nav:!1,room:!1},sceneStats:{objects:[],isStreetView:!0},content:Zc,bridge_id:function(){return qo},bridge_sbj:function(){return!!Ko&&Ll(Ko)},in_session:function(){return Jo},name:_o},mq:{set_message_info:dc,msg_ts:function(e){return tl.get(e)||[]},msg_infos:function(){return Yo.message_infos.list.sort(function(e,t){return e.label.localeCompare(t.label)})},sys_dbg:function(e){cl(e)},event:el,worker:function(){return $o}},tenant:{kill_channel:function(e){return pl({label:"admin:data:service:status:<setting>",data:{isLive:!1,metadataExt2:e}}),new Promise(function(t){var n=!1;window.addEventListener("admin:data:service:status:<setting>:confirmed",function(){var r=fo(co().m(function r(i){var s;return co().w(function(r){for(;;)switch(r.n){case 0:i.detail.content.metadataExt2==e?(t(!0),n=!0):(s=new CustomEvent(i.type,{detail:i.detail,bubbles:i.bubbles,cancelable:i.cancelable,composed:i.composed}),window.dispatchEvent(s));case 1:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),Ao(5e3).then(function(){n||t(!1)})})},get_file_type_values:function(){return Xo.FileType.values},get_file_chunks:function(){return Yo.file_chunks},get_mini_files:function(){return Yo.mini_files},get_video_file:function(e,t,n,r,i){Yo.file_chunks[n]={fileId:n},gl({from:Qo,to:e,label:"tenant:video:chunk:process:req:<file_desc>",data:{path:t,metadata:n,type:r,contentType:i}})},get_remote_file:function(e,t,n,r,i){Yo.file_chunks[n]={fileId:n},gl({from:Qo,to:e,label:"tenant:data:chunk:content:req:<file_desc>",data:{path:t,metadata:n,type:r,contentType:i,isLive:!1}})},stop_remote_file:function(e,t,n){gl({from:Qo,to:e,label:"service:drive:file:chunk:del:<file_chunks>",data:{metadata:t,metadataExt1:n}})},upd_remote_file_list:function(e,t,n){gl({from:Qo,to:e,label:"service:drive:content:dir:req:<file_desc>",data:{path:t}}),Yo.directory_list={remoteId:e,root:t,files:[]},window.addEventListener("service:drive:content:dir:<file_descs>",function(e){if(e.detail.content&&e.detail.content.list){var t=Yo.directory_list,r=e.detail.content.list;r=r.filter(function(e){return!t.files.some(function(t){return"".concat(e.path,"/").concat(e.name)==="".concat(t.path,"/").concat(t.name)})}),t.files=[].concat(po(t.files),po(r)),n&&n(t)}})},req_drive_backup:function(e,t,n,r,i){gl({from:Qo,to:e,label:"service:drive:backup:req:<file_desc>",data:{name:t,path:n,metadata:r,metadata1:i}})},api_keys:function(){return Yo.tenant.apiKeys},session_info:function(){return Yo.tenants.list.find(function(e){return e.sessionId.toLowerCase()==Qo.toLowerCase()})},subject:function(){return Yo.tenant.subject},disable_license:function(e){pl({label:"admin:data:license:expire:<serial_number>",data:e})},renew_license:function(e){pl({label:"admin:data:license:renew:<serial_number>",data:e})},get_subjects:Al,get_subject_upd_reqs:function(e){return Yo.subject_reqs[e]||[]},del_subject_upd_req:function(e,t){var n=Yo.subject_reqs[e]&&Yo.subject_reqs[e].filter(function(e){return e.metadata!=t});Yo.subject_reqs[e]=n},cred:function(){return Yo.tenant.cred},get_geo_locations:function(){return Yo.geo_locations.list},get_subscription:function(e){if(!e)return!1;var t,n=ec().find(function(t){return t.sessionId==e});if(t=n?Object.values(Yo.tenant.subscriptions).find(function(e){return e.sessionId==n.sessionId}):Yo.tenant.subscriptions[e]){if(t.sessionId!=n.sessionId&&(t.unsubscribe(),t.sessionId=n.sessionId),n.sessionId.toLowerCase()==Qo.toLowerCase())return cl("local subscription# ".concat(t.Id()," available")),t;var r;if("connected"==(null===(r=t.conn)||void 0===r?void 0:r.connectionState))return t;cl("remote subscription# ".concat(t.Id()," not connected"))}},del_subscription:function(e){var t=Yo.tenant.subscriptions[e];t&&(t.dispose(),delete Yo.tenant.subscriptions[e])},add_subscription:function(e){Yo.tenant.subscriptions[e.Id()]=e},get_command_values:function(){return Xo.Command.values},add_processor:$c,del_processor:_c,get_processor:bc,get_remote_processors:Sc,get_remote_processors_in_groups:xc,get_remote_processor:Ec,del_remote_processor:Ac,get_processors:wc,get_processors_by_session_id:yc,set_file:function(e,t){Yo.tenant.file_map[e]=t},has_local_stream_processor:function(){return wc().filter(function(e){return e.dat.sessionId==Qo&&(e.isLocalScreenStream||e.isLocalVideoStream||e.localFileStream)}).length>0},add_notification:gc,notifications:function(){var e=Yo.tenant.notifications.filter(function(e){return"local:system:event:<string>"!=e.msg}).sort(function(e,t){return t.last_update-e.last_update});return e},logs:function(){var e=Yo.tenant.notifications.filter(function(e){return"local:system:event:<string>"==e.msg}).sort(function(e,t){return t.last_update-e.last_update});return e},dataset:function(){return Yo},dataType:function(){return Xo},session_id:function(){return Qo},bridge_id:function(){return qo},clog:ll,exit_session:function(){var e=fo(co().m(function e(t){var n,r,i;return co().w(function(e){for(;;)switch(e.n){case 0:for(Yo.tenant.processors.forEach(function(e){e&&(e.stop_mediaStream(),e.deinit(),e=null)}),Yo.tenant.processors=[],n=0,r=Object.entries(Yo.tenant.subscriptions);n<r.length;n++)(i=lo(r[n],2))[0],i[1].dispose();return Yo.tenant.subscriptions={},e.n=1,vc();case 1:FS.unmount("/inori"),FS.rmdir("/inori");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),answer_offer:Gc,checkout_offer:function(e){var t=Object.values(Yo.tenant.ice_offers).filter(function(t){return t.uid.toLowerCase()==e.dat.remoteId.toLowerCase()}).sort(function(e,t){return t.lastUpdate>e.dat.lastUpdate});if(t.length>0)return t[0]},standby_screen_sharing:uc,standby_video_sharing:hc,resume_offer:function(e){var t=Object.values(Yo.tenant.ice_offers).filter(function(t){return t.aid&&t.aid.toLowerCase()==e.dat.remoteId.toLowerCase()}).sort(function(e,t){return t.lastUpdate>e.dat.lastUpdate});if(t.length>0)return t[0]},create_offer:Vc,update_offer:Wc,create_contact:function(e){return e.LastName||(e.LastName=e.Email),pl({to:qo,label:"guest:data:contact:content:<contact>",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:contact:content:<contact>:received",function(){var n=fo(co().m(function n(r){return co().w(function(n){for(;;)switch(n.n){case 0:e(!0),t=!0;case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0}),Ao(15e3).then(function(){t||e(!1)})})},get_bridge_offers:function(){return!!(Yo.ice_offers&&Yo.ice_offers.list&&Yo.ice_offers.list.length>0)&&Yo.ice_offers},get_active_tenants_owned_by_current_session:function(){return ec().filter(function(e){return e.id.toLowerCase()==Yo.tenant.subject.serialnumber.val.toLowerCase()})},get_active_tenants:ec,get_active_services:tc,get_tenant_role_by_session_id:rc,get_vendors:nc,get_tkn:function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Yl();case 1:return n=e.v,e.a(2,btoa("".concat(Qo,":").concat(n)))}},e)}));return function(t){return e.apply(this,arguments)}}(),get_shadow_tkn:function(e){pl({to:e,label:"tenant:tcp:forward:req:<token>",data:""})},upd_x509_sbj:function(){var e=fo(co().m(function e(t){return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,hl(t);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}()},util:{get_app_metrics:function(e){pl({to:e,label:"admin:system:profile:metric:<keys>",data:{keys:["/app/profile:10:10","/app/process:5","/cpu/classes/gc/mark/assist:cpu-seconds"]}})},get_sys_profile:function(){},fileExists:Mc,syncFiles:Rc,normalizePath:zo,findKeyByValue:jo,formatUnix2Detail:Uo,formatUnix2Date:Ho,validateCurrentTime:Fo,dbg:cl,exp:ul,sql:{get_leads:function(){return Yo.leads.list.length<1&&pl({label:"tenant:sql:query:<sql>",data:{table:"leads",type:Xo.SqlType.values.SELECT,limit:100}}),Yo.leads}},verify_msg:function(e){return e.id=Qo,e.lastUpdate=(new Date).getTime(),pl({to:qo,label:"guest:data:message:content:<tenant_message>",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:message:content:<tenant_message>:received",function(){var n=fo(co().m(function n(r){return co().w(function(n){for(;;)switch(n.n){case 0:e(r.detail.content),t=!0;case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0}),Ao(5e3).then(function(){t||e(!1)})})},validt_num:function(e){return e.id=Qo,e.messageType=Xo.MessageType.values.IVR,e.lastUpdate=(new Date).getTime(),pl({to:qo,label:"guest:data:message:content:<tenant_message>:confirm",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:message:content:<tenant_message>:confirmed",function(){var n=fo(co().m(function n(r){return co().w(function(n){for(;;)switch(n.n){case 0:e(!0),t=!0;case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0}),Ao(5e3).then(function(){t||e(!1)})})},del_trainer_file:function(){var e=fo(co().m(function e(t){return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Tc("/inori/model/json/".concat(t));case 1:return e.n=2,Tc("/inori/model/weight/".concat(t));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),get_trainer_models:Xc,get_prediction_size:Bo,set_prediction:function(){var e=fo(co().m(function e(t,n,r,i){return co().w(function(e){for(;;)switch(e.n){case 0:if(!i){e.n=1;break}gl({from:Qo,to:null==n?void 0:n.sessionId,label:"tenant:data:prediction:setup:<prediction>",data:r}),e.n=2;break;case 1:return e.n=2,t.configTrainer(r);case 2:return e.a(2)}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}(),train_prediction:function(){var e=fo(co().m(function e(t,n,r,i){return co().w(function(e){for(;;)switch(e.n){case 0:if(!i){e.n=1;break}gl({from:Qo,to:null==n?void 0:n.sessionId,label:"tenant:data:prediction:train:<prediction>",data:r}),e.n=2;break;case 1:return e.n=2,t.procTrainer();case 2:return e.a(2)}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}(),unset_prediction:function(){var e=fo(co().m(function e(t,n,r,i){return co().w(function(e){for(;;)switch(e.n){case 0:if(!i){e.n=1;break}gl({from:Qo,to:null==n?void 0:n.sessionId,label:"tenant:data:prediction:unset:<prediction>",data:r}),e.n=2;break;case 1:return e.n=2,t.disableTrainer(r);case 2:return e.a(2)}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}(),capture_frame:function(e,t){var n=Mo(150,t),r=Ec(null==e?void 0:e.Id());r&&(r.screenshot=n,cl("video frame captured"))},capture_frame_area:function(e,t){return ko(t,e)},delayFunction:Ao,model:function(){return _model},calculateElapsedMinutes:To,init_comm:function(){var e=fo(co().m(function e(){var t=arguments;return co().w(function(e){for(;;)switch(e.n){case 0:if(!(t.length>0&&void 0!==t[0]&&t[0])){e.n=2;break}return e.n=1,dl();case 1:if(e.v){e.n=2;break}return e.a(2,!1);case 2:return e.n=3,fl();case 3:return e.a(2,e.v)}},e)}));return function(){return e.apply(this,arguments)}}(),dir:{info:function(){return Yo.tenant.file_info_map},load:Cl},clog:ll,download_cert:function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,kl(Yo.tenant.file_info_map.dir[t]);case 1:return n=e.v,e.a(2,n.asFile())}},e)}));return function(t){return e.apply(this,arguments)}}(),download_pkey:function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Tl(Yo.tenant.file_info_map.dir[t]);case 1:return n=e.v,e.a(2,n.asFile())}},e)}));return function(t){return e.apply(this,arguments)}}(),bootstrap_bridge_keypairs:Jl,get_sbj_by_key:function(){var e=fo(co().m(function e(t){var n;return co().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,kl(Yo.tenant.file_info_map.dir[t]);case 1:if(!(n=e.v)){e.n=2;break}return e.a(2,Ll(n.asCert()));case 2:return e.a(2,!1)}},e)}));return function(t){return e.apply(this,arguments)}}(),replace_keypair:function(){var e=fo(co().m(function e(){var t,n,r;return co().w(function(e){for(;;)switch(e.n){case 0:return t=Yo.tenant.file_info_map.dir,e.n=1,kc(t.tmp_pkey,t.pkey);case 1:return n=e.v,e.n=2,kc(t.tmp_cert,t.cert);case 2:if(r=e.v,!n||!r){e.n=3;break}return e.a(2,!0);case 3:return e.a(2,!1)}},e)}));return function(){return e.apply(this,arguments)}}(),convert_path_2_Id:Vo,read_image_obj:Oc,write_file:function(e,t,n){return new Promise(function(){var e=fo(co().m(function e(r,i){var s,a;return co().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,jc(t,n);case 1:if(!(s=Oc(n))){e.n=2;break}r(s),e.n=3;break;case 2:throw new Error("read_image_obj err");case 3:e.n=5;break;case 4:e.p=4,a=e.v,i(a);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t,n){return e.apply(this,arguments)}}())},write_blob_2_file:Hc,write_arrbuf_2_file:Fc,read_blob_2_str:Uc,parse_pvtkey_str:jl,parse_pubkey_str:zl,parse_cert_str:Fl,clear_comm:function(){return Promise.resolve(!0)},exit_session:function(e){return new Promise(function(){var t=fo(co().m(function t(n){var r;return co().w(function(t){for(;;)switch(t.n){case 0:return r=!1,t.n=1,e.tenant.exit_session(e);case 1:window.addEventListener("admin:system:event:tenant_exit:received",function(t){e.env.in_session=!1,n(t.detail),r=!0},{once:!0}),Ao(5e3).then(function(){r||(ul("exit_session time out"),n(!1))}),e.util.clear_comm().then(function(e){pl({label:"admin:system:event:tenant_exit",data:"placeholder"})});case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())},get_jwt_cred:function(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)},bootstrap_fs:Ql,theme_event_registry:So}},t(n);case 1:return e.a(2)}},e)}));case 1:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}()))}},e)}));return function(){return e.apply(this,arguments)}}();function eu(e){return eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eu(e)}function tu(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function nu(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return ru(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(ru(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ru(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,ru(h,"constructor",c),ru(c,"constructor",l),l.displayName="GeneratorFunction",ru(c,i,"GeneratorFunction"),ru(h),ru(h,i,"Generator"),ru(h,r,function(){return this}),ru(h,"toString",function(){return"[object Generator]"}),(nu=function(){return{w:s,m:d}})()}function ru(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}ru=function(e,t,n,r){function s(t,n){ru(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},ru(e,t,n,r)}function iu(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function su(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,au(r.key),r)}}function au(e){var t=function(e){if("object"!=eu(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=eu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==eu(t)?t:t+""}function ou(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ou=function(){return!!e})()}function lu(e){return lu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lu(e)}function cu(e,t){return cu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},cu(e,t)}var uu,hu,du,fu,pu,mu,gu,vu,_u,bu,yu,wu,Su,xu,Eu=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=lu(t),function(e,t){if(t&&("object"==eu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ou()?Reflect.construct(t,n||[],lu(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.initialised=!1,e.inSession=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cu(e,t)}(t,e),function(e,t,n){return t&&su(e.prototype,t),n&&su(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){(e.has("inori")||e.has("inSession"))&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){iu(s,r,i,a,o,"next",e)}function o(e){iu(s,r,i,a,o,"throw",e)}a(void 0)})}}(nu().m(function e(){return nu().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"handleImageLoad",value:function(e){this.inori.mq.worker().postMessage({label:"local:profile:picture:loaded"})}},{key:"render",value:function(){return W(rl||(rl=tu(["\n      ",""])),this.initialised?W(il||(il=tu(['\n<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">                  \n  <a class="navbar-brand col-md-3 col-lg-2 col-12 mx-0 mx-auto py-0 fs-6 row align-items-center" href="#"><img src="./img/hiddenclouds-100x100.png" class="rounded float-start img-fluid col-4" alt="hiddenclouds.io"><span class="col-8 ">hiddenclouds.io</span></a>\n  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">\n      <span class="navbar-toggler-icon"></span>\n  </button>\n  <input class="form-control form-control-dark w-100 rounded-0 border-0" type="text" placeholder="Search" aria-label="Search">\n  <div class="navbar-nav mx-1 px-2 col-1">\n  \n    <a class="nav-link mx-1 px-4">\n      <div class="position-relative">        \n          <span class="position-absolute top-0 start-0 translate-middle p-1 ',' border border-light rounded-circle">\n            <span class="visually-hidden">New alerts</span>\n          </span>    \n          ',"\n      </div>    \n    </a>\n  </div>\n</header>"])),this.inSession?"bg-success":"bg-dark",""!=this.photo&&this.initialised?W(sl||(sl=tu(['<img class="img-thumbnail avatar-img rounded-rectangle" crossOrigin="anonymous" src="','" @load=',">"])),this.photo,this.handleImageLoad):W(al||(al=tu(['<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-square" viewBox="0 0 16 16">\n            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>\n            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1v-1c0-1-1-4-6-4s-6 3-6 4v1a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12z"/>\n          </svg>'])))):W(ol||(ol=tu(['\n<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">                  \n  <a class="navbar-brand col-md-3 col-lg-2 col-12 mx-0 mx-auto py-0 fs-6 row align-items-center" href="#"><img src="./img/hiddenclouds-100x100.png" class="rounded float-start img-fluid col-4" alt="hiddenclouds.io"><span class="col-8 ">hiddenclouds.io</span></a>  \n</header>']))))}}],[{key:"properties",get:function(){return{inori:{type:Object},initialised:{type:Boolean},inSession:{type:Boolean},photo:{type:String}}}}]);var n}(ce);function Cu(e){return Cu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cu(e)}function Au(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Mu(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return ku(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(ku(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ku(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,ku(h,"constructor",c),ku(c,"constructor",l),l.displayName="GeneratorFunction",ku(c,i,"GeneratorFunction"),ku(h),ku(h,i,"Generator"),ku(h,r,function(){return this}),ku(h,"toString",function(){return"[object Generator]"}),(Mu=function(){return{w:s,m:d}})()}function ku(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}ku=function(e,t,n,r){function s(t,n){ku(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},ku(e,t,n,r)}function Tu(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Ru(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){Tu(s,r,i,a,o,"next",e)}function o(e){Tu(s,r,i,a,o,"throw",e)}a(void 0)})}}function Pu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Iu(r.key),r)}}function Iu(e){var t=function(e){if("object"!=Cu(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Cu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Cu(t)?t:t+""}function Du(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Du=function(){return!!e})()}function Ou(e){return Ou=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ou(e)}function Lu(e,t){return Lu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lu(e,t)}customElements.define("streaming-header",Eu);var Bu,Nu,Uu,Hu,Fu,ju,zu,Vu,Gu,Wu,qu=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=Ou(t),function(e,t){if(t&&("object"==Cu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Du()?Reflect.construct(t,n||[],Ou(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.tenants=null,e.tenants_requested={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lu(e,t)}(t,e),function(e,t,n){return t&&Pu(e.prototype,t),n&&Pu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(i=Ru(Mu().m(function e(){return Mu().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"renderTenantHeader",value:function(){return this.inori.tenant.get_active_tenants()?["name","lastUpdate","sessionId","opCode","runnerId","device","services"].map(function(e){return"sessionId"==e?W(hu||(hu=Au(['<th class="fw-lighter" scope="col">sessionId</th>']))):"services"==e?W(du||(du=Au(['<th class="fw-lighter" scope="col"></th>']))):W(fu||(fu=Au(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W(uu||(uu=Au([""])))}},{key:"renderTenantContent",value:function(){var e=this.tenants,t=this,n=t.inori.tenant.session_info();return e||(e={}),Object.values(e).map(function(e){return W(pu||(pu=Au(["<tr>","</tr>"])),["name","lastUpdate","sessionId","opCode","runnerId","device","services"].map(function(r){if("sessionId"==r)return W(mu||(mu=Au(['<td class="fw-light"><span class="d-inline-block text-truncate" style="max-width: 150px;">',"</span></td>"])),e[r]);if("services"==r)return W(gu||(gu=Au(['\n          <td class="fw-light align-bottom">',"\n          </td>"])),n.role==t.inori.tenant.dataType().Role.values.ADMIN&&n.sessionId!=e.sessionId?W(vu||(vu=Au(['\n            <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-square" viewBox="0 0 16 16">            \n                  <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"></path>\n                  <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"></path>\n              </svg>\n            <a>'])),function(e){t.inori.tenant.disable_license(license.tenantId)}):W(_u||(_u=Au([""]))));var i=e[r];if(!i)return W(bu||(bu=Au(['<td class="fw-light"></td>'])));if("device"==r)return W(yu||(yu=Au(['<td class="fw-light">',"</td>"])),i&&i.name);if("lastUpdate"==r){var s=t.inori.util.formatUnix2Date(i);return W(wu||(wu=Au(['<td class="fw-light">',"</td>"])),s)}return W(Su||(Su=Au(['<td class="fw-light">',"</td>"])),i.length>20?i.substring(0,20)+"...":i)}))})}},{key:"processStream",value:(r=Ru(Mu().m(function e(t){return Mu().w(function(e){for(;;)switch(e.n){case 0:this.requestUpdate();case 1:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"connectDevice",value:(n=Ru(Mu().m(function e(t){return Mu().w(function(e){for(;;)switch(e.n){case 0:this.tenants_requested[t]=!0,this.dispatchEvent(new CustomEvent("local:stream:req",{detail:{tab_id:0,metadata:t}}));case 1:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){return W(xu||(xu=Au(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n    <h4 class="card-title mb-4">','</h4>\n    <table class="table table-striped table-hover">\n      <thead>\n        <tr>\n          ',"\n        </tr>\n      </thead>\n      <tbody>\n        ","\n      </tbody>\n    </table>\n</main>"])),this.inori.env.content.get(),this.renderTenantHeader(),this.renderTenantContent())}}],[{key:"properties",get:function(){return{inori:{type:Object},tenants:{type:Object},tenants_requested:{type:Object}}}}]);var n,r,i}(ce);function Ku(e){return Ku="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ku(e)}function $u(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Xu(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return Yu(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Yu(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Yu(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,Yu(h,"constructor",c),Yu(c,"constructor",l),l.displayName="GeneratorFunction",Yu(c,i,"GeneratorFunction"),Yu(h),Yu(h,i,"Generator"),Yu(h,r,function(){return this}),Yu(h,"toString",function(){return"[object Generator]"}),(Xu=function(){return{w:s,m:d}})()}function Yu(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Yu=function(e,t,n,r){function s(t,n){Yu(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},Yu(e,t,n,r)}function Zu(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Ju(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){Zu(s,r,i,a,o,"next",e)}function o(e){Zu(s,r,i,a,o,"throw",e)}a(void 0)})}}function Qu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,eh(r.key),r)}}function eh(e){var t=function(e){if("object"!=Ku(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ku(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ku(t)?t:t+""}function th(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(th=function(){return!!e})()}function nh(e){return nh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nh(e)}function rh(e,t){return rh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rh(e,t)}customElements.define("streaming-tenants",qu);var ih,sh,ah,oh,lh,ch,uh,hh,dh,fh,ph,mh,gh,vh,_h,bh,yh,wh,Sh,xh,Eh,Ch,Ah,Mh,kh,Th,Rh,Ph,Ih,Dh,Oh,Lh,Bh,Nh,Uh,Hh,Fh,jh,zh,Vh,Gh,Wh=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=nh(t),function(e,t){if(t&&("object"==Ku(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,th()?Reflect.construct(t,n||[],nh(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.licenses=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rh(e,t)}(t,e),function(e,t,n){return t&&Qu(e.prototype,t),n&&Qu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=Ju(Xu().m(function e(){return Xu().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"renderLicenseHeader",value:function(){return this.licenses?["id","name","role","plan","valid thru","issuer",""].map(function(e){return W(Nu||(Nu=$u(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W(Bu||(Bu=$u([""])))}},{key:"renderLicenseContent",value:function(){var e=this.licenses,t=this;return t.inori.tenant.dataType().Role.values,t.inori.tenant.dataType().Plan.values,e||(e={}),Object.values(e).map(function(e){var n="".concat(t.inori.util.formatUnix2Date(e.noBefore)," - ").concat(t.inori.util.formatUnix2Date(e.noAfter)),r=t.inori.util.validateCurrentTime(e.noBefore,e.noAfter);return W(Uu||(Uu=$u(["<tr>","</tr>",""])),["tenantId","tenantName","tenantRole","tenantPlan","valid_thru","tenantIssuerId",""].map(function(i){if("valid_thru"==i)return W(Hu||(Hu=$u(['<td class="fw-light text-wrap ','">',"","</td>"])),r?"":"text-danger",n,r?"":" (invalid)");if(""==i)return W(Fu||(Fu=$u(['\n        <td class="fw-light text-nowrap">\n          <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>\n              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>\n            </svg>\n          <a>\n          <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-range" viewBox="0 0 16 16">\n              <path d="M9 7a1 1 0 0 1 1-1h5v2h-5a1 1 0 0 1-1-1M1 9h4a1 1 0 0 1 0 2H1z"/>\n              <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>\n            </svg>\n          <a>\n        </td>'])),function(n){t.inori.tenant.disable_license(e.tenantId)},function(n){t.inori.tenant.renew_license(e.tenantId)});var s=e[i];return s?W(zu||(zu=$u(['<td class="fw-light">',"</td>"])),s.length>20?s.substring(0,20)+"...":s):W(ju||(ju=$u([""])))}),t.inori.tenant.get_subject_upd_reqs(e.tenantId).map(function(n){return W(Vu||(Vu=$u(['\n        <tr>\n          <td class="fw-light text-nowrap text-center" colspan="2">\n          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-right" viewBox="0 0 16 16">\n            <path fill-rule="evenodd" d="M1.5 1.5A.5.5 0 0 0 1 2v4.8a2.5 2.5 0 0 0 2.5 2.5h9.793l-3.347 3.346a.5.5 0 0 0 .708.708l4.2-4.2a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 8.3H3.5A1.5 1.5 0 0 1 2 6.8V2a.5.5 0 0 0-.5-.5"/>\n          </svg>\n          ','\n          </td>\n          <td class="fw-light text-nowrap">\n          ','\n          </td>\n          <td class="fw-light text-nowrap">\n          ','\n          </td>\n          <td class="fw-light text-nowrap" colspan="3">\n            ','\n            \n            <a class="btn btn-link btn-sm py-0 fw-normal" @click="','" rel="cancel">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">\n                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>\n              </svg>\n            </a>\n            <a class="btn btn-link btn-sm py-0 fw-normal" @click="','" rel="confirm">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">\n                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>\n              </svg>\n            </a>\n          </td>\n        </tr>'])),n.tenantName,n.tenantRole,n.tenantPlan,Object.keys(n).map(function(t){if(e[t]&&n[t]!=e[t])return W(Gu||(Gu=$u(["\n            <span>\n            "," => ",";            \n            </span>"])),e[t],n[t])}),function(r){t.inori.tenant.del_subject_upd_req(e.tenantId,n.metadata),t.requestUpdate()},function(){var r=Ju(Xu().m(function r(i){return Xu().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,t.inori.tenant.upd_x509_sbj(n);case 1:if(!r.v){r.n=2;break}t.inori.tenant.del_subject_upd_req(e.tenantId,n.metadata),t.requestUpdate();case 2:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}())}))})}},{key:"render",value:function(){var e=this.inori.env.content.getL2();return W(Wu||(Wu=$u(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n    <h4 class="card-title mb-4">','</h4>\n    <p class="card-text">','</p>\n    <table class="table table-striped table-hover">\n      <thead>\n        <tr>\n          ',"\n        </tr>\n      </thead>\n      <tbody>\n        ","\n      </tbody>\n    </table>\n</main>"])),this.inori.env.content.get(),e[0],this.renderLicenseHeader(),this.renderLicenseContent())}}],[{key:"properties",get:function(){return{inori:{type:Object},licenses:{type:Object}}}}]);var n}(ce);function qh(e){return qh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qh(e)}function Kh(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function $h(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return Xh(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Xh(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Xh(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,Xh(h,"constructor",c),Xh(c,"constructor",l),l.displayName="GeneratorFunction",Xh(c,i,"GeneratorFunction"),Xh(h),Xh(h,i,"Generator"),Xh(h,r,function(){return this}),Xh(h,"toString",function(){return"[object Generator]"}),($h=function(){return{w:s,m:d}})()}function Xh(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Xh=function(e,t,n,r){function s(t,n){Xh(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},Xh(e,t,n,r)}function Yh(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Zh(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){Yh(s,r,i,a,o,"next",e)}function o(e){Yh(s,r,i,a,o,"throw",e)}a(void 0)})}}function Jh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Qh(r.key),r)}}function Qh(e){var t=function(e){if("object"!=qh(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=qh(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qh(t)?t:t+""}function ed(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ed=function(){return!!e})()}function td(e){return td=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},td(e)}function nd(e,t){return nd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nd(e,t)}customElements.define("streaming-licenses",Wh);var rd=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=td(t),function(e,t){if(t&&("object"==qh(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ed()?Reflect.construct(t,n||[],td(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.notificationDetail=null,e.notifications=[],e.msgInfosPageIndex=1,e.msgInfosPageSize=100,e.rowUpdateIndexes=[],e.msgInfos=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nd(e,t)}(t,e),function(e,t,n){return t&&Jh(e.prototype,t),n&&Jh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=Zh($h().m(function e(){return $h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"renderMessageInfosPaging",value:function(e){var t=this,n=Math.ceil(e/this.msgInfosPageSize);if(n<2)return W(ih||(ih=Kh([""])));for(var r=[],i=function(e){r.push(W(uh||(uh=Kh(["",""])),t.msgInfosPageIndex-1==e?W(hh||(hh=Kh(['<li class="page-item active" aria-current="page"><span class="page-link">',"</span></li>"])),t.msgInfosPageIndex):W(dh||(dh=Kh(['<li class="page-item"><a class="page-link" href="#" @click="','">',"</a></li>"])),function(n){n.preventDefault(),t.msgInfosPageIndex=e+1},e+1)))},s=0;s<n;s++)i(s);return W(sh||(sh=Kh(['\n<nav aria-label="Page navigation example">\n  <ul class="pagination pagination-sm justify-content-start">\n  ',"\n    ","\n  ","\n  </ul>\n</nav>"])),t.msgInfosPageIndex>1?W(ah||(ah=Kh(['<li class="page-item"><a class="page-link" href="#" @click="','">Previous</a></li>'])),function(e){e.preventDefault(),t.msgInfosPageIndex--}):W(oh||(oh=Kh(['<li class="page-item disabled"><span class="page-link">Previous</span></li>']))),r,t.msgInfosPageIndex<n?W(lh||(lh=Kh(['<li class="page-item"><a class="page-link" href="#" @click="','">Next</a></li>'])),function(e){e.preventDefault(),t.msgInfosPageIndex++}):W(ch||(ch=Kh(['<li class="page-item disabled"><span class="page-link">Next</span></li>']))))}},{key:"processNotification",value:function(e){"tenant:data:ice_offer:content:<ice_offer>"===e.msg&&(this.dispatchEvent(new CustomEvent("local:stream:notify:process",{detail:{tab_id:0,metadata:e}})),this.requestUpdate())}},{key:"render",value:function(){return W(fh||(fh=Kh(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">',"</h4>\n  ","\n</main>"])),this.inori.env.content.get(),this.renderMessageInfos())}},{key:"renderMessageInfos",value:function(){var e=this,t=this.msgInfos=this.inori.mq.msg_infos(),n=this,r=(this.msgInfosPageIndex,this.msgInfosPageSize,["label","type","lastUpdate","code","usage","events",""]),i=["targetKey","targetType","msgKey","msgType"],s=n.inori.tenant.session_info(),a=r.map(function(e){return"events"==e?W(ph||(ph=Kh(['<th class="fw-lighter" scope="col">triggers</th>']))):""==e?W(mh||(mh=Kh(['\n        <th class="fw-lighter" scope="col">',"\n        </th>"])),s.role==n.inori.tenant.dataType().Role.values.ADMIN?W(gh||(gh=Kh(['\n          <a role="button" class="btn btn-link btn-sm py-0" @click="','">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">\n              <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"></path>\n              <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"></path>\n            </svg>\n          </a>'])),function(e){n.rowUpdateIndexes.push(0),n.requestUpdate()}):W(vh||(vh=Kh([""])))):W(_h||(_h=Kh(['<th class="fw-lighter" scope="col">',"</th>"])),e)}),o=t.map(function(t){return W(bh||(bh=Kh(["\n      <tr>","\n        </tr>\n      ",""])),r.map(function(r){if("usage"==r){var i=n.inori.mq.msg_ts(t.label);return W(yh||(yh=Kh(['<td class="align-middle"><a class="btn btn-link btn-sm" @click="">',"</a></td>"])),i.length)}return"lastUpdate"==r?W(wh||(wh=Kh(['\n        <td class="align-middle fw-light text-break">\n            ',"\n        </td>"])),t[r]?n.inori.util.formatUnix2Detail(t[r]):""):"events"==r?W(Sh||(Sh=Kh(['<td class="align-middle">',"</td>"])),t[r].length):""==r?s.role!=n.inori.tenant.dataType().Role.values.ADMIN?W(xh||(xh=Kh(['\n          <td class="align-middle"></td>']))):W(Eh||(Eh=Kh(['\n          <td class="align-middle text-nowrap">\n            ','           \n            <a class="btn btn-link btn-sm py-0 fw-normal" @click=',">","\n            </a>\n          </td>"])),e.rowUpdateIndexes.includes(t.code)?W(Ch||(Ch=Kh(['\n            <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">\n                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>\n              </svg>            \n            </a>'])),function(n){e.rowUpdateIndexes=e.rowUpdateIndexes.filter(function(e){return e!=t.code}),e.requestUpdate()}):W(Ah||(Ah=Kh([""]))),function(){var r=Zh($h().m(function r(i){var s,a,o,l,c,u,h,d,f,p,m,g,v,_,b;return $h().w(function(r){for(;;)switch(r.n){case 0:if(!e.rowUpdateIndexes.includes(t.code)){r.n=2;break}for(s=[],a=document.getElementById("text-label-".concat(t.code)),o=document.getElementById("text-type-".concat(t.code)),l=document.getElementById("text-code-".concat(t.code)),c=0;c<=t.events.length;c++)u=document.getElementById("text-events-".concat(c,"-targetType-").concat(t.code)),h=document.getElementById("text-events-".concat(c,"-targetKey-").concat(t.code)),d=document.getElementById("text-events-".concat(c,"-msgType-").concat(t.code)),f=document.getElementById("text-events-".concat(c,"-msgKey-").concat(t.code)),p=u.value,m=h.value,g=d.value,v=f.value,(p||m||g||v)&&s.push({targetType:p,targetKey:m,msgType:g,msgKey:v});return _={label:a&&a.value||t.label,type:o&&o.value,code:l&&Number(l.value),events:s},r.n=1,n.inori.mq.set_message_info(_);case 1:(b=r.v)&&(e.rowUpdateIndexes=e.rowUpdateIndexes.filter(function(e){return e!=b.code}),e.msgInfos=e.inori.mq.msg_infos()),r.n=3;break;case 2:e.rowUpdateIndexes.push(t.code);case 3:e.requestUpdate();case 4:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),e.rowUpdateIndexes.includes(t.code)?W(Mh||(Mh=Kh(['\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left  mt-1" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>\n              </svg>']))):W(kh||(kh=Kh(['\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">\n                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>\n              </svg>'])))):e.rowUpdateIndexes.includes(t.code)?W(Th||(Th=Kh(['\n          <td class="align-middle">\n          ',"\n          </td>"])),"label"==r?W(Rh||(Rh=Kh(['\n            <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-square" viewBox="0 0 16 16">\n                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>\n                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>\n              </svg>\n            </a>\n          ',"\n          "])),function(){var r=Zh($h().m(function r(i){var s;return $h().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,n.inori.mq.set_message_info({label:t.label,code:-1});case 1:(s=r.v)&&(e.rowUpdateIndexes=e.rowUpdateIndexes.filter(function(e){return e!=s.code}),e.msgInfos=e.inori.mq.msg_infos(),e.requestUpdate());case 2:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),t[r]):W(Ph||(Ph=Kh(['\n            <input type="text" id="text-',"-",'" class="form-control form-control-sm" placeholder="','" value="','">'])),r,t.code,r,t[r])):W(Ih||(Ih=Kh(['\n          <td class="align-middle fw-light text-break">\n              ',"\n          </td>"])),t[r])}),e.rowUpdateIndexes.includes(t.code)?W(Dh||(Dh=Kh(['\n        <tr>\n          <td colspan="','" class="border-0 p-0">\n            <div class="h6 m-3">Pre-Trigger List</div>\n            <div class="row m-1">\n              <div class="col col-sm-1 my-2">\n                #1\n              </div>\n              <div class="col col-sm-1 my-2">\n                01:00:07:30\n              </div>\n              <div class="w-100 border-bottom"></div>\n              <div class="col col-sm-1 my-2">          \n              </div>\n              <div class="col col-sm-1 my-2">\n                <input type="text" placeholder="00:00:00:00" class="form-control form-control-sm">\n              </div>\n              <div class="w-100"></div>\n            </div>\n          </td>\n        </tr>\n        <tr>\n          <td colspan="','" class="border-0 p-0">\n            <div class="h6 m-3">Post-Trigger List</div>\n            <table class="table mb-0" id="multiCollapseExample-','">\n              <tbody>','<tr>              \n                  <td class="text-sm-end"></td>\n                  ',"</tr></tbody>\n            </table>\n          </td>\n        </tr>"])),r.length,r.length,t.code,t.events.map(function(e,r){return W(Oh||(Oh=Kh(['\n                <tr>\n                  <td class="text-sm-end pt-3">#',"</td>\n                  ",'\n                  <td class="pt-3">\n                    <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">\n                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-square" viewBox="0 0 16 16">\n                        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>\n                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>\n                      </svg>\n                    </a>\n                  </td>\n                </tr>'])),r,i.map(function(n){return W(Lh||(Lh=Kh(['<td><input type="text" id="text-events-',"-","-",'" placeholder="','" class="form-control form-control-sm" value="','"></td>'])),r,n,t.code,n,e[n])}),function(e){t.events.splice(r,1),n.requestUpdate()})}),i.map(function(e){return W(Bh||(Bh=Kh(['<td><input type="text" id="text-events-',"-","-",'" placeholder="','" class="form-control form-control-sm"></td>'])),t.events.length,e,t.code,e)})):W(Nh||(Nh=Kh([""]))))});return o=o.filter(function(e){return e}),this.rowUpdateIndexes.includes(0)&&o.unshift(W(Uh||(Uh=Kh(['\n        <tr>\n          <table class="table">\n            <tbody>\n               <tr>\n              ',"\n              </tr>\n            </tbody>\n          </table>\n        </tr>"])),r.map(function(t){return"usage"==t||"events"==t||"lastUpdate"==t?W(Hh||(Hh=Kh(["<td></td>"]))):""==t?W(Fh||(Fh=Kh(['\n                <td class="align-middle">\n                  <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left  mt-1" viewBox="0 0 16 16">\n                      <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>\n                    </svg>\n                  </a>\n                </td>'])),function(){var t=Zh($h().m(function t(r){var i,s,a,o;return $h().w(function(t){for(;;)switch(t.n){case 0:return i=document.getElementById("text-label-0"),s=document.getElementById("text-type-0"),a=document.getElementById("text-code-0"),o={lastUpdate:Date.now(),label:i&&i.value,type:s&&s.value,code:a&&Number(a.value)},t.n=1,n.inori.mq.set_message_info(o);case 1:t.v&&(e.rowUpdateIndexes=e.rowUpdateIndexes.filter(function(e){return 0!=e}),e.msgInfos=e.inori.mq.msg_infos(),e.requestUpdate());case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()):W(jh||(jh=Kh(['\n                <td class="align-middle">\n                  <input type="text" id="text-','-0" class="form-control form-control-sm" placeholder="','">\n                </td>'])),t,t)}))),W(zh||(zh=Kh(["\n",'\n<table class="table table-striped table-hover">\n  <thead>\n    <tr>\n      ',"\n    </tr>\n  </thead>\n  <tbody>    \n    ","\n  </tbody>\n</table>"])),o.length>0?W(Vh||(Vh=Kh(['\n<div class="row">\n  <div class="col">',"\n  </div>\n</div>"])),n.renderMessageInfosPaging(o.length)):W(Gh||(Gh=Kh([""]))),a,o)}}],[{key:"properties",get:function(){return{inori:{type:Object},notifications:{type:Array},localLogPageIndex:{type:Number},inboundLogPageIndex:{type:Number},outboundLogPageIndex:{type:Number},notificationDetail:{type:Object}}}}]);var n}(ce);function id(e){return e}customElements.define("streaming-events",rd);var sd=1e-6;function ad(e){return"translate("+e+",0)"}function od(e){return"translate(0,"+e+")"}function ld(e){return t=>+e(t)}function cd(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function ud(){return!this.__axis}function hd(e,t){var n=[],r=null,i=null,s=6,a=6,o=3,l="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=1===e||4===e?-1:1,u=4===e||2===e?"x":"y",h=1===e||3===e?ad:od;function d(d){var f=null==r?t.ticks?t.ticks.apply(t,n):t.domain():r,p=null==i?t.tickFormat?t.tickFormat.apply(t,n):id:i,m=Math.max(s,0)+o,g=t.range(),v=+g[0]+l,_=+g[g.length-1]+l,b=(t.bandwidth?cd:ld)(t.copy(),l),y=d.selection?d.selection():d,w=y.selectAll(".domain").data([null]),S=y.selectAll(".tick").data(f,t).order(),x=S.exit(),E=S.enter().append("g").attr("class","tick"),C=S.select("line"),A=S.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),S=S.merge(E),C=C.merge(E.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),A=A.merge(E.append("text").attr("fill","currentColor").attr(u,c*m).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),d!==y&&(w=w.transition(d),S=S.transition(d),C=C.transition(d),A=A.transition(d),x=x.transition(d).attr("opacity",sd).attr("transform",function(e){return isFinite(e=b(e))?h(e+l):this.getAttribute("transform")}),E.attr("opacity",sd).attr("transform",function(e){var t=this.parentNode.__axis;return h((t&&isFinite(t=t(e))?t:b(e))+l)})),x.remove(),w.attr("d",4===e||2===e?a?"M"+c*a+","+v+"H"+l+"V"+_+"H"+c*a:"M"+l+","+v+"V"+_:a?"M"+v+","+c*a+"V"+l+"H"+_+"V"+c*a:"M"+v+","+l+"H"+_),S.attr("opacity",1).attr("transform",function(e){return h(b(e)+l)}),C.attr(u+"2",c*s),A.attr(u,c*m).text(p),y.filter(ud).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),y.each(function(){this.__axis=b})}return d.scale=function(e){return arguments.length?(t=e,d):t},d.ticks=function(){return n=Array.from(arguments),d},d.tickArguments=function(e){return arguments.length?(n=null==e?[]:Array.from(e),d):n.slice()},d.tickValues=function(e){return arguments.length?(r=null==e?null:Array.from(e),d):r&&r.slice()},d.tickFormat=function(e){return arguments.length?(i=e,d):i},d.tickSize=function(e){return arguments.length?(s=a=+e,d):s},d.tickSizeInner=function(e){return arguments.length?(s=+e,d):s},d.tickSizeOuter=function(e){return arguments.length?(a=+e,d):a},d.tickPadding=function(e){return arguments.length?(o=+e,d):o},d.offset=function(e){return arguments.length?(l=+e,d):l},d}function dd(e){return hd(3,e)}function fd(e){return hd(4,e)}function pd(){}function md(e){return null==e?pd:function(){return this.querySelector(e)}}function gd(){return[]}function vd(e){return null==e?gd:function(){return this.querySelectorAll(e)}}function _d(e){return function(){return this.matches(e)}}function bd(e){return function(t){return t.matches(e)}}var yd=Array.prototype.find;function wd(){return this.firstElementChild}var Sd=Array.prototype.filter;function xd(){return Array.from(this.children)}function Ed(e){return new Array(e.length)}function Cd(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Ad(e,t,n,r,i,s){for(var a,o=0,l=t.length,c=s.length;o<c;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new Cd(e,s[o]);for(;o<l;++o)(a=t[o])&&(i[o]=a)}function Md(e,t,n,r,i,s,a){var o,l,c,u=new Map,h=t.length,d=s.length,f=new Array(h);for(o=0;o<h;++o)(l=t[o])&&(f[o]=c=a.call(l,l.__data__,o,t)+"",u.has(c)?i[o]=l:u.set(c,l));for(o=0;o<d;++o)c=a.call(e,s[o],o,s)+"",(l=u.get(c))?(r[o]=l,l.__data__=s[o],u.delete(c)):n[o]=new Cd(e,s[o]);for(o=0;o<h;++o)(l=t[o])&&u.get(f[o])===l&&(i[o]=l)}function kd(e){return e.__data__}function Td(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Rd(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Cd.prototype={constructor:Cd,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var Pd="http://www.w3.org/1999/xhtml";const Id={svg:"http://www.w3.org/2000/svg",xhtml:Pd,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Dd(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Id.hasOwnProperty(t)?{space:Id[t],local:e}:e}function Od(e){return function(){this.removeAttribute(e)}}function Ld(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Bd(e,t){return function(){this.setAttribute(e,t)}}function Nd(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ud(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Hd(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Fd(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function jd(e){return function(){this.style.removeProperty(e)}}function zd(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Vd(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Gd(e,t){return e.style.getPropertyValue(t)||Fd(e).getComputedStyle(e,null).getPropertyValue(t)}function Wd(e){return function(){delete this[e]}}function qd(e,t){return function(){this[e]=t}}function Kd(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function $d(e){return e.trim().split(/^|\s+/)}function Xd(e){return e.classList||new Yd(e)}function Yd(e){this._node=e,this._names=$d(e.getAttribute("class")||"")}function Zd(e,t){for(var n=Xd(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Jd(e,t){for(var n=Xd(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Qd(e){return function(){Zd(this,e)}}function ef(e){return function(){Jd(this,e)}}function tf(e,t){return function(){(t.apply(this,arguments)?Zd:Jd)(this,e)}}function nf(){this.textContent=""}function rf(e){return function(){this.textContent=e}}function sf(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function af(){this.innerHTML=""}function of(e){return function(){this.innerHTML=e}}function lf(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function cf(){this.nextSibling&&this.parentNode.appendChild(this)}function uf(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function hf(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Pd&&t.documentElement.namespaceURI===Pd?t.createElement(e):t.createElementNS(n,e)}}function df(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ff(e){var t=Dd(e);return(t.local?df:hf)(t)}function pf(){return null}function mf(){var e=this.parentNode;e&&e.removeChild(this)}function gf(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function vf(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function _f(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,s=t.length;r<s;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function bf(e,t,n){return function(){var r,i=this.__on,s=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var a=0,o=i.length;a<o;++a)if((r=i[a]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=t);this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function yf(e,t,n){var r=Fd(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function wf(e,t){return function(){return yf(this,e,t)}}function Sf(e,t){return function(){return yf(this,e,t.apply(this,arguments))}}Yd.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var xf=[null];function Ef(e,t){this._groups=e,this._parents=t}function Cf(){return new Ef([[document.documentElement]],xf)}Ef.prototype=Cf.prototype={constructor:Ef,select:function(e){"function"!=typeof e&&(e=md(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s,a,o=t[i],l=o.length,c=r[i]=new Array(l),u=0;u<l;++u)(s=o[u])&&(a=e.call(s,s.__data__,u,o))&&("__data__"in s&&(a.__data__=s.__data__),c[u]=a);return new Ef(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}(e):vd(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var a,o=t[s],l=o.length,c=0;c<l;++c)(a=o[c])&&(r.push(e.call(a,a.__data__,c,o)),i.push(a));return new Ef(r,i)},selectChild:function(e){return this.select(null==e?wd:function(e){return function(){return yd.call(this.children,e)}}("function"==typeof e?e:bd(e)))},selectChildren:function(e){return this.selectAll(null==e?xd:function(e){return function(){return Sd.call(this.children,e)}}("function"==typeof e?e:bd(e)))},filter:function(e){"function"!=typeof e&&(e=_d(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s,a=t[i],o=a.length,l=r[i]=[],c=0;c<o;++c)(s=a[c])&&e.call(s,s.__data__,c,a)&&l.push(s);return new Ef(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,kd);var n=t?Md:Ad,r=this._parents,i=this._groups;"function"!=typeof e&&(e=function(e){return function(){return e}}(e));for(var s=i.length,a=new Array(s),o=new Array(s),l=new Array(s),c=0;c<s;++c){var u=r[c],h=i[c],d=h.length,f=Td(e.call(u,u&&u.__data__,c,r)),p=f.length,m=o[c]=new Array(p),g=a[c]=new Array(p);n(u,h,m,g,l[c]=new Array(d),f,t);for(var v,_,b=0,y=0;b<p;++b)if(v=m[b]){for(b>=y&&(y=b+1);!(_=g[y])&&++y<p;);v._next=_||null}}return(a=new Ef(a,r))._enter=o,a._exit=l,a},enter:function(){return new Ef(this._enter||this._groups.map(Ed),this._parents)},exit:function(){return new Ef(this._exit||this._groups.map(Ed),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,a=Math.min(i,s),o=new Array(i),l=0;l<a;++l)for(var c,u=n[l],h=r[l],d=u.length,f=o[l]=new Array(d),p=0;p<d;++p)(c=u[p]||h[p])&&(f[p]=c);for(;l<i;++l)o[l]=n[l];return new Ef(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],s=i.length-1,a=i[s];--s>=0;)(r=i[s])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=Rd);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var a,o=n[s],l=o.length,c=i[s]=new Array(l),u=0;u<l;++u)(a=o[u])&&(c[u]=a);c.sort(t)}return new Ef(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var a=r[i];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,s=t[n],a=0,o=s.length;a<o;++a)(i=s[a])&&e.call(i,i.__data__,a,s);return this},attr:function(e,t){var n=Dd(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?Ld:Od:"function"==typeof t?n.local?Hd:Ud:n.local?Nd:Bd)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?jd:"function"==typeof t?Vd:zd)(e,t,null==n?"":n)):Gd(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Wd:"function"==typeof t?Kd:qd)(e,t)):this.node()[e]},classed:function(e,t){var n=$d(e+"");if(arguments.length<2){for(var r=Xd(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?tf:t?Qd:ef)(n,t))},text:function(e){return arguments.length?this.each(null==e?nf:("function"==typeof e?sf:rf)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?af:("function"==typeof e?lf:of)(e)):this.node().innerHTML},raise:function(){return this.each(cf)},lower:function(){return this.each(uf)},append:function(e){var t="function"==typeof e?e:ff(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:ff(e),r=null==t?pf:"function"==typeof t?t:md(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(mf)},clone:function(e){return this.select(e?vf:gf)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,s=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),a=s.length;if(!(arguments.length<2)){for(o=t?bf:_f,r=0;r<a;++r)this.each(o(s[r],t,n));return this}var o=this.node().__on;if(o)for(var l,c=0,u=o.length;c<u;++c)for(r=0,l=o[c];r<a;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?Sf:wf)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],s=0,a=i.length;s<a;++s)(r=i[s])&&(yield r)}};const Af=Cf;var Mf={value:()=>{}};function kf(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Tf(r)}function Tf(e){this._=e}function Rf(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function Pf(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Mf,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}Tf.prototype=kf.prototype={constructor:Tf,on:function(e,t){var n,r,i=this._,s=(r=i,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),a=-1,o=s.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=s[a]).type)i[n]=Pf(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Pf(i[n],e.name,null);return this}for(;++a<o;)if((n=(e=s[a]).type)&&(n=Rf(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Tf(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(r=this._[e]).length;s<n;++s)r[s].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};const If=kf;var Df,Of,Lf=0,Bf=0,Nf=0,Uf=0,Hf=0,Ff=0,jf="object"==typeof performance&&performance.now?performance:Date,zf="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Vf(){return Hf||(zf(Gf),Hf=jf.now()+Ff)}function Gf(){Hf=0}function Wf(){this._call=this._time=this._next=null}function qf(e,t,n){var r=new Wf;return r.restart(e,t,n),r}function Kf(){Hf=(Uf=jf.now())+Ff,Lf=Bf=0;try{!function(){Vf(),++Lf;for(var e,t=Df;t;)(e=Hf-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Lf}()}finally{Lf=0,function(){for(var e,t,n=Df,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Df=t);Of=e,Xf(r)}(),Hf=0}}function $f(){var e=jf.now(),t=e-Uf;t>1e3&&(Ff-=t,Uf=e)}function Xf(e){Lf||(Bf&&(Bf=clearTimeout(Bf)),e-Hf>24?(e<1/0&&(Bf=setTimeout(Kf,e-jf.now()-Ff)),Nf&&(Nf=clearInterval(Nf))):(Nf||(Uf=jf.now(),Nf=setInterval($f,1e3)),Lf=1,zf(Kf)))}function Yf(e,t,n){var r=new Wf;return t=null==t?0:+t,r.restart(n=>{r.stop(),e(n+t)},t,n),r}Wf.prototype=qf.prototype={constructor:Wf,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Vf():+n)+(null==t?0:+t),this._next||Of===this||(Of?Of._next=this:Df=this,Of=this),this._call=e,this._time=n,Xf()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xf())}};var Zf=If("start","end","cancel","interrupt"),Jf=[];function Qf(e,t,n,r,i,s){var a=e.__transition;if(a){if(n in a)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function s(l){var c,u,h,d;if(1!==n.state)return o();for(c in i)if((d=i[c]).name===n.name){if(3===d.state)return Yf(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete i[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete i[c])}if(Yf(function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function a(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(o),n.state=5,1),s=-1,a=r.length;++s<a;)r[s].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),o())}function o(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=qf(function(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)},0,n.time)}(e,n,{name:t,index:r,group:i,on:Zf,tween:Jf,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function ep(e,t){var n=np(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function tp(e,t){var n=np(e,t);if(n.state>3)throw new Error("too late; already running");return n}function np(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function rp(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var ip,sp=180/Math.PI,ap={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function op(e,t,n,r,i,s){var a,o,l;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,l/=o),e*r<t*n&&(e=-e,t=-t,l=-l,a=-a),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*sp,skewX:Math.atan(l)*sp,scaleX:a,scaleY:o}}function lp(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(s,a){var o=[],l=[];return s=e(s),a=e(a),function(e,r,i,s,a,o){if(e!==i||r!==s){var l=a.push("translate(",null,t,null,n);o.push({i:l-4,x:rp(e,i)},{i:l-2,x:rp(r,s)})}else(i||s)&&a.push("translate("+i+t+s+n)}(s.translateX,s.translateY,a.translateX,a.translateY,o,l),function(e,t,n,s){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:rp(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(s.rotate,a.rotate,o,l),function(e,t,n,s){e!==t?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:rp(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(s.skewX,a.skewX,o,l),function(e,t,n,r,s,a){if(e!==n||t!==r){var o=s.push(i(s)+"scale(",null,",",null,")");a.push({i:o-4,x:rp(e,n)},{i:o-2,x:rp(t,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,a.scaleX,a.scaleY,o,l),s=a=null,function(e){for(var t,n=-1,r=l.length;++n<r;)o[(t=l[n]).i]=t.x(e);return o.join("")}}}var cp=lp(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ap:op(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),up=lp(function(e){return null==e?ap:(ip||(ip=document.createElementNS("http://www.w3.org/2000/svg","g")),ip.setAttribute("transform",e),(e=ip.transform.baseVal.consolidate())?op((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):ap)},", ",")",")");function hp(e,t){var n,r;return function(){var i=tp(this,e),s=i.tween;if(s!==n)for(var a=0,o=(r=n=s).length;a<o;++a)if(r[a].name===t){(r=r.slice()).splice(a,1);break}i.tween=r}}function dp(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var s=tp(this,e),a=s.tween;if(a!==r){i=(r=a).slice();for(var o={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=o;break}l===c&&i.push(o)}s.tween=i}}function fp(e,t,n){var r=e._id;return e.each(function(){var e=tp(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return np(e,r).value[t]}}function pp(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function mp(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function gp(){}var vp=.7,_p=1/vp,bp="\\s*([+-]?\\d+)\\s*",yp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",wp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sp=/^#([0-9a-f]{3,8})$/,xp=new RegExp(`^rgb\\(${bp},${bp},${bp}\\)$`),Ep=new RegExp(`^rgb\\(${wp},${wp},${wp}\\)$`),Cp=new RegExp(`^rgba\\(${bp},${bp},${bp},${yp}\\)$`),Ap=new RegExp(`^rgba\\(${wp},${wp},${wp},${yp}\\)$`),Mp=new RegExp(`^hsl\\(${yp},${wp},${wp}\\)$`),kp=new RegExp(`^hsla\\(${yp},${wp},${wp},${yp}\\)$`),Tp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Rp(){return this.rgb().formatHex()}function Pp(){return this.rgb().formatRgb()}function Ip(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Sp.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Dp(t):3===n?new Bp(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Op(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Op(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=xp.exec(e))?new Bp(t[1],t[2],t[3],1):(t=Ep.exec(e))?new Bp(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Cp.exec(e))?Op(t[1],t[2],t[3],t[4]):(t=Ap.exec(e))?Op(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Mp.exec(e))?zp(t[1],t[2]/100,t[3]/100,1):(t=kp.exec(e))?zp(t[1],t[2]/100,t[3]/100,t[4]):Tp.hasOwnProperty(e)?Dp(Tp[e]):"transparent"===e?new Bp(NaN,NaN,NaN,0):null}function Dp(e){return new Bp(e>>16&255,e>>8&255,255&e,1)}function Op(e,t,n,r){return r<=0&&(e=t=n=NaN),new Bp(e,t,n,r)}function Lp(e,t,n,r){return 1===arguments.length?function(e){return e instanceof gp||(e=Ip(e)),e?new Bp((e=e.rgb()).r,e.g,e.b,e.opacity):new Bp}(e):new Bp(e,t,n,null==r?1:r)}function Bp(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Np(){return`#${jp(this.r)}${jp(this.g)}${jp(this.b)}`}function Up(){const e=Hp(this.opacity);return`${1===e?"rgb(":"rgba("}${Fp(this.r)}, ${Fp(this.g)}, ${Fp(this.b)}${1===e?")":`, ${e})`}`}function Hp(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Fp(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function jp(e){return((e=Fp(e))<16?"0":"")+e.toString(16)}function zp(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Gp(e,t,n,r)}function Vp(e){if(e instanceof Gp)return new Gp(e.h,e.s,e.l,e.opacity);if(e instanceof gp||(e=Ip(e)),!e)return new Gp;if(e instanceof Gp)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),a=NaN,o=s-i,l=(s+i)/2;return o?(a=t===s?(n-r)/o+6*(n<r):n===s?(r-t)/o+2:(t-n)/o+4,o/=l<.5?s+i:2-s-i,a*=60):o=l>0&&l<1?0:a,new Gp(a,o,l,e.opacity)}function Gp(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Wp(e){return(e=(e||0)%360)<0?e+360:e}function qp(e){return Math.max(0,Math.min(1,e||0))}function Kp(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function $p(e,t,n,r,i){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*n+(1+3*e+3*s-3*a)*r+a*i)/6}pp(gp,Ip,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Rp,formatHex:Rp,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Vp(this).formatHsl()},formatRgb:Pp,toString:Pp}),pp(Bp,Lp,mp(gp,{brighter(e){return e=null==e?_p:Math.pow(_p,e),new Bp(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?vp:Math.pow(vp,e),new Bp(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Bp(Fp(this.r),Fp(this.g),Fp(this.b),Hp(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Np,formatHex:Np,formatHex8:function(){return`#${jp(this.r)}${jp(this.g)}${jp(this.b)}${jp(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Up,toString:Up})),pp(Gp,function(e,t,n,r){return 1===arguments.length?Vp(e):new Gp(e,t,n,null==r?1:r)},mp(gp,{brighter(e){return e=null==e?_p:Math.pow(_p,e),new Gp(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?vp:Math.pow(vp,e),new Gp(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Bp(Kp(e>=240?e-240:e+120,i,r),Kp(e,i,r),Kp(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Gp(Wp(this.h),qp(this.s),qp(this.l),Hp(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Hp(this.opacity);return`${1===e?"hsl(":"hsla("}${Wp(this.h)}, ${100*qp(this.s)}%, ${100*qp(this.l)}%${1===e?")":`, ${e})`}`}}));const Xp=e=>()=>e;function Yp(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Xp(isNaN(e)?t:e)}const Zp=function e(t){var n=function(e){return 1===(e=+e)?Yp:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Xp(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=Lp(e)).r,(t=Lp(t)).r),i=n(e.g,t.g),s=n(e.b,t.b),a=Yp(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=s(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function Jp(e){return function(t){var n,r,i=t.length,s=new Array(i),a=new Array(i),o=new Array(i);for(n=0;n<i;++n)r=Lp(t[n]),s[n]=r.r||0,a[n]=r.g||0,o[n]=r.b||0;return s=e(s),a=e(a),o=e(o),r.opacity=1,function(e){return r.r=s(e),r.g=a(e),r.b=o(e),r+""}}}Jp(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],a=r>0?e[r-1]:2*i-s,o=r<t-1?e[r+2]:2*s-i;return $p((n-r/t)*t,a,i,s,o)}}),Jp(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],a=e[(r+1)%t],o=e[(r+2)%t];return $p((n-r/t)*t,i,s,a,o)}});var Qp=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,em=new RegExp(Qp.source,"g");function tm(e,t){var n,r,i,s=Qp.lastIndex=em.lastIndex=0,a=-1,o=[],l=[];for(e+="",t+="";(n=Qp.exec(e))&&(r=em.exec(t));)(i=r.index)>s&&(i=t.slice(s,i),o[a]?o[a]+=i:o[++a]=i),(n=n[0])===(r=r[0])?o[a]?o[a]+=r:o[++a]=r:(o[++a]=null,l.push({i:a,x:rp(n,r)})),s=em.lastIndex;return s<t.length&&(i=t.slice(s),o[a]?o[a]+=i:o[++a]=i),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)o[(n=l[r]).i]=n.x(e);return o.join("")})}function nm(e,t){var n;return("number"==typeof t?rp:t instanceof Ip?Zp:(n=Ip(t))?(t=n,Zp):tm)(e,t)}function rm(e){return function(){this.removeAttribute(e)}}function im(e){return function(){this.removeAttributeNS(e.space,e.local)}}function sm(e,t,n){var r,i,s=n+"";return function(){var a=this.getAttribute(e);return a===s?null:a===r?i:i=t(r=a,n)}}function am(e,t,n){var r,i,s=n+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===s?null:a===r?i:i=t(r=a,n)}}function om(e,t,n){var r,i,s;return function(){var a,o,l=n(this);if(null!=l)return(a=this.getAttribute(e))===(o=l+"")?null:a===r&&o===i?s:(i=o,s=t(r=a,l));this.removeAttribute(e)}}function lm(e,t,n){var r,i,s;return function(){var a,o,l=n(this);if(null!=l)return(a=this.getAttributeNS(e.space,e.local))===(o=l+"")?null:a===r&&o===i?s:(i=o,s=t(r=a,l));this.removeAttributeNS(e.space,e.local)}}function cm(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,i)),n}return i._value=t,i}function um(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,i)),n}return i._value=t,i}function hm(e,t){return function(){ep(this,e).delay=+t.apply(this,arguments)}}function dm(e,t){return t=+t,function(){ep(this,e).delay=t}}function fm(e,t){return function(){tp(this,e).duration=+t.apply(this,arguments)}}function pm(e,t){return t=+t,function(){tp(this,e).duration=t}}var mm=Af.prototype.constructor;function gm(e){return function(){this.style.removeProperty(e)}}var vm=0;function _m(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function bm(){return++vm}var ym=Af.prototype;_m.prototype=function(e){return Af().transition(e)}.prototype={constructor:_m,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=md(e));for(var r=this._groups,i=r.length,s=new Array(i),a=0;a<i;++a)for(var o,l,c=r[a],u=c.length,h=s[a]=new Array(u),d=0;d<u;++d)(o=c[d])&&(l=e.call(o,o.__data__,d,c))&&("__data__"in o&&(l.__data__=o.__data__),h[d]=l,Qf(h[d],t,n,d,h,np(o,n)));return new _m(s,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=vd(e));for(var r=this._groups,i=r.length,s=[],a=[],o=0;o<i;++o)for(var l,c=r[o],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,f=e.call(l,l.__data__,h,c),p=np(l,n),m=0,g=f.length;m<g;++m)(d=f[m])&&Qf(d,t,n,m,f,p);s.push(f),a.push(l)}return new _m(s,a,t,n)},selectChild:ym.selectChild,selectChildren:ym.selectChildren,filter:function(e){"function"!=typeof e&&(e=_d(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s,a=t[i],o=a.length,l=r[i]=[],c=0;c<o;++c)(s=a[c])&&e.call(s,s.__data__,c,a)&&l.push(s);return new _m(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),a=new Array(r),o=0;o<s;++o)for(var l,c=t[o],u=n[o],h=c.length,d=a[o]=new Array(h),f=0;f<h;++f)(l=c[f]||u[f])&&(d[f]=l);for(;o<r;++o)a[o]=t[o];return new _m(a,this._parents,this._name,this._id)},selection:function(){return new mm(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=bm(),r=this._groups,i=r.length,s=0;s<i;++s)for(var a,o=r[s],l=o.length,c=0;c<l;++c)if(a=o[c]){var u=np(a,t);Qf(a,e,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new _m(r,this._parents,e,n)},call:ym.call,nodes:ym.nodes,node:ym.node,size:ym.size,empty:ym.empty,each:ym.each,on:function(e,t){var n=this._id;return arguments.length<2?np(this.node(),n).on.on(e):this.each(function(e,t,n){var r,i,s=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?ep:tp;return function(){var a=s(this,e),o=a.on;o!==r&&(i=(r=o).copy()).on(t,n),a.on=i}}(n,e,t))},attr:function(e,t){var n=Dd(e),r="transform"===n?up:nm;return this.attrTween(e,"function"==typeof t?(n.local?lm:om)(n,r,fp(this,"attr."+e,t)):null==t?(n.local?im:rm)(n):(n.local?am:sm)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Dd(e);return this.tween(n,(r.local?cm:um)(r,t))},style:function(e,t,n){var r="transform"==(e+="")?cp:nm;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var s=Gd(this,e),a=(this.style.removeProperty(e),Gd(this,e));return s===a?null:s===n&&a===r?i:i=t(n=s,r=a)}}(e,r)).on("end.style."+e,gm(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,i,s;return function(){var a=Gd(this,e),o=n(this),l=o+"";return null==o&&(this.style.removeProperty(e),l=o=Gd(this,e)),a===l?null:a===r&&l===i?s:(i=l,s=t(r=a,o))}}(e,r,fp(this,"style."+e,t))).each(function(e,t){var n,r,i,s,a="style."+t,o="end."+a;return function(){var l=tp(this,e),c=l.on,u=null==l.value[a]?s||(s=gm(t)):void 0;c===n&&i===u||(r=(n=c).copy()).on(o,i=u),l.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,s=n+"";return function(){var a=Gd(this,e);return a===s?null:a===r?i:i=t(r=a,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function(e,t,n){var r,i;function s(){var s=t.apply(this,arguments);return s!==i&&(r=(i=s)&&function(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}(e,s,n)),r}return s._value=t,s}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(fp(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return r._value=e,r}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=np(this.node(),n).tween,s=0,a=i.length;s<a;++s)if((r=i[s]).name===e)return r.value;return null}return this.each((null==t?hp:dp)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?hm:dm)(t,e)):np(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?fm:pm)(t,e)):np(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){tp(this,e).ease=t}}(t,e)):np(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;tp(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,a){var o={value:a},l={value:function(){0===--i&&s()}};n.each(function(){var n=tp(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(o),t._.interrupt.push(o),t._.end.push(l)),n.on=t}),0===i&&s()})},[Symbol.iterator]:ym[Symbol.iterator]};var wm={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Sm(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}Af.prototype.interrupt=function(e){return this.each(function(){!function(e,t){var n,r,i,s=e.__transition,a=!0;if(s){for(i in t=null==t?null:t+"",s)(n=s[i]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete s[i]):a=!1;a&&delete e.__transition}}(this,e)})},Af.prototype.transition=function(e){var t,n;e instanceof _m?(t=e._id,e=e._name):(t=bm(),(n=wm).time=Vf(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var a,o=r[s],l=o.length,c=0;c<l;++c)(a=o[c])&&Qf(a,e,t,c,o,n||Sm(a,t));return new _m(r,this._parents,e,t)};const{abs:xm,max:Em,min:Cm}=Math;function Am(e){return{type:e}}["w","e"].map(Am),["n","s"].map(Am),["n","w","e","s","nw","ne","sw","se"].map(Am);const Mm=Math.sqrt(50),km=Math.sqrt(10),Tm=Math.sqrt(2);function Rm(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),a=s>=Mm?10:s>=km?5:s>=Tm?2:1;let o,l,c;return i<0?(c=Math.pow(10,-i)/a,o=Math.round(e*c),l=Math.round(t*c),o/c<e&&++o,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*a,o=Math.round(e/c),l=Math.round(t/c),o*c<e&&++o,l*c>t&&--l),l<o&&.5<=n&&n<2?Rm(e,t,2*n):[o,l,c]}function Pm(e,t,n){return Rm(e=+e,t=+t,n=+n)[2]}function Im(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?Pm(t,e,n):Pm(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function Dm(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Om(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Lm(e){let t,n,r;function i(e,r,i=0,s=e.length){if(i<s){if(0!==t(r,r))return s;do{const t=i+s>>>1;n(e[t],r)<0?i=t+1:s=t}while(i<s)}return i}return 2!==e.length?(t=Dm,n=(t,n)=>Dm(e(t),n),r=(t,n)=>e(t)-n):(t=e===Dm||e===Om?e:Bm,n=e,r=e),{left:i,center:function(e,t,n=0,s=e.length){const a=i(e,t,n,s-1);return a>n&&r(e[a-1],t)>-r(e[a],t)?a-1:a},right:function(e,r,i=0,s=e.length){if(i<s){if(0!==t(r,r))return s;do{const t=i+s>>>1;n(e[t],r)<=0?i=t+1:s=t}while(i<s)}return i}}}function Bm(){return 0}const Nm=Lm(Dm),Um=Nm.right,Hm=(Nm.left,Lm(function(e){return null===e?NaN:+e}).center,Um);function Fm(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,s=new Array(i),a=new Array(r);for(n=0;n<i;++n)s[n]=Gm(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=s[n](e);return a}}function jm(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function zm(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Gm(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}function Vm(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(s){for(n=0;n<r;++n)i[n]=e[n]*(1-s)+t[n]*s;return i}}function Gm(e,t){var n,r=typeof t;return null==t||"boolean"===r?Xp(t):("number"===r?rp:"string"===r?(n=Ip(t))?(t=n,Zp):tm:t instanceof Ip?Zp:t instanceof Date?jm:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?Vm:Array.isArray(t)?Fm:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?zm:rp)(e,t)}function Wm(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function qm(e){return+e}var Km=[0,1];function $m(e){return e}function Xm(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Ym(e,t,n){var r=e[0],i=e[1],s=t[0],a=t[1];return i<r?(r=Xm(i,r),s=n(a,s)):(r=Xm(r,i),s=n(s,a)),function(e){return s(r(e))}}function Zm(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=Xm(e[a],e[a+1]),s[a]=n(t[a],t[a+1]);return function(t){var n=Hm(e,t,1,r)-1;return s[n](i[n](t))}}function Jm(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Qm(){return function(){var e,t,n,r,i,s,a=Km,o=Km,l=Gm,c=$m;function u(){var e=Math.min(a.length,o.length);return c!==$m&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(a[0],a[e-1])),r=e>2?Zm:Ym,i=s=null,h}function h(t){return null==t||isNaN(t=+t)?n:(i||(i=r(a.map(e),o,l)))(e(c(t)))}return h.invert=function(n){return c(t((s||(s=r(o,a.map(e),rp)))(n)))},h.domain=function(e){return arguments.length?(a=Array.from(e,qm),u()):a.slice()},h.range=function(e){return arguments.length?(o=Array.from(e),u()):o.slice()},h.rangeRound=function(e){return o=Array.from(e),l=Wm,u()},h.clamp=function(e){return arguments.length?(c=!!e||$m,u()):c!==$m},h.interpolate=function(e){return arguments.length?(l=e,u()):l},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,u()}}()($m,$m)}function eg(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}var tg,ng=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function rg(e){if(!(t=ng.exec(e)))throw new Error("invalid format: "+e);var t;return new ig({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ig(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function sg(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function ag(e){return(e=sg(Math.abs(e)))?e[1]:NaN}function og(e,t){var n=sg(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}rg.prototype=ig.prototype,ig.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const lg={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>og(100*e,t),r:og,s:function(e,t){var n=sg(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(tg=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return s===a?r:s>a?r+new Array(s-a+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+sg(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function cg(e){return e}var ug,hg,dg,fg=Array.prototype.map,pg=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function mg(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){if(!((n=+n)>0))return[];if((e=+e)===(t=+t))return[e];const r=t<e,[i,s,a]=r?Rm(t,e,n):Rm(e,t,n);if(!(s>=i))return[];const o=s-i+1,l=new Array(o);if(r)if(a<0)for(let e=0;e<o;++e)l[e]=(s-e)/-a;else for(let e=0;e<o;++e)l[e]=(s-e)*a;else if(a<0)for(let e=0;e<o;++e)l[e]=(i+e)/-a;else for(let e=0;e<o;++e)l[e]=(i+e)*a;return l}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return function(e,t,n,r){var i,s=Im(e,t,n);switch((r=rg(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(ag(t)/3)))-ag(Math.abs(e)))}(s,a))||(r.precision=i),dg(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,ag(t)-ag(e))+1}(s,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-ag(Math.abs(e)))}(s))||(r.precision=i-2*("%"===r.type))}return hg(r)}(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,s=t(),a=0,o=s.length-1,l=s[a],c=s[o],u=10;for(c<l&&(i=l,l=c,c=i,i=a,a=o,o=i);u-- >0;){if((i=Pm(l,c,n))===r)return s[a]=l,s[o]=c,t(s);if(i>0)l=Math.floor(l/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,c=Math.floor(c*i)/i}r=i}return e},e}function gg(){var e=Qm();return e.copy=function(){return Jm(e,gg())},eg.apply(e,arguments),mg(e)}ug=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?cg:(t=fg.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,s=[],a=0,o=t[0],l=0;i>0&&o>0&&(l+o+1>r&&(o=Math.max(1,r-l)),s.push(e.substring(i-=o,i+o)),!((l+=o+1)>r));)o=t[a=(a+1)%t.length];return s.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",s=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?cg:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(fg.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=rg(e)).fill,n=e.align,h=e.sign,d=e.symbol,f=e.zero,p=e.width,m=e.comma,g=e.precision,v=e.trim,_=e.type;"n"===_?(m=!0,_="g"):lg[_]||(void 0===g&&(g=12),v=!0,_="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var b="$"===d?i:"#"===d&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",y="$"===d?s:/[%p]/.test(_)?l:"",w=lg[_],S=/[defgprs%]/.test(_);function x(e){var i,s,l,d=b,x=y;if("c"===_)x=w(e)+x,e="";else{var E=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:w(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),E&&0===+e&&"+"!==h&&(E=!1),d=(E?"("===h?h:c:"-"===h||"("===h?"":h)+d,x=("s"===_?pg[8+tg/3]:"")+x+(E&&"("===h?")":""),S)for(i=-1,s=e.length;++i<s;)if(48>(l=e.charCodeAt(i))||l>57){x=(46===l?a+e.slice(i+1):e.slice(i))+x,e=e.slice(0,i);break}}m&&!f&&(e=r(e,1/0));var C=d.length+e.length+x.length,A=C<p?new Array(p-C+1).join(t):"";switch(m&&f&&(e=r(A+e,A.length?p-x.length:1/0),A=""),n){case"<":e=d+e+x+A;break;case"=":e=d+A+e+x;break;case"^":e=A.slice(0,C=A.length>>1)+d+e+x+A.slice(C);break;default:e=A+d+e+x}return o(e)}return g=void 0===g?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),x.toString=function(){return e+""},x}return{format:h,formatPrefix:function(e,t){var n=h(((e=rg(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(ag(t)/3))),i=Math.pow(10,-r),s=pg[8+r/3];return function(e){return n(i*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]}),hg=ug.format,dg=ug.formatPrefix;const vg=1e3,_g=6e4,bg=36e5,yg=864e5,wg=6048e5,Sg=31536e6,xg=new Date,Eg=new Date;function Cg(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=t=>(e(t=new Date(+t)),t),i.ceil=n=>(e(n=new Date(n-1)),t(n,1),e(n),n),i.round=e=>{const t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=(e,n)=>(t(e=new Date(+e),null==n?1:Math.floor(n)),e),i.range=(n,r,s)=>{const a=[];if(n=i.ceil(n),s=null==s?1:Math.floor(s),!(n<r&&s>0))return a;let o;do{a.push(o=new Date(+n)),t(n,s),e(n)}while(o<n&&n<r);return a},i.filter=n=>Cg(t=>{if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},(e,r)=>{if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}),n&&(i.count=(t,r)=>(xg.setTime(+t),Eg.setTime(+r),e(xg),e(Eg),Math.floor(n(xg,Eg))),i.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?t=>r(t)%e===0:t=>i.count(0,t)%e===0):i:null)),i}const Ag=Cg(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Ag.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?Cg(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Ag:null),Ag.range;const Mg=Cg(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*vg)},(e,t)=>(t-e)/vg,e=>e.getUTCSeconds()),kg=(Mg.range,Cg(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*vg)},(e,t)=>{e.setTime(+e+t*_g)},(e,t)=>(t-e)/_g,e=>e.getMinutes())),Tg=(kg.range,Cg(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*_g)},(e,t)=>(t-e)/_g,e=>e.getUTCMinutes())),Rg=(Tg.range,Cg(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*vg-e.getMinutes()*_g)},(e,t)=>{e.setTime(+e+t*bg)},(e,t)=>(t-e)/bg,e=>e.getHours())),Pg=(Rg.range,Cg(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*bg)},(e,t)=>(t-e)/bg,e=>e.getUTCHours())),Ig=(Pg.range,Cg(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_g)/yg,e=>e.getDate()-1)),Dg=(Ig.range,Cg(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/yg,e=>e.getUTCDate()-1)),Og=(Dg.range,Cg(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/yg,e=>Math.floor(e/yg)));function Lg(e){return Cg(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_g)/wg)}Og.range;const Bg=Lg(0),Ng=Lg(1),Ug=Lg(2),Hg=Lg(3),Fg=Lg(4),jg=Lg(5),zg=Lg(6);function Vg(e){return Cg(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/wg)}Bg.range,Ng.range,Ug.range,Hg.range,Fg.range,jg.range,zg.range;const Gg=Vg(0),Wg=Vg(1),qg=Vg(2),Kg=Vg(3),$g=Vg(4),Xg=Vg(5),Yg=Vg(6),Zg=(Gg.range,Wg.range,qg.range,Kg.range,$g.range,Xg.range,Yg.range,Cg(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth())),Jg=(Zg.range,Cg(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth())),Qg=(Jg.range,Cg(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear()));Qg.every=e=>isFinite(e=Math.floor(e))&&e>0?Cg(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}):null,Qg.range;const ev=Cg(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());function tv(e,t,n,r,i,s){const a=[[Mg,1,vg],[Mg,5,5e3],[Mg,15,15e3],[Mg,30,3e4],[s,1,_g],[s,5,3e5],[s,15,9e5],[s,30,18e5],[i,1,bg],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,yg],[r,2,1728e5],[n,1,wg],[t,1,2592e6],[t,3,7776e6],[e,1,Sg]];function o(t,n,r){const i=Math.abs(n-t)/r,s=Lm(([,,e])=>e).right(a,i);if(s===a.length)return e.every(Im(t/Sg,n/Sg,r));if(0===s)return Ag.every(Math.max(Im(t,n,r),1));const[o,l]=a[i/a[s-1][2]<a[s][2]/i?s-1:s];return o.every(l)}return[function(e,t,n){const r=t<e;r&&([e,t]=[t,e]);const i=n&&"function"==typeof n.range?n:o(e,t,n),s=i?i.range(e,+t+1):[];return r?s.reverse():s},o]}ev.every=e=>isFinite(e=Math.floor(e))&&e>0?Cg(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null,ev.range;const[nv,rv]=tv(ev,Jg,Gg,Og,Pg,Tg),[iv,sv]=tv(Qg,Zg,Bg,Ig,Rg,kg);function av(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ov(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function lv(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var cv,uv,hv={"-":"",_:" ",0:"0"},dv=/^\s*\d+/,fv=/^%/,pv=/[\\^$*+?|[\]().{}]/g;function mv(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function gv(e){return e.replace(pv,"\\$&")}function vv(e){return new RegExp("^(?:"+e.map(gv).join("|")+")","i")}function _v(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function bv(e,t,n){var r=dv.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function yv(e,t,n){var r=dv.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function wv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Sv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function xv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Ev(e,t,n){var r=dv.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Cv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Av(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Mv(e,t,n){var r=dv.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function kv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Tv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Rv(e,t,n){var r=dv.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Pv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Iv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Dv(e,t,n){var r=dv.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Ov(e,t,n){var r=dv.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Lv(e,t,n){var r=dv.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Bv(e,t,n){var r=fv.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Nv(e,t,n){var r=dv.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Uv(e,t,n){var r=dv.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Hv(e,t){return mv(e.getDate(),t,2)}function Fv(e,t){return mv(e.getHours(),t,2)}function jv(e,t){return mv(e.getHours()%12||12,t,2)}function zv(e,t){return mv(1+Ig.count(Qg(e),e),t,3)}function Vv(e,t){return mv(e.getMilliseconds(),t,3)}function Gv(e,t){return Vv(e,t)+"000"}function Wv(e,t){return mv(e.getMonth()+1,t,2)}function qv(e,t){return mv(e.getMinutes(),t,2)}function Kv(e,t){return mv(e.getSeconds(),t,2)}function $v(e){var t=e.getDay();return 0===t?7:t}function Xv(e,t){return mv(Bg.count(Qg(e)-1,e),t,2)}function Yv(e){var t=e.getDay();return t>=4||0===t?Fg(e):Fg.ceil(e)}function Zv(e,t){return e=Yv(e),mv(Fg.count(Qg(e),e)+(4===Qg(e).getDay()),t,2)}function Jv(e){return e.getDay()}function Qv(e,t){return mv(Ng.count(Qg(e)-1,e),t,2)}function e_(e,t){return mv(e.getFullYear()%100,t,2)}function t_(e,t){return mv((e=Yv(e)).getFullYear()%100,t,2)}function n_(e,t){return mv(e.getFullYear()%1e4,t,4)}function r_(e,t){var n=e.getDay();return mv((e=n>=4||0===n?Fg(e):Fg.ceil(e)).getFullYear()%1e4,t,4)}function i_(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+mv(t/60|0,"0",2)+mv(t%60,"0",2)}function s_(e,t){return mv(e.getUTCDate(),t,2)}function a_(e,t){return mv(e.getUTCHours(),t,2)}function o_(e,t){return mv(e.getUTCHours()%12||12,t,2)}function l_(e,t){return mv(1+Dg.count(ev(e),e),t,3)}function c_(e,t){return mv(e.getUTCMilliseconds(),t,3)}function u_(e,t){return c_(e,t)+"000"}function h_(e,t){return mv(e.getUTCMonth()+1,t,2)}function d_(e,t){return mv(e.getUTCMinutes(),t,2)}function f_(e,t){return mv(e.getUTCSeconds(),t,2)}function p_(e){var t=e.getUTCDay();return 0===t?7:t}function m_(e,t){return mv(Gg.count(ev(e)-1,e),t,2)}function g_(e){var t=e.getUTCDay();return t>=4||0===t?$g(e):$g.ceil(e)}function v_(e,t){return e=g_(e),mv($g.count(ev(e),e)+(4===ev(e).getUTCDay()),t,2)}function __(e){return e.getUTCDay()}function b_(e,t){return mv(Wg.count(ev(e)-1,e),t,2)}function y_(e,t){return mv(e.getUTCFullYear()%100,t,2)}function w_(e,t){return mv((e=g_(e)).getUTCFullYear()%100,t,2)}function S_(e,t){return mv(e.getUTCFullYear()%1e4,t,4)}function x_(e,t){var n=e.getUTCDay();return mv((e=n>=4||0===n?$g(e):$g.ceil(e)).getUTCFullYear()%1e4,t,4)}function E_(){return"+0000"}function C_(){return"%"}function A_(e){return+e}function M_(e){return Math.floor(+e/1e3)}function k_(e){return new Date(e)}function T_(e){return e instanceof Date?+e:+new Date(+e)}function R_(e,t,n,r,i,s,a,o,l,c){var u=Qm(),h=u.invert,d=u.domain,f=c(".%L"),p=c(":%S"),m=c("%I:%M"),g=c("%I %p"),v=c("%a %d"),_=c("%b %d"),b=c("%B"),y=c("%Y");function w(e){return(l(e)<e?f:o(e)<e?p:a(e)<e?m:s(e)<e?g:r(e)<e?i(e)<e?v:_:n(e)<e?b:y)(e)}return u.invert=function(e){return new Date(h(e))},u.domain=function(e){return arguments.length?d(Array.from(e,T_)):d().map(k_)},u.ticks=function(t){var n=d();return e(n[0],n[n.length-1],null==t?10:t)},u.tickFormat=function(e,t){return null==t?w:c(t)},u.nice=function(e){var n=d();return e&&"function"==typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?d(function(e,t){var n,r=0,i=(e=e.slice()).length-1,s=e[r],a=e[i];return a<s&&(n=r,r=i,i=n,n=s,s=a,a=n),e[r]=t.floor(s),e[i]=t.ceil(a),e}(n,e)):u},u.copy=function(){return Jm(u,R_(e,t,n,r,i,s,a,o,l,c))},u}function P_(){return eg.apply(R_(iv,sv,Qg,Zg,Bg,Ig,Rg,kg,Mg,uv).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function I_(e){return function(){return e}}function D_(e){this._context=e}function O_(e){return new D_(e)}cv=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,a=e.shortDays,o=e.months,l=e.shortMonths,c=vv(i),u=_v(i),h=vv(s),d=_v(s),f=vv(a),p=_v(a),m=vv(o),g=_v(o),v=vv(l),_=_v(l),b={a:function(e){return a[e.getDay()]},A:function(e){return s[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return o[e.getMonth()]},c:null,d:Hv,e:Hv,f:Gv,g:t_,G:r_,H:Fv,I:jv,j:zv,L:Vv,m:Wv,M:qv,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:A_,s:M_,S:Kv,u:$v,U:Xv,V:Zv,w:Jv,W:Qv,x:null,X:null,y:e_,Y:n_,Z:i_,"%":C_},y={a:function(e){return a[e.getUTCDay()]},A:function(e){return s[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return o[e.getUTCMonth()]},c:null,d:s_,e:s_,f:u_,g:w_,G:x_,H:a_,I:o_,j:l_,L:c_,m:h_,M:d_,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:A_,s:M_,S:f_,u:p_,U:m_,V:v_,w:__,W:b_,x:null,X:null,y:y_,Y:S_,Z:E_,"%":C_},w={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=_.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return E(e,t,n,r)},d:Tv,e:Tv,f:Lv,g:Cv,G:Ev,H:Pv,I:Pv,j:Rv,L:Ov,m:kv,M:Iv,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=u.get(r[0].toLowerCase()),n+r[0].length):-1},q:Mv,Q:Nv,s:Uv,S:Dv,u:yv,U:wv,V:Sv,w:bv,W:xv,x:function(e,t,r){return E(e,n,t,r)},X:function(e,t,n){return E(e,r,t,n)},y:Cv,Y:Ev,Z:Av,"%":Bv};function S(e,t){return function(n){var r,i,s,a=[],o=-1,l=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++o<c;)37===e.charCodeAt(o)&&(a.push(e.slice(l,o)),null!=(i=hv[r=e.charAt(++o)])?r=e.charAt(++o):i="e"===r?" ":"0",(s=t[r])&&(r=s(n,i)),a.push(r),l=o+1);return a.push(e.slice(l,o)),a.join("")}}function x(e,t){return function(n){var r,i,s=lv(1900,void 0,1);if(E(s,e,n+="",0)!=n.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(t&&!("Z"in s)&&(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(i=(r=ov(lv(s.y,0,1))).getUTCDay(),r=i>4||0===i?Wg.ceil(r):Wg(r),r=Dg.offset(r,7*(s.V-1)),s.y=r.getUTCFullYear(),s.m=r.getUTCMonth(),s.d=r.getUTCDate()+(s.w+6)%7):(i=(r=av(lv(s.y,0,1))).getDay(),r=i>4||0===i?Ng.ceil(r):Ng(r),r=Ig.offset(r,7*(s.V-1)),s.y=r.getFullYear(),s.m=r.getMonth(),s.d=r.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:"W"in s?1:0),i="Z"in s?ov(lv(s.y,0,1)).getUTCDay():av(lv(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(i+5)%7:s.w+7*s.U-(i+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,ov(s)):av(s)}}function E(e,t,n,r){for(var i,s,a=0,o=t.length,l=n.length;a<o;){if(r>=l)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(s=w[i in hv?t.charAt(a++):i])||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=S(n,b),b.X=S(r,b),b.c=S(t,b),y.x=S(n,y),y.X=S(r,y),y.c=S(t,y),{format:function(e){var t=S(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=x(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",y);return t.toString=function(){return e},t},utcParse:function(e){var t=x(e+="",!0);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),uv=cv.format,cv.parse,cv.utcFormat,cv.utcParse,Array.prototype.slice,D_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};const L_=Math.PI,B_=2*L_,N_=1e-6,U_=B_-N_;function H_(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class F_{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?H_:function(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return H_;const n=10**t;return function(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,r){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(e,t,n,r,i,s){this._append`C${+e},${+t},${+n},${+r},${this._x1=+i},${this._y1=+s}`}arcTo(e,t,n,r,i){if(e=+e,t=+t,n=+n,r=+r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let s=this._x1,a=this._y1,o=n-e,l=r-t,c=s-e,u=a-t,h=c*c+u*u;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(h>N_)if(Math.abs(u*o-l*c)>N_&&i){let d=n-s,f=r-a,p=o*o+l*l,m=d*d+f*f,g=Math.sqrt(p),v=Math.sqrt(h),_=i*Math.tan((L_-Math.acos((p+h-m)/(2*g*v)))/2),b=_/v,y=_/g;Math.abs(b-1)>N_&&this._append`L${e+b*c},${t+b*u}`,this._append`A${i},${i},0,0,${+(u*d>c*f)},${this._x1=e+y*o},${this._y1=t+y*l}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,n,r,i,s){if(e=+e,t=+t,s=!!s,(n=+n)<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(r),o=n*Math.sin(r),l=e+a,c=t+o,u=1^s,h=s?r-i:i-r;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>N_||Math.abs(this._y1-c)>N_)&&this._append`L${l},${c}`,n&&(h<0&&(h=h%B_+B_),h>U_?this._append`A${n},${n},0,1,${u},${e-a},${t-o}A${n},${n},0,1,${u},${this._x1=l},${this._y1=c}`:h>N_&&this._append`A${n},${n},0,${+(h>=L_)},${u},${this._x1=e+n*Math.cos(i)},${this._y1=t+n*Math.sin(i)}`)}rect(e,t,n,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function j_(e){return e[0]}function z_(e){return e[1]}function V_(e,t,n){this.k=e,this.x=t,this.y=n}var G_,W_;function q_(e){return q_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q_(e)}function K_(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function $_(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,eb(r.key),r)}}function X_(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(X_=function(){return!!e})()}function Y_(){return Y_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Z_(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Y_.apply(null,arguments)}function Z_(e){return Z_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z_(e)}function J_(e,t){return J_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},J_(e,t)}function Q_(e,t,n){return(t=eb(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eb(e){var t=function(e){if("object"!=q_(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=q_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==q_(t)?t:t+""}V_.prototype={constructor:V_,scale:function(e){return 1===e?this:new V_(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new V_(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new V_(1,0,0),V_.prototype;var tb,nb,rb=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=Z_(t),function(e,t){if(t&&("object"==q_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,X_()?Reflect.construct(t,n||[],Z_(e).constructor):t.apply(e,n))}(this,t)).data=[],e.maxDataPoints=25,e.updateInterval=1e3,e.lastTimestamp=Date.now(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J_(e,t)}(t,e),function(e,t){return t&&$_(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"firstUpdated",value:function(){var e=this;this.svg=function(e){return"string"==typeof e?new Ef([[document.querySelector(e)]],[document.documentElement]):new Ef([[e]],xf)}(this.renderRoot.querySelector("svg")).attr("viewBox","0 0 ".concat(this.clientWidth," 200")),this.xScale=P_().domain([this.lastTimestamp,this.lastTimestamp+12e5*this.maxDataPoints]).range([0,this.clientWidth]),this.yScale=gg().domain([0,1e3]).range([180,20]),this.line=function(e,t){var n=I_(!0),r=null,i=O_,s=null,a=function(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{const e=Math.floor(n);if(!(e>=0))throw new RangeError(`invalid digits: ${n}`);t=e}return e},()=>new F_(t)}(o);function o(o){var l,c,u,h=(o=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(o)).length,d=!1;for(null==r&&(s=i(u=a())),l=0;l<=h;++l)!(l<h&&n(c=o[l],l,o))===d&&((d=!d)?s.lineStart():s.lineEnd()),d&&s.point(+e(c,l,o),+t(c,l,o));if(u)return s=null,u+""||null}return e="function"==typeof e?e:void 0===e?j_:I_(e),t="function"==typeof t?t:void 0===t?z_:I_(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:I_(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:I_(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:I_(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(s=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=s=null:s=i(r=e),o):r},o}().x(function(t){return e.xScale(t.timestamp)}).y(function(t){return e.yScale(t.price)}).curve(O_),this.xAxis=this.svg.append("g").attr("class","x axis").attr("transform","translate(27, 180)").call(dd(this.xScale)),this.yAxis=this.svg.append("g").attr("class","y axis").attr("transform","translate(27, 0)").call(fd(this.yScale)),this.path=this.svg.append("path").datum(this.data).attr("class","line").attr("transform","translate(50, 0)").attr("d",this.line),this.intervalId=setInterval(function(){return e.updateChart()},this.updateInterval)}},{key:"disconnectedCallback",value:function(){clearInterval(this.intervalId),function(e,t,n){var r=Y_(Z_(e.prototype),"disconnectedCallback",n);return"function"==typeof r?function(e){return r.apply(n,e)}:r}(t,0,this)([])}},{key:"updateChart",value:function(){var e=500+400*Math.random();this.lastTimestamp+=12e5,this.data.push({timestamp:this.lastTimestamp,price:e}),this.data.length>this.maxDataPoints&&this.data.shift(),this.xScale.domain([this.data[0].timestamp,this.lastTimestamp+12e6]),this.path.datum(this.data).attr("d",this.line),this.xAxis.call(dd(this.xScale)),this.yAxis.call(fd(this.yScale)),this.requestUpdate()}},{key:"render",value:function(){return W(G_||(G_=K_(["<svg></svg>"])))}}])}(ce);function ib(e){return ib="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ib(e)}function sb(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ab(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return ob(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(ob(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ob(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,ob(h,"constructor",c),ob(c,"constructor",l),l.displayName="GeneratorFunction",ob(c,i,"GeneratorFunction"),ob(h),ob(h,i,"Generator"),ob(h,r,function(){return this}),ob(h,"toString",function(){return"[object Generator]"}),(ab=function(){return{w:s,m:d}})()}function ob(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}ob=function(e,t,n,r){function s(t,n){ob(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},ob(e,t,n,r)}function lb(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function cb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ub(r.key),r)}}function ub(e){var t=function(e){if("object"!=ib(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ib(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ib(t)?t:t+""}function hb(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(hb=function(){return!!e})()}function db(e){return db=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},db(e)}function fb(e,t){return fb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fb(e,t)}Q_(rb,"properties",{data:{type:Array},intervalId:{attribute:!1}}),Q_(rb,"styles",o(W_||(W_=K_(["\n    :host {\n      display: block;\n      position: relative;\n    }\n    svg {\n      width: 100%; /* Full width of the client */\n      height: 200px; /* New fixed height */\n    }\n    .line {\n      fill: none;\n      stroke: steelblue;\n      stroke-width: 2px;\n    }\n    .axis path,\n    .axis line {\n      fill: none;\n      stroke: #000;\n      shape-rendering: crispEdges;\n    }\n    .axis text {\n      font-size: 7px;\n      fill: #000;\n    }\n"])))),customElements.define("streaming-chart",rb);var pb,mb,gb,vb,_b,bb,yb,wb,Sb,xb,Eb,Cb,Ab,Mb,kb,Tb,Rb,Pb,Ib,Db,Ob,Lb,Bb,Nb,Ub,Hb,Fb,jb,zb,Vb,Gb,Wb,qb,Kb,$b,Xb,Yb,Zb,Jb,Qb,ey,ty,ny,ry,iy,sy,ay,oy,ly,cy,uy,hy=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=db(t),function(e,t){if(t&&("object"==ib(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,hb()?Reflect.construct(t,n||[],db(e).constructor):t.apply(e,n))}(this,t)).inori=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fb(e,t)}(t,e),function(e,t,n){return t&&cb(e.prototype,t),n&&cb(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){lb(s,r,i,a,o,"next",e)}function o(e){lb(s,r,i,a,o,"throw",e)}a(void 0)})}}(ab().m(function e(){return ab().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this;return W(tb||(tb=sb(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <div class="row row-cols-1 row-cols-md-3 g-4">\n  ',"\n  </div>  \n</main>"])),this.inori.env.content.get(),this.inori.env.content.getAllL1().map(function(t,n){var r=e.inori.env.content.getL2(n);if((null==r?void 0:r.length)>0)return W(nb||(nb=sb(['\n      <div class="col">\n        <div class="card text-bg-light mb-3">\n          <div class="card-header fw-lighter">','</div>\n          <div class="card-body">\n            <h5 class="card-title">','</h5>\n            <p class="card-text">',"</p>\n            <streaming-chart></streaming-chart>\n          </div>      \n        </div>\n      </div>"])),t,r[0],r[1])}))}}],[{key:"properties",get:function(){return{inori:{type:Object}}}}]);var n}(ce);function dy(e){return dy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dy(e)}function fy(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function py(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return my(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(my(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,my(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,my(h,"constructor",c),my(c,"constructor",l),l.displayName="GeneratorFunction",my(c,i,"GeneratorFunction"),my(h),my(h,i,"Generator"),my(h,r,function(){return this}),my(h,"toString",function(){return"[object Generator]"}),(py=function(){return{w:s,m:d}})()}function my(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}my=function(e,t,n,r){function s(t,n){my(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},my(e,t,n,r)}function gy(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function vy(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){gy(s,r,i,a,o,"next",e)}function o(e){gy(s,r,i,a,o,"throw",e)}a(void 0)})}}function _y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,by(r.key),r)}}function by(e){var t=function(e){if("object"!=dy(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=dy(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==dy(t)?t:t+""}function yy(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(yy=function(){return!!e})()}function wy(e){return wy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wy(e)}function Sy(e,t){return Sy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Sy(e,t)}customElements.define("streaming-dashboard",hy);var xy,Ey,Cy=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=wy(t),function(e,t){if(t&&("object"==dy(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,yy()?Reflect.construct(t,n||[],wy(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.notificationDetail=null,e.logs=[],e.inboundLogPageIndex=1,e.outboundLogPageIndex=1,e.localLogPageIndex=1,e.localLogPageSize=100,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Sy(e,t)}(t,e),function(e,t,n){return t&&_y(e.prototype,t),n&&_y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(r=vy(py().m(function e(){return py().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"renderAdminInboundLogPaging",value:function(e){var t=this,n=Math.ceil(e/5);if(n<2)return W(pb||(pb=fy([""])));for(var r=[],i=function(e){r.push(W(yb||(yb=fy(["",""])),t.inboundLogPageIndex-1==e?W(wb||(wb=fy(['<li class="page-item active" aria-current="page"><span class="page-link">',"</span></li>"])),t.inboundLogPageIndex):W(Sb||(Sb=fy(['<li class="page-item"><a class="page-link" href="#" @click="','">',"</a></li>"])),function(n){n.preventDefault(),t.inboundLogPageIndex=e+1},e+1)))},s=0;s<n;s++)i(s);return W(mb||(mb=fy(['\n<nav aria-label="Page navigation example">\n  <ul class="pagination pagination-sm justify-content-start">\n  ',"\n    ","\n  ","\n  </ul>\n</nav>"])),t.inboundLogPageIndex>1?W(gb||(gb=fy(['<li class="page-item"><a class="page-link" href="#" @click="','">Previous</a></li>'])),function(e){e.preventDefault(),t.inboundLogPageIndex--}):W(vb||(vb=fy(['<li class="page-item disabled"><span class="page-link">Previous</span></li>']))),r,t.inboundLogPageIndex<n?W(_b||(_b=fy(['<li class="page-item"><a class="page-link" href="#" @click="','">Next</a></li>'])),function(e){e.preventDefault(),t.inboundLogPageIndex++}):W(bb||(bb=fy(['<li class="page-item disabled"><span class="page-link">Next</span></li>']))))}},{key:"renderAdminOutboundLogPaging",value:function(e){var t=this,n=Math.ceil(e/5);if(n<2)return W(xb||(xb=fy([""])));for(var r=[],i=function(e){r.push(W(Tb||(Tb=fy(["",""])),t.outboundLogPageIndex-1==e?W(Rb||(Rb=fy(['<li class="page-item active" aria-current="page"><span class="page-link">',"</span></li>"])),t.outboundLogPageIndex):W(Pb||(Pb=fy(['<li class="page-item"><a class="page-link" href="#" @click="','">',"</a></li>"])),function(n){n.preventDefault(),t.outboundLogPageIndex=e+1},e+1)))},s=0;s<n;s++)i(s);return W(Eb||(Eb=fy(['\n<nav aria-label="Page navigation example">\n  <ul class="pagination pagination-sm justify-content-start">\n  ',"\n    ","\n  ","\n  </ul>\n</nav>"])),t.outboundLogPageIndex>1?W(Cb||(Cb=fy(['<li class="page-item"><a class="page-link" href="#" @click="','">Previous</a></li>'])),function(e){e.preventDefault(),t.outboundLogPageIndex--}):W(Ab||(Ab=fy(['<li class="page-item disabled"><span class="page-link">Previous</span></li>']))),r,t.outboundLogPageIndex<n?W(Mb||(Mb=fy(['<li class="page-item"><a class="page-link" href="#" @click="','">Next</a></li>'])),function(e){e.preventDefault(),t.outboundLogPageIndex++}):W(kb||(kb=fy(['<li class="page-item disabled"><span class="page-link">Next</span></li>']))))}},{key:"renderLocalLogPaging",value:function(e){var t=this,n=Math.ceil(e/t.localLogPageSize);if(n<2)return W(Ib||(Ib=fy([""])));for(var r=[],i=function(e){r.push(W(Ub||(Ub=fy(["",""])),t.localLogPageIndex-1==e?W(Hb||(Hb=fy(['<li class="page-item active" aria-current="page"><span class="page-link">',"</span></li>"])),t.localLogPageIndex):W(Fb||(Fb=fy(['<li class="page-item"><a class="page-link" @click="','">',"</a></li>"])),function(n){n.preventDefault(),t.localLogPageIndex=e+1},e+1)))},s=0;s<n;s++)i(s);return W(Db||(Db=fy(['\n<nav aria-label="Page navigation example">\n  <ul class="pagination pagination-sm justify-content-start">\n  ',"\n    ","\n  ","\n  </ul>\n</nav>"])),t.localLogPageIndex>1?W(Ob||(Ob=fy(['<li class="page-item"><a class="page-link" @click="','">Previous</a></li>'])),function(e){e.preventDefault(),t.localLogPageIndex--}):W(Lb||(Lb=fy(['<li class="page-item disabled"><span class="page-link">Previous</span></li>']))),r,t.localLogPageIndex<n?W(Bb||(Bb=fy(['<li class="page-item"><a class="page-link" @click="','">Next</a></li>'])),function(e){e.preventDefault(),t.localLogPageIndex++}):W(Nb||(Nb=fy(['<li class="page-item disabled"><span class="page-link">Next</span></li>']))))}},{key:"renderLocalNotificationHeader",value:function(){return["metadata","count","last_update"].map(function(e){return W(jb||(jb=fy(['<th class="fw-lighter" scope="col">',"</th>"])),e)})}},{key:"renderAdminNotificationHeader",value:function(e){return[e?"from":"to","message type","metadata","last_update"].map(function(e){return W(zb||(zb=fy(['<th scope="col">',"</th>"])),e)})}},{key:"renderLocalNotificationContent",value:function(){var e=this.logs,t=this,n=this.localLogPageIndex;if(e){var r=e.map(function(e){if(!(e.msg.indexOf("local")<0))return W(Vb||(Vb=fy(["<tr>","</tr>"])),["metadata","count","last_update"].map(function(n){if("count"==n)return W(Gb||(Gb=fy(['<td class="fw-light text-break">',"</td>"])),e.last_update.length);var r=e[n];if("last_update"==n){var i=r[r.length-1],s=t.inori.util.calculateElapsedMinutes(i);return s<60?W(Wb||(Wb=fy(['<td class="fw-light text-break">'," min ago</td>"])),s):W(qb||(qb=fy(['<td class="fw-light text-break">',"</td>"])),new Date(i).toLocaleString())}return r.substring||(r=e.msg),W(Kb||(Kb=fy(['<td class="fw-light text-break">',"</td>"])),r)}))});return r=r.filter(function(e){return e}),W($b||($b=fy(["\n",'\n<table class="table table-striped table-hover">\n  <thead>\n    <tr>\n      ',"\n    </tr>\n  </thead>\n  <tbody>\n    ","\n  </tbody>\n</table>"])),r.length>0?W(Xb||(Xb=fy(['<div class="row">\n<div class="col">',"</div></div>"])),this.renderLocalLogPaging(r.length)):"",r.length>0?this.renderLocalNotificationHeader():W(Yb||(Yb=fy([""]))),r.slice((n-1)*t.localLogPageSize,(n-1)*t.localLogPageSize+t.localLogPageSize))}e=[]}},{key:"renderAdminNotificationContent",value:function(e){var t=this.logs,n=this,r=e?this.inboundLogPageIndex:this.outboundLogPageIndex;if(t){var i=t.filter(function(t){return e?t.to==n.inori.tenant.session_id():t.to!=n.inori.tenant.session_id()}).map(function(t){if(!(t.msg.indexOf("local")>-1))return W(Zb||(Zb=fy(['<tr class="','">',"</tr>"])),t.has_read?"":"table-active fw-bold",[e?"from":"to","msg","metadata","last_update"].map(function(e){var r;if("from"==e||"to"==e)return W(Jb||(Jb=fy(['<td><a class="btn btn-link btn-sm py-0 ','" data-bs-target="#modelLogDetail" @click="','">',"</a></td>"])),t.has_read?"fw-normal":"fw-bold",n.handleClick4NotificationDetail.bind(n,t),t[e]);var i=t[e];if("last_update"==e){var s=i[i.length-1],a=n.inori.util.calculateElapsedMinutes(s);return a<60?W(Qb||(Qb=fy(["<td>"," min ago</td>"])),a):W(ey||(ey=fy(["<td>","</td>"])),new Date(s).toLocaleString())}return null!==(r=i)&&void 0!==r&&r.substring||(i=t.msg),W(ty||(ty=fy(["<td>","</td>"])),i.length>20?i.substring(0,30)+"...":i)}))});return i=i.filter(function(e){return e}),W(ny||(ny=fy(["\n",'\n<table class="table table-striped table-hover mb-5">\n  <thead>\n    <tr>\n      ',"\n    </tr>\n  </thead>\n  <tbody>\n    ","\n  </tbody>\n</table>"])),i.length>0?W(ry||(ry=fy(['<div class="row">\n<div class="col">','</div>\n<h5 class="card-title mb-4 me-5 col text-end">',"</h5></div>"])),e?n.renderAdminInboundLogPaging(i.length):n.renderAdminOutboundLogPaging(i.length),e?"Inbound Log":"Outbound Log"):"",i.length>0?n.renderAdminNotificationHeader(e):W(iy||(iy=fy([""]))),i.slice(5*(r-1),5*(r-1)+5))}t=[]}},{key:"renderNotificationDetail",value:function(){return W(sy||(sy=fy(["",""])),this.notificationDetail?W(ay||(ay=fy(['\n<div class="modal fade" id="modelNotificationDetail" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h1 class="modal-title fs-5" id="staticBackdropLabel">Log</h1>\n        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n      </div>\n      <div class="modal-body overflow-hidden">\n        <table class="table">\n          <tbody>\n            <tr>\n              <td class="fw-normal">id</td>\n              <td class="fw-lighter text-break">','</td> \n            </tr>\n            <tr>\n              <td class="fw-normal">from</td>\n              <td class="fw-lighter text-break">','</td> \n            </tr>\n            <tr>\n              <td class="fw-normal">metadata</td>\n              <td class="fw-lighter text-break">','</td> \n            </tr>\n            <tr>\n              <td class="fw-normal">last_update</td>\n              <td class="fw-lighter text-break">','</td> \n            </tr>\n            <tr>\n              <td class="fw-normal">msg</td>\n              <td class="fw-lighter text-break">','</td> \n            </tr>              \n          </tbody>\n        </table>           \n      </div>\n      <div class="modal-footer">\n        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal"\n          @click="','">',"</button>                                    \n      </div>\n    </div>\n  </div>\n</div>"])),this.notificationDetail.id,this.notificationDetail.from,this.notificationDetail.metadata,this.notificationDetail.last_update,this.notificationDetail.msg,this.processNotification.bind(this,this.notificationDetail),"tenant:data:ice_offer:content:<ice_offer>"==this.notificationDetail.msg?W(oy||(oy=fy(["Process"]))):W(ly||(ly=fy(["Close"])))):W(cy||(cy=fy([""]))))}},{key:"handleClick4NotificationDetail",value:(n=vy(py().m(function e(t){var n,r;return py().w(function(e){for(;;)switch(e.n){case 0:return n=this,e.n=1,this.updateComplete;case 1:return this.notificationDetail=t,e.n=2,this.updateComplete;case 2:r=this.renderRoot.querySelector("#modelNotificationDetail"),this.notificationDetail.htmlTmpl=new bootstrap.Modal(r,{}),this.notificationDetail.htmlTmpl.show(),r.addEventListener("shown.bs.modal",function(e){t.has_read=!0,n.dispatchEvent(new CustomEvent("local:stream:notify:read",{detail:{tab_id:0,metadata:t}}))}),r.addEventListener("hidden.bs.modal",function(e){n.requestUpdate()});case 3:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"processNotification",value:function(e){"tenant:data:ice_offer:content:<ice_offer>"===e.msg&&(this.dispatchEvent(new CustomEvent("local:stream:notify:process",{detail:{tab_id:0,metadata:e}})),this.requestUpdate())}},{key:"render",value:function(){return W(uy||(uy=fy(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">',"</h4>\n  ","\n  ","  \n</main>"])),this.inori.env.content.get(),this.renderLocalNotificationContent(!0),this.renderNotificationDetail())}}],[{key:"properties",get:function(){return{inori:{type:Object},logs:{type:Array},localLogPageIndex:{type:Number},inboundLogPageIndex:{type:Number},outboundLogPageIndex:{type:Number},notificationDetail:{type:Object}}}}]);var n,r}(ce);function Ay(e){return Ay="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ay(e)}function My(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ky(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return Ty(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Ty(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Ty(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,Ty(h,"constructor",c),Ty(c,"constructor",l),l.displayName="GeneratorFunction",Ty(c,i,"GeneratorFunction"),Ty(h),Ty(h,i,"Generator"),Ty(h,r,function(){return this}),Ty(h,"toString",function(){return"[object Generator]"}),(ky=function(){return{w:s,m:d}})()}function Ty(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Ty=function(e,t,n,r){function s(t,n){Ty(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},Ty(e,t,n,r)}function Ry(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Py(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Iy(r.key),r)}}function Iy(e){var t=function(e){if("object"!=Ay(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ay(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ay(t)?t:t+""}function Dy(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Dy=function(){return!!e})()}function Oy(e){return Oy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Oy(e)}function Ly(e,t){return Ly=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ly(e,t)}customElements.define("streaming-logs",Cy);var By,Ny,Uy,Hy,Fy,jy,zy,Vy,Gy,Wy,qy,Ky,$y,Xy,Yy,Zy,Jy,Qy,ew,tw,nw,rw,iw,sw,aw,ow,lw,cw,uw,hw,dw,fw,pw,mw,gw,vw,_w,bw,yw,ww,Sw,xw,Ew,Cw,Aw,Mw,kw=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=Oy(t),function(e,t){if(t&&("object"==Ay(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Dy()?Reflect.construct(t,n||[],Oy(e).constructor):t.apply(e,n))}(this,t)).notifications=null,e.inori=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ly(e,t)}(t,e),function(e,t,n){return t&&Py(e.prototype,t),n&&Py(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("notifications")&&this.notifications&&this.notifications.length>0&&this._notifyHandler()}},{key:"_notifyHandler",value:(n=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){Ry(s,r,i,a,o,"next",e)}function o(e){Ry(s,r,i,a,o,"throw",e)}a(void 0)})}}(ky().m(function e(){var t;return ky().w(function(e){for(;;)switch(e.n){case 0:return t=this,e.n=1,t.updateComplete;case 1:this.notifications.forEach(function(e){var n=t.renderRoot.querySelector('div[class~="'.concat(e.id,'"]'));null==n||n.addEventListener("hidden.bs.toast",function(){e.has_notified=!0});var r=bootstrap.Toast.getOrCreateInstance(n);null==r||r.show()});case 2:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"_processHandler",value:function(e){var t=this.renderRoot.querySelector('div[class~="'.concat(e.id,'"]'));e.has_read=!0,"tenant:data:ice_offer:content:<ice_offer>"===e.msg&&this.dispatchEvent(new CustomEvent("local:stream:notify:process",{detail:{metadata:e,tab_id:0}})),bootstrap.Toast.getOrCreateInstance(t).hide()}},{key:"renderNotify",value:function(){var e=this,t=this;return this.notifications.map(function(n){if(n&&n.from)return W(xy||(xy=My(['\n<div class="toast notify ','" role="alert" aria-live="assertive" aria-atomic="true">\n  <div class="toast-header">\n    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-text-fill me-2" viewBox="0 0 16 16">\n      <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4.414a1 1 0 0 0-.707.293L.854 15.146A.5.5 0 0 1 0 14.793V2zm3.5 1a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 2.5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 2.5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5z"/>\n    </svg>\n    <strong class="me-auto">Streaming</strong>\n    <small>',' minutes ago</small>\n    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>\n  </div>\n  <div class="toast-body">\n    Received <b>',"</b> from <b>",'</b> <button type="button" @click="','" class="btn btn-link btn-sm py-0">Acknowlede</button>  \n  </div>\n</div>'])),n.id,t.inori.util.calculateElapsedMinutes(n.last_update),n.msg,n.from,e._processHandler.bind(t,n))}).filter(function(e){return e})}},{key:"render",value:function(){return W(Ey||(Ey=My(['\n<div aria-live="polite" aria-atomic="true" class="position-relative">\n  <div class="toast-container end-0 p-3">\n    ',"  \n  </div>\n</div>"])),this.renderNotify())}}],[{key:"properties",get:function(){return{notifications:{type:Array},inori:{type:Object}}}}]);var n}(ce);function Tw(e){return Tw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tw(e)}function Rw(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Pw(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return Iw(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Iw(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Iw(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,Iw(h,"constructor",c),Iw(c,"constructor",l),l.displayName="GeneratorFunction",Iw(c,i,"GeneratorFunction"),Iw(h),Iw(h,i,"Generator"),Iw(h,r,function(){return this}),Iw(h,"toString",function(){return"[object Generator]"}),(Pw=function(){return{w:s,m:d}})()}function Iw(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Iw=function(e,t,n,r){function s(t,n){Iw(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},Iw(e,t,n,r)}function Dw(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Ow(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){Dw(s,r,i,a,o,"next",e)}function o(e){Dw(s,r,i,a,o,"throw",e)}a(void 0)})}}function Lw(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Bw(r.key),r)}}function Bw(e){var t=function(e){if("object"!=Tw(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Tw(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Tw(t)?t:t+""}function Nw(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Nw=function(){return!!e})()}function Uw(e,t,n,r){var i=Hw(Fw(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function Hw(){return Hw="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Fw(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Hw.apply(null,arguments)}function Fw(e){return Fw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Fw(e)}function jw(e,t){return jw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},jw(e,t)}customElements.define("streaming-notify",kw);var zw,Vw,Gw,Ww,qw,Kw,$w,Xw,Yw,Zw,Jw,Qw,eS,tS,nS,rS,iS=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=Fw(t),function(e,t){if(t&&("object"==Tw(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Nw()?Reflect.construct(t,n||[],Fw(e).constructor):t.apply(e,n))}(this,t)).connected=!1,e.clicked=!1,e.iceOffer=null,e.sessionId=null,e.predictionDetail=null,e.trainerModels=null,e.predictionDetailModel=!1,e.processorCreationModel=!1,e.remoteProcessorList=null,e.processorPageIndex=1,e.startBrowsePageIndex=1,e.remoteId="",e.localMediaStream={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jw(e,t)}(t,e),function(e,t,n){return t&&Lw(e.prototype,t),n&&Lw(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler(),e.has("processorInfo")&&this.processorInfo&&this.processorInfo.dat.remoteId}},{key:"_connHandler",value:(l=Ow(Pw().m(function e(){return Pw().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return l.apply(this,arguments)})},{key:"_loggedInHandler",value:(o=Ow(Pw().m(function e(){return Pw().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return o.apply(this,arguments)})},{key:"reset",value:(a=Ow(Pw().m(function e(t){var n,r;return Pw().w(function(e){for(;;)switch(e.n){case 0:if(n=this.renderRoot.querySelector("#localVideo"),this.inori.util.capture_frame(this.processorInfo,n),!(r=this.processorInfo.get_subscriber(this.sessionId))){e.n=2;break}if(this.processorInfo.del_subscriber(r.Id()),!r.conn||"connected"!=r.conn.connectionState){e.n=2;break}return e.n=1,r.sendAction({command:this.inori.tenant.get_command_values().STANDBY,setting:{processorId:this.processorInfo.Id()}});case 1:e.v||this.inori.tenant.clog("failed sending standby cmd");case 2:this.dispatchEvent(new CustomEvent("local:stream:reset",{detail:{tab_id:0}}));case 3:return e.a(2)}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"add_screen_media",value:(s=Ow(Pw().m(function e(){var n;return Pw().w(function(e){for(;;)switch(e.n){case 0:return n=this,Uw(t,"connectedCallback",this,3)([]),e.n=1,n.processorInfo.share_screen();case 1:if(!e.v){e.n=2;break}n.localMediaStream[n.inori.tenant.session_id()]=n.processorInfo.get_mediaStream(n.inori.tenant.session_id()),n.remoteId=n.inori.tenant.session_id();case 2:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"add_media",value:(i=Ow(Pw().m(function e(){var n;return Pw().w(function(e){for(;;)switch(e.n){case 0:return n=this,Uw(t,"connectedCallback",this,3)([]),e.n=1,n.processorInfo.share_camera();case 1:if(!e.v){e.n=2;break}n.localMediaStream[n.inori.tenant.session_id()]=n.processorInfo.get_mediaStream(n.inori.tenant.session_id()),n.remoteId=n.inori.tenant.session_id();case 2:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_renderProcessorDetail",value:function(e){var t=this.inori.tenant.get_remote_processor(e.id);if(t){var n=this.inori.tenant.get_processor(t.id);n||((n=this.inori.tenant.add_processor("guest_".concat(t.name))).dat=t)}else this.inori.tenant.clog("invalid remote processor# ".concat(e.id))}},{key:"_deleteLocalResource",value:(r=Ow(Pw().m(function e(){return Pw().w(function(e){for(;;)switch(e.n){case 0:if(!this.processorInfo.localFileStream){e.n=2;break}return e.n=1,this.processorInfo.delRecording();case 1:return this._deleteProcessor(),e.a(2);case 2:this.requestUpdate();case 3:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_videoSharedCurrentConn",value:function(e){var t=this,n=e.conn(e.dat.remoteId),r=e.get_mediaStream(e.dat.remoteId);r.getTracks().forEach(function(e){n.addTrack(e,r)}),n.createOffer().then(function(r){return n.setLocalDescription(r),t.inori.tenant.update_offer(io,e,!0)}).then(function(e){t.inori.tenant.clog("ice offer updated successful by remote #".concat(e.aid));var r=JSON.parse(atob(e.answer));return n.setRemoteDescription(r)}).then(function(n){t.inori.tenant.clog("_videoSharedCurrentConn > setRemoteDescription > completed",n),e.isTrackShared=!0})}},{key:"_onLocalMessageReceived",value:function(e){this._setTextAreaVal("#localIncoming",e.data,this)}},{key:"_setTextAreaVal",value:function(e,t,n){""!=t&&(n.inori.tenant.clog("Remote message received by local: ".concat(t)),n.processorInfo.messageHistory+=t+"\n"),n.renderRoot.querySelector(e).value=n.processorInfo.messageHistory}},{key:"_onRemoteMessageReceived",value:function(e){this._setTextAreaVal("#localIncoming",e.data,this)}},{key:"_sendMessage",value:function(e,t){var n=this,r=n.renderRoot.querySelector(e),i=r.value;""!==i?(n.inori.tenant.clog("Sending remote message: ",i),n.processorInfo.data_channel(n.processorInfo.dat.remoteId).send(i),r.value=""):n.inori.tenant.clog("Not sending empty message!")}},{key:"_toggleStreaming",value:(n=Ow(Pw().m(function e(){var t;return Pw().w(function(e){for(;;)switch(e.n){case 0:if("stream"==(t=this).processorInfo.status()){e.n=2;break}return e.n=1,t.processorInfo.resumeReplay();case 1:e.n=3;break;case 2:return e.n=3,t.processorInfo.stopReplay();case 3:t.requestUpdate();case 4:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"disconnectedCallback",value:function(){Uw(t,"disconnectedCallback",this,3)([])}},{key:"connectDevice",value:function(){}},{key:"renderServiceHeader",value:function(){return this.inori.tenant.get_active_tenants()?["name","opCode","hostName","hostOs","lastUpdate","sessionId","services"].map(function(e){return"services"==e?W(Ny||(Ny=Rw(['<th class="fw-lighter" scope="col"></th>']))):W(Uy||(Uy=Rw(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W(By||(By=Rw([""])))}},{key:"renderServiceContent",value:function(){var e=this,t=e.inori.tenant.get_active_tenants().filter(function(t){var n,r;return t.processorId||t.sessionId==e.inori.tenant.session_id()||(null===(n=t.opCode)||void 0===n?void 0:n.includes("ci-deploy-svc"))||(null===(r=t.opCode)||void 0===r?void 0:r.includes("ci-deploy-np"))});return t||function(){throw new TypeError('"_c" is read-only')}(),Object.values(t).map(function(t){return W(Hy||(Hy=Rw(["\n        <tr>","\n        </tr>"])),["name","opCode","hostName","hostOs","lastUpdate","sessionId","services"].map(function(n){if("opCode"==n)return W(Fy||(Fy=Rw(['\n          <td class="fw-light">',"</td>"])),t[n]);if("name"==n)return W(jy||(jy=Rw(['\n          <td class="fw-light">\n            <a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n              ',"\n            </a>\n          </td>"])),function(){var n=Ow(Pw().m(function n(r){var i,s,a;return Pw().w(function(n){for(;;)switch(n.n){case 0:if(i=e.inori.util.dbg,t.sessionId!=e.inori.tenant.session_id()){n.n=1;break}return e.remoteId=t.sessionId,e.requestUpdate(),n.a(2);case 1:if(!t.processorId){n.n=5;break}if(s=e.inori.tenant.get_processors().find(function(e){return e.dat.name.includes("preview-".concat(t.sessionId))}),s){n.n=3;break}return(s=e.inori.tenant.add_processor("preview-".concat(t.sessionId))).streamRcvdCallback=function(n){n.getTracks().forEach(function(n){"video"==n.kind&&(n.addEventListener("unmute",function(r){i("Track ".concat(n.id," has been unmuted")),e.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{processorInfo:s,remoteId:t.sessionId}}))},{once:!0}),"live"==n.readyState&&i("remote ".concat(n.kind," stream with id: ").concat(n.id," readyState: ").concat(n.readyState," bound")))}),i("processing remote stream")},s.dat.remoteId=t.sessionId,s.dat.id=t.processorId,s.peerChannelCallback=function(){var t=Ow(Pw().m(function t(n){var r;return Pw().w(function(t){for(;;)switch(t.n){case 0:(r=e.inori.tenant.get_subscription(s.dat.remoteId))&&(e.remoteId=r.sessionId,r.req_processors(1));case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),n.n=2,s.req2RemoteStream();case 2:n.n=4;break;case 3:if(!(a=e.inori.tenant.get_subscription(t.sessionId))){n.n=4;break}return e.remoteId=a.sessionId,e.requestUpdate(),n.a(2);case 4:e.requestUpdate();case 5:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),t[n]);if("sessionId"==n)return W(zy||(zy=Rw(['\n          <td class="fw-light"><span class="d-inline-block text-truncate" style="max-width: 100px;">',"</span></td>"])),t[n]);var r;if("services"==n)return W(Vy||(Vy=Rw(['\n          <td class="fw-light align-bottom">\n            ',"\n          </td>"])),e.inori.tenant.session_id()==t.sessionId?W(Gy||(Gy=Rw(['   \n            <a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"/>\n              </svg>\n            </a>\n            <a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cast" viewBox="0 0 16 16">\n                <path d="m7.646 9.354-3.792 3.792a.5.5 0 0 0 .353.854h7.586a.5.5 0 0 0 .354-.854L8.354 9.354a.5.5 0 0 0-.708 0z"/>\n                <path d="M11.414 11H14.5a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h3.086l-1 1H1.5A1.5 1.5 0 0 1 0 10.5v-7A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v7a1.5 1.5 0 0 1-1.5 1.5h-2.086l-1-1z"/>\n              </svg>\n            </a>'])),e.inori.tenant.has_local_stream_processor()?"disabled":"",function(){var n=Ow(Pw().m(function n(r){var i;return Pw().w(function(n){for(;;)switch(n.n){case 0:if(i=e.inori.tenant.get_processors().find(function(e){return e.dat.name.includes("live-cam")}),null!=i){n.n=2;break}return n.n=1,e.inori.tenant.standby_video_sharing(null);case 1:i=n.v;case 2:i&&e.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{processorInfo:i,remoteId:t.sessionId}}));case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),e.inori.tenant.has_local_stream_processor()?"disabled":"",function(){var n=Ow(Pw().m(function n(r){var i;return Pw().w(function(n){for(;;)switch(n.n){case 0:if(i=e.inori.tenant.get_processors().find(function(e){return e.dat.name.includes("screen-preview")}),null!=i){n.n=2;break}return n.n=1,e.inori.tenant.standby_screen_sharing(null);case 1:i=n.v;case 2:i&&e.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{processorInfo:i,remoteId:t.sessionId}}));case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}()):W(Wy||(Wy=Rw(["",'\n            <a class="icon-link icon-link-hover m-1 remote-btn" id="remote-btn-','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hdd-network" viewBox="0 0 16 16">\n                <path d="M4.5 5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1M3 4.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>\n                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2H8.5v3a1.5 1.5 0 0 1 1.5 1.5h5.5a.5.5 0 0 1 0 1H10A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5H.5a.5.5 0 0 1 0-1H6A1.5 1.5 0 0 1 7.5 10V7H2a2 2 0 0 1-2-2zm1 0v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1m6 7.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5"/>\n              </svg>\n            </a>\n            <a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bar-chart" viewBox="0 0 16 16">\n                <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>\n              </svg>\n            </a>'])),t.role!=e.inori.tenant.dataType().Role.values.ROLE_NONE&&t.role!=e.inori.tenant.dataType().Role.values.TENANT&&t.role!=e.inori.tenant.dataType().Role.values.GUEST&&t.role!=e.inori.tenant.dataType().Role.values.SHADOW?W(qy||(qy=Rw(["\n            ",'            \n            <a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-terminal" viewBox="0 0 16 16">\n                <path d="M6 9a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3A.5.5 0 0 1 6 9M3.854 4.146a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708l-2-2z"/>\n                <path d="M2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z"/>\n              </svg>\n            </a>'])),null!==(r=t.device)&&void 0!==r&&null!==(r=r.coms)&&void 0!==r&&r.find(function(e){return"/dev/video0"==e})?W(Ky||(Ky=Rw(['\n            <a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"/>\n              </svg>\n            </a>'])),function(){var n=Ow(Pw().m(function n(r){var i,s,a,o,l;return Pw().w(function(n){for(;;)switch(n.n){case 0:if(!(i=e.inori.tenant.get_subscription(t.sessionId))){n.n=1;break}return e.remoteId=i.sessionId,(s=e.inori.tenant.get_processors().find(function(e){return e.dat.remoteId.toLowerCase()==i.sessionId.toLowerCase()}))&&e.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{processorInfo:s,remoteId:e.remoteId}})),n.a(2);case 1:if(!t.processorId){n.n=2;break}return a="cam-preview-".concat(t.sessionId),o=e.inori.tenant.add_processor("".concat(a)),l=e.inori.util.dbg,o.streamRcvdCallback=function(e){e.getTracks().forEach(function(e){e.addEventListener("unmute",function(t){l("Track ".concat(e.id," has been unmuted"))},{once:!0}),"live"==e.readyState&&l("remote ".concat(e.kind," stream with id: ").concat(e.id," readyState: ").concat(e.readyState," received"))})},o.dat.remoteId=t.sessionId,o.dat.id=t.processorId,o.peerChannelCallback=function(){var t=Ow(Pw().m(function t(n){var r;return Pw().w(function(t){for(;;)switch(t.n){case 0:(i=o.get_subscriber(o.dat.remoteId))&&(e.inori.tenant.add_subscription(i),e.remoteId=i.sessionId,r="/dev/video0",e.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{processorInfo:o,remoteId:e.remoteId,fileDir:r}})),i.liveStream(r,!1),i.req_processors(1));case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),n.n=2,o.req2RemoteStream();case 2:e.requestUpdate();case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}()):W($y||($y=Rw([""]))),e.inori.tenant.standby_video_sharing.bind(e.inori,null)):W(Xy||(Xy=Rw([""]))),t.sessionId,function(n){n.stopPropagation(),e.inori.tenant.get_shadow_tkn(t.sessionId)},function(){var n=Ow(Pw().m(function n(r){return Pw().w(function(n){for(;;)if(0===n.n)return r.stopPropagation(),e.inori.util.get_app_metrics(t.sessionId),n.a(2)},n)}));return function(e){return n.apply(this,arguments)}}()));if("hostName"==n)return t&&t.device&&t.device.name?W(Yy||(Yy=Rw(['\n          <td class="fw-light">',"</td>"])),t.device.name):W(Zy||(Zy=Rw(['\n          <td class="fw-light"></td>'])));if("hostOs"==n)return t&&t.device&&t.device.os?W(Jy||(Jy=Rw(['\n          <td class="fw-light"><span class="d-inline-block text-truncate" style="max-width: 100px;">',"<span></td>"])),t.device.os):W(Qy||(Qy=Rw(['\n          <td class="fw-light"></td>'])));var i=t[n];if("lastUpdate"==n){var s=e.inori.util.formatUnix2Date(i);return W(ew||(ew=Rw(['\n          <td class="fw-light">',"</td>"])),s)}return W(tw||(tw=Rw(['\n          <td class="fw-light text-truncate">',"</td>"])),i)}))})}},{key:"renderProcessorListHeader",value:function(){return this.inori.tenant.get_active_tenants()?["name","opCode","lastUpdate","sessionId","services"].map(function(e){return"services"==e?W(rw||(rw=Rw(['<th class="fw-lighter" scope="col"></th>']))):W(iw||(iw=Rw(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W(nw||(nw=Rw([""])))}},{key:"renderProcessorListContent",value:function(){var e=this,t=e.inori.util.dbg,n=e.inori.tenant.get_active_tenants().find(function(t){return t.sessionId==e.remoteId});return n?W(aw||(aw=Rw(["\n    <tr>","\n    </tr>\n    ",""])),["name","opCode","lastUpdate","sessionId","services"].map(function(t){return"name"==t?W(ow||(ow=Rw(['\n      <td class="fw-light">\n        <a class="btn btn-link btn-sm py-0 text-truncate" role="button" @click="','">',"</a>\n      </td>"])),function(t){e.remoteId="",e.requestUpdate()},n[t]):"services"==t?W(lw||(lw=Rw(['\n      <td class="fw-light"></td>']))):W(cw||(cw=Rw(['\n      <td class="fw-light">',"</td>"])),n[t])}),e.remoteId==e.inori.tenant.session_id()?e.inori.tenant.get_processors().filter(function(e){return e.isLocalScreenStream||e.isLocalVideoStream}).map(function(t){return W(uw||(uw=Rw(['\n    <tr>\n      <td colspan="2" class="fw-light">\n        <a class="btn btn-link btn-sm py-0" @click="','">\n          ','\n        </a>\n      </td>\n      <td colspan="3" class="fw-light">\n        <img src="','" class="object-fit-contain border rounded h-100" style="width: 150px;">\n      </td>\n    </tr>'])),function(){var n=Ow(Pw().m(function n(r){return Pw().w(function(n){for(;;)switch(n.n){case 0:e.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{processorInfo:t,remoteId:e.remoteId}}));case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),t.dat.name,t.screenshot())}):e.inori.tenant.get_remote_processors().filter(function(t){return t.sessionId==e.remoteId&&t.remoteId==e.inori.tenant.session_id()}).map(function(n){var r=e.inori.tenant.get_processors().find(function(t){return t.get_subscriber(e.remoteId)&&t.dat.name.includes("preview-".concat(e.remoteId))});if(r)return W(hw||(hw=Rw(['\n    <tr>\n      <td colspan="2" class="fw-light">\n        <a class="btn btn-link btn-sm py-0" @click="','">','\n        </a>\n      </td>\n      <td colspan="3" class="fw-light">\n        <img src="','" class="object-fit-contain border rounded h-100" style="width: 150px;">\n      </td>\n    </tr>'])),function(){var i=Ow(Pw().m(function i(s){var a,o;return Pw().w(function(i){for(;;)switch(i.n){case 0:if(a=e.inori.tenant.get_subscription(e.remoteId),o="",a){i.n=1;break}return t("no subscriber found in the local processor id: ".concat(n.id," name: ").concat(n.name)),i.a(2);case 1:if(!r.dat.name.includes("cam-preview")){i.n=3;break}return o="/dev/video0",i.n=2,a.liveStream(o,!1);case 2:i.n=4;break;case 3:return i.n=4,a.subscribe_remote(n.id);case 4:r.dat.id=n.id,e.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{processorInfo:r,remoteId:e.remoteId,fileDir:o}}));case 5:return i.a(2)}},i)}));return function(e){return i.apply(this,arguments)}}(),r.dat.name,r.screenshot())})):W(sw||(sw=Rw([""])))}},{key:"renderActiveDeviceList",value:function(){var e=this;return W(dw||(dw=Rw(['\n    <table class="table table-striped table-hover">\n      <thead>\n        <tr>\n          ',"\n        </tr>\n      </thead>\n      <tbody>         \n          ","\n      </tbody>\n    </table>"])),""==e.remoteId?e.renderServiceHeader():e.renderProcessorListHeader(),""==e.remoteId?e.renderServiceContent():e.renderProcessorListContent())}},{key:"renderProcessorList",value:function(){var e=this,t=this,n=t.remoteProcessorList.filter(function(e){return e.sessionId.toLowerCase()===t.sessionId.toLowerCase()}),r=20*(t.processorPageIndex-1),i=r+20>n.length?n.length:r+20,s=n.slice(r,i);return W(fw||(fw=Rw(["",'\n<div class="row align-items-start">\n    ',"</div>",""])),this.renderProcessorPaging(n.length,20),s.map(function(t){return W(pw||(pw=Rw(['\n  <div class="card p-0 m-2 col-5 text-bg-light">\n    <div class="row g-0">\n      <div class="col-md-4">\n        <a class="link-underline link-underline-opacity-0" role="button" @click="','">\n        ','\n        </a>\n      </div>\n      <div class="col-md-8">\n        <div class="card-body">\n          <h5 class="card-title"><a class="link-underline link-underline-opacity-0" role="button" @click="','">\n      ','</a></h5>\n          <p class="card-text">Device: ',".. (",')<br><span class="text-decoration-underline">Format: Unknown</span></p>\n          <p class="card-text"><small class="text-body-secondary">',"</small></p>\n        </div>\n      </div>\n    </div>\n  </div>\n"])),e._renderProcessorDetail.bind(e,t),t.screenshot?W(mw||(mw=Rw(['\n          <img src="','" class="img-fluid rounded-start" alt="','">'])),t.screenshot,t.id):W(gw||(gw=Rw(['\n          <svg xmlns="http://www.w3.org/2000/svg" width="75" height="100" fill="currentColor" class="bi bi-question-circle-fill start-50 top-50 position-relative translate-middle" viewBox="0 0 16 16">\n            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/>\n          </svg>']))),e._renderProcessorDetail.bind(e,t),t.name,t.sessionId.substr(0,10),t.sessionId==e.inori.tenant.session_id()?"Local":"Remote",new Date(t.lastUpdate).toGMTString())}),this.renderProcessorPaging(n.length,20))}},{key:"renderProcessorCreationModel",value:function(){var e=this;return W(vw||(vw=Rw(['\n<div class="modal fade" id="modelProcessorCreation" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h1 class="modal-title fs-5" id="staticBackdropLabel">Add Processor</h1>\n        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n      </div>\n      <div class="modal-body">\n        <table class="table">\n          <tbody>\n            <tr>\n              <td class="fw-lighter text-end align-middle">Hardware vendor</td>\n              <td class="fw-light text-break">\n                <div class="input-group">\n                  <select class="form-select fw-light fs-6" id="processor_vendor">\n                    <option selected>Choose...</option>\n                    \n                    ','\n                  </select>\n                </div>\n              </td> \n            </tr>\n            <tr>\n              <td class="fw-lighter text-end align-middle">Service Session</td>\n              <td class="fw-light text-break">\n                <div class="input-group">\n                  <select class="form-select fw-light fs-6" id="processor_session_id">\n                    <option selected>Choose...</option>\n                    ','\n                  </select>\n                </div>\n              </td> \n            </tr>\n            <tr>\n              <td class="fw-lighter text-end border-bottom-0">metadata</td>\n              <td class="fw-light text-break border-bottom-0">\n                <textarea class="form-control fw-light fs-6" id="processor_metadata" rows="3" placeholder="e.g. configuration.."></textarea>\n              </td> \n            </tr>\n          </tbody>\n        </table>\n      </div>\n      <div class="modal-footer">\n        <button class="btn btn-secondary btn-sm" @click="','">Create</button>                          \n      </div>\n    </div>\n  </div>\n</div>'])),this.inori.tenant.get_vendors().map(function(e){return W(_w||(_w=Rw(['<option value="','">',"</option>"])),e.id,e.name)}),this.inori.tenant.get_active_tenants_owned_by_current_session().map(function(t){var n=e.inori.tenant.get_tenant_role_by_session_id(t.sessionId);return W(bw||(bw=Rw(['<option value="','">'," (",")</option>"])),t.sessionId,t.sessionId,n)}),function(){var t=Ow(Pw().m(function t(n){var r,i,s,a;return Pw().w(function(t){for(;;)switch(t.n){case 0:return r=e.renderRoot.querySelector("#processor_vendor"),i=e.renderRoot.querySelector("#processor_session_id"),s=e.renderRoot.querySelector("#processor_metadata"),e.renderRoot.querySelector("#modelProcessorCreation"),(a=e.inori.tenant.add_processor("".concat(r.selectedOptions[0].label.toLowerCase(),"_").concat(s.value.toLowerCase().replace(" ","_")))).dat.vendor=parseInt(r.value),a.dat.metadata=s.value,a.dat.sessionId=i.value,t.n=1,a.self_register();case 1:e.requestUpdate(),e.processorCreationModel.hide(),e.processorCreationModel=!1;case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"renderMsgModel",value:function(){var e=this;return W(yw||(yw=Rw(['\n<div class="modal fade" id="modelMessageHistory" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h1 class="modal-title fs-5" id="staticBackdropLabel">Messaging</h1>\n        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n      </div>\n      <div class="modal-body"> \n        <div class="mb-3">\n          <label for="localIncoming" class="form-label">Message in</label>\n          <textarea class="form-control form-control-sm" rows="3" id="localIncoming" style="height: 100px" readonly placeholder="incoming messages arrive here."></textarea>\n        </div>\n        <div class="mb-3">\n          <label for="localOutgoing" class="form-label">Message out</label>\n          <textarea class="form-control form-control-sm" rows="3" id="localOutgoing" style="height: 100px" placeholder="outgoing message goes here."></textarea>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button class="btn btn-secondary btn-sm" ?disabled="','" @click="','" id="sendLocal">Send</button>                                    \n      </div>\n    </div>\n  </div>\n</div> '])),!e.connected,e._sendMessage.bind(e,"#localOutgoing",e.processorInfo.dataChannel))}},{key:"renderProcessorPaging",value:function(e,t){for(var n=this,r=Math.ceil(e/t),i=10,s=[],a=function(e){s.push(W(Ew||(Ew=Rw(["",""])),n.processorPageIndex==e?W(Cw||(Cw=Rw(['<li class="page-item active" aria-current="page"><span class="page-link">',"</span></li>"])),n.processorPageIndex):W(Aw||(Aw=Rw(['<li class="page-item"><a class="page-link" href="#" @click="','">',"</a></li>"])),function(t){t.preventDefault(),n.processorPageIndex=e},e)))},o=n.startBrowsePageIndex;o<=r&&o<n.startBrowsePageIndex+i;o++)a(o);return s.push(W(ww||(ww=Rw(['<li class="page-item" aria-current="page"><a class="page-link" href="#" @click="','">\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-double-right" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708"/>\n  <path fill-rule="evenodd" d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708"/>\n</svg></a></li>'])),function(e){e.preventDefault();var t=n.inori.tenant.get_subscription(n.sessionId);null==t||t.req_processors(r+1);var s=Math.ceil(n.processorPageIndex/i)*i+1;s+i<=r?(n.processorPageIndex=s,n.startBrowsePageIndex=s):(n.processorPageIndex=Math.floor(r/i)*i+1,n.startBrowsePageIndex=n.processorPageIndex)})),s.unshift(W(Sw||(Sw=Rw(['<li class="page-item','" aria-current="page"><a class="page-link" href="#" @click="','">\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-double-left" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>\n  <path fill-rule="evenodd" d="M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>\n</svg></a></li>'])),1==n.startBrowsePageIndex?" disabled":"",function(e){e.preventDefault(),n.startBrowsePageIndex>i?(n.startBrowsePageIndex=n.startBrowsePageIndex-i,n.processorPageIndex=n.startBrowsePageIndex):(n.startBrowsePageIndex=1,n.processorPageIndex=1)})),W(xw||(xw=Rw(['\n<nav aria-label="Page navigation example">\n  <ul class="pagination pagination-sm justify-content-start">\n  <li class="page-item"><a class="page-link" href="#" @click="','">\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-bar-left" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M11.854 3.646a.5.5 0 0 1 0 .708L8.207 8l3.647 3.646a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 0 1 .708 0M4.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 1 0v-13a.5.5 0 0 0-.5-.5"/>\n</svg></a></li>\n    ','\n  <li class="page-item"><a class="page-link" href="#" @click="','">\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-bar-right" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M4.146 3.646a.5.5 0 0 0 0 .708L7.793 8l-3.647 3.646a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708 0M11.5 1a.5.5 0 0 1 .5.5v13a.5.5 0 0 1-1 0v-13a.5.5 0 0 1 .5-.5"/>\n</svg></a></li>\n  </ul>\n</nav>'])),function(e){e.preventDefault(),n.processorPageIndex=1,n.startBrowsePageIndex=n.processorPageIndex},s,function(e){e.preventDefault(),n.processorPageIndex=r;var t=Math.floor(n.processorPageIndex/i)*i+1;n.startBrowsePageIndex=t;var s=n.inori.tenant.get_subscription(n.sessionId);null==s||s.req_processors(r+1)})}},{key:"render",value:function(){var e=this.inori.env.content.getL2();return W(Mw||(Mw=Rw(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <p class="card-text">',"</p>\n  ","\n  ","   \n</main>"])),this.inori.env.content.get(),e,this.renderActiveDeviceList(),this.renderProcessorCreationModel())}}],[{key:"properties",get:function(){return{connected:{type:Boolean},clicked:{type:Boolean},inori:{type:Object},processorInfo:{type:Object},remoteProcessorList:{type:Object},iceOffer:{type:Object},localMediaStream:{type:Object},sessionId:{type:String},predictionDetail:{type:Object},trainerModels:{type:Object},processorPageIndex:{type:Number},startBrowsePageIndex:{type:Number}}}}]);var n,r,i,s,a,o,l}(ce);function sS(e){return sS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sS(e)}function aS(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function oS(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return lS(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(lS(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,lS(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,lS(h,"constructor",c),lS(c,"constructor",l),l.displayName="GeneratorFunction",lS(c,i,"GeneratorFunction"),lS(h),lS(h,i,"Generator"),lS(h,r,function(){return this}),lS(h,"toString",function(){return"[object Generator]"}),(oS=function(){return{w:s,m:d}})()}function lS(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}lS=function(e,t,n,r){function s(t,n){lS(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},lS(e,t,n,r)}function cS(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function uS(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,hS(r.key),r)}}function hS(e){var t=function(e){if("object"!=sS(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=sS(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==sS(t)?t:t+""}function dS(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(dS=function(){return!!e})()}function fS(e){return fS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fS(e)}function pS(e,t){return pS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pS(e,t)}customElements.define("streaming-services",iS);var mS,gS,vS,_S,bS,yS,wS,SS,xS=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=fS(t),function(e,t){if(t&&("object"==sS(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,dS()?Reflect.construct(t,n||[],fS(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.leads=null,e.audioSessionId="",e.audio=new Audio,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pS(e,t)}(t,e),function(e,t,n){return t&&uS(e.prototype,t),n&&uS(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){cS(s,r,i,a,o,"next",e)}function o(e){cS(s,r,i,a,o,"throw",e)}a(void 0)})}}(oS().m(function e(){return oS().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"renderL2Default",value:function(e){return W(zw||(zw=aS([""])))}},{key:"renderSFDC",value:function(e){var t=this,n=this;return W(Vw||(Vw=aS(["\n      ",""])),this.leads.list.length>0?W(Gw||(Gw=aS(['\n      <table class="table table-hover">\n        <thead>\n          <tr>',"\n          </tr>\n        </thead>\n        <tbody>","     \n        </tbody>\n      <table>\n        "])),Object.entries(this.leads.list[0]).map(function(e){if("fragmentNum"!=e[0])return W(Ww||(Ww=aS(['\n            <th class="fw-lighter" scope="col">',"</th>\n            "])),e[0])}),this.leads.list.map(function(r){if(!(r.fragmentNum.length<1))return W(qw||(qw=aS(["\n          <tr>",'\n          </tr>\n          <tr>\n            <td colspan="','" class="border-0 p-0">\n              <div class="h6 m-3">Recording List</div>\n              <table class="table mb-0">\n                <thead>\n                  <tr>                  \n                    <th class="fw-lighter" scope="col"></th>\n                    <th class="fw-lighter ps-3" scope="col">fragmentNum</th>\n                  </tr>\n                </thead>\n                <tbody>',"\n                </tbody>\n              </table>\n            </td>\n          </tr>          \n          "])),Object.entries(r).map(function(t){if("fragmentNum"!=t[0])return"sfdcSobjId"==t[0]?W(Kw||(Kw=aS(['\n              <td class="fw-light text-break">\n                <a role="button" class="active" target="_blank" href="','">',"</a>\n              </td>\n              "])),"".concat(e[2],"/lightning/r/Lead/").concat(t[1],"/view"),t[1]):W($w||($w=aS(['\n            <td class="fw-light text-break">',"</td>\n              "])),t[1])}),Object.keys(r).length-1,r.fragmentNum.map(function(e,i){return W(Xw||(Xw=aS(['\n                  <tr>\n                    <td class="pt-3 text-sm-end">\n                      <a class="btn btn-link btn-sm py-0 fw-normal" @click="','">','\n                      </a></td>\n                    <td class="text-sm-begin pt-3 ps-3 fw-light text-break">',"</td>\n                  </tr>\n                  "])),function(i){if(""==n.audioSessionId){n.audio.addEventListener("loadedmetadata",function(){t.duration=n.audio.duration}),n.audio.addEventListener("ended",function(e){n.audioSessionId="",n.requestUpdate()});var s="/v1/voicemails/".concat(r.contactId,"/").concat(e);n.inori.util.dbg(s),n.audio.type="audio/mpeg",n.audio.src=s,n.audio.play(),t.duration=0,n.audioSessionId=e}else n.audio.pause(),n.audioSessionId="";n.requestUpdate()},""==n.audioSessionId?W(Yw||(Yw=aS(['\n                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-circle" viewBox="0 0 16 16">\n                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                          <path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445"/>\n                        </svg>']))):W(Zw||(Zw=aS(['\n                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause-circle" viewBox="0 0 16 16">\n                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                          <path d="M5 6.25a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0zm3.5 0a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0z"/>\n                        </svg>']))),e)}))})):W(Jw||(Jw=aS([""]))))}},{key:"renderL2Content",value:function(){var e=this,t=this.inori.env.content.getL1(),n=this.inori.env.content.getL2();return W(Qw||(Qw=aS(["    \n      ",""])),n&&n.length>1?W(eS||(eS=aS(['\n      <h5 class="card-title">','</h5>\n      <p class="card-text">',"</p>\n      ","\n      "])),n[0],n[1],function(t){return"SFDC"===t?e.renderSFDC(n):e.renderL2Default(n)}(t)):W(tS||(tS=aS([""]))))}},{key:"render",value:function(){var e=this;return W(nS||(nS=aS(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <div class="card">\n    <div class="card-header">\n      <ul class="nav nav-pills card-header-pills">\n      ','\n      </ul>\n    </div>\n    <div class="card-body">\n      ',"\n    </div>\n  </div>\n</main>"])),this.inori.env.content.get(),this.inori.env.content.getAllL1().map(function(t,n){return e.inori.env.content.getL2(n),W(rS||(rS=aS(['\n        <li class="nav-item">\n          <a class="nav-link','" role="button" @click="','">',"</a>\n        </li>\n        "])),n==e.inori.env.content.getL1Index()?" active":"",function(t){e.inori.env.content.setL1Index(n),e.requestUpdate()},t)}),this.renderL2Content())}}],[{key:"properties",get:function(){return{inori:{type:Object},leads:{type:Object}}}}]);var n}(ce);function ES(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function CS(e){return CS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CS(e)}function AS(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,RS(r.key),r)}}function MS(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(MS=function(){return!!e})()}function kS(e){return kS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kS(e)}function TS(e,t){return TS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},TS(e,t)}function RS(e){var t=function(e){if("object"!=CS(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=CS(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==CS(t)?t:t+""}customElements.define("streaming-providers",xS);var PS,IS,DS,OS,LS=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=kS(t),function(e,t){if(t&&("object"==CS(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,MS()?Reflect.construct(t,n||[],kS(e).constructor):t.apply(e,n))}(this,t)).data={},e.collaps=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TS(e,t)}(t,e),function(e,t,n){return t&&AS(e.prototype,t),n&&AS(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"toggleCollapse",value:function(e){if(e.target===e.currentTarget){var t=e.target,n=e.target.querySelector(".content");"block"===n.style.display?(t.style.backgroundImage="url(./img/plus-square.svg)",n.style.display="none"):(t.style.backgroundImage="url(./img/dash-square.svg)",n.style.display="block")}}},{key:"renderTree",value:function(e){var t=this,n=this;return"object"!==CS(e)||null===e||Array.isArray(e)?Array.isArray(e)?W(vS||(vS=ES(['\n      <ul class="hc-css" @click="','">\n        ',"\n      </ul>"])),this.toggleCollapse,e.map(function(e,r){return W(_S||(_S=ES(['\n        <li class="hc-css" style="background-image: url(./img/',') !important;" @click="','">\n            <div class="hc-css ','">','</div>\n            <div class="hc-css content" style="display: ',';">',"</div>\n        </li>\n        "])),n.collaps?"plus-square.svg":"dash-square.svg",t.toggleCollapse,n.collaps?"collapsible":"",r,n.collaps?"none":"block",t.renderTree(e))})):e?W(yS||(yS=ES(['\n      <ul class="hc-css">\n        <li class="hc-css" style="background-image: url(./img/arrow-return-right.svg); cursor: default;">         \n            <div class="hc-css content-detail">',"</div>        \n        </li>\n      </ul>"])),e):W(bS||(bS=ES([""]))):W(mS||(mS=ES(['\n      <ul class="hc-css">\n        ',"\n      </ul>"])),Object.keys(e).map(function(r){return W(gS||(gS=ES(['\n        <li class="hc-css" style="background-image: url(./img/',') !important;" @click="','"> \n            <div class="hc-css ','">','</div>\n            <div class="hc-css content" style="display: ',';">',"</div>        \n        </li>\n        "])),n.collaps?"plus-square.svg":"dash-square.svg",t.toggleCollapse,n.collaps?"collapsible":"",r,n.collaps?"none":"block",t.renderTree(e[r]))}))}},{key:"render",value:function(){return W(wS||(wS=ES(["",""])),this.renderTree(this.data))}}],[{key:"properties",get:function(){return{data:{type:Object},collaps:{type:Boolean}}}}])}(ce);function BS(e){return BS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},BS(e)}function NS(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function US(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return HS(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(HS(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,HS(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,HS(h,"constructor",c),HS(c,"constructor",l),l.displayName="GeneratorFunction",HS(c,i,"GeneratorFunction"),HS(h),HS(h,i,"Generator"),HS(h,r,function(){return this}),HS(h,"toString",function(){return"[object Generator]"}),(US=function(){return{w:s,m:d}})()}function HS(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}HS=function(e,t,n,r){function s(t,n){HS(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},HS(e,t,n,r)}function jS(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function zS(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){jS(s,r,i,a,o,"next",e)}function o(e){jS(s,r,i,a,o,"throw",e)}a(void 0)})}}function VS(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,GS(r.key),r)}}function GS(e){var t=function(e){if("object"!=BS(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=BS(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==BS(t)?t:t+""}function WS(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(WS=function(){return!!e})()}function qS(e){return qS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qS(e)}function KS(e,t){return KS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},KS(e,t)}!function(e,t,n){(t=RS(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(LS,"styles",o(SS||(SS=ES(["\n    ul.hc-css {\n      list-style-type: none;\n      padding-left: 0px;\n    }\n    li.hc-css {\n      background-image: url(./img/plus-square.svg);\n      background-repeat: no-repeat;\n      background-position: 0px 5px;\n      padding-left: 20px;\n      margin: 4px 0;      \n      cursor: pointer;\n    }\n    .hc-css .collapsible {\n      cursor: default;\n      padding: 2px 0 0 0;\n      border: none;\n      text-align: left;\n      outline: none;\n      font-size: 15px;\n    }\n    .hc-css .content {\n      overflow: hidden;\n    }\n    .hc-css .content-detail {\n      cursor: default;\n      padding: 2px 0 0 0;\n      border: none;\n      text-align: left;\n      outline: none;\n      font-size: 15px;\n    }\n  "])))),customElements.define("streaming-json-modal",LS);var $S=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=qS(t),function(e,t){if(t&&("object"==BS(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,WS()?Reflect.construct(t,n||[],qS(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.trainerModels=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KS(e,t)}(t,e),function(e,t,n){return t&&VS(e.prototype,t),n&&VS(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=zS(US().m(function e(){return US().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.inori.util.get_trainer_models();case 1:return this.trainerModels=e.v,e.n=2,this.updateComplete;case 2:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this;if(!this.trainerModels)return W(PS||(PS=NS([""])));var t=this;return W(IS||(IS=NS(['<div class="row row-cols-1 row-cols-md-3 g-4">',"</div>"])),this.trainerModels.map(function(n){return W(DS||(DS=NS(['\n<div class="col"><div class="card text-bg-light mb-3">\n  <div class="card-header fw-lighter">','</div>\n  <div class="card-body">\n    <h5 class="card-title">','</h5>\n    <p class="card-text"><streaming-json-modal .data="','"></streaming-json-modal></p>    \n    <a class="btn btn-secondary btn-sm" role="button" @click="','">Remove</a>\n  </div>\n</div></div>'])),n.tid,n.format,n.modelTopology,function(){var r=zS(US().m(function r(i){return US().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,t.inori.util.del_trainer_file(n.tid);case 1:return r.n=2,e.inori.util.get_trainer_models();case 2:t.trainerModels=r.v,t.requestUpdate();case 3:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}())}))}},{key:"render",value:function(){return W(OS||(OS=NS(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">',"</h4>\n  ","\n</main>"])),this.inori.env.content.get(),this.renderModels())}}],[{key:"properties",get:function(){return{inori:{type:Object},trainerModels:{type:Object}}}}]);var n}(ce);customElements.define("streaming-training",$S);var XS,YS=r(856),ZS=r(616);function JS(e){return JS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},JS(e)}function QS(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return ex(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(ex(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ex(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,ex(h,"constructor",c),ex(c,"constructor",l),l.displayName="GeneratorFunction",ex(c,i,"GeneratorFunction"),ex(h),ex(h,i,"Generator"),ex(h,r,function(){return this}),ex(h,"toString",function(){return"[object Generator]"}),(QS=function(){return{w:s,m:d}})()}function ex(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}ex=function(e,t,n,r){function s(t,n){ex(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},ex(e,t,n,r)}function tx(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function nx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rx(r.key),r)}}function rx(e){var t=function(e){if("object"!=JS(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=JS(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==JS(t)?t:t+""}function ix(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ix=function(){return!!e})()}function sx(e){return sx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},sx(e)}function ax(e,t){return ax=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ax(e,t)}var ox,lx,cx,ux,hx,dx,fx,px,mx,gx,vx,_x,bx,yx,wx,Sx,xx,Ex,Cx,Ax,Mx,kx,Tx,Rx,Px,Ix,Dx,Ox,Lx=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=sx(t),function(e,t){if(t&&("object"==JS(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ix()?Reflect.construct(t,n||[],sx(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.term=new YS.Terminal,e.fitAddon=new ZS.FitAddon,e.processorInfo=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ax(e,t)}(t,e),function(e,t,n){return t&&nx(e.prototype,t),n&&nx(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){tx(s,r,i,a,o,"next",e)}function o(e){tx(s,r,i,a,o,"throw",e)}a(void 0)})}}(QS().m(function e(){var t;return QS().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return t=this.renderRoot.querySelector("#terminal"),this.term.loadAddon(this.fitAddon),this.term.open(t),this.fitAddon.fit(),this.term.write("Hello from [1;3;31mxterm.js[0m $ "),e.n=2,this.updateComplete;case 2:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"terminal_setup",value:function(){var e=this;if(this.processorInfo!=nil){var t=this.inori.tenant.get_subscription(this.processorInfo.dat.remoteId);t.onTerminalSignal=function(t){e.term.write(t.data)},this.term.onData(function(e){t.send(e)})}}},{key:"render",value:function(){return W(XS||(XS=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <div class="row align-items-start"">\n      <div id="terminal" class="col-11 bg-black d-flex justify-content-center m-2 p-2 rounded"></div>\n    \n  </div>  \n</main>'])),this.inori.env.content.get())}}],[{key:"properties",get:function(){return{inori:{type:Object},trainerModels:{type:Object}}}}]);var n}(ce);function Bx(e){return Bx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bx(e)}function Nx(e){return function(e){if(Array.isArray(e))return Ux(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ux(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ux(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ux(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Hx(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Fx(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return jx(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(jx(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,jx(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,jx(h,"constructor",c),jx(c,"constructor",l),l.displayName="GeneratorFunction",jx(c,i,"GeneratorFunction"),jx(h),jx(h,i,"Generator"),jx(h,r,function(){return this}),jx(h,"toString",function(){return"[object Generator]"}),(Fx=function(){return{w:s,m:d}})()}function jx(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}jx=function(e,t,n,r){function s(t,n){jx(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},jx(e,t,n,r)}function zx(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function Vx(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){zx(s,r,i,a,o,"next",e)}function o(e){zx(s,r,i,a,o,"throw",e)}a(void 0)})}}function Gx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Wx(r.key),r)}}function Wx(e){var t=function(e){if("object"!=Bx(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Bx(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Bx(t)?t:t+""}function qx(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(qx=function(){return!!e})()}function Kx(e){return Kx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Kx(e)}function $x(e,t){return $x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$x(e,t)}customElements.define("streaming-terminal",Lx);var Xx,Yx=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=Kx(t),function(e,t){if(t&&("object"==Bx(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,qx()?Reflect.construct(t,n||[],Kx(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.token="",e.fileInfo={},e._local_pkey={},e._local_cert={},e.cert_obj=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$x(e,t)}(t,e),function(e,t,n){return t&&Gx(e.prototype,t),n&&Gx(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori}},{key:"_loggedInHandler",value:(n=Vx(Fx().m(function e(){return Fx().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"renderLicenseTab",value:function(e){var t=this,n=(t.inori.tenant.subject(),this.inori.util.dir.info()),r=function(e){var t=document.createElement("input");t.type="file",t.addEventListener("change",function(t){i(t,e)}),t.click()},i=function(){var e=Vx(Fx().m(function e(t,n){var r;return Fx().w(function(e){for(;;)switch(e.n){case 0:(r=t.target.files[0])&&n(r);case 1:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}();return W(ox||(ox=Hx(['\n    <div class="mb-3">\n      <a class="fw-light" role="button" @click="','">Import Private Key</a> ','\n    </div>\n    <div class="mb-3">\n      <a class="fw-light" role="button" @click="','">Import License</a> ','\n    </div>\n    <div class="mt-5">\n      <a class="btn btn-secondary btn-sm" role="button" @click="','">Apply Now</a>\n    </div>\n    '])),function(e){r(function(){var e=Vx(Fx().m(function e(r){var i,s;return Fx().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.util.read_blob_2_str(r);case 1:if(i=e.v,!(s=t.inori.util.parse_pvtkey_str(i))){e.n=3;break}return e.n=2,t.inori.util.write_blob_2_file(s.asBlob(),n.dir.tmp_pkey);case 2:e.v&&(t._local_pkey.name=r.name,t.requestUpdate());case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())},t._local_pkey.name?W(lx||(lx=Hx(["[","]"])),t._local_pkey.name):W(cx||(cx=Hx([""]))),function(e){r(function(){var e=Vx(Fx().m(function e(r){var i,s;return Fx().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.util.read_blob_2_str(r);case 1:if(i=e.v,!(s=t.inori.util.parse_cert_str(i))){e.n=3;break}return e.n=2,t.inori.util.write_blob_2_file(s.asBlob(),n.dir.tmp_cert);case 2:e.v&&(t._local_cert.name=r.name,t.requestUpdate());case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())},t._local_cert.name?W(ux||(ux=Hx(["[","]"])),t._local_cert.name):W(hx||(hx=Hx([""]))),function(){var e=Vx(Fx().m(function e(n){return Fx().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.util.replace_keypair();case 1:t.dispatchEvent(new CustomEvent("exiting-session-event",{}));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"renderNewBridge",value:function(){var e=this,t=this.inori.util.dir.info();return W(dx||(dx=Hx(['\n    <div class="col-5">\n        <div class="card text-bg-light mb-3 mx-2 px-0">\n          <div class="card-header">Deployable Bridge</div>\n          <div class="card-body">\n            <h5 class="card-title">new bridge</h5>\n            <p>\n              <a class="btn p-0" role="button" @click="','">Bootstrap New Bridge Instance</a>\n            </p>\n          ',"\n          </div>\n        </div>\n      </div>"])),function(){var t=Vx(Fx().m(function t(n){return Fx().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e.inori.util.bootstrap_bridge_keypairs();case 1:t.v,e.requestUpdate();case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),["bridge_pkey","bridge_cert","admin_pkey","admin_cert"].map(function(n){return t.sum[n]?W(px||(px=Hx(['\n            <p class="text-truncate fw-lighter">\n              <a class="btn m-0 p-0" @click="','">               \n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-arrow-down" viewBox="0 0 16 16">\n                  <path fill-rule="evenodd" d="M7.646 10.854a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 9.293V5.5a.5.5 0 0 0-1 0v3.793L6.354 8.146a.5.5 0 1 0-.708.708z"/>\n                  <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>              \n                </svg>\n              </a>\n              '," \n              ","\n            </p>"])),function(t){n.includes("cert")?e.inori.util.download_cert(n):e.inori.util.download_pkey(n)},t.desc[n],n.includes("cert")?W(mx||(mx=Hx(['\n              <a class="btn m-0 p-0" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-view-list" viewBox="0 0 16 16">\n                  <path d="M3 4.5h10a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2m0 1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zM1 2a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 2m0 12a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 14"/>\n                </svg>\n              </a>\n              ',"\n              "])),function(){var t=Vx(Fx().m(function t(r){return Fx().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e.inori.util.get_sbj_by_key(n);case 1:e.cert_obj=t.v,e.requestUpdate(),Nx(document.querySelectorAll(".toast")).map(function(e){var t=new bootstrap.Toast(e,{});e.classList.contains("".concat(n,"_toast"))?t.show():t.hide()});case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),e.cert_obj?W(gx||(gx=Hx(['\n              <div class="toast ','_toast" role="alert" aria-live="assertive" aria-atomic="true">\n                <div class="toast-header">\n                  <strong class="me-auto">','</strong>\n                  <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n                <div class="toast-body">       \n                  <p class="text-truncate fw-lighter my-1">sn: ','</p>\n                  <p class="text-truncate fw-lighter">sha256: ',']</p>\n                  <streaming-json-modal .collaps="','" .data="','"></streaming-json-modal>\n                </div>\n              </div>'])),n,t.desc[n],e.cert_obj.serialnumber.val,t.sum[n],!0,e.cert_obj):W(vx||(vx=Hx([""])))):W(_x||(_x=Hx([""])))):W(fx||(fx=Hx([""])))}))}},{key:"renderBridgeTab",value:function(e){var t=this,n=t.inori.env.bridge_sbj();return W(bx||(bx=Hx(['\n    <div class="row justify-content-center">\n      ','\n      <div class="col-5">\n        <div class="card text-bg-light mb-3 mx-2 px-0">\n          <div class="card-header">Active Bridge</div>\n          <div class="card-body">\n            <h5 class="card-title">','</h5>\n            <p class="text-truncate fw-lighter my-1">active_id: ','</p>\n            <p class="text-truncate fw-lighter my-1">sn: ','</p>\n            <p class="text-truncate fw-lighter my-1">sha256: ','</p>              \n            <streaming-json-modal .collaps="','" .data="','"></streaming-json-modal>\n          </div>\n        </div>\n      </div>\n    </div>    \n    '])),t.renderNewBridge(),n.tname&&n.tname.val||n.tid&&n.tid.val,t.inori.env.bridge_id(),n.serialnumber.val,t.inori.util.dir.info().sum.ca_cert,!0,n)}},{key:"renderTokenTab",value:function(e){var t=this;return W(yx||(yx=Hx(['\n    <div class="mb-3">\n      <a class="fw-light" role="button" @click="','">Generate Hashed Token</a>\n    </div>    \n    <div class="mb-3">\n      <textarea class="form-control fw-lighter fs-6" placeholder="The token is displayed here" id="floatingTextarea2Disabled" style="height: 150px" disabled>',"</textarea>\n    </div>\n    "])),function(){var e=Vx(Fx().m(function e(n){return Fx().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.tenant.get_tkn();case 1:t.token=e.v,t.requestUpdate();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),this.token)}},{key:"renderX509Tab",value:function(e){var t=this,n=t.inori.tenant.subject(),r=t.inori.tenant.dataType().Role.values,i=t.inori.tenant.dataType().Plan.values;return W(wx||(wx=Hx(['\n    <div class="row">\n      <div class="col col-sm-3 mb-3">\n        <a class="fw-light" role="button" @click="','">Download Private Key</a>\n      </div>\n      <div class="col col-sm-3 mb-3 text-truncate fw-lighter">\n        sha256sum:','\n      </div>\n      <div class="w-100"></div>\n      <div class="col col-sm-3 mb-3">\n        <a class="fw-light" role="button" @click="','">Download License</a>\n      </div>\n      <div class="col col-sm-3 mb-3 text-truncate fw-lighter">\n        sha256sum:','\n      </div>\n      <div class="w-100"></div>\n    </div>    \n    <form @submit="','">\n    ','\n      <div class="mb-3">\n        <button type="submit" class="btn btn-sm btn-secondary" role="button">Update</button>\n      </div>\n    </form>\n    '])),function(e){t.inori.util.download_pkey("pkey")},t.inori.util.dir.info().sum.pkey,function(e){t.inori.util.download_cert("cert")},t.inori.util.dir.info().sum.cert,function(){var e=Vx(Fx().m(function e(n){var r,i;return Fx().w(function(e){for(;;)switch(e.n){case 0:return n.preventDefault(),r=new FormData(n.target),i=Object.fromEntries(r),e.n=1,t.inori.tenant.upd_x509_sbj(i);case 1:e.v;case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),Object.keys(n).map(function(e){var t=n[e];return"tenantRole"==t.proto?W(Sx||(Sx=Hx(['\n      <div class="mb-3">\n        <label for="input-','" class="form-label">','</label>\n        <select class="form-select" id="input-','" name="','">\n            ',"\n        </select>\n      </div>"])),e,t.desc,e,t.proto,Object.keys(r).map(function(e){return e==t.val?W(xx||(xx=Hx(['\n          <option value="','" selected>',"</option>"])),e,e):W(Ex||(Ex=Hx(['\n          <option value="','">',"</option>"])),e,e)})):"tenantPlan"==t.proto?W(Cx||(Cx=Hx(['\n      <div class="mb-3">\n        <label for="input-','" class="form-label">','</label>\n        <select class="form-select" id="input-','" name="','">\n            ',"\n        </select>\n      </div>"])),e,t.desc,e,t.proto,Object.keys(i).map(function(e){return e==t.val?W(Ax||(Ax=Hx(['\n          <option value="','" selected>',"</option>"])),e,e):W(Mx||(Mx=Hx(['\n          <option value="','">',"</option>"])),e,e)})):W(kx||(kx=Hx(['\n      <div class="mb-3">\n        <label for="input-','" class="form-label">','</label>\n        <input type="text" class="form-control" id="input-','" name="','" placeholder="','" value="','">\n      </div>'])),e,t.desc,e,t.proto,t.val,t.val)}))}},{key:"renderL2Content",value:function(){var e=this,t=this.inori.env.content.getL1(),n=this.inori.env.content.getL2();return W(Rx||(Rx=Hx(["    \n      ",""])),n&&n.length>1?W(Px||(Px=Hx(['\n      <h5 class="card-title">','</h5>\n      <p class="card-text">',"</p>\n      ","\n      "])),n[0],n[1],function(t){switch(t.toLowerCase()){case"x509":return e.renderX509Tab(n);case"token":return e.renderTokenTab(n);case"bridge":return e.renderBridgeTab(n);case"license":return e.renderLicenseTab(n);default:return W(Tx||(Tx=Hx([""])))}}(t)):W(Ix||(Ix=Hx([""]))))}},{key:"render",value:function(){var e=this;return W(Dx||(Dx=Hx(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n    <div class="card">\n      <div class="card-header">\n        <ul class="nav nav-pills card-header-pills">\n        ','\n        </ul>\n      </div>\n      <div class="card-body">\n        ',"\n      </div>\n    </div>    \n</main>"])),this.inori.env.content.get(),this.inori.env.content.getAllL1().map(function(t,n){return W(Ox||(Ox=Hx(['\n          <li class="nav-item">\n            <a class="nav-link','" role="button" @click="','">',"</a>\n          </li>\n          "])),n==e.inori.env.content.getL1Index()?" active":"",function(t){e.inori.env.content.setL1Index(n),e.requestUpdate()},t)}),this.renderL2Content())}}],[{key:"properties",get:function(){return{inori:{type:Object}}}}]);var n}(ce);function Zx(e){return Zx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zx(e)}function Jx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Qx(r.key),r)}}function Qx(e){var t=function(e){if("object"!=Zx(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Zx(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Zx(t)?t:t+""}function eE(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(eE=function(){return!!e})()}function tE(e){return tE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tE(e)}function nE(e,t){return nE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nE(e,t)}customElements.define("streaming-setting",Yx);var rE=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=tE(t),function(e,t){if(t&&("object"==Zx(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,eE()?Reflect.construct(t,n||[],tE(e).constructor):t.apply(e,n))}(this,t)).title="",e.rev="",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nE(e,t)}(t,e),function(e,t,n){return t&&Jx(e.prototype,t),n&&Jx(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"render",value:function(){return W(Xx||(Xx=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n        <main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n            <h4 class="card-title mb-4">','</h4>\n            <div class="ratio ratio-1x1">\n               <iframe class="','" src="https://api.hiddenclouds.io/v0/index"></iframe>\n               <iframe class="','" src="https://api.hiddenclouds.io/v1/index"></iframe>\n            </div>\n        </main>'])),this.title,"v0"==this.rev?"visible":"invisible","v1"==this.rev?"visible":"invisible")}}],[{key:"properties",get:function(){return{rev:{type:String},title:{type:String}}}}])}(ce);customElements.define("streaming-api",rE);const iE="167",sE=0,aE=1,oE=2,lE=100,cE=101,uE=102,hE=200,dE=201,fE=202,pE=203,mE=204,gE=205,vE=206,_E=207,bE=208,yE=209,wE=210,SE=211,xE=212,EE=213,CE=214,AE="attached",ME=301,kE=302,TE=306,RE=1e3,PE=1001,IE=1002,DE=1003,OE=1004,LE=1005,BE=1006,NE=1007,UE=1008,HE=1009,FE=1012,jE=1013,zE=1014,VE=1015,GE=1016,WE=1017,qE=1018,KE=1020,$E=1023,XE=1026,YE=1027,ZE=1028,JE=1029,QE=1031,eC=1033,tC=33776,nC=33777,rC=33778,iC=33779,sC=35840,aC=35841,oC=35842,lC=35843,cC=36196,uC=37492,hC=37496,dC=37808,fC=37809,pC=37810,mC=37811,gC=37812,vC=37813,_C=37814,bC=37815,yC=37816,wC=37817,SC=37818,xC=37819,EC=37820,CC=37821,AC=36492,MC=36494,kC=36495,TC=36284,RC=36285,PC=36286,IC=2300,DC=2301,OC=2302,LC="",BC="srgb",NC="srgb-linear",UC="display-p3",HC="display-p3-linear",FC="linear",jC="srgb",zC="rec709",VC="p3",GC=7680,WC=512,qC=513,KC=514,$C=515,XC=516,YC=517,ZC=518,JC=519,QC=35044,eA="300 es",tA=2e3,nA=2001;class rA{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const iA=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const sA=Math.PI/180,aA=180/Math.PI;function oA(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(iA[255&e]+iA[e>>8&255]+iA[e>>16&255]+iA[e>>24&255]+"-"+iA[255&t]+iA[t>>8&255]+"-"+iA[t>>16&15|64]+iA[t>>24&255]+"-"+iA[63&n|128]+iA[n>>8&255]+"-"+iA[n>>16&255]+iA[n>>24&255]+iA[255&r]+iA[r>>8&255]+iA[r>>16&255]+iA[r>>24&255]).toLowerCase()}function lA(e,t,n){return Math.max(t,Math.min(n,e))}function cA(e,t){return(e%t+t)%t}function uA(e,t,n){return(1-n)*e+n*t}function hA(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function dA(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const fA=sA,pA=function(e){return e*aA};class mA{constructor(e=0,t=0){mA.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(lA(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*n-s*r+e.x,this.y=i*r+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class gA{constructor(e,t,n,r,i,s,a,o,l){gA.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,s,a,o,l)}set(e,t,n,r,i,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=i,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],f=n[8],p=r[0],m=r[3],g=r[6],v=r[1],_=r[4],b=r[7],y=r[2],w=r[5],S=r[8];return i[0]=s*p+a*v+o*y,i[3]=s*m+a*_+o*w,i[6]=s*g+a*b+o*S,i[1]=l*p+c*v+u*y,i[4]=l*m+c*_+u*w,i[7]=l*g+c*b+u*S,i[2]=h*p+d*v+f*y,i[5]=h*m+d*_+f*w,i[8]=h*g+d*b+f*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*i*c+n*a*o+r*i*l-r*s*o}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*i,d=l*i-s*o,f=t*u+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(a*n-r*s)*p,e[3]=h*p,e[4]=(c*t-r*o)*p,e[5]=(r*i-a*t)*p,e[6]=d*p,e[7]=(n*o-l*t)*p,e[8]=(s*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,s,a){const o=Math.cos(i),l=Math.sin(i);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(vA.makeScale(e,t)),this}rotate(e){return this.premultiply(vA.makeRotation(-e)),this}translate(e,t){return this.premultiply(vA.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const vA=new gA;function _A(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function bA(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function yA(){const e=bA("canvas");return e.style.display="block",e}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const wA={};function SA(e){e in wA||(wA[e]=!0,console.warn(e))}const xA=(new gA).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),EA=(new gA).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),CA={[NC]:{transfer:FC,primaries:zC,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e,fromReference:e=>e},[BC]:{transfer:jC,primaries:zC,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[HC]:{transfer:FC,primaries:VC,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.applyMatrix3(EA),fromReference:e=>e.applyMatrix3(xA)},[UC]:{transfer:jC,primaries:VC,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.convertSRGBToLinear().applyMatrix3(EA),fromReference:e=>e.applyMatrix3(xA).convertLinearToSRGB()}},AA=new Set([NC,HC]),MA={enabled:!0,_workingColorSpace:NC,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!AA.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=CA[t].toReference;return(0,CA[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return CA[e].primaries},getTransfer:function(e){return e===LC?FC:CA[e].transfer},getLuminanceCoefficients:function(e,t=this._workingColorSpace){return e.fromArray(CA[t].luminanceCoefficients)}};function kA(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function TA(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let RA;class PA{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===RA&&(RA=bA("canvas")),RA.width=e.width,RA.height=e.height;const n=RA.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=RA}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=bA("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*kA(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*kA(t[e]/255)):t[e]=kA(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let IA=0;class DA{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:IA++}),this.uuid=oA(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(OA(r[t].image)):e.push(OA(r[t]))}else e=OA(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function OA(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?PA.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let LA=0;class BA extends rA{constructor(e=BA.DEFAULT_IMAGE,t=BA.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,a=1023,o=1009,l=BA.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:LA++}),this.uuid=oA(),this.name="",this.source=new DA(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new mA(0,0),this.repeat=new mA(1,1),this.center=new mA(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gA,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RE:e.x=e.x-Math.floor(e.x);break;case PE:e.x=e.x<0?0:1;break;case IE:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case RE:e.y=e.y-Math.floor(e.y);break;case PE:e.y=e.y<0?0:1;break;case IE:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}BA.DEFAULT_IMAGE=null,BA.DEFAULT_MAPPING=300,BA.DEFAULT_ANISOTROPY=1;class NA{constructor(e=0,t=0,n=0,r=1){NA.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],f=o[9],p=o[2],m=o[6],g=o[10];if(Math.abs(c-h)<s&&Math.abs(u-p)<s&&Math.abs(f-m)<s){if(Math.abs(c+h)<a&&Math.abs(u+p)<a&&Math.abs(f+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,v=(g+1)/2,_=(c+h)/4,b=(u+p)/4,y=(f+m)/4;return e>o&&e>v?e<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=_/n,i=b/n):o>v?o<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=_/r,i=y/r):v<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=b/i,r=y/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-f)/v,this.y=(u-p)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class UA extends rA{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new NA(0,0,e,t),this.scissorTest=!1,this.viewport=new NA(0,0,e,t);const r={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:BE,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const i=new BA(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let e=0;e<s;e++)this.textures[e]=i.clone(),this.textures[e].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++)this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new DA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class HA extends UA{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class FA extends BA{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=DE,this.minFilter=DE,this.wrapR=PE,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class jA extends BA{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=DE,this.minFilter=DE,this.wrapR=PE,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class zA{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,s,a){let o=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[s+0],d=i[s+1],f=i[s+2],p=i[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(u!==p||o!==h||l!==d||c!==f){let e=1-a;const t=o*h+l*d+c*f+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,t*n);e=Math.sin(e*s)/i,a=Math.sin(a*s)/i}const i=a*n;if(o=o*e+h*i,l=l*e+d*i,c=c*e+f*i,u=u*e+p*i,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,s){const a=n[r],o=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],f=i[s+3];return e[t]=a*f+c*u+o*d-l*h,e[t+1]=o*f+c*h+l*u-a*d,e[t+2]=l*f+c*d+a*h-o*u,e[t+3]=c*f-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(r/2),u=a(i/2),h=o(n/2),d=o(r/2),f=o(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(i-l)*e,this._z=(s-r)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-o)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(i+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(i-l)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(s-r)/e,this._x=(i+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(lA(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+r*l-i*o,this._y=r*c+s*o+i*a-n*l,this._z=i*c+s*l+n*o-r*a,this._w=s*c-n*a-r*o-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,s=this._w;let a=s*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class VA{constructor(e=0,t=0,n=0){VA.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(WA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(WA.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*r-a*n),c=2*(a*t-i*r),u=2*(i*n-s*t);return this.x=t+o*l+s*u-a*c,this.y=n+o*c+a*l-i*u,this.z=r+o*u+i*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-i*a,this.y=i*s-n*o,this.z=n*a-r*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return GA.copy(this).projectOnVector(e),this.sub(GA)}reflect(e){return this.sub(GA.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(lA(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const GA=new VA,WA=new zA;class qA{constructor(e=new VA(1/0,1/0,1/0),t=new VA(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint($A.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint($A.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=$A.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,$A):$A.fromBufferAttribute(r,t),$A.applyMatrix4(e.matrixWorld),this.expandByPoint($A);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),XA.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),XA.copy(n.boundingBox)),XA.applyMatrix4(e.matrixWorld),this.union(XA)}const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,$A),$A.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(nM),rM.subVectors(this.max,nM),YA.subVectors(e.a,nM),ZA.subVectors(e.b,nM),JA.subVectors(e.c,nM),QA.subVectors(ZA,YA),eM.subVectors(JA,ZA),tM.subVectors(YA,JA);let t=[0,-QA.z,QA.y,0,-eM.z,eM.y,0,-tM.z,tM.y,QA.z,0,-QA.x,eM.z,0,-eM.x,tM.z,0,-tM.x,-QA.y,QA.x,0,-eM.y,eM.x,0,-tM.y,tM.x,0];return!!aM(t,YA,ZA,JA,rM)&&(t=[1,0,0,0,1,0,0,0,1],!!aM(t,YA,ZA,JA,rM)&&(iM.crossVectors(QA,eM),t=[iM.x,iM.y,iM.z],aM(t,YA,ZA,JA,rM)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,$A).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize($A).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(KA[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),KA[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),KA[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),KA[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),KA[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),KA[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),KA[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),KA[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(KA)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const KA=[new VA,new VA,new VA,new VA,new VA,new VA,new VA,new VA],$A=new VA,XA=new qA,YA=new VA,ZA=new VA,JA=new VA,QA=new VA,eM=new VA,tM=new VA,nM=new VA,rM=new VA,iM=new VA,sM=new VA;function aM(e,t,n,r,i){for(let s=0,a=e.length-3;s<=a;s+=3){sM.fromArray(e,s);const a=i.x*Math.abs(sM.x)+i.y*Math.abs(sM.y)+i.z*Math.abs(sM.z),o=t.dot(sM),l=n.dot(sM),c=r.dot(sM);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const oM=new qA,lM=new VA,cM=new VA;class uM{constructor(e=new VA,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):oM.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;lM.subVectors(e,this.center);const t=lM.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(lM,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(cM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(lM.copy(e.center).add(cM)),this.expandByPoint(lM.copy(e.center).sub(cM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const hM=new VA,dM=new VA,fM=new VA,pM=new VA,mM=new VA,gM=new VA,vM=new VA;class _M{constructor(e=new VA,t=new VA(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,hM)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=hM.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(hM.copy(this.origin).addScaledVector(this.direction,t),hM.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){dM.copy(e).add(t).multiplyScalar(.5),fM.copy(t).sub(e).normalize(),pM.copy(this.origin).sub(dM);const i=.5*e.distanceTo(t),s=-this.direction.dot(fM),a=pM.dot(this.direction),o=-pM.dot(fM),l=pM.lengthSq(),c=Math.abs(1-s*s);let u,h,d,f;if(c>0)if(u=s*o-a,h=s*a-o,f=i*c,u>=0)if(h>=-f)if(h<=f){const e=1/c;u*=e,h*=e,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=i,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-i,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-f?(u=Math.max(0,-(-s*i+a)),h=u>0?-i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l):h<=f?(u=0,h=Math.min(Math.max(-i,-o),i),d=h*(h+2*o)+l):(u=Math.max(0,-(s*i+a)),h=u>0?i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(dM).addScaledVector(fM,h),d}intersectSphere(e,t){hM.subVectors(e.center,this.origin);const n=hM.dot(this.direction),r=hM.dot(hM)-n*n,i=e.radius*e.radius;if(r>i)return null;const s=Math.sqrt(i-r),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||a>r?null:((a>n||n!=n)&&(n=a),(o<r||r!=r)&&(r=o),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,hM)}intersectTriangle(e,t,n,r,i){mM.subVectors(t,e),gM.subVectors(n,e),vM.crossVectors(mM,gM);let s,a=this.direction.dot(vM);if(a>0){if(r)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}pM.subVectors(this.origin,e);const o=s*this.direction.dot(gM.crossVectors(pM,gM));if(o<0)return null;const l=s*this.direction.dot(mM.cross(pM));if(l<0)return null;if(o+l>a)return null;const c=-s*pM.dot(vM);return c<0?null:this.at(c/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class bM{constructor(e,t,n,r,i,s,a,o,l,c,u,h,d,f,p,m){bM.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,s,a,o,l,c,u,h,d,f,p,m)}set(e,t,n,r,i,s,a,o,l,c,u,h,d,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new bM).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/yM.setFromMatrixColumn(e,0).length(),i=1/yM.setFromMatrixColumn(e,1).length(),s=1/yM.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=s*c,n=s*u,r=a*c,i=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-a*o,t[2]=i-e*l,t[6]=r+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e+i*a,t[4]=r*a-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=n*a-r,t[6]=i+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e-i*a,t[4]=-s*u,t[8]=r+n*a,t[1]=n+r*a,t[5]=s*c,t[9]=i-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*u,r=a*c,i=a*u;t[0]=o*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=o*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,r=a*o,i=a*l;t[0]=o*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=s*o,n=s*l,r=a*o,i=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=s*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=a*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(SM,e,xM)}lookAt(e,t,n){const r=this.elements;return AM.subVectors(e,t),0===AM.lengthSq()&&(AM.z=1),AM.normalize(),EM.crossVectors(n,AM),0===EM.lengthSq()&&(1===Math.abs(n.z)?AM.x+=1e-4:AM.z+=1e-4,AM.normalize(),EM.crossVectors(n,AM)),EM.normalize(),CM.crossVectors(AM,EM),r[0]=EM.x,r[4]=CM.x,r[8]=AM.x,r[1]=EM.y,r[5]=CM.y,r[9]=AM.y,r[2]=EM.z,r[6]=CM.z,r[10]=AM.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],_=n[7],b=n[11],y=n[15],w=r[0],S=r[4],x=r[8],E=r[12],C=r[1],A=r[5],M=r[9],k=r[13],T=r[2],R=r[6],P=r[10],I=r[14],D=r[3],O=r[7],L=r[11],B=r[15];return i[0]=s*w+a*C+o*T+l*D,i[4]=s*S+a*A+o*R+l*O,i[8]=s*x+a*M+o*P+l*L,i[12]=s*E+a*k+o*I+l*B,i[1]=c*w+u*C+h*T+d*D,i[5]=c*S+u*A+h*R+d*O,i[9]=c*x+u*M+h*P+d*L,i[13]=c*E+u*k+h*I+d*B,i[2]=f*w+p*C+m*T+g*D,i[6]=f*S+p*A+m*R+g*O,i[10]=f*x+p*M+m*P+g*L,i[14]=f*E+p*k+m*I+g*B,i[3]=v*w+_*C+b*T+y*D,i[7]=v*S+_*A+b*R+y*O,i[11]=v*x+_*M+b*P+y*L,i[15]=v*E+_*k+b*I+y*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*o*u-r*l*u-i*a*h+n*l*h+r*a*d-n*o*d)+e[7]*(+t*o*d-t*l*h+i*s*h-r*s*d+r*l*c-i*o*c)+e[11]*(+t*l*u-t*a*d-i*s*u+n*s*d+i*a*c-n*l*c)+e[15]*(-r*a*c-t*o*u+t*a*h+r*s*u-n*s*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=u*m*l-p*h*l+p*o*d-a*m*d-u*o*g+a*h*g,_=f*h*l-c*m*l-f*o*d+s*m*d+c*o*g-s*h*g,b=c*p*l-f*u*l+f*a*d-s*p*d-c*a*g+s*u*g,y=f*u*o-c*p*o-f*a*h+s*p*h+c*a*m-s*u*m,w=t*v+n*_+r*b+i*y;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/w;return e[0]=v*S,e[1]=(p*h*i-u*m*i-p*r*d+n*m*d+u*r*g-n*h*g)*S,e[2]=(a*m*i-p*o*i+p*r*l-n*m*l-a*r*g+n*o*g)*S,e[3]=(u*o*i-a*h*i-u*r*l+n*h*l+a*r*d-n*o*d)*S,e[4]=_*S,e[5]=(c*m*i-f*h*i+f*r*d-t*m*d-c*r*g+t*h*g)*S,e[6]=(f*o*i-s*m*i-f*r*l+t*m*l+s*r*g-t*o*g)*S,e[7]=(s*h*i-c*o*i+c*r*l-t*h*l-s*r*d+t*o*d)*S,e[8]=b*S,e[9]=(f*u*i-c*p*i-f*n*d+t*p*d+c*n*g-t*u*g)*S,e[10]=(s*p*i-f*a*i+f*n*l-t*p*l-s*n*g+t*a*g)*S,e[11]=(c*a*i-s*u*i-c*n*l+t*u*l+s*n*d-t*a*d)*S,e[12]=y*S,e[13]=(c*p*r-f*u*r+f*n*h-t*p*h-c*n*m+t*u*m)*S,e[14]=(f*a*r-s*p*r-f*n*o+t*p*o+s*n*m-t*a*m)*S,e[15]=(s*u*r-c*a*r+c*n*o-t*u*o-s*n*h+t*a*h)*S,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,a=e.y,o=e.z,l=i*s,c=i*a;return this.set(l*s+n,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+n,c*o-r*s,0,l*o-r*a,c*o+r*s,i*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,s){return this.set(1,n,i,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,s=t._y,a=t._z,o=t._w,l=i+i,c=s+s,u=a+a,h=i*l,d=i*c,f=i*u,p=s*c,m=s*u,g=a*u,v=o*l,_=o*c,b=o*u,y=n.x,w=n.y,S=n.z;return r[0]=(1-(p+g))*y,r[1]=(d+b)*y,r[2]=(f-_)*y,r[3]=0,r[4]=(d-b)*w,r[5]=(1-(h+g))*w,r[6]=(m+v)*w,r[7]=0,r[8]=(f+_)*S,r[9]=(m-v)*S,r[10]=(1-(h+p))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=yM.set(r[0],r[1],r[2]).length();const s=yM.set(r[4],r[5],r[6]).length(),a=yM.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],wM.copy(this);const o=1/i,l=1/s,c=1/a;return wM.elements[0]*=o,wM.elements[1]*=o,wM.elements[2]*=o,wM.elements[4]*=l,wM.elements[5]*=l,wM.elements[6]*=l,wM.elements[8]*=c,wM.elements[9]*=c,wM.elements[10]*=c,t.setFromRotationMatrix(wM),n.x=i,n.y=s,n.z=a,this}makePerspective(e,t,n,r,i,s,a=2e3){const o=this.elements,l=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),h=(n+r)/(n-r);let d,f;if(a===tA)d=-(s+i)/(s-i),f=-2*s*i/(s-i);else{if(a!==nA)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-i),f=-s*i/(s-i)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,s,a=2e3){const o=this.elements,l=1/(t-e),c=1/(n-r),u=1/(s-i),h=(t+e)*l,d=(n+r)*c;let f,p;if(a===tA)f=(s+i)*u,p=-2*u;else{if(a!==nA)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);f=i*u,p=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=p,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const yM=new VA,wM=new bM,SM=new VA(0,0,0),xM=new VA(1,1,1),EM=new VA,CM=new VA,AM=new VA,MM=new bM,kM=new zA;class TM{constructor(e=0,t=0,n=0,r=TM.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(lA(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-lA(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(lA(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-lA(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(lA(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-lA(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return MM.makeRotationFromQuaternion(e),this.setFromRotationMatrix(MM,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return kM.setFromEuler(this),this.setFromQuaternion(kM,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}TM.DEFAULT_ORDER="XYZ";class RM{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let PM=0;const IM=new VA,DM=new zA,OM=new bM,LM=new VA,BM=new VA,NM=new VA,UM=new zA,HM=new VA(1,0,0),FM=new VA(0,1,0),jM=new VA(0,0,1),zM={type:"added"},VM={type:"removed"},GM={type:"childadded",child:null},WM={type:"childremoved",child:null};class qM extends rA{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:PM++}),this.uuid=oA(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qM.DEFAULT_UP.clone();const e=new VA,t=new TM,n=new zA,r=new VA(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new bM},normalMatrix:{value:new gA}}),this.matrix=new bM,this.matrixWorld=new bM,this.matrixAutoUpdate=qM.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=qM.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new RM,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return DM.setFromAxisAngle(e,t),this.quaternion.multiply(DM),this}rotateOnWorldAxis(e,t){return DM.setFromAxisAngle(e,t),this.quaternion.premultiply(DM),this}rotateX(e){return this.rotateOnAxis(HM,e)}rotateY(e){return this.rotateOnAxis(FM,e)}rotateZ(e){return this.rotateOnAxis(jM,e)}translateOnAxis(e,t){return IM.copy(e).applyQuaternion(this.quaternion),this.position.add(IM.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(HM,e)}translateY(e){return this.translateOnAxis(FM,e)}translateZ(e){return this.translateOnAxis(jM,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(OM.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?LM.copy(e):LM.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),BM.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?OM.lookAt(BM,LM,this.up):OM.lookAt(LM,BM,this.up),this.quaternion.setFromRotationMatrix(OM),r&&(OM.extractRotation(r.matrixWorld),DM.setFromRotationMatrix(OM),this.quaternion.premultiply(DM.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(zM),GM.child=e,this.dispatchEvent(GM),GM.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(VM),WM.child=e,this.dispatchEvent(WM),WM.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),OM.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),OM.multiply(e.parent.matrixWorld)),e.applyMatrix4(OM),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(zM),GM.child=e,this.dispatchEvent(GM),GM.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(BM,e,NM),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(BM,UM,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=s(e.geometries),r=s(e.materials),i=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function s(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}qM.DEFAULT_UP=new VA(0,1,0),qM.DEFAULT_MATRIX_AUTO_UPDATE=!0,qM.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const KM=new VA,$M=new VA,XM=new VA,YM=new VA,ZM=new VA,JM=new VA,QM=new VA,ek=new VA,tk=new VA,nk=new VA;class rk{constructor(e=new VA,t=new VA,n=new VA){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),KM.subVectors(e,t),r.cross(KM);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){KM.subVectors(r,t),$M.subVectors(n,t),XM.subVectors(e,t);const s=KM.dot(KM),a=KM.dot($M),o=KM.dot(XM),l=$M.dot($M),c=$M.dot(XM),u=s*l-a*a;if(0===u)return i.set(0,0,0),null;const h=1/u,d=(l*o-a*c)*h,f=(s*c-a*o)*h;return i.set(1-d-f,f,d)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,YM)&&YM.x>=0&&YM.y>=0&&YM.x+YM.y<=1}static getInterpolation(e,t,n,r,i,s,a,o){return null===this.getBarycoord(e,t,n,r,YM)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(i,YM.x),o.addScaledVector(s,YM.y),o.addScaledVector(a,YM.z),o)}static isFrontFacing(e,t,n,r){return KM.subVectors(n,t),$M.subVectors(e,t),KM.cross($M).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return KM.subVectors(this.c,this.b),$M.subVectors(this.a,this.b),.5*KM.cross($M).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return rk.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return rk.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return rk.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return rk.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return rk.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let s,a;ZM.subVectors(r,n),JM.subVectors(i,n),ek.subVectors(e,n);const o=ZM.dot(ek),l=JM.dot(ek);if(o<=0&&l<=0)return t.copy(n);tk.subVectors(e,r);const c=ZM.dot(tk),u=JM.dot(tk);if(c>=0&&u<=c)return t.copy(r);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(ZM,s);nk.subVectors(e,i);const d=ZM.dot(nk),f=JM.dot(nk);if(f>=0&&d<=f)return t.copy(i);const p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(n).addScaledVector(JM,a);const m=c*f-d*u;if(m<=0&&u-c>=0&&d-f>=0)return QM.subVectors(i,r),a=(u-c)/(u-c+(d-f)),t.copy(r).addScaledVector(QM,a);const g=1/(m+p+h);return s=p*g,a=h*g,t.copy(n).addScaledVector(ZM,s).addScaledVector(JM,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ik={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},sk={h:0,s:0,l:0},ak={h:0,s:0,l:0};function lk(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class ck{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=BC){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,MA.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=MA.workingColorSpace){return this.r=e,this.g=t,this.b=n,MA.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=MA.workingColorSpace){if(e=cA(e,1),t=lA(t,0,1),n=lA(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=lk(i,r,e+1/3),this.g=lk(i,r,e),this.b=lk(i,r,e-1/3)}return MA.toWorkingColorSpace(this,r),this}setStyle(e,t=BC){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=BC){const n=ik[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=kA(e.r),this.g=kA(e.g),this.b=kA(e.b),this}copyLinearToSRGB(e){return this.r=TA(e.r),this.g=TA(e.g),this.b=TA(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=BC){return MA.fromWorkingColorSpace(uk.copy(this),e),65536*Math.round(lA(255*uk.r,0,255))+256*Math.round(lA(255*uk.g,0,255))+Math.round(lA(255*uk.b,0,255))}getHexString(e=BC){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=MA.workingColorSpace){MA.fromWorkingColorSpace(uk.copy(this),t);const n=uk.r,r=uk.g,i=uk.b,s=Math.max(n,r,i),a=Math.min(n,r,i);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case n:o=(r-i)/e+(r<i?6:0);break;case r:o=(i-n)/e+2;break;case i:o=(n-r)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=MA.workingColorSpace){return MA.fromWorkingColorSpace(uk.copy(this),t),e.r=uk.r,e.g=uk.g,e.b=uk.b,e}getStyle(e=BC){MA.fromWorkingColorSpace(uk.copy(this),e);const t=uk.r,n=uk.g,r=uk.b;return e!==BC?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(sk),this.setHSL(sk.h+e,sk.s+t,sk.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(sk),e.getHSL(ak);const n=uA(sk.h,ak.h,t),r=uA(sk.s,ak.s,t),i=uA(sk.l,ak.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const uk=new ck;ck.NAMES=ik;let hk=0;class dk extends rA{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:hk++}),this.uuid=oA(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=lE,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ck(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=GC,this.stencilZFail=GC,this.stencilZPass=GC,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==lE&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==GC&&(n.stencilFail=this.stencilFail),this.stencilZFail!==GC&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==GC&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class fk extends dk{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ck(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new TM,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const pk=new VA,mk=new mA;class gk{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=QC,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=VE,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return SA("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)mk.fromBufferAttribute(this,t),mk.applyMatrix3(e),this.setXY(t,mk.x,mk.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)pk.fromBufferAttribute(this,t),pk.applyMatrix3(e),this.setXYZ(t,pk.x,pk.y,pk.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)pk.fromBufferAttribute(this,t),pk.applyMatrix4(e),this.setXYZ(t,pk.x,pk.y,pk.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)pk.fromBufferAttribute(this,t),pk.applyNormalMatrix(e),this.setXYZ(t,pk.x,pk.y,pk.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)pk.fromBufferAttribute(this,t),pk.transformDirection(e),this.setXYZ(t,pk.x,pk.y,pk.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=hA(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=dA(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=hA(t,this.array)),t}setX(e,t){return this.normalized&&(t=dA(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=hA(t,this.array)),t}setY(e,t){return this.normalized&&(t=dA(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=hA(t,this.array)),t}setZ(e,t){return this.normalized&&(t=dA(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=hA(t,this.array)),t}setW(e,t){return this.normalized&&(t=dA(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=dA(t,this.array),n=dA(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=dA(t,this.array),n=dA(n,this.array),r=dA(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=dA(t,this.array),n=dA(n,this.array),r=dA(r,this.array),i=dA(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==QC&&(e.usage=this.usage),e}}class vk extends gk{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class _k extends gk{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class bk extends gk{constructor(e,t,n){super(new Float32Array(e),t,n)}}let yk=0;const wk=new bM,Sk=new qM,xk=new VA,Ek=new qA,Ck=new qA,Ak=new VA;class Mk extends rA{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:yk++}),this.uuid=oA(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(_A(e)?_k:vk)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new gA).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return wk.makeRotationFromQuaternion(e),this.applyMatrix4(wk),this}rotateX(e){return wk.makeRotationX(e),this.applyMatrix4(wk),this}rotateY(e){return wk.makeRotationY(e),this.applyMatrix4(wk),this}rotateZ(e){return wk.makeRotationZ(e),this.applyMatrix4(wk),this}translate(e,t,n){return wk.makeTranslation(e,t,n),this.applyMatrix4(wk),this}scale(e,t,n){return wk.makeScale(e,t,n),this.applyMatrix4(wk),this}lookAt(e){return Sk.lookAt(e),Sk.updateMatrix(),this.applyMatrix4(Sk.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(xk).negate(),this.translate(xk.x,xk.y,xk.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new bk(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qA);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new VA(-1/0,-1/0,-1/0),new VA(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Ek.setFromBufferAttribute(n),this.morphTargetsRelative?(Ak.addVectors(this.boundingBox.min,Ek.min),this.boundingBox.expandByPoint(Ak),Ak.addVectors(this.boundingBox.max,Ek.max),this.boundingBox.expandByPoint(Ak)):(this.boundingBox.expandByPoint(Ek.min),this.boundingBox.expandByPoint(Ek.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new uM);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new VA,1/0);if(e){const n=this.boundingSphere.center;if(Ek.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Ck.setFromBufferAttribute(n),this.morphTargetsRelative?(Ak.addVectors(Ek.min,Ck.min),Ek.expandByPoint(Ak),Ak.addVectors(Ek.max,Ck.max),Ek.expandByPoint(Ak)):(Ek.expandByPoint(Ck.min),Ek.expandByPoint(Ck.max))}Ek.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)Ak.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Ak));if(t)for(let i=0,s=t.length;i<s;i++){const s=t[i],a=this.morphTargetsRelative;for(let t=0,i=s.count;t<i;t++)Ak.fromBufferAttribute(s,t),a&&(xk.fromBufferAttribute(e,t),Ak.add(xk)),r=Math.max(r,n.distanceToSquared(Ak))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new gk(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let e=0;e<n.count;e++)a[e]=new VA,o[e]=new VA;const l=new VA,c=new VA,u=new VA,h=new mA,d=new mA,f=new mA,p=new VA,m=new VA;function g(e,t,r){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),h.fromBufferAttribute(i,e),d.fromBufferAttribute(i,t),f.fromBufferAttribute(i,r),c.sub(l),u.sub(l),d.sub(h),f.sub(h);const s=1/(d.x*f.y-f.x*d.y);isFinite(s)&&(p.copy(c).multiplyScalar(f.y).addScaledVector(u,-d.y).multiplyScalar(s),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-f.x).multiplyScalar(s),a[e].add(p),a[t].add(p),a[r].add(p),o[e].add(m),o[t].add(m),o[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let t=0,n=v.length;t<n;++t){const n=v[t],r=n.start;for(let t=r,i=r+n.count;t<i;t+=3)g(e.getX(t+0),e.getX(t+1),e.getX(t+2))}const _=new VA,b=new VA,y=new VA,w=new VA;function S(e){y.fromBufferAttribute(r,e),w.copy(y);const t=a[e];_.copy(t),_.sub(y.multiplyScalar(y.dot(t))).normalize(),b.crossVectors(w,t);const n=b.dot(o[e])<0?-1:1;s.setXYZW(e,_.x,_.y,_.z,n)}for(let t=0,n=v.length;t<n;++t){const n=v[t],r=n.start;for(let t=r,i=r+n.count;t<i;t+=3)S(e.getX(t+0)),S(e.getX(t+1)),S(e.getX(t+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new gk(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new VA,i=new VA,s=new VA,a=new VA,o=new VA,l=new VA,c=new VA,u=new VA;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),f=e.getX(h+1),p=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,f),s.fromBufferAttribute(t,p),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,f),l.fromBufferAttribute(n,p),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,o.x,o.y,o.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ak.fromBufferAttribute(e,t),Ak.normalize(),e.setXYZ(t,Ak.x,Ak.y,Ak.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,s=new n.constructor(t.length*r);let a=0,o=0;for(let i=0,l=t.length;i<l;i++){a=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)s[o++]=n[a++]}return new gk(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Mk,n=this.index.array,r=this.attributes;for(const i in r){const s=e(r[i],n);t.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],a=i[r];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);s.push(r)}t.morphAttributes[r]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];s.push(r.toJSON(e.data))}s.length>0&&(r[t]=s,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const kk=new bM,Tk=new _M,Rk=new uM,Pk=new VA,Ik=new VA,Dk=new VA,Ok=new VA,Lk=new VA,Bk=new VA,Nk=new mA,Uk=new mA,Hk=new mA,Fk=new VA,jk=new VA,zk=new VA,Vk=new VA,Gk=new VA;class Wk extends qM{constructor(e=new Mk,t=new fk){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(i&&a){Bk.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=a[n],o=i[n];0!==r&&(Lk.fromBufferAttribute(o,e),s?Bk.addScaledVector(Lk,r):Bk.addScaledVector(Lk.sub(t),r))}t.add(Bk)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Rk.copy(n.boundingSphere),Rk.applyMatrix4(i),Tk.copy(e.ray).recast(e.near),!1===Rk.containsPoint(Tk.origin)){if(null===Tk.intersectSphere(Rk,Pk))return;if(Tk.origin.distanceToSquared(Pk)>(e.far-e.near)**2)return}kk.copy(i).invert(),Tk.copy(e.ray).applyMatrix4(kk),null!==n.boundingBox&&!1===Tk.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Tk)}}_computeIntersections(e,t,n){let r;const i=this.geometry,s=this.material,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==a)if(Array.isArray(s))for(let i=0,o=h.length;i<o;i++){const o=h[i],f=s[o.materialIndex];for(let i=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));i<s;i+=3)r=qk(this,f,e,n,l,c,u,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,t.push(r))}else for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3)r=qk(this,s,e,n,l,c,u,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r));else if(void 0!==o)if(Array.isArray(s))for(let i=0,a=h.length;i<a;i++){const a=h[i],f=s[a.materialIndex];for(let i=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<s;i+=3)r=qk(this,f,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}else for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3)r=qk(this,s,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}function qk(e,t,n,r,i,s,a,o,l,c){e.getVertexPosition(o,Ik),e.getVertexPosition(l,Dk),e.getVertexPosition(c,Ok);const u=function(e,t,n,r,i,s,a,o){let l;if(l=1===t.side?r.intersectTriangle(a,s,i,!0,o):r.intersectTriangle(i,s,a,0===t.side,o),null===l)return null;Gk.copy(o),Gk.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Gk);return c<n.near||c>n.far?null:{distance:c,point:Gk.clone(),object:e}}(e,t,n,r,Ik,Dk,Ok,Vk);if(u){i&&(Nk.fromBufferAttribute(i,o),Uk.fromBufferAttribute(i,l),Hk.fromBufferAttribute(i,c),u.uv=rk.getInterpolation(Vk,Ik,Dk,Ok,Nk,Uk,Hk,new mA)),s&&(Nk.fromBufferAttribute(s,o),Uk.fromBufferAttribute(s,l),Hk.fromBufferAttribute(s,c),u.uv1=rk.getInterpolation(Vk,Ik,Dk,Ok,Nk,Uk,Hk,new mA)),a&&(Fk.fromBufferAttribute(a,o),jk.fromBufferAttribute(a,l),zk.fromBufferAttribute(a,c),u.normal=rk.getInterpolation(Vk,Ik,Dk,Ok,Fk,jk,zk,new VA),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const e={a:o,b:l,c,normal:new VA,materialIndex:0};rk.getNormal(Ik,Dk,Ok,e.normal),u.face=e}return u}class Kk extends Mk{constructor(e=1,t=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const a=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const o=[],l=[],c=[],u=[];let h=0,d=0;function f(e,t,n,r,i,s,f,p,m,g,v){const _=s/m,b=f/g,y=s/2,w=f/2,S=p/2,x=m+1,E=g+1;let C=0,A=0;const M=new VA;for(let s=0;s<E;s++){const a=s*b-w;for(let o=0;o<x;o++){const h=o*_-y;M[e]=h*r,M[t]=a*i,M[n]=S,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=p>0?1:-1,c.push(M.x,M.y,M.z),u.push(o/m),u.push(1-s/g),C+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+x*e,r=h+t+x*(e+1),i=h+(t+1)+x*(e+1),s=h+(t+1)+x*e;o.push(n,r,s),o.push(r,i,s),A+=6}a.addGroup(d,A,v),d+=A,h+=C}f("z","y","x",-1,-1,n,t,e,s,i,0),f("z","y","x",1,-1,n,t,-e,s,i,1),f("x","z","y",1,1,e,n,t,r,s,2),f("x","z","y",1,-1,e,n,-t,r,s,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(o),this.setAttribute("position",new bk(l,3)),this.setAttribute("normal",new bk(c,3)),this.setAttribute("uv",new bk(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Kk(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function $k(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Xk(e){const t={};for(let n=0;n<e.length;n++){const r=$k(e[n]);for(const e in r)t[e]=r[e]}return t}function Yk(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:MA.workingColorSpace}const Zk={clone:$k,merge:Xk};class Jk extends dk{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=$k(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Qk extends qM{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bM,this.projectionMatrix=new bM,this.projectionMatrixInverse=new bM,this.coordinateSystem=tA}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const eT=new VA,tT=new mA,nT=new mA;class rT extends Qk{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*aA*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*sA*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*aA*Math.atan(Math.tan(.5*sA*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){eT.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(eT.x,eT.y).multiplyScalar(-e/eT.z),eT.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(eT.x,eT.y).multiplyScalar(-e/eT.z)}getViewSize(e,t){return this.getViewBounds(e,tT,nT),t.subVectors(nT,tT)}setViewOffset(e,t,n,r,i,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*sA*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;i+=s.offsetX*r/e,t-=s.offsetY*n/a,r*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const iT=-90;class sT extends qM{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new rT(iT,1,e,t);r.layers=this.layers,this.add(r);const i=new rT(iT,1,e,t);i.layers=this.layers,this.add(i);const s=new rT(iT,1,e,t);s.layers=this.layers,this.add(s);const a=new rT(iT,1,e,t);a.layers=this.layers,this.add(a);const o=new rT(iT,1,e,t);o.layers=this.layers,this.add(o);const l=new rT(iT,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,s,a,o]=t;for(const e of t)this.remove(e);if(e===tA)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==nA)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,s,a,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,s),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class aT extends BA{constructor(e,t,n,r,i,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ME,n,r,i,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class oT extends HA{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new aT(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:BE}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Kk(5,5,5),a=new Jk({name:"CubemapFromEquirect",uniforms:$k(n),vertexShader:r,fragmentShader:i,side:1,blending:0});a.uniforms.tEquirect.value=t;const o=new Wk(s,a),l=t.minFilter;return t.minFilter===UE&&(t.minFilter=BE),new sT(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}const lT=new VA,cT=new VA,uT=new gA;class hT{constructor(e=new VA(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=lT.subVectors(n,t).cross(cT.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(lT),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||uT.getNormalMatrix(e),r=this.coplanarPoint(lT).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const dT=new uM,fT=new VA;class pT{constructor(e=new hT,t=new hT,n=new hT,r=new hT,i=new hT,s=new hT){this.planes=[e,t,n,r,i,s]}set(e,t,n,r,i,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,r=e.elements,i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],f=r[9],p=r[10],m=r[11],g=r[12],v=r[13],_=r[14],b=r[15];if(n[0].setComponents(o-i,h-l,m-d,b-g).normalize(),n[1].setComponents(o+i,h+l,m+d,b+g).normalize(),n[2].setComponents(o+s,h+c,m+f,b+v).normalize(),n[3].setComponents(o-s,h-c,m-f,b-v).normalize(),n[4].setComponents(o-a,h-u,m-p,b-_).normalize(),t===tA)n[5].setComponents(o+a,h+u,m+p,b+_).normalize();else{if(t!==nA)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,u,p,_).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),dT.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),dT.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(dT)}intersectsSprite(e){return dT.center.set(0,0,0),dT.radius=.7071067811865476,dT.applyMatrix4(e.matrixWorld),this.intersectsSphere(dT)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(fT.x=r.normal.x>0?e.max.x:e.min.x,fT.y=r.normal.y>0?e.max.y:e.min.y,fT.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(fT)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function mT(){let e=null,t=!1,n=null,r=null;function i(t,s){n(t,s),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function gT(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=t.get(n);if(void 0===i)t.set(n,function(t,n){const r=t.array,i=t.usage,s=r.byteLength,a=e.createBuffer();let o;if(e.bindBuffer(n,a),e.bufferData(n,r,i),t.onUploadCallback(),r instanceof Float32Array)o=e.FLOAT;else if(r instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=e.SHORT;else if(r instanceof Uint32Array)o=e.UNSIGNED_INT;else if(r instanceof Int32Array)o=e.INT;else if(r instanceof Int8Array)o=e.BYTE;else if(r instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:s}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const i=n.array,s=n._updateRange,a=n.updateRanges;if(e.bindBuffer(r,t),-1===s.count&&0===a.length&&e.bufferSubData(r,0,i),0!==a.length){for(let t=0,n=a.length;t<n;t++){const n=a[t];e.bufferSubData(r,n.start*i.BYTES_PER_ELEMENT,i,n.start,n.count)}n.clearUpdateRanges()}-1!==s.count&&(e.bufferSubData(r,s.offset*i.BYTES_PER_ELEMENT,i,s.offset,s.count),s.count=-1),n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}class vT extends Mk{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,s=t/2,a=Math.floor(n),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o,d=[],f=[],p=[],m=[];for(let e=0;e<c;e++){const t=e*h-s;for(let n=0;n<l;n++){const r=n*u-i;f.push(r,-t,0),p.push(0,0,1),m.push(n/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),s=t+1+l*e;d.push(n,r,s),d.push(r,i,s)}this.setIndex(d),this.setAttribute("position",new bk(f,3)),this.setAttribute("normal",new bk(p,3)),this.setAttribute("uv",new bk(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vT(e.width,e.height,e.widthSegments,e.heightSegments)}}const _T={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},bT={common:{diffuse:{value:new ck(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new gA},alphaMap:{value:null},alphaMapTransform:{value:new gA},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new gA}},envmap:{envMap:{value:null},envMapRotation:{value:new gA},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new gA}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new gA}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new gA},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new gA},normalScale:{value:new mA(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new gA},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new gA}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new gA}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new gA}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ck(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ck(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new gA},alphaTest:{value:0},uvTransform:{value:new gA}},sprite:{diffuse:{value:new ck(16777215)},opacity:{value:1},center:{value:new mA(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new gA},alphaMap:{value:null},alphaMapTransform:{value:new gA},alphaTest:{value:0}}},yT={basic:{uniforms:Xk([bT.common,bT.specularmap,bT.envmap,bT.aomap,bT.lightmap,bT.fog]),vertexShader:_T.meshbasic_vert,fragmentShader:_T.meshbasic_frag},lambert:{uniforms:Xk([bT.common,bT.specularmap,bT.envmap,bT.aomap,bT.lightmap,bT.emissivemap,bT.bumpmap,bT.normalmap,bT.displacementmap,bT.fog,bT.lights,{emissive:{value:new ck(0)}}]),vertexShader:_T.meshlambert_vert,fragmentShader:_T.meshlambert_frag},phong:{uniforms:Xk([bT.common,bT.specularmap,bT.envmap,bT.aomap,bT.lightmap,bT.emissivemap,bT.bumpmap,bT.normalmap,bT.displacementmap,bT.fog,bT.lights,{emissive:{value:new ck(0)},specular:{value:new ck(1118481)},shininess:{value:30}}]),vertexShader:_T.meshphong_vert,fragmentShader:_T.meshphong_frag},standard:{uniforms:Xk([bT.common,bT.envmap,bT.aomap,bT.lightmap,bT.emissivemap,bT.bumpmap,bT.normalmap,bT.displacementmap,bT.roughnessmap,bT.metalnessmap,bT.fog,bT.lights,{emissive:{value:new ck(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:_T.meshphysical_vert,fragmentShader:_T.meshphysical_frag},toon:{uniforms:Xk([bT.common,bT.aomap,bT.lightmap,bT.emissivemap,bT.bumpmap,bT.normalmap,bT.displacementmap,bT.gradientmap,bT.fog,bT.lights,{emissive:{value:new ck(0)}}]),vertexShader:_T.meshtoon_vert,fragmentShader:_T.meshtoon_frag},matcap:{uniforms:Xk([bT.common,bT.bumpmap,bT.normalmap,bT.displacementmap,bT.fog,{matcap:{value:null}}]),vertexShader:_T.meshmatcap_vert,fragmentShader:_T.meshmatcap_frag},points:{uniforms:Xk([bT.points,bT.fog]),vertexShader:_T.points_vert,fragmentShader:_T.points_frag},dashed:{uniforms:Xk([bT.common,bT.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_T.linedashed_vert,fragmentShader:_T.linedashed_frag},depth:{uniforms:Xk([bT.common,bT.displacementmap]),vertexShader:_T.depth_vert,fragmentShader:_T.depth_frag},normal:{uniforms:Xk([bT.common,bT.bumpmap,bT.normalmap,bT.displacementmap,{opacity:{value:1}}]),vertexShader:_T.meshnormal_vert,fragmentShader:_T.meshnormal_frag},sprite:{uniforms:Xk([bT.sprite,bT.fog]),vertexShader:_T.sprite_vert,fragmentShader:_T.sprite_frag},background:{uniforms:{uvTransform:{value:new gA},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:_T.background_vert,fragmentShader:_T.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new gA}},vertexShader:_T.backgroundCube_vert,fragmentShader:_T.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:_T.cube_vert,fragmentShader:_T.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_T.equirect_vert,fragmentShader:_T.equirect_frag},distanceRGBA:{uniforms:Xk([bT.common,bT.displacementmap,{referencePosition:{value:new VA},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_T.distanceRGBA_vert,fragmentShader:_T.distanceRGBA_frag},shadow:{uniforms:Xk([bT.lights,bT.fog,{color:{value:new ck(0)},opacity:{value:1}}]),vertexShader:_T.shadow_vert,fragmentShader:_T.shadow_frag}};yT.physical={uniforms:Xk([yT.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new gA},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new gA},clearcoatNormalScale:{value:new mA(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new gA},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new gA},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new gA},sheen:{value:0},sheenColor:{value:new ck(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new gA},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new gA},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new gA},transmissionSamplerSize:{value:new mA},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new gA},attenuationDistance:{value:0},attenuationColor:{value:new ck(0)},specularColor:{value:new ck(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new gA},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new gA},anisotropyVector:{value:new mA},anisotropyMap:{value:null},anisotropyMapTransform:{value:new gA}}]),vertexShader:_T.meshphysical_vert,fragmentShader:_T.meshphysical_frag};const wT={r:0,b:0,g:0},ST=new TM,xT=new bM;function ET(e,t,n,r,i,s,a){const o=new ck(0);let l,c,u=!0===s?0:1,h=null,d=0,f=null;function p(e){let r=!0===e.isScene?e.background:null;return r&&r.isTexture&&(r=(e.backgroundBlurriness>0?n:t).get(r)),r}function m(t,n){t.getRGB(wT,Yk(e)),r.buffers.color.setClear(wT.r,wT.g,wT.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),u=t,m(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(o,u)},render:function(t){let n=!1;const i=p(t);null===i?m(o,u):i&&i.isColor&&(m(i,1),n=!0);const s=e.xr.getEnvironmentBlendMode();"additive"===s?r.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&r.buffers.color.setClear(0,0,0,0,a),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=p(n);r&&(r.isCubeTexture||r.mapping===TE)?(void 0===c&&(c=new Wk(new Kk(1,1,1),new Jk({name:"BackgroundCubeMaterial",uniforms:$k(yT.backgroundCube.uniforms),vertexShader:yT.backgroundCube.vertexShader,fragmentShader:yT.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),ST.copy(n.backgroundRotation),ST.x*=-1,ST.y*=-1,ST.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(ST.y*=-1,ST.z*=-1),c.material.uniforms.envMap.value=r,c.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(xT.makeRotationFromEuler(ST)),c.material.toneMapped=MA.getTransfer(r.colorSpace)!==jC,h===r&&d===r.version&&f===e.toneMapping||(c.material.needsUpdate=!0,h=r,d=r.version,f=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new Wk(new vT(2,2),new Jk({name:"BackgroundMaterial",uniforms:$k(yT.background.uniforms),vertexShader:yT.background.vertexShader,fragmentShader:yT.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=MA.getTransfer(r.colorSpace)!==jC,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),h===r&&d===r.version&&f===e.toneMapping||(l.material.needsUpdate=!0,h=r,d=r.version,f=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))}}}function CT(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},i=c(null);let s=i,a=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){const e=s.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const r=s.newAttributes,i=s.enabledAttributes,a=s.attributeDivisors;r[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),a[t]!==n&&(e.vertexAttribDivisor(t,n),a[t]=n)}function f(){const t=s.newAttributes,n=s.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function p(t,n,r,i,s,a,o){!0===o?e.vertexAttribIPointer(t,n,r,s,a):e.vertexAttribPointer(t,n,r,i,s,a)}function m(){g(),a=!0,s!==i&&(s=i,o(s.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,m,g){let v=!1;const _=function(t,n,i){const s=!0===i.wireframe;let a=r[t.id];void 0===a&&(a={},r[t.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let l=o[s];return void 0===l&&(l=c(e.createVertexArray()),o[s]=l),l}(m,l,i);s!==_&&(s=_,o(s.object)),v=function(e,t,n,r){const i=s.attributes,a=t.attributes;let o=0;const l=n.getAttributes();for(const t in l)if(l[t].location>=0){const n=i[t];let r=a[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;o++}return s.attributesNum!==o||s.index!==r}(n,m,l,g),v&&function(e,t,n,r){const i={},a=t.attributes;let o=0;const l=n.getAttributes();for(const t in l)if(l[t].location>=0){let n=a[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,o++}s.attributes=i,s.attributesNum=o,s.index=r}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,r,i,s){u();const a=s.attributes,o=i.getAttributes(),l=r.defaultAttributeValues;for(const r in o){const i=o[r];if(i.location>=0){let o=a[r];if(void 0===o&&("instanceMatrix"===r&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){const r=o.normalized,a=o.itemSize,l=t.get(o);if(void 0===l)continue;const c=l.buffer,u=l.type,f=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||o.gpuType===jE;if(o.isInterleavedBufferAttribute){const t=o.data,l=t.stride,g=o.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)d(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)p(i.location+e,a/i.locationSize,u,r,l*f,(g+a/i.locationSize*e)*f,m)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)d(i.location+e,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)p(i.location+e,a/i.locationSize,u,r,a*f,a/i.locationSize*e*f,m)}}else if(void 0!==l){const t=l[r];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}f()}(n,i,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)l(i[e].object),delete i[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:f}}function AT(e,t,n){let r;function i(t,i,s){0!==s&&(e.drawArraysInstanced(r,t,i,s),n.update(i,r,s))}this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,i,0,s);let a=0;for(let e=0;e<s;e++)a+=i[e];n.update(a,r,1)},this.renderMultiDrawInstances=function(e,s,a,o){if(0===a)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)i(e[t],s[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(r,e,0,s,0,o,0,a);let t=0;for(let e=0;e<a;e++)t+=s[e];for(let e=0;e<o.length;e++)n.update(t,r,o[e])}}}function MT(e,t,n,r){let i;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=!0===n.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,textureFormatReadable:function(t){return t===$E||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===GE&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==HE&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==VE&&!i)},precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:u>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function kT(e){const t=this;let n=null,r=0,i=!1,s=!1;const a=new hT,o=new gA,l={value:null,needsUpdate:!1};function c(e,n,r,i){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==i||null===c){const t=r+4*s,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==s;++t,n+=4)a.copy(e[t]).applyMatrix4(i,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,u){const h=a.clippingPlanes,d=a.clipIntersection,f=a.clipShadows,p=e.get(a);if(!i||null===h||0===h.length||s&&!f)s?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0);else{const e=s?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=c(h,o,t,u);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function TT(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=ME:304===t&&(e.mapping=kE),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping;if(303===s||304===s){if(t.has(i))return n(t.get(i).texture,i.mapping);{const s=i.image;if(s&&s.height>0){const a=new oT(s.height);return a.fromEquirectangularTexture(e,i),t.set(i,a),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class RT extends Qk{constructor(e=-1,t=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,s=n+e,a=r+t,o=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,s=i+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(i,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const PT=[.125,.215,.35,.446,.526,.582],IT=new RT,DT=new ck;let OT=null,LT=0,BT=0,NT=!1;const UT=(1+Math.sqrt(5))/2,HT=1/UT,FT=[new VA(-UT,HT,0),new VA(UT,HT,0),new VA(-HT,0,UT),new VA(HT,0,UT),new VA(0,UT,-HT),new VA(0,UT,HT),new VA(-1,1,-1),new VA(1,1,-1),new VA(-1,1,1),new VA(1,1,1)];class jT{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){OT=this._renderer.getRenderTarget(),LT=this._renderer.getActiveCubeFace(),BT=this._renderer.getActiveMipmapLevel(),NT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=WT(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=GT(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(OT,LT,BT),this._renderer.xr.enabled=NT,e.scissorTest=!1,VT(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ME||e.mapping===kE?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),OT=this._renderer.getRenderTarget(),LT=this._renderer.getActiveCubeFace(),BT=this._renderer.getActiveMipmapLevel(),NT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:BE,minFilter:BE,generateMipmaps:!1,type:GE,format:$E,colorSpace:NC,depthBuffer:!1},r=zT(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=zT(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const s=e-4+1+PT.length;for(let a=0;a<s;a++){const s=Math.pow(2,i);n.push(s);let o=1/s;a>e-4?o=PT[a-e+4-1]:0===a&&(o=0),r.push(o);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,f=6,p=3,m=2,g=1,v=new Float32Array(p*f*d),_=new Float32Array(m*f*d),b=new Float32Array(g*f*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,p*f*e),_.set(h,m*f*e);const i=[e,e,e,e,e,e];b.set(i,g*f*e)}const y=new Mk;y.setAttribute("position",new gk(v,p)),y.setAttribute("uv",new gk(_,m)),y.setAttribute("faceIndex",new gk(b,g)),t.push(y),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(20),i=new VA(0,1,0);return new Jk({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new Wk(this._lodPlanes[0],e);this._renderer.compile(t,IT)}_sceneToCubeUV(e,t,n,r){const i=new rT(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(DT),o.toneMapping=0,o.autoClear=!1;const u=new fk({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Wk(new Kk,u);let d=!1;const f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,d=!0):(u.color.copy(DT),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,s[t],0),i.lookAt(a[t],0,0)):1===n?(i.up.set(0,0,s[t]),i.lookAt(0,a[t],0)):(i.up.set(0,s[t],0),i.lookAt(0,0,a[t]));const l=this._cubeSize;VT(r,n*l,t>2?l:0,l,l),o.setRenderTarget(r),d&&o.render(h,i),o.render(e,i)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===ME||e.mapping===kE;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=WT()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=GT());const i=r?this._cubemapMaterial:this._equirectMaterial,s=new Wk(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const a=this._cubeSize;VT(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,IT)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let t=1;t<r;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=FT[(r-t-1)%FT.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,r,"latitudinal",i),this._halfBlur(s,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Wk(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,f=i/d,p=isFinite(i)?1+Math.floor(3*f):20;p>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/f,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<p&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=m,u.latitudinal.value="latitudinal"===s,a&&(u.poleAxis.value=a);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const _=this._sizeLods[r];VT(t,3*_*(r>v-4?r-v+4:0),4*(this._cubeSize-_),3*_,2*_),o.setRenderTarget(t),o.render(c,IT)}}function zT(e,t,n){const r=new HA(e,t,n);return r.texture.mapping=TE,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function VT(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function GT(){return new Jk({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function WT(){return new Jk({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function qT(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping,a=303===s||304===s,o=s===ME||s===kE;if(a||o){let s=t.get(i);const l=void 0!==s?s.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new jT(e)),s=a?n.fromEquirectangular(i,s):n.fromCubemap(i,s),s.texture.pmremVersion=i.pmremVersion,t.set(i,s),s.texture;if(void 0!==s)return s.texture;{const l=i.image;return a&&l&&l.height>0||o&&l&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(l)?(null===n&&(n=new jT(e)),s=a?n.fromEquirectangular(i):n.fromCubemap(i),s.texture.pmremVersion=i.pmremVersion,t.set(i,s),i.addEventListener("dispose",r),s.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function KT(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&SA("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function $T(e,t,n,r){const i={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const n=o.morphAttributes[e];for(let e=0,r=n.length;e<r;e++)t.remove(n[e])}o.removeEventListener("dispose",a),delete i[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],r=e.index,i=e.attributes.position;let a=0;if(null!==r){const e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],s=e[t+2];n.push(r,i,i,s,s,r)}}else{if(void 0===i)return;{const e=i.array;a=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const o=new(_A(n)?_k:vk)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",a),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function XT(e,t,n){let r,i,s;function a(t,a,o){0!==o&&(e.drawElementsInstanced(r,a,i,t*s,o),n.update(a,r,o))}this.setMode=function(e){r=e},this.setIndex=function(e){i=e.type,s=e.bytesPerElement},this.render=function(t,a){e.drawElements(r,a,i,t*s),n.update(a,r,1)},this.renderInstances=a,this.renderMultiDraw=function(e,s,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,s,0,i,e,0,a);let o=0;for(let e=0;e<a;e++)o+=s[e];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)a(e[t]/s,o[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(r,o,0,i,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e];for(let e=0;e<c.length;e++)n.update(t,r,c[e])}}}function YT(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function ZT(e,t,n){const r=new WeakMap,i=new NA;return{update:function(s,a,o){const l=s.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=void 0!==c?c.length:0;let h=r.get(a);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==a.morphAttributes.position,f=void 0!==a.morphAttributes.normal,p=void 0!==a.morphAttributes.color,m=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let _=0;!0===d&&(_=1),!0===f&&(_=2),!0===p&&(_=3);let b=a.attributes.position.count*_,y=1;b>t.maxTextureSize&&(y=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);const w=new Float32Array(b*y*4*u),S=new FA(w,b,y,u);S.type=VE,S.needsUpdate=!0;const x=4*_;for(let C=0;C<u;C++){const A=m[C],M=g[C],k=v[C],T=b*y*4*C;for(let R=0;R<A.count;R++){const P=R*x;!0===d&&(i.fromBufferAttribute(A,R),w[T+P+0]=i.x,w[T+P+1]=i.y,w[T+P+2]=i.z,w[T+P+3]=0),!0===f&&(i.fromBufferAttribute(M,R),w[T+P+4]=i.x,w[T+P+5]=i.y,w[T+P+6]=i.z,w[T+P+7]=0),!0===p&&(i.fromBufferAttribute(k,R),w[T+P+8]=i.x,w[T+P+9]=i.y,w[T+P+10]=i.z,w[T+P+11]=4===k.itemSize?i.w:1)}}function E(){S.dispose(),r.delete(a),a.removeEventListener("dispose",E)}h={count:u,texture:S,size:new mA(b,y)},r.set(a,h),a.addEventListener("dispose",E)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(e,"morphTexture",s.morphTexture,n);else{let I=0;for(let O=0;O<l.length;O++)I+=l[O];const D=a.morphTargetsRelative?1:1-I;o.getUniforms().setValue(e,"morphTargetBaseInfluence",D),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function JT(e,t,n,r){let i=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=r.render.frame,l=a.geometry,c=t.get(a,l);if(i.get(c)!==o&&(t.update(c),i.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),i.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),i.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;i.get(e)!==o&&(e.update(),i.set(e,o))}return c},dispose:function(){i=new WeakMap}}}class QT extends BA{constructor(e,t,n,r,i,s,a,o,l,c=1026){if(c!==XE&&c!==YE)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===XE&&(n=zE),void 0===n&&c===YE&&(n=KE),super(null,r,i,s,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:DE,this.minFilter=void 0!==o?o:DE,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const eR=new BA,tR=new QT(1,1),nR=new FA,rR=new jA,iR=new aT,sR=[],aR=[],oR=new Float32Array(16),lR=new Float32Array(9),cR=new Float32Array(4);function uR(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let s=sR[i];if(void 0===s&&(s=new Float32Array(i),sR[i]=s),0!==t){r.toArray(s,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(s,i)}return s}function hR(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function dR(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function fR(e,t){let n=aR[t];void 0===n&&(n=new Int32Array(t),aR[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function pR(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function mR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(hR(n,t))return;e.uniform2fv(this.addr,t),dR(n,t)}}function gR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(hR(n,t))return;e.uniform3fv(this.addr,t),dR(n,t)}}function vR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(hR(n,t))return;e.uniform4fv(this.addr,t),dR(n,t)}}function _R(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(hR(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),dR(n,t)}else{if(hR(n,r))return;cR.set(r),e.uniformMatrix2fv(this.addr,!1,cR),dR(n,r)}}function bR(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(hR(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),dR(n,t)}else{if(hR(n,r))return;lR.set(r),e.uniformMatrix3fv(this.addr,!1,lR),dR(n,r)}}function yR(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(hR(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),dR(n,t)}else{if(hR(n,r))return;oR.set(r),e.uniformMatrix4fv(this.addr,!1,oR),dR(n,r)}}function wR(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function SR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(hR(n,t))return;e.uniform2iv(this.addr,t),dR(n,t)}}function xR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(hR(n,t))return;e.uniform3iv(this.addr,t),dR(n,t)}}function ER(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(hR(n,t))return;e.uniform4iv(this.addr,t),dR(n,t)}}function CR(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function AR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(hR(n,t))return;e.uniform2uiv(this.addr,t),dR(n,t)}}function MR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(hR(n,t))return;e.uniform3uiv(this.addr,t),dR(n,t)}}function kR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(hR(n,t))return;e.uniform4uiv(this.addr,t),dR(n,t)}}function TR(e,t,n){const r=this.cache,i=n.allocateTextureUnit();let s;r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),this.type===e.SAMPLER_2D_SHADOW?(tR.compareFunction=515,s=tR):s=eR,n.setTexture2D(t||s,i)}function RR(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||rR,i)}function PR(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||iR,i)}function IR(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||nR,i)}function DR(e,t){e.uniform1fv(this.addr,t)}function OR(e,t){const n=uR(t,this.size,2);e.uniform2fv(this.addr,n)}function LR(e,t){const n=uR(t,this.size,3);e.uniform3fv(this.addr,n)}function BR(e,t){const n=uR(t,this.size,4);e.uniform4fv(this.addr,n)}function NR(e,t){const n=uR(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function UR(e,t){const n=uR(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function HR(e,t){const n=uR(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function FR(e,t){e.uniform1iv(this.addr,t)}function jR(e,t){e.uniform2iv(this.addr,t)}function zR(e,t){e.uniform3iv(this.addr,t)}function VR(e,t){e.uniform4iv(this.addr,t)}function GR(e,t){e.uniform1uiv(this.addr,t)}function WR(e,t){e.uniform2uiv(this.addr,t)}function qR(e,t){e.uniform3uiv(this.addr,t)}function KR(e,t){e.uniform4uiv(this.addr,t)}function $R(e,t,n){const r=this.cache,i=t.length,s=fR(n,i);hR(r,s)||(e.uniform1iv(this.addr,s),dR(r,s));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||eR,s[e])}function XR(e,t,n){const r=this.cache,i=t.length,s=fR(n,i);hR(r,s)||(e.uniform1iv(this.addr,s),dR(r,s));for(let e=0;e!==i;++e)n.setTexture3D(t[e]||rR,s[e])}function YR(e,t,n){const r=this.cache,i=t.length,s=fR(n,i);hR(r,s)||(e.uniform1iv(this.addr,s),dR(r,s));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||iR,s[e])}function ZR(e,t,n){const r=this.cache,i=t.length,s=fR(n,i);hR(r,s)||(e.uniform1iv(this.addr,s),dR(r,s));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||nR,s[e])}class JR{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return pR;case 35664:return mR;case 35665:return gR;case 35666:return vR;case 35674:return _R;case 35675:return bR;case 35676:return yR;case 5124:case 35670:return wR;case 35667:case 35671:return SR;case 35668:case 35672:return xR;case 35669:case 35673:return ER;case 5125:return CR;case 36294:return AR;case 36295:return MR;case 36296:return kR;case 35678:case 36198:case 36298:case 36306:case 35682:return TR;case 35679:case 36299:case 36307:return RR;case 35680:case 36300:case 36308:case 36293:return PR;case 36289:case 36303:case 36311:case 36292:return IR}}(t.type)}}class QR{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return DR;case 35664:return OR;case 35665:return LR;case 35666:return BR;case 35674:return NR;case 35675:return UR;case 35676:return HR;case 5124:case 35670:return FR;case 35667:case 35671:return jR;case 35668:case 35672:return zR;case 35669:case 35673:return VR;case 5125:return GR;case 36294:return WR;case 36295:return qR;case 36296:return KR;case 35678:case 36198:case 36298:case 36306:case 35682:return $R;case 35679:case 36299:case 36307:return XR;case 35680:case 36300:case 36308:case 36293:return YR;case 36289:case 36303:case 36311:case 36292:return ZR}}(t.type)}}class eP{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(e,t[s.id],n)}}}const tP=/(\w+)(\])?(\[|\.)?/g;function nP(e,t){e.seq.push(t),e.map[t.id]=t}function rP(e,t,n){const r=e.name,i=r.length;for(tP.lastIndex=0;;){const s=tP.exec(r),a=tP.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===i){nP(n,void 0===c?new JR(o,e,t):new QR(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new eP(o),nP(n,e)),n=e}}}class iP{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);rP(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,s=t.length;i!==s;++i){const s=t[i],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function sP(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let aP=0;function oP(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=i;e<s;e++){const i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function lP(e,t){const n=function(e){const t=MA.getPrimaries(MA.workingColorSpace),n=MA.getPrimaries(e);let r;switch(t===n?r="":t===VC&&n===zC?r="LinearDisplayP3ToLinearSRGB":t===zC&&n===VC&&(r="LinearSRGBToLinearDisplayP3"),e){case NC:case HC:return[r,"LinearTransferOETF"];case BC:case UC:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function cP(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const uP=new VA;function hP(e){return""!==e}function dP(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function fP(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const pP=/^[ \t]*#include +<([\w\d./]+)>/gm;function mP(e){return e.replace(pP,vP)}const gP=new Map;function vP(e,t){let n=_T[t];if(void 0===n){const e=gP.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=_T[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return mP(n)}const _P=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function bP(e){return e.replace(_P,yP)}function yP(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function wP(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function SP(e,t,n,r){const i=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ME:case kE:t="ENVMAP_TYPE_CUBE";break;case TE:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===kE&&(t="ENVMAP_MODE_REFRACTION"),t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),f=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hP).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),m=i.createProgram();let g,v,_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(hP).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(hP).join("\n"),v.length>0&&(v+="\n")):(g=[wP(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(hP).join("\n"),v=[wP(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?_T.tonemapping_pars_fragment:"",0!==n.toneMapping?cP("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",_T.colorspace_pars_fragment,lP("linearToOutputTexel",n.outputColorSpace),(MA.getLuminanceCoefficients(uP),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${uP.x.toFixed(4)}, ${uP.y.toFixed(4)}, ${uP.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(hP).join("\n")),a=mP(a),a=dP(a,n),a=fP(a,n),o=mP(o),o=dP(o,n),o=fP(o,n),a=bP(a),o=bP(o),!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===eA?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===eA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=_+g+a,y=_+v+o,w=sP(i,i.VERTEX_SHADER,b),S=sP(i,i.FRAGMENT_SHADER,y);function x(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m).trim(),r=i.getShaderInfoLog(w).trim(),s=i.getShaderInfoLog(S).trim();let a=!0,o=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(a=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,m,w,S);else{const e=oP(i,w,"vertex"),r=oP(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==s||(o=!1);o&&(t.diagnostics={runnable:a,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:s,prefix:v}})}i.deleteShader(w),i.deleteShader(S),E=new iP(i,m),C=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),s=r.name;let a=1;r.type===e.FLOAT_MAT2&&(a=2),r.type===e.FLOAT_MAT3&&(a=3),r.type===e.FLOAT_MAT4&&(a=4),n[s]={type:r.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(i,m)}let E,C;i.attachShader(m,w),i.attachShader(m,S),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===E&&x(this),E},this.getAttributes=function(){return void 0===C&&x(this),C};let A=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===A&&(A=i.getProgramParameter(m,37297)),A},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=aP++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=S,this}let xP=0;class EP{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(i)&&(s.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new CP(e),t.set(e,n)),n}}class CP{constructor(e){this.id=xP++,this.code=e,this.usedTimes=0}}function AP(e,t,n,r,i,s,a){const o=new RM,l=new EP,c=new Set,u=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(s,o,u,g,v){const _=g.fog,b=v.geometry,y=s.isMeshStandardMaterial?g.environment:null,w=(s.isMeshStandardMaterial?n:t).get(s.envMap||y),S=w&&w.mapping===TE?w.image.height:null,x=p[s.type];null!==s.precision&&(f=i.getMaxPrecision(s.precision),f!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));const E=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,C=void 0!==E?E.length:0;let A,M,k,T,R=0;if(void 0!==b.morphAttributes.position&&(R=1),void 0!==b.morphAttributes.normal&&(R=2),void 0!==b.morphAttributes.color&&(R=3),x){const e=yT[x];A=e.vertexShader,M=e.fragmentShader}else A=s.vertexShader,M=s.fragmentShader,l.update(s),k=l.getVertexShaderID(s),T=l.getFragmentShaderID(s);const P=e.getRenderTarget(),I=!0===v.isInstancedMesh,D=!0===v.isBatchedMesh,O=!!s.map,L=!!s.matcap,B=!!w,N=!!s.aoMap,U=!!s.lightMap,H=!!s.bumpMap,F=!!s.normalMap,j=!!s.displacementMap,z=!!s.emissiveMap,V=!!s.metalnessMap,G=!!s.roughnessMap,W=s.anisotropy>0,q=s.clearcoat>0,K=s.dispersion>0,$=s.iridescence>0,X=s.sheen>0,Y=s.transmission>0,Z=W&&!!s.anisotropyMap,J=q&&!!s.clearcoatMap,Q=q&&!!s.clearcoatNormalMap,ee=q&&!!s.clearcoatRoughnessMap,te=$&&!!s.iridescenceMap,ne=$&&!!s.iridescenceThicknessMap,re=X&&!!s.sheenColorMap,ie=X&&!!s.sheenRoughnessMap,se=!!s.specularMap,ae=!!s.specularColorMap,oe=!!s.specularIntensityMap,le=Y&&!!s.transmissionMap,ce=Y&&!!s.thicknessMap,ue=!!s.gradientMap,he=!!s.alphaMap,de=s.alphaTest>0,fe=!!s.alphaHash,pe=!!s.extensions;let me=0;s.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(me=e.toneMapping));const ge={shaderID:x,shaderType:s.type,shaderName:s.name,vertexShader:A,fragmentShader:M,defines:s.defines,customVertexShaderID:k,customFragmentShaderID:T,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,batching:D,batchingColor:D&&null!==v._colorsTexture,instancing:I,instancingColor:I&&null!==v.instanceColor,instancingMorph:I&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===P?e.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:NC,alphaToCoverage:!!s.alphaToCoverage,map:O,matcap:L,envMap:B,envMapMode:B&&w.mapping,envMapCubeUVHeight:S,aoMap:N,lightMap:U,bumpMap:H,normalMap:F,displacementMap:d&&j,emissiveMap:z,normalMapObjectSpace:F&&1===s.normalMapType,normalMapTangentSpace:F&&0===s.normalMapType,metalnessMap:V,roughnessMap:G,anisotropy:W,anisotropyMap:Z,clearcoat:q,clearcoatMap:J,clearcoatNormalMap:Q,clearcoatRoughnessMap:ee,dispersion:K,iridescence:$,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:X,sheenColorMap:re,sheenRoughnessMap:ie,specularMap:se,specularColorMap:ae,specularIntensityMap:oe,transmission:Y,transmissionMap:le,thicknessMap:ce,gradientMap:ue,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:he,alphaTest:de,alphaHash:fe,combine:s.combine,mapUv:O&&m(s.map.channel),aoMapUv:N&&m(s.aoMap.channel),lightMapUv:U&&m(s.lightMap.channel),bumpMapUv:H&&m(s.bumpMap.channel),normalMapUv:F&&m(s.normalMap.channel),displacementMapUv:j&&m(s.displacementMap.channel),emissiveMapUv:z&&m(s.emissiveMap.channel),metalnessMapUv:V&&m(s.metalnessMap.channel),roughnessMapUv:G&&m(s.roughnessMap.channel),anisotropyMapUv:Z&&m(s.anisotropyMap.channel),clearcoatMapUv:J&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:Q&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:re&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:ie&&m(s.sheenRoughnessMap.channel),specularMapUv:se&&m(s.specularMap.channel),specularColorMapUv:ae&&m(s.specularColorMap.channel),specularIntensityMapUv:oe&&m(s.specularIntensityMap.channel),transmissionMapUv:le&&m(s.transmissionMap.channel),thicknessMapUv:ce&&m(s.thicknessMap.channel),alphaMapUv:he&&m(s.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(F||W),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!b.attributes.uv&&(O||he),fog:!!_,useFog:!0===s.fog,fogExp2:!!_&&_.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:C,morphTextureStride:R,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:me,decodeVideoTexture:O&&!0===s.map.isVideoTexture&&MA.getTransfer(s.map.colorSpace)===jC,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:pe&&!0===s.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(pe&&!0===s.extensions.multiDraw||D)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return ge.vertexUv1s=c.has(1),ge.vertexUv2s=c.has(2),ge.vertexUv3s=c.has(3),c.clear(),ge},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0),t.instancing&&o.enable(1),t.instancingColor&&o.enable(2),t.instancingMorph&&o.enable(3),t.matcap&&o.enable(4),t.envMap&&o.enable(5),t.normalMapObjectSpace&&o.enable(6),t.normalMapTangentSpace&&o.enable(7),t.clearcoat&&o.enable(8),t.iridescence&&o.enable(9),t.alphaTest&&o.enable(10),t.vertexColors&&o.enable(11),t.vertexAlphas&&o.enable(12),t.vertexUv1s&&o.enable(13),t.vertexUv2s&&o.enable(14),t.vertexUv3s&&o.enable(15),t.vertexTangents&&o.enable(16),t.anisotropy&&o.enable(17),t.alphaHash&&o.enable(18),t.batching&&o.enable(19),t.dispersion&&o.enable(20),t.batchingColor&&o.enable(21),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.doubleSided&&o.enable(10),t.flipSided&&o.enable(11),t.useDepthPacking&&o.enable(12),t.dithering&&o.enable(13),t.transmission&&o.enable(14),t.sheen&&o.enable(15),t.opaque&&o.enable(16),t.pointsUvs&&o.enable(17),t.decodeVideoTexture&&o.enable(18),t.alphaToCoverage&&o.enable(19),e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=yT[t];n=Zk.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=u.length;e<t;e++){const t=u[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new SP(e,n,t,s),u.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function MP(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function kP(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function TP(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function RP(){const e=[];let t=0;const n=[],r=[],i=[];function s(n,r,i,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?r.push(u):!0===a.transparent?i.push(u):n.push(u)},unshift:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?r.unshift(u):!0===a.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||kP),r.length>1&&r.sort(t||TP),i.length>1&&i.sort(t||TP)}}}function PP(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new RP,e.set(t,[i])):n>=r.length?(i=new RP,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function IP(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new VA,color:new ck};break;case"SpotLight":n={position:new VA,direction:new VA,color:new ck,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new VA,color:new ck,distance:0,decay:0};break;case"HemisphereLight":n={direction:new VA,skyColor:new ck,groundColor:new ck};break;case"RectAreaLight":n={color:new ck,position:new VA,halfWidth:new VA,halfHeight:new VA}}return e[t.id]=n,n}}}let DP=0;function OP(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function LP(e){const t=new IP,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mA};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mA,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new VA);const i=new VA,s=new bM,a=new bM;return{setup:function(i){let s=0,a=0,o=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,f=0,p=0,m=0,g=0,v=0,_=0;i.sort(OP);for(let e=0,b=i.length;e<b;e++){const b=i[e],y=b.color,w=b.intensity,S=b.distance,x=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)s+=y.r*w,a+=y.g*w,o+=y.b*w;else if(b.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(b.sh.coefficients[e],w);_++}else if(b.isDirectionalLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[l]=t,r.directionalShadowMap[l]=x,r.directionalShadowMatrix[l]=b.shadow.matrix,f++}r.directional[l]=e,l++}else if(b.isSpotLight){const e=t.get(b);e.position.setFromMatrixPosition(b.matrixWorld),e.color.copy(y).multiplyScalar(w),e.distance=S,e.coneCos=Math.cos(b.angle),e.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),e.decay=b.decay,r.spot[u]=e;const i=b.shadow;if(b.map&&(r.spotLightMap[g]=b.map,g++,i.updateMatrices(b),b.castShadow&&v++),r.spotLightMatrix[u]=i.matrix,b.castShadow){const e=n.get(b);e.shadowIntensity=i.intensity,e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=x,m++}u++}else if(b.isRectAreaLight){const e=t.get(b);e.color.copy(y).multiplyScalar(w),e.halfWidth.set(.5*b.width,0,0),e.halfHeight.set(0,.5*b.height,0),r.rectArea[h]=e,h++}else if(b.isPointLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),e.distance=b.distance,e.decay=b.decay,b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[c]=t,r.pointShadowMap[c]=x,r.pointShadowMatrix[c]=b.shadow.matrix,p++}r.point[c]=e,c++}else if(b.isHemisphereLight){const e=t.get(b);e.skyColor.copy(b.color).multiplyScalar(w),e.groundColor.copy(b.groundColor).multiplyScalar(w),r.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=bT.LTC_FLOAT_1,r.rectAreaLTC2=bT.LTC_FLOAT_2):(r.rectAreaLTC1=bT.LTC_HALF_1,r.rectAreaLTC2=bT.LTC_HALF_2)),r.ambient[0]=s,r.ambient[1]=a,r.ambient[2]=o;const b=r.hash;b.directionalLength===l&&b.pointLength===c&&b.spotLength===u&&b.rectAreaLength===h&&b.hemiLength===d&&b.numDirectionalShadows===f&&b.numPointShadows===p&&b.numSpotShadows===m&&b.numSpotMaps===g&&b.numLightProbes===_||(r.directional.length=l,r.spot.length=u,r.rectArea.length=h,r.point.length=c,r.hemi.length=d,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=p,r.pointShadowMap.length=p,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=p,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=_,b.directionalLength=l,b.pointLength=c,b.spotLength=u,b.rectAreaLength=h,b.hemiLength=d,b.numDirectionalShadows=f,b.numPointShadows=p,b.numSpotShadows=m,b.numSpotMaps=g,b.numLightProbes=_,r.version=DP++)},setupView:function(e,t){let n=0,o=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=r.point[o];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),o++}else if(d.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),u++}}},state:r}}function BP(e){const t=new LP(e),n=[],r=[],i={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,n.length=0,r.length=0},state:i,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function NP(e){let t=new WeakMap;return{get:function(n,r=0){const i=t.get(n);let s;return void 0===i?(s=new BP(e),t.set(n,[s])):r>=i.length?(s=new BP(e),i.push(s)):s=i[r],s},dispose:function(){t=new WeakMap}}}class UP extends dk{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class HP extends dk{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function FP(e,t,n){let r=new pT;const i=new mA,s=new mA,a=new NA,o=new UP({depthPacking:3201}),l=new HP,c={},u=n.maxTextureSize,h={[sE]:1,[aE]:0,[oE]:2},d=new Jk({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mA},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Mk;p.setAttribute("position",new gk(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Wk(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function _(n,r){const s=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new HA(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,s,d,m,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,s,f,m,null)}function b(t,n,r,i){let s=null;const a=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===r.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=s.clone(),r[t]=i,n.addEventListener("dispose",w)),s=i}return s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial&&(e.properties.get(s).light=r),s}function y(n,i,s,a,o){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=b(n,h,a,o);n.onBeforeShadow(e,n,i,s,r,t,u),e.renderBufferDirect(s,null,r,t,n,u),n.onAfterShadow(e,n,i,s,r,t,u)}}}else if(l.visible){const t=b(n,l,a,o);n.onBeforeShadow(e,n,i,s,r,t,null),e.renderBufferDirect(s,null,r,t,n,null),n.onAfterShadow(e,n,i,s,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)y(l[e],i,s,a,o)}function w(e){e.target.removeEventListener("dispose",w);for(const t in c){const n=c[t],r=e.target.uuid;r in n&&(n[r].dispose(),delete n[r])}}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const f=3!==v&&3===this.type,p=3===v&&3!==this.type;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const m=h.getFrameExtents();if(i.multiply(m),s.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/m.x),i.x=s.x*m.x,h.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/m.y),i.y=s.y*m.y,h.mapSize.y=s.y)),null===h.map||!0===f||!0===p){const e=3!==this.type?{minFilter:DE,magFilter:DE}:{};null!==h.map&&h.map.dispose(),h.map=new HA(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const g=h.getViewportCount();for(let e=0;e<g;e++){const t=h.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(a),h.updateMatrices(c,e),r=h.getFrustum(),y(n,o,h.camera,c,this.type)}!0!==h.isPointLightShadow&&3===this.type&&_(h,o),h.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function jP(e){const t=new function(){let t=!1;const n=new NA;let r=null;const i=new NA(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,s,a,o){!0===o&&(t*=a,r*=a,s*=a),n.set(t,r,s,a),!1===i.equals(n)&&(e.clearColor(t,r,s,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},n=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?H(e.DEPTH_TEST):F(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},r=new function(){let t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?H(e.STENCIL_TEST):F(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&s===a||(e.stencilFunc(t,n,a),r=t,i=n,s=a)},setOp:function(t,n,r){a===t&&o===n&&l===r||(e.stencilOp(t,n,r),a=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,c=null}}},i=new WeakMap,s=new WeakMap;let a={},o={},l=new WeakMap,c=[],u=null,h=!1,d=null,f=null,p=null,m=null,g=null,v=null,_=null,b=new ck(0,0,0),y=0,w=!1,S=null,x=null,E=null,C=null,A=null;const M=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,T=0;const R=e.getParameter(e.VERSION);-1!==R.indexOf("WebGL")?(T=parseFloat(/^WebGL (\d)/.exec(R)[1]),k=T>=1):-1!==R.indexOf("OpenGL ES")&&(T=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),k=T>=2);let P=null,I={};const D=e.getParameter(e.SCISSOR_BOX),O=e.getParameter(e.VIEWPORT),L=(new NA).fromArray(D),B=(new NA).fromArray(O);function N(t,n,r,i){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<r;a++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const U={};function H(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function F(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}U[e.TEXTURE_2D]=N(e.TEXTURE_2D,e.TEXTURE_2D,1),U[e.TEXTURE_CUBE_MAP]=N(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),U[e.TEXTURE_2D_ARRAY]=N(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),U[e.TEXTURE_3D]=N(e.TEXTURE_3D,e.TEXTURE_3D,1,1),t.setClear(0,0,0,1),n.setClear(1),r.setClear(0),H(e.DEPTH_TEST),n.setFunc(3),G(!1),W(1),H(e.CULL_FACE),V(0);const j={[lE]:e.FUNC_ADD,[cE]:e.FUNC_SUBTRACT,[uE]:e.FUNC_REVERSE_SUBTRACT};j[103]=e.MIN,j[104]=e.MAX;const z={[hE]:e.ZERO,[dE]:e.ONE,[fE]:e.SRC_COLOR,[mE]:e.SRC_ALPHA,[wE]:e.SRC_ALPHA_SATURATE,[bE]:e.DST_COLOR,[vE]:e.DST_ALPHA,[pE]:e.ONE_MINUS_SRC_COLOR,[gE]:e.ONE_MINUS_SRC_ALPHA,[yE]:e.ONE_MINUS_DST_COLOR,[_E]:e.ONE_MINUS_DST_ALPHA,[SE]:e.CONSTANT_COLOR,[xE]:e.ONE_MINUS_CONSTANT_COLOR,[EE]:e.CONSTANT_ALPHA,[CE]:e.ONE_MINUS_CONSTANT_ALPHA};function V(t,n,r,i,s,a,o,l,c,u){if(0!==t){if(!1===h&&(H(e.BLEND),h=!0),5===t)s=s||n,a=a||r,o=o||i,n===f&&s===g||(e.blendEquationSeparate(j[n],j[s]),f=n,g=s),r===p&&i===m&&a===v&&o===_||(e.blendFuncSeparate(z[r],z[i],z[a],z[o]),p=r,m=i,v=a,_=o),!1!==l.equals(b)&&c===y||(e.blendColor(l.r,l.g,l.b,c),b.copy(l),y=c),d=t,w=!1;else if(t!==d||u!==w){if(f===lE&&g===lE||(e.blendEquation(e.FUNC_ADD),f=lE,g=lE),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}p=null,m=null,v=null,_=null,b.set(0,0,0),y=0,d=t,w=u}}else!0===h&&(F(e.BLEND),h=!1)}function G(t){S!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),S=t)}function W(t){0!==t?(H(e.CULL_FACE),t!==x&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):F(e.CULL_FACE),x=t}function q(t,n,r){t?(H(e.POLYGON_OFFSET_FILL),C===n&&A===r||(e.polygonOffset(n,r),C=n,A=r)):F(e.POLYGON_OFFSET_FILL)}return{buffers:{color:t,depth:n,stencil:r},enable:H,disable:F,bindFramebuffer:function(t,n){return o[t]!==n&&(e.bindFramebuffer(t,n),o[t]=n,t===e.DRAW_FRAMEBUFFER&&(o[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(o[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=c,i=!1;if(t){r=l.get(n),void 0===r&&(r=[],l.set(n,r));const s=t.textures;if(r.length!==s.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=s.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=s.length,i=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,i=!0);i&&e.drawBuffers(r)},useProgram:function(t){return u!==t&&(e.useProgram(t),u=t,!0)},setBlending:V,setMaterial:function(i,s){2===i.side?F(e.CULL_FACE):H(e.CULL_FACE);let a=1===i.side;s&&(a=!a),G(a),1===i.blending&&!1===i.transparent?V(0):V(i.blending,i.blendEquation,i.blendSrc,i.blendDst,i.blendEquationAlpha,i.blendSrcAlpha,i.blendDstAlpha,i.blendColor,i.blendAlpha,i.premultipliedAlpha),n.setFunc(i.depthFunc),n.setTest(i.depthTest),n.setMask(i.depthWrite),t.setMask(i.colorWrite);const o=i.stencilWrite;r.setTest(o),o&&(r.setMask(i.stencilWriteMask),r.setFunc(i.stencilFunc,i.stencilRef,i.stencilFuncMask),r.setOp(i.stencilFail,i.stencilZFail,i.stencilZPass)),q(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),!0===i.alphaToCoverage?H(e.SAMPLE_ALPHA_TO_COVERAGE):F(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:G,setCullFace:W,setLineWidth:function(t){t!==E&&(k&&e.lineWidth(t),E=t)},setPolygonOffset:q,setScissorTest:function(t){t?H(e.SCISSOR_TEST):F(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+M-1),P!==t&&(e.activeTexture(t),P=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===P?e.TEXTURE0+M-1:P);let i=I[r];void 0===i&&(i={type:void 0,texture:void 0},I[r]=i),i.type===t&&i.texture===n||(P!==r&&(e.activeTexture(r),P=r),e.bindTexture(t,n||U[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=I[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let r=s.get(n);void 0===r&&(r=new WeakMap,s.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=s.get(n).get(t);i.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),i.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===L.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),L.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),a={},P=null,I={},o={},l=new WeakMap,c=[],u=null,h=!1,d=null,f=null,p=null,m=null,g=null,v=null,_=null,b=new ck(0,0,0),y=0,w=!1,S=null,x=null,E=null,C=null,A=null,L.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),t.reset(),n.reset(),r.reset()}}}function zP(e,t,n,r){const i=function(e){switch(e){case HE:case 1010:return{byteLength:1,components:1};case FE:case 1011:case GE:return{byteLength:2,components:1};case WE:case qE:return{byteLength:2,components:4};case zE:case jE:case VE:return{byteLength:4,components:1};case 35902:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(r);switch(n){case 1021:case 1024:return e*t;case 1025:return e*t*2;case ZE:case JE:return e*t/i.components*i.byteLength;case 1030:case QE:return e*t*2/i.components*i.byteLength;case 1022:return e*t*3/i.components*i.byteLength;case $E:case eC:return e*t*4/i.components*i.byteLength;case tC:case nC:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case rC:case iC:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case aC:case lC:return Math.max(e,16)*Math.max(t,8)/4;case sC:case oC:return Math.max(e,8)*Math.max(t,8)/2;case cC:case uC:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case hC:case dC:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case fC:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case pC:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case mC:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case gC:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case vC:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case _C:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case bC:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case yC:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case wC:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case SC:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case xC:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case EC:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case CC:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case AC:case MC:case kC:return Math.ceil(e/4)*Math.ceil(t/4)*16;case 36283:case TC:return Math.ceil(e/4)*Math.ceil(t/4)*8;case RC:case PC:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function VP(e,t,n,r,i,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new mA,u=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function p(e,t){return f?new OffscreenCanvas(e,t):bA("canvas")}function m(e,t,n){let r=1;const i=F(e);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*i.width),s=Math.floor(r*i.height);void 0===h&&(h=p(n,s));const a=t?p(n,s):h;return a.width=n,a.height=s,a.getContext("2d").drawImage(e,0,0,n,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),e}return e}function g(e){return e.generateMipmaps&&e.minFilter!==DE&&e.minFilter!==BE}function v(t){e.generateMipmap(t)}function _(n,r,i,s,a=!1){if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;if(r===e.RED&&(i===e.FLOAT&&(o=e.R32F),i===e.HALF_FLOAT&&(o=e.R16F),i===e.UNSIGNED_BYTE&&(o=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.R8UI),i===e.UNSIGNED_SHORT&&(o=e.R16UI),i===e.UNSIGNED_INT&&(o=e.R32UI),i===e.BYTE&&(o=e.R8I),i===e.SHORT&&(o=e.R16I),i===e.INT&&(o=e.R32I)),r===e.RG&&(i===e.FLOAT&&(o=e.RG32F),i===e.HALF_FLOAT&&(o=e.RG16F),i===e.UNSIGNED_BYTE&&(o=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RG8UI),i===e.UNSIGNED_SHORT&&(o=e.RG16UI),i===e.UNSIGNED_INT&&(o=e.RG32UI),i===e.BYTE&&(o=e.RG8I),i===e.SHORT&&(o=e.RG16I),i===e.INT&&(o=e.RG32I)),r===e.RGB&&i===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),r===e.RGBA){const t=a?FC:MA.getTransfer(s);i===e.FLOAT&&(o=e.RGBA32F),i===e.HALF_FLOAT&&(o=e.RGBA16F),i===e.UNSIGNED_BYTE&&(o=t===jC?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function b(t,n){let r;return t?null===n||n===zE||n===KE?r=e.DEPTH24_STENCIL8:n===VE?r=e.DEPTH32F_STENCIL8:n===FE&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===zE||n===KE?r=e.DEPTH_COMPONENT24:n===VE?r=e.DEPTH_COMPONENT32F:n===FE&&(r=e.DEPTH_COMPONENT16),r}function y(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==DE&&e.minFilter!==BE?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=d.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&x(e),0===Object.keys(i).length&&d.delete(n)}r.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function S(t){const n=t.target;n.removeEventListener("dispose",S),function(t){const n=r.get(t);if(t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(n.__webglFramebuffer[t]))for(let r=0;r<n.__webglFramebuffer[t].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[t][r]);else e.deleteFramebuffer(n.__webglFramebuffer[t]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=t.textures;for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),a.memory.textures--),r.remove(i[t])}r.remove(t)}(n)}function x(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete d.get(i)[n.__cacheKey],a.memory.textures--}let E=0;function C(t,i){const s=r.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void P(s,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+i)}const A={[RE]:e.REPEAT,[PE]:e.CLAMP_TO_EDGE,[IE]:e.MIRRORED_REPEAT},M={[DE]:e.NEAREST,[OE]:e.NEAREST_MIPMAP_NEAREST,[LE]:e.NEAREST_MIPMAP_LINEAR,[BE]:e.LINEAR,[NE]:e.LINEAR_MIPMAP_NEAREST,[UE]:e.LINEAR_MIPMAP_LINEAR},k={[WC]:e.NEVER,[JC]:e.ALWAYS,[qC]:e.LESS,[$C]:e.LEQUAL,[KC]:e.EQUAL,[ZC]:e.GEQUAL,[XC]:e.GREATER,[YC]:e.NOTEQUAL};function T(n,s){if(s.type!==VE||!1!==t.has("OES_texture_float_linear")||s.magFilter!==BE&&s.magFilter!==NE&&s.magFilter!==LE&&s.magFilter!==UE&&s.minFilter!==BE&&s.minFilter!==NE&&s.minFilter!==LE&&s.minFilter!==UE||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,A[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,A[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,A[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,M[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,M[s.minFilter]),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,k[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(s.magFilter===DE)return;if(s.minFilter!==LE&&s.minFilter!==UE)return;if(s.type===VE&&!1===t.has("OES_texture_float_linear"))return;if(s.anisotropy>1||r.get(s).__currentAnisotropy){const a=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy}}}function R(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const i=n.source;let s=d.get(i);void 0===s&&(s={},d.set(i,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,r=!0),s[o].usedTimes++;const i=s[t.__cacheKey];void 0!==i&&(s[t.__cacheKey].usedTimes--,0===i.usedTimes&&x(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return r}function P(t,a,o){let l=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=e.TEXTURE_3D);const c=R(t,a),u=a.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=r.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=MA.getPrimaries(MA.workingColorSpace),r=a.colorSpace===LC?null:MA.getPrimaries(a.colorSpace),d=a.colorSpace===LC||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let f=m(a.image,!1,i.maxTextureSize);f=H(a,f);const p=s.convert(a.format,a.colorSpace),w=s.convert(a.type);let S,x=_(a.internalFormat,p,w,a.colorSpace,a.isVideoTexture);T(l,a);const E=a.mipmaps,C=!0!==a.isVideoTexture,A=void 0===h.__version||!0===c,M=u.dataReady,k=y(a,f);if(a.isDepthTexture)x=b(a.format===YE,a.type),A&&(C?n.texStorage2D(e.TEXTURE_2D,1,x,f.width,f.height):n.texImage2D(e.TEXTURE_2D,0,x,f.width,f.height,0,p,w,null));else if(a.isDataTexture)if(E.length>0){C&&A&&n.texStorage2D(e.TEXTURE_2D,k,x,E[0].width,E[0].height);for(let t=0,r=E.length;t<r;t++)S=E[t],C?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,w,S.data):n.texImage2D(e.TEXTURE_2D,t,x,S.width,S.height,0,p,w,S.data);a.generateMipmaps=!1}else C?(A&&n.texStorage2D(e.TEXTURE_2D,k,x,f.width,f.height),M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f.width,f.height,p,w,f.data)):n.texImage2D(e.TEXTURE_2D,0,x,f.width,f.height,0,p,w,f.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){C&&A&&n.texStorage3D(e.TEXTURE_2D_ARRAY,k,x,E[0].width,E[0].height,f.depth);for(let t=0,r=E.length;t<r;t++)if(S=E[t],a.format!==$E)if(null!==p)if(C){if(M)if(a.layerUpdates.size>0){const r=zP(S.width,S.height,a.format,a.type);for(const i of a.layerUpdates){const s=S.data.subarray(i*r/S.data.BYTES_PER_ELEMENT,(i+1)*r/S.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,i,S.width,S.height,1,p,s,0,0)}a.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,f.depth,p,S.data,0,0)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,x,S.width,S.height,f.depth,0,S.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else C?M&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,f.depth,p,w,S.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,x,S.width,S.height,f.depth,0,p,w,S.data)}else{C&&A&&n.texStorage2D(e.TEXTURE_2D,k,x,E[0].width,E[0].height);for(let t=0,r=E.length;t<r;t++)S=E[t],a.format!==$E?null!==p?C?M&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,S.data):n.compressedTexImage2D(e.TEXTURE_2D,t,x,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,w,S.data):n.texImage2D(e.TEXTURE_2D,t,x,S.width,S.height,0,p,w,S.data)}else if(a.isDataArrayTexture)if(C){if(A&&n.texStorage3D(e.TEXTURE_2D_ARRAY,k,x,f.width,f.height,f.depth),M)if(a.layerUpdates.size>0){const t=zP(f.width,f.height,a.format,a.type);for(const r of a.layerUpdates){const i=f.data.subarray(r*t/f.data.BYTES_PER_ELEMENT,(r+1)*t/f.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,f.width,f.height,1,p,w,i)}a.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,f.width,f.height,f.depth,p,w,f.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,x,f.width,f.height,f.depth,0,p,w,f.data);else if(a.isData3DTexture)C?(A&&n.texStorage3D(e.TEXTURE_3D,k,x,f.width,f.height,f.depth),M&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,f.width,f.height,f.depth,p,w,f.data)):n.texImage3D(e.TEXTURE_3D,0,x,f.width,f.height,f.depth,0,p,w,f.data);else if(a.isFramebufferTexture){if(A)if(C)n.texStorage2D(e.TEXTURE_2D,k,x,f.width,f.height);else{let t=f.width,r=f.height;for(let i=0;i<k;i++)n.texImage2D(e.TEXTURE_2D,i,x,t,r,0,p,w,null),t>>=1,r>>=1}}else if(E.length>0){if(C&&A){const t=F(E[0]);n.texStorage2D(e.TEXTURE_2D,k,x,t.width,t.height)}for(let t=0,r=E.length;t<r;t++)S=E[t],C?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,p,w,S):n.texImage2D(e.TEXTURE_2D,t,x,p,w,S);a.generateMipmaps=!1}else if(C){if(A){const t=F(f);n.texStorage2D(e.TEXTURE_2D,k,x,t.width,t.height)}M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p,w,f)}else n.texImage2D(e.TEXTURE_2D,0,x,p,w,f);g(a)&&v(l),h.__version=u.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function I(t,i,a,l,c,u){const h=s.convert(a.format,a.colorSpace),d=s.convert(a.type),f=_(a.internalFormat,h,d,a.colorSpace);if(!r.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>u),r=Math.max(1,i.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,f,t,r,i.depth,0,h,d,null):n.texImage2D(c,u,f,t,r,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),U(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,r.get(a).__webglTexture,0,N(i)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,r.get(a).__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function D(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const i=n.depthTexture,s=i&&i.isDepthTexture?i.type:null,a=b(n.stencilBuffer,s),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=N(n);U(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,a,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,a,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const a=t[i],l=s.convert(a.format,a.colorSpace),c=s.convert(a.type),u=_(a.internalFormat,l,c,a.colorSpace),h=N(n);r&&!1===U(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):U(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t){const i=r.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),C(i.depthTexture,0);const s=r.get(i.depthTexture).__webglTexture,a=N(i);if(i.depthTexture.format===XE)U(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(i.depthTexture.format!==YE)throw new Error("Unknown depthTexture format");U(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(i.__webglFramebuffer,t)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),D(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),D(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}const L=[],B=[];function N(e){return Math.min(i.maxSamples,e.samples)}function U(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,t){const n=e.colorSpace,r=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==NC&&n!==LC&&(MA.getTransfer(n)===jC?r===$E&&i===HE||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function F(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=E;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=C,this.setTexture2DArray=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?P(s,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?P(s,t,i):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,a){const o=r.get(t);t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;const l=R(t,a),c=a.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const u=r.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=MA.getPrimaries(MA.workingColorSpace),r=a.colorSpace===LC?null:MA.getPrimaries(a.colorSpace),h=a.colorSpace===LC||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=a.isCompressedTexture||a.image[0].isCompressedTexture,f=a.image[0]&&a.image[0].isDataTexture,p=[];for(let e=0;e<6;e++)p[e]=d||f?f?a.image[e].image:a.image[e]:m(a.image[e],!0,i.maxCubemapSize),p[e]=H(a,p[e]);const b=p[0],w=s.convert(a.format,a.colorSpace),S=s.convert(a.type),x=_(a.internalFormat,w,S,a.colorSpace),E=!0!==a.isVideoTexture,C=void 0===u.__version||!0===l,A=c.dataReady;let M,k=y(a,b);if(T(e.TEXTURE_CUBE_MAP,a),d){E&&C&&n.texStorage2D(e.TEXTURE_CUBE_MAP,k,x,b.width,b.height);for(let t=0;t<6;t++){M=p[t].mipmaps;for(let r=0;r<M.length;r++){const i=M[r];a.format!==$E?null!==w?E?A&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,w,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,x,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):E?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,w,S,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,x,i.width,i.height,0,w,S,i.data)}}}else{if(M=a.mipmaps,E&&C){M.length>0&&k++;const t=F(p[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,k,x,t.width,t.height)}for(let t=0;t<6;t++)if(f){E?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,p[t].width,p[t].height,w,S,p[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,x,p[t].width,p[t].height,0,w,S,p[t].data);for(let r=0;r<M.length;r++){const i=M[r].image[t].image;E?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,w,S,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,x,i.width,i.height,0,w,S,i.data)}}else{E?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,w,S,p[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,x,w,S,p[t]);for(let r=0;r<M.length;r++){const i=M[r];E?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,w,S,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,x,w,S,i.image[t])}}}g(a)&&v(e.TEXTURE_CUBE_MAP),u.__version=c.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,n,i){const s=r.get(t);void 0!==n&&I(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&O(t)},this.setupRenderTarget=function(t){const i=t.texture,o=r.get(t),l=r.get(i);t.addEventListener("dispose",S);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=i.version,a.memory.textures++),u){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<i.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=r.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}if(t.samples>0&&!1===U(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const r=c[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const i=s.convert(r.format,r.colorSpace),a=s.convert(r.type),l=_(r.internalFormat,i,a,r.colorSpace,!0===t.isXRRenderTarget),u=N(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),D(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),T(e.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)I(o.__webglFramebuffer[n][r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else I(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let i=0,s=c.length;i<s;i++){const s=c[i],a=r.get(s);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),T(e.TEXTURE_2D,s),I(o.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,0),g(s)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),T(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)I(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,r,n);else I(o.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,r,0);g(i)&&v(r),n.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(t){const i=t.textures;for(let s=0,a=i.length;s<a;s++){const a=i[s];if(g(a)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=r.get(a).__webglTexture;n.bindTexture(i,s),v(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===U(t)){const i=t.textures,s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),h=i.length>1;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),!0===l&&(L.length=0,B.length=0,L.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(L.push(c),B.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,B)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,L))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=I,this.useMultisampledRTT=U}function GP(e,t){return{convert:function(n,r=""){let i;const s=MA.getTransfer(r);if(n===HE)return e.UNSIGNED_BYTE;if(n===WE)return e.UNSIGNED_SHORT_4_4_4_4;if(n===qE)return e.UNSIGNED_SHORT_5_5_5_1;if(35902===n)return e.UNSIGNED_INT_5_9_9_9_REV;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===FE)return e.UNSIGNED_SHORT;if(n===jE)return e.INT;if(n===zE)return e.UNSIGNED_INT;if(n===VE)return e.FLOAT;if(n===GE)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(1022===n)return e.RGB;if(n===$E)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===XE)return e.DEPTH_COMPONENT;if(n===YE)return e.DEPTH_STENCIL;if(n===ZE)return e.RED;if(n===JE)return e.RED_INTEGER;if(1030===n)return e.RG;if(n===QE)return e.RG_INTEGER;if(n===eC)return e.RGBA_INTEGER;if(n===tC||n===nC||n===rC||n===iC)if(s===jC){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===tC)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===nC)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===rC)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===iC)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===tC)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===nC)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===rC)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===iC)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===sC||n===aC||n===oC||n===lC){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===sC)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===aC)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===oC)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===lC)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===cC||n===uC||n===hC){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===cC||n===uC)return s===jC?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===hC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===dC||n===fC||n===pC||n===mC||n===gC||n===vC||n===_C||n===bC||n===yC||n===wC||n===SC||n===xC||n===EC||n===CC){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===dC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===fC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===pC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===mC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===gC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===vC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===_C)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===bC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===yC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===wC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===SC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===xC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===EC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===CC)return s===jC?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===AC||n===MC||n===kC){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===AC)return s===jC?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===MC)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===kC)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===TC||n===RC||n===PC){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===AC)return i.COMPRESSED_RED_RGTC1_EXT;if(n===TC)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===RC)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===PC)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===KE?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class WP extends rT{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class qP extends qM{constructor(){super(),this.isGroup=!0,this.type="Group"}}const KP={type:"move"};class $P{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new qP,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new qP,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new VA,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new VA),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new qP,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new VA,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new VA),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n),i=this._getHandJoint(l,r);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],a=r.position.distanceTo(i.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(KP)))}return null!==a&&(a.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new qP;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class XP{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const r=new BA;e.properties.get(r).__webglTexture=t.texture,t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Jk({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Wk(new vT(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class YP extends rA{constructor(e,t){super();const n=this;let r=null,i=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,f=null;const p=new XP,m=t.getContextAttributes();let g=null,v=null;const _=[],b=[],y=new mA;let w=null;const S=new rT;S.layers.enable(1),S.viewport=new NA;const x=new rT;x.layers.enable(2),x.viewport=new NA;const E=[S,x],C=new WP;C.layers.enable(1),C.layers.enable(2);let A=null,M=null;function k(e){const t=b.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function T(){r.removeEventListener("select",k),r.removeEventListener("selectstart",k),r.removeEventListener("selectend",k),r.removeEventListener("squeeze",k),r.removeEventListener("squeezestart",k),r.removeEventListener("squeezeend",k),r.removeEventListener("end",T),r.removeEventListener("inputsourceschange",R);for(let e=0;e<_.length;e++){const t=b[e];null!==t&&(b[e]=null,_[e].disconnect(t))}A=null,M=null,p.reset(),e.setRenderTarget(g),d=null,h=null,u=null,r=null,v=null,L.stop(),n.isPresenting=!1,e.setPixelRatio(w),e.setSize(y.width,y.height,!1),n.dispatchEvent({type:"sessionend"})}function R(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=b.indexOf(n);r>=0&&(b[r]=null,_[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=b.indexOf(n);if(-1===r){for(let e=0;e<_.length;e++){if(e>=b.length){b.push(n),r=e;break}if(null===b[e]){b[e]=n,r=e;break}}if(-1===r)break}const i=_[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new $P,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new $P,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new $P,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(g=e.getRenderTarget(),r.addEventListener("select",k),r.addEventListener("selectstart",k),r.addEventListener("selectend",k),r.addEventListener("squeeze",k),r.addEventListener("squeezestart",k),r.addEventListener("squeezeend",k),r.addEventListener("end",T),r.addEventListener("inputsourceschange",R),!0!==m.xrCompatible&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(y),void 0===r.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new HA(d.framebufferWidth,d.framebufferHeight,{format:$E,type:HE,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,s=null,a=null;m.depth&&(a=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?YE:XE,s=m.stencil?KE:zE);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:i};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(o),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),v=new HA(h.textureWidth,h.textureHeight,{format:$E,type:HE,depthTexture:new QT(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),L.setContext(r),L.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return p.getDepthTexture()};const P=new VA,I=new VA;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;null!==p.texture&&(e.near=p.depthNear,e.far=p.depthFar),C.near=x.near=S.near=e.near,C.far=x.far=S.far=e.far,A===C.near&&M===C.far||(r.updateRenderState({depthNear:C.near,depthFar:C.far}),A=C.near,M=C.far,S.near=A,S.far=M,x.near=A,x.far=M,S.updateProjectionMatrix(),x.updateProjectionMatrix(),e.updateProjectionMatrix());const t=e.parent,n=C.cameras;D(C,t);for(let e=0;e<n.length;e++)D(n[e],t);2===n.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(n.matrixWorld);const r=P.distanceTo(I),i=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],d=a*u,f=a*h,p=r/(-u+h),m=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+p,v=o+p,_=d-m,b=f+(r-m),y=l*o/v*g,w=c*o/v*g;e.projectionMatrix.makePerspective(_,b,y,w,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(C,S,x):C.projectionMatrix.copy(S.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*aA*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,C,t)},this.getCamera=function(){return C},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==p.texture},this.getDepthSensingMesh=function(){return p.getMesh(C)};let O=null;const L=new mT;L.setAnimationLoop(function(t,i){if(c=i.getViewerPose(l||s),f=i,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==C.cameras.length&&(C.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let s=null;if(null!==d)s=d.getViewport(i);else{const t=u.getViewSubImage(h,i);s=t.viewport,0===r&&(e.setRenderTargetTextures(v,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let a=E[r];void 0===a&&(a=new rT,a.layers.enable(r),a.viewport=new NA,E[r]=a),a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(i.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===r&&(C.matrix.copy(a.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),!0===n&&C.cameras.push(a)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")){const n=u.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&p.init(e,n,r.renderState)}}for(let e=0;e<_.length;e++){const t=b[e],n=_[e];null!==t&&void 0!==n&&n.update(t,i,l||s)}O&&O(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),f=null}),this.setAnimationLoop=function(e){O=e},this.dispose=function(){}}}const ZP=new TM,JP=new bM;function QP(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const i=t.get(r),s=i.envMap,a=i.envMapRotation;s&&(e.envMap.value=s,ZP.copy(a),ZP.x*=-1,ZP.y*=-1,ZP.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(ZP.y*=-1,ZP.z*=-1),e.envMapRotation.value.setFromMatrix4(JP.makeRotationFromEuler(ZP)),e.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Yk(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,s,a,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform)),e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform)),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate())),t.dispersion>0&&(e.dispersion.value=t.dispersion),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,s,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function eI(e,t,n,r){let i={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,r){const i=e.value,s=t+"_"+n;if(void 0===r[s])return r[s]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const e=r[s];if("number"==typeof i||"boolean"==typeof i){if(e!==i)return r[s]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=a.indexOf(n.__bindingPointIndex);a.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let d=i[n.id];void 0===d&&(function(e){const t=e.uniforms;let n=0;for(let e=0,r=t.length;e<r;e++){const r=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=r.length;e<t;e++){const t=r[e],i=Array.isArray(t.value)?t.value:[t.value];for(let e=0,r=i.length;e<r;e++){const r=c(i[e]),s=n%16,a=s%r.boundary,o=s+a;n+=a,0!==o&&16-o<r.storage&&(n+=16-o),t.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=n,n+=r.storage}}}const r=n%16;r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",u));const f=h.program;r.updateUBOMapping(n,f);const p=t.render.frame;s[n.id]!==p&&(function(t){const n=i[t.id],r=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){const n=Array.isArray(r[t])?r[t]:[r[t]];for(let r=0,i=n.length;r<i;r++){const i=n[r];if(!0===l(i,t,r,s)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const a=n[s],o=c(a);"number"==typeof a||"boolean"==typeof a?(i.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):a.isMatrix3?(i.__data[0]=a.elements[0],i.__data[1]=a.elements[1],i.__data[2]=a.elements[2],i.__data[3]=0,i.__data[4]=a.elements[3],i.__data[5]=a.elements[4],i.__data[6]=a.elements[5],i.__data[7]=0,i.__data[8]=a.elements[6],i.__data[9]=a.elements[7],i.__data[10]=a.elements[8],i.__data[11]=0):(a.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=p)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);a=[],i={},s={}}}}class tI{constructor(e={}){const{canvas:t=yA(),context:n=null,depth:r=!0,stencil:i=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let h;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=n.getContextAttributes().alpha}else h=s;const d=new Uint32Array(4),f=new Int32Array(4);let p=null,m=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=BC,this.toneMapping=0,this.toneMappingExposure=1;const _=this;let b=!1,y=0,w=0,S=null,x=-1,E=null;const C=new NA,A=new NA;let M=null;const k=new ck(0);let T=0,R=t.width,P=t.height,I=1,D=null,O=null;const L=new NA(0,0,R,P),B=new NA(0,0,R,P);let N=!1;const U=new pT;let H=!1,F=!1;const j=new bM,z=new VA,V=new NA,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let W=!1;function q(){return null===S?I:1}let K,$,X,Y,Z,J,Q,ee,te,ne,re,ie,se,ae,oe,le,ce,ue,he,de,fe,pe,me,ge,ve=n;function _e(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:i,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${iE}`),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Se,!1),t.addEventListener("webglcontextcreationerror",xe,!1),null===ve){const t="webgl2";if(ve=_e(t,e),null===ve)throw _e(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function be(){K=new KT(ve),K.init(),pe=new GP(ve,K),$=new MT(ve,K,e,pe),X=new jP(ve),Y=new YT(ve),Z=new MP,J=new VP(ve,K,X,Z,$,pe,Y),Q=new TT(_),ee=new qT(_),te=new gT(ve),me=new CT(ve,te),ne=new $T(ve,te,Y,me),re=new JT(ve,ne,te,Y),he=new ZT(ve,$,J),le=new kT(Z),ie=new AP(_,Q,ee,K,$,me,le),se=new QP(_,Z),ae=new PP,oe=new NP(K),ue=new ET(_,Q,ee,X,re,h,o),ce=new FP(_,re,$),ge=new eI(ve,Y,$,X),de=new AT(ve,K,Y),fe=new XT(ve,K,Y),Y.programs=ie.programs,_.capabilities=$,_.extensions=K,_.properties=Z,_.renderLists=ae,_.shadowMap=ce,_.state=X,_.info=Y}be();const ye=new YP(_,ve);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=Y.autoReset,t=ce.enabled,n=ce.autoUpdate,r=ce.needsUpdate,i=ce.type;be(),Y.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=r,ce.type=i}function xe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ee(e){const t=e.target;t.removeEventListener("dispose",Ee),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach(function(e){ie.releaseProgram(e)}),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Ce(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Le(e,t,n),e.side=0,e.needsUpdate=!0,Le(e,t,n),e.side=2):Le(e,t,n)}this.xr=ye,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const e=K.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=K.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(e){void 0!==e&&(I=e,this.setSize(R,P,!1))},this.getSize=function(e){return e.set(R,P)},this.setSize=function(e,n,r=!0){ye.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=e,P=n,t.width=Math.floor(e*I),t.height=Math.floor(n*I),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(R*I,P*I).floor()},this.setDrawingBufferSize=function(e,n,r){R=e,P=n,I=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,n,r){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,r),X.viewport(C.copy(L).multiplyScalar(I).round())},this.getScissor=function(e){return e.copy(B)},this.setScissor=function(e,t,n,r){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,r),X.scissor(A.copy(B).multiplyScalar(I).round())},this.getScissorTest=function(){return N},this.setScissorTest=function(e){X.setScissorTest(N=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==S){const t=S.texture.format;e=t===eC||t===QE||t===JE}if(e){const e=S.texture.type,t=e===HE||e===zE||e===FE||e===KE||e===WE||e===qE,n=ue.getClearColor(),r=ue.getClearAlpha(),i=n.r,s=n.g,a=n.b;t?(d[0]=i,d[1]=s,d[2]=a,d[3]=r,ve.clearBufferuiv(ve.COLOR,0,d)):(f[0]=i,f[1]=s,f[2]=a,f[3]=r,ve.clearBufferiv(ve.COLOR,0,f))}else r|=ve.COLOR_BUFFER_BIT}t&&(r|=ve.DEPTH_BUFFER_BIT),n&&(r|=ve.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ve.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Se,!1),t.removeEventListener("webglcontextcreationerror",xe,!1),ae.dispose(),oe.dispose(),Z.dispose(),Q.dispose(),ee.dispose(),re.dispose(),me.dispose(),ge.dispose(),ie.dispose(),ye.dispose(),ye.removeEventListener("sessionstart",Me),ye.removeEventListener("sessionend",ke),Te.stop()},this.renderBufferDirect=function(e,t,n,r,i,s){null===t&&(t=G);const a=i.isMesh&&i.matrixWorld.determinant()<0,o=function(e,t,n,r,i){!0!==t.isScene&&(t=G),J.resetTextureUnits();const s=t.fog,a=r.isMeshStandardMaterial?t.environment:null,o=null===S?_.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:NC,l=(r.isMeshStandardMaterial?ee:Q).get(r.envMap||a),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,f=!!n.morphAttributes.color;let p=0;r.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(p=_.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,b=Z.get(r),y=m.state.lights;if(!0===H&&(!0===F||e!==E)){const t=e===E&&r.id===x;le.setState(r,e,t)}let w=!1;r.version===b.__version?b.needsLights&&b.lightsStateVersion!==y.state.version||b.outputColorSpace!==o||i.isBatchedMesh&&!1===b.batching?w=!0:i.isBatchedMesh||!0!==b.batching?i.isBatchedMesh&&!0===b.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===b.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===b.instancing?w=!0:i.isInstancedMesh||!0!==b.instancing?i.isSkinnedMesh&&!1===b.skinning?w=!0:i.isSkinnedMesh||!0!==b.skinning?i.isInstancedMesh&&!0===b.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===b.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===b.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===b.instancingMorph&&null!==i.morphTexture||b.envMap!==l||!0===r.fog&&b.fog!==s?w=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===le.numPlanes&&b.numIntersection===le.numIntersection?(b.vertexAlphas!==c||b.vertexTangents!==u||b.morphTargets!==h||b.morphNormals!==d||b.morphColors!==f||b.toneMapping!==p||b.morphTargetsCount!==v)&&(w=!0):w=!0:w=!0:w=!0:w=!0:(w=!0,b.__version=r.version);let C=b.currentProgram;!0===w&&(C=Le(r,t,i));let A=!1,M=!1,k=!1;const T=C.getUniforms(),R=b.uniforms;if(X.useProgram(C.program)&&(A=!0,M=!0,k=!0),r.id!==x&&(x=r.id,M=!0),A||E!==e){T.setValue(ve,"projectionMatrix",e.projectionMatrix),T.setValue(ve,"viewMatrix",e.matrixWorldInverse);const t=T.map.cameraPosition;void 0!==t&&t.setValue(ve,z.setFromMatrixPosition(e.matrixWorld)),$.logarithmicDepthBuffer&&T.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&T.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),E!==e&&(E=e,M=!0,k=!0)}if(i.isSkinnedMesh){T.setOptional(ve,i,"bindMatrix"),T.setOptional(ve,i,"bindMatrixInverse");const e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),T.setValue(ve,"boneTexture",e.boneTexture,J))}i.isBatchedMesh&&(T.setOptional(ve,i,"batchingTexture"),T.setValue(ve,"batchingTexture",i._matricesTexture,J),T.setOptional(ve,i,"batchingIdTexture"),T.setValue(ve,"batchingIdTexture",i._indirectTexture,J),T.setOptional(ve,i,"batchingColorTexture"),null!==i._colorsTexture&&T.setValue(ve,"batchingColorTexture",i._colorsTexture,J));const D=n.morphAttributes;if(void 0===D.position&&void 0===D.normal&&void 0===D.color||he.update(i,n,C),(M||b.receiveShadow!==i.receiveShadow)&&(b.receiveShadow=i.receiveShadow,T.setValue(ve,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(R.envMapIntensity.value=t.environmentIntensity),M&&(T.setValue(ve,"toneMappingExposure",_.toneMappingExposure),b.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(R,k),s&&!0===r.fog&&se.refreshFogUniforms(R,s),se.refreshMaterialUniforms(R,r,I,P,m.state.transmissionRenderTarget[e.id]),iP.upload(ve,Be(b),R,J)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(iP.upload(ve,Be(b),R,J),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&T.setValue(ve,"center",i.center),T.setValue(ve,"modelViewMatrix",i.modelViewMatrix),T.setValue(ve,"normalMatrix",i.normalMatrix),T.setValue(ve,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ge.update(n,C),ge.bind(n,C)}}return C}(e,t,n,r,i);X.setMaterial(r,a);let l=n.index,c=1;if(!0===r.wireframe){if(l=ne.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,f=(u.start+u.count)*c;null!==s&&(d=Math.max(d,s.start*c),f=Math.min(f,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),f=Math.min(f,l.count)):null!=h&&(d=Math.max(d,0),f=Math.min(f,h.count));const p=f-d;if(p<0||p===1/0)return;let g;me.setup(i,r,o,n,l);let v=de;if(null!==l&&(g=te.get(l),v=fe,v.setIndex(g)),i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*q()),v.setMode(ve.LINES)):v.setMode(ve.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),X.setLineWidth(e*q()),i.isLineSegments?v.setMode(ve.LINES):i.isLineLoop?v.setMode(ve.LINE_LOOP):v.setMode(ve.LINE_STRIP)}else i.isPoints?v.setMode(ve.POINTS):i.isSprite&&v.setMode(ve.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)v.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(K.get("WEBGL_multi_draw"))v.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const e=i._multiDrawStarts,t=i._multiDrawCounts,n=i._multiDrawCount,s=l?te.get(l).bytesPerElement:1,a=Z.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)a.setValue(ve,"_gl_DrawID",r),v.render(e[r]/s,t[r])}else if(i.isInstancedMesh)v.renderInstances(d,p,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(d,p,t)}else v.render(d,p)},this.compile=function(e,t,n=null){null===n&&(n=e),m=oe.get(n),m.init(t),v.push(m),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),m.setupLights();const r=new Set;return e.traverse(function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const s=t[i];Ce(s,n,e),r.add(s)}else Ce(t,n,e),r.add(t)}),v.pop(),m=null,r},this.compileAsync=function(e,t,n=null){const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){Z.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==K.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ae=null;function Me(){Te.stop()}function ke(){Te.start()}const Te=new mT;function Re(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){r&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);const t=re.update(e),i=e.material;i.visible&&p.push(e,t,i,n,V.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){const t=re.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),V.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),V.copy(t.boundingSphere.center)),V.applyMatrix4(e.matrixWorld).applyMatrix4(j)),Array.isArray(i)){const r=t.groups;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=i[a.materialIndex];o&&o.visible&&p.push(e,t,o,n,V.z,a)}}else i.visible&&p.push(e,t,i,n,V.z,null)}const i=e.children;for(let e=0,s=i.length;e<s;e++)Re(i[e],t,n,r)}function Pe(e,t,n,r){const i=e.opaque,s=e.transmissive,a=e.transparent;m.setupLightsView(n),!0===H&&le.setGlobalState(_.clippingPlanes,n),r&&X.viewport(C.copy(r)),i.length>0&&De(i,t,n),s.length>0&&De(s,t,n),a.length>0&&De(a,t,n),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1)}function Ie(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[r.id]&&(m.state.transmissionRenderTarget[r.id]=new HA(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")||K.has("EXT_color_buffer_float")?GE:HE,minFilter:UE,samples:4,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:MA.workingColorSpace}));const s=m.state.transmissionRenderTarget[r.id],a=r.viewport||C;s.setSize(a.z,a.w);const o=_.getRenderTarget();_.setRenderTarget(s),_.getClearColor(k),T=_.getClearAlpha(),T<1&&_.setClearColor(16777215,.5),_.clear(),W&&ue.render(n);const l=_.toneMapping;_.toneMapping=0;const c=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),m.setupLightsView(r),!0===H&&le.setGlobalState(_.clippingPlanes,r),De(e,n,r),J.updateMultisampleRenderTarget(s),J.updateRenderTargetMipmap(s),!1===K.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,s=t.length;i<s;i++){const s=t[i],a=s.object,o=s.geometry,l=s.material,c=s.group;if(2===l.side&&a.layers.test(r.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,Oe(a,n,r,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(J.updateMultisampleRenderTarget(s),J.updateRenderTargetMipmap(s))}_.setRenderTarget(o),_.setClearColor(k,T),void 0!==c&&(r.viewport=c),_.toneMapping=l}function De(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,s=e.length;i<s;i++){const s=e[i],a=s.object,o=s.geometry,l=null===r?s.material:r,c=s.group;a.layers.test(n.layers)&&Oe(a,t,n,o,l,c)}}function Oe(e,t,n,r,i,s){e.onBeforeRender(_,t,n,r,i,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,_.renderBufferDirect(n,t,r,i,e,s),i.side=0,i.needsUpdate=!0,_.renderBufferDirect(n,t,r,i,e,s),i.side=2):_.renderBufferDirect(n,t,r,i,e,s),e.onAfterRender(_,t,n,r,i,s)}function Le(e,t,n){!0!==t.isScene&&(t=G);const r=Z.get(e),i=m.state.lights,s=m.state.shadowsArray,a=i.state.version,o=ie.getParameters(e,i.state,s,t,n),l=ie.getProgramCacheKey(o);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ee:Q).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ee),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===a)return Ne(e,o),u}else o.uniforms=ie.getUniforms(e),e.onBeforeCompile(o,_),u=ie.acquireProgram(o,l),c.set(l,u),r.uniforms=o.uniforms;const h=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=le.uniform),Ne(e,o),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Be(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=iP.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ne(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Te.setAnimationLoop(function(e){Ae&&Ae(e)}),"undefined"!=typeof self&&Te.setContext(self),this.setAnimationLoop=function(e){Ae=e,ye.setAnimationLoop(e),null===e?Te.stop():Te.start()},ye.addEventListener("sessionstart",Me),ye.addEventListener("sessionend",ke),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===ye.enabled&&!0===ye.isPresenting&&(!0===ye.cameraAutoUpdate&&ye.updateCamera(t),t=ye.getCamera()),!0===e.isScene&&e.onBeforeRender(_,e,t,S),m=oe.get(e,v.length),m.init(t),v.push(m),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(j),F=this.localClippingEnabled,H=le.init(this.clippingPlanes,F),p=ae.get(e,g.length),p.init(),g.push(p),!0===ye.enabled&&!0===ye.isPresenting){const e=_.xr.getDepthSensingMesh();null!==e&&Re(e,t,-1/0,_.sortObjects)}Re(e,t,0,_.sortObjects),p.finish(),!0===_.sortObjects&&p.sort(D,O),W=!1===ye.enabled||!1===ye.isPresenting||!1===ye.hasDepthSensing(),W&&ue.addToRenderList(p,e),this.info.render.frame++,!0===H&&le.beginShadows();const n=m.state.shadowsArray;ce.render(n,e,t),!0===H&&le.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=p.opaque,i=p.transmissive;if(m.setupLights(),t.isArrayCamera){const n=t.cameras;if(i.length>0)for(let t=0,s=n.length;t<s;t++)Ie(r,i,e,n[t]);W&&ue.render(e);for(let t=0,r=n.length;t<r;t++){const r=n[t];Pe(p,e,r,r.viewport)}}else i.length>0&&Ie(r,i,e,t),W&&ue.render(e),Pe(p,e,t);null!==S&&(J.updateMultisampleRenderTarget(S),J.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(_,e,t),me.resetDefaultState(),x=-1,E=null,v.pop(),v.length>0?(m=v[v.length-1],!0===H&&le.setGlobalState(_.clippingPlanes,m.state.camera)):m=null,g.pop(),p=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const r=Z.get(e);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){S=e,y=t,w=n;let r=!0,i=null,s=!1,a=!1;if(e){const o=Z.get(e);void 0!==o.__useDefaultFramebuffer?(X.bindFramebuffer(ve.FRAMEBUFFER,null),r=!1):void 0===o.__webglFramebuffer?J.setupRenderTarget(e):o.__hasExternalTextures&&J.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],s=!0):i=e.samples>0&&!1===J.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,C.copy(e.viewport),A.copy(e.scissor),M=e.scissorTest}else C.copy(L).multiplyScalar(I).floor(),A.copy(B).multiplyScalar(I).floor(),M=N;if(X.bindFramebuffer(ve.FRAMEBUFFER,i)&&r&&X.drawBuffers(e,i),X.viewport(C),X.scissor(A),X.setScissorTest(M),s){const r=Z.get(e.texture);ve.framebufferTexture2D(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(a){const r=Z.get(e.texture),i=t||0;ve.framebufferTextureLayer(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}x=-1},this.readRenderTargetPixels=function(e,t,n,r,i,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){X.bindFramebuffer(ve.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(!$.textureFormatReadable(o))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ve.readPixels(t,n,r,i,pe.convert(o),pe.convert(l),s)}finally{const e=null!==S?Z.get(S).__webglFramebuffer:null;X.bindFramebuffer(ve.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,i,s,a){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){X.bindFramebuffer(ve.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(!$.textureFormatReadable(o))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i){const e=ve.createBuffer();ve.bindBuffer(ve.PIXEL_PACK_BUFFER,e),ve.bufferData(ve.PIXEL_PACK_BUFFER,s.byteLength,ve.STREAM_READ),ve.readPixels(t,n,r,i,pe.convert(o),pe.convert(l),0),ve.flush();const a=ve.fenceSync(ve.SYNC_GPU_COMMANDS_COMPLETE,0);await function(e,t){return new Promise(function(n,r){setTimeout(function i(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(i,4);break;default:n()}},4)})}(ve,a);try{ve.bindBuffer(ve.PIXEL_PACK_BUFFER,e),ve.getBufferSubData(ve.PIXEL_PACK_BUFFER,0,s)}finally{ve.deleteBuffer(e),ve.deleteSync(a)}return s}}finally{const e=null!==S?Z.get(S).__webglFramebuffer:null;X.bindFramebuffer(ve.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t=null,n=0){!0!==e.isTexture&&(SA("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r),a=null!==t?t.x:0,o=null!==t?t.y:0;J.setTexture2D(e,0),ve.copyTexSubImage2D(ve.TEXTURE_2D,n,0,0,a,o,i,s),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n=null,r=null,i=0){let s,a,o,l,c,u;!0!==e.isTexture&&(SA("WebGLRenderer: copyTextureToTexture function signature has changed."),r=arguments[0]||null,e=arguments[1],t=arguments[2],i=arguments[3]||0,n=null),null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.min.x,l=n.min.y):(s=e.image.width,a=e.image.height,o=0,l=0),null!==r?(c=r.x,u=r.y):(c=0,u=0);const h=pe.convert(t.format),d=pe.convert(t.type);J.setTexture2D(t,0),ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,t.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,t.unpackAlignment);const f=ve.getParameter(ve.UNPACK_ROW_LENGTH),p=ve.getParameter(ve.UNPACK_IMAGE_HEIGHT),m=ve.getParameter(ve.UNPACK_SKIP_PIXELS),g=ve.getParameter(ve.UNPACK_SKIP_ROWS),v=ve.getParameter(ve.UNPACK_SKIP_IMAGES),_=e.isCompressedTexture?e.mipmaps[i]:e.image;ve.pixelStorei(ve.UNPACK_ROW_LENGTH,_.width),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,_.height),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,o),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,l),e.isDataTexture?ve.texSubImage2D(ve.TEXTURE_2D,i,c,u,s,a,h,d,_.data):e.isCompressedTexture?ve.compressedTexSubImage2D(ve.TEXTURE_2D,i,c,u,_.width,_.height,h,_.data):ve.texSubImage2D(ve.TEXTURE_2D,i,c,u,s,a,h,d,_),ve.pixelStorei(ve.UNPACK_ROW_LENGTH,f),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,p),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,m),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,g),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,v),0===i&&t.generateMipmaps&&ve.generateMipmap(ve.TEXTURE_2D),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n=null,r=null,i=0){let s,a,o,l,c,u,h,d,f;!0!==e.isTexture&&(SA("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,r=arguments[1]||null,e=arguments[2],t=arguments[3],i=arguments[4]||0);const p=e.isCompressedTexture?e.mipmaps[i]:e.image;null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.max.z-n.min.z,l=n.min.x,c=n.min.y,u=n.min.z):(s=p.width,a=p.height,o=p.depth,l=0,c=0,u=0),null!==r?(h=r.x,d=r.y,f=r.z):(h=0,d=0,f=0);const m=pe.convert(t.format),g=pe.convert(t.type);let v;if(t.isData3DTexture)J.setTexture3D(t,0),v=ve.TEXTURE_3D;else{if(!t.isDataArrayTexture&&!t.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(t,0),v=ve.TEXTURE_2D_ARRAY}ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,t.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,t.unpackAlignment);const _=ve.getParameter(ve.UNPACK_ROW_LENGTH),b=ve.getParameter(ve.UNPACK_IMAGE_HEIGHT),y=ve.getParameter(ve.UNPACK_SKIP_PIXELS),w=ve.getParameter(ve.UNPACK_SKIP_ROWS),S=ve.getParameter(ve.UNPACK_SKIP_IMAGES);ve.pixelStorei(ve.UNPACK_ROW_LENGTH,p.width),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,p.height),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,l),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,c),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,u),e.isDataTexture||e.isData3DTexture?ve.texSubImage3D(v,i,h,d,f,s,a,o,m,g,p.data):t.isCompressedArrayTexture?ve.compressedTexSubImage3D(v,i,h,d,f,s,a,o,m,p.data):ve.texSubImage3D(v,i,h,d,f,s,a,o,m,g,p),ve.pixelStorei(ve.UNPACK_ROW_LENGTH,_),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,b),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,y),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,w),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,S),0===i&&t.generateMipmaps&&ve.generateMipmap(v),X.unbindTexture()},this.initRenderTarget=function(e){void 0===Z.get(e).__webglFramebuffer&&J.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?J.setTextureCube(e,0):e.isData3DTexture?J.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?J.setTexture2DArray(e,0):J.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){y=0,w=0,S=null,X.reset(),me.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return tA}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===UC?"display-p3":"srgb",t.unpackColorSpace=MA.workingColorSpace===HC?"display-p3":"srgb"}}class nI{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ck(e),this.density=t}clone(){return new nI(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class rI extends qM{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new TM,this.environmentIntensity=1,this.environmentRotation=new TM,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class iI{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=QC,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=oA()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return SA("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=oA()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=oA()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const sI=new VA;class aI{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)sI.fromBufferAttribute(this,t),sI.applyMatrix4(e),this.setXYZ(t,sI.x,sI.y,sI.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)sI.fromBufferAttribute(this,t),sI.applyNormalMatrix(e),this.setXYZ(t,sI.x,sI.y,sI.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)sI.fromBufferAttribute(this,t),sI.transformDirection(e),this.setXYZ(t,sI.x,sI.y,sI.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=hA(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=dA(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=dA(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=dA(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=dA(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=dA(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=hA(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=hA(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=hA(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=hA(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=dA(t,this.array),n=dA(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=dA(t,this.array),n=dA(n,this.array),r=dA(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=dA(t,this.array),n=dA(n,this.array),r=dA(r,this.array),i=dA(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new gk(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new aI(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const oI=new VA,lI=new NA,cI=new NA,uI=new VA,hI=new bM,dI=new VA,fI=new uM,pI=new bM,mI=new _M;class gI extends Wk{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AE,this.bindMatrix=new bM,this.bindMatrixInverse=new bM,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new qA),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,dI),this.boundingBox.expandByPoint(dI)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new uM),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,dI),this.boundingSphere.expandByPoint(dI)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),fI.copy(this.boundingSphere),fI.applyMatrix4(r),!1!==e.ray.intersectsSphere(fI)&&(pI.copy(r).invert(),mI.copy(e.ray).applyMatrix4(pI),null!==this.boundingBox&&!1===mI.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,mI)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new NA,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===AE?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;lI.fromBufferAttribute(r.attributes.skinIndex,e),cI.fromBufferAttribute(r.attributes.skinWeight,e),oI.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=cI.getComponent(e);if(0!==r){const i=lI.getComponent(e);hI.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(uI.copy(oI).applyMatrix4(hI),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class vI extends qM{constructor(){super(),this.isBone=!0,this.type="Bone"}}class _I extends BA{constructor(e=null,t=1,n=1,r,i,s,a,o,l=1003,c=1003,u,h){super(null,s,a,o,l,c,r,i,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const bI=new bM,yI=new bM;class wI{constructor(e=[],t=[]){this.uuid=oA(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new bM)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new bM;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:yI;bI.multiplyMatrices(i,t[r]),bI.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new wI(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new _I(t,e,e,$E,VE);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new vI),this.bones.push(i),this.boneInverses.push((new bM).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const s=n[r];e.boneInverses.push(s.toArray())}return e}}class SI extends gk{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const xI=new bM,EI=new bM,CI=[],AI=new qA,MI=new bM,kI=new Wk,TI=new uM;class RI extends Wk{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new SI(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,MI)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new qA),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,xI),AI.copy(e.boundingBox).applyMatrix4(xI),this.boundingBox.union(AI)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new uM),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,xI),TI.copy(e.boundingSphere).applyMatrix4(xI),this.boundingSphere.union(TI)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,i=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=r[i+e]}raycast(e,t){const n=this.matrixWorld,r=this.count;if(kI.geometry=this.geometry,kI.material=this.material,void 0!==kI.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),TI.copy(this.boundingSphere),TI.applyMatrix4(n),!1!==e.ray.intersectsSphere(TI)))for(let i=0;i<r;i++){this.getMatrixAt(i,xI),EI.multiplyMatrices(n,xI),kI.matrixWorld=EI,kI.raycast(e,CI);for(let e=0,n=CI.length;e<n;e++){const n=CI[e];n.instanceId=i,n.object=this,t.push(n)}CI.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new SI(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new _I(new Float32Array(r*this.count),r,this.count,ZE,VE));const i=this.morphTexture.source.data.data;let s=0;for(let e=0;e<n.length;e++)s+=n[e];const a=this.geometry.morphTargetsRelative?1:1-s,o=r*e;i[o]=a,i.set(n,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class PI extends dk{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ck(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const II=new VA,DI=new VA,OI=new bM,LI=new _M,BI=new uM,NI=new VA,UI=new VA;class HI extends qM{constructor(e=new Mk,t=new PI){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)II.fromBufferAttribute(t,e-1),DI.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=II.distanceTo(DI);e.setAttribute("lineDistance",new bk(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),BI.copy(n.boundingSphere),BI.applyMatrix4(r),BI.radius+=i,!1===e.ray.intersectsSphere(BI))return;OI.copy(r).invert(),LI.copy(e.ray).applyMatrix4(OI);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=c.getX(i),r=c.getX(i+1),s=FI(this,e,LI,o,n,r);s&&t.push(s)}if(this.isLineLoop){const i=c.getX(r-1),s=c.getX(n),a=FI(this,e,LI,o,i,s);a&&t.push(a)}}else{const n=Math.max(0,s.start),r=Math.min(u.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=FI(this,e,LI,o,i,i+1);n&&t.push(n)}if(this.isLineLoop){const i=FI(this,e,LI,o,r-1,n);i&&t.push(i)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function FI(e,t,n,r,i,s){const a=e.geometry.attributes.position;if(II.fromBufferAttribute(a,i),DI.fromBufferAttribute(a,s),n.distanceSqToSegment(II,DI,NI,UI)>r)return;NI.applyMatrix4(e.matrixWorld);const o=t.ray.origin.distanceTo(NI);return o<t.near||o>t.far?void 0:{distance:o,point:UI.clone().applyMatrix4(e.matrixWorld),index:i,face:null,faceIndex:null,object:e}}const jI=new VA,zI=new VA;class VI extends HI{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)jI.fromBufferAttribute(t,e),zI.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+jI.distanceTo(zI);e.setAttribute("lineDistance",new bk(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class GI extends HI{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class WI extends dk{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ck(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const qI=new bM,KI=new _M,$I=new uM,XI=new VA;class YI extends qM{constructor(e=new Mk,t=new WI){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),$I.copy(n.boundingSphere),$I.applyMatrix4(r),$I.radius+=i,!1===e.ray.intersectsSphere($I))return;qI.copy(r).invert(),KI.copy(e.ray).applyMatrix4(qI);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,s.start),i=Math.min(l.count,s.start+s.count);n<i;n++){const i=l.getX(n);XI.fromBufferAttribute(c,i),ZI(XI,i,o,r,e,t,this)}else for(let n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);n<i;n++)XI.fromBufferAttribute(c,n),ZI(XI,n,o,r,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function ZI(e,t,n,r,i,s,a){const o=KI.distanceSqToPoint(e);if(o<n){const n=new VA;KI.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:a})}}class JI extends Mk{constructor(e=1,t=1,n=1,r=32,i=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let f=0;const p=[],m=n/2;let g=0;function v(n){const i=f,s=new mA,p=new VA;let v=0;const _=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*b,0),h.push(0,b,0),d.push(.5,.5),f++;const y=f;for(let e=0;e<=r;e++){const t=e/r*o+a,n=Math.cos(t),i=Math.sin(t);p.x=_*i,p.y=m*b,p.z=_*n,u.push(p.x,p.y,p.z),h.push(0,b,0),s.x=.5*n+.5,s.y=.5*i*b+.5,d.push(s.x,s.y),f++}for(let e=0;e<r;e++){const t=i+e,r=y+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new VA,v=new VA;let _=0;const b=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,_=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*o+a,l=Math.sin(i),p=Math.cos(i);v.x=_*l,v.y=-g*n+m,v.z=_*p,u.push(v.x,v.y,v.z),s.set(l,b,p).normalize(),h.push(s.x,s.y,s.z),d.push(t,1-g),c.push(f++)}p.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=p[t][e],r=p[t+1][e],i=p[t+1][e+1],s=p[t][e+1];c.push(n,r,s),c.push(r,i,s),_+=6}l.addGroup(g,_,0),g+=_}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new bk(u,3)),this.setAttribute("normal",new bk(h,3)),this.setAttribute("uv",new bk(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new JI(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class QI extends Mk{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],s=[];function a(e,t,n,r){const i=r+1,s=[];for(let r=0;r<=i;r++){s[r]=[];const a=e.clone().lerp(n,r/i),o=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)s[r][e]=0===e&&r===i?a:a.clone().lerp(o,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(s[e][n+1]),o(s[e+1][n]),o(s[e][n])):(o(s[e][n+1]),o(s[e+1][n+1]),o(s[e+1][n]))}}function o(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new VA,r=new VA,i=new VA;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],r),l(t[s+2],i),a(n,r,i,e)}(r),function(e){const t=new VA;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new VA;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];const n=u(e)/2/Math.PI+.5,r=h(e)/Math.PI+.5;s.push(n,1-r)}(function(){const e=new VA,t=new VA,n=new VA,r=new VA,a=new mA,o=new mA,l=new mA;for(let h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const f=u(r);c(a,d+0,e,f),c(o,d+2,t,f),c(l,d+4,n,f)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],r=s[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),r<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new bk(i,3)),this.setAttribute("normal",new bk(i.slice(),3)),this.setAttribute("uv",new bk(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new QI(e.vertices,e.indices,e.radius,e.details)}}class eD extends QI{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new eD(e.radius,e.detail)}}class tD extends Mk{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],u=new VA,h=new VA,d=[],f=[],p=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let _=0;0===d&&0===s?_=.5/t:d===n&&o===Math.PI&&(_=-.5/t);for(let n=0;n<=t;n++){const o=n/t;u.x=-e*Math.cos(r+o*i)*Math.sin(s+v*a),u.y=e*Math.cos(s+v*a),u.z=e*Math.sin(r+o*i)*Math.sin(s+v*a),f.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),m.push(o+_,1-v),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],a=c[e+1][r],l=c[e+1][r+1];(0!==e||s>0)&&d.push(t,i,l),(e!==n-1||o<Math.PI)&&d.push(i,a,l)}this.setIndex(d),this.setAttribute("position",new bk(f,3)),this.setAttribute("normal",new bk(p,3)),this.setAttribute("uv",new bk(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tD(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class nD extends Mk{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],o=[],l=[],c=new VA,u=new VA,h=new VA;for(let s=0;s<=n;s++)for(let d=0;d<=r;d++){const f=d/r*i,p=s/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(f),u.y=(e+t*Math.cos(p))*Math.sin(f),u.z=t*Math.sin(p),a.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(d/r),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,a=(r+1)*(e-1)+t,o=(r+1)*e+t;s.push(n,i,o),s.push(i,a,o)}this.setIndex(s),this.setAttribute("position",new bk(a,3)),this.setAttribute("normal",new bk(o,3)),this.setAttribute("uv",new bk(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nD(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class rD extends dk{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ck(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ck(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mA(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new TM,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class iD extends rD{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mA(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return lA(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ck(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ck(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ck(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function sD(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function aD(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort(function(t,n){return e[t]-e[n]}),n}function oD(e,t,n){const r=e.length,i=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const r=n[s]*t;for(let n=0;n!==t;++n)i[a++]=e[r+n]}return i}function lD(e,t,n,r){let i=1,s=e[0];for(;void 0!==s&&void 0===s[r];)s=e[i++];if(void 0===s)return;let a=s[r];if(void 0!==a)if(Array.isArray(a))do{a=s[r],void 0!==a&&(t.push(s.time),n.push.apply(n,a)),s=e[i++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[r],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[i++]}while(void 0!==s);else do{a=s[r],void 0!==a&&(t.push(s.time),n.push(a)),s=e[i++]}while(void 0!==s)}class cD{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let s;n:{r:if(!(e<r)){for(let s=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=t[++n],e<r)break t}s=t.length;break n}if(!(e>=i)){const a=t[1];e<a&&(n=2,i=a);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=t[--n-1],e>=i)break t}s=n,n=0;break n}break e}for(;n<s;){const r=n+s>>>1;e<t[r]?s=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class uD extends cD{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,s=e+1,a=r[i],o=r[s];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-n;break;case 2402:i=r.length-2,a=t+r[i]-r[i+1];break;default:i=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:s=e,o=2*n-t;break;case 2402:s=1,o=n+r[1]-r[0];break;default:s=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,_=(-1-d)*m+(1.5+d)*p+.5*f,b=d*m-d*p;for(let e=0;e!==a;++e)i[e]=g*s[c+e]+v*s[l+e]+_*s[o+e]+b*s[u+e];return i}}class hD extends cD{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==a;++e)i[e]=s[l+e]*u+s[o+e]*c;return i}}class dD extends cD{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class fD{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=sD(t,this.TimeBufferType),this.values=sD(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:sD(e.times,Array),values:sD(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new dD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new hD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new uD(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case IC:t=this.InterpolantFactoryMethodDiscrete;break;case DC:t=this.InterpolantFactoryMethodLinear;break;case OC:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return IC;case this.InterpolantFactoryMethodLinear:return DC;case this.InterpolantFactoryMethodSmooth:return OC}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const e=this.getValueSize();this.times=n.slice(i,s),this.values=this.values.slice(i*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,s),e=!1;break}s=r}if(void 0!==r&&function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===OC,i=e.length-1;let s=1;for(let a=1;a<i;++a){let i=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(r)i=!0;else{const e=a*n,r=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[r+a]||n!==t[s+a]){i=!0;break}}}if(i){if(a!==s){e[s]=e[a];const r=a*n,i=s*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++s}}if(i>0){e[s]=e[i];for(let e=i*n,r=s*n,a=0;a!==n;++a)t[r+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}fD.prototype.TimeBufferType=Float32Array,fD.prototype.ValueBufferType=Float32Array,fD.prototype.DefaultInterpolation=DC;class pD extends fD{constructor(e,t,n){super(e,t,n)}}pD.prototype.ValueTypeName="bool",pD.prototype.ValueBufferType=Array,pD.prototype.DefaultInterpolation=IC,pD.prototype.InterpolantFactoryMethodLinear=void 0,pD.prototype.InterpolantFactoryMethodSmooth=void 0;class mD extends fD{}mD.prototype.ValueTypeName="color";class gD extends fD{}gD.prototype.ValueTypeName="number";class vD extends cD{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(r-t);let l=e*a;for(let e=l+a;l!==e;l+=4)zA.slerpFlat(i,0,s,l-a,s,l,o);return i}}class _D extends fD{InterpolantFactoryMethodLinear(e){return new vD(this.times,this.values,this.getValueSize(),e)}}_D.prototype.ValueTypeName="quaternion",_D.prototype.InterpolantFactoryMethodSmooth=void 0;class bD extends fD{constructor(e,t,n){super(e,t,n)}}bD.prototype.ValueTypeName="string",bD.prototype.ValueBufferType=Array,bD.prototype.DefaultInterpolation=IC,bD.prototype.InterpolantFactoryMethodLinear=void 0,bD.prototype.InterpolantFactoryMethodSmooth=void 0;class yD extends fD{}yD.prototype.ValueTypeName="vector";class wD{constructor(e="",t=-1,n=[],r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=oA(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(SD(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(fD.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,s=[];for(let e=0;e<i;e++){let a=[],o=[];a.push((e+i-1)%i,e,(e+1)%i),o.push(0,1,0);const l=aD(a);a=oD(a,1,l),o=oD(o,1,l),r||0!==a[0]||(a.push(i),o.push(o[0])),s.push(new gD(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(i);if(s&&s.length>1){const e=s[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const s=[];for(const e in r)s.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const s=[],a=[];lD(n,s,a,r),0!==s.length&&i.push(new e(t,s,a))}},r=[],i=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new gD(".morphTargetInfluence["+n+"]",e,s))}o=e.length*s}else{const s=".bones["+t[e].name+"]";n(yD,s+".position",i,"pos",r),n(_D,s+".quaternion",i,"rot",r),n(yD,s+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,o,r,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function SD(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return gD;case"vector":case"vector2":case"vector3":case"vector4":return yD;case"color":return mD;case"quaternion":return _D;case"bool":case"boolean":return pD;case"string":return bD}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];lD(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const xD={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class ED{constructor(e,t,n){const r=this;let i,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==r.onStart&&r.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const CD=new ED;class AD{constructor(e){this.manager=void 0!==e?e:CD,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}AD.DEFAULT_MATERIAL_NAME="__DEFAULT";const MD={};class kD extends Error{constructor(e,t){super(e),this.response=t}}class TD extends AD{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=xD.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;if(void 0!==MD[e])return void MD[e].push({onLoad:t,onProgress:n,onError:r});MD[e]=[],MD[e].push({onLoad:t,onProgress:n,onError:r});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=MD[e],r=t.body.getReader(),i=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),s=i?parseInt(i):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){r.read().then(({done:r,value:i})=>{if(r)e.close();else{o+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}},t=>{e.error(t)})}()}});return new Response(l)}throw new kD(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,a));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(t=>{xD.add(e,t);const n=MD[e];delete MD[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}}).catch(t=>{const n=MD[e];if(void 0===n)throw this.manager.itemError(e),t;delete MD[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class RD extends AD{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=xD.get(e);if(void 0!==s)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;const a=bA("img");function o(){c(),xD.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){c(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}class PD extends AD{constructor(e){super(e)}load(e,t,n,r){const i=new BA,s=new RD(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}class ID extends qM{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ck(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}const DD=new bM,OD=new VA,LD=new VA;class BD{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mA(512,512),this.map=null,this.mapPass=null,this.matrix=new bM,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pT,this._frameExtents=new mA(1,1),this._viewportCount=1,this._viewports=[new NA(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;OD.setFromMatrixPosition(e.matrixWorld),t.position.copy(OD),LD.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(LD),t.updateMatrixWorld(),DD.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DD),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(DD)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ND extends BD{constructor(){super(new rT(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*aA*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class UD extends ID{constructor(e,t,n=0,r=Math.PI/3,i=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(qM.DEFAULT_UP),this.updateMatrix(),this.target=new qM,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new ND}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const HD=new bM,FD=new VA,jD=new VA;class zD extends BD{constructor(){super(new rT(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mA(4,2),this._viewportCount=6,this._viewports=[new NA(2,1,1,1),new NA(0,1,1,1),new NA(3,1,1,1),new NA(1,1,1,1),new NA(3,0,1,1),new NA(1,0,1,1)],this._cubeDirections=[new VA(1,0,0),new VA(-1,0,0),new VA(0,0,1),new VA(0,0,-1),new VA(0,1,0),new VA(0,-1,0)],this._cubeUps=[new VA(0,1,0),new VA(0,1,0),new VA(0,1,0),new VA(0,1,0),new VA(0,0,1),new VA(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),FD.setFromMatrixPosition(e.matrixWorld),n.position.copy(FD),jD.copy(n.position),jD.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(jD),n.updateMatrixWorld(),r.makeTranslation(-FD.x,-FD.y,-FD.z),HD.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(HD)}}class VD extends ID{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new zD}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class GD extends BD{constructor(){super(new RT(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class WD extends ID{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(qM.DEFAULT_UP),this.updateMatrix(),this.target=new qM,this.shadow=new GD}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class qD extends ID{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class KD{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class $D extends AD{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=xD.get(e);if(void 0!==s)return i.manager.itemStart(e),s.then?void s.then(n=>{t&&t(n),i.manager.itemEnd(e)}).catch(e=>{r&&r(e)}):(setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const o=fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(n){return xD.add(e,n),t&&t(n),i.manager.itemEnd(e),n}).catch(function(t){r&&r(t),xD.remove(e),i.manager.itemError(e),i.manager.itemEnd(e)});xD.add(e,o),i.manager.itemStart(e)}}const XD="\\[\\]\\.:\\/",YD=new RegExp("["+XD+"]","g"),ZD="[^"+XD+"]",JD="[^"+XD.replace("\\.","")+"]",QD=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",ZD)+/(WCOD+)?/.source.replace("WCOD",JD)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ZD)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ZD)+"$"),eO=["material","materials","bones","map"];class tO{constructor(e,t,n){this.path=t,this.parsedPath=n||tO.parseTrackName(t),this.node=tO.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new tO.Composite(e,t,n):new tO(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(YD,"")}static parseTrackName(e){const t=QD.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==eO.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const s=n(i.children);if(s)return s}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=tO.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const s=e[r];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}tO.Composite=class{constructor(e,t,n){const r=n||tO.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},tO.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},tO.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},tO.prototype.GetterByBindingType=[tO.prototype._getValue_direct,tO.prototype._getValue_array,tO.prototype._getValue_arrayElement,tO.prototype._getValue_toArray],tO.prototype.SetterByBindingTypeAndVersioning=[[tO.prototype._setValue_direct,tO.prototype._setValue_direct_setNeedsUpdate,tO.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[tO.prototype._setValue_array,tO.prototype._setValue_array_setNeedsUpdate,tO.prototype._setValue_array_setMatrixWorldNeedsUpdate],[tO.prototype._setValue_arrayElement,tO.prototype._setValue_arrayElement_setNeedsUpdate,tO.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[tO.prototype._setValue_fromArray,tO.prototype._setValue_fromArray_setNeedsUpdate,tO.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);const nO=new bM;function rO(e,t){return e.distance-t.distance}function iO(e,t,n,r){let i=!0;if(e.layers.test(t.layers)&&!1===e.raycast(t,n)&&(i=!1),!0===i&&!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)iO(r[e],t,n,!0)}}class sO{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(lA(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const aO=new VA,oO=new Qk;class lO extends VI{constructor(e){const t=new Mk,n=new PI({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={};function a(e,t){o(e),o(t)}function o(e){r.push(0,0,0),i.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new bk(r,3)),t.setAttribute("color",new bk(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new ck(16755200),c=new ck(16711680),u=new ck(43775),h=new ck(16777215),d=new ck(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,r,i){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,i.r,i.g,i.b),s.setXYZ(41,i.r,i.g,i.b),s.setXYZ(42,i.r,i.g,i.b),s.setXYZ(43,i.r,i.g,i.b),s.setXYZ(44,i.r,i.g,i.b),s.setXYZ(45,i.r,i.g,i.b),s.setXYZ(46,i.r,i.g,i.b),s.setXYZ(47,i.r,i.g,i.b),s.setXYZ(48,i.r,i.g,i.b),s.setXYZ(49,i.r,i.g,i.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;oO.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),cO("c",t,e,oO,0,0,-1),cO("t",t,e,oO,0,0,1),cO("n1",t,e,oO,-1,-1,-1),cO("n2",t,e,oO,1,-1,-1),cO("n3",t,e,oO,-1,1,-1),cO("n4",t,e,oO,1,1,-1),cO("f1",t,e,oO,-1,-1,1),cO("f2",t,e,oO,1,-1,1),cO("f3",t,e,oO,-1,1,1),cO("f4",t,e,oO,1,1,1),cO("u1",t,e,oO,.7,1.1,-1),cO("u2",t,e,oO,-.7,1.1,-1),cO("u3",t,e,oO,0,2,-1),cO("cf1",t,e,oO,-1,0,1),cO("cf2",t,e,oO,1,0,1),cO("cf3",t,e,oO,0,-1,1),cO("cf4",t,e,oO,0,1,1),cO("cn1",t,e,oO,-1,0,-1),cO("cn2",t,e,oO,1,0,-1),cO("cn3",t,e,oO,0,-1,-1),cO("cn4",t,e,oO,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function cO(e,t,n,r,i,s,a){aO.set(i,s,a).unproject(r);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],aO.x,aO.y,aO.z)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:iE}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=iE);const uO={type:"change"},hO={type:"start"},dO={type:"end"},fO=new _M,pO=new hT,mO=Math.cos(70*fA);class gO extends rA{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new VA,this.cursor=new VA,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",X),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",X),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(uO),n.update(),i=r.NONE},this.update=function(){const t=new VA,u=(new zA).setFromUnitVectors(e.up,new VA(0,1,0)),h=u.clone().invert(),d=new VA,f=new zA,p=new VA,m=2*Math.PI;return function(g=null){const v=n.object.position;t.copy(v).sub(n.target),t.applyQuaternion(u),a.setFromVector3(t),n.autoRotate&&i===r.NONE&&A(function(e){return null!==e?2*Math.PI/60*n.autoRotateSpeed*e:2*Math.PI/60/60*n.autoRotateSpeed}(g)),n.enableDamping?(a.theta+=o.theta*n.dampingFactor,a.phi+=o.phi*n.dampingFactor):(a.theta+=o.theta,a.phi+=o.phi);let _=n.minAzimuthAngle,S=n.maxAzimuthAngle;isFinite(_)&&isFinite(S)&&(_<-Math.PI?_+=m:_>Math.PI&&(_-=m),S<-Math.PI?S+=m:S>Math.PI&&(S-=m),a.theta=_<=S?Math.max(_,Math.min(S,a.theta)):a.theta>(_+S)/2?Math.max(_,a.theta):Math.min(S,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(c,n.dampingFactor):n.target.add(c),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let x=!1;if(n.zoomToCursor&&w||n.object.isOrthographicCamera)a.radius=O(a.radius);else{const e=a.radius;a.radius=O(a.radius*l),x=e!=a.radius}if(t.setFromSpherical(a),t.applyQuaternion(h),v.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(o.theta*=1-n.dampingFactor,o.phi*=1-n.dampingFactor,c.multiplyScalar(1-n.dampingFactor)):(o.set(0,0,0),c.set(0,0,0)),n.zoomToCursor&&w){let r=null;if(n.object.isPerspectiveCamera){const e=t.length();r=O(e*l);const i=e-r;n.object.position.addScaledVector(b,i),n.object.updateMatrixWorld(),x=!!i}else if(n.object.isOrthographicCamera){const e=new VA(y.x,y.y,0);e.unproject(n.object);const i=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),x=i!==n.object.zoom;const s=new VA(y.x,y.y,0);s.unproject(n.object),n.object.position.sub(s).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==r&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(fO.origin.copy(n.object.position),fO.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(fO.direction))<mO?e.lookAt(n.target):(pO.setFromNormalAndCoplanarPoint(n.object.up,n.target),fO.intersectPlane(pO,n.target))))}else if(n.object.isOrthographicCamera){const e=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),e!==n.object.zoom&&(n.object.updateProjectionMatrix(),x=!0)}return l=1,w=!1,!!(x||d.distanceToSquared(n.object.position)>s||8*(1-f.dot(n.object.quaternion))>s||p.distanceToSquared(n.target)>s)&&(n.dispatchEvent(uO),d.copy(n.object.position),f.copy(n.object.quaternion),p.copy(n.target),!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Z),n.domElement.removeEventListener("pointerdown",V),n.domElement.removeEventListener("pointercancel",W),n.domElement.removeEventListener("wheel",q),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",W),n.domElement.getRootNode().removeEventListener("keydown",K,{capture:!0}),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",X),n._domElementKeyEvents=null)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=r.NONE;const s=1e-6,a=new sO,o=new sO;let l=1;const c=new VA,u=new mA,h=new mA,d=new mA,f=new mA,p=new mA,m=new mA,g=new mA,v=new mA,_=new mA,b=new VA,y=new mA;let w=!1;const S=[],x={};let E=!1;function C(e){const t=Math.abs(.01*e);return Math.pow(.95,n.zoomSpeed*t)}function A(e){o.theta-=e}function M(e){o.phi-=e}const k=function(){const e=new VA;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),c.add(e)}}(),T=function(){const e=new VA;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),R=function(){const e=new VA;return function(t,r){const i=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;e.copy(s).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),k(2*t*a/i.clientHeight,n.object.matrix),T(2*r*a/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(k(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),T(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function P(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function D(e,t){if(!n.zoomToCursor)return;w=!0;const r=n.domElement.getBoundingClientRect(),i=e-r.left,s=t-r.top,a=r.width,o=r.height;y.x=i/a*2-1,y.y=-s/o*2+1,b.set(y.x,y.y,1).unproject(n.object).sub(n.object.position).normalize()}function O(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function L(e){u.set(e.clientX,e.clientY)}function B(e){f.set(e.clientX,e.clientY)}function N(e){if(1===S.length)u.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);u.set(n,r)}}function U(e){if(1===S.length)f.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);f.set(n,r)}}function H(e){const t=Q(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);g.set(0,i)}function F(e){if(1==S.length)h.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);h.set(n,r)}d.subVectors(h,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;A(2*Math.PI*d.x/t.clientHeight),M(2*Math.PI*d.y/t.clientHeight),u.copy(h)}function j(e){if(1===S.length)p.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}m.subVectors(p,f).multiplyScalar(n.panSpeed),R(m.x,m.y),f.copy(p)}function z(e){const t=Q(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);v.set(0,s),_.set(0,Math.pow(v.y/g.y,n.zoomSpeed)),P(_.y),g.copy(v),D(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}function V(e){!1!==n.enabled&&(0===S.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",G),n.domElement.addEventListener("pointerup",W)),function(e){for(let t=0;t<S.length;t++)if(S[t]==e.pointerId)return!0;return!1}(e)||(function(e){S.push(e.pointerId)}(e),"touch"===e.pointerType?Y(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case 1:if(!1===n.enableZoom)return;!function(e){D(e.clientX,e.clientX),g.set(e.clientX,e.clientY)}(e),i=r.DOLLY;break;case 0:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;B(e),i=r.PAN}else{if(!1===n.enableRotate)return;L(e),i=r.ROTATE}break;case 2:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;L(e),i=r.ROTATE}else{if(!1===n.enablePan)return;B(e),i=r.PAN}break;default:i=r.NONE}i!==r.NONE&&n.dispatchEvent(hO)}(e)))}function G(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),i){case r.TOUCH_ROTATE:if(!1===n.enableRotate)return;F(e),n.update();break;case r.TOUCH_PAN:if(!1===n.enablePan)return;j(e),n.update();break;case r.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&z(e),n.enablePan&&j(e)}(e),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&z(e),n.enableRotate&&F(e)}(e),n.update();break;default:i=r.NONE}}(e):function(e){switch(i){case r.ROTATE:if(!1===n.enableRotate)return;!function(e){h.set(e.clientX,e.clientY),d.subVectors(h,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;A(2*Math.PI*d.x/t.clientHeight),M(2*Math.PI*d.y/t.clientHeight),u.copy(h),n.update()}(e);break;case r.DOLLY:if(!1===n.enableZoom)return;!function(e){v.set(e.clientX,e.clientY),_.subVectors(v,g),_.y>0?P(C(_.y)):_.y<0&&I(C(_.y)),g.copy(v),n.update()}(e);break;case r.PAN:if(!1===n.enablePan)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,f).multiplyScalar(n.panSpeed),R(m.x,m.y),f.copy(p),n.update()}(e)}}(e))}function W(e){switch(function(e){delete x[e.pointerId];for(let t=0;t<S.length;t++)if(S[t]==e.pointerId)return void S.splice(t,1)}(e),S.length){case 0:n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",W),n.dispatchEvent(dO),i=r.NONE;break;case 1:const t=S[0],s=x[t];Y({pointerId:t,pageX:s.x,pageY:s.y})}}function q(e){!1!==n.enabled&&!1!==n.enableZoom&&i===r.NONE&&(e.preventDefault(),n.dispatchEvent(hO),function(e){D(e.clientX,e.clientY),e.deltaY<0?I(C(e.deltaY)):e.deltaY>0&&P(C(e.deltaY)),n.update()}(function(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!E&&(n.deltaY*=10),n}(e)),n.dispatchEvent(dO))}function K(e){"Control"===e.key&&(E=!0,n.domElement.getRootNode().addEventListener("keyup",$,{passive:!0,capture:!0}))}function $(e){"Control"===e.key&&(E=!1,n.domElement.getRootNode().removeEventListener("keyup",$,{passive:!0,capture:!0}))}function X(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?M(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?M(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?A(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?A(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function Y(e){switch(J(e),S.length){case 1:switch(n.touches.ONE){case 0:if(!1===n.enableRotate)return;N(e),i=r.TOUCH_ROTATE;break;case 1:if(!1===n.enablePan)return;U(e),i=r.TOUCH_PAN;break;default:i=r.NONE}break;case 2:switch(n.touches.TWO){case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&H(e),n.enablePan&&U(e)}(e),i=r.TOUCH_DOLLY_PAN;break;case 3:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&H(e),n.enableRotate&&N(e)}(e),i=r.TOUCH_DOLLY_ROTATE;break;default:i=r.NONE}break;default:i=r.NONE}i!==r.NONE&&n.dispatchEvent(hO)}function Z(e){!1!==n.enabled&&e.preventDefault()}function J(e){let t=x[e.pointerId];void 0===t&&(t=new mA,x[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Q(e){const t=e.pointerId===S[0]?S[1]:S[0];return x[t]}n.domElement.addEventListener("contextmenu",Z),n.domElement.addEventListener("pointerdown",V),n.domElement.addEventListener("pointercancel",W),n.domElement.addEventListener("wheel",q,{passive:!1}),n.domElement.getRootNode().addEventListener("keydown",K,{passive:!0,capture:!0}),this.update()}}const vO=new class{constructor(e,t,n=0,r=1/0){this.ray=new _M(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new RM,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return nO.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(nO),this}intersectObject(e,t=!0,n=[]){return iO(e,this,n,t),n.sort(rO),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)iO(e[r],this,n,t);return n.sort(rO),n}},_O=new VA,bO=new VA,yO=new zA,wO={X:new VA(1,0,0),Y:new VA(0,1,0),Z:new VA(0,0,1)},SO={type:"change"},xO={type:"mouseDown",mode:null},EO={type:"mouseUp",mode:null},CO={type:"objectChange"};class AO extends qM{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new KO;this._gizmo=n,this.add(n);const r=new $O;this._plane=r,this.add(r);const i=this;function s(e,t){let s=t;Object.defineProperty(i,e,{get:function(){return void 0!==s?s:t},set:function(t){s!==t&&(s=t,r[e]=t,n[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(SO))}}),i[e]=t,r[e]=t,n[e]=t}s("camera",e),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const a=new VA,o=new VA,l=new zA,c=new zA,u=new VA,h=new zA,d=new VA,f=new VA,p=new VA,m=new VA;s("worldPosition",a),s("worldPositionStart",o),s("worldQuaternion",l),s("worldQuaternionStart",c),s("cameraPosition",u),s("cameraQuaternion",h),s("pointStart",d),s("pointEnd",f),s("rotationAxis",p),s("rotationAngle",0),s("eye",m),this._offset=new VA,this._startNorm=new VA,this._endNorm=new VA,this._cameraScale=new VA,this._parentPosition=new VA,this._parentQuaternion=new zA,this._parentQuaternionInv=new zA,this._parentScale=new VA,this._worldScaleStart=new VA,this._worldQuaternionInv=new zA,this._worldScale=new VA,this._positionStart=new VA,this._quaternionStart=new zA,this._scaleStart=new VA,this._getPointer=MO.bind(this),this._onPointerDown=TO.bind(this),this._onPointerHover=kO.bind(this),this._onPointerMove=RO.bind(this),this._onPointerUp=PO.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;null!==e&&vO.setFromCamera(e,this.camera);const t=IO(this._gizmo.picker[this.mode],vO);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&(null==e||0===e.button)&&null!==this.axis){null!==e&&vO.setFromCamera(e,this.camera);const t=IO(this._plane,vO,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,xO.mode=this.mode,this.dispatchEvent(xO)}}pointerMove(e){const t=this.axis,n=this.mode,r=this.object;let i=this.space;if("scale"===n?i="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(i="world"),void 0===r||null===t||!1===this.dragging||null!==e&&-1!==e.button)return;null!==e&&vO.setFromCamera(e,this.camera);const s=IO(this._plane,vO,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===i&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===i&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===i&&(r.position.applyQuaternion(yO.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),"world"===i&&(r.parent&&r.position.add(_O.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(_O.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),bO.set(e,e,e)}else _O.copy(this.pointStart),bO.copy(this.pointEnd),_O.applyQuaternion(this._worldQuaternionInv),bO.applyQuaternion(this._worldQuaternionInv),bO.divide(_O),-1===t.search("X")&&(bO.x=1),-1===t.search("Y")&&(bO.y=1),-1===t.search("Z")&&(bO.z=1);r.scale.copy(this._scaleStart).multiply(bO),this.scaleSnap&&(-1!==t.search("X")&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(_O.setFromMatrixPosition(this.camera.matrixWorld));let n=!1;"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_O.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(wO[t]),_O.copy(wO[t]),"local"===i&&_O.applyQuaternion(this.worldQuaternion),_O.cross(this.eye),0===_O.length()?n=!0:this.rotationAngle=this._offset.dot(_O.normalize())*e),("E"===t||n)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===i&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(yO.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(yO.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(SO),this.dispatchEvent(CO)}}pointerUp(e){null!==e&&0!==e.button||(this.dragging&&null!==this.axis&&(EO.mode=this.mode,this.dispatchEvent(EO)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(SO),this.dispatchEvent(CO),this.pointStart.copy(this.pointEnd))}getRaycaster(){return vO}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function MO(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function kO(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function TO(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function RO(e){this.enabled&&this.pointerMove(this._getPointer(e))}function PO(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function IO(e,t,n){const r=t.intersectObject(e,!0);for(let e=0;e<r.length;e++)if(r[e].object.visible||n)return r[e];return!1}const DO=new TM,OO=new VA(0,1,0),LO=new VA(0,0,0),BO=new bM,NO=new zA,UO=new zA,HO=new VA,FO=new bM,jO=new VA(1,0,0),zO=new VA(0,1,0),VO=new VA(0,0,1),GO=new VA,WO=new VA,qO=new VA;class KO extends qM{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new fk({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new PI({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const r=t.clone();r.opacity=.5;const i=e.clone();i.color.setHex(16711680);const s=e.clone();s.color.setHex(65280);const a=e.clone();a.color.setHex(255);const o=e.clone();o.color.setHex(16711680),o.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const u=e.clone();u.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25,e.clone().color.setHex(16776960);const d=e.clone();d.color.setHex(7895160);const f=new JI(0,.04,.1,12);f.translate(0,.05,0);const p=new Kk(.08,.08,.08);p.translate(0,.04,0);const m=new Mk;m.setAttribute("position",new bk([0,0,0,1,0,0],3));const g=new JI(.0075,.0075,.5,3);function v(e,t){const n=new nD(e,.0075,3,64,t*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}g.translate(0,.25,0);const _={X:[[new Wk(f,i),[.5,0,0],[0,0,-Math.PI/2]],[new Wk(f,i),[-.5,0,0],[0,0,Math.PI/2]],[new Wk(g,i),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Wk(f,s),[0,.5,0]],[new Wk(f,s),[0,-.5,0],[Math.PI,0,0]],[new Wk(g,s)]],Z:[[new Wk(f,a),[0,0,.5],[Math.PI/2,0,0]],[new Wk(f,a),[0,0,-.5],[-Math.PI/2,0,0]],[new Wk(g,a),null,[Math.PI/2,0,0]]],XYZ:[[new Wk(new eD(.1,0),u.clone()),[0,0,0]]],XY:[[new Wk(new Kk(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new Wk(new Kk(.15,.15,.01),o.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Wk(new Kk(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},b={X:[[new Wk(new JI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Wk(new JI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Wk(new JI(.2,0,.6,4),n),[0,.3,0]],[new Wk(new JI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Wk(new JI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Wk(new JI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Wk(new eD(.2,0),n)]],XY:[[new Wk(new Kk(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Wk(new Kk(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Wk(new Kk(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},y={START:[[new Wk(new eD(.01,2),r),null,null,null,"helper"]],END:[[new Wk(new eD(.01,2),r),null,null,null,"helper"]],DELTA:[[new HI(function(){const e=new Mk;return e.setAttribute("position",new bk([0,0,0,1,1,1],3)),e}(),r),null,null,null,"helper"]],X:[[new HI(m,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new HI(m,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new HI(m,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},w={XYZE:[[new Wk(v(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new Wk(v(.5,.5),i)]],Y:[[new Wk(v(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new Wk(v(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new Wk(v(.75,1),h),null,[0,Math.PI/2,0]]]},S={AXIS:[[new HI(m,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},x={XYZE:[[new Wk(new tD(.25,10,8),n)]],X:[[new Wk(new nD(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Wk(new nD(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Wk(new nD(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Wk(new nD(.75,.1,2,24),n)]]},E={X:[[new Wk(p,i),[.5,0,0],[0,0,-Math.PI/2]],[new Wk(g,i),[0,0,0],[0,0,-Math.PI/2]],[new Wk(p,i),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Wk(p,s),[0,.5,0]],[new Wk(g,s)],[new Wk(p,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Wk(p,a),[0,0,.5],[Math.PI/2,0,0]],[new Wk(g,a),[0,0,0],[Math.PI/2,0,0]],[new Wk(p,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Wk(new Kk(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new Wk(new Kk(.15,.15,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Wk(new Kk(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Wk(new Kk(.1,.1,.1),u.clone())]]},C={X:[[new Wk(new JI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Wk(new JI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Wk(new JI(.2,0,.6,4),n),[0,.3,0]],[new Wk(new JI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Wk(new JI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Wk(new JI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Wk(new Kk(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Wk(new Kk(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Wk(new Kk(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Wk(new Kk(.2,.2,.2),n),[0,0,0]]]},A={X:[[new HI(m,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new HI(m,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new HI(m,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function M(e){const t=new qM;for(const n in e)for(let r=e[n].length;r--;){const i=e[n][r][0].clone(),s=e[n][r][1],a=e[n][r][2],o=e[n][r][3],l=e[n][r][4];i.name=n,i.tag=l,s&&i.position.set(s[0],s[1],s[2]),a&&i.rotation.set(a[0],a[1],a[2]),o&&i.scale.set(o[0],o[1],o[2]),i.updateMatrix();const c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=M(_)),this.add(this.gizmo.rotate=M(w)),this.add(this.gizmo.scale=M(E)),this.add(this.picker.translate=M(b)),this.add(this.picker.rotate=M(x)),this.add(this.picker.scale=M(C)),this.add(this.helper.translate=M(y)),this.add(this.helper.rotate=M(S)),this.add(this.helper.scale=M(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:UO;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let e=0;e<n.length;e++){const r=n[e];let i;if(r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(i*this.size/4),"helper"!==r.tag){if(r.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,n=.2;"X"===r.name&&Math.abs(OO.copy(jO).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Y"===r.name&&Math.abs(OO.copy(zO).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Z"===r.name&&Math.abs(OO.copy(VO).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XY"===r.name&&Math.abs(OO.copy(VO).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"YZ"===r.name&&Math.abs(OO.copy(jO).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XZ"===r.name&&Math.abs(OO.copy(zO).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)}else"rotate"===this.mode&&(NO.copy(t),OO.copy(this.eye).applyQuaternion(yO.copy(t).invert()),-1!==r.name.search("E")&&r.quaternion.setFromRotationMatrix(BO.lookAt(this.eye,LO,zO)),"X"===r.name&&(yO.setFromAxisAngle(jO,Math.atan2(-OO.y,OO.z)),yO.multiplyQuaternions(NO,yO),r.quaternion.copy(yO)),"Y"===r.name&&(yO.setFromAxisAngle(zO,Math.atan2(OO.x,OO.z)),yO.multiplyQuaternions(NO,yO),r.quaternion.copy(yO)),"Z"===r.name&&(yO.setFromAxisAngle(VO,Math.atan2(OO.y,OO.x)),yO.multiplyQuaternions(NO,yO),r.quaternion.copy(yO)));r.visible=r.visible&&(-1===r.name.indexOf("X")||this.showX),r.visible=r.visible&&(-1===r.name.indexOf("Y")||this.showY),r.visible=r.visible&&(-1===r.name.indexOf("Z")||this.showZ),r.visible=r.visible&&(-1===r.name.indexOf("E")||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(e){return r.name===e}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}else r.visible=!1,"AXIS"===r.name?(r.visible=!!this.axis,"X"===this.axis&&(yO.setFromEuler(DO.set(0,0,0)),r.quaternion.copy(t).multiply(yO),Math.abs(OO.copy(jO).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Y"===this.axis&&(yO.setFromEuler(DO.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply(yO),Math.abs(OO.copy(zO).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Z"===this.axis&&(yO.setFromEuler(DO.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply(yO),Math.abs(OO.copy(VO).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"XYZE"===this.axis&&(yO.setFromEuler(DO.set(0,Math.PI/2,0)),OO.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(BO.lookAt(LO,OO,zO)),r.quaternion.multiply(yO),r.visible=this.dragging),"E"===this.axis&&(r.visible=!1)):"START"===r.name?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):"END"===r.name?(r.position.copy(this.worldPosition),r.visible=this.dragging):"DELTA"===r.name?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),_O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_O.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(_O),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=-1!==this.axis.search(r.name)))}super.updateMatrixWorld(e)}}class $O extends Wk{constructor(){super(new vT(1e5,1e5,2,2),new fk({visible:!1,wireframe:!0,side:2,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),GO.copy(jO).applyQuaternion("local"===t?this.worldQuaternion:UO),WO.copy(zO).applyQuaternion("local"===t?this.worldQuaternion:UO),qO.copy(VO).applyQuaternion("local"===t?this.worldQuaternion:UO),OO.copy(WO),this.mode){case"translate":case"scale":switch(this.axis){case"X":OO.copy(this.eye).cross(GO),HO.copy(GO).cross(OO);break;case"Y":OO.copy(this.eye).cross(WO),HO.copy(WO).cross(OO);break;case"Z":OO.copy(this.eye).cross(qO),HO.copy(qO).cross(OO);break;case"XY":HO.copy(qO);break;case"YZ":HO.copy(GO);break;case"XZ":OO.copy(qO),HO.copy(WO);break;case"XYZ":case"E":HO.set(0,0,0)}break;default:HO.set(0,0,0)}0===HO.length()?this.quaternion.copy(this.cameraQuaternion):(FO.lookAt(_O.set(0,0,0),HO,OO),this.quaternion.setFromRotationMatrix(FO)),super.updateMatrixWorld(e)}}function XO(e,t){if(0===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2===t||1===t){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(2===t)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class YO extends AD{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new nL(e)}),this.register(function(e){return new rL(e)}),this.register(function(e){return new dL(e)}),this.register(function(e){return new fL(e)}),this.register(function(e){return new pL(e)}),this.register(function(e){return new sL(e)}),this.register(function(e){return new aL(e)}),this.register(function(e){return new oL(e)}),this.register(function(e){return new lL(e)}),this.register(function(e){return new tL(e)}),this.register(function(e){return new cL(e)}),this.register(function(e){return new iL(e)}),this.register(function(e){return new hL(e)}),this.register(function(e){return new uL(e)}),this.register(function(e){return new QO(e)}),this.register(function(e){return new mL(e)}),this.register(function(e){return new gL(e)})}load(e,t,n,r){const i=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=KD.extractUrlBase(e);s=KD.resolveURL(t,this.path)}else s=KD.extractUrlBase(e);this.manager.itemStart(e);const a=function(t){r?r(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},o=new TD(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){try{i.parse(n,s,function(n){t(n),i.manager.itemEnd(e)},a)}catch(e){a(e)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const s={},a={},o=new TextDecoder;if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===vL){try{s[JO.KHR_BINARY_GLTF]=new _L(e)}catch(e){return void(r&&r(e))}i=JSON.parse(s[JO.KHR_BINARY_GLTF].content)}else i=JSON.parse(o.decode(e));else i=e;if(void 0===i.asset||i.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new jL(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[t.name]=t,s[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],n=i.extensionsRequired||[];switch(t){case JO.KHR_MATERIALS_UNLIT:s[t]=new eL;break;case JO.KHR_DRACO_MESH_COMPRESSION:s[t]=new bL(i,this.dracoLoader);break;case JO.KHR_TEXTURE_TRANSFORM:s[t]=new yL;break;case JO.KHR_MESH_QUANTIZATION:s[t]=new wL;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(a),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,i){n.parse(e,t,r,i)})}}function ZO(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const JO={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class QO{constructor(e){this.parser=e,this.name=JO.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let a;const o=new ck(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],NC);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new WD(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new VD(o),a.distance=l;break;case"spot":a=new UD(o),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,LL(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),r=Promise.resolve(a),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(e){return n._getNodeRef(t.cache,i,e)})}}class eL{constructor(){this.name=JO.KHR_MATERIALS_UNLIT}getMaterialType(){return fk}extendParams(e,t,n){const r=[];e.color=new ck(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],NC),e.opacity=t[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture,BC))}return Promise.all(r)}}class tL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class nL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new mA(e,e)}return Promise.all(i)}}class rL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=void 0!==r.dispersion?r.dispersion:0,Promise.resolve()}}class iL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class sL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new ck(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=r.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],NC)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,BC)),void 0!==s.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}}class aL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class oL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=(new ck).setRGB(a[0],a[1],a[2],NC),Promise.all(i)}}class lL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class cL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=(new ck).setRGB(a[0],a[1],a[2],NC),void 0!==s.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,BC)),Promise.all(i)}}class uL{constructor(e){this.parser=e,this.name=JO.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&i.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(i)}}class hL{constructor(e){this.parser=e,this.name=JO.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?iD:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&i.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}}class dL{constructor(e){this.parser=e,this.name=JO.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}}class fL{constructor(e){this.parser=e,this.name=JO.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],a=r.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then(function(i){if(i)return n.loadTextureImage(e,s.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class pL{constructor(e){this.parser=e,this.name=JO.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],a=r.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then(function(i){if(i)return n.loadTextureImage(e,s.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class mL{constructor(e){this.name=JO.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(t){const n=e.byteOffset||0,r=e.byteLength||0,s=e.count,a=e.byteStride,o=new Uint8Array(t,n,r);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,a,o,e.mode,e.filter).then(function(e){return e.buffer}):i.ready.then(function(){const t=new ArrayBuffer(s*a);return i.decodeGltfBuffer(new Uint8Array(t),s,a,o,e.mode,e.filter),t})})}return null}}class gL{constructor(e){this.name=JO.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const e of r.primitives)if(e.mode!==CL.TRIANGLES&&e.mode!==CL.TRIANGLE_STRIP&&e.mode!==CL.TRIANGLE_FAN&&void 0!==e.mode)return null;const i=n.extensions[this.name].attributes,s=[],a={};for(const e in i)s.push(this.parser.getDependency("accessor",i[e]).then(t=>(a[e]=t,a[e])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,i=[];for(const e of n){const t=new bM,n=new VA,s=new zA,o=new VA(1,1,1),l=new RI(e.geometry,e.material,r);for(let e=0;e<r;e++)a.TRANSLATION&&n.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,e),a.SCALE&&o.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(n,s,o));for(const t in a)if("_COLOR_0"===t){const e=a[t];l.instanceColor=new SI(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);qM.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),i.push(l)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]}))}}const vL="glTF";class _L{constructor(e){this.name=JO.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==vL)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,i=new DataView(e,12);let s=0;for(;s<r;){const t=i.getUint32(s,!0);s+=4;const r=i.getUint32(s,!0);if(s+=4,1313821514===r){const r=new Uint8Array(e,12+s,t);this.content=n.decode(r)}else if(5130562===r){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class bL{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=JO.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},o={},l={};for(const e in s){const t=RL[e]||e.toLowerCase();a[t]=s[e]}for(const t in e.attributes){const r=RL[t]||t.toLowerCase();if(void 0!==s[t]){const i=n.accessors[e.attributes[t]],s=AL[i.componentType];l[r]=s.name,o[r]=!0===i.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t,n){r.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],r=o[t];void 0!==r&&(n.normalized=r)}t(e)},a,l,NC,n)})})}}class yL{constructor(){this.name=JO.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class wL{constructor(){this.name=JO.KHR_MESH_QUANTIZATION}}class SL extends cD{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=r-t,u=(n-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,v=1-m,_=g-h+u;for(let e=0;e!==a;e++){const t=s[p+e+a],n=s[p+e+o]*c,r=s[f+e+a],l=s[f+e]*c;i[e]=v*t+_*n+m*r+g*l}return i}}const xL=new zA;class EL extends SL{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return xL.fromArray(i).normalize().toArray(i),i}}const CL={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},AL={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ML={9728:DE,9729:BE,9984:1004,9985:NE,9986:LE,9987:UE},kL={33071:PE,33648:IE,10497:RE},TL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},RL={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PL={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},IL={CUBICSPLINE:void 0,LINEAR:DC,STEP:IC};function DL(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new rD({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial}function OL(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function LL(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function BL(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function NL(e){let t;const n=e.extensions&&e.extensions[JO.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+UL(n.attributes):e.indices+":"+UL(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,r=e.targets.length;n<r;n++)t+=":"+UL(e.targets[n]);return t}function UL(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function HL(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const FL=new bM;class jL{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ZO,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,i=!1,s=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);r=n&&t?parseInt(t[1],10):-1,i=e.indexOf("Firefox")>-1,s=i?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||n&&r<17||i&&s<98?this.textureLoader=new PD(this.options.manager):this.textureLoader=new $D(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new TD(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return OL(i,s,r),LL(s,r),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,r]of e.children.entries())i(r,t.children[n])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[JO.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(e,i){n.load(KD.resolveURL(t.uri,r.path),e,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=TL[r.type],t=AL[r.componentType],n=!0===r.normalized,i=new t(r.count*e);return Promise.resolve(new gk(i,e,n))}const i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(e){const i=e[0],s=TL[r.type],a=AL[r.componentType],o=a.BYTES_PER_ELEMENT,l=o*s,c=r.byteOffset||0,u=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,h=!0===r.normalized;let d,f;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let l=t.cache.get(n);l||(d=new a(i,e*u,r.count*u/o),l=new iI(d,u/o),t.cache.add(n,l)),f=new aI(l,s,c%u/o,h)}else d=null===i?new a(r.count*s):new a(i,c,r.count*s),f=new gk(d,s,h);if(void 0!==r.sparse){const t=TL.SCALAR,n=AL[r.sparse.indices.componentType],o=r.sparse.indices.byteOffset||0,l=r.sparse.values.byteOffset||0,c=new n(e[1],o,r.sparse.count*t),u=new a(e[2],l,r.sparse.count*s);null!==i&&(f=new gk(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(f.setX(t,u[e*s]),s>=2&&f.setY(t,u[e*s+1]),s>=3&&f.setZ(t,u[e*s+2]),s>=4&&f.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let s=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){const r=this,i=this.json,s=i.textures[e],a=i.images[t],o=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=s.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const n=(i.samplers||{})[s.sampler]||{};return t.magFilter=ML[n.magFilter]||BE,t.minFilter=ML[n.minFilter]||UE,t.wrapS=kL[n.wrapS]||RE,t.wrapT=kL[n.wrapT]||RE,r.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){const n=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const i=n.images[e],s=self.URL||self.webkitURL;let a=i.uri||"",o=!1;if(void 0!==i.bufferView)a=this.getDependency("bufferView",i.bufferView).then(function(e){o=!0;const t=new Blob([e],{type:i.mimeType});return a=s.createObjectURL(t),a});else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then(function(e){return new Promise(function(n,i){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new BA(e);t.needsUpdate=!0,n(t)}),t.load(KD.resolveURL(e,r.path),s,void 0,i)})}).then(function(e){var t;return!0===o&&s.revokeObjectURL(a),LL(e,i),e.userData.mimeType=i.mimeType||((t=i.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e});return this.sourceCache[e]=l,l}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),i.extensions[JO.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[JO.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(s);s=i.extensions[JO.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),i.associations.set(s,t)}}return void 0!==r&&(s.colorSpace=r),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new WI,dk.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new PI,dk.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||i||s){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return rD}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let s;const a={},o=[];if((i.extensions||{})[JO.KHR_MATERIALS_UNLIT]){const e=r[JO.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),o.push(e.extendParams(a,i,t))}else{const n=i.pbrMetallicRoughness||{};if(a.color=new ck(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],NC),a.opacity=e[3]}void 0!==n.baseColorTexture&&o.push(t.assignTexture(a,"map",n.baseColorTexture,BC)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(t.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),o.push(t.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),o.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)})))}!0===i.doubleSided&&(a.side=2);const l=i.alphaMode||"OPAQUE";if("BLEND"===l?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===l&&(a.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&s!==fk&&(o.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new mA(1,1),void 0!==i.normalTexture.scale)){const e=i.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==i.occlusionTexture&&s!==fk&&(o.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(a.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&s!==fk){const e=i.emissiveFactor;a.emissive=(new ck).setRGB(e[0],e[1],e[2],NC)}return void 0!==i.emissiveTexture&&s!==fk&&o.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,BC)),Promise.all(o).then(function(){const n=new s(a);return i.name&&(n.name=i.name),LL(n,i),t.associations.set(n,{materials:e}),i.extensions&&OL(r,n,i),n})}createUniqueName(e){const t=tO.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[JO.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return zL(n,e,t)})}const s=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],o=NL(a),l=r[o];if(l)s.push(l.promise);else{let e;e=a.extensions&&a.extensions[JO.KHR_DRACO_MESH_COMPRESSION]?i(a):zL(new Mk,a,t),r[o]={primitive:a,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],s=i.primitives,a=[];for(let e=0,t=s.length;e<t;e++){const t=void 0===s[e].material?DL(this.cache):this.getDependency("material",s[e].material);a.push(t)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let n=0,c=o.length;n<c;n++){const c=o[n],u=s[n];let h;const d=a[n];if(u.mode===CL.TRIANGLES||u.mode===CL.TRIANGLE_STRIP||u.mode===CL.TRIANGLE_FAN||void 0===u.mode)h=!0===i.isSkinnedMesh?new gI(c,d):new Wk(c,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),u.mode===CL.TRIANGLE_STRIP?h.geometry=XO(h.geometry,1):u.mode===CL.TRIANGLE_FAN&&(h.geometry=XO(h.geometry,2));else if(u.mode===CL.LINES)h=new VI(c,d);else if(u.mode===CL.LINE_STRIP)h=new HI(c,d);else if(u.mode===CL.LINE_LOOP)h=new GI(c,d);else{if(u.mode!==CL.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new YI(c,d)}Object.keys(h.geometry.morphAttributes).length>0&&BL(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),LL(h,i),u.extensions&&OL(r,h,u),t.assignFinalMaterial(h),l.push(h)}for(let n=0,r=l.length;n<r;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return i.extensions&&OL(r,l[0],i),l[0];const c=new qP;i.extensions&&OL(r,c,i),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new rT(pA(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new RT(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),LL(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let e=0,r=t.joints.length;e<r;e++)n.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const n=e.pop(),r=e,i=[],s=[];for(let e=0,a=r.length;e<a;e++){const a=r[e];if(a){i.push(a);const t=new bM;null!==n&&t.fromArray(n.array,16*e),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new wI(i,s)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],i=r.name?r.name:"animation_"+e,s=[],a=[],o=[],l=[],c=[];for(let e=0,t=r.channels.length;e<t;e++){const t=r.channels[e],n=r.samplers[t.sampler],i=t.target,u=i.node,h=void 0!==r.parameters?r.parameters[n.input]:n.input,d=void 0!==r.parameters?r.parameters[n.output]:n.output;void 0!==i.node&&(s.push(this.getDependency("node",u)),a.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",d)),l.push(n),c.push(i))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=[];for(let e=0,i=t.length;e<i;e++){const i=t[e],c=r[e],u=s[e],h=a[e],d=o[e];if(void 0===i)continue;i.updateMatrix&&i.updateMatrix();const f=n._createAnimationTracks(i,c,u,h,d);if(f)for(let e=0;e<f.length;e++)l.push(f[e])}return new wD(i,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),i=[],s=n.children||[];for(let e=0,n=s.length;e<n;e++)i.push(t.getDependency("node",s[e]));const a=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(i),a]).then(function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(r,FL)});for(let e=0,r=n.length;e<r;e++)t.add(n[e]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const i=t.nodes[e],s=i.name?r.createUniqueName(i.name):"",a=[],o=r._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return o&&a.push(o),void 0!==i.camera&&a.push(r.getDependency("camera",i.camera).then(function(e){return r._getNodeRef(r.cameraCache,i.camera,e)})),r._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){a.push(e)}),this.nodeCache[e]=Promise.all(a).then(function(t){let a;if(a=!0===i.isBone?new vI:t.length>1?new qP:1===t.length?t[0]:new qM,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(i.name&&(a.userData.name=i.name,a.name=s),LL(a,i),i.extensions&&OL(n,a,i),void 0!==i.matrix){const e=new bM;e.fromArray(i.matrix),a.applyMatrix4(e)}else void 0!==i.translation&&a.position.fromArray(i.translation),void 0!==i.rotation&&a.quaternion.fromArray(i.rotation),void 0!==i.scale&&a.scale.fromArray(i.scale);return r.associations.has(a)||r.associations.set(a,{}),r.associations.get(a).nodes=e,a}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,i=new qP;n.name&&(i.name=r.createUniqueName(n.name)),LL(i,n),n.extensions&&OL(t,i,n);const s=n.nodes||[],a=[];for(let e=0,t=s.length;e<t;e++)a.push(r.getDependency("node",s[e]));return Promise.all(a).then(function(e){for(let t=0,n=e.length;t<n;t++)i.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[e,n]of r.associations)(e instanceof dk||e instanceof BA)&&t.set(e,n);return e.traverse(e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)}),t})(i),i})}_createAnimationTracks(e,t,n,r,i){const s=[],a=e.name?e.name:e.uuid,o=[];let l;switch(PL[i.path]===PL.weights?e.traverse(function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)}):o.push(a),PL[i.path]){case PL.weights:l=gD;break;case PL.rotation:l=_D;break;case PL.position:case PL.scale:l=yD;break;default:l=1===n.itemSize?gD:yD}const c=void 0!==r.interpolation?IL[r.interpolation]:DC,u=this._getArrayFromAccessor(n);for(let e=0,n=o.length;e<n;e++){const n=new l(o[e]+"."+PL[i.path],t.array,u,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(n),s.push(n)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=HL(t.constructor),n=new Float32Array(t.length);for(let r=0,i=t.length;r<i;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof _D?EL:SL)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function zL(e,t,n){const r=t.attributes,i=[];function s(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(const t in r){const n=RL[t]||t.toLowerCase();n in e.attributes||i.push(s(r[t],n))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(r)}return MA.workingColorSpace!==NC&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${MA.workingColorSpace}" not supported.`),LL(e,t),function(e,t,n){const r=t.attributes,i=new qA;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new VA(t[0],t[1],t[2]),new VA(s[0],s[1],s[2])),e.normalized){const t=HL(AL[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new VA,t=new VA;for(let r=0,i=s.length;r<i;r++){const i=s[r];if(void 0!==i.POSITION){const r=n.json.accessors[i.POSITION],s=r.min,a=r.max;if(void 0!==s&&void 0!==a){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),r.normalized){const e=HL(AL[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const a=new uM;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1,s=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(i=!0),void 0!==n.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(r){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;a.push(t)}if(i){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;o.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(t){const n=t[0],a=t[1],o=t[2];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=a),s&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}const VL=new WeakMap;class GL extends AD{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const i=new TD(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,e=>{this.parse(e,t,r)},n,r)}parse(e,t,n=()=>{}){this.decodeDracoFile(e,t,null,null,BC,n).catch(n)}decodeDracoFile(e,t,n,r,i=NC,s=()=>{}){const a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:i};return this.decodeGeometry(e,a).then(t).catch(s)}decodeGeometry(e,t){const n=JSON.stringify(t);if(VL.has(e)){const t=VL.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(i,s).then(n=>(r=n,new Promise((n,s)=>{r._callbacks[i]={resolve:n,reject:s},r.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return a.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),VL.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new Mk;e.index&&t.setIndex(new gk(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],i=r.name,s=r.array,a=r.itemSize,o=new gk(s,a);"color"===i&&(this._assignVertexColorSpace(o,r.vertexColorSpace),o.normalized=s instanceof Float32Array==0),t.setAttribute(i,o)}return t}_assignVertexColorSpace(e,t){if(t!==BC)return;const n=new ck;for(let t=0,r=e.count;t<r;t++)n.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new TD(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((t,r)=>{n.load(e,t,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const r=WL.toString(),i=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function WL(){let e,t;function n(e,t,n,r,i,s){const a=s.num_components(),o=n.num_points()*a,l=o*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,s,c,l,u);const h=new i(e.HEAPF32.buffer,u,o).slice();return e._free(u),{name:r,array:h,itemSize:a}}onmessage=function(r){const i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":const r=i.buffer,s=i.taskConfig;t.then(e=>{const t=e.draco,a=new t.Decoder;try{const e=function(e,t,r,i){const s=i.attributeIDs,a=i.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(r,r.byteLength,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(r,r.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const r in s){const l=self[a[r]];let c,h;if(i.useUniqueIDs)h=s[r],c=t.GetAttributeByUniqueId(o,h);else{if(h=t.GetAttributeId(o,e[s[r]]),-1===h)continue;c=t.GetAttribute(o,h)}const d=n(e,t,o,r,l,c);"color"===r&&(d.vertexColorSpace=i.vertexColorSpace),u.attributes.push(d)}return c===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){const r=3*n.num_faces(),i=4*r,s=e._malloc(i);t.GetTrianglesUInt32Array(n,i,s);const a=new Uint32Array(e.HEAPF32.buffer,s,r).slice();return e._free(s),{array:a,itemSize:1}}(e,t,o)),e.destroy(o),u}(t,a,new Int8Array(r),s),o=e.attributes.map(e=>e.array.buffer);e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(a)}})}}}const qL=new zA,KL=new VA,$L=new VA,XL=new VA,YL=new VA,ZL=new VA,JL=new zA,QL=new VA,eB=new VA,tB=new VA,nB=new bM;class rB{constructor(e,t=[]){this.mesh=e,this.iks=t,this._valid()}update(){const e=this.iks;for(let t=0,n=e.length;t<n;t++)this.updateOne(e[t]);return this}updateOne(e){const t=this.mesh.skeleton.bones,n=Math,r=t[e.effector],i=t[e.target];KL.setFromMatrixPosition(i.matrixWorld);const s=e.links,a=void 0!==e.iteration?e.iteration:1;for(let i=0;i<a;i++){let i=!1;for(let a=0,o=s.length;a<o;a++){const o=t[s[a].index];if(!1===s[a].enabled)break;const l=s[a].limitation,c=s[a].rotationMin,u=s[a].rotationMax;o.matrixWorld.decompose(ZL,JL,QL),JL.invert(),XL.setFromMatrixPosition(r.matrixWorld),YL.subVectors(XL,ZL),YL.applyQuaternion(JL),YL.normalize(),$L.subVectors(KL,ZL),$L.applyQuaternion(JL),$L.normalize();let h=$L.dot(YL);if(h>1?h=1:h<-1&&(h=-1),h=n.acos(h),!(h<1e-5)){if(void 0!==e.minAngle&&h<e.minAngle&&(h=e.minAngle),void 0!==e.maxAngle&&h>e.maxAngle&&(h=e.maxAngle),eB.crossVectors(YL,$L),eB.normalize(),qL.setFromAxisAngle(eB,h),o.quaternion.multiply(qL),void 0!==l){let e=o.quaternion.w;e>1&&(e=1);const t=n.sqrt(1-e*e);o.quaternion.set(l.x*t,l.y*t,l.z*t,e)}void 0!==c&&o.rotation.setFromVector3(tB.setFromEuler(o.rotation).max(c)),void 0!==u&&o.rotation.setFromVector3(tB.setFromEuler(o.rotation).min(u)),o.updateMatrixWorld(!0),i=!0}}if(!i)break}return this}createHelper(e){return new aB(this.mesh,this.iks,e)}_valid(){const e=this.iks,t=this.mesh.skeleton.bones;for(let n=0,r=e.length;n<r;n++){const r=e[n],i=t[r.effector],s=r.links;let a,o;a=i;for(let e=0,n=s.length;e<n;e++)o=t[s[e].index],a.parent!==o&&console.warn("THREE.CCDIKSolver: bone "+a.name+" is not the child of bone "+o.name),a=o}}}function iB(e,t){return tB.setFromMatrixPosition(e.matrixWorld).applyMatrix4(t)}function sB(e,t,n,r){const i=iB(n,r);e[3*t+0]=i.x,e[3*t+1]=i.y,e[3*t+2]=i.z}class aB extends qM{constructor(e,t=[],n=.25){super(),this.root=e,this.iks=t,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new tD(n,16,8),this.targetSphereMaterial=new fk({color:new ck(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new fk({color:new ck(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new fk({color:new ck(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new PI({color:new ck(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}updateMatrixWorld(e){const t=this.root;if(this.visible){let e=0;const n=this.iks,r=t.skeleton.bones;nB.copy(t.matrixWorld).invert();for(let t=0,i=n.length;t<i;t++){const i=n[t],s=r[i.target],a=r[i.effector],o=this.children[e++],l=this.children[e++];o.position.copy(iB(s,nB)),l.position.copy(iB(a,nB));for(let t=0,n=i.links.length;t<n;t++){const n=r[i.links[t].index];this.children[e++].position.copy(iB(n,nB))}const c=this.children[e++],u=c.geometry.attributes.position.array;sB(u,0,s,nB),sB(u,1,a,nB);for(let e=0,t=i.links.length;e<t;e++)sB(u,e+2,r[i.links[e].index],nB);c.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(t.matrixWorld),super.updateMatrixWorld(e)}dispose(){this.sphereGeometry.dispose(),this.targetSphereMaterial.dispose(),this.effectorSphereMaterial.dispose(),this.linkSphereMaterial.dispose(),this.lineMaterial.dispose();const e=this.children;for(let t=0;t<e.length;t++){const n=e[t];n.isLine&&n.geometry.dispose()}}_init(){const e=this,t=this.iks;function n(){return new Wk(e.sphereGeometry,e.targetSphereMaterial)}function r(){return new Wk(e.sphereGeometry,e.effectorSphereMaterial)}function i(){return new Wk(e.sphereGeometry,e.linkSphereMaterial)}function s(t){return new HI(function(e){const t=new Mk,n=new Float32Array(3*(2+e.links.length));return t.setAttribute("position",new gk(n,3)),t}(t),e.lineMaterial)}for(let e=0,a=t.length;e<a;e++){const a=t[e];this.add(n()),this.add(r());for(let e=0,t=a.links.length;e<t;e++)this.add(i());this.add(s(a))}}}function oB(e){return oB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oB(e)}var lB;function cB(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return uB(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(uB(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,uB(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,uB(h,"constructor",c),uB(c,"constructor",l),l.displayName="GeneratorFunction",uB(c,i,"GeneratorFunction"),uB(h),uB(h,i,"Generator"),uB(h,r,function(){return this}),uB(h,"toString",function(){return"[object Generator]"}),(cB=function(){return{w:s,m:d}})()}function uB(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}uB=function(e,t,n,r){function s(t,n){uB(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},uB(e,t,n,r)}function hB(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function dB(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){hB(s,r,i,a,o,"next",e)}function o(e){hB(s,r,i,a,o,"throw",e)}a(void 0)})}}function fB(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,pB(r.key),r)}}function pB(e){var t=function(e){if("object"!=oB(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=oB(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==oB(t)?t:t+""}function mB(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(mB=function(){return!!e})()}function gB(e){return gB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gB(e)}function vB(e,t){return vB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vB(e,t)}var _B,bB,yB,wB,SB,xB,EB,CB,AB,MB,kB,TB,RB,PB,IB,DB,OB,LB,BB,NB,UB,HB,FB,jB,zB,VB,GB,WB,qB,KB=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=gB(t),function(e,t){if(t&&("object"==oB(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,mB()?Reflect.construct(t,n||[],gB(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.scene=null,e.camera=null,e.renderer=null,e.orbitControls=null,e.transformControls=null,e.mirrorSphereCamera=null,e.OOI={},e.IKSolver=null,e.stats=null,e.gui=null,e.conf=null,e.v0=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vB(e,t)}(t,e),function(e,t,n){return t&&fB(e.prototype,t),n&&fB(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"firstUpdated",value:(r=dB(cB().m(function e(){return cB().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initThreeJS();case 1:this.requestUpdate();case 2:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"initThreeJS",value:(n=dB(cB().m(function e(){var t,n,r,i,s,a,o,l,c,u;return cB().w(function(e){for(;;)switch(e.n){case 0:return(t=this).v0=new VA,t.conf={followSphere:!1,turnHead:!0,ik_solver:!0,update:t.updateIK},t.scene=new rI,t.scene.fog=new nI(16777215,.17),t.scene.background=new ck(16777215),t.camera=new rT(55,window.innerWidth/window.innerHeight,.001,5e3),t.camera.position.set(.9728517749133652,1.1044765132727201,.7316689528482836),t.camera.lookAt(t.scene.position),n=new qD(16777215,8),t.scene.add(n),(r=new GL).setDecoderPath("three/jsm/libs/draco/"),(i=new YO).setDRACOLoader(r),e.n=1,i.loadAsync("3d-models/room.glb");case 1:if((s=e.v).scene.traverse(function(e){"head"===e.name&&(t.OOI.head=e),"lowerarm_l"===e.name&&(t.OOI.lowerarm_l=e),"Upperarm_l"===e.name&&(t.OOI.Upperarm_l=e),"hand_l"===e.name&&(t.OOI.hand_l=e),"target_hand_l"===e.name&&(t.OOI.target_hand_l=e),"boule"===e.name&&(t.OOI.sphere=e),"Kira_Shirt_left"===e.name&&(t.OOI.kira=e)}),t.scene.add(s.scene),a=t.OOI.sphere.position.clone(),t.OOI.hand_l.attach(t.OOI.sphere),o=new oT(1024),t.mirrorSphereCamera=new sT(.05,50,o),t.scene.add(t.mirrorSphereCamera),l=new fk({envMap:o.texture}),t.OOI.sphere.material=l,t.OOI.kira.add(t.OOI.kira.skeleton.bones[0]),c=[{target:22,effector:6,links:[{index:5,rotationMin:new VA(1.2,-1.8,-.4),rotationMax:new VA(1.7,-1.1,.3)},{index:4,rotationMin:new VA(.1,-.7,-1.8),rotationMax:new VA(1.1,0,-1.4)}]}],t.IKSolver=new rB(t.OOI.kira,c),t.renderer=new tI({antialias:!0}),u=document.getElementById("vr-container")){e.n=2;break}return e.a(2);case 2:u.appendChild(t.renderer.domElement),t.renderer.setPixelRatio(u.devicePixelRatio),t.renderer.setSize(u.clientWidth,u.clientHeight),t.renderer.setAnimationLoop(function(){t.animate(t)}),t.orbitControls=new gO(t.camera,t.renderer.domElement),t.orbitControls.minDistance=.2,t.orbitControls.maxDistance=1.5,t.orbitControls.enableDamping=!0,t.orbitControls.target.copy(a),t.transformControls=new AO(t.camera,t.renderer.domElement),t.transformControls.size=.75,t.transformControls.showX=!1,t.transformControls.space="world",t.transformControls.attach(t.OOI.target_hand_l),t.scene.add(t.transformControls),t.transformControls.addEventListener("mouseDown",function(){return t.orbitControls.enabled=!1}),t.transformControls.addEventListener("mouseUp",function(){return t.orbitControls.enabled=!0}),window.addEventListener("resize",function(e){t.onWindowResize(e,t)},!1);case 3:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"animate",value:function(e){e.OOI.sphere&&e.mirrorSphereCamera&&(e.OOI.sphere.visible=!1,e.OOI.sphere.getWorldPosition(e.mirrorSphereCamera.position),e.mirrorSphereCamera.update(e.renderer,e.scene),e.OOI.sphere.visible=!0),e.OOI.sphere&&e.conf.followSphere&&(e.OOI.sphere.getWorldPosition(v0),e.orbitControls.target.lerp(v0,.1)),e.OOI.head&&e.OOI.sphere&&e.conf.turnHead&&(e.OOI.sphere.getWorldPosition(e.v0),e.OOI.head.lookAt(e.v0),e.OOI.head.rotation.set(e.OOI.head.rotation.x,e.OOI.head.rotation.y+Math.PI,e.OOI.head.rotation.z)),e.conf.ik_solver&&e.updateIK(),e.orbitControls.update(),e.renderer.render(e.scene,e.camera)}},{key:"updateIK",value:function(){var e=this;e.IKSolver&&e.IKSolver.update(),e.scene.traverse(function(e){e.isSkinnedMesh&&e.computeBoundingSphere()})}},{key:"onWindowResize",value:function(e,t){var n=document.getElementById("vr-container");t.camera.aspect=window.innerWidth/window.innerHeight,t.camera.updateProjectionMatrix(),t.renderer.setSize(n.clientWidth,n.clientHeight)}},{key:"render",value:function(){var e=this.inori.env.content.getL2();return W(lB||(lB=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <p class="card-text">','</p>\n  <div class="object-fit-fill border rounded" style="height: 600px;" id="vr-container"></div>\n</main>'])),this.inori.env.content.get(),e)}}],[{key:"properties",get:function(){return{inori:{type:Object}}}}]);var n,r}(ce);function $B(e){return $B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$B(e)}function XB(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s,a,o=[],l=!0,c=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return YB(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?YB(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function YB(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ZB(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function JB(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return QB(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(QB(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,QB(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,QB(h,"constructor",c),QB(c,"constructor",l),l.displayName="GeneratorFunction",QB(c,i,"GeneratorFunction"),QB(h),QB(h,i,"Generator"),QB(h,r,function(){return this}),QB(h,"toString",function(){return"[object Generator]"}),(JB=function(){return{w:s,m:d}})()}function QB(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}QB=function(e,t,n,r){function s(t,n){QB(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},QB(e,t,n,r)}function eN(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function tN(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){eN(s,r,i,a,o,"next",e)}function o(e){eN(s,r,i,a,o,"throw",e)}a(void 0)})}}function nN(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rN(r.key),r)}}function rN(e){var t=function(e){if("object"!=$B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=$B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$B(t)?t:t+""}function iN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(iN=function(){return!!e})()}function sN(){return sN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=aN(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},sN.apply(null,arguments)}function aN(e){return aN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},aN(e)}function oN(e,t){return oN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oN(e,t)}customElements.define("streaming-virtual-reality",KB);var lN,cN,uN,hN,dN,fN,pN,mN,gN,vN,_N,bN,yN,wN=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=aN(t),function(e,t){if(t&&("object"==$B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,iN()?Reflect.construct(t,n||[],aN(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.remoteId="",e.intervalId=0,e.trackIntervalId=0,e.miniFileList={path:{}},e.localMediaStream={},e.directoryList={files:[],root:"/"},e.gcURLList={},e.fileContent={progress:0,fileId:"",fileType:-1,contentType:"",fileName:"",dom:null,buf:[]},e.selectedDir2Archive=null,e.selectedDrives=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oN(e,t)}(t,e),function(e,t,n){return t&&nN(e.prototype,t),n&&nN(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"isElementInViewport",value:function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}},{key:"findVisibleElements",value:function(){var e=document.querySelectorAll(".mini-img"),t=[],n=this;return e.forEach(function(e){n.isElementInViewport(e)&&e.classList.values().toArray().includes("d-none")&&t.push(e)}),t}},{key:"refreshMiniImg",value:function(e){this.inori.tenant.get_file_type_values()}},{key:"firstUpdated",value:function(){var e=this,t=e.inori.tenant.get_file_type_values(),n=function(){var n=tN(JB().m(function n(r){return JB().w(function(n){for(;;)switch(n.n){case 0:e.directoryList.files.filter(function(n){if(n.type==t.IMAGE||n.type==t.VIDEO){var r=e.inori.util.convert_path_2_Id("".concat(n.path,"/").concat(n.name)),i=e.miniFileList[r];return!(i||(i=e.inori.util.read_image_obj("/inori/image/mini/".concat(r)))&&(e.miniFileList[r]=i,e.requestUpdate(),1))}return!1}).some(function(n,r){if(r>10)return!0;n.metaData=window.crypto.randomUUID(),e.inori.tenant.get_remote_file(e.remoteId,"".concat(n.path,"/").concat(n.name),n.metaData,t.MINIMUM,n.contentType)});case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}();e.intervalId=setInterval(n,3e3)}},{key:"updated",value:function(e){e.has("inori")&&this.inori}},{key:"_loggedInHandler",value:(i=tN(JB().m(function e(){return JB().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"connectDevice",value:(r=tN(JB().m(function e(t){return JB().w(function(e){for(;;)switch(e.n){case 0:this.tenants_requested[t]=!0,this.dispatchEvent(new CustomEvent("local:stream:req",{detail:{tab_id:0,metadata:t}}));case 1:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"disconnectedCallback",value:function(){clearInterval(this.intervalId),clearInterval(this.trackIntervalId),function(e,t,n){var r=sN(aN(e.prototype),"disconnectedCallback",n);return"function"==typeof r?function(e){return r.apply(n,e)}:r}(t,0,this)([])}},{key:"renderServiceHeader",value:function(){return this.inori.tenant.get_active_tenants()?["name","opCode","lastUpdate","sessionId","services"].map(function(e){return"services"==e?W(bB||(bB=ZB(['<th class="fw-lighter" scope="col"></th>']))):W(yB||(yB=ZB(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W(_B||(_B=ZB([""])))}},{key:"renderServiceContent",value:function(){var e=this.inori.tenant.get_active_services(),t=this;return e||(e={}),Object.values(e).map(function(e){if(e.opCode.includes("ci-deploy-svc"))return W(wB||(wB=ZB(["<tr>","</tr>"])),["name","opCode","lastUpdate","sessionId","services"].map(function(n){if("opCode"==n)return W(SB||(SB=ZB(['<td class="fw-light">',"</td>"])),e[n]);if("name"==n)return W(xB||(xB=ZB(['\n                    <td class="fw-light">\n                        <a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">',"</a>\n                    </td>"])),function(){var n=tN(JB().m(function n(r){var i,s,a,o;return JB().w(function(n){for(;;)switch(n.n){case 0:if(!(i=t.inori.tenant.get_subscription(e.sessionId))){n.n=1;break}return t.remoteId=i.sessionId,t.updateDirContent(""),n.a(2);case 1:if(!e.processorId){n.n=2;break}return s="video-preview-".concat(e.processorId),a=t.inori.tenant.add_processor("".concat(s)),o=t.inori.util.dbg,a.streamRcvdCallback=function(e){e.getTracks().forEach(function(e){"video"==e.kind&&e.addEventListener("unmute",function(t){o("Track ".concat(e.id," has been unmuted"))},{once:!0}),"live"==e.readyState&&o("remote ".concat(e.kind," stream with id: ").concat(e.id," readyState: ").concat(e.readyState," received"))})},a.dat.remoteId=e.sessionId,a.dat.id=e.processorId,a.peerChannelCallback=function(){var e=tN(JB().m(function e(n){var r,s;return JB().w(function(e){for(;;)switch(e.n){case 0:(i=a.get_subscriber(a.dat.remoteId))&&(t.inori.tenant.add_subscription(i),t.remoteId=i.sessionId,t.updateDirContent(""),r=t.inori.tenant.get_file_type_values(),s=t.inori.tenant.get_file_chunks(),i.onLoadingSignal=function(e){if(t.fileContent.fileType!==r.VIDEO){if(s[t.fileContent.fileId]){var n=s[t.fileContent.fileId],i=Object.keys(n.chunks).length/n.totalChunks;t.fileContent.progress=Math.round(100*i)}t.requestUpdate()}},i.onLoadedMiniSignal=function(e){t.requestUpdate()},i.onLoadSignal=function(e){t.fileContent.fileId==e?t.fileContent.progress=0:t.inori.util.dbg("invalid file id ".concat(t.fileContent.fileId," but received ").concat(e))},i.onLoadedSignal=function(){var e=tN(JB().m(function e(n,i){var s,a,o,l,c,u;return JB().w(function(e){for(;;)switch(e.n){case 0:if(i){e.n=1;break}return e.a(2);case 1:u=t.fileContent.fileType,e.n=u===r.AUDIO||u===r.VIDEO||u===r.MISC?2:u===r.IMAGE?3:5;break;case 2:return s=new Blob([i],{type:t.fileContent.contentType}),a=window.URL.createObjectURL(s),(o=document.createElement("a")).href=a,o.download=t.fileContent.fileName,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),t.fileContent.dom.hide(),t.requestUpdate(),s=null,e.a(2);case 3:return l=new Blob([i],{type:t.fileContent.contentType}),c=URL.createObjectURL(l),t.imageUrl=c,t.requestUpdate(),e.n=4,t.updateComplete;case 4:return URL.revokeObjectURL(c),l=null,e.a(2);case 5:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.n=2,a.req2RemoteStream();case 2:t.requestUpdate();case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),e[n]);if("sessionId"==n)return W(EB||(EB=ZB(['<td class="fw-light"><a class="btn btn-link btn-sm py-0 ','" @click="','">',"</a></td>"])),t.inori.tenant.session_id()==e[n]?"disabled":"",t.connectDevice.bind(t,e[n]),e[n]);if("services"==n)return W(CB||(CB=ZB(['<td class="fw-light align-bottom">',"</td>"])),t.inori.tenant.session_id()==e.sessionId?W(AB||(AB=ZB(['   \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video" viewBox="0 0 16 16">\n    <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"/>\n  </svg>\n</a>      \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cast" viewBox="0 0 16 16">\n    <path d="m7.646 9.354-3.792 3.792a.5.5 0 0 0 .353.854h7.586a.5.5 0 0 0 .354-.854L8.354 9.354a.5.5 0 0 0-.708 0z"/>\n    <path d="M11.414 11H14.5a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h3.086l-1 1H1.5A1.5 1.5 0 0 1 0 10.5v-7A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v7a1.5 1.5 0 0 1-1.5 1.5h-2.086l-1-1z"/>\n  </svg>\n</a>'])),t.inori.tenant.has_local_stream_processor()?"disabled":"",t.inori.tenant.standby_video_sharing.bind(t.inori,null),t.inori.tenant.has_local_stream_processor()?"disabled":"",function(){var e=tN(JB().m(function e(n){return JB().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.tenant.standby_screen_sharing(null);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()):W(MB||(MB=ZB([""]))));var r=e[n];if("lastUpdate"==n){var i=t.inori.util.formatUnix2Date(r);return W(kB||(kB=ZB(['<td class="fw-light">',"</td>"])),i)}return W(TB||(TB=ZB(['<td class="fw-light text-truncate">',"</td>"])),r)}))})}},{key:"renderDirHeader",value:function(){return["file name","","type","content","lastUpdate","size",""].map(function(e){return W(RB||(RB=ZB(['<th class="fw-lighter" scope="col">',"</th>"])),e)})}},{key:"updateDirContent",value:(n=tN(JB().m(function e(t,n){var r,i,s,a,o,l,c;return JB().w(function(e){for(;;)switch(e.n){case 0:if(i=(r=this).inori.util.normalizePath(t),!n){e.n=5;break}s=r.inori.tenant.get_file_type_values(),a=new bootstrap.Modal("#exampleModal"),o=document.getElementById("exampleModal"),r.fileContent.fileName=n.name,c=n.type,e.n=c===s.VIDEO?1:c===s.AUDIO?2:c===s.MISC||c===s.IMAGE?3:(s.DIR,4);break;case 1:return r.fileContent.fileType=s.VIDEO,r.fileContent.contentType=n.contentType,r.fileContent.fileId=window.crypto.randomUUID(),r.inori.tenant.get_remote_file(r.remoteId,i,r.fileContent.fileId,s.VIDEO),l=r.inori.tenant.get_processors().find(function(e){return e.dat.name.includes("video-preview")}),r.fileContent.fileId&&r.dispatchEvent(new CustomEvent("local:stream:switch",{detail:{remoteId:r.remoteId,fileId:r.fileContent.fileId,processorInfo:l,fileDir:i}})),e.a(2);case 2:return e.a(2);case 3:return r.fileContent.dom=a,o.addEventListener("hidden.bs.modal",function(e){delete r.inori.tenant.get_file_chunks()[r.fileContent.fileId],r.inori.tenant.stop_remote_file(r.remoteId,r.fileContent.fileId,n.type)},{once:!0}),r.imageUrl="",r.fileContent.fileType=n.type,r.fileContent.contentType=n.contentType,r.fileContent.fileId=window.crypto.randomUUID(),r.inori.tenant.get_remote_file(r.remoteId,i,r.fileContent.fileId,n.type==s.IMAGE?s.FIT:s.MISC),a.show(o),r.requestUpdate(),e.a(2);case 4:return e.a(3,5);case 5:r.inori.tenant.upd_remote_file_list(r.remoteId,i,function(e){if(e){for(var t=0,n=Object.entries(r.gcURLList);t<n.length;t++){var i=XB(n[t],2),s=(i[0],i[1]);URL.revokeObjectURL(s)}r.gcURLList={},r.directoryList=e,r.requestUpdate()}});case 6:return e.a(2)}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"renderDirContent",value:function(){var e=this,t=e.inori.tenant.get_file_type_values(),n=e.inori.tenant.get_active_services().find(function(t){return t.sessionId==e.remoteId});return n?W(IB||(IB=ZB(["\n    <tr>","</tr>\n            ","\n        ",""])),["fileName","","type","content","lastUpdate","size",""].map(function(t){return"fileName"==t?W(DB||(DB=ZB(['\n          <td class="fw-light">\n            <a class="btn btn-link btn-sm py-0 text-truncate" role="button" @click="','">',"</a>\n          </td>"])),function(t){e.remoteId="",e.requestUpdate()},n.name):"type"==t?W(OB||(OB=ZB(['<td class="fw-light">Device</td>']))):"content"==t?W(LB||(LB=ZB(['<td class="fw-light">',", ","</td>"])),n.device.os,n.device.name):W(BB||(BB=ZB(['<td class="fw-light"></td>'])))}),"/"==e.directoryList.root?W(NB||(NB=ZB([""]))):W(UB||(UB=ZB(['\n    <tr>\n      <td class="fw-light"><a class="btn btn-link btn-sm py-0" @click="','">/</a></td>\n      <td colspan="6" class="fw-light"></td>\n    </tr>\n    <tr>\n      <td class="fw-light"><a class="btn btn-link btn-sm py-0" @click="','">.','/..</a></td>\n      <td colspan="6" class="fw-light"></td>\n    </tr>'])),function(){var t=tN(JB().m(function t(n){return JB().w(function(t){for(;;)switch(t.n){case 0:e.updateDirContent("");case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=tN(JB().m(function t(n){return JB().w(function(t){for(;;)switch(t.n){case 0:e.updateDirContent("".concat(e.directoryList.root,"/.."));case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),e.directoryList.root),e.directoryList.files.map(function(r,i){var s,a=e.inori.tenant.dataType(),o=r.lastUpdate&&e.inori.util.formatUnix2Date(r.lastUpdate);switch(e.inori.util.convert_path_2_Id("".concat(e.directoryList.root,"/").concat(r.name)),r.type){case t.VIDEO:case t.IMAGE:var l=e.inori.util.convert_path_2_Id("".concat(r.path,"/").concat(r.name));if(!(s=e.miniFileList[l]))return W(HB||(HB=ZB([""])))}return W(FB||(FB=ZB(['\n    <tr>\n      <td class="fw-light"><a class="btn btn-link btn-sm py-0" @click="','">','</a></td>\n      <td class="fw-light"><img src="','" class="mx-auto rounded ',' mini-img"></td>\n      <td class="fw-light">','</td>\n      <td class="fw-light">','</td>\n      <td class="fw-light">','</td>\n      <td class="fw-light">','</td>\n      <td class="fw-light text-nowrap">\n          ',"\n      </td>\n    </tr>"])),function(){var t=tN(JB().m(function t(n){return JB().w(function(t){for(;;)switch(t.n){case 0:e.updateDirContent("".concat(e.directoryList.root,"/").concat(r.name),r);case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),r.name,s||"",s?"d-block":"d-none",e.inori.util.findKeyByValue(a.FileType.values,r.type),r.metadata||r.contentType,o,r.size,e.inori.tenant.get_active_services().find(function(e){if(!e.opCode.includes("backup"))return!1;if(e.device&&e.device.drives)for(var t=0;t<e.device.drives.length;t++)if(e.device.drives[t].mounted.includes(r.name))return!0;return!1})?W(jB||(jB=ZB(['\n            <div class="spinner-border spinner-border-sm text-primary" role="status"></div>']))):W(zB||(zB=ZB(['\n            <a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-archive" viewBox="0 0 16 16">\n                    <path d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5zm13-3H1v2h14zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"/>\n                </svg>\n            </a>\n            <a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button">\n                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eject" viewBox="0 0 16 16">\n                  <path d="M7.27 1.047a1 1 0 0 1 1.46 0l6.345 6.77c.6.638.146 1.683-.73 1.683H1.656C.78 9.5.326 8.455.926 7.816zM14.346 8.5 8 1.731 1.654 8.5zM.5 11.5a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1h-13a1 1 0 0 1-1-1zm14 0h-13v1h13z"/>\n                </svg>\n            </a>\n            '])),function(){var t=tN(JB().m(function t(i){var s,a;return JB().w(function(t){for(;;)switch(t.n){case 0:return e.selectedDir2Archive={device:n.device.name,dir:r.name,drive:n.device.drives.find(function(e){return e.mounted.includes(r.name)}),sessionId:n.sessionId},e.requestUpdate(),t.n=1,e.updateComplete;case 1:s=new bootstrap.Modal("#backupModal"),a=document.getElementById("backupModal"),s.show(a),e.requestUpdate();case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()))})):W(PB||(PB=ZB([""])))}},{key:"render",value:function(){var e=this,t=e.inori.tenant.get_active_services(),n=this.inori.env.content.getL2(),r=e.inori.tenant.get_file_type_values();return W(VB||(VB=ZB(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <p class="card-text">','</p>\n  <table class="table table-striped table-hover">\n    <thead>\n      <tr>\n        ',"\n      </tr>\n    </thead>\n    <tbody>\n      ",'\n    </tbody>\n  </table>\n  <div class="modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h1 class="modal-title fs-5" id="exampleModalLabel">','</h1>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="','">\n            <div class="progress" role="progressbar" aria-label="Animated striped example" aria-valuenow="','" aria-valuemin="0" aria-valuemax="100">\n              <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: ','%;"></div>\n            </div>\n          </div>\n          <img src="','" class="img-fluid border w-100 rounded ','">       \n       </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n          <button type="button" class="btn btn-primary">Save changes</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  ',"  \n</main>"])),this.inori.env.content.get(),n,""!=e.remoteId?this.renderDirHeader():this.renderServiceHeader(),""!=e.remoteId?this.renderDirContent():this.renderServiceContent(),e.fileContent.fileName,e.fileContent.progress>99||e.fileContent.fileType===r.VIDEO||e.imageUrl?"d-none":"d-block",e.fileContent.progress,e.fileContent.progress,e.imageUrl,e.fileContent.fileType===r.IMAGE&&e.fileContent.progress>99?"d-block":"d-none",e.selectedDir2Archive?W(GB||(GB=ZB(['\n  <div class="modal" id="backupModal" tabindex="-1" aria-labelledby="backupModalLabel">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h1 class="modal-title fs-5" id="backupModalLabel">Archive</h1>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div class="row">\n                <p class="fw-light col-10 m-2">From: '," > "," (",')</p>\n                <div class="w-100"></div>\n                <div class="col-10 m-2">\n                    <div class="input-group">\n                        <span class="input-group-text" id="device-options-ico">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pc" viewBox="0 0 16 16">\n                              <path d="M5 0a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1zm.5 14a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1m2 0a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1M5 1.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5M5.5 3h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1"/>\n                            </svg>\n                        </span>                        \n                        <select class="form-select" @change="','" id="device-options" aria-label="Example select with button addon">\n                            <option selected>Service...</option>\n                            ','\n                        </select>\n                    </div>\n                </div>                \n                <div class="w-100"></div>\n                <div class="col-10 m-2">\n                    <div class="input-group">\n                        <span class="input-group-text" id="drive-options-ico">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hdd" viewBox="0 0 16 16">\n                              <path d="M4.5 11a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1M3 10.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>\n                              <path d="M16 11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V9.51c0-.418.105-.83.305-1.197l2.472-4.531A1.5 1.5 0 0 1 4.094 3h7.812a1.5 1.5 0 0 1 1.317.782l2.472 4.53c.2.368.305.78.305 1.198zM3.655 4.26 1.592 8.043Q1.79 8 2 8h12q.21 0 .408.042L12.345 4.26a.5.5 0 0 0-.439-.26H4.094a.5.5 0 0 0-.44.26zM1 10v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1"/>\n                            </svg>\n                        </span>\n                        <select class="form-select" id="drive-options" aria-label="Example select with button addon">\n                            <option selected>Drive...</option>\n                            ','\n                        </select>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="','">Confirm</button>\n        </div>\n      </div>\n    </div>\n  </div>'])),e.selectedDir2Archive.device,e.selectedDir2Archive.dir,e.selectedDir2Archive.drive.used,function(n){var r=t.find(function(e){return e.sessionId==n.target.value});r&&(e.selectedDrives=r.device.drives.filter(function(e){return e.mounted.includes("yasuda")}),e.requestUpdate())},t.filter(function(t){return t.sessionId!=e.remoteId}).map(function(e){return W(WB||(WB=ZB(['<option value="','">',"</option>"])),e.sessionId,e.device.name)}),e.selectedDrives.map(function(e){return W(qB||(qB=ZB(['<option value="','">'," (Available: $",")</option>"])),e.mounted.split("/").pop(),e.mounted.split("/").pop(),e.avail)}),function(n){var r=document.getElementById("device-options"),i=t.find(function(e){return e.sessionId==r.value}),s=document.getElementById("drive-options");e.inori.tenant.req_drive_backup(e.selectedDir2Archive.sessionId,e.selectedDir2Archive.device,e.selectedDir2Archive.dir,i.device.name,s.value)}):"")}}],[{key:"properties",get:function(){return{inori:{type:Object},localMediaStream:{type:Object},tenants:{type:Object},tenants_requested:{type:Object}}}}]);var n,r,i}(ce);function SN(e){return SN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SN(e)}function xN(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function EN(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return CN(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(CN(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,CN(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,CN(h,"constructor",c),CN(c,"constructor",l),l.displayName="GeneratorFunction",CN(c,i,"GeneratorFunction"),CN(h),CN(h,i,"Generator"),CN(h,r,function(){return this}),CN(h,"toString",function(){return"[object Generator]"}),(EN=function(){return{w:s,m:d}})()}function CN(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}CN=function(e,t,n,r){function s(t,n){CN(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},CN(e,t,n,r)}function AN(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function MN(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){AN(s,r,i,a,o,"next",e)}function o(e){AN(s,r,i,a,o,"throw",e)}a(void 0)})}}function kN(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,TN(r.key),r)}}function TN(e){var t=function(e){if("object"!=SN(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=SN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==SN(t)?t:t+""}function RN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(RN=function(){return!!e})()}function PN(e){return PN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},PN(e)}function IN(e,t){return IN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},IN(e,t)}customElements.define("streaming-drives",wN);var DN=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=PN(t),function(e,t){if(t&&("object"==SN(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,RN()?Reflect.construct(t,n||[],PN(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.tenants=null,e.tenants_requested={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IN(e,t)}(t,e),function(e,t,n){return t&&kN(e.prototype,t),n&&kN(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(i=MN(EN().m(function e(){return EN().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"renderTenantHeader",value:function(){return this.tenants?["name","lastUpdate","sessionId","services"].map(function(e){return"sessionId"==e?W(cN||(cN=xN(['<th class="fw-lighter" scope="col">request</th>']))):W(uN||(uN=xN(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W(lN||(lN=xN([""])))}},{key:"renderTenantContent",value:function(){var e=this.tenants,t=this;return e||(e={}),Object.values(e).map(function(e){return W(hN||(hN=xN(["<tr>","</tr>"])),["name","lastUpdate","sessionId","services"].map(function(n){if("sessionId"==n)return W(dN||(dN=xN(['<td class="fw-light"><a class="btn btn-link btn-sm py-0 ','" @click="','">',"</a></td>"])),t.inori.tenant.session_id()==e[n]?"disabled":"",t.connectDevice.bind(t,e[n]),e[n]);if("services"==n)return W(fN||(fN=xN(['<td class="fw-light align-bottom">',"</td>"])),t.inori.tenant.session_id()==e.sessionId?W(pN||(pN=xN(['   \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video" viewBox="0 0 16 16">\n    <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"/>\n  </svg>\n</a>      \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cast" viewBox="0 0 16 16">\n    <path d="m7.646 9.354-3.792 3.792a.5.5 0 0 0 .353.854h7.586a.5.5 0 0 0 .354-.854L8.354 9.354a.5.5 0 0 0-.708 0z"/>\n    <path d="M11.414 11H14.5a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h3.086l-1 1H1.5A1.5 1.5 0 0 1 0 10.5v-7A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v7a1.5 1.5 0 0 1-1.5 1.5h-2.086l-1-1z"/>\n  </svg>\n</a>'])),t.inori.tenant.has_local_stream_processor()?"disabled":"",t.inori.tenant.standby_video_sharing.bind(t.inori,null),t.inori.tenant.has_local_stream_processor()?"disabled":"",function(){var e=MN(EN().m(function e(n){return EN().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.tenant.standby_screen_sharing(null);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()):W(mN||(mN=xN(["",""])),e.role==t.inori.tenant.dataType().Role.values.SERVICE||e.role==t.inori.tenant.dataType().Role.values.BRIDGE||e.role==t.inori.tenant.dataType().Role.values.REST_API?W(gN||(gN=xN(['\n<a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-terminal" viewBox="0 0 16 16">\n    <path d="M6 9a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3A.5.5 0 0 1 6 9M3.854 4.146a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708l-2-2z"/>\n    <path d="M2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z"/>\n  </svg>\n</a>'])),t.inori.tenant.standby_video_sharing.bind(t.inori,null)):W(vN||(vN=xN([""])))));var r=e[n];if("lastUpdate"==n){var i=t.inori.util.formatUnix2Date(r);return W(_N||(_N=xN(['<td class="fw-light">',"</td>"])),i)}return W(bN||(bN=xN(['<td class="fw-light">',"</td>"])),r.length>20?r.substring(0,20)+"...":r)}))})}},{key:"processStream",value:(r=MN(EN().m(function e(t){return EN().w(function(e){for(;;)switch(e.n){case 0:this.requestUpdate();case 1:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"connectDevice",value:(n=MN(EN().m(function e(t){return EN().w(function(e){for(;;)switch(e.n){case 0:this.tenants_requested[t]=!0,this.dispatchEvent(new CustomEvent("local:stream:req",{detail:{tab_id:0,metadata:t}}));case 1:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this.inori.env.content.getL2();return W(yN||(yN=xN(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <p class="card-text">',"</p>\n</main>"])),this.inori.env.content.get(),e)}}],[{key:"properties",get:function(){return{inori:{type:Object},tenants:{type:Object},tenants_requested:{type:Object}}}}]);var n,r,i}(ce);function ON(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}customElements.define("streaming-hardware",DN),"function"==typeof SuppressedError&&SuppressedError;var LN=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!==i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(s=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!==i--;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;0!==i--;){var a=s[i];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n},BN=ON(LN);const NN="__googleMapsScriptId";var UN,HN;!function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"}(UN||(UN={}));class FN{constructor({apiKey:e,authReferrerPolicy:t,channel:n,client:r,id:i=NN,language:s,libraries:a=[],mapIds:o,nonce:l,region:c,retries:u=3,url:h="https://maps.googleapis.com/maps/api/js",version:d}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=n,this.client=r,this.id=i||NN,this.language=s,this.libraries=a,this.mapIds=o,this.nonce=l,this.region=c,this.retries=u,this.url=h,this.version=d,FN.instance){if(!BN(this.options,FN.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(FN.instance.options)}`);return FN.instance}FN.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?UN.FAILURE:this.done?UN.SUCCESS:this.loading?UN.LOADING:UN.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(n=>{n?t(n.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id))return void this.callback();const n={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(n).forEach(e=>!n[e]&&delete n[e]),(null===(t=null===(e=null===window||void 0===window?void 0:window.google)||void 0===e?void 0:e.maps)||void 0===t?void 0:t.importLibrary)||(e=>{let t,n,r,i="The Google Maps JavaScript API",s="google",a="importLibrary",o="__ib__",l=document,c=window;c=c[s]||(c[s]={});const u=c.maps||(c.maps={}),h=new Set,d=new URLSearchParams,f=()=>t||(t=new Promise((a,c)=>function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,o)}l((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){var f;for(r in yield n=l.createElement("script"),n.id=this.id,d.set("libraries",[...h]+""),e)d.set(r.replace(/[A-Z]/g,e=>"_"+e[0].toLowerCase()),e[r]);d.set("callback",s+".maps."+o),n.src=this.url+"?"+d,u[o]=a,n.onerror=()=>t=c(Error(i+" could not load.")),n.nonce=this.nonce||(null===(f=l.querySelector("script[nonce]"))||void 0===f?void 0:f.nonce)||"",l.head.append(n)})));u[a]?console.warn(i+" only loads once. Ignoring:",e):u[a]=(e,...t)=>h.add(e)&&f().then(()=>u[a](e,...t))})(n);const r=this.libraries.map(e=>this.importLibrary(e));r.length||r.push(this.importLibrary("core")),Promise.all(r).then(()=>this.callback(),e=>{const t=new ErrorEvent("error",{error:e});this.loadErrorCallback(t)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const e=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},e)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),void this.callback();this.loading=!0,this.setScript()}}}function jN(e){return jN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jN(e)}function zN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function VN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zN(Object(n),!0).forEach(function(t){GN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zN(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function GN(e,t,n){return(t=YN(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WN(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return qN(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(qN(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,qN(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,qN(h,"constructor",c),qN(c,"constructor",l),l.displayName="GeneratorFunction",qN(c,i,"GeneratorFunction"),qN(h),qN(h,i,"Generator"),qN(h,r,function(){return this}),qN(h,"toString",function(){return"[object Generator]"}),(WN=function(){return{w:s,m:d}})()}function qN(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}qN=function(e,t,n,r){function s(t,n){qN(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},qN(e,t,n,r)}function KN(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function $N(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){KN(s,r,i,a,o,"next",e)}function o(e){KN(s,r,i,a,o,"throw",e)}a(void 0)})}}function XN(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,YN(r.key),r)}}function YN(e){var t=function(e){if("object"!=jN(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=jN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==jN(t)?t:t+""}function ZN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ZN=function(){return!!e})()}function JN(){return JN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=QN(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},JN.apply(null,arguments)}function QN(e){return QN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},QN(e)}function eU(e,t){return eU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},eU(e,t)}var tU=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=QN(t),function(e,t){if(t&&("object"==jN(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ZN()?Reflect.construct(t,n||[],QN(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.sceneKey="earth",e.camera=null,e.actionKey=null,e.directionKey=null,e.isMapMoving=!1,e.map=null,e.turnIntervalId=null,e.location=null,e.pos={lat:0,lon:0,markerX:0,markerY:0,cursorX:0,cursorY:0},e.carSpeed=.1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eU(e,t)}(t,e),function(e,t,n){return t&&XN(e.prototype,t),n&&XN(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"firstUpdated",value:(a=$N(WN().m(function e(){var t;return WN().w(function(e){for(;;)switch(e.n){case 0:if(!(t=this).inori.env.scenes[t.sceneKey]){e.n=1;break}return t.restoreScene(t.inori.env.scenes[t.sceneKey]),e.a(2);case 1:t.createEarthScene().scene;case 2:return e.a(2)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"disconnectedCallback",value:function(){!function(e,t,n){var r=JN(QN(e.prototype),"disconnectedCallback",n);return"function"==typeof r?function(e){return r.apply(n,e)}:r}(t,0,this)([]),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.pos=null}},{key:"addCameraFrustumHelper",value:function(){var e=new lO(this.camera);this.scene.add(e)}},{key:"renderScene",value:function(e,t,n,r,i){var s=this;i()||(requestAnimationFrame(function(){return s.renderScene(e,t,n,r,i)}),e.update(),r.render(n,s.camera))}},{key:"resetRenderer",value:function(e){for(var t=this,n=document.getElementById("earth-container");n.firstChild;)n.removeChild(n.firstChild);var r=new tI({alpha:!0});if(r.setSize(n.clientWidth,n.clientHeight),e)t.camera=e.getObjectByName("PerspectiveCam");else{e=new rI;var i=new rT(75,n.clientWidth/n.clientHeight,.1,1e3);i.name="PerspectiveCam",i.position.z=3,e.add(i),t.camera=i}var s=new gO(t.camera,r.domElement);if(n.appendChild(r.domElement),"earth"==t.sceneKey){n.addEventListener("mousemove",function(r){return t.onMouseMove(r,e,0,n.clientWidth,n.clientHeight)}),n.addEventListener("click",function(i){return t.onMouseClick(i,e,s,r,n.clientWidth,n.clientHeight)});var a=e.getObjectByName("GLBEarth");a&&a.scale.set(1,1,1)}else"nav"==t.sceneKey&&(t.camera.up.x=0,t.camera.up.y=0,t.camera.up.z=0,window.addEventListener("keydown",function(e){t.handleKeyDown(e)}),window.addEventListener("keyup",function(e){t.handleKeyUp(e)}));return t.inori.env.scenes[t.sceneKey]=e,{scene:e,renderer:r,controls:s}}},{key:"createEarthScene",value:function(){var e=this,t=e.resetRenderer(),n=t.scene,r=t.renderer,i=t.controls,s=(new PD).load("./img/earth_daymap.jpg"),a=new tD(1.75,32,32),o=new fk({map:s}),l=new Wk(a,o);return l.name="GLBEarth",n.add(l),i.enableDamping=!0,i.dampingFactor=.25,i.enableZoom=!1,e.inori.tenant.get_geo_locations().forEach(function(t){var r=e.createMarker(t.lat,t.lon);r.userData=t,n.add(r)}),e.renderScene(i,l,n,r,function(){return"earth"!=e.sceneKey&&(e.inori.mq.sys_dbg('switch to scene: "'.concat(e.sceneKey,'"')),!0)}),{scene:n}}},{key:"createNavScene",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,n=t.resetRenderer(),r=n.scene,i=n.renderer,s=n.controls;if(!e){var a=new vT(i.domElement.clientWidth,i.domElement.clientWidth),o=(new PD).load("https://threejs.org/examples/textures/uv_grid_opengl.jpg"),l=new fk({map:o}),c=new Wk(a,l);c.name="Plane",c.rotation.x=-Math.PI/2,c.position.y=0,r.add(c)}var u=new qD(4210752,3);r.add(u);var h=new WD(16777215,3);h.position.set(5,5,5).normalize(),r.add(h);var d=new VD(16777215,2,100);return d.position.set(0,2,2),r.add(d),s.maxPolarAngle=Math.PI/2,s.enablePan=!1,s.enableZoom=!1,(new YO).load("3d-models/car.glb",function(){var n=$N(WN().m(function n(a){var o,l,c;return WN().w(function(n){for(;;)switch(n.n){case 0:if(o=a.scene,r.add(o),!e){n.n=2;break}return n.n=1,t.initGoogleMap(o,function(e){s.update()},function(e,t,n){});case 1:l=n.v,c=l.m_renderer,i=c,n.n=3;break;case 2:t.renderScene(s,o,r,i,function(){return"nav"!=t.sceneKey&&(t.inori.mq.sys_dbg('switch to scene: "'.concat(t.sceneKey,'"')),!0)});case 3:o.name="GLBCar",o.scale.set(5,5,5),o.rotation.x=-Math.PI/2,o.rotation.z=-Math.PI;case 4:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),void 0,function(e){console.error("An error occurred while loading the GLB model:",e)}),{scene:r}}},{key:"positionCam",value:function(e){var t=new VA(2,2,-3).applyMatrix4(e.matrixWorld);this.camera.position.copy(t),this.camera.lookAt(e.position)}},{key:"animEnlargeEarth",value:(s=$N(WN().m(function e(t){var n,r,i;return WN().w(function(e){for(;;)switch(e.n){case 0:if(n=this,!((r=t.getObjectByName("GLBEarth")).scale.x<5)){e.n=1;break}requestAnimationFrame(function(){return n.animEnlargeEarth(t)}),e.n=5;break;case 1:if((i=new bootstrap.Collapse("#collapseControls",{toggle:!1}))&&i.show(),n.sceneKey="nav",!n.inori.env.scenes[n.sceneKey]){e.n=2;break}n.restoreScene(n.inori.env.scenes[n.sceneKey]),e.n=4;break;case 2:return e.n=3,n.createNavScene(!0);case 3:e.v.scene;case 4:return e.a(2);case 5:r.scale.x+=.01,r.scale.y+=.01,r.scale.z+=.01;case 6:return e.a(2)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"createMarker",value:function(e,t){var n=(90-e)*(Math.PI/180),r=(t+180)*(Math.PI/180),i=-1.75*Math.sin(n)*Math.cos(r),s=1.75*Math.cos(n),a=1.75*Math.sin(n)*Math.sin(r),o=new tD(.01,32,32),l=new fk({color:16711680}),c=new Wk(o,l);return c.position.set(i,s,a),c.name="GeoMarker",c}},{key:"clearMeshesByName",value:function(e,t){var n=e.getObjectByName(t);n&&(scene.remove(n),n.geometry.dispose(),n.material.dispose())}},{key:"saveSceneState",value:function(){scene.toJSON()}},{key:"restoreScene",value:(i=$N(WN().m(function e(t){var n,r,i,s,a,o,l,c;return WN().w(function(e){for(;;)switch(e.n){case 0:if(i=(r=this).resetRenderer(t),s=i.scene,a=i.renderer,o=i.controls,"earth"!=r.sceneKey){e.n=1;break}n=s.getObjectByName("GLBEarth"),r.renderScene(o,n,t,a,function(){return"earth"!=r.sceneKey&&(r.inori.mq.sys_dbg('switch to scene: "'.concat(r.sceneKey,'"')),!0)}),e.n=3;break;case 1:if("nav"!=r.sceneKey){e.n=3;break}return n=s.getObjectByName("GLBCar"),e.n=2,r.initGoogleMap(function(e){o.update()});case 2:l=e.v,c=l.m_renderer,r.renderScene(o,n,t,c,function(){return"nav"!=r.sceneKey&&(r.inori.mq.sys_dbg('switch to scene: "'.concat(r.sceneKey,'"')),!0)});case 3:return e.a(2)}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"fetchMarkerPos",value:function(e,t,n){var r=this,i=e.position.clone().project(r.camera),s=(.5*i.x+.5)*t,a=(-.5*i.y+.5)*n;return s-r.pos.cursorX<5&&s-r.pos.cursorX>-5&&a-r.pos.cursorY<5&&a-r.pos.cursorY>-5?{markerX:s,markerY:a}:{}}},{key:"onMouseMove",value:function(e,t,n,r,i){var s=this;s.pos.cursorX=e.offsetX,s.pos.cursorY=e.offsetY,s.pos.lat=0,s.pos.lon=0,e.target.style.cursor="default",s.requestUpdate(),clearTimeout(n),n=setTimeout(function(){try{t&&t.traverseVisible(function(t){if("GeoMarker"===t.name){var n=s.fetchMarkerPos(t,r,i),a=n.markerX,o=n.markerY;if(a&&o)throw s.pos.markerX=a,s.pos.markerY=o,s.pos.lat=t.userData.lat,s.pos.lon=t.userData.lon,e.target.style.cursor="pointer",s.requestUpdate(),{marker:t}}})}catch(e){return void s.inori.mq.sys_dbg("marker: ".concat(e.marker.userData," identified"))}},500)}},{key:"onMouseClick",value:(r=$N(WN().m(function e(t,n,r,i,s,a){var o,l;return WN().w(function(e){for(;;)switch(e.n){case 0:o=this,"pointer"==t.target.style.cursor&&(l=!1,n&&n.traverseVisible(function(e){if("GeoMarker"===e.name){var t=o.fetchMarkerPos(e,s,a),r=t.markerX,i=t.markerY;if(r&&i&&!l){o.location=e.userData,o.requestUpdate();var c=new bootstrap.Collapse("#collapseLoc",{toggle:!1});c&&c.show(),o.animEnlargeEarth(n),l=!0}}}));case 1:return e.a(2)}},e,this)})),function(e,t,n,i,s,a){return r.apply(this,arguments)})},{key:"onForward",value:function(e){var t=this;t.sceneKey="nav";var n=t.inori.env.scenes[t.sceneKey].getObjectByName("GLBCar");if("backward"!=t.actionKey){t.actionKey="forward";var r=setInterval(function(){if(!t.isMapMoving)return"forward"==t.actionKey?(n.position.x+=Math.sin(n.rotation.y)*t.carSpeed,void(n.position.y+=Math.cos(n.rotation.y)*t.carSpeed)):void clearInterval(r)},10)}else t.stopAction(e)}},{key:"onBackward",value:function(e){var t=this;t.sceneKey="nav";var n=t.inori.env.scenes[t.sceneKey].getObjectByName("GLBCar");if("forward"!=t.actionKey){t.actionKey="backward";var r=setInterval(function(){if(!t.isMapMoving)return"backward"==t.actionKey?(n.position.x-=Math.sin(n.rotation.y)*t.carSpeed,void(n.position.y-=Math.cos(n.rotation.y)*t.carSpeed)):void clearInterval(r)},10)}else t.stopAction(e)}},{key:"onLeft",value:function(e){var t=this;t.sceneKey="nav";var n=t.inori.env.scenes[t.sceneKey].getObjectByName("GLBCar");if("right"!=t.directionKey){t.directionKey="left";var r=setInterval(function(){t.isMapMoving||("left"!=t.directionKey?clearInterval(r):n.rotation.y-=Math.PI/180)},10)}else t.stopTurn(e)}},{key:"onRight",value:function(e){var t=this;t.sceneKey="nav";var n=t.inori.env.scenes[t.sceneKey].getObjectByName("GLBCar");if("left"!=t.directionKey){t.directionKey="right";var r=setInterval(function(){t.isMapMoving||("right"!=t.directionKey?clearInterval(r):n.rotation.y+=Math.PI/180)},10)}else t.stopTurn(e)}},{key:"stopAction",value:function(e){this.actionKey=null,this.stopTurn(e)}},{key:"stopTurn",value:function(e){this.directionKey=null}},{key:"onWindowResize",value:function(){this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}},{key:"initGoogleMap",value:(n=$N(WN().m(function e(t,n){var r,i,s,a,o,l,c;return WN().w(function(e){for(;;)switch(e.n){case 0:if(i={apiKey:(r=this).inori.tenant.api_keys().goog},(s=r.inori.env.scenes[r.sceneKey]).getObjectByName("GLBCar"),a={tilt:75,heading:90,zoom:21,minZoom:18,center:{lat:33.87,lng:-118.07},mapId:"397abb902ee6ba95"},o=function(){var e=$N(WN().m(function e(){var t,n;return WN().w(function(e){for(;;)switch(e.n){case 0:return t=document.getElementById("earth-container"),n=new FN(i),e.n=1,n.load();case 1:return a.streetViewControlOptions={position:google.maps.ControlPosition.RIGHT_TOP},a.zoomControlOptions={position:google.maps.ControlPosition.RIGHT_TOP},a.mapTypeControlOptions={position:google.maps.ControlPosition.TOP_RIGHT},e.a(2,new google.maps.Map(t,a))}},e)}));return function(){return e.apply(this,arguments)}}(),l=function(e){var t=new google.maps.WebGLOverlayView;return new Promise(function(n){var i,o=!1;e.addListener("idle",function(){r.isMapMoving=!1}),t.onAdd=function(){},t.onContextRestored=function(e){var t=e.gl;(i=new tI(VN({canvas:t.canvas,context:t},t.getContextAttributes()))).autoClear=!1,o=!0,n(i)},t.onDraw=function(e){e.gl;var n=e.transformer,o={lat:a.center.lat,lng:a.center.lng,altitude:0},l=n.fromLatLngAltitude(o);r.camera.projectionMatrix=(new bM).fromArray(l),i.render(s,r.camera),i.resetState(),c(),t.requestRedraw()},t.setMap(e);var l=function(t){var n=Math.pow(2,e.getZoom()),r=e.getProjection().fromLatLngToPoint(t);return{x:r.x*n,y:r.y*n}},c=function(){if(!r.isMapMoving){r.isMapMoving=!0;var t=i.domElement.clientWidth,n=i.domElement.clientHeight,a=s.getObjectByName("GLBCar"),o=(new VA).copy(a.position);o.project(r.camera),o.x=(.5*o.x+.5)*t,o.y=(-.5*o.y+.5)*n;var c=200,u=o.x,h=t-o.x,d=o.y,f=n-o.y;if(u<0||h<0||d<0||f<0)r.isMapMoving=!1;else{var p=Math.min(u,h)>c,m=Math.min(d,f)>c;p&&m?r.isMapMoving=!1:function(t,n,r,i,s){var a=e.getCenter(),o=l(a,e),c=e.getDiv(),u=c.offsetWidth,h=c.offsetHeight;n&&(o.x-=Math.min(u/2,t.x)),r&&(o.x+=Math.min(u/2,t.x)),i&&(o.y-=Math.min(h/2,Math.max(0,t.y))),s&&(o.y+=Math.min(h/2,Math.max(0,t.y)));var d,f,p,m=(d=o,f=Math.pow(2,e.getZoom()),p={x:d.x/f,y:d.y/f},e.getProjection().fromPointToLatLng(p));console.log("Mesh Geolocation:",m.lat(),m.lng()),e.getZoom()>18&&e.setZoom(e.getZoom()-1),e.panTo(m)}(o,u<c,h<c,d<c,f<c)}}};r.inori.util.delayFunction(5e3).then(function(){e.getCenter(),o||n(!1)})})},r.map){e.n=2;break}return e.n=1,o();case 1:r.map=e.v;case 2:return e.n=3,l(r.map);case 3:return c=e.v,e.a(2,{m_renderer:c})}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"handleKeyDown",value:function(e){var t=this;if(event.ctrlKey)switch(event.key.toLowerCase()){case"w":t.onForward(e);break;case"s":t.onBackward(e);break;case"a":t.onLeft(e);break;case"x":t.stopAction(e);break;case"d":t.onRight(e)}}},{key:"handleKeyUp",value:function(e){if(event.ctrlKey)switch(event.key.toLowerCase()){case"w":case"s":case"a":case"d":this.stopTurn(e);break;case"x":this.stopAction(e)}}},{key:"render",value:function(){var e=this;if(e.pos){var t=this.inori.env.content.getL2();return W(HN||(HN=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <p class="card-text">','</p>\n  <div class="position-relative">\n    <div class="accordion z-3 position-absolute top-0 start-0 opacity-75 m-2" id="accordion3D" style="width: 18rem;">\n     <div class="accordion-item">\n        <h2 class="accordion-header">\n          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseControls" aria-expanded="false" aria-controls="collapseControls">\n            Controls\n          </button>\n        </h2>\n        <div id="collapseControls" class="accordion-collapse collapse" data-bs-parent="#accordion3D">\n          <div class="accordion-body row justify-content-center mx-auto">\n            <div class="btn-group" role="group" aria-label="Scene Detail">\n              <button type="button" class="btn btn-secondary" @click="','">Save</button>\n              <button type="button" class="btn btn-secondary ','" @click="','">Earth</button>\n              <button type="button" class="btn btn-secondary ','"" @click="','">Street</button>\n            </div>\n            <div class="text-success mt-3">\n              <hr>\n            </div>\n    <div class="row mt-3">\n        <button type="button" class="btn btn-primary mx-auto w-auto" @click="','"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-circle-fill" viewBox="0 0 16 16">\n  <path d="M16 8A8 8 0 1 0 0 8a8 8 0 0 0 16 0m-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z"/>\n</svg></button>\n</div>\n<div class="row mt-3">\n<button type="button" class="btn btn-primary mx-auto w-auto" \n        @mousedown="','"\n        @mouseup="','"\n        @mouseleave="','"\n        @touchstart="','"\n        @touchend="','" ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16">\n  <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0m3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z"/>\n</svg></button>\n<button type="button" class="btn btn-primary mx-auto w-auto" @click="','"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop-circle-fill" viewBox="0 0 16 16">\n  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.5 5A1.5 1.5 0 0 0 5 6.5v3A1.5 1.5 0 0 0 6.5 11h3A1.5 1.5 0 0 0 11 9.5v-3A1.5 1.5 0 0 0 9.5 5z"/>\n</svg></button>\n<button type="button" class="btn btn-primary mx-auto w-auto" \n        @mousedown="','"\n        @mouseup="','"\n        @mouseleave="','"\n        @touchstart="','"\n        @touchend="','"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right-circle-fill" viewBox="0 0 16 16">\n  <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0M4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5z"/>\n</svg></button>\n</div>\n<div class="row mt-3">\n<button type="button" class="btn btn-primary mx-auto w-auto" @click="','"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down-circle-fill" viewBox="0 0 16 16">\n  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293z"/>\n</svg></button>\n</div>\n          </div>\n        </div>\n      </div>\n      <div class="accordion-item">\n        <h2 class="accordion-header">\n          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseViews" aria-expanded="false" aria-controls="collapseViews">\n            Views\n          </button>\n        </h2>\n        <div id="collapseViews" class="accordion-collapse collapse" data-bs-parent="#accordion3D">\n          <div class="accordion-body row justify-content-center mx-auto">\n            <div class="btn-group" role="group" aria-label="Scene Detail">\n              <button type="button" class="btn btn-secondary" @click="','">Static</button>\n              <button type="button" class="btn btn-secondary" @click="','">Follow</button>\n            </div>\n          </div>\n        </div>\n        </div>\n      <div class="accordion-item">\n        <h2 class="accordion-header">\n          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePos" aria-expanded="true" aria-controls="collapsePos">\n            Positions\n          </button>\n        </h2>\n        <div id="collapsePos" class="accordion-collapse collapse show" data-bs-parent="#accordion3D">\n          <div class="accordion-body">\n            geo: [',", ","]\n            marker: [",", ","]\n            cursor: [",", ",']\n          </div>\n        </div>\n      </div>\n      <div class="accordion-item">\n        <h2 class="accordion-header">\n          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLoc" aria-expanded="false" aria-controls="collapseLoc">\n            Location\n          </button>\n        </h2>\n        <div id="collapseLoc" class="accordion-collapse collapse" data-bs-parent="#accordion3D">\n          <div class="accordion-body">\n            <streaming-json-modal .data="','"></streaming-json-modal>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="object-fit-fill border rounded" style="height: 600px;" id="earth-container"></div>\n  </div>\n</main>'])),this.inori.env.content.get(),t,function(e){},"earth"==e.sceneKey?"active":"",function(){var t=$N(WN().m(function t(n){return WN().w(function(t){for(;;)switch(t.n){case 0:if(e.sceneKey="earth",!e.inori.env.scenes[e.sceneKey]){t.n=1;break}return e.restoreScene(e.inori.env.scenes[e.sceneKey]),t.a(2);case 1:e.createEarthScene().scene;case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),"nav"==e.sceneKey?"active":"",function(){var t=$N(WN().m(function t(n){return WN().w(function(t){for(;;)switch(t.n){case 0:if(e.sceneKey="nav",!e.inori.env.scenes[e.sceneKey]){t.n=1;break}return e.restoreScene(e.inori.env.scenes[e.sceneKey]),t.a(2);case 1:return t.n=2,e.createNavScene(!0);case 2:t.v.scene;case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),function(t){e.onForward(t)},e.onLeft,e.stopTurn,e.stopTurn,e.onLeft,e.stopTurn,function(t){e.stopAction(t)},e.onRight,e.stopTurn,e.stopTurn,e.onRight,e.stopTurn,function(t){e.onBackward(t)},function(e){},function(e){},e.pos.lat.toFixed(2),e.pos.lon.toFixed(2),e.pos.markerX.toFixed(2),e.pos.markerY.toFixed(2),e.pos.cursorX.toFixed(2),e.pos.cursorY.toFixed(2),e.location)}}}],[{key:"properties",get:function(){return{inori:{type:Object},pos:{type:Object},location:{type:Object}}}}]);var n,r,i,s,a}(ce);customElements.define("streaming-geography",tU);var nU,rU,iU,sU,aU,oU,lU,cU,uU,hU={},dU=[],fU=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function pU(e,t){for(var n in t)e[n]=t[n];return e}function mU(e){var t=e.parentNode;t&&t.removeChild(e)}function gU(e,t,n){var r,i,s,a={};for(s in t)"key"==s?r=t[s]:"ref"==s?i=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?nU.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===a[s]&&(a[s]=e.defaultProps[s]);return vU(e,a,r,i,null)}function vU(e,t,n,r,i){var s={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==i?++iU:i};return null==i&&null!=rU.vnode&&rU.vnode(s),s}function _U(e){return e.children}function bU(e,t,n){"-"===t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||fU.test(t)?n:n+"px"}function yU(e,t,n,r,i){var s;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||bU(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||bU(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=n,n?r||e.addEventListener(t,s?SU:wU,s):e.removeEventListener(t,s?SU:wU,s);else if("dangerouslySetInnerHTML"!==t){if(i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==t&&"height"!==t&&"href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&-1==t.indexOf("-")?e.removeAttribute(t):e.setAttribute(t,n))}}function wU(e){aU=!0;try{return this.l[e.type+!1](rU.event?rU.event(e):e)}finally{aU=!1}}function SU(e){aU=!0;try{return this.l[e.type+!0](rU.event?rU.event(e):e)}finally{aU=!1}}function xU(e,t){this.props=e,this.context=t}function EU(e,t){if(null==t)return e.__?EU(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?EU(e):null}function CU(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return CU(e)}}function AU(e){aU?setTimeout(e):cU(e)}function MU(e){(!e.__d&&(e.__d=!0)&&oU.push(e)&&!kU.__r++||lU!==rU.debounceRendering)&&((lU=rU.debounceRendering)||AU)(kU)}function kU(){var e,t,n,r,i,s,a,o;for(oU.sort(function(e,t){return e.__v.__b-t.__v.__b});e=oU.shift();)e.__d&&(t=oU.length,r=void 0,i=void 0,a=(s=(n=e).__v).__e,(o=n.__P)&&(r=[],(i=pU({},s)).__v=s.__v+1,OU(o,s,i,n.__n,void 0!==o.ownerSVGElement,null!=s.__h?[a]:null,r,null==a?EU(s):a,s.__h),LU(r,s),s.__e!=a&&CU(s)),oU.length>t&&oU.sort(function(e,t){return e.__v.__b-t.__v.__b}));kU.__r=0}function TU(e,t,n,r,i,s,a,o,l,c){var u,h,d,f,p,m,g,v=r&&r.__k||dU,_=v.length;for(n.__k=[],u=0;u<t.length;u++)if(null!=(f=n.__k[u]=null==(f=t[u])||"boolean"==typeof f?null:"string"==typeof f||"number"==typeof f||"bigint"==typeof f?vU(null,f,null,null,f):Array.isArray(f)?vU(_U,{children:f},null,null,null):f.__b>0?vU(f.type,f.props,f.key,f.ref?f.ref:null,f.__v):f)){if(f.__=n,f.__b=n.__b+1,null===(d=v[u])||d&&f.key==d.key&&f.type===d.type)v[u]=void 0;else for(h=0;h<_;h++){if((d=v[h])&&f.key==d.key&&f.type===d.type){v[h]=void 0;break}d=null}OU(e,f,d=d||hU,i,s,a,o,l,c),p=f.__e,(h=f.ref)&&d.ref!=h&&(g||(g=[]),d.ref&&g.push(d.ref,null,f),g.push(h,f.__c||p,f)),null!=p?(null==m&&(m=p),"function"==typeof f.type&&f.__k===d.__k?f.__d=l=RU(f,l,e):l=IU(e,f,d,v,p,l),"function"==typeof n.type&&(n.__d=l)):l&&d.__e==l&&l.parentNode!=e&&(l=EU(d))}for(n.__e=m,u=_;u--;)null!=v[u]&&("function"==typeof n.type&&null!=v[u].__e&&v[u].__e==n.__d&&(n.__d=DU(r).nextSibling),NU(v[u],v[u]));if(g)for(u=0;u<g.length;u++)BU(g[u],g[++u],g[++u])}function RU(e,t,n){for(var r,i=e.__k,s=0;i&&s<i.length;s++)(r=i[s])&&(r.__=e,t="function"==typeof r.type?RU(r,t,n):IU(n,r,r,i,r.__e,t));return t}function PU(e,t){return t=t||[],null==e||"boolean"==typeof e||(Array.isArray(e)?e.some(function(e){PU(e,t)}):t.push(e)),t}function IU(e,t,n,r,i,s){var a,o,l;if(void 0!==t.__d)a=t.__d,t.__d=void 0;else if(null==n||i!=s||null==i.parentNode)e:if(null==s||s.parentNode!==e)e.appendChild(i),a=null;else{for(o=s,l=0;(o=o.nextSibling)&&l<r.length;l+=1)if(o==i)break e;e.insertBefore(i,s),a=s}return void 0!==a?a:i.nextSibling}function DU(e){var t,n,r;if(null==e.type||"string"==typeof e.type)return e.__e;if(e.__k)for(t=e.__k.length-1;t>=0;t--)if((n=e.__k[t])&&(r=DU(n)))return r;return null}function OU(e,t,n,r,i,s,a,o,l){var c,u,h,d,f,p,m,g,v,_,b,y,w,S,x,E=t.type;if(void 0!==t.constructor)return null;null!=n.__h&&(l=n.__h,o=t.__e=n.__e,t.__h=null,s=[o]),(c=rU.__b)&&c(t);try{e:if("function"==typeof E){if(g=t.props,v=(c=E.contextType)&&r[c.__c],_=c?v?v.props.value:c.__:r,n.__c?m=(u=t.__c=n.__c).__=u.__E:("prototype"in E&&E.prototype.render?t.__c=u=new E(g,_):(t.__c=u=new xU(g,_),u.constructor=E,u.render=UU),v&&v.sub(u),u.props=g,u.state||(u.state={}),u.context=_,u.__n=r,h=u.__d=!0,u.__h=[],u._sb=[]),null==u.__s&&(u.__s=u.state),null!=E.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=pU({},u.__s)),pU(u.__s,E.getDerivedStateFromProps(g,u.__s))),d=u.props,f=u.state,u.__v=t,h)null==E.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(null==E.getDerivedStateFromProps&&g!==d&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(g,_),!u.__e&&null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(g,u.__s,_)||t.__v===n.__v){for(t.__v!==n.__v&&(u.props=g,u.state=u.__s,u.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(e){e&&(e.__=t)}),b=0;b<u._sb.length;b++)u.__h.push(u._sb[b]);u._sb=[],u.__h.length&&a.push(u);break e}null!=u.componentWillUpdate&&u.componentWillUpdate(g,u.__s,_),null!=u.componentDidUpdate&&u.__h.push(function(){u.componentDidUpdate(d,f,p)})}if(u.context=_,u.props=g,u.__P=e,y=rU.__r,w=0,"prototype"in E&&E.prototype.render){for(u.state=u.__s,u.__d=!1,y&&y(t),c=u.render(u.props,u.state,u.context),S=0;S<u._sb.length;S++)u.__h.push(u._sb[S]);u._sb=[]}else do{u.__d=!1,y&&y(t),c=u.render(u.props,u.state,u.context),u.state=u.__s}while(u.__d&&++w<25);u.state=u.__s,null!=u.getChildContext&&(r=pU(pU({},r),u.getChildContext())),h||null==u.getSnapshotBeforeUpdate||(p=u.getSnapshotBeforeUpdate(d,f)),x=null!=c&&c.type===_U&&null==c.key?c.props.children:c,TU(e,Array.isArray(x)?x:[x],t,n,r,i,s,a,o,l),u.base=t.__e,t.__h=null,u.__h.length&&a.push(u),m&&(u.__E=u.__=null),u.__e=!1}else null==s&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=function(e,t,n,r,i,s,a,o){var l,c,u,h=n.props,d=t.props,f=t.type,p=0;if("svg"===f&&(i=!0),null!=s)for(;p<s.length;p++)if((l=s[p])&&"setAttribute"in l==!!f&&(f?l.localName===f:3===l.nodeType)){e=l,s[p]=null;break}if(null==e){if(null===f)return document.createTextNode(d);e=i?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,d.is&&d),s=null,o=!1}if(null===f)h===d||o&&e.data===d||(e.data=d);else{if(s=s&&nU.call(e.childNodes),c=(h=n.props||hU).dangerouslySetInnerHTML,u=d.dangerouslySetInnerHTML,!o){if(null!=s)for(h={},p=0;p<e.attributes.length;p++)h[e.attributes[p].name]=e.attributes[p].value;(u||c)&&(u&&(c&&u.__html==c.__html||u.__html===e.innerHTML)||(e.innerHTML=u&&u.__html||""))}if(function(e,t,n,r,i){var s;for(s in n)"children"===s||"key"===s||s in t||yU(e,s,null,n[s],r);for(s in t)i&&"function"!=typeof t[s]||"children"===s||"key"===s||"value"===s||"checked"===s||n[s]===t[s]||yU(e,s,t[s],n[s],r)}(e,d,h,i,o),u)t.__k=[];else if(p=t.props.children,TU(e,Array.isArray(p)?p:[p],t,n,r,i&&"foreignObject"!==f,s,a,s?s[0]:n.__k&&EU(n,0),o),null!=s)for(p=s.length;p--;)null!=s[p]&&mU(s[p]);o||("value"in d&&void 0!==(p=d.value)&&(p!==e.value||"progress"===f&&!p||"option"===f&&p!==h.value)&&yU(e,"value",p,h.value,!1),"checked"in d&&void 0!==(p=d.checked)&&p!==e.checked&&yU(e,"checked",p,h.checked,!1))}return e}(n.__e,t,n,r,i,s,a,l);(c=rU.diffed)&&c(t)}catch(e){t.__v=null,(l||null!=s)&&(t.__e=o,t.__h=!!l,s[s.indexOf(o)]=null),rU.__e(e,t,n)}}function LU(e,t){rU.__c&&rU.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){rU.__e(e,t.__v)}})}function BU(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){rU.__e(e,n)}}function NU(e,t,n){var r,i;if(rU.unmount&&rU.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||BU(r,null,t)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){rU.__e(e,t)}r.base=r.__P=null,e.__c=void 0}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&NU(r[i],t,n||"function"!=typeof e.type);n||null==e.__e||mU(e.__e),e.__=e.__e=e.__d=void 0}function UU(e,t,n){return this.constructor(e,n)}function HU(e,t,n){var r,i,s;rU.__&&rU.__(e,t),i=(r="function"==typeof n)?null:n&&n.__k||t.__k,s=[],OU(t,e=(!r&&n||t).__k=gU(_U,null,[e]),i||hU,hU,void 0!==t.ownerSVGElement,!r&&n?[n]:i?null:t.firstChild?nU.call(t.childNodes):null,s,!r&&n?n:i?i.__e:t.firstChild,r),LU(s,e)}nU=dU.slice,rU={__e:function(e,t,n,r){for(var i,s,a;t=t.__;)if((i=t.__c)&&!i.__)try{if((s=i.constructor)&&null!=s.getDerivedStateFromError&&(i.setState(s.getDerivedStateFromError(e)),a=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(e,r||{}),a=i.__d),a)return i.__E=i}catch(t){e=t}throw e}},iU=0,sU=function(e){return null!=e&&void 0===e.constructor},aU=!1,xU.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=pU({},this.state),"function"==typeof e&&(e=e(pU({},n),this.props)),e&&pU(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),MU(this))},xU.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),MU(this))},xU.prototype.render=_U,oU=[],cU="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,kU.__r=0,uU=0;var FU,jU,zU,VU=[],GU=[],WU=rU.__b,qU=rU.__r,KU=rU.diffed,$U=rU.__c,XU=rU.unmount;function YU(){for(var e;e=VU.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(QU),e.__H.__h.forEach(eH),e.__H.__h=[]}catch(t){e.__H.__h=[],rU.__e(t,e.__v)}}rU.__b=function(e){FU=null,WU&&WU(e)},rU.__r=function(e){qU&&qU(e);var t=(FU=e.__c).__H;t&&(jU===FU?(t.__h=[],FU.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=GU,e.__N=e.i=void 0})):(t.__h.forEach(QU),t.__h.forEach(eH),t.__h=[])),jU=FU},rU.diffed=function(e){KU&&KU(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==VU.push(t)&&zU===rU.requestAnimationFrame||((zU=rU.requestAnimationFrame)||JU)(YU)),t.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==GU&&(e.__=e.__V),e.i=void 0,e.__V=GU})),jU=FU=null},rU.__c=function(e,t){t.some(function(e){try{e.__h.forEach(QU),e.__h=e.__h.filter(function(e){return!e.__||eH(e)})}catch(n){t.some(function(e){e.__h&&(e.__h=[])}),t=[],rU.__e(n,e.__v)}}),$U&&$U(e,t)},rU.unmount=function(e){XU&&XU(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(e){try{QU(e)}catch(e){t=e}}),n.__H=void 0,t&&rU.__e(t,n.__v))};var ZU="function"==typeof requestAnimationFrame;function JU(e){var t,n=function(){clearTimeout(r),ZU&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);ZU&&(t=requestAnimationFrame(n))}function QU(e){var t=FU,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),FU=t}function eH(e){var t=FU;e.__c=e.__(),FU=t}function tH(e,t){for(var n in e)if("__source"!==n&&!(n in t))return!0;for(var r in t)if("__source"!==r&&e[r]!==t[r])return!0;return!1}function nH(e){this.props=e}(nH.prototype=new xU).isPureReactComponent=!0,nH.prototype.shouldComponentUpdate=function(e,t){return tH(this.props,e)||tH(this.state,t)};var rH=rU.__b;rU.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),rH&&rH(e)},"undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.forward_ref");var iH=rU.__e;rU.__e=function(e,t,n,r){if(e.then)for(var i,s=t;s=s.__;)if((i=s.__c)&&i.__c)return null==t.__e&&(t.__e=n.__e,t.__k=n.__k),i.__c(e,t);iH(e,t,n,r)};var sH=rU.unmount;function aH(e,t,n){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(e){"function"==typeof e.__c&&e.__c()}),e.__c.__H=null),null!=(e=function(e,t){for(var n in t)e[n]=t[n];return e}({},e)).__c&&(e.__c.__P===n&&(e.__c.__P=t),e.__c=null),e.__k=e.__k&&e.__k.map(function(e){return aH(e,t,n)})),e}function oH(e,t,n){return e&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(e){return oH(e,t,n)}),e.__c&&e.__c.__P===t&&(e.__e&&n.insertBefore(e.__e,e.__d),e.__c.__e=!0,e.__c.__P=n)),e}function lH(){this.__u=0,this.t=null,this.__b=null}function cH(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function uH(){this.u=null,this.o=null}rU.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&!0===e.__h&&(e.type=null),sH&&sH(e)},(lH.prototype=new xU).__c=function(e,t){var n=t.__c,r=this;null==r.t&&(r.t=[]),r.t.push(n);var i=cH(r.__v),s=!1,a=function(){s||(s=!0,n.__R=null,i?i(o):o())};n.__R=a;var o=function(){if(! --r.__u){if(r.state.__a){var e=r.state.__a;r.__v.__k[0]=oH(e,e.__c.__P,e.__c.__O)}var t;for(r.setState({__a:r.__b=null});t=r.t.pop();)t.forceUpdate()}},l=!0===t.__h;r.__u++||l||r.setState({__a:r.__b=r.__v.__k[0]}),e.then(a,a)},lH.prototype.componentWillUnmount=function(){this.t=[]},lH.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=aH(this.__b,n,r.__O=r.__P)}this.__b=null}var i=t.__a&&gU(_U,null,e.fallback);return i&&(i.__h=null),[gU(_U,null,t.__a?null:e.children),i]};var hH=function(e,t,n){if(++n[1]===n[0]&&e.o.delete(t),e.props.revealOrder&&("t"!==e.props.revealOrder[0]||!e.o.size))for(n=e.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;e.u=n=n[2]}};function dH(e){return this.getChildContext=function(){return e.context},e.children}function fH(e){var t=this,n=e.i;t.componentWillUnmount=function(){HU(null,t.l),t.l=null,t.i=null},t.i&&t.i!==n&&t.componentWillUnmount(),e.__v?(t.l||(t.i=n,t.l={nodeType:1,parentNode:n,childNodes:[],appendChild:function(e){this.childNodes.push(e),t.i.appendChild(e)},insertBefore:function(e,n){this.childNodes.push(e),t.i.appendChild(e)},removeChild:function(e){this.childNodes.splice(this.childNodes.indexOf(e)>>>1,1),t.i.removeChild(e)}}),HU(gU(dH,{context:t.context},e.__v),t.l)):t.l&&t.componentWillUnmount()}(uH.prototype=new xU).__a=function(e){var t=this,n=cH(t.__v),r=t.o.get(e);return r[0]++,function(i){var s=function(){t.props.revealOrder?(r.push(i),hH(t,e,r)):i()};n?n(s):s()}},uH.prototype.render=function(e){this.u=null,this.o=new Map;var t=PU(e.children);e.revealOrder&&"b"===e.revealOrder[0]&&t.reverse();for(var n=t.length;n--;)this.o.set(t[n],this.u=[1,0,this.u]);return e.children},uH.prototype.componentDidUpdate=uH.prototype.componentDidMount=function(){var e=this;this.o.forEach(function(t,n){hH(e,n,t)})};var pH="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,mH=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,gH="undefined"!=typeof document,vH=function(e){return("undefined"!=typeof Symbol&&"symbol"==typeof Symbol()?/fil|che|rad/i:/fil|che|ra/i).test(e)};xU.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(xU.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})});var _H=rU.event;function bH(){}function yH(){return this.cancelBubble}function wH(){return this.defaultPrevented}rU.event=function(e){return _H&&(e=_H(e)),e.persist=bH,e.isPropagationStopped=yH,e.isDefaultPrevented=wH,e.nativeEvent=e};var SH={configurable:!0,get:function(){return this.class}},xH=rU.vnode;rU.vnode=function(e){var t=e.type,n=e.props,r=n;if("string"==typeof t){var i=-1===t.indexOf("-");for(var s in r={},n){var a=n[s];gH&&"children"===s&&"noscript"===t||"value"===s&&"defaultValue"in n&&null==a||("defaultValue"===s&&"value"in n&&null==n.value?s="value":"download"===s&&!0===a?a="":/ondoubleclick/i.test(s)?s="ondblclick":/^onchange(textarea|input)/i.test(s+t)&&!vH(n.type)?s="oninput":/^onfocus$/i.test(s)?s="onfocusin":/^onblur$/i.test(s)?s="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(s)?s=s.toLowerCase():i&&mH.test(s)?s=s.replace(/[A-Z0-9]/g,"-$&").toLowerCase():null===a&&(a=void 0),/^oninput$/i.test(s)&&(s=s.toLowerCase(),r[s]&&(s="oninputCapture")),r[s]=a)}"select"==t&&r.multiple&&Array.isArray(r.value)&&(r.value=PU(n.children).forEach(function(e){e.props.selected=-1!=r.value.indexOf(e.props.value)})),"select"==t&&null!=r.defaultValue&&(r.value=PU(n.children).forEach(function(e){e.props.selected=r.multiple?-1!=r.defaultValue.indexOf(e.props.value):r.defaultValue==e.props.value})),e.props=r,n.class!=n.className&&(SH.enumerable="className"in n,null!=n.className&&(r.class=n.className),Object.defineProperty(r,"className",SH))}e.$$typeof=pH,xH&&xH(e)};var EH=rU.__r;rU.__r=function(e){EH&&EH(e),e.__c};const CH=[],AH=new Map;function MH(e){CH.push(e),AH.forEach(t=>{TH(t,e)})}function kH(e){let t=AH.get(e);if(!t||!t.isConnected){if(t=e.querySelector("style[data-fullcalendar]"),!t){t=document.createElement("style"),t.setAttribute("data-fullcalendar","");const n=(void 0===RH&&(RH=function(){const e=document.querySelector('meta[name="csp-nonce"]');if(e&&e.hasAttribute("content"))return e.getAttribute("content");const t=document.querySelector("script[nonce]");return t&&t.nonce||""}()),RH);n&&(t.nonce=n);const r=e===document?document.head:e,i=e===document?r.querySelector("script,link[rel=stylesheet],link[as=style],style"):r.firstChild;r.insertBefore(t,i)}AH.set(e,t),function(e){for(const t of CH)TH(e,t)}(t)}}function TH(e,t){const{sheet:n}=e,r=n.cssRules.length;t.split("}").forEach((e,t)=>{(e=e.trim())&&n.insertRule(e+"}",r+t)})}let RH;"undefined"!=typeof document&&kH(document),MH(':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}');class PH{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),null==e?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:n}=this;e in n&&(t?delete n[e]:(n[e]-=1,n[e]<=0&&delete n[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}}function IH(e){e.parentNode&&e.parentNode.removeChild(e)}function DH(e,t){if(e.closest)return e.closest(t);if(!document.documentElement.contains(e))return null;do{if(OH(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}function OH(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector).call(e,t)}const LH=/(top|left|right|bottom|width|height)$/i;function BH(e,t,n){null==n?e.style[t]="":"number"==typeof n&&LH.test(t)?e.style[t]=`${n}px`:e.style[t]=n}let NH=0;function UH(){return NH+=1,"fc-dom-"+NH}function HH(e,t,n,r){let i=function(e,t){return n=>{let r=DH(n.target,e);r&&t.call(r,n,r)}}(n,r);return e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}function FH(e){return Object.assign({onClick:e},jH(e))}function jH(e){return{tabIndex:0,onKeyDown(t){"Enter"!==t.key&&" "!==t.key||(e(t),t.preventDefault())}}}let zH=0;function VH(){return zH+=1,String(zH)}function GH(e,t,n){return n.func?n.func(e,t):function(e,t){return e||t?null==t?-1:null==e?1:"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):e-t:0}(e[n.field],t[n.field])*(n.order||1)}function WH(e,t){let n=String(e);return"000".substr(0,t-n.length)+n}function qH(e,t,n){return"function"==typeof e?e(...t):"string"==typeof e?t.reduce((e,t,n)=>e.replace("$"+n,t||""),e):n}function KH(e){return e%1==0}function $H(e){let t=e.querySelector(".fc-scrollgrid-shrink-frame"),n=e.querySelector(".fc-scrollgrid-shrink-cushion");if(!t)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!n)throw new Error("needs fc-scrollgrid-shrink-cushion className");return e.getBoundingClientRect().width-t.getBoundingClientRect().width+n.getBoundingClientRect().width}const XH=["years","months","days","milliseconds"],YH=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function ZH(e,t){return"string"==typeof e?function(e){let t=YH.exec(e);if(t){let e=t[1]?-1:1;return{years:0,months:0,days:e*(t[2]?parseInt(t[2],10):0),milliseconds:e*(60*(t[3]?parseInt(t[3],10):0)*60*1e3+60*(t[4]?parseInt(t[4],10):0)*1e3+1e3*(t[5]?parseInt(t[5],10):0)+(t[6]?parseInt(t[6],10):0))}}return null}(e):"object"==typeof e&&e?JH(e):"number"==typeof e?JH({[t||"milliseconds"]:e}):null}function JH(e){let t={years:e.years||e.year||0,months:e.months||e.month||0,days:e.days||e.day||0,milliseconds:60*(e.hours||e.hour||0)*60*1e3+60*(e.minutes||e.minute||0)*1e3+1e3*(e.seconds||e.second||0)+(e.milliseconds||e.millisecond||e.ms||0)},n=e.weeks||e.week;return n&&(t.days+=7*n,t.specifiedWeeks=!0),t}function QH(e,t){return{years:e.years+t.years,months:e.months+t.months,days:e.days+t.days,milliseconds:e.milliseconds+t.milliseconds}}function eF(e){return tF(e)/864e5}function tF(e){return 31536e6*e.years+2592e6*e.months+864e5*e.days+e.milliseconds}function nF(e,t){let n=null;for(let r=0;r<XH.length;r+=1){let i=XH[r];if(t[i]){let r=e[i]/t[i];if(!KH(r)||null!==n&&n!==r)return null;n=r}else if(e[i])return null}return n}function rF(e){let t=e.milliseconds;if(t){if(t%1e3!=0)return{unit:"millisecond",value:t};if(t%6e4!=0)return{unit:"second",value:t/1e3};if(t%36e5!=0)return{unit:"minute",value:t/6e4};if(t)return{unit:"hour",value:t/36e5}}return e.days?e.specifiedWeeks&&e.days%7==0?{unit:"week",value:e.days/7}:{unit:"day",value:e.days}:e.months?{unit:"month",value:e.months}:e.years?{unit:"year",value:e.years}:{unit:"millisecond",value:0}}function iF(e,t,n){if(e===t)return!0;let r,i=e.length;if(i!==t.length)return!1;for(r=0;r<i;r+=1)if(!(n?n(e[r],t[r]):e[r]===t[r]))return!1;return!0}const sF=["sun","mon","tue","wed","thu","fri","sat"];function aF(e,t){let n=gF(e);return n[2]+=7*t,vF(n)}function oF(e,t){let n=gF(e);return n[2]+=t,vF(n)}function lF(e,t){let n=gF(e);return n[6]+=t,vF(n)}function cF(e,t){return(t.valueOf()-e.valueOf())/864e5}function uF(e,t){return bF(e)===bF(t)?Math.round(cF(e,t)):null}function hF(e){return vF([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()])}function dF(e,t,n,r){let i=vF([t,0,1+fF(t,n,r)]),s=hF(e),a=Math.round(cF(i,s));return Math.floor(a/7)+1}function fF(e,t,n){let r=7+t-n;return-(7+vF([e,0,r]).getUTCDay()-t)%7+r-1}function pF(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}function mF(e){return new Date(e[0],e[1]||0,null==e[2]?1:e[2],e[3]||0,e[4]||0,e[5]||0)}function gF(e){return[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()]}function vF(e){return 1===e.length&&(e=e.concat([0])),new Date(Date.UTC(...e))}function _F(e){return!isNaN(e.valueOf())}function bF(e){return 1e3*e.getUTCHours()*60*60+1e3*e.getUTCMinutes()*60+1e3*e.getUTCSeconds()+e.getUTCMilliseconds()}function yF(e,t,n=!1){let r=e.toISOString();return r=r.replace(".000",""),n&&(r=r.replace("T00:00:00Z","")),r.length>10&&(null==t?r=r.replace("Z",""):0!==t&&(r=r.replace("Z",xF(t,!0)))),r}function wF(e){return e.toISOString().replace(/T.*$/,"")}function SF(e){return WH(e.getUTCHours(),2)+":"+WH(e.getUTCMinutes(),2)+":"+WH(e.getUTCSeconds(),2)}function xF(e,t=!1){let n=e<0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),s=Math.round(r%60);return t?`${n+WH(i,2)}:${WH(s,2)}`:`GMT${n}${i}${s?`:${WH(s,2)}`:""}`}function EF(e,t,n){let r,i;return function(...s){if(r){if(!iF(r,s)){n&&n(i);let r=e.apply(this,s);t&&t(r,i)||(i=r)}}else i=e.apply(this,s);return r=s,i}}function CF(e,t,n){let r,i;return s=>{if(r){if(!rj(r,s)){n&&n(i);let r=e.call(this,s);t&&t(r,i)||(i=r)}}else i=e.call(this,s);return r=s,i}}const AF={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},MF={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},kF=/\s*([ap])\.?m\.?/i,TF=/,/g,RF=/\s+/g,PF=/\u200e/g,IF=/UTC|GMT/;class DF{constructor(e){let t={},n={},r=9;for(let i in e)i in AF?(n[i]=e[i],AF[i]<9&&(r=Math.min(AF[i],r))):(t[i]=e[i],i in MF&&(r=Math.min(MF[i],r)));this.standardDateProps=t,this.extendedSettings=n,this.smallestUnitNum=r,this.buildFormattingFunc=EF(OF)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,n,r){let{standardDateProps:i,extendedSettings:s}=this,a=(o=e.marker,l=t.marker,(c=n.calendarSystem).getMarkerYear(o)!==c.getMarkerYear(l)?5:c.getMarkerMonth(o)!==c.getMarkerMonth(l)?4:c.getMarkerDay(o)!==c.getMarkerDay(l)?2:bF(o)!==bF(l)?1:0);var o,l,c;if(!a)return this.format(e,n);let u=a;!(u>1)||"numeric"!==i.year&&"2-digit"!==i.year||"numeric"!==i.month&&"2-digit"!==i.month||"numeric"!==i.day&&"2-digit"!==i.day||(u=1);let h=this.format(e,n),d=this.format(t,n);if(h===d)return h;let f=OF(function(e,t){let n={};for(let r in e)(!(r in MF)||MF[r]<=t)&&(n[r]=e[r]);return n}(i,u),s,n),p=f(e),m=f(t),g=function(e,t,n,r){let i=0;for(;i<e.length;){let s=e.indexOf(t,i);if(-1===s)break;let a=e.substr(0,s);i=s+t.length;let o=e.substr(i),l=0;for(;l<n.length;){let e=n.indexOf(r,l);if(-1===e)break;let t=n.substr(0,e);l=e+r.length;let i=n.substr(l);if(a===t&&o===i)return{before:a,after:o}}}return null}(h,p,d,m),v=s.separator||r||n.defaultSeparator||"";return g?g.before+p+v+m+g.after:h+v+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}}function OF(e,t,n){let r=Object.keys(e).length;return 1===r&&"short"===e.timeZoneName?e=>xF(e.timeZoneOffset):0===r&&t.week?e=>function(e,t,n,r,i){let s=[];return"long"===i?s.push(n):"short"!==i&&"narrow"!==i||s.push(t),"long"!==i&&"short"!==i||s.push(" "),s.push(r.simpleNumberFormat.format(e)),"rtl"===r.options.direction&&s.reverse(),s.join("")}(n.computeWeekNumber(e.marker),n.weekText,n.weekTextLong,n.locale,t.week):function(e,t,n){e=Object.assign({},e),t=Object.assign({},t),function(e,t){e.timeZoneName&&(e.hour||(e.hour="2-digit"),e.minute||(e.minute="2-digit")),"long"===e.timeZoneName&&(e.timeZoneName="short"),t.omitZeroMinute&&(e.second||e.millisecond)&&delete t.omitZeroMinute}(e,t),e.timeZone="UTC";let r,i=new Intl.DateTimeFormat(n.locale.codes,e);if(t.omitZeroMinute){let t=Object.assign({},e);delete t.minute,r=new Intl.DateTimeFormat(n.locale.codes,t)}return s=>{let a,{marker:o}=s;return a=r&&!o.getUTCMinutes()?r:i,function(e,t,n,r,i){return e=e.replace(PF,""),"short"===n.timeZoneName&&(e=function(e,t){let n=!1;return e=e.replace(IF,()=>(n=!0,t)),n||(e+=` ${t}`),e}(e,"UTC"===i.timeZone||null==t.timeZoneOffset?"UTC":xF(t.timeZoneOffset))),r.omitCommas&&(e=e.replace(TF,"").trim()),r.omitZeroMinute&&(e=e.replace(":00","")),!1===r.meridiem?e=e.replace(kF,"").trim():"narrow"===r.meridiem?e=e.replace(kF,(e,t)=>t.toLocaleLowerCase()):"short"===r.meridiem?e=e.replace(kF,(e,t)=>`${t.toLocaleLowerCase()}m`):"lowercase"===r.meridiem&&(e=e.replace(kF,e=>e.toLocaleLowerCase())),e=(e=e.replace(RF," ")).trim()}(a.format(o),s,e,t,n)}}(e,t,n)}function LF(e,t){let n=t.markerToArray(e.marker);return{marker:e.marker,timeZoneOffset:e.timeZoneOffset,array:n,year:n[0],month:n[1],day:n[2],hour:n[3],minute:n[4],second:n[5],millisecond:n[6]}}function BF(e,t,n,r){let i=LF(e,n.calendarSystem);return{date:i,start:i,end:t?LF(t,n.calendarSystem):null,timeZone:n.timeZone,localeCodes:n.locale.codes,defaultSeparator:r||n.defaultSeparator}}class NF{constructor(e){this.cmdStr=e}format(e,t,n){return t.cmdFormatter(this.cmdStr,BF(e,null,t,n))}formatRange(e,t,n,r){return n.cmdFormatter(this.cmdStr,BF(e,t,n,r))}}class UF{constructor(e){this.func=e}format(e,t,n){return this.func(BF(e,null,t,n))}formatRange(e,t,n,r){return this.func(BF(e,t,n,r))}}function HF(e){return"object"==typeof e&&e?new DF(e):"string"==typeof e?new NF(e):"function"==typeof e?new UF(e):null}const FF={navLinkDayClick:YF,navLinkWeekClick:YF,duration:ZH,bootstrapFontAwesome:YF,buttonIcons:YF,customButtons:YF,defaultAllDayEventDuration:ZH,defaultTimedEventDuration:ZH,nextDayThreshold:ZH,scrollTime:ZH,scrollTimeReset:Boolean,slotMinTime:ZH,slotMaxTime:ZH,dayPopoverFormat:HF,slotDuration:ZH,snapDuration:ZH,headerToolbar:YF,footerToolbar:YF,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:HF,dayHeaderClassNames:YF,dayHeaderContent:YF,dayHeaderDidMount:YF,dayHeaderWillUnmount:YF,dayCellClassNames:YF,dayCellContent:YF,dayCellDidMount:YF,dayCellWillUnmount:YF,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:YF,weekNumbers:Boolean,weekNumberClassNames:YF,weekNumberContent:YF,weekNumberDidMount:YF,weekNumberWillUnmount:YF,editable:Boolean,viewClassNames:YF,viewDidMount:YF,viewWillUnmount:YF,nowIndicator:Boolean,nowIndicatorSnap:YF,nowIndicatorClassNames:YF,nowIndicatorContent:YF,nowIndicatorDidMount:YF,nowIndicatorWillUnmount:YF,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:YF,locale:YF,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:YF,eventOrder:function(e){let t,n,r=[],i=[];for("string"==typeof e?i=e.split(/\s*,\s*/):"function"==typeof e?i=[e]:Array.isArray(e)&&(i=e),t=0;t<i.length;t+=1)n=i[t],"string"==typeof n?r.push("-"===n.charAt(0)?{field:n.substring(1),order:-1}:{field:n,order:1}):"function"==typeof n&&r.push({func:n});return r},eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:YF,contentHeight:YF,direction:String,weekNumberFormat:HF,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:YF,initialDate:YF,now:YF,eventDataTransform:YF,stickyHeaderDates:YF,stickyFooterScrollbar:YF,viewHeight:YF,defaultAllDay:Boolean,eventSourceFailure:YF,eventSourceSuccess:YF,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:YF,eventConstraint:YF,eventAllow:YF,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:YF,eventContent:YF,eventDidMount:YF,eventWillUnmount:YF,selectConstraint:YF,selectOverlap:YF,selectAllow:YF,droppable:Boolean,unselectCancel:String,slotLabelFormat:YF,slotLaneClassNames:YF,slotLaneContent:YF,slotLaneDidMount:YF,slotLaneWillUnmount:YF,slotLabelClassNames:YF,slotLabelContent:YF,slotLabelDidMount:YF,slotLabelWillUnmount:YF,dayMaxEvents:YF,dayMaxEventRows:YF,dayMinWidth:Number,slotLabelInterval:ZH,allDayText:String,allDayClassNames:YF,allDayContent:YF,allDayDidMount:YF,allDayWillUnmount:YF,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:HF,rerenderDelay:Number,moreLinkText:YF,moreLinkHint:YF,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:YF,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:ZH,hiddenDays:YF,fixedWeekCount:Boolean,validRange:YF,visibleRange:YF,titleFormat:YF,eventInteractive:Boolean,noEventsText:String,viewHint:YF,navLinkHint:YF,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:YF,moreLinkClassNames:YF,moreLinkContent:YF,moreLinkDidMount:YF,moreLinkWillUnmount:YF,monthStartFormat:HF,handleCustomRendering:YF,customRenderingMetaMap:YF,customRenderingReplaces:Boolean},jF={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" – ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},zF={datesSet:YF,eventsSet:YF,eventAdd:YF,eventChange:YF,eventRemove:YF,windowResize:YF,eventClick:YF,eventMouseEnter:YF,eventMouseLeave:YF,select:YF,unselect:YF,loading:YF,_unmount:YF,_beforeprint:YF,_afterprint:YF,_noEventDrop:YF,_noEventResize:YF,_resize:YF,_scrollRequest:YF},VF={buttonText:YF,buttonHints:YF,views:YF,plugins:YF,initialEvents:YF,events:YF,eventSources:YF},GF={headerToolbar:WF,footerToolbar:WF,buttonText:WF,buttonHints:WF,buttonIcons:WF,dateIncrement:WF,plugins:qF,events:qF,eventSources:qF,resources:qF};function WF(e,t){return"object"==typeof e&&"object"==typeof t&&e&&t?rj(e,t):e===t}function qF(e,t){return Array.isArray(e)&&Array.isArray(t)?iF(e,t):e===t}const KF={type:String,component:YF,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:YF,usesMinMaxTime:Boolean,classNames:YF,content:YF,didMount:YF,willUnmount:YF};function $F(e){return JF(e,GF)}function XF(e,t){let n={},r={};for(let r in t)r in e&&(n[r]=t[r](e[r]));for(let n in e)n in t||(r[n]=e[n]);return{refined:n,extra:r}}function YF(e){return e}const{hasOwnProperty:ZF}=Object.prototype;function JF(e,t){let n={};if(t)for(let r in t)if(t[r]===WF){let t=[];for(let i=e.length-1;i>=0;i-=1){let s=e[i][r];if("object"==typeof s&&s)t.unshift(s);else if(void 0!==s){n[r]=s;break}}t.length&&(n[r]=JF(t))}for(let t=e.length-1;t>=0;t-=1){let r=e[t];for(let e in r)e in n||(n[e]=r[e])}return n}function QF(e,t){let n={};for(let r in e)t(e[r],r)&&(n[r]=e[r]);return n}function ej(e,t){let n={};for(let r in e)n[r]=t(e[r],r);return n}function tj(e){let t={};for(let n of e)t[n]=!0;return t}function nj(e){let t=[];for(let n in e)t.push(e[n]);return t}function rj(e,t){if(e===t)return!0;for(let n in e)if(ZF.call(e,n)&&!(n in t))return!1;for(let n in t)if(ZF.call(t,n)&&e[n]!==t[n])return!1;return!0}const ij=/^on[A-Z]/;function sj(e,t,n={}){if(e===t)return!0;for(let r in t)if(!(r in e)||!aj(e[r],t[r],n[r]))return!1;for(let n in e)if(!(n in t))return!1;return!0}function aj(e,t,n){return e===t||!0===n||!!n&&n(e,t)}let oj={};var lj;lj=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return vF(e)}markerToArray(e){return gF(e)}},oj.gregory=lj;const cj=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;class uj{constructor(e){let t=this.timeZone=e.timeZone,n="local"!==t&&"UTC"!==t;e.namedTimeZoneImpl&&n&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=Boolean(!n||this.namedTimeZoneImpl),this.calendarSystem=function(e){return new oj[e]}(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,"ISO"===e.weekNumberCalculation&&(this.weekDow=1,this.weekDoy=4),"number"==typeof e.firstDay&&(this.weekDow=e.firstDay),"function"==typeof e.weekNumberCalculation&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=null!=e.weekText?e.weekText:e.locale.options.weekText,this.weekTextLong=(null!=e.weekTextLong?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return null===t?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker((new Date).valueOf()):vF(pF(new Date))}createMarkerMeta(e){if("string"==typeof e)return this.parse(e);let t=null;return"number"==typeof e?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=vF(e)),null!==t&&_F(t)?{marker:t,isTimeUnspecified:!1,forcedTzo:null}:null}parse(e){let t=function(e){let t=cj.exec(e);if(t){let e=new Date(Date.UTC(Number(t[1]),t[3]?Number(t[3])-1:0,Number(t[5]||1),Number(t[7]||0),Number(t[8]||0),Number(t[10]||0),t[12]?1e3*Number(`0.${t[12]}`):0));if(_F(e)){let n=null;return t[13]&&(n=("-"===t[15]?-1:1)*(60*Number(t[16]||0)+Number(t[18]||0))),{marker:e,isTimeUnspecified:!t[6],timeZoneOffset:n}}}return null}(e);if(null===t)return null;let{marker:n}=t,r=null;return null!==t.timeZoneOffset&&(this.canComputeOffset?n=this.timestampToMarker(n.valueOf()-60*t.timeZoneOffset*1e3):r=t.timeZoneOffset),{marker:n,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:r}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t.years,n[1]+=t.months,n[2]+=t.days,n[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(n)}subtract(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]-=t.years,n[1]-=t.months,n[2]-=t.days,n[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(n)}addYears(e,t){let n=this.calendarSystem.markerToArray(e);return n[0]+=t,this.calendarSystem.arrayToMarker(n)}addMonths(e,t){let n=this.calendarSystem.markerToArray(e);return n[1]+=t,this.calendarSystem.arrayToMarker(n)}diffWholeYears(e,t){let{calendarSystem:n}=this;return bF(e)===bF(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)&&n.getMarkerMonth(e)===n.getMarkerMonth(t)?n.getMarkerYear(t)-n.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:n}=this;return bF(e)===bF(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)?n.getMarkerMonth(t)-n.getMarkerMonth(e)+12*(n.getMarkerYear(t)-n.getMarkerYear(e)):null}greatestWholeUnit(e,t){let n=this.diffWholeYears(e,t);return null!==n?{unit:"year",value:n}:(n=this.diffWholeMonths(e,t),null!==n?{unit:"month",value:n}:(n=function(e,t){let n=uF(e,t);return null!==n&&n%7==0?n/7:null}(e,t),null!==n?{unit:"week",value:n}:(n=uF(e,t),null!==n?{unit:"day",value:n}:(n=function(e,t){return(t.valueOf()-e.valueOf())/36e5}(e,t),KH(n)?{unit:"hour",value:n}:(n=function(e,t){return(t.valueOf()-e.valueOf())/6e4}(e,t),KH(n)?{unit:"minute",value:n}:(n=function(e,t){return(t.valueOf()-e.valueOf())/1e3}(e,t),KH(n)?{unit:"second",value:n}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,n){let r;return n.years&&(r=this.diffWholeYears(e,t),null!==r)?r/(eF(n)/365):n.months&&(r=this.diffWholeMonths(e,t),null!==r)?r/(eF(n)/30):n.days&&(r=uF(e,t),null!==r)?r/eF(n):(t.valueOf()-e.valueOf())/tF(n)}startOf(e,t){return"year"===t?this.startOfYear(e):"month"===t?this.startOfMonth(e):"week"===t?this.startOfWeek(e):"day"===t?hF(e):"hour"===t?function(e){return vF([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours()])}(e):"minute"===t?function(e){return vF([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes()])}(e):"second"===t?function(e){return vF([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()])}(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):function(e,t,n){let r=e.getUTCFullYear(),i=dF(e,r,t,n);if(i<1)return dF(e,r-1,t,n);let s=dF(e,r+1,t,n);return s>=1?Math.min(i,s):i}(e,this.weekDow,this.weekDoy)}format(e,t,n={}){return t.format({marker:e,timeZoneOffset:null!=n.forcedTzo?n.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,n,r={}){return r.isEndExclusive&&(t=lF(t,-1)),n.formatRange({marker:e,timeZoneOffset:null!=r.forcedStartTzo?r.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:null!=r.forcedEndTzo?r.forcedEndTzo:this.offsetForMarker(t)},this,r.defaultSeparator)}formatIso(e,t={}){let n=null;return t.omitTimeZoneOffset||(n=null!=t.forcedTzo?t.forcedTzo:this.offsetForMarker(e)),yF(e,n,t.omitTime)}timestampToMarker(e){return"local"===this.timeZone?vF(pF(new Date(e))):"UTC"!==this.timeZone&&this.namedTimeZoneImpl?vF(this.namedTimeZoneImpl.timestampToArray(e)):new Date(e)}offsetForMarker(e){return"local"===this.timeZone?-mF(gF(e)).getTimezoneOffset():"UTC"===this.timeZone?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(gF(e)):null}toDate(e,t){return"local"===this.timeZone?mF(gF(e)):"UTC"===this.timeZone?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-1e3*this.namedTimeZoneImpl.offsetForArray(gF(e))*60):new Date(e.valueOf()-(t||0))}}class hj{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,n;if("object"==typeof e&&e){for(n in t=Object.assign({},this.iconClasses),e)t[n]=this.applyIconOverridePrefix(e[n]);this.iconClasses=t}else!1===e&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&0!==e.indexOf(t)&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let n;return n=t&&this.rtlIconClasses&&this.rtlIconClasses[e]||this.iconClasses[e],n?`${this.baseIconClass} ${n}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}}function dj(e){e();let t=rU.debounceRendering,n=[];for(rU.debounceRendering=function(e){n.push(e)},HU(gU(fj,{}),document.createElement("div"));n.length;)n.shift()();rU.debounceRendering=t}hj.prototype.classes={},hj.prototype.iconClasses={},hj.prototype.baseIconClass="",hj.prototype.iconOverridePrefix="";class fj extends xU{render(){return gU("div",{})}componentDidMount(){this.setState({})}}function pj(e){let t=function(e,t){var n={__c:t="__cC"+uU++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var n,r;return this.getChildContext||(n=[],(r={})[t]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&n.some(function(e){e.__e=!0,MU(e)})},this.sub=function(e){n.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n.splice(n.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Provider.__=n.Consumer.contextType=n}(e),n=t.Provider;return t.Provider=function(){let e=!this.getChildContext,t=n.apply(this,arguments);if(e){let e=[];this.shouldComponentUpdate=t=>{this.props.value!==t.value&&e.forEach(e=>{e.context=t.value,e.forceUpdate()})},this.sub=t=>{e.push(t);let n=t.componentWillUnmount;t.componentWillUnmount=()=>{e.splice(e.indexOf(t),1),n&&n.call(t)}}}return t},t}class mj{constructor(e,t,n,r){this.execFunc=e,this.emitter=t,this.scrollTime=n,this.scrollTimeReset=r,this.handleScrollRequest=e=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},e),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}}const gj=pj({});function vj(e,t,n,r,i,s,a,o,l,c,u,h,d,f){return{dateEnv:i,nowManager:s,options:n,pluginHooks:o,emitter:u,dispatch:l,getCurrentData:c,calendarApi:h,viewSpec:e,viewApi:t,dateProfileGenerator:r,theme:a,isRtl:"rtl"===n.direction,addResizeHandler(e){u.on("_resize",e)},removeResizeHandler(e){u.off("_resize",e)},createScrollResponder:e=>new mj(e,u,ZH(n.scrollTime),n.scrollTimeReset),registerInteractiveComponent:d,unregisterInteractiveComponent:f}}class _j extends xU{shouldComponentUpdate(e,t){return!sj(this.props,e,this.propEquality)||!sj(this.state,t,this.stateEquality)}safeSetState(e){sj(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}}_j.addPropsEquality=function(e){let t=Object.create(this.prototype.propEquality);Object.assign(t,e),this.prototype.propEquality=t},_j.addStateEquality=function(e){let t=Object.create(this.prototype.stateEquality);Object.assign(t,e),this.prototype.stateEquality=t},_j.contextType=gj,_j.prototype.propEquality={},_j.prototype.stateEquality={};class bj extends _j{}function yj(e,t){"function"==typeof e?e(t):e&&(e.current=t)}bj.contextType=gj;class wj extends bj{constructor(){super(...arguments),this.id=VH(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{const{options:t}=this.context,{generatorName:n}=this.props;t.customRenderingReplaces&&Sj(n,t)||this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&yj(this.props.elRef,e)}}render(){const{props:e,context:t}=this,{options:n}=t,{customGenerator:r,defaultGenerator:i,renderProps:s}=e,a=xj(e,[],this.handleEl);let o,l,c=!1,u=[];if(null!=r){const e="function"==typeof r?r(s,gU):r;if(!0===e)c=!0;else{const t=e&&"object"==typeof e;t&&"html"in e?a.dangerouslySetInnerHTML={__html:e.html}:t&&"domNodes"in e?u=Array.prototype.slice.call(e.domNodes):(t?sU(e):"function"!=typeof e)?o=e:l=e}}else c=!Sj(e.generatorName,n);return c&&i&&(o=i(s)),this.queuedDomNodes=u,this.currentGeneratorMeta=l,gU(e.elTag,a,o)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;const{props:n,context:r}=this,{handleCustomRendering:i,customRenderingMetaMap:s}=r.options;if(i){const r=null!==(t=this.currentGeneratorMeta)&&void 0!==t?t:null==s?void 0:s[n.generatorName];r&&i(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:r},n),{elClasses:(n.elClasses||[]).filter(Ej)}))}}applyQueueudDomNodes(){const{queuedDomNodes:e,currentDomNodes:t}=this,n=this.base;if(!iF(e,t)){t.forEach(IH);for(let t of e)n.appendChild(t);this.currentDomNodes=e}}}function Sj(e,t){var n;return Boolean(t.handleCustomRendering&&e&&(null===(n=t.customRenderingMetaMap)||void 0===n?void 0:n[e]))}function xj(e,t,n){const r=Object.assign(Object.assign({},e.elAttrs),{ref:n});return(e.elClasses||t)&&(r.className=(e.elClasses||[]).concat(t||[]).concat(r.className||[]).filter(Boolean).join(" ")),e.elStyle&&(r.style=e.elStyle),r}function Ej(e){return Boolean(e)}wj.addPropsEquality({elClasses:iF,elStyle:rj,elAttrs:function(e,t){const n=function(e,t){let n=[];for(let r in e)ZF.call(e,r)&&(r in t||n.push(r));for(let r in t)ZF.call(t,r)&&e[r]!==t[r]&&n.push(r);return n}(e,t);for(let e of n)if(!ij.test(e))return!1;return!0},renderProps:rj});const Cj=pj(0);class Aj extends xU{constructor(){super(...arguments),this.InnerContent=Mj.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(yj(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){const{props:e}=this,t=function(e,t){const n="function"==typeof e?e(t):e||[];return"string"==typeof n?[n]:n}(e.classNameGenerator,e.renderProps);if(e.children){const n=xj(e,t,this.handleEl),r=e.children(this.InnerContent,e.renderProps,n);return e.elTag?gU(e.elTag,n,r):r}return gU(wj,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?null===(t=(e=this.props).didMount)||void 0===t||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;null===(t=(e=this.props).willUnmount)||void 0===t||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}}function Mj(e,t){const n=e.props;return gU(wj,Object.assign({renderProps:n.renderProps,generatorName:n.generatorName,customGenerator:n.customGenerator,defaultGenerator:n.defaultGenerator,renderId:e.context},t))}Aj.contextType=Cj;class kj extends bj{render(){let{props:e,context:t}=this,{options:n}=t,r={view:t.viewApi};return gU(Aj,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...Tj(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:r,classNameGenerator:n.viewClassNames,generatorName:void 0,didMount:n.viewDidMount,willUnmount:n.viewWillUnmount},()=>e.children)}}function Tj(e){return[`fc-${e.type}-view`,"fc-view"]}function Rj(e,t){let n,r,i=[],{start:s}=t;for(e.sort(Pj),n=0;n<e.length;n+=1)r=e[n],r.start>s&&i.push({start:s,end:r.start}),r.end>s&&(s=r.end);return s<t.end&&i.push({start:s,end:t.end}),i}function Pj(e,t){return e.start.valueOf()-t.start.valueOf()}function Ij(e,t){let{start:n,end:r}=e,i=null;return null!==t.start&&(n=null===n?t.start:new Date(Math.max(n.valueOf(),t.start.valueOf()))),null!=t.end&&(r=null===r?t.end:new Date(Math.min(r.valueOf(),t.end.valueOf()))),(null===n||null===r||n<r)&&(i={start:n,end:r}),i}function Dj(e,t){return(null===e.start||t>=e.start)&&(null===e.end||t<e.end)}function Oj(e){let t=Math.floor(cF(e.start,e.end))||1,n=hF(e.start);return{start:n,end:oF(n,t)}}function Lj(e,t=ZH(0)){let n=null,r=null;if(e.end){r=hF(e.end);let n=e.end.valueOf()-r.valueOf();n&&n>=tF(t)&&(r=oF(r,1))}return e.start&&(n=hF(e.start),r&&r<=n&&(r=oF(n,1))),{start:n,end:r}}function Bj(e,t,n,r){return"year"===r?ZH(n.diffWholeYears(e,t),"year"):"month"===r?ZH(n.diffWholeMonths(e,t),"month"):function(e,t){let n=hF(e),r=hF(t);return{years:0,months:0,days:Math.round(cF(n,r)),milliseconds:t.valueOf()-r.valueOf()-(e.valueOf()-n.valueOf())}}(e,t)}class Nj{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,n){let{dateEnv:r}=this.props,i=r.subtract(r.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(i,-1,n)}buildNext(e,t,n){let{dateEnv:r}=this.props,i=r.add(r.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(i,1,n)}build(e,t,n=!0){let r,i,s,a,o,l,{props:c}=this;return r=this.buildValidRange(),r=this.trimHiddenDays(r),n&&(e=function(e,t){return null!=t.start&&e<t.start?t.start:null!=t.end&&e>=t.end?new Date(t.end.valueOf()-1):e}(e,r)),i=this.buildCurrentRangeInfo(e,t),s=/^(year|month|week|day)$/.test(i.unit),a=this.buildRenderRange(this.trimHiddenDays(i.range),i.unit,s),a=this.trimHiddenDays(a),o=a,c.showNonCurrentDates||(o=Ij(o,i.range)),o=this.adjustActiveRange(o),o=Ij(o,r),u=i.range,h=r,l=(null===u.end||null===h.start||u.end>h.start)&&(null===u.start||null===h.end||u.start<h.end),Dj(a,e)||(e=a.start),{currentDate:e,validRange:r,currentRange:i.range,currentRangeUnit:i.unit,isRangeAllDay:s,activeRange:o,renderRange:a,slotMinTime:c.slotMinTime,slotMaxTime:c.slotMaxTime,isValid:l,dateIncrement:this.buildDateIncrement(i.duration)};var u,h}buildValidRange(){let e=this.props.validRangeInput,t="function"==typeof e?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let n,{props:r}=this,i=null,s=null,a=null;return r.duration?(i=r.duration,s=r.durationUnit,a=this.buildRangeFromDuration(e,t,i,s)):(n=this.props.dayCount)?(s="day",a=this.buildRangeFromDayCount(e,t,n)):(a=this.buildCustomVisibleRange(e))?s=r.dateEnv.greatestWholeUnit(a.start,a.end).unit:(i=this.getFallbackDuration(),s=rF(i).unit,a=this.buildRangeFromDuration(e,t,i,s)),{duration:i,unit:s,range:a}}getFallbackDuration(){return ZH({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:n,slotMinTime:r,slotMaxTime:i}=this.props,{start:s,end:a}=e;return n&&(eF(r)<0&&(s=hF(s),s=t.add(s,r)),eF(i)>1&&(a=hF(a),a=oF(a,-1),a=t.add(a,i))),{start:s,end:a}}buildRangeFromDuration(e,t,n,r){let i,s,a,{dateEnv:o,dateAlignment:l}=this.props;if(!l){let{dateIncrement:e}=this.props;l=e&&tF(e)<tF(n)?rF(e).unit:r}function c(){i=o.startOf(e,l),s=o.add(i,n),a={start:i,end:s}}return eF(n)<=1&&this.isHiddenDay(i)&&(i=this.skipHiddenDays(i,t),i=hF(i)),c(),this.trimHiddenDays(a)||(e=this.skipHiddenDays(e,t),c()),a}buildRangeFromDayCount(e,t,n){let r,{dateEnv:i,dateAlignment:s}=this.props,a=0,o=e;s&&(o=i.startOf(o,s)),o=hF(o),o=this.skipHiddenDays(o,t),r=o;do{r=oF(r,1),this.isHiddenDay(r)||(a+=1)}while(a<n);return{start:o,end:r}}buildCustomVisibleRange(e){let{props:t}=this,n=t.visibleRangeInput,r="function"==typeof n?n.call(t.calendarApi,t.dateEnv.toDate(e)):n,i=this.refineRange(r);return!i||null!=i.start&&null!=i.end?i:null}buildRenderRange(e,t,n){return e}buildDateIncrement(e){let t,{dateIncrement:n}=this.props;return n||((t=this.props.dateAlignment)?ZH(1,t):e||ZH({days:1}))}refineRange(e){if(e){let t=function(e,t){let n=null,r=null;return e.start&&(n=t.createMarker(e.start)),e.end&&(r=t.createMarker(e.end)),n||r?n&&r&&r<n?null:{start:n,end:r}:null}(e,this.props.dateEnv);return t&&(t=Lj(t)),t}return null}initHiddenDays(){let e,t=this.props.hiddenDays||[],n=[],r=0;for(!1===this.props.weekends&&t.push(0,6),e=0;e<7;e+=1)(n[e]=-1!==t.indexOf(e))||(r+=1);if(!r)throw new Error("invalid hiddenDays");this.isHiddenDayHash=n}trimHiddenDays(e){let{start:t,end:n}=e;return t&&(t=this.skipHiddenDays(t)),n&&(n=this.skipHiddenDays(n,-1,!0)),null==t||null==n||t<n?{start:t,end:n}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,n=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(n?t:0)+7)%7];)e=oF(e,t);return e}}function Uj(e,t,n,r){return{instanceId:VH(),defId:e,range:t,forcedStartTzo:null==n?null:n,forcedEndTzo:null==r?null:r}}function Hj(e,t,n){let{dateEnv:r,pluginHooks:i,options:s}=n,{defs:a,instances:o}=e;o=QF(o,e=>!a[e.defId].recurringDef);for(let e in a){let n=a[e];if(n.recurringDef){let{duration:a}=n.recurringDef;a||(a=n.allDay?s.defaultAllDayEventDuration:s.defaultTimedEventDuration);let l=Fj(n,a,t,r,i.recurringTypes);for(let t of l){let n=Uj(e,{start:t,end:r.add(t,a)});o[n.instanceId]=n}}}return{defs:a,instances:o}}function Fj(e,t,n,r,i){let s=i[e.recurringDef.typeId].expand(e.recurringDef.typeData,{start:r.subtract(n.start,t),end:n.end},r);return e.allDay&&(s=s.map(hF)),s}const jj={id:String,groupId:String,title:String,url:String,interactive:Boolean},zj={start:YF,end:YF,date:YF,allDay:Boolean},Vj=Object.assign(Object.assign(Object.assign({},jj),zj),{extendedProps:YF});function Gj(e,t,n,r,i=qj(n),s,a){let{refined:o,extra:l}=Wj(e,n,i),c=function(e,t){let n=null;return e&&(n=e.defaultAllDay),null==n&&(n=t.options.defaultAllDay),n}(t,n),u=function(e,t,n,r){for(let i=0;i<r.length;i+=1){let s=r[i].parse(e,n);if(s){let{allDay:n}=e;return null==n&&(n=t,null==n&&(n=s.allDayGuess,null==n&&(n=!1))),{allDay:n,duration:s.duration,typeData:s.typeData,typeId:i}}}return null}(o,c,n.dateEnv,n.pluginHooks.recurringTypes);if(u){let e=Kj(o,l,t?t.sourceId:"",u.allDay,Boolean(u.duration),n,s);return e.recurringDef={typeId:u.typeId,typeData:u.typeData,duration:u.duration},{def:e,instance:null}}let h=function(e,t,n,r){let i,s,{allDay:a}=e,o=null,l=!1,c=null,u=null!=e.start?e.start:e.date;if(i=n.dateEnv.createMarkerMeta(u),i)o=i.marker;else if(!r)return null;return null!=e.end&&(s=n.dateEnv.createMarkerMeta(e.end)),null==a&&(a=null!=t?t:(!i||i.isTimeUnspecified)&&(!s||s.isTimeUnspecified)),a&&o&&(o=hF(o)),s&&(c=s.marker,a&&(c=hF(c)),o&&c<=o&&(c=null)),c?l=!0:r||(l=n.options.forceEventDuration||!1,c=n.dateEnv.add(o,a?n.options.defaultAllDayEventDuration:n.options.defaultTimedEventDuration)),{allDay:a,hasEnd:l,range:{start:o,end:c},forcedStartTzo:i?i.forcedTzo:null,forcedEndTzo:s?s.forcedTzo:null}}(o,c,n,r);if(h){let e=Kj(o,l,t?t.sourceId:"",h.allDay,h.hasEnd,n,s),r=Uj(e.defId,h.range,h.forcedStartTzo,h.forcedEndTzo);return a&&e.publicId&&a[e.publicId]&&(r.instanceId=a[e.publicId]),{def:e,instance:r}}return null}function Wj(e,t,n=qj(t)){return XF(e,n)}function qj(e){return Object.assign(Object.assign(Object.assign({},ez),Vj),e.pluginHooks.eventRefiners)}function Kj(e,t,n,r,i,s,a){let o={title:e.title||"",groupId:e.groupId||"",publicId:e.id||"",url:e.url||"",recurringDef:null,defId:(a&&e.id?a[e.id]:"")||VH(),sourceId:n,allDay:r,hasEnd:i,interactive:e.interactive,ui:nz(e,s),extendedProps:Object.assign(Object.assign({},e.extendedProps||{}),t)};for(let t of s.pluginHooks.eventDefMemberAdders)Object.assign(o,t(e));return Object.freeze(o.ui.classNames),Object.freeze(o.extendedProps),o}function $j(e,t,n,r,i,s){let a={defs:{},instances:{}},o=qj(n);for(let l of e){let e=Gj(l,t,n,r,o,i,s);e&&Xj(e,a)}return a}function Xj(e,t={defs:{},instances:{}}){return t.defs[e.def.defId]=e.def,e.instance&&(t.instances[e.instance.instanceId]=e.instance),t}function Yj(){return{defs:{},instances:{}}}function Zj(e,t){return{defs:Object.assign(Object.assign({},e.defs),t.defs),instances:Object.assign(Object.assign({},e.instances),t.instances)}}function Jj(e,t){let n=QF(e.defs,t),r=QF(e.instances,e=>n[e.defId]);return{defs:n,instances:r}}function Qj(e){return Array.isArray(e)?e:"string"==typeof e?e.split(/\s+/):[]}const ez={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:YF,overlap:YF,allow:YF,className:Qj,classNames:Qj,color:String,backgroundColor:String,borderColor:String,textColor:String},tz={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function nz(e,t){let n=function(e,t){return Array.isArray(e)?$j(e,null,t,!0):"object"==typeof e&&e?$j([e],null,t,!0):null!=e?String(e):null}(e.constraint,t);return{display:e.display||null,startEditable:null!=e.startEditable?e.startEditable:e.editable,durationEditable:null!=e.durationEditable?e.durationEditable:e.editable,constraints:null!=n?[n]:[],overlap:null!=e.overlap?e.overlap:null,allows:null!=e.allow?[e.allow]:[],backgroundColor:e.backgroundColor||e.color||"",borderColor:e.borderColor||e.color||"",textColor:e.textColor||"",classNames:(e.className||[]).concat(e.classNames||[])}}function rz(e){return e.reduce(iz,tz)}function iz(e,t){return{display:null!=t.display?t.display:e.display,startEditable:null!=t.startEditable?t.startEditable:e.startEditable,durationEditable:null!=t.durationEditable?t.durationEditable:e.durationEditable,constraints:e.constraints.concat(t.constraints),overlap:"boolean"==typeof t.overlap?t.overlap:e.overlap,allows:e.allows.concat(t.allows),backgroundColor:t.backgroundColor||e.backgroundColor,borderColor:t.borderColor||e.borderColor,textColor:t.textColor||e.textColor,classNames:e.classNames.concat(t.classNames)}}const sz={id:String,defaultAllDay:Boolean,url:String,format:String,events:YF,eventDataTransform:YF,success:YF,failure:YF};function az(e,t,n=oz(t)){let r;if("string"==typeof e?r={url:e}:"function"==typeof e||Array.isArray(e)?r={events:e}:"object"==typeof e&&e&&(r=e),r){let{refined:i,extra:s}=XF(r,n),a=function(e,t){let n=t.pluginHooks.eventSourceDefs;for(let t=n.length-1;t>=0;t-=1){let r=n[t].parseMeta(e);if(r)return{sourceDefId:t,meta:r}}return null}(i,t);if(a)return{_raw:e,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:i.defaultAllDay,eventDataTransform:i.eventDataTransform,success:i.success,failure:i.failure,publicId:i.id||"",sourceId:VH(),sourceDefId:a.sourceDefId,meta:a.meta,ui:nz(i,t),extendedProps:s}}return null}function oz(e){return Object.assign(Object.assign(Object.assign({},ez),sz),e.pluginHooks.eventSourceRefiners)}function lz(e,t,n){let r=n.options.eventDataTransform,i=t?t.eventDataTransform:null;return i&&(e=cz(e,i)),r&&(e=cz(e,r)),e}function cz(e,t){let n;if(t){n=[];for(let r of e){let e=t(r);e?n.push(e):null==e&&n.push(r)}}else n=e;return n}function uz(e,t,n){let{defs:r}=e,i=ej(e.instances,e=>r[e.defId].allDay?e:Object.assign(Object.assign({},e),{range:{start:n.createMarker(t.toDate(e.range.start,e.forcedStartTzo)),end:n.createMarker(t.toDate(e.range.end,e.forcedEndTzo))},forcedStartTzo:n.canComputeOffset?null:e.forcedStartTzo,forcedEndTzo:n.canComputeOffset?null:e.forcedEndTzo}));return{defs:r,instances:i}}function hz(e,t){return Jj(e,e=>e.sourceId!==t)}class dz{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){!function(e,t,n){(e[t]||(e[t]=[])).push(n)}(this.handlers,e,t)}off(e,t){!function(e,t,n){n?e[t]&&(e[t]=e[t].filter(e=>e!==n)):delete e[t]}(this.handlers,e,t)}trigger(e,...t){let n=this.handlers[e]||[],r=this.options&&this.options[e],i=[].concat(r||[],n);for(let e of i)e.apply(this.thisContext,t)}hasHandlers(e){return Boolean(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}}const fz={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function pz(e,t,n){let{dateEnv:r,options:i}=n,s=t;return e?(s=hF(s),s=r.add(s,i.defaultAllDayEventDuration)):s=r.add(s,i.defaultTimedEventDuration),s}function mz(e,t,n,r){let i=n.standardProps||{};null==i.hasEnd&&t.durationEditable&&(n.startDelta||n.endDelta)&&(i.hasEnd=!0);let s=Object.assign(Object.assign(Object.assign({},e),i),{ui:Object.assign(Object.assign({},e.ui),i.ui)});n.extendedProps&&(s.extendedProps=Object.assign(Object.assign({},s.extendedProps),n.extendedProps));for(let e of r.pluginHooks.eventDefMutationAppliers)e(s,n,r);return!s.hasEnd&&r.options.forceEventDuration&&(s.hasEnd=!0),s}function gz(e,t,n,r,i){let{dateEnv:s}=i,a=r.standardProps&&!0===r.standardProps.allDay,o=r.standardProps&&!1===r.standardProps.hasEnd,l=Object.assign({},e);return a&&(l.range=Oj(l.range)),r.datesDelta&&n.startEditable&&(l.range={start:s.add(l.range.start,r.datesDelta),end:s.add(l.range.end,r.datesDelta)}),r.startDelta&&n.durationEditable&&(l.range={start:s.add(l.range.start,r.startDelta),end:l.range.end}),r.endDelta&&n.durationEditable&&(l.range={start:l.range.start,end:s.add(l.range.end,r.endDelta)}),o&&(l.range={start:l.range.start,end:pz(t.allDay,l.range.start,i)}),t.allDay&&(l.range={start:hF(l.range.start),end:hF(l.range.end)}),l.range.end<l.range.start&&(l.range.end=pz(t.allDay,l.range.start,i)),l}class vz{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}}class _z{constructor(e,t,n){this._context=e,this._def=t,this._instance=n||null}setProp(e,t){if(e in zj)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if("id"===e)t=jj[e](t),this.mutate({standardProps:{publicId:t}});else if(e in jj)t=jj[e](t),this.mutate({standardProps:{[e]:t}});else if(e in ez){let n=ez[e](t);n="color"===e?{backgroundColor:t,borderColor:t}:"editable"===e?{startEditable:t,durationEditable:t}:{[e]:t},this.mutate({standardProps:{ui:n}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:n}=this._context,r=n.createMarker(e);if(r&&this._instance){let e=Bj(this._instance.range.start,r,n,t.granularity);t.maintainDuration?this.mutate({datesDelta:e}):this.mutate({startDelta:e})}}setEnd(e,t={}){let n,{dateEnv:r}=this._context;if((null==e||(n=r.createMarker(e),n))&&this._instance)if(n){let e=Bj(this._instance.range.end,n,r,t.granularity);this.mutate({endDelta:e})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,n={}){let r,{dateEnv:i}=this._context,s={allDay:n.allDay},a=i.createMarker(e);var o,l;if(a&&(null==t||(r=i.createMarker(t),r))&&this._instance){let e=this._instance.range;!0===n.allDay&&(e=Oj(e));let t=Bj(e.start,a,i,n.granularity);if(r){let a=Bj(e.end,r,i,n.granularity);l=a,(o=t).years===l.years&&o.months===l.months&&o.days===l.days&&o.milliseconds===l.milliseconds?this.mutate({datesDelta:t,standardProps:s}):this.mutate({startDelta:t,endDelta:a,standardProps:s})}else s.hasEnd=!1,this.mutate({datesDelta:t,standardProps:s})}}moveStart(e){let t=ZH(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=ZH(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=ZH(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let n={allDay:e},{maintainDuration:r}=t;null==r&&(r=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(n.hasEnd=r),this.mutate({standardProps:n})}formatRange(e){let{dateEnv:t}=this._context,n=this._instance,r=HF(e);return this._def.hasEnd?t.formatRange(n.range.start,n.range.end,r,{forcedStartTzo:n.forcedStartTzo,forcedEndTzo:n.forcedEndTzo}):t.format(n.range.start,r,{forcedTzo:n.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let n=this._def,r=this._context,{eventStore:i}=r.getCurrentData(),s=function(e,t){let n=e.instances[t];if(n){let t=e.defs[n.defId],r=Jj(e,e=>{return n=t,r=e,Boolean(n.groupId&&n.groupId===r.groupId);var n,r});return r.defs[t.defId]=t,r.instances[n.instanceId]=n,r}return{defs:{},instances:{}}}(i,t.instanceId);s=function(e,t,n,r){let i=Ez(e.defs,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}}),s={defs:{},instances:{}};for(let t in e.defs){let a=e.defs[t];s.defs[t]=mz(a,i[t],n,r)}for(let t in e.instances){let a=e.instances[t],o=s.defs[a.defId];s.instances[t]=gz(a,o,i[a.defId],n,r)}return s}(s,0,e,r);let a=new _z(r,n,t);this._def=s.defs[n.defId],this._instance=s.instances[t.instanceId],r.dispatch({type:"MERGE_EVENTS",eventStore:s}),r.emitter.trigger("eventChange",{oldEvent:a,event:this,relatedEvents:yz(s,r,t),revert(){r.dispatch({type:"RESET_EVENTS",eventStore:i})}})}}remove(){let e=this._context,t=bz(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new vz(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:n}=t,{startStr:r,endStr:i}=this,s={allDay:t.allDay};return t.title&&(s.title=t.title),r&&(s.start=r),i&&(s.end=i),t.publicId&&(s.id=t.publicId),t.groupId&&(s.groupId=t.groupId),t.url&&(s.url=t.url),n.display&&"auto"!==n.display&&(s.display=n.display),e.collapseColor&&n.backgroundColor&&n.backgroundColor===n.borderColor?s.color=n.backgroundColor:(n.backgroundColor&&(s.backgroundColor=n.backgroundColor),n.borderColor&&(s.borderColor=n.borderColor)),n.textColor&&(s.textColor=n.textColor),n.classNames.length&&(s.classNames=n.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(s,t.extendedProps):s.extendedProps=t.extendedProps),s}toJSON(){return this.toPlainObject()}}function bz(e){let t=e._def,n=e._instance;return{defs:{[t.defId]:t},instances:n?{[n.instanceId]:n}:{}}}function yz(e,t,n){let{defs:r,instances:i}=e,s=[],a=n?n.instanceId:"";for(let e in i){let n=i[e],o=r[n.defId];n.instanceId!==a&&s.push(new _z(t,o,n))}return s}function wz(e,t,n,r){let i={},s={},a={},o=[],l=[],c=Ez(e.defs,t);for(let t in e.defs){let n=e.defs[t];"inverse-background"===c[n.defId].display&&(n.groupId?(i[n.groupId]=[],a[n.groupId]||(a[n.groupId]=n)):s[t]=[])}for(let t in e.instances){let a=e.instances[t],u=e.defs[a.defId],h=c[u.defId],d=a.range,f=!u.allDay&&r?Lj(d,r):d,p=Ij(f,n);p&&("inverse-background"===h.display?u.groupId?i[u.groupId].push(p):s[a.defId].push(p):"none"!==h.display&&("background"===h.display?o:l).push({def:u,ui:h,instance:a,range:p,isStart:f.start&&f.start.valueOf()===p.start.valueOf(),isEnd:f.end&&f.end.valueOf()===p.end.valueOf()}))}for(let e in i){let t=Rj(i[e],n);for(let n of t){let t=a[e],r=c[t.defId];o.push({def:t,ui:r,instance:null,range:n,isStart:!1,isEnd:!1})}}for(let t in s){let r=Rj(s[t],n);for(let n of r)o.push({def:e.defs[t],ui:c[t],instance:null,range:n,isStart:!1,isEnd:!1})}return{bg:o,fg:l}}function Sz(e,t){e.fcSeg=t}function xz(e){return e.fcSeg||e.parentNode.fcSeg||null}function Ez(e,t){return ej(e,e=>Cz(e,t))}function Cz(e,t){let n=[];return t[""]&&n.push(t[""]),t[e.defId]&&n.push(t[e.defId]),n.push(e.ui),rz(n)}function Az(e,t){let n=e.map(Mz);return n.sort((e,n)=>function(e,t,n){let r,i;for(r=0;r<n.length;r+=1)if(i=GH(e,t,n[r]),i)return i;return 0}(e,n,t)),n.map(e=>e._seg)}function Mz(e){let{eventRange:t}=e,n=t.def,r=t.instance?t.instance.range:t.range,i=r.start?r.start.valueOf():0,s=r.end?r.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},n.extendedProps),n),{id:n.publicId,start:i,end:s,duration:s-i,allDay:Number(n.allDay),_seg:e})}function kz(e,t){let{pluginHooks:n}=t,r=n.isDraggableTransformers,{def:i,ui:s}=e.eventRange,a=s.startEditable;for(let e of r)a=e(a,i,s,t);return a}function Tz(e,t){return e.isStart&&e.eventRange.ui.durationEditable&&t.options.eventResizableFromStart}function Rz(e,t){return e.isEnd&&e.eventRange.ui.durationEditable}function Pz(e,t,n,r,i,s,a){let{dateEnv:o,options:l}=n,{displayEventTime:c,displayEventEnd:u}=l,h=e.eventRange.def,d=e.eventRange.instance;null==c&&(c=!1!==r),null==u&&(u=!1!==i);let f=d.range.start,p=d.range.end,m=s||e.start||e.eventRange.range.start,g=a||e.end||e.eventRange.range.end,v=hF(f).valueOf()===hF(m).valueOf(),_=hF(lF(p,-1)).valueOf()===hF(lF(g,-1)).valueOf();return c&&!h.allDay&&(v||_)?(m=v?f:m,g=_?p:g,u&&h.hasEnd?o.formatRange(m,g,t,{forcedStartTzo:s?null:d.forcedStartTzo,forcedEndTzo:a?null:d.forcedEndTzo}):o.format(m,t,{forcedTzo:s?null:d.forcedStartTzo})):""}function Iz(e,t,n){let r=e.eventRange.range;return{isPast:r.end<=(n||t.start),isFuture:r.start>=(n||t.end),isToday:t&&Dj(t,r.start)}}function Dz(e){let t=["fc-event"];return e.isMirror&&t.push("fc-event-mirror"),e.isDraggable&&t.push("fc-event-draggable"),(e.isStartResizable||e.isEndResizable)&&t.push("fc-event-resizable"),e.isDragging&&t.push("fc-event-dragging"),e.isResizing&&t.push("fc-event-resizing"),e.isSelected&&t.push("fc-event-selected"),e.isStart&&t.push("fc-event-start"),e.isEnd&&t.push("fc-event-end"),e.isPast&&t.push("fc-event-past"),e.isToday&&t.push("fc-event-today"),e.isFuture&&t.push("fc-event-future"),t}function Oz(e){return e.instance?e.instance.instanceId:`${e.def.defId}:${e.range.start.toISOString()}`}function Lz(e,t){let{def:n,instance:r}=e.eventRange,{url:i}=n;if(i)return{href:i};let{emitter:s,options:a}=t,{eventInteractive:o}=a;return null==o&&(o=n.interactive,null==o&&(o=Boolean(s.hasHandlers("eventClick")))),o?jH(e=>{s.trigger("eventClick",{el:e.target,event:new _z(t,n,r),jsEvent:e,view:t.viewApi})}):{}}const Bz={start:YF,end:YF,allDay:Boolean};function Nz(e,t,n){return Object.assign(Object.assign({},Uz(e,t,n)),{timeZone:t.timeZone})}function Uz(e,t,n){return{start:t.toDate(e.start),end:t.toDate(e.end),startStr:t.formatIso(e.start,{omitTime:n}),endStr:t.formatIso(e.end,{omitTime:n})}}class Hz extends Error{constructor(e,t){super(e),this.response=t}}let Fz;function jz(){return null==Fz&&(Fz=function(){if("undefined"==typeof document)return!0;let e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.innerHTML="<table><tr><td><div></div></td></tr></table>",e.querySelector("table").style.height="100px",e.querySelector("div").style.height="100%",document.body.appendChild(e);let t=e.querySelector("div").offsetHeight>0;return document.body.removeChild(e),t}()),Fz}class zz extends bj{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{dj(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{dj(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:n}=this.state,r=n||"auto"===t.height||"auto"===t.contentHeight,i=r||null==t.height?"":t.height,s=["fc",n?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return jz()||s.push("fc-liquid-hack"),e.children(s,i,r,n)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}}class Vz{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}}const Gz={};class Wz extends xU{constructor(e,t){super(e,t),this.handleRefresh=()=>{let e=this.computeTiming();e.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(e.state),this.clearTimeout(),this.setTimeout(e.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let e,t,{props:n,context:r}=this,i=r.nowManager.getDateMarker(),{nowIndicatorSnap:s}=r.options;return"auto"===s&&(s=/year|month|week|day/.test(n.unit)||1===(n.unitValue||1)),s?(e=r.dateEnv.startOf(i,n.unit),t=r.dateEnv.add(e,ZH(1,n.unit)).valueOf()-i.valueOf()):(e=i,t=6e4),t=Math.min(864e5,t),{state:{nowDate:e,todayRange:qz(e)},waitMs:t}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{const e=this.computeTiming();this.setState(e.state,()=>{this.setTimeout(e.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}}function qz(e){let t=hF(e);return{start:t,end:oF(t,1)}}Wz.contextType=gj;class Kz{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:n}=this;n.currentCalendarOptionsRefiners[e]?n.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:n}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:n.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let n;t=t||"day",n=this.getCurrentData().viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),n?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:n.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let t,n,{viewSpecs:r,toolbarConfig:i}=this.getCurrentData(),s=[].concat(i.header?i.header.viewsWithButtons:[],i.footer?i.footer.viewsWithButtons:[]);for(let e in r)s.push(e);for(t=0;t<s.length;t+=1)if(n=r[s[t]],n&&n.singleUnit===e)return n;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),n=ZH(e);n&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,n)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:n}=this.getCurrentData();return n.format(n.createMarker(e),HF(t))}formatRange(e,t,n){let{dateEnv:r}=this.getCurrentData();return r.formatRange(r.createMarker(e),r.createMarker(t),HF(n),n)}formatIso(e,t){let{dateEnv:n}=this.getCurrentData();return n.formatIso(n.createMarker(e),{omitTime:t})}select(e,t){let n;n=null==t?null!=e.start?e:{start:e,end:null}:{start:e,end:t};let r=this.getCurrentData(),i=function(e,t,n){let r=function(e,t){let{refined:n,extra:r}=XF(e,Bz),i=n.start?t.createMarkerMeta(n.start):null,s=n.end?t.createMarkerMeta(n.end):null,{allDay:a}=n;return null==a&&(a=i&&i.isTimeUnspecified&&(!s||s.isTimeUnspecified)),Object.assign({range:{start:i?i.marker:null,end:s?s.marker:null},allDay:a},r)}(e,t),{range:i}=r;if(!i.start)return null;if(!i.end){if(null==n)return null;i.end=t.add(i.start,n)}return r}(n,r.dateEnv,ZH({days:1}));i&&(this.dispatch({type:"SELECT_DATES",selection:i}),function(e,t,n){n.emitter.trigger("select",Object.assign(Object.assign({},function(e,t){let n={};for(let r of t.pluginHooks.dateSpanTransforms)Object.assign(n,r(e,t));var r,i;return Object.assign(n,(r=e,i=t.dateEnv,Object.assign(Object.assign({},Uz(r.range,i,r.allDay)),{allDay:r.allDay}))),n}(e,n)),{jsEvent:null,view:n.viewApi||n.calendarApi.view}))}(i,0,r))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),function(e,t){t.emitter.trigger("unselect",{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view})}(e,t))}addEvent(e,t){if(e instanceof _z){let t=e._def,n=e._instance;return this.getCurrentData().eventStore.defs[t.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:Xj({def:t,instance:n})}),this.triggerEventAdd(e)),e}let n,r=this.getCurrentData();if(t instanceof vz)n=t.internalEventSource;else if("boolean"==typeof t)t&&([n]=nj(r.eventSources));else if(null!=t){let e=this.getEventSourceById(t);if(!e)return console.warn(`Could not find an event source with ID "${t}"`),null;n=e.internalEventSource}let i=Gj(e,n,r,!1);if(i){let e=new _z(r,i.def,i.def.recurringDef?null:i.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:Xj(i)}),this.triggerEventAdd(e),e}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:bz(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:n,instances:r}=t.eventStore;e=String(e);for(let i in n){let s=n[i];if(s.publicId===e){if(s.recurringDef)return new _z(t,s,null);for(let e in r){let n=r[e];if(n.defId===s.defId)return new _z(t,s,n)}}}return null}getEvents(){let e=this.getCurrentData();return yz(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,n=[];for(let r in t)n.push(new vz(e,t[r]));return n}getEventSourceById(e){let t=this.getCurrentData(),n=t.eventSources;e=String(e);for(let r in n)if(n[r].publicId===e)return new vz(t,n[r]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof vz)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let n=az(e,t);return n?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n]}),new vz(t,n)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=ZH(e);t&&this.trigger("_scrollRequest",{time:t})}}function $z(e,t){let n={left:Math.max(e.left,t.left),right:Math.min(e.right,t.right),top:Math.max(e.top,t.top),bottom:Math.min(e.bottom,t.bottom)};return n.left<n.right&&n.top<n.bottom&&n}const Xz={defs:{},instances:{}};class Yz{constructor(){this.getKeysForEventDefs=EF(this._getKeysForEventDefs),this.splitDateSelection=EF(this._splitDateSpan),this.splitEventStore=EF(this._splitEventStore),this.splitIndividualUi=EF(this._splitIndividualUi),this.splitEventDrag=EF(this._splitInteraction),this.splitEventResize=EF(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),n=this.getKeysForEventDefs(e.eventStore),r=this.splitDateSelection(e.dateSelection),i=this.splitIndividualUi(e.eventUiBases,n),s=this.splitEventStore(e.eventStore,n),a=this.splitEventDrag(e.eventDrag),o=this.splitEventResize(e.eventResize),l={};this.eventUiBuilders=ej(t,(e,t)=>this.eventUiBuilders[t]||EF(Zz));for(let n in t){let c=t[n],u=s[n]||Xz,h=this.eventUiBuilders[n];l[n]={businessHours:c.businessHours||e.businessHours,dateSelection:r[n]||null,eventStore:u,eventUiBases:h(e.eventUiBases[""],c.ui,i[n]),eventSelection:u.instances[e.eventSelection]?e.eventSelection:"",eventDrag:a[n]||null,eventResize:o[n]||null}}return l}_splitDateSpan(e){let t={};if(e){let n=this.getKeysForDateSpan(e);for(let r of n)t[r]=e}return t}_getKeysForEventDefs(e){return ej(e.defs,e=>this.getKeysForEventDef(e))}_splitEventStore(e,t){let{defs:n,instances:r}=e,i={};for(let e in n)for(let r of t[e])i[r]||(i[r]=Yj()),i[r].defs[e]=n[e];for(let e in r){let n=r[e];for(let r of t[n.defId])i[r]&&(i[r].instances[e]=n)}return i}_splitIndividualUi(e,t){let n={};for(let r in e)if(r)for(let i of t[r])n[i]||(n[i]={}),n[i][r]=e[r];return n}_splitInteraction(e){let t={};if(e){let n=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),r=this._getKeysForEventDefs(e.mutatedEvents),i=this._splitEventStore(e.mutatedEvents,r),s=r=>{t[r]||(t[r]={affectedEvents:n[r]||Xz,mutatedEvents:i[r]||Xz,isEvent:e.isEvent})};for(let e in n)s(e);for(let e in i)s(e)}return t}}function Zz(e,t,n){let r=[];e&&r.push(e),t&&r.push(t);let i={"":rz(r)};return n&&Object.assign(i,n),i}function Jz(e,t,n,r){return{dow:e.getUTCDay(),isDisabled:Boolean(r&&(!r.activeRange||!Dj(r.activeRange,e))),isOther:Boolean(r&&!Dj(r.currentRange,e)),isToday:Boolean(t&&Dj(t,e)),isPast:Boolean(n?e<n:!!t&&e<t.start),isFuture:Boolean(n?e>n:!!t&&e>=t.end)}}function Qz(e,t){let n=["fc-day",`fc-day-${sF[e.dow]}`];return e.isDisabled?n.push("fc-day-disabled"):(e.isToday&&(n.push("fc-day-today"),n.push(t.getClass("today"))),e.isPast&&n.push("fc-day-past"),e.isFuture&&n.push("fc-day-future"),e.isOther&&n.push("fc-day-other")),n}const eV=HF({year:"numeric",month:"long",day:"numeric"}),tV=HF({week:"long"});function nV(e,t,n="day",r=!0){const{dateEnv:i,options:s,calendarApi:a}=e;let o=i.format(t,"week"===n?tV:eV);if(s.navLinks){let e=i.toDate(t);const l=e=>{let r="day"===n?s.navLinkDayClick:"week"===n?s.navLinkWeekClick:null;"function"==typeof r?r.call(a,i.toDate(t),e):("string"==typeof r&&(n=r),a.zoomTo(t,n))};return Object.assign({title:qH(s.navLinkHint,[o,e],o),"data-navlink":""},r?FH(l):{onClick:l})}return{"aria-label":o}}let rV;class iV{constructor(e,t,n,r){this.els=t;let i=this.originClientRect=e.getBoundingClientRect();n&&this.buildElHorizontals(i.left),r&&this.buildElVerticals(i.top)}buildElHorizontals(e){let t=[],n=[];for(let r of this.els){let i=r.getBoundingClientRect();t.push(i.left-e),n.push(i.right-e)}this.lefts=t,this.rights=n}buildElVerticals(e){let t=[],n=[];for(let r of this.els){let i=r.getBoundingClientRect();t.push(i.top-e),n.push(i.bottom-e)}this.tops=t,this.bottoms=n}leftToIndex(e){let t,{lefts:n,rights:r}=this,i=n.length;for(t=0;t<i;t+=1)if(e>=n[t]&&e<r[t])return t}topToIndex(e){let t,{tops:n,bottoms:r}=this,i=n.length;for(t=0;t<i;t+=1)if(e>=n[t]&&e<r[t])return t}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return sV(this.tops||[],e.tops||[])&&sV(this.bottoms||[],e.bottoms||[])&&sV(this.lefts||[],e.lefts||[])&&sV(this.rights||[],e.rights||[])}}function sV(e,t){const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(Math.round(e[r])!==Math.round(t[r]))return!1;return!0}class aV extends bj{constructor(){super(...arguments),this.uid=VH()}prepareHits(){}queryHit(e,t,n,r){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!DH(e,".fc-event-mirror")}isValidDateDownEl(e){return!(DH(e,".fc-event:not(.fc-bg-event)")||DH(e,".fc-more-link")||DH(e,"a[data-navlink]")||DH(e,".fc-popover"))}}class oV{constructor(e=e=>e.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let n of e)this.insertEntry(n,t);return t}insertEntry(e,t){let n=this.findInsertion(e);this.isInsertionValid(n,e)?this.insertEntryAt(e,n):this.handleInvalidInsertion(n,e,t)}isInsertionValid(e,t){return(-1===this.maxCoord||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(-1===this.maxStackCnt||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,n){if(this.allowReslicing&&e.touchingEntry){const r=Object.assign(Object.assign({},t),{span:hV(t.span,e.touchingEntry.span)});n.push(r),this.splitEntry(t,e.touchingEntry,n)}else n.push(t)}splitEntry(e,t,n){let r=e.span,i=t.span;r.start<i.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:r.start,end:i.start}},n),r.end>i.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:i.end,end:r.end}},n)}insertEntryAt(e,t){let{entriesByLevel:n,levelCoords:r}=this;-1===t.lateral?(dV(r,t.level,t.levelCoord),dV(n,t.level,[e])):dV(n[t.level],t.lateral,e),this.stackCnts[cV(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:n,strictOrder:r,stackCnts:i}=this,s=t.length,a=0,o=-1,l=-1,c=null,u=0;for(let h=0;h<s;h+=1){const s=t[h];if(!r&&s>=a+this.getEntryThickness(e))break;let d,f=n[h],p=fV(f,e.span.start,lV),m=p[0]+p[1];for(;(d=f[m])&&d.span.start<e.span.end;){let e=s+this.getEntryThickness(d);e>a&&(a=e,c=d,o=h,l=m),e===a&&(u=Math.max(u,i[cV(d)]+1)),m+=1}}let h=0;if(c)for(h=o+1;h<s&&t[h]<a;)h+=1;let d=-1;return h<s&&t[h]===a&&(d=fV(n[h],e.span.end,lV)[0]),{touchingLevel:o,touchingLateral:l,touchingEntry:c,stackCnt:u,levelCoord:a,level:h,lateral:d}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,n=e.length,r=[];for(let i=0;i<n;i+=1){let n=e[i],s=t[i];for(let e of n)r.push(Object.assign(Object.assign({},e),{thickness:this.getEntryThickness(e),levelCoord:s}))}return r}}function lV(e){return e.span.end}function cV(e){return e.index+":"+e.span.start}function uV(e,t){return{start:Math.min(e.start,t.start),end:Math.max(e.end,t.end)}}function hV(e,t){let n=Math.max(e.start,t.start),r=Math.min(e.end,t.end);return n<r?{start:n,end:r}:null}function dV(e,t,n){e.splice(t,0,n)}function fV(e,t,n){let r=0,i=e.length;if(!i||t<n(e[r]))return[0,0];if(t>n(e[i-1]))return[i,0];for(;r<i;){let s=Math.floor(r+(i-r)/2),a=n(e[s]);if(t<a)i=s;else{if(!(t>a))return[s,1];r=s+1}}return[r,0]}Boolean;const pV="fc-col-header-cell";function mV(e){return e.text}class gV extends bj{render(){let{dateEnv:e,options:t,theme:n,viewApi:r}=this.context,{props:i}=this,{date:s,dateProfile:a}=i,o=Jz(s,i.todayRange,null,a),l=[pV].concat(Qz(o,n)),c=e.format(s,i.dayHeaderFormat),u=!o.isDisabled&&i.colCnt>1?nV(this.context,s):{},h=e.toDate(s);e.namedTimeZoneImpl&&(h=lF(h,36e5));let d=Object.assign(Object.assign(Object.assign({date:h,view:r},i.extraRenderProps),{text:c}),o);return gU(Aj,{elTag:"th",elClasses:l,elAttrs:Object.assign({role:"columnheader",colSpan:i.colSpan,"data-date":o.isDisabled?void 0:wF(s)},i.extraDataAttrs),renderProps:d,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:mV,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},e=>gU("div",{className:"fc-scrollgrid-sync-inner"},!o.isDisabled&&gU(e,{elTag:"a",elAttrs:u,elClasses:["fc-col-header-cell-cushion",i.isSticky&&"fc-sticky"]})))}}const vV=HF({weekday:"long"});class _V extends bj{render(){let{props:e}=this,{dateEnv:t,theme:n,viewApi:r,options:i}=this.context,s=oF(new Date(2592e5),e.dow),a={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},o=t.format(s,e.dayHeaderFormat),l=Object.assign(Object.assign(Object.assign(Object.assign({date:s},a),{view:r}),e.extraRenderProps),{text:o});return gU(Aj,{elTag:"th",elClasses:[pV,...Qz(a,n),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:l,generatorName:"dayHeaderContent",customGenerator:i.dayHeaderContent,defaultGenerator:mV,classNameGenerator:i.dayHeaderClassNames,didMount:i.dayHeaderDidMount,willUnmount:i.dayHeaderWillUnmount},n=>gU("div",{className:"fc-scrollgrid-sync-inner"},gU(n,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(s,vV)}})))}}class bV extends bj{constructor(){super(...arguments),this.createDayHeaderFormatter=EF(yV)}render(){let{context:e}=this,{dates:t,dateProfile:n,datesRepDistinctDays:r,renderIntro:i}=this.props,s=this.createDayHeaderFormatter(e.options.dayHeaderFormat,r,t.length);return gU(Wz,{unit:"day"},(e,a)=>gU("tr",{role:"row"},i&&i("day"),t.map(e=>r?gU(gV,{key:e.toISOString(),date:e,dateProfile:n,todayRange:a,colCnt:t.length,dayHeaderFormat:s}):gU(_V,{key:e.getUTCDay(),dow:e.getUTCDay(),dayHeaderFormat:s}))))}}function yV(e,t,n){return e||function(e,t){return HF(!e||t>10?{weekday:"short"}:t>1?{weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}:{weekday:"long"})}(t,n)}class wV{constructor(e,t){let n=e.start,{end:r}=e,i=[],s=[],a=-1;for(;n<r;)t.isHiddenDay(n)?i.push(a+.5):(a+=1,i.push(a),s.push(n)),n=oF(n,1);this.dates=s,this.indices=i,this.cnt=s.length}sliceRange(e){let t=this.getDateDayIndex(e.start),n=this.getDateDayIndex(oF(e.end,-1)),r=Math.max(0,t),i=Math.min(this.cnt-1,n);return r=Math.ceil(r),i=Math.floor(i),r<=i?{firstIndex:r,lastIndex:i,isStart:t===r,isEnd:n===i}:null}getDateDayIndex(e){let{indices:t}=this,n=Math.floor(cF(this.dates[0],e));return n<0?t[0]-1:n>=t.length?t[t.length-1]+1:t[n]}}class SV{constructor(e,t){let n,r,i,{dates:s}=e;if(t){for(r=s[0].getUTCDay(),n=1;n<s.length&&s[n].getUTCDay()!==r;n+=1);i=Math.ceil(s.length/n)}else i=1,n=s.length;this.rowCnt=i,this.colCnt=n,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let n=[];for(let e=0;e<this.colCnt;e+=1)n.push(this.buildCell(t,e));e.push(n)}return e}buildCell(e,t){let n=this.daySeries.dates[e*this.colCnt+t];return{key:n.toISOString(),date:n}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,n=this.daySeries.sliceRange(e),r=[];if(n){let{firstIndex:e,lastIndex:i}=n,s=e;for(;s<=i;){let a=Math.floor(s/t),o=Math.min((a+1)*t,i+1);r.push({row:a,firstCol:s%t,lastCol:(o-1)%t,isStart:n.isStart&&s===e,isEnd:n.isEnd&&o-1===i}),s=o}}return r}}class xV{constructor(){this.sliceBusinessHours=EF(this._sliceBusinessHours),this.sliceDateSelection=EF(this._sliceDateSpan),this.sliceEventStore=EF(this._sliceEventStore),this.sliceEventDrag=EF(this._sliceInteraction),this.sliceEventResize=EF(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,n,r,...i){let{eventUiBases:s}=e,a=this.sliceEventStore(e.eventStore,s,t,n,...i);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,n,s,r,...i),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,n,r,...i),fgEventSegs:a.fg,bgEventSegs:a.bg,eventDrag:this.sliceEventDrag(e.eventDrag,s,t,n,...i),eventResize:this.sliceEventResize(e.eventResize,s,t,n,...i),eventSelection:e.eventSelection}}sliceNowDate(e,t,n,r,...i){return this._sliceDateSpan({range:{start:e,end:lF(e,1)},allDay:!1},t,n,{},r,...i)}_sliceBusinessHours(e,t,n,r,...i){return e?this._sliceEventStore(Hj(e,EV(t,Boolean(n)),r),{},t,n,...i).bg:[]}_sliceEventStore(e,t,n,r,...i){if(e){let s=wz(e,t,EV(n,Boolean(r)),r);return{bg:this.sliceEventRanges(s.bg,i),fg:this.sliceEventRanges(s.fg,i)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,n,r,...i){if(!e)return null;let s=wz(e.mutatedEvents,t,EV(n,Boolean(r)),r);return{segs:this.sliceEventRanges(s.fg,i),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,n,r,i,...s){if(!e)return[];let a=EV(t,Boolean(n)),o=Ij(e.range,a);if(o){let t=function(e,t,n){let r=Wj({editable:!1},n),i=Kj(r.refined,r.extra,"",e.allDay,!0,n);return{def:i,ui:Cz(i,t),instance:Uj(i.defId,e.range),range:e.range,isStart:!0,isEnd:!0}}(e=Object.assign(Object.assign({},e),{range:o}),r,i),n=this.sliceRange(e.range,...s);for(let e of n)e.eventRange=t;return n}return[]}sliceEventRanges(e,t){let n=[];for(let r of e)n.push(...this.sliceEventRange(r,t));return n}sliceEventRange(e,t){let n=e.range;this.forceDayIfListItem&&"list-item"===e.ui.display&&(n={start:n.start,end:oF(n.start,1)});let r=this.sliceRange(n,...t);for(let t of r)t.eventRange=e,t.isStart=e.isStart&&t.isStart,t.isEnd=e.isEnd&&t.isEnd;return r}}function EV(e,t){let n=e.activeRange;return t?n:{start:lF(n.start,e.slotMinTime.milliseconds),end:lF(n.end,e.slotMaxTime.milliseconds-864e5)}}const CV=/^(visible|hidden)$/;class AV extends bj{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,yj(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:n}=e,r=t&&n,i=["fc-scroller"];return t&&(n?i.push("fc-scroller-liquid-absolute"):i.push("fc-scroller-liquid")),gU("div",{ref:this.handleEl,className:i.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:r&&-(e.overcomeLeft||0)||"",right:r&&-(e.overcomeRight||0)||"",bottom:r&&-(e.overcomeBottom||0)||"",marginLeft:!r&&-(e.overcomeLeft||0)||"",marginRight:!r&&-(e.overcomeRight||0)||"",marginBottom:!r&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(CV.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:n}=e;for(let e=0;e<n.length;e+=1)if(n[e].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(CV.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:n}=e;for(let e=0;e<n.length;e+=1)if(n[e].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return CV.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return CV.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}}class MV{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(e,t)=>{let{depths:n,currentMap:r}=this,i=!1,s=!1;null!==e?(i=t in r,r[t]=e,n[t]=(n[t]||0)+1,s=!0):(n[t]-=1,n[t]||(delete r[t],delete this.callbackMap[t],i=!0)),this.masterCallback&&(i&&this.masterCallback(null,String(t)),s&&this.masterCallback(e,String(t)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=t=>{this.handleValue(t,String(e))}),t}collect(e,t,n){return function(e,t=0,n,r=1){let i=[];null==n&&(n=Object.keys(e).length);for(let s=t;s<n;s+=r){let t=e[s];void 0!==t&&i.push(t)}return i}(this.currentMap,e,t,n)}getAll(){return nj(this.currentMap)}}function kV(e,t){return e.liquid&&t.liquid}function TV(e,t){return iF(e,t,rj)}function RV(e,t){let n=[];for(let r of e){let e=r.span||1;for(let i=0;i<e;i+=1)n.push(gU("col",{style:{width:"shrink"===r.width?PV(t):r.width||"",minWidth:r.minWidth||""}}))}return gU("colgroup",{},...n)}function PV(e){return null==e?4:e}function IV(e,t){let n=["fc-scrollgrid-section",`fc-scrollgrid-section-${e.type}`,e.className];return t&&e.liquid&&null==e.maxHeight&&n.push("fc-scrollgrid-section-liquid"),e.isSticky&&n.push("fc-scrollgrid-section-sticky"),n}function DV(e){return gU("div",{className:"fc-scrollgrid-sticky-shim",style:{width:e.clientWidth,minWidth:e.tableMinWidth}})}function OV(e){let{stickyHeaderDates:t}=e;return null!=t&&"auto"!==t||(t="auto"===e.height||"auto"===e.viewHeight),t}function LV(e){let{stickyFooterScrollbar:t}=e;return null!=t&&"auto"!==t||(t="auto"===e.height||"auto"===e.viewHeight),t}class BV extends bj{constructor(){super(...arguments),this.processCols=EF(e=>e,TV),this.renderMicroColGroup=EF(RV),this.scrollerRefs=new MV,this.scrollerElRefs=new MV(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:n}=this,r=e.sections||[],i=this.processCols(e.cols),s=this.renderMicroColGroup(i,t.shrinkWidth),a=function(e,t){let n=["fc-scrollgrid",t.theme.getClass("table")];return e&&n.push("fc-scrollgrid-liquid"),n}(e.liquid,n);e.collapsibleWidth&&a.push("fc-scrollgrid-collapsible");let o,l=r.length,c=0,u=[],h=[],d=[];for(;c<l&&"header"===(o=r[c]).type;)u.push(this.renderSection(o,s,!0)),c+=1;for(;c<l&&"body"===(o=r[c]).type;)h.push(this.renderSection(o,s,!1)),c+=1;for(;c<l&&"footer"===(o=r[c]).type;)d.push(this.renderSection(o,s,!0)),c+=1;let f=!jz();const p={role:"rowgroup"};return gU("table",{role:"grid",className:a.join(" "),style:{height:e.height}},Boolean(!f&&u.length)&&gU("thead",p,...u),Boolean(!f&&h.length)&&gU("tbody",p,...h),Boolean(!f&&d.length)&&gU("tfoot",p,...d),f&&gU("tbody",p,...u,...h,...d))}renderSection(e,t,n){return"outerContent"in e?gU(_U,{key:e.key},e.outerContent):gU("tr",{key:e.key,role:"presentation",className:IV(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,n))}renderChunkTd(e,t,n,r){if("outerContent"in n)return n.outerContent;let{props:i}=this,{forceYScrollbars:s,scrollerClientWidths:a,scrollerClientHeights:o}=this.state,l=function(e,t){return null!=t.maxHeight||kV(e,t)}(i,e),c=kV(i,e),u=i.liquid?s?"scroll":l?"auto":"hidden":"visible",h=e.key,d=function(e,t,n,r){let{expandRows:i}=n;return"function"==typeof t.content?t.content(n):gU("table",{role:"presentation",className:[t.tableClassName,e.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:n.tableMinWidth,width:n.clientWidth,height:i?n.clientHeight:""}},n.tableColGroupNode,gU(r?"thead":"tbody",{role:"presentation"},"function"==typeof t.rowContent?t.rowContent(n):t.rowContent))}(e,n,{tableColGroupNode:t,tableMinWidth:"",clientWidth:i.collapsibleWidth||void 0===a[h]?null:a[h],clientHeight:void 0!==o[h]?o[h]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},r);return gU(r?"th":"td",{ref:n.elRef,role:"presentation"},gU("div",{className:"fc-scroller-harness"+(c?" fc-scroller-harness-liquid":"")},gU(AV,{ref:this.scrollerRefs.createRef(h),elRef:this.scrollerElRefs.createRef(h),overflowY:u,overflowX:i.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:c,liquidIsAbsolute:!0},d)))}_handleScrollerEl(e,t){let n=function(e,t){for(let n of e)if(n.key===t)return n;return null}(this.props.sections,t);n&&yj(n.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return function(e){for(let t of e)if("shrink"===t.width)return!0;return!1}(this.props.cols)?function(e){let t=function(e){let t=e instanceof HTMLElement?[e]:e,n=[];for(let e=0;e<t.length;e+=1){let r=t[e].querySelectorAll(".fc-scrollgrid-shrink");for(let e=0;e<r.length;e+=1)n.push(r[e])}return n}(e),n=0;for(let e of t)n=Math.max(n,$H(e));return Math.ceil(n)}(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=(rV||(rV=function(){let e=document.createElement("div");e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",document.body.appendChild(e);let t=function(e){return{x:e.offsetHeight-e.clientHeight,y:e.offsetWidth-e.clientWidth}}(e);return document.body.removeChild(e),t}()),rV),{scrollerRefs:t,scrollerElRefs:n}=this,r=!1,i={},s={};for(let e in t.currentMap){let n=t.currentMap[e];if(n&&n.needsYScrolling()){r=!0;break}}for(let t of this.props.sections){let a=t.key,o=n.currentMap[a];if(o){let t=o.parentNode;i[a]=Math.floor(t.getBoundingClientRect().width-(r?e.y:0)),s[a]=Math.floor(t.getBoundingClientRect().height)}}return{forceYScrollbars:r,scrollerClientWidths:i,scrollerClientHeights:s}}}BV.addStateEquality({scrollerClientWidths:rj,scrollerClientHeights:rj});class NV extends bj{constructor(){super(...arguments),this.buildPublicEvent=EF((e,t,n)=>new _z(e,t,n)),this.handleEl=e=>{this.el=e,yj(this.props.elRef,e),e&&Sz(e,this.props.seg)}}render(){const{props:e,context:t}=this,{options:n}=t,{seg:r}=e,{eventRange:i}=r,{ui:s}=i,a={event:this.buildPublicEvent(t,i.def,i.instance),view:t.viewApi,timeText:e.timeText,textColor:s.textColor,backgroundColor:s.backgroundColor,borderColor:s.borderColor,isDraggable:!e.disableDragging&&kz(r,t),isStartResizable:!e.disableResizing&&Tz(r,t),isEndResizable:!e.disableResizing&&Rz(r),isMirror:Boolean(e.isDragging||e.isResizing||e.isDateSelecting),isStart:Boolean(r.isStart),isEnd:Boolean(r.isEnd),isPast:Boolean(e.isPast),isFuture:Boolean(e.isFuture),isToday:Boolean(e.isToday),isSelected:Boolean(e.isSelected),isDragging:Boolean(e.isDragging),isResizing:Boolean(e.isResizing)};return gU(Aj,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...Dz(a),...r.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:a,generatorName:"eventContent",customGenerator:n.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:n.eventClassNames,didMount:n.eventDidMount,willUnmount:n.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&Sz(this.el,this.props.seg)}}class UV extends bj{render(){let{props:e,context:t}=this,{options:n}=t,{seg:r}=e,{ui:i}=r.eventRange,s=Pz(r,n.eventTimeFormat||e.defaultTimeFormat,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return gU(NV,Object.assign({},e,{elTag:"a",elStyle:{borderColor:i.borderColor,backgroundColor:i.backgroundColor},elAttrs:Lz(r,t),defaultGenerator:HV,timeText:s}),(e,t)=>gU(_U,null,gU(e,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:t.textColor}}),Boolean(t.isStartResizable)&&gU("div",{className:"fc-event-resizer fc-event-resizer-start"}),Boolean(t.isEndResizable)&&gU("div",{className:"fc-event-resizer fc-event-resizer-end"})))}}function HV(e){return gU("div",{className:"fc-event-main-frame"},e.timeText&&gU("div",{className:"fc-event-time"},e.timeText),gU("div",{className:"fc-event-title-container"},gU("div",{className:"fc-event-title fc-sticky"},e.event.title||gU(_U,null," "))))}UV.addPropsEquality({seg:rj});const FV=e=>gU(gj.Consumer,null,t=>{let{options:n}=t,r={isAxis:e.isAxis,date:t.dateEnv.toDate(e.date),view:t.viewApi};return gU(Aj,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:e.elClasses,elStyle:e.elStyle,renderProps:r,generatorName:"nowIndicatorContent",customGenerator:n.nowIndicatorContent,classNameGenerator:n.nowIndicatorClassNames,didMount:n.nowIndicatorDidMount,willUnmount:n.nowIndicatorWillUnmount},e.children)}),jV=HF({day:"numeric"});class zV extends bj{constructor(){super(...arguments),this.refineRenderProps=CF(GV)}render(){let{props:e,context:t}=this,{options:n}=t,r=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:n.monthStartFormat});return gU(Aj,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),r.isDisabled?{}:{"data-date":wF(e.date)}),elClasses:[...Qz(r,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:r,generatorName:"dayCellContent",customGenerator:n.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:r.isDisabled?void 0:n.dayCellClassNames,didMount:n.dayCellDidMount,willUnmount:n.dayCellWillUnmount},e.children)}}function VV(e){return Boolean(e.dayCellContent||Sj("dayCellContent",e))}function GV(e){let{date:t,dateEnv:n,dateProfile:r,isMonthStart:i}=e,s=Jz(t,e.todayRange,null,r),a=e.showDayNumber?n.format(t,i?e.monthStartFormat:jV):"";return Object.assign(Object.assign(Object.assign({date:n.toDate(t),view:e.viewApi},s),{isMonthStart:i,dayNumberText:a}),e.extraRenderProps)}class WV extends bj{render(){let{props:e}=this,{seg:t}=e;return gU(NV,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:qV,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}}function qV(e){let{title:t}=e.event;return t&&gU("div",{className:"fc-event-title"},e.event.title)}function KV(e){return gU("div",{className:`fc-${e}`})}const $V=e=>gU(gj.Consumer,null,t=>{let{dateEnv:n,options:r}=t,{date:i}=e,s=r.weekNumberFormat||e.defaultFormat,a={num:n.computeWeekNumber(i),text:n.format(i,s),date:i};return gU(Aj,{elRef:e.elRef,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:e.elClasses,elStyle:e.elStyle,renderProps:a,generatorName:"weekNumberContent",customGenerator:r.weekNumberContent,defaultGenerator:XV,classNameGenerator:r.weekNumberClassNames,didMount:r.weekNumberDidMount,willUnmount:r.weekNumberWillUnmount},e.children)});function XV(e){return e.text}class YV extends bj{constructor(){super(...arguments),this.state={titleId:UH()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&yj(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{const t=function(e){var t,n;return null!==(n=null===(t=e.composedPath)||void 0===t?void 0:t.call(e)[0])&&void 0!==n?n:e.target}(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{"Escape"===e.key&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:n,state:r}=this,i=["fc-popover",e.getClass("popover")].concat(n.extraClassNames||[]);return function(e,t){var n=gU(fH,{__v:e,i:t});return n.containerInfo=t,n}(gU("div",Object.assign({},n.extraAttrs,{id:n.id,className:i.join(" "),"aria-labelledby":r.titleId,ref:this.handleRootEl}),gU("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},gU("span",{className:"fc-popover-title",id:r.titleId},n.title),gU("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),gU("div",{className:"fc-popover-body "+e.getClass("popoverContent")},n.children)),n.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:n}=this.props,{rootEl:r}=this,i=function(e){let t=function(e){let t=[];for(;e instanceof HTMLElement;){let n=window.getComputedStyle(e);if("fixed"===n.position)break;/(auto|scroll)/.test(n.overflow+n.overflowY+n.overflowX)&&t.push(e),e=e.parentNode}return t}(e),n=e.getBoundingClientRect();for(let e of t){let t=$z(n,e.getBoundingClientRect());if(!t)return null;n=t}return n}(t);if(i){let s=r.getBoundingClientRect(),a=n?DH(t,".fc-scrollgrid").getBoundingClientRect().top:i.top,o=e?i.right-s.width:i.left;a=Math.max(a,10),o=Math.min(o,document.documentElement.clientWidth-10-s.width),o=Math.max(o,10);let l=r.offsetParent.getBoundingClientRect();!function(e,t){for(let n in t)BH(e,n,t[n])}(r,{top:a-l.top,left:o-l.left})}}}class ZV extends aV{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:n}=this,{startDate:r,todayRange:i,dateProfile:s}=n,a=t.format(r,e.dayPopoverFormat);return gU(zV,{elRef:this.handleRootEl,date:r,dateProfile:s,todayRange:i},(t,r,i)=>gU(YV,{elRef:i.ref,id:n.id,title:a,extraClassNames:["fc-more-popover"].concat(i.className||[]),extraAttrs:i,parentEl:n.parentEl,alignmentEl:n.alignmentEl,alignGridTop:n.alignGridTop,onClose:n.onClose},VV(e)&&gU(t,{elTag:"div",elClasses:["fc-more-popover-misc"]}),n.children))}queryHit(e,t,n,r){let{rootEl:i,props:s}=this;return e>=0&&e<n&&t>=0&&t<r?{dateProfile:s.dateProfile,dateSpan:Object.assign({allDay:!s.forceTimed,range:{start:s.startDate,end:s.endDate}},s.extraDateSpan),dayEl:i,rect:{left:0,top:0,right:n,bottom:r},layer:1}:null}}class JV extends bj{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:UH()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&yj(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:n}=this,{moreLinkClick:r}=n.options,i=eG(t).start;function s(e){let{def:t,instance:r,range:i}=e.eventRange;return{event:new _z(n,t,r),start:n.dateEnv.toDate(i.start),end:n.dateEnv.toDate(i.end),isStart:e.isStart,isEnd:e.isEnd}}"function"==typeof r&&(r=r({date:i,allDay:Boolean(t.allDayDate),allSegs:t.allSegs.map(s),hiddenSegs:t.hiddenSegs.map(s),jsEvent:e,view:n.viewApi})),r&&"popover"!==r?"string"==typeof r&&n.calendarApi.zoomTo(i,r):this.setState({isPopoverOpen:!0})},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return gU(gj.Consumer,null,n=>{let{viewApi:r,options:i,calendarApi:s}=n,{moreLinkText:a}=i,{moreCnt:o}=e,l=eG(e),c="function"==typeof a?a.call(s,o):`+${o} ${a}`,u=qH(i.moreLinkHint,[o],c),h={num:o,shortText:`+${o}`,text:c,view:r};return gU(_U,null,Boolean(e.moreCnt)&&gU(Aj,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),FH(this.handleClick)),{title:u,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:h,generatorName:"moreLinkContent",customGenerator:i.moreLinkContent,defaultGenerator:e.defaultGenerator||QV,classNameGenerator:i.moreLinkClassNames,didMount:i.moreLinkDidMount,willUnmount:i.moreLinkWillUnmount},e.children),t.isPopoverOpen&&gU(ZV,{id:t.popoverId,startDate:l.start,endDate:l.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=DH(this.linkEl,".fc-view-harness"))}}function QV(e){return e.text}function eG(e){if(e.allDayDate)return{start:e.allDayDate,end:oF(e.allDayDate,1)};let{hiddenSegs:t}=e;return{start:tG(t),end:(n=t,n.reduce(rG).eventRange.range.end)};var n}function tG(e){return e.reduce(nG).eventRange.range.start}function nG(e,t){return e.eventRange.range.start<t.eventRange.range.start?e:t}function rG(e,t){return e.eventRange.range.end>t.eventRange.range.end?e:t}const iG=[],sG={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},aG=Object.assign(Object.assign({},sG),{buttonHints:{prev:"Previous $0",next:"Next $0",today:(e,t)=>"day"===t?"Today":`This ${e}`},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint:e=>`Show ${e} more event${1===e?"":"s"}`});function oG(e){let t=e.length>0?e[0].code:"en",n=iG.concat(e),r={en:aG};for(let e of n)r[e.code]=e;return{map:r,defaultCode:t}}function lG(e,t){return"object"!=typeof e||Array.isArray(e)?function(e,t){let n=[].concat(e||[]),r=function(e,t){for(let n=0;n<e.length;n+=1){let r=e[n].toLocaleLowerCase().split("-");for(let e=r.length;e>0;e-=1){let n=r.slice(0,e).join("-");if(t[n])return t[n]}}return null}(n,t)||aG;return cG(e,n,r)}(e,t):cG(e.code,[e.code],e)}function cG(e,t,n){let r=JF([sG,n],["buttonText"]);delete r.code;let{week:i}=r;return delete r.week,{codeArg:e,codes:t,week:i,simpleNumberFormat:new Intl.NumberFormat(e),options:r}}function uG(e){return{id:VH(),name:e.name,premiumReleaseDate:e.premiumReleaseDate?new Date(e.premiumReleaseDate):void 0,deps:e.deps||[],reducers:e.reducers||[],isLoadingFuncs:e.isLoadingFuncs||[],contextInit:[].concat(e.contextInit||[]),eventRefiners:e.eventRefiners||{},eventDefMemberAdders:e.eventDefMemberAdders||[],eventSourceRefiners:e.eventSourceRefiners||{},isDraggableTransformers:e.isDraggableTransformers||[],eventDragMutationMassagers:e.eventDragMutationMassagers||[],eventDefMutationAppliers:e.eventDefMutationAppliers||[],dateSelectionTransformers:e.dateSelectionTransformers||[],datePointTransforms:e.datePointTransforms||[],dateSpanTransforms:e.dateSpanTransforms||[],views:e.views||{},viewPropsTransformers:e.viewPropsTransformers||[],isPropsValid:e.isPropsValid||null,externalDefTransforms:e.externalDefTransforms||[],viewContainerAppends:e.viewContainerAppends||[],eventDropTransformers:e.eventDropTransformers||[],componentInteractions:e.componentInteractions||[],calendarInteractions:e.calendarInteractions||[],themeClasses:e.themeClasses||{},eventSourceDefs:e.eventSourceDefs||[],cmdFormatter:e.cmdFormatter,recurringTypes:e.recurringTypes||[],namedTimeZonedImpl:e.namedTimeZonedImpl,initialView:e.initialView||"",elementDraggingImpl:e.elementDraggingImpl,optionChangeHandlers:e.optionChangeHandlers||{},scrollGridImpl:e.scrollGridImpl||null,listenerRefiners:e.listenerRefiners||{},optionRefiners:e.optionRefiners||{},propSetHandlers:e.propSetHandlers||{}}}function hG(e,t){return{premiumReleaseDate:(n=e.premiumReleaseDate,r=t.premiumReleaseDate,void 0===n?r:void 0===r?n:new Date(Math.max(n.valueOf(),r.valueOf()))),reducers:e.reducers.concat(t.reducers),isLoadingFuncs:e.isLoadingFuncs.concat(t.isLoadingFuncs),contextInit:e.contextInit.concat(t.contextInit),eventRefiners:Object.assign(Object.assign({},e.eventRefiners),t.eventRefiners),eventDefMemberAdders:e.eventDefMemberAdders.concat(t.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},e.eventSourceRefiners),t.eventSourceRefiners),isDraggableTransformers:e.isDraggableTransformers.concat(t.isDraggableTransformers),eventDragMutationMassagers:e.eventDragMutationMassagers.concat(t.eventDragMutationMassagers),eventDefMutationAppliers:e.eventDefMutationAppliers.concat(t.eventDefMutationAppliers),dateSelectionTransformers:e.dateSelectionTransformers.concat(t.dateSelectionTransformers),datePointTransforms:e.datePointTransforms.concat(t.datePointTransforms),dateSpanTransforms:e.dateSpanTransforms.concat(t.dateSpanTransforms),views:Object.assign(Object.assign({},e.views),t.views),viewPropsTransformers:e.viewPropsTransformers.concat(t.viewPropsTransformers),isPropsValid:t.isPropsValid||e.isPropsValid,externalDefTransforms:e.externalDefTransforms.concat(t.externalDefTransforms),viewContainerAppends:e.viewContainerAppends.concat(t.viewContainerAppends),eventDropTransformers:e.eventDropTransformers.concat(t.eventDropTransformers),calendarInteractions:e.calendarInteractions.concat(t.calendarInteractions),componentInteractions:e.componentInteractions.concat(t.componentInteractions),themeClasses:Object.assign(Object.assign({},e.themeClasses),t.themeClasses),eventSourceDefs:e.eventSourceDefs.concat(t.eventSourceDefs),cmdFormatter:t.cmdFormatter||e.cmdFormatter,recurringTypes:e.recurringTypes.concat(t.recurringTypes),namedTimeZonedImpl:t.namedTimeZonedImpl||e.namedTimeZonedImpl,initialView:e.initialView||t.initialView,elementDraggingImpl:e.elementDraggingImpl||t.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},e.optionChangeHandlers),t.optionChangeHandlers),scrollGridImpl:t.scrollGridImpl||e.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},e.listenerRefiners),t.listenerRefiners),optionRefiners:Object.assign(Object.assign({},e.optionRefiners),t.optionRefiners),propSetHandlers:Object.assign(Object.assign({},e.propSetHandlers),t.propSetHandlers)};var n,r}class dG extends hj{}function fG(e,t,n,r){if(t[e])return t[e];let i=function(e,t,n,r){let i=n[e],s=r[e],a=e=>i&&null!==i[e]?i[e]:s&&null!==s[e]?s[e]:null,o=a("component"),l=a("superType"),c=null;if(l){if(l===e)throw new Error("Can't have a custom view type that references itself");c=fG(l,t,n,r)}return!o&&c&&(o=c.component),o?{type:e,component:o,defaults:Object.assign(Object.assign({},c?c.defaults:{}),i?i.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),s?s.rawOptions:{})}:null}(e,t,n,r);return i&&(t[e]=i),i}function pG(e){return ej(e,mG)}function mG(e){let t="function"==typeof e?{component:e}:e,{component:n}=t;return t.content?n=gG(t):!n||n.prototype instanceof bj||(n=gG(Object.assign(Object.assign({},t),{content:n}))),{superType:t.type,component:n,rawOptions:t}}function gG(e){return t=>gU(gj.Consumer,null,n=>gU(Aj,{elTag:"div",elClasses:Tj(n.viewSpec),renderProps:Object.assign(Object.assign({},t),{nextDayThreshold:n.options.nextDayThreshold}),generatorName:void 0,customGenerator:e.content,classNameGenerator:e.classNames,didMount:e.didMount,willUnmount:e.willUnmount}))}function vG(e,t,n,r){let i=pG(e),s=pG(t.views),a=function(e,t){let n,r={};for(n in e)fG(n,r,e,t);for(n in t)fG(n,r,e,t);return r}(i,s);return ej(a,e=>function(e,t,n,r,i){let s=e.overrides.duration||e.defaults.duration||r.duration||n.duration,a=null,o="",l="",c={};if(s&&(a=function(e){let t=JSON.stringify(e),n=_G[t];return void 0===n&&(n=ZH(e),_G[t]=n),n}(s),a)){let e=rF(a);o=e.unit,1===e.value&&(l=o,c=t[o]?t[o].rawOptions:{})}let u=t=>{let n=t.buttonText||{},r=e.defaults.buttonTextKey;return null!=r&&null!=n[r]?n[r]:null!=n[e.type]?n[e.type]:null!=n[l]?n[l]:null},h=t=>{let n=t.buttonHints||{},r=e.defaults.buttonTextKey;return null!=r&&null!=n[r]?n[r]:null!=n[e.type]?n[e.type]:null!=n[l]?n[l]:null};return{type:e.type,component:e.component,duration:a,durationUnit:o,singleUnit:l,optionDefaults:e.defaults,optionOverrides:Object.assign(Object.assign({},c),e.overrides),buttonTextOverride:u(r)||u(n)||e.overrides.buttonText,buttonTextDefault:u(i)||e.defaults.buttonText||u(jF)||e.type,buttonTitleOverride:h(r)||h(n)||e.overrides.buttonHint,buttonTitleDefault:h(i)||e.defaults.buttonHint||h(jF)}}(e,s,t,n,r))}dG.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"},dG.prototype.baseIconClass="fc-icon",dG.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"},dG.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"},dG.prototype.iconOverrideOption="buttonIcons",dG.prototype.iconOverrideCustomButtonOption="icon",dG.prototype.iconOverridePrefix="fc-icon-";let _G={};function bG(e){for(let t in e)if(e[t].isFetching)return!0;return!1}function yG(e,t,n,r){let i={};for(let e of t)i[e.sourceId]=e;return n&&(i=wG(i,n,r)),Object.assign(Object.assign({},e),i)}function wG(e,t,n){return SG(e,QF(e,e=>function(e,t,n){return CG(e,n)?!n.options.lazyFetching||!e.fetchRange||e.isFetching||t.start<e.fetchRange.start||t.end>e.fetchRange.end:!e.latestFetchId}(e,t,n)),t,!1,n)}function SG(e,t,n,r,i){let s={};for(let a in e){let o=e[a];t[a]?s[a]=xG(o,n,r,i):s[a]=o}return s}function xG(e,t,n,r){let{options:i,calendarApi:s}=r,a=r.pluginHooks.eventSourceDefs[e.sourceDefId],o=VH();return a.fetch({eventSource:e,range:t,isRefetch:n,context:r},n=>{let{rawEvents:a}=n;i.eventSourceSuccess&&(a=i.eventSourceSuccess.call(s,a,n.response)||a),e.success&&(a=e.success.call(s,a,n.response)||a),r.dispatch({type:"RECEIVE_EVENTS",sourceId:e.sourceId,fetchId:o,fetchRange:t,rawEvents:a})},n=>{let a=!1;i.eventSourceFailure&&(i.eventSourceFailure.call(s,n),a=!0),e.failure&&(e.failure(n),a=!0),a||console.warn(n.message,n),r.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:e.sourceId,fetchId:o,fetchRange:t,error:n})}),Object.assign(Object.assign({},e),{isFetching:!0,latestFetchId:o})}function EG(e,t){return QF(e,e=>CG(e,t))}function CG(e,t){return!t.pluginHooks.eventSourceDefs[e.sourceDefId].ignoreRange}function AG(e,t){switch(t.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return t.selection;default:return e}}function MG(e,t){switch(t.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return t.eventInstanceId;default:return e}}function kG(e,t){let n;switch(t.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return n=t.state,{affectedEvents:n.affectedEvents,mutatedEvents:n.mutatedEvents,isEvent:n.isEvent};default:return e}}function TG(e,t){let n;switch(t.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return n=t.state,{affectedEvents:n.affectedEvents,mutatedEvents:n.mutatedEvents,isEvent:n.isEvent};default:return e}}function RG(e,t,n,r,i){return{header:e.headerToolbar?PG(e.headerToolbar,e,t,n,r,i):null,footer:e.footerToolbar?PG(e.footerToolbar,e,t,n,r,i):null}}function PG(e,t,n,r,i,s){let a={},o=[],l=!1;for(let c in e){let u=IG(e[c],t,n,r,i,s);a[c]=u.widgets,o.push(...u.viewsWithButtons),l=l||u.hasTitle}return{sectionWidgets:a,viewsWithButtons:o,hasTitle:l}}function IG(e,t,n,r,i,s){let a="rtl"===t.direction,o=t.customButtons||{},l=n.buttonText||{},c=t.buttonText||{},u=n.buttonHints||{},h=t.buttonHints||{},d=e?e.split(" "):[],f=[],p=!1;return{widgets:d.map(e=>e.split(",").map(e=>{if("title"===e)return p=!0,{buttonName:e};let n,d,m,g,v,_;if(n=o[e])m=e=>{n.click&&n.click.call(e.target,e,e.target)},(g=r.getCustomButtonIconClass(n))||(g=r.getIconClass(e,a))||(v=n.text),_=n.hint||n.text;else if(d=i[e]){f.push(e),m=()=>{s.changeView(e)},(v=d.buttonTextOverride)||(g=r.getIconClass(e,a))||(v=d.buttonTextDefault);let n=d.buttonTextOverride||d.buttonTextDefault;_=qH(d.buttonTitleOverride||d.buttonTitleDefault||t.viewHint,[n,e],n)}else if(s[e])if(m=()=>{s[e]()},(v=l[e])||(g=r.getIconClass(e,a))||(v=c[e]),"prevYear"===e||"nextYear"===e){let t="prevYear"===e?"prev":"next";_=qH(u[t]||h[t],[c.year||"year","year"],c[e])}else _=t=>qH(u[e]||h[e],[c[t]||t,t],c[e]);return{buttonName:e,buttonClick:m,buttonIcon:g,buttonText:v,buttonHint:_}})),viewsWithButtons:f,hasTitle:p}}class DG{constructor(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}}const OG={daysOfWeek:YF,startTime:ZH,endTime:ZH,duration:ZH,startRecur:YF,endRecur:YF};function LG(e,t){let n=nj(t.getCurrentData().eventSources);if(1===n.length&&1===e.length&&Array.isArray(n[0]._raw)&&Array.isArray(e[0]))return void t.dispatch({type:"RESET_RAW_EVENTS",sourceId:n[0].sourceId,rawEvents:e[0]});let r=[];for(let t of e){let e=!1;for(let r=0;r<n.length;r+=1)if(n[r]._raw===t){n.splice(r,1),e=!0;break}e||r.push(t)}for(let e of n)t.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:e.sourceId});for(let e of r)t.calendarApi.addEventSource(e)}const BG=[uG({name:"array-event-source",eventSourceDefs:[{ignoreRange:!0,parseMeta:e=>Array.isArray(e.events)?e.events:null,fetch(e,t){t({rawEvents:e.eventSource.meta})}}]}),uG({name:"func-event-source",eventSourceDefs:[{parseMeta:e=>"function"==typeof e.events?e.events:null,fetch(e,t,n){const{dateEnv:r}=e.context;!function(e,n,r){let i=!1,s=function(e){i||(i=!0,t({rawEvents:e}))},a=function(e){i||(i=!0,r(e))},o=e(s,a);o&&"function"==typeof o.then&&o.then(s,a)}(e.eventSource.meta.bind(null,Nz(e.range,r)),0,n)}}]}),uG({name:"json-event-source",eventSourceRefiners:{method:String,extraParams:YF,startParam:String,endParam:String,timeZoneParam:String},eventSourceDefs:[{parseMeta:e=>!e.url||"json"!==e.format&&e.format?null:{url:e.url,format:"json",method:(e.method||"GET").toUpperCase(),extraParams:e.extraParams,startParam:e.startParam,endParam:e.endParam,timeZoneParam:e.timeZoneParam},fetch(e,t,n){const{meta:r}=e.eventSource,i=function(e,t,n){let r,i,s,a,{dateEnv:o,options:l}=n,c={};return r=e.startParam,null==r&&(r=l.startParam),i=e.endParam,null==i&&(i=l.endParam),s=e.timeZoneParam,null==s&&(s=l.timeZoneParam),a="function"==typeof e.extraParams?e.extraParams():e.extraParams||{},Object.assign(c,a),c[r]=o.formatIso(t.start),c[i]=o.formatIso(t.end),"local"!==o.timeZone&&(c[s]=o.timeZone),c}(r,e.range,e.context);(function(e,t,n){const r={method:e=e.toUpperCase()};return"GET"===e?t+=(-1===t.indexOf("?")?"?":"&")+new URLSearchParams(n):(r.body=new URLSearchParams(n),r.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(t,r).then(e=>{if(e.ok)return e.json().then(t=>[t,e],()=>{throw new Hz("Failure parsing JSON",e)});throw new Hz("Request failed",e)})})(r.method,r.url,i).then(([e,n])=>{t({rawEvents:e,response:n})},n)}}]}),uG({name:"simple-recurring-event",recurringTypes:[{parse(e,t){if(e.daysOfWeek||e.startTime||e.endTime||e.startRecur||e.endRecur){let i,s={daysOfWeek:e.daysOfWeek||null,startTime:e.startTime||null,endTime:e.endTime||null,startRecur:e.startRecur?t.createMarker(e.startRecur):null,endRecur:e.endRecur?t.createMarker(e.endRecur):null,dateEnv:t};return e.duration&&(i=e.duration),!i&&e.startTime&&e.endTime&&(n=e.endTime,r=e.startTime,i={years:n.years-r.years,months:n.months-r.months,days:n.days-r.days,milliseconds:n.milliseconds-r.milliseconds}),{allDayGuess:Boolean(!e.startTime&&!e.endTime),duration:i,typeData:s}}var n,r;return null},expand(e,t,n){let r=Ij(t,{start:e.startRecur,end:e.endRecur});return r?function(e,t,n,r,i){let s=e?tj(e):null,a=hF(i.start),o=i.end,l=[];for(t&&(t.milliseconds<0?o=oF(o,1):t.milliseconds>=864e5&&(a=oF(a,-1)));a<o;){let e;s&&!s[a.getUTCDay()]||(e=t?r.add(a,t):a,l.push(r.createMarker(n.toDate(e)))),a=oF(a,1)}return l}(e.daysOfWeek,e.startTime,e.dateEnv,n,r):[]}}],eventRefiners:OG}),uG({name:"change-handler",optionChangeHandlers:{events(e,t){LG([e],t)},eventSources:LG}}),uG({name:"misc",isLoadingFuncs:[e=>bG(e.eventSources)],propSetHandlers:{dateProfile:function(e,t){t.emitter.trigger("datesSet",Object.assign(Object.assign({},Nz(e.activeRange,t.dateEnv)),{view:t.viewApi}))},eventStore:function(e,t){let{emitter:n}=t;n.hasHandlers("eventsSet")&&n.trigger("eventsSet",yz(e,t))}}})];class NG{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new PH(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t,n=[];for(;t=e.shift();)this.runTask(t),n.push(t);this.drained(n)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}}function UG(e,t,n){let r;return r=/^(year|month)$/.test(e.currentRangeUnit)?e.currentRange:e.activeRange,n.formatRange(r.start,r.end,HF(t.titleFormat||function(e){let{currentRangeUnit:t}=e;if("year"===t)return{year:"numeric"};if("month"===t)return{year:"numeric",month:"long"};let n=uF(e.currentRange.start,e.currentRange.end);return null!==n&&n>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}(e)),{isEndExclusive:e.isRangeAllDay,defaultSeparator:t.titleRangeSeparator})}class HG{constructor(){this.resetListeners=new Set}handleInput(e,t){const n=this.dateEnv;if(e!==n&&("function"==typeof t?this.nowFn=t:n||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,n))for(const e of this.resetListeners.values())e()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}}class FG{constructor(e){this.computeCurrentViewData=EF(this._computeCurrentViewData),this.organizeRawLocales=EF(oG),this.buildLocale=EF(lG),this.buildPluginHooks=function(){let e,t=[],n=[];return(r,i)=>(e&&iF(r,t)&&iF(i,n)||(e=function(e,t){let n={},r={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function i(e){for(let t of e){const e=t.name,s=n[e];void 0===s?(n[e]=t.id,i(t.deps),r=hG(r,t)):s!==t.id&&console.warn(`Duplicate plugin '${e}'`)}}return e&&i(e),i(t),r}(r,i)),t=r,n=i,e)}(),this.buildDateEnv=EF(jG),this.buildTheme=EF(zG),this.parseToolbars=EF(RG),this.buildViewSpecs=EF(vG),this.buildDateProfileGenerator=CF(VG),this.buildViewApi=EF(GG),this.buildViewUiProps=CF(KG),this.buildEventUiBySource=EF(WG,rj),this.buildEventUiBases=EF(qG),this.parseContextBusinessHours=CF(XG),this.buildTitle=EF(UG),this.nowManager=new HG,this.emitter=new dz,this.actionRunner=new NG(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=e=>{this.actionRunner.request(e)},this.props=e,this.actionRunner.pause(),this.nowManager=new HG;let t={},n=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),r=n.calendarOptions.initialView||n.pluginHooks.initialView,i=this.computeCurrentViewData(r,n,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(i.options);let s={nowManager:this.nowManager,dateEnv:n.dateEnv,options:n.calendarOptions,pluginHooks:n.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},a=function(e,t,n){let r=e.initialDate;return null!=r?t.createMarker(r):n.getDateMarker()}(n.calendarOptions,n.dateEnv,this.nowManager),o=i.dateProfileGenerator.build(a);Dj(o.activeRange,a)||(a=o.currentRange.start);for(let e of n.pluginHooks.contextInit)e(s);let l=function(e,t,n){let r=t?t.activeRange:null;return yG({},function(e,t){let n=oz(t),r=[].concat(e.eventSources||[]),i=[];e.initialEvents&&r.unshift(e.initialEvents),e.events&&r.unshift(e.events);for(let e of r){let r=az(e,t,n);r&&i.push(r)}return i}(e,n),r,n)}(n.calendarOptions,o,s),c={dynamicOptionOverrides:t,currentViewType:r,currentDate:a,dateProfile:o,businessHours:this.parseContextBusinessHours(s),eventSources:l,eventUiBases:{},eventStore:{defs:{},instances:{}},renderableEventStore:{defs:{},instances:{}},dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(s).selectionConfig},u=Object.assign(Object.assign({},s),c);for(let e of n.pluginHooks.reducers)Object.assign(c,e(null,null,u));$G(c,s)&&this.emitter.trigger("loading",!0),this.state=c,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:n}=this;void 0===t?n.optionOverrides=e:(n.optionOverrides=Object.assign(Object.assign({},n.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(void 0===t||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:n,emitter:r}=this,i=function(e,t){return"SET_OPTION"===t.type?Object.assign(Object.assign({},e),{[t.optionName]:t.rawOptionValue}):e}(n.dynamicOptionOverrides,e),s=this.computeOptionsData(t.optionOverrides,i,t.calendarApi),a=function(e,t){return"CHANGE_VIEW_TYPE"===t.type&&(e=t.viewType),e}(n.currentViewType,e),o=this.computeCurrentViewData(a,s,t.optionOverrides,i);t.calendarApi.currentDataManager=this,r.setThisContext(t.calendarApi),r.setOptions(o.options);let l={nowManager:this.nowManager,dateEnv:s.dateEnv,options:s.calendarOptions,pluginHooks:s.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:r,getCurrentData:this.getCurrentData},{currentDate:c,dateProfile:u}=n;this.data&&this.data.dateProfileGenerator!==o.dateProfileGenerator&&(u=o.dateProfileGenerator.build(c)),c=function(e,t){return"CHANGE_DATE"===t.type?t.dateMarker:e}(c,e),u=function(e,t,n,r){let i;switch(t.type){case"CHANGE_VIEW_TYPE":return r.build(t.dateMarker||n);case"CHANGE_DATE":return r.build(t.dateMarker);case"PREV":if(i=r.buildPrev(e,n),i.isValid)return i;break;case"NEXT":if(i=r.buildNext(e,n),i.isValid)return i}return e}(u,e,c,o.dateProfileGenerator),"PREV"!==e.type&&"NEXT"!==e.type&&Dj(u.currentRange,c)||(c=u.currentRange.start);let h=function(e,t,n,r){let i=n?n.activeRange:null;switch(t.type){case"ADD_EVENT_SOURCES":return yG(e,t.sources,i,r);case"REMOVE_EVENT_SOURCE":return s=e,a=t.sourceId,QF(s,e=>e.sourceId!==a);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?wG(e,i,r):e;case"FETCH_EVENT_SOURCES":return SG(e,t.sourceIds?tj(t.sourceIds):EG(e,r),i,t.isRefetch||!1,r);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return function(e,t,n,r){let i=e[t];return i&&n===i.latestFetchId?Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign({},i),{isFetching:!1,fetchRange:r})}):e}(e,t.sourceId,t.fetchId,t.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return e}var s,a}(n.eventSources,e,u,l),d=function(e,t,n,r,i){switch(t.type){case"RECEIVE_EVENTS":return function(e,t,n,r,i,s){if(t&&n===t.latestFetchId){let n=$j(lz(i,t,s),t,s);return r&&(n=Hj(n,r,s)),Zj(hz(e,t.sourceId),n)}return e}(e,n[t.sourceId],t.fetchId,t.fetchRange,t.rawEvents,i);case"RESET_RAW_EVENTS":return function(e,t,n,r,i){const{defIdMap:s,instanceIdMap:a}=function(e){const{defs:t,instances:n}=e,r={},i={};for(let e in t){const n=t[e],{publicId:i}=n;i&&(r[i]=e)}for(let e in n){const r=t[n[e].defId],{publicId:s}=r;s&&(i[s]=e)}return{defIdMap:r,instanceIdMap:i}}(e);return Hj($j(lz(n,t,i),t,i,!1,s,a),r,i)}(e,n[t.sourceId],t.rawEvents,r.activeRange,i);case"ADD_EVENTS":return function(e,t,n,r){return n&&(t=Hj(t,n,r)),Zj(e,t)}(e,t.eventStore,r?r.activeRange:null,i);case"RESET_EVENTS":return t.eventStore;case"MERGE_EVENTS":return Zj(e,t.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return r?Hj(e,r.activeRange,i):e;case"REMOVE_EVENTS":return function(e,t){let{defs:n,instances:r}=e,i={},s={};for(let e in n)t.defs[e]||(i[e]=n[e]);for(let e in r)!t.instances[e]&&i[r[e].defId]&&(s[e]=r[e]);return{defs:i,instances:s}}(e,t.eventStore);case"REMOVE_EVENT_SOURCE":return hz(e,t.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return Jj(e,e=>!e.sourceId);case"REMOVE_ALL_EVENTS":return{defs:{},instances:{}};default:return e}}(n.eventStore,e,h,u,l),f=bG(h)&&!o.options.progressiveEventRendering&&n.renderableEventStore||d,{eventUiSingleBase:p,selectionConfig:m}=this.buildViewUiProps(l),g=this.buildEventUiBySource(h),v={dynamicOptionOverrides:i,currentViewType:a,currentDate:c,dateProfile:u,eventSources:h,eventStore:d,renderableEventStore:f,selectionConfig:m,eventUiBases:this.buildEventUiBases(f.defs,p,g),businessHours:this.parseContextBusinessHours(l),dateSelection:AG(n.dateSelection,e),eventSelection:MG(n.eventSelection,e),eventDrag:kG(n.eventDrag,e),eventResize:TG(n.eventResize,e)},_=Object.assign(Object.assign({},l),v);for(let t of s.pluginHooks.reducers)Object.assign(v,t(n,e,_));let b=$G(n,l),y=$G(v,l);!b&&y?r.trigger("loading",!0):b&&!y&&r.trigger("loading",!1),this.state=v,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,n=this.data,r=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),i=this.computeCurrentViewData(t.currentViewType,r,e.optionOverrides,t.dynamicOptionOverrides),s=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,i.options,r.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},r),i),t),a=r.pluginHooks.optionChangeHandlers,o=n&&n.calendarOptions,l=r.calendarOptions;if(o&&o!==l){o.timeZone!==l.timeZone&&(t.eventSources=s.eventSources=function(e,t,n){let r=t?t.activeRange:null;return SG(e,EG(e,n),r,!0,n)}(s.eventSources,t.dateProfile,s),t.eventStore=s.eventStore=uz(s.eventStore,n.dateEnv,s.dateEnv),t.renderableEventStore=s.renderableEventStore=uz(s.renderableEventStore,n.dateEnv,s.dateEnv));for(let e in a)-1===this.optionsForHandling.indexOf(e)&&o[e]===l[e]||a[e](l[e],s)}this.optionsForHandling=[],e.onData&&e.onData(s)}computeOptionsData(e,t,n){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:r,pluginHooks:i,localeDefaults:s,availableLocaleData:a,extra:o}=this.processRawCalendarOptions(e,t);YG(o);let l=this.buildDateEnv(r.timeZone,r.locale,r.weekNumberCalculation,r.firstDay,r.weekText,i,a,r.defaultRangeSeparator),c=this.buildViewSpecs(i.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,s),u=this.buildTheme(r,i),h=this.parseToolbars(r,this.stableOptionOverrides,u,c,n);return this.stableCalendarOptionsData={calendarOptions:r,pluginHooks:i,dateEnv:l,viewSpecs:c,theme:u,toolbarConfig:h,localeDefaults:s,availableRawLocales:a.map}}processRawCalendarOptions(e,t){let{locales:n,locale:r}=$F([jF,e,t]),i=this.organizeRawLocales(n),s=i.map,a=this.buildLocale(r||i.defaultCode,s).options,o=this.buildPluginHooks(e.plugins||[],BG),l=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},FF),zF),VF),o.listenerRefiners),o.optionRefiners),c={},u=$F([jF,a,e,t]),h={},d=this.currentCalendarOptionsInput,f=this.currentCalendarOptionsRefined,p=!1;for(let e in u)-1===this.optionsForRefining.indexOf(e)&&(u[e]===d[e]||GF[e]&&e in d&&GF[e](d[e],u[e]))?h[e]=f[e]:l[e]?(h[e]=l[e](u[e]),p=!0):c[e]=d[e];return p&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=h,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:o,availableLocaleData:i,localeDefaults:a,extra:c}}_computeCurrentViewData(e,t,n,r){let i=t.viewSpecs[e];if(!i)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:s,extra:a}=this.processRawViewOptions(i,t.pluginHooks,t.localeDefaults,n,r);return YG(a),this.nowManager.handleInput(t.dateEnv,s.now),{viewSpec:i,options:s,dateProfileGenerator:this.buildDateProfileGenerator({dateProfileGeneratorClass:i.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:i.duration,durationUnit:i.durationUnit,usesMinMaxTime:i.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,showNonCurrentDates:s.showNonCurrentDates,dayCount:s.dayCount,dateAlignment:s.dateAlignment,dateIncrement:s.dateIncrement,hiddenDays:s.hiddenDays,weekends:s.weekends,validRangeInput:s.validRange,visibleRangeInput:s.visibleRange,fixedWeekCount:s.fixedWeekCount}),viewApi:this.buildViewApi(e,this.getCurrentData,t.dateEnv)}}processRawViewOptions(e,t,n,r,i){let s=$F([jF,e.optionDefaults,n,r,e.optionOverrides,i]),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},FF),zF),VF),KF),t.listenerRefiners),t.optionRefiners),o={},l=this.currentViewOptionsInput,c=this.currentViewOptionsRefined,u=!1,h={};for(let e in s)s[e]===l[e]||GF[e]&&GF[e](s[e],l[e])?o[e]=c[e]:(s[e]===this.currentCalendarOptionsInput[e]||GF[e]&&GF[e](s[e],this.currentCalendarOptionsInput[e])?e in this.currentCalendarOptionsRefined&&(o[e]=this.currentCalendarOptionsRefined[e]):a[e]?o[e]=a[e](s[e]):h[e]=s[e],u=!0);return u&&(this.currentViewOptionsInput=s,this.currentViewOptionsRefined=o),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:h}}}function jG(e,t,n,r,i,s,a,o){let l=lG(t||a.defaultCode,a.map);return new uj({calendarSystem:"gregory",timeZone:e,namedTimeZoneImpl:s.namedTimeZonedImpl,locale:l,weekNumberCalculation:n,firstDay:r,weekText:i,cmdFormatter:s.cmdFormatter,defaultSeparator:o})}function zG(e,t){return new(t.themeClasses[e.themeSystem]||dG)(e)}function VG(e){return new(e.dateProfileGeneratorClass||Nj)(e)}function GG(e,t,n){return new DG(e,t,n)}function WG(e){return ej(e,e=>e.ui)}function qG(e,t,n){let r={"":t};for(let t in e){let i=e[t];i.sourceId&&n[i.sourceId]&&(r[t]=n[i.sourceId])}return r}function KG(e){let{options:t}=e;return{eventUiSingleBase:nz({display:t.eventDisplay,editable:t.editable,startEditable:t.eventStartEditable,durationEditable:t.eventDurationEditable,constraint:t.eventConstraint,overlap:"boolean"==typeof t.eventOverlap?t.eventOverlap:void 0,allow:t.eventAllow,backgroundColor:t.eventBackgroundColor,borderColor:t.eventBorderColor,textColor:t.eventTextColor,color:t.eventColor},e),selectionConfig:nz({constraint:t.selectConstraint,overlap:"boolean"==typeof t.selectOverlap?t.selectOverlap:void 0,allow:t.selectAllow},e)}}function $G(e,t){for(let n of t.pluginHooks.isLoadingFuncs)if(n(e))return!0;return!1}function XG(e){return t=e.options.businessHours,n=e,$j(function(e){let t;return t=!0===e?[{}]:Array.isArray(e)?e.filter(e=>e.daysOfWeek):"object"==typeof e&&e?[e]:[],t=t.map(e=>Object.assign(Object.assign({},fz),e)),t}(t),null,n);var t,n}function YG(e,t){for(let n in e)console.warn(`Unknown option '${n}'`+(t?` for view '${t}'`:""))}class ZG extends bj{render(){return gU("div",{className:"fc-toolbar-chunk"},...this.props.widgetGroups.map(e=>this.renderWidgetGroup(e)))}renderWidgetGroup(e){let{props:t}=this,{theme:n}=this.context,r=[],i=!0;for(let s of e){let{buttonName:e,buttonClick:a,buttonText:o,buttonIcon:l,buttonHint:c}=s;if("title"===e)i=!1,r.push(gU("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let i=e===t.activeButton,s=!t.isTodayEnabled&&"today"===e||!t.isPrevEnabled&&"prev"===e||!t.isNextEnabled&&"next"===e,u=[`fc-${e}-button`,n.getClass("button")];i&&u.push(n.getClass("buttonActive")),r.push(gU("button",{type:"button",title:"function"==typeof c?c(t.navUnit):c,disabled:s,"aria-pressed":i,className:u.join(" "),onClick:a},o||(l?gU("span",{className:l,role:"img"}):"")))}}return r.length>1?gU("div",{className:i&&n.getClass("buttonGroup")||""},...r):r[0]}}class JG extends bj{render(){let e,t,{model:n,extraClassName:r}=this.props,i=!1,s=n.sectionWidgets,a=s.center;return s.left?(i=!0,e=s.left):e=s.start,s.right?(i=!0,t=s.right):t=s.end,gU("div",{className:[r||"","fc-toolbar",i?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",e||[]),this.renderSection("center",a||[]),this.renderSection("end",t||[]))}renderSection(e,t){let{props:n}=this;return gU(ZG,{key:e,widgetGroups:t,title:n.title,navUnit:n.navUnit,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled,titleId:n.titleId})}}class QG extends bj{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,yj(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:n}=e,r=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],i="",s="";return n?null!==t.availableWidth?i=t.availableWidth/n:s=1/n*100+"%":i=e.height||"",gU("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:r.join(" "),style:{height:i,paddingBottom:s}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}}class eW extends Vz{constructor(e){super(e),this.handleSegClick=(e,t)=>{let{component:n}=this,{context:r}=n,i=xz(t);if(i&&n.isValidSegDownEl(e.target)){let s=DH(e.target,".fc-event-forced-url"),a=s?s.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:t,event:new _z(n.context,i.eventRange.def,i.eventRange.instance),jsEvent:e,view:r.viewApi}),a&&!e.defaultPrevented&&(window.location.href=a)}},this.destroy=HH(e.el,"click",".fc-event",this.handleSegClick)}}class tW extends Vz{constructor(e){super(e),this.handleEventElRemove=e=>{e===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(e,t)=>{xz(t)&&(this.currentSegEl=t,this.triggerEvent("eventMouseEnter",e,t))},this.handleSegLeave=(e,t)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",e,t))},this.removeHoverListeners=function(e,t,n,r){let i;return HH(e,"mouseover",".fc-event",(e,t)=>{if(t!==i){i=t,n(e,t);let s=e=>{i=null,r(e,t),t.removeEventListener("mouseleave",s)};t.addEventListener("mouseleave",s)}})}(e.el,0,this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,n){let{component:r}=this,{context:i}=r,s=xz(n);t&&!r.isValidSegDownEl(t.target)||i.emitter.trigger(e,{el:n,event:new _z(i,s.eventRange.def,s.eventRange.instance),jsEvent:t,view:i.viewApi})}}class nW extends _j{constructor(){super(...arguments),this.buildViewContext=EF(vj),this.buildViewPropTransformers=EF(iW),this.buildToolbarProps=EF(rW),this.headerRef={current:null},this.footerRef={current:null},this.interactionsStore={},this.state={viewLabelId:UH()},this.registerInteractiveComponent=(e,t)=>{let n=function(e,t){return{component:e,el:t.el,useEventCenter:null==t.useEventCenter||t.useEventCenter,isHitComboAllowed:t.isHitComboAllowed||null}}(e,t),r=[eW,tW].concat(this.props.pluginHooks.componentInteractions).map(e=>new e(n));this.interactionsStore[e.uid]=r,Gz[e.uid]=n},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let e of t)e.destroy();delete this.interactionsStore[e.uid]}delete Gz[e.uid]},this.resizeRunner=new PH(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let e,{props:t}=this,{toolbarConfig:n,options:r}=t,i=!1,s="";t.isHeightAuto||t.forPrint?s="":null!=r.height?i=!0:null!=r.contentHeight?s=r.contentHeight:e=Math.max(r.aspectRatio,.5);let a=this.buildViewContext(t.viewSpec,t.viewApi,t.options,t.dateProfileGenerator,t.dateEnv,t.nowManager,t.theme,t.pluginHooks,t.dispatch,t.getCurrentData,t.emitter,t.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),o=n.header&&n.header.hasTitle?this.state.viewLabelId:void 0;return gU(gj.Provider,{value:a},gU(Wz,{unit:"day"},r=>{let a=this.buildToolbarProps(t.viewSpec,t.dateProfile,t.dateProfileGenerator,t.currentDate,r,t.viewTitle);return gU(_U,null,n.header&&gU(JG,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:n.header,titleId:o},a)),gU(QG,{liquid:i,height:s,aspectRatio:e,labeledById:o},this.renderView(t),this.buildAppendContent()),n.footer&&gU(JG,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:n.footer,titleId:""},a)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(t=>new t(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let n in t)t[n](e[n],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:n}=t.pluginHooks;for(let r in n)t[r]!==e[r]&&n[r](t[r],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this;return gU(_U,{},...e.pluginHooks.viewContainerAppends.map(t=>t(e)))}renderView(e){let{pluginHooks:t}=e,{viewSpec:n}=e,r={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},i=this.buildViewPropTransformers(t.viewPropsTransformers);for(let t of i)Object.assign(r,t.transform(r,e));return gU(n.component,Object.assign({},r))}}function rW(e,t,n,r,i,s){let a=n.build(i,void 0,!1),o=n.buildPrev(t,r,!1),l=n.buildNext(t,r,!1);return{title:s,activeButton:e.type,navUnit:e.singleUnit,isTodayEnabled:a.isValid&&!Dj(t.currentRange,i),isPrevEnabled:o.isValid,isNextEnabled:l.isValid}}function iW(e){return e.map(e=>new e)}class sW extends Kz{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=e=>{switch(e.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=e=>{this.currentData=e,this.renderRunner.request(e.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:e}=this;dj(()=>{HU(gU(zz,{options:e.calendarOptions,theme:e.theme,emitter:e.emitter},(t,n,r,i)=>(this.setClassNames(t),this.setHeight(n),gU(Cj.Provider,{value:this.customContentRenderId},gU(nW,Object.assign({isHeightAuto:r,forPrint:i},e))))),this.el)})}else this.isRendered&&(this.isRendered=!1,HU(null,this.el),this.setClassNames([]),this.setHeight(""))},function(e){e.isConnected&&e.getRootNode&&kH(e.getRootNode())}(e),this.el=e,this.renderRunner=new PH(this.handleRenderRequest),new FG({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){dj(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!iF(e,this.currentClassNames)){let{classList:t}=this.el;for(let e of this.currentClassNames)t.remove(e);for(let n of e)t.add(n);this.currentClassNames=e}}setHeight(e){BH(this.el,"height",e)}}class aW extends aV{constructor(){super(...arguments),this.headerElRef={current:null}}renderSimpleLayout(e,t){let{props:n,context:r}=this,i=[],s=OV(r.options);return e&&i.push({type:"header",key:"header",isSticky:s,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),i.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),gU(kj,{elClasses:["fc-daygrid"],viewSpec:r.viewSpec},gU(BV,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[],sections:i}))}renderHScrollLayout(e,t,n,r){let i=this.context.pluginHooks.scrollGridImpl;if(!i)throw new Error("No ScrollGrid implementation");let{props:s,context:a}=this,o=!s.forPrint&&OV(a.options),l=!s.forPrint&&LV(a.options),c=[];return e&&c.push({type:"header",key:"header",isSticky:o,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),c.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),l&&c.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:DV}]}),gU(kj,{elClasses:["fc-daygrid"],viewSpec:a.viewSpec},gU(i,{liquid:!s.isHeightAuto&&!s.forPrint,forPrint:s.forPrint,collapsibleWidth:s.forPrint,colGroups:[{cols:[{span:n,minWidth:r}]}],sections:c}))}}function oW(e,t){let n=[];for(let e=0;e<t;e+=1)n[e]=[];for(let t of e)n[t.row].push(t);return n}function lW(e,t){let n=[];for(let e=0;e<t;e+=1)n[e]=[];for(let t of e)n[t.firstCol].push(t);return n}function cW(e,t){let n=[];if(e){for(let r=0;r<t;r+=1)n[r]={affectedInstances:e.affectedInstances,isEvent:e.isEvent,segs:[]};for(let t of e.segs)n[t.row].segs.push(t)}else for(let e=0;e<t;e+=1)n[e]=null;return n}const uW=HF({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function hW(e){let{display:t}=e.eventRange.ui;return"list-item"===t||"auto"===t&&!e.eventRange.def.allDay&&e.firstCol===e.lastCol&&e.isStart&&e.isEnd}class dW extends bj{render(){let{props:e}=this;return gU(UV,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:uW,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}}class fW extends bj{render(){let{props:e,context:t}=this,{options:n}=t,{seg:r}=e,i=Pz(r,n.eventTimeFormat||uW,t,!0,e.defaultDisplayEventEnd);return gU(NV,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Lz(e.seg,t),defaultGenerator:pW,timeText:i,isResizing:!1,isDateSelecting:!1}))}}function pW(e){return gU(_U,null,gU("div",{className:"fc-daygrid-event-dot",style:{borderColor:e.borderColor||e.backgroundColor}}),e.timeText&&gU("div",{className:"fc-event-time"},e.timeText),gU("div",{className:"fc-event-title"},e.event.title||gU(_U,null," ")))}class mW extends bj{constructor(){super(...arguments),this.compileSegs=EF(gW)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:n}=this.compileSegs(e.singlePlacements);return gU(JV,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:n,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let n=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return gU(_U,null,t.map(t=>{let r=t.eventRange.instance.instanceId;return gU("div",{className:"fc-daygrid-event-harness",key:r,style:{visibility:n[r]?"hidden":""}},hW(t)?gU(fW,Object.assign({seg:t,isDragging:!1,isSelected:r===e.eventSelection,defaultDisplayEventEnd:!1},Iz(t,e.todayRange))):gU(dW,Object.assign({seg:t,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:r===e.eventSelection,defaultDisplayEventEnd:!1},Iz(t,e.todayRange))))}))}})}}function gW(e){let t=[],n=[];for(let r of e)t.push(r.seg),r.isVisible||n.push(r.seg);return{allSegs:t,invisibleSegs:n}}const vW=HF({week:"narrow"});class _W extends aV{constructor(){super(...arguments),this.rootElRef={current:null},this.state={dayNumberId:UH()},this.handleRootEl=e=>{yj(this.rootElRef,e),yj(this.props.elRef,e)}}render(){let{context:e,props:t,state:n,rootElRef:r}=this,{options:i,dateEnv:s}=e,{date:a,dateProfile:o}=t;const l=t.showDayNumber&&function(e,t,n){const{start:r,end:i}=t,s=lF(i,-1),a=n.getYear(r),o=n.getMonth(r),l=n.getYear(s),c=n.getMonth(s);return!(a===l&&o===c)&&Boolean(e.valueOf()===r.valueOf()||1===n.getDay(e)&&e.valueOf()<i.valueOf())}(a,o.currentRange,s);return gU(zV,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":n.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:bW,date:a,dateProfile:o,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:l,extraRenderProps:t.extraRenderProps},(s,o)=>gU("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&gU($V,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:nV(e,a,"week"),date:a,defaultFormat:vW}),!o.isDisabled&&(t.showDayNumber||VV(i)||t.forceDayTop)?gU("div",{className:"fc-daygrid-day-top"},gU(s,{elTag:"a",elClasses:["fc-daygrid-day-number",l&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},nV(e,a)),{id:n.dayNumberId})})):t.showDayNumber?gU("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},gU("a",{className:"fc-daygrid-day-number"}," ")):void 0,gU("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,gU("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},gU(mW,{allDayDate:a,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:r,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),gU("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}}function bW(e){return e.dayNumberText||gU(_U,null," ")}function yW(e){return e.eventRange.instance.instanceId+":"+e.firstCol}function wW(e){return yW(e)+":"+e.lastCol}function SW(e,t,n,r){if(e.firstCol===t&&e.lastCol===n-1)return e;let i=e.eventRange,s=i.range,a=Ij(s,{start:r[t].date,end:oF(r[n-1].date,1)});return Object.assign(Object.assign({},e),{firstCol:t,lastCol:n-1,eventRange:{def:i.def,ui:Object.assign(Object.assign({},i.ui),{durationEditable:!1}),instance:i.instance,range:a},isStart:e.isStart&&a.start.valueOf()===s.start.valueOf(),isEnd:e.isEnd&&a.end.valueOf()===s.end.valueOf()})}class xW extends oV{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){const t=super.addSegs(e),{entriesByLevel:n}=this,r=e=>!this.forceHidden[cV(e)];for(let e=0;e<n.length;e+=1)n[e]=n[e].filter(r);return t}handleInvalidInsertion(e,t,n){const{entriesByLevel:r,forceHidden:i}=this,{touchingEntry:s,touchingLevel:a,touchingLateral:o}=e;if(this.hiddenConsumes&&s){const e=cV(s);if(!i[e])if(this.allowReslicing){const e=Object.assign(Object.assign({},s),{span:hV(s.span,t.span)});i[cV(e)]=!0,r[a][o]=e,n.push(e),this.splitEntry(s,t,n)}else i[e]=!0,n.push(s)}super.handleInvalidInsertion(e,t,n)}}class EW extends aV{constructor(){super(...arguments),this.cellElRefs=new MV,this.frameElRefs=new MV,this.fgElRefs=new MV,this.segHarnessRefs=new MV,this.rootElRef={current:null},this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:n}=this,{options:r}=n,i=e.cells.length,s=lW(e.businessHourSegs,i),a=lW(e.bgEventSegs,i),o=lW(this.getHighlightSegs(),i),l=lW(this.getMirrorSegs(),i),{singleColPlacements:c,multiColPlacements:u,moreCnts:h,moreMarginTops:d}=function(e,t,n,r,i,s,a){let o=new xW(t=>{let n=e[t.index].eventRange.instance.instanceId+":"+t.span.start+":"+(t.span.end-1);return i[n]||1});o.allowReslicing=!0,o.strictOrder=r,!0===t||!0===n?(o.maxCoord=s,o.hiddenConsumes=!0):"number"==typeof t?o.maxStackCnt=t:"number"==typeof n&&(o.maxStackCnt=n,o.hiddenConsumes=!0);let l=[],c=[];for(let t=0;t<e.length;t+=1){let n=e[t],r=wW(n);null!=i[r]?l.push({index:t,span:{start:n.firstCol,end:n.lastCol+1}}):c.push(n)}let u=o.addSegs(l),h=o.toRects(),{singleColPlacements:d,multiColPlacements:f,leftoverMargins:p}=function(e,t,n){let r=function(e,t){let n=[];for(let e=0;e<t;e+=1)n.push([]);for(let t of e)for(let e=t.span.start;e<t.span.end;e+=1)n[e].push(t);return n}(e,n.length),i=[],s=[],a=[];for(let e=0;e<n.length;e+=1){let o=r[e],l=[],c=0,u=0;for(let r of o){let i=t[r.index];l.push({seg:SW(i,e,e+1,n),isVisible:!0,isAbsolute:!1,absoluteTop:r.levelCoord,marginTop:r.levelCoord-c}),c=r.levelCoord+r.thickness}let h=[];c=0,u=0;for(let r of o){let i=t[r.index],s=r.span.end-r.span.start>1,a=r.span.start===e;u+=r.levelCoord-c,c=r.levelCoord+r.thickness,s?(u+=r.thickness,a&&h.push({seg:SW(i,r.span.start,r.span.end,n),isVisible:!0,isAbsolute:!0,absoluteTop:r.levelCoord,marginTop:0})):a&&(h.push({seg:SW(i,r.span.start,r.span.end,n),isVisible:!0,isAbsolute:!1,absoluteTop:r.levelCoord,marginTop:u}),u=0)}i.push(l),s.push(h),a.push(u)}return{singleColPlacements:i,multiColPlacements:s,leftoverMargins:a}}(h,e,a),m=[],g=[];for(let e of c){f[e.firstCol].push({seg:e,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let t=e.firstCol;t<=e.lastCol;t+=1)d[t].push({seg:SW(e,t,t+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let e=0;e<a.length;e+=1)m.push(0);for(let t of u){let n=e[t.index],r=t.span;f[r.start].push({seg:SW(n,r.start,r.end,a),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let e=r.start;e<r.end;e+=1)m[e]+=1,d[e].push({seg:SW(n,e,e+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let e=0;e<a.length;e+=1)g.push(p[e]);return{singleColPlacements:d,multiColPlacements:f,moreCnts:m,moreMarginTops:g}}(Az(e.fgEventSegs,r.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,r.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),f=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return gU("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((t,n)=>{let r=this.renderFgSegs(n,e.forPrint?c[n]:u[n],e.todayRange,f),i=this.renderFgSegs(n,function(e,t){if(!e.length)return[];let n=function(e){let t={};for(let n of e)for(let e of n)t[e.seg.eventRange.instance.instanceId]=e.absoluteTop;return t}(t);return e.map(e=>({seg:e,isVisible:!0,isAbsolute:!0,absoluteTop:n[e.eventRange.instance.instanceId],marginTop:0}))}(l[n],u),e.todayRange,{},Boolean(e.eventDrag),Boolean(e.eventResize),!1);return gU(_W,{key:t.key,elRef:this.cellElRefs.createRef(t.key),innerElRef:this.frameElRefs.createRef(t.key),dateProfile:e.dateProfile,date:t.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&0===n,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:t.extraRenderProps,extraDataAttrs:t.extraDataAttrs,extraClassNames:t.extraClassNames,extraDateSpan:t.extraDateSpan,moreCnt:h[n],moreMarginTop:d[n],singlePlacements:c[n],fgContentElRef:this.fgElRefs.createRef(t.key),fgContent:gU(_U,null,gU(_U,null,r),gU(_U,null,i)),bgContent:gU(_U,null,this.renderFillSegs(o[n],"highlight"),this.renderFillSegs(s[n],"non-business"),this.renderFillSegs(a[n],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let n=this.props;this.updateSizing(!rj(e,n))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,n,r,i,s,a){let{context:o}=this,{eventSelection:l}=this.props,{framePositions:c}=this.state,u=1===this.props.cells.length,h=i||s||a,d=[];if(c)for(let e of t){let{seg:t}=e,{instanceId:f}=t.eventRange.instance,p=e.isVisible&&!r[f],m=e.isAbsolute,g="",v="";m&&(o.isRtl?(v=0,g=c.lefts[t.lastCol]-c.lefts[t.firstCol]):(g=0,v=c.rights[t.firstCol]-c.rights[t.lastCol])),d.push(gU("div",{className:"fc-daygrid-event-harness"+(m?" fc-daygrid-event-harness-abs":""),key:yW(t),ref:h?null:this.segHarnessRefs.createRef(wW(t)),style:{visibility:p?"":"hidden",marginTop:m?"":e.marginTop,top:m?e.absoluteTop:"",left:g,right:v}},hW(t)?gU(fW,Object.assign({seg:t,isDragging:i,isSelected:f===l,defaultDisplayEventEnd:u},Iz(t,n))):gU(dW,Object.assign({seg:t,isDragging:i,isResizing:s,isDateSelecting:a,isSelected:f===l,defaultDisplayEventEnd:u},Iz(t,n)))))}return d}renderFillSegs(e,t){let{isRtl:n}=this.context,{todayRange:r}=this.props,{framePositions:i}=this.state,s=[];if(i)for(let a of e){let e=n?{right:0,left:i.lefts[a.lastCol]-i.lefts[a.firstCol]}:{left:0,right:i.rights[a.firstCol]-i.rights[a.lastCol]};s.push(gU("div",{key:Oz(a.eventRange),className:"fc-daygrid-bg-harness",style:e},"bg-event"===t?gU(WV,Object.assign({seg:a},Iz(a,r))):KV(t)))}return gU(_U,{},...s)}updateSizing(e){let{props:t,state:n,frameElRefs:r}=this;if(!t.forPrint&&null!==t.clientWidth){if(e){let e=t.cells.map(e=>r.currentMap[e.key]);if(e.length){let t=this.rootElRef.current,r=new iV(t,e,!0,!1);n.framePositions&&n.framePositions.similarTo(r)||this.setState({framePositions:new iV(t,e,!0,!1)})}}const i=this.state.segHeights,s=this.querySegHeights(),a=!0===t.dayMaxEvents||!0===t.dayMaxEventRows;this.safeSetState({segHeights:Object.assign(Object.assign({},i),s),maxContentHeight:a?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let n in e){let r=Math.round(e[n].getBoundingClientRect().height);t[n]=Math.max(t[n]||0,r)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}}EW.addStateEquality({segHeights:rj});class CW extends aV{constructor(){super(...arguments),this.splitBusinessHourSegs=EF(oW),this.splitBgEventSegs=EF(AW),this.splitFgEventSegs=EF(oW),this.splitDateSelectionSegs=EF(oW),this.splitEventDrag=EF(cW),this.splitEventResize=EF(cW),this.rowRefs=new MV}render(){let{props:e,context:t}=this,n=e.cells.length,r=this.splitBusinessHourSegs(e.businessHourSegs,n),i=this.splitBgEventSegs(e.bgEventSegs,n),s=this.splitFgEventSegs(e.fgEventSegs,n),a=this.splitDateSelectionSegs(e.dateSelectionSegs,n),o=this.splitEventDrag(e.eventDrag,n),l=this.splitEventResize(e.eventResize,n),c=n>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return gU(Wz,{unit:"day"},(t,u)=>gU(_U,null,e.cells.map((t,h)=>gU(EW,{ref:this.rowRefs.createRef(h),key:t.length?t[0].date.toISOString():h,showDayNumbers:n>1,showWeekNumbers:e.showWeekNumbers,todayRange:u,dateProfile:e.dateProfile,cells:t,renderIntro:e.renderRowIntro,businessHourSegs:r[h],eventSelection:e.eventSelection,bgEventSegs:i[h],fgEventSegs:s[h],dateSelectionSegs:a[h],eventDrag:o[h],eventResize:l[h],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:c,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){const e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new iV(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new iV(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:n,rowPositions:r}=this,i=n.leftToIndex(e),s=r.topToIndex(t);if(null!=s&&null!=i){let e=this.props.cells[s][i];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(s,i),allDay:!0},e.extraDateSpan),dayEl:this.getCellEl(s,i),rect:{left:n.lefts[i],right:n.rights[i],top:r.tops[s],bottom:r.bottoms[s]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let n=this.props.cells[e][t].date;return{start:n,end:oF(n,1)}}}function AW(e,t){return oW(e.filter(MW),t)}function MW(e){return e.eventRange.def.allDay}class kW extends aV{constructor(){super(...arguments),this.elRef={current:null},this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:n,expandRows:r}=e,i=!0===n||!0===t;i&&!r&&(i=!1,t=null,n=null);let s=["fc-daygrid-body",i?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",r?"":"fc-daygrid-body-natural"];return gU("div",{ref:this.elRef,className:s.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},gU("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:r?e.clientHeight:""}},e.colGroupNode,gU("tbody",{role:"presentation"},gU(CW,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:n,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){const e=function(e,t){let n;var r;return t.currentRangeUnit.match(/year|month/)&&(n=e.querySelector(`[data-date="${r=t.currentDate,r.toISOString().match(/^\d{4}-\d{2}/)[0]}-01"]`)),n||(n=e.querySelector(`[data-date="${wF(t.currentDate)}"]`)),n}(this.elRef.current,this.props.dateProfile);if(e){const t=e.closest(".fc-daygrid-body"),n=t.closest(".fc-scroller"),r=e.getBoundingClientRect().top-t.getBoundingClientRect().top;n.scrollTop=r?r+1:0}this.needsScrollReset=!1}}}class TW extends xV{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}}class RW extends aV{constructor(){super(...arguments),this.slicer=new TW,this.tableRef={current:null}}render(){let{props:e,context:t}=this;return gU(kW,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}}function PW(e,t){let n=new wV(e.renderRange,t);return new SV(n,/year|month|week/.test(e.currentRangeUnit))}MH(':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}');class IW extends Yz{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?"background"===(t=e).ui.display||"inverse-background"===t.ui.display?["timed","allDay"]:["allDay"]:["timed"];var t}}const DW=HF({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function OW(e){let t=["fc-timegrid-slot","fc-timegrid-slot-label",e.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return gU(gj.Consumer,null,n=>{if(!e.isLabeled)return gU("td",{className:t.join(" "),"data-time":e.isoTimeStr});let{dateEnv:r,options:i,viewApi:s}=n,a=null==i.slotLabelFormat?DW:Array.isArray(i.slotLabelFormat)?HF(i.slotLabelFormat[0]):HF(i.slotLabelFormat),o={level:0,time:e.time,date:r.toDate(e.date),view:s,text:r.format(e.date,a)};return gU(Aj,{elTag:"td",elClasses:t,elAttrs:{"data-time":e.isoTimeStr},renderProps:o,generatorName:"slotLabelContent",customGenerator:i.slotLabelContent,defaultGenerator:LW,classNameGenerator:i.slotLabelClassNames,didMount:i.slotLabelDidMount,willUnmount:i.slotLabelWillUnmount},e=>gU("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},gU(e,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function LW(e){return e.text}class BW extends bj{render(){return this.props.slatMetas.map(e=>gU("tr",{key:e.key},gU(OW,Object.assign({},e))))}}const NW=HF({week:"short"});class UW extends aV{constructor(){super(...arguments),this.allDaySplitter=new IW,this.headerElRef={current:null},this.rootElRef={current:null},this.scrollerElRef={current:null},this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:n}=this.context,{dateProfile:r}=this.props,i=r.renderRange,s=1===cF(i.start,i.end)?nV(this.context,i.start,"week"):{};return n.weekNumbers&&"day"===e?gU($V,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:i.start,defaultFormat:NW},e=>gU("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},gU(e,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:s}))):gU("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},gU("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:n}=this.context,r={text:t.allDayText,view:n};return gU(Aj,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:r,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:HW,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},t=>gU("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",null==e?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},gU(t,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,n){let{context:r,props:i}=this,s=[],a=OV(r.options);return e&&s.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(s.push({type:"body",key:"all-day",chunk:{content:t}}),s.push({type:"body",key:"all-day-divider",outerContent:gU("tr",{role:"presentation",className:"fc-scrollgrid-section"},gU("td",{className:"fc-timegrid-divider "+r.theme.getClass("tableCellShaded")}))})),s.push({type:"body",key:"body",liquid:!0,expandRows:Boolean(r.options.expandRows),chunk:{scrollerElRef:this.scrollerElRef,content:n}}),gU(kj,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:r.viewSpec},gU(BV,{liquid:!i.isHeightAuto&&!i.forPrint,collapsibleWidth:i.forPrint,cols:[{width:"shrink"}],sections:s}))}renderHScrollLayout(e,t,n,r,i,s,a){let o=this.context.pluginHooks.scrollGridImpl;if(!o)throw new Error("No ScrollGrid implementation");let{context:l,props:c}=this,u=!c.forPrint&&OV(l.options),h=!c.forPrint&&LV(l.options),d=[];e&&d.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:e=>gU("tr",{role:"presentation"},this.renderHeadAxis("day",e.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(d.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:e=>gU("tr",{role:"presentation"},this.renderTableRowAxis(e.rowSyncHeights[0]))},{key:"cols",content:t}]}),d.push({key:"all-day-divider",type:"body",outerContent:gU("tr",{role:"presentation",className:"fc-scrollgrid-section"},gU("td",{colSpan:2,className:"fc-timegrid-divider "+l.theme.getClass("tableCellShaded")}))}));let f=l.options.nowIndicator;return d.push({type:"body",key:"body",liquid:!0,expandRows:Boolean(l.options.expandRows),chunks:[{key:"axis",content:e=>gU("div",{className:"fc-timegrid-axis-chunk"},gU("table",{"aria-hidden":!0,style:{height:e.expandRows?e.clientHeight:""}},e.tableColGroupNode,gU("tbody",null,gU(BW,{slatMetas:s}))),gU("div",{className:"fc-timegrid-now-indicator-container"},gU(Wz,{unit:f?"minute":"day"},e=>{let t=f&&a&&a.safeComputeTop(e);return"number"==typeof t?gU(FV,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:t},isAxis:!0,date:e}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),h&&d.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:DV},{key:"cols",content:DV}]}),gU(kj,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:l.viewSpec},gU(o,{liquid:!c.isHeightAuto&&!c.forPrint,forPrint:c.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:r,minWidth:i}]}],sections:d}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return!0!==e&&!0!==t||(e=void 0,t=5),{dayMaxEvents:e,dayMaxEventRows:t}}}function HW(e){return e.text}class FW{constructor(e,t,n){this.positions=e,this.dateProfile=t,this.slotDuration=n}safeComputeTop(e){let{dateProfile:t}=this;if(Dj(t.currentRange,e)){let n=hF(e),r=e.valueOf()-n.valueOf();if(r>=tF(t.slotMinTime)&&r<tF(t.slotMaxTime))return this.computeTimeTop(ZH(r))}return null}computeDateTop(e,t){return t||(t=hF(e)),this.computeTimeTop(ZH(e.valueOf()-t.valueOf()))}computeTimeTop(e){let t,n,{positions:r,dateProfile:i}=this,s=r.els.length,a=(e.milliseconds-tF(i.slotMinTime))/tF(this.slotDuration);return a=Math.max(0,a),a=Math.min(s,a),t=Math.floor(a),t=Math.min(t,s-1),n=a-t,r.tops[t]+r.getHeight(t)*n}}class jW extends bj{render(){let{props:e,context:t}=this,{options:n}=t,{slatElRefs:r}=e;return gU("tbody",null,e.slatMetas.map((i,s)=>{let a={time:i.time,date:t.dateEnv.toDate(i.date),view:t.viewApi};return gU("tr",{key:i.key,ref:r.createRef(i.key)},e.axis&&gU(OW,Object.assign({},i)),gU(Aj,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!i.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":i.isoTimeStr},renderProps:a,generatorName:"slotLaneContent",customGenerator:n.slotLaneContent,classNameGenerator:n.slotLaneClassNames,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount}))}))}}class zW extends bj{constructor(){super(...arguments),this.rootElRef={current:null},this.slatElRefs=new MV}render(){let{props:e,context:t}=this;return gU("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},gU("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,gU(jW,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;var n;t.onCoords&&null!==t.clientWidth&&this.rootElRef.current.offsetHeight&&t.onCoords(new FW(new iV(this.rootElRef.current,(n=this.slatElRefs.currentMap,t.slatMetas.map(e=>n[e.key])),!1,!0),this.props.dateProfile,e.options.slotDuration))}}function VW(e,t){let n,r=[];for(n=0;n<t;n+=1)r.push([]);if(e)for(n=0;n<e.length;n+=1)r[e[n].col].push(e[n]);return r}function GW(e,t){let n=[];if(e){for(let r=0;r<t;r+=1)n[r]={affectedInstances:e.affectedInstances,isEvent:e.isEvent,segs:[]};for(let t of e.segs)n[t.col].segs.push(t)}else for(let e=0;e<t;e+=1)n[e]=null;return n}class WW extends bj{render(){let{props:e}=this;return gU(JV,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>tq(e.hiddenSegs,e),defaultGenerator:qW,forceTimed:!0},e=>gU(e,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}}function qW(e){return e.shortText}function KW(e,t){if(!e)return[[],0];let{level:n,lateralStart:r,lateralEnd:i}=e,s=r,a=[];for(;s<i;)a.push(t(n,s)),s+=1;return a.sort($W),[a.map(XW),a[0][1]]}function $W(e,t){return t[1]-e[1]}function XW(e){return e[0]}function YW(e,t){const n={};return(...r)=>{let i=e(...r);return i in n?n[i]:n[i]=t(...r)}}function ZW(e,t,n=null,r=0){let i=[];if(n)for(let s=0;s<e.length;s+=1){let a=e[s],o=n.computeDateTop(a.start,t),l=Math.max(o+(r||0),n.computeDateTop(a.end,t));i.push({start:Math.round(o),end:Math.round(l)})}return i}const JW=HF({hour:"numeric",minute:"2-digit",meridiem:!1});class QW extends bj{render(){return gU(UV,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:JW}))}}class eq extends bj{constructor(){super(...arguments),this.sortEventSegs=EF(Az)}render(){let{props:e,context:t}=this,{options:n}=t,r=n.selectMirror,i=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||r&&e.dateSelectionSegs||[],s=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},a=this.sortEventSegs(e.fgEventSegs,n.eventOrder);return gU(zV,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},t=>gU("div",{className:"fc-timegrid-col-frame"},gU("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),gU("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(a,s,!1,!1,!1)),gU("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(i,{},Boolean(e.eventDrag),Boolean(e.eventResize),Boolean(r),"mirror")),gU("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),VV(n)&&gU(t,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,n,r,i,s){let{props:a}=this;return a.forPrint?tq(e,a):this.renderPositionedFgSegs(e,t,n,r,i,s)}renderPositionedFgSegs(e,t,n,r,i,s){let{eventMaxStack:a,eventShortHeight:o,eventOrderStrict:l,eventMinHeight:c}=this.context.options,{date:u,slatCoords:h,eventSelection:d,todayRange:f,nowDate:p}=this.props,m=n||r||i,g=ZW(e,u,h,c),{segPlacements:v,hiddenGroups:_}=function(e,t,n,r){let i=[],s=[];for(let n=0;n<e.length;n+=1){let r=t[n];r?i.push({index:n,thickness:1,span:r}):s.push(e[n])}let{segRects:a,hiddenGroups:o}=function(e,t,n){let r=new oV;null!=t&&(r.strictOrder=t),null!=n&&(r.maxStackCnt=n);let i=function(e){let t=[];for(let n of e){let e=[],r={span:n.span,entries:[n]};for(let n of t)hV(n.span,r.span)?r={entries:n.entries.concat(r.entries),span:uV(n.span,r.span)}:e.push(n);e.push(r),t=e}return t}(r.addSegs(e)),s=function(e){const{entriesByLevel:t}=e,n=YW((e,t)=>e+":"+t,(r,i)=>{let s=function(e,t,n){let{levelCoords:r,entriesByLevel:i}=e,s=i[t][n],a=r[t]+s.thickness,o=r.length,l=t;for(;l<o&&r[l]<a;l+=1);for(;l<o;l+=1){let e,t=i[l],n=fV(t,s.span.start,lV),r=n[0]+n[1],a=r;for(;(e=t[a])&&e.span.start<s.span.end;)a+=1;if(r<a)return{level:l,lateralStart:r,lateralEnd:a}}return null}(e,r,i),a=KW(s,n),o=t[r][i];return[Object.assign(Object.assign({},o),{nextLevelNodes:a[0]}),o.thickness+a[1]]});return KW(t.length?{level:0,lateralStart:0,lateralEnd:t[0].length}:null,n)[0]}(r);return s=function(e){const t=YW((e,t,n)=>cV(e),(e,n,r)=>{let i,{nextLevelNodes:s,thickness:a}=e,o=a+r,l=a/o,c=[];if(s.length)for(let e of s)if(void 0===i){let r=t(e,n,o);i=r[0],c.push(r[1])}else{let n=t(e,i,0);c.push(n[1])}else i=1;let u=(i-n)*l;return[i-u,Object.assign(Object.assign({},e),{thickness:u,nextLevelNodes:c})]});return e.map(e=>t(e,0,0)[1])}(s),{segRects:function(e){let t=[];const n=YW((e,t,n)=>cV(e),(e,n,i)=>{let s=Object.assign(Object.assign({},e),{levelCoord:n,stackDepth:i,stackForward:0});return t.push(s),s.stackForward=r(e.nextLevelNodes,n+e.thickness,i+1)+1});function r(e,t,r){let i=0;for(let s of e)i=Math.max(n(s,t,r),i);return i}return r(e,0,0),t}(s),hiddenGroups:i}}(i,n,r),l=[];for(let t of a)l.push({seg:e[t.index],rect:t});for(let e of s)l.push({seg:e,rect:null});return{segPlacements:l,hiddenGroups:o}}(e,g,l,a);return gU(_U,null,this.renderHiddenGroups(_,e),v.map(e=>{let{seg:a,rect:l}=e,c=a.eventRange.instance.instanceId,u=m||Boolean(!t[c]&&l),h=nq(l&&l.span),g=!m&&l?this.computeSegHStyle(l):{left:0,right:0},v=Boolean(l)&&l.stackForward>0,_=Boolean(l)&&l.span.end-l.span.start<o;return gU("div",{className:"fc-timegrid-event-harness"+(v?" fc-timegrid-event-harness-inset":""),key:s||c,style:Object.assign(Object.assign({visibility:u?"":"hidden"},h),g)},gU(QW,Object.assign({seg:a,isDragging:n,isResizing:r,isDateSelecting:i,isSelected:c===d,isShort:_},Iz(a,f,p))))}))}renderHiddenGroups(e,t){let{extraDateSpan:n,dateProfile:r,todayRange:i,nowDate:s,eventSelection:a,eventDrag:o,eventResize:l}=this.props;return gU(_U,null,e.map(e=>{let c=nq(e.span),u=(h=e.entries,d=t,h.map(e=>d[e.index]));var h,d;return gU(WW,{key:yF(tG(u)),hiddenSegs:u,top:c.top,bottom:c.bottom,extraDateSpan:n,dateProfile:r,todayRange:i,nowDate:s,eventSelection:a,eventDrag:o,eventResize:l})}))}renderFillSegs(e,t){let{props:n,context:r}=this,i=ZW(e,n.date,n.slatCoords,r.options.eventMinHeight).map((r,i)=>{let s=e[i];return gU("div",{key:Oz(s.eventRange),className:"fc-timegrid-bg-harness",style:nq(r)},"bg-event"===t?gU(WV,Object.assign({seg:s},Iz(s,n.todayRange,n.nowDate))):KV(t))});return gU(_U,null,i)}renderNowIndicator(e){let{slatCoords:t,date:n}=this.props;return t?e.map((e,r)=>gU(FV,{key:r,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(e.start,n)},isAxis:!1,date:n})):null}computeSegHStyle(e){let t,n,{isRtl:r,options:i}=this.context,s=i.slotEventOverlap,a=e.levelCoord,o=e.levelCoord+e.thickness;s&&(o=Math.min(1,a+2*(o-a))),r?(t=1-o,n=a):(t=a,n=1-o);let l={zIndex:e.stackDepth+1,left:100*t+"%",right:100*n+"%"};return s&&!e.stackForward&&(l[r?"marginLeft":"marginRight"]=20),l}}function tq(e,{todayRange:t,nowDate:n,eventSelection:r,eventDrag:i,eventResize:s}){let a=(i?i.affectedInstances:null)||(s?s.affectedInstances:null)||{};return gU(_U,null,e.map(e=>{let i=e.eventRange.instance.instanceId;return gU("div",{key:i,style:{visibility:a[i]?"hidden":""}},gU(QW,Object.assign({seg:e,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:i===r,isShort:!1},Iz(e,t,n))))}))}function nq(e){return e?{top:e.start,bottom:-e.end}:{top:"",bottom:""}}class rq extends bj{constructor(){super(...arguments),this.splitFgEventSegs=EF(VW),this.splitBgEventSegs=EF(VW),this.splitBusinessHourSegs=EF(VW),this.splitNowIndicatorSegs=EF(VW),this.splitDateSelectionSegs=EF(VW),this.splitEventDrag=EF(GW),this.splitEventResize=EF(GW),this.rootElRef={current:null},this.cellElRefs=new MV}render(){let{props:e,context:t}=this,n=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),r=e.cells.length,i=this.splitFgEventSegs(e.fgEventSegs,r),s=this.splitBgEventSegs(e.bgEventSegs,r),a=this.splitBusinessHourSegs(e.businessHourSegs,r),o=this.splitNowIndicatorSegs(e.nowIndicatorSegs,r),l=this.splitDateSelectionSegs(e.dateSelectionSegs,r),c=this.splitEventDrag(e.eventDrag,r),u=this.splitEventResize(e.eventResize,r);return gU("div",{className:"fc-timegrid-cols",ref:this.rootElRef},gU("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,gU("tbody",{role:"presentation"},gU("tr",{role:"row"},e.axis&&gU("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},gU("div",{className:"fc-timegrid-col-frame"},gU("div",{className:"fc-timegrid-now-indicator-container"},"number"==typeof n&&gU(FV,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:n},isAxis:!0,date:e.nowDate})))),e.cells.map((t,n)=>gU(eq,{key:t.key,elRef:this.cellElRefs.createRef(t.key),dateProfile:e.dateProfile,date:t.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:t.extraRenderProps,extraDataAttrs:t.extraDataAttrs,extraClassNames:t.extraClassNames,extraDateSpan:t.extraDateSpan,fgEventSegs:i[n],bgEventSegs:s[n],businessHourSegs:a[n],nowIndicatorSegs:o[n],dateSelectionSegs:l[n],eventDrag:c[n],eventResize:u[n],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;var t;e.onColCoords&&null!==e.clientWidth&&e.onColCoords(new iV(this.rootElRef.current,(t=this.cellElRefs.currentMap,e.cells.map(e=>t[e.key])),!0,!1))}}class iq extends aV{constructor(){super(...arguments),this.processSlotOptions=EF(sq),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:n}=this.state;if(t&&n){if(e.time){let r=n.computeTimeTop(e.time);r=Math.ceil(r),r&&(r+=1),t(r)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return gU("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},gU(zW,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),gU(rq,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:n,options:r}=this.context,{colCoords:i}=this,{dateProfile:s}=this.props,{slatCoords:a}=this.state,{snapDuration:o,snapsPerSlot:l}=this.processSlotOptions(this.props.slotDuration,r.snapDuration),c=i.leftToIndex(e),u=a.positions.topToIndex(t);if(null!=c&&null!=u){let e=this.props.cells[c],r=a.positions.tops[u],h=a.positions.getHeight(u),d=(t-r)/h,f=u*l+Math.floor(d*l),p=this.props.cells[c].date,m=QH(s.slotMinTime,function(e,t){return{years:e.years*t,months:e.months*t,days:e.days*t,milliseconds:e.milliseconds*t}}(o,f)),g=n.add(p,m),v=n.add(g,o);return{dateProfile:s,dateSpan:Object.assign({range:{start:g,end:v},allDay:!1},e.extraDateSpan),dayEl:i.els[c],rect:{left:i.lefts[c],right:i.rights[c],top:r,bottom:r+h},layer:0}}return null}}function sq(e,t){let n=t||e,r=nF(e,n);return null===r&&(n=e,r=1),{snapDuration:n,snapsPerSlot:r}}class aq extends xV{sliceRange(e,t){let n=[];for(let r=0;r<t.length;r+=1){let i=Ij(e,t[r]);i&&n.push({start:i.start,end:i.end,isStart:i.start.valueOf()===e.start.valueOf(),isEnd:i.end.valueOf()===e.end.valueOf(),col:r})}return n}}class oq extends aV{constructor(){super(...arguments),this.buildDayRanges=EF(lq),this.slicer=new aq,this.timeColsRef={current:null}}render(){let{props:e,context:t}=this,{dateProfile:n,dayTableModel:r}=e,{nowIndicator:i,nextDayThreshold:s}=t.options,a=this.buildDayRanges(r,n,t.dateEnv);return gU(Wz,{unit:i?"minute":"day"},(o,l)=>gU(iq,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,n,null,t,a),{forPrint:e.forPrint,axis:e.axis,dateProfile:n,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:r.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:o,nowIndicatorSegs:i&&this.slicer.sliceNowDate(o,n,s,t,a),todayRange:l,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}}function lq(e,t,n){let r=[];for(let i of e.headerDates)r.push({start:n.add(i,t.slotMinTime),end:n.add(i,t.slotMaxTime)});return r}const cq=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function uq(e,t,n,r,i){let s=new Date(0),a=e,o=ZH(0),l=n||function(e){let t,n,r;for(t=cq.length-1;t>=0;t-=1)if(n=ZH(cq[t]),r=nF(n,e),null!==r&&r>1)return n;return e}(r),c=[];for(;tF(a)<tF(t);){let e=i.add(s,a),t=null!==nF(o,l);c.push({date:e,time:a,key:e.toISOString(),isoTimeStr:SF(e),isLabeled:t}),a=QH(a,r),o=QH(o,r)}return c}function hq(e,t){let n=new wV(e.renderRange,t);return new SV(n,!1)}MH('.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}');var dq,fq,pq=uG({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:{allDaySlot:Boolean},views:{timeGrid:{component:class extends UW{constructor(){super(...arguments),this.buildTimeColsModel=EF(hq),this.buildSlatMetas=EF(uq)}render(){let{options:e,dateEnv:t,dateProfileGenerator:n}=this.context,{props:r}=this,{dateProfile:i}=r,s=this.buildTimeColsModel(i,n),a=this.allDaySplitter.splitProps(r),o=this.buildSlatMetas(i.slotMinTime,i.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:l}=e,c=!l,u=l,h=e.dayHeaders&&gU(bV,{dates:s.headerDates,dateProfile:i,datesRepDistinctDays:!0,renderIntro:c?this.renderHeadAxis:null}),d=!1!==e.allDaySlot&&(t=>gU(RW,Object.assign({},a.allDay,{dateProfile:i,dayTableModel:s,nextDayThreshold:e.nextDayThreshold,tableMinWidth:t.tableMinWidth,colGroupNode:t.tableColGroupNode,renderRowIntro:c?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:r.forPrint},this.getAllDayMaxEventProps()))),f=t=>gU(oq,Object.assign({},a.timed,{dayTableModel:s,dateProfile:i,axis:c,slotDuration:e.slotDuration,slatMetas:o,forPrint:r.forPrint,tableColGroupNode:t.tableColGroupNode,tableMinWidth:t.tableMinWidth,clientWidth:t.clientWidth,clientHeight:t.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:t.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return u?this.renderHScrollLayout(h,d,f,s.colCnt,l,o,this.state.slatCoords):this.renderSimpleLayout(h,d,f)}},usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}}),mq=uG({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:class extends aW{constructor(){super(...arguments),this.buildDayTableModel=EF(PW),this.headerRef={current:null},this.tableRef={current:null}}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:n}=this,r=this.buildDayTableModel(n.dateProfile,t),i=e.dayHeaders&&gU(bV,{ref:this.headerRef,dateProfile:n.dateProfile,dates:r.headerDates,datesRepDistinctDays:1===r.rowCnt}),s=t=>gU(RW,{ref:this.tableRef,dateProfile:n.dateProfile,dayTableModel:r,businessHours:n.businessHours,dateSelection:n.dateSelection,eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:t.tableColGroupNode,tableMinWidth:t.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!n.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:n.forPrint});return e.dayMinWidth?this.renderHScrollLayout(i,s,r.colCnt,e.dayMinWidth):this.renderSimpleLayout(i,s)}},dateProfileGeneratorClass:class extends Nj{buildRenderRange(e,t,n){let r=super.buildRenderRange(e,t,n),{props:i}=this;return function(e){let t,{dateEnv:n,currentRange:r}=e,{start:i,end:s}=r;if(e.snapToWeek&&(i=n.startOfWeek(i),t=n.startOfWeek(s),t.valueOf()!==s.valueOf()&&(s=aF(t,1))),e.fixedWeekCount){let e=n.startOfWeek(n.startOfMonth(oF(r.end,-1)));s=aF(s,6-Math.ceil(cF(e,s)/7))}return{start:i,end:s}}({currentRange:r,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:i.fixedWeekCount,dateEnv:i.dateEnv})}}},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});function gq(e){return gq="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gq(e)}function vq(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Sq(r.key),r)}}function bq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(bq=function(){return!!e})()}function yq(e){return yq=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yq(e)}function wq(e,t){return wq=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wq(e,t)}function Sq(e){var t=function(e){if("object"!=gq(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=gq(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==gq(t)?t:t+""}var xq,Eq,Cq,Aq,Mq,kq,Tq,Rq,Pq,Iq,Dq,Oq,Lq,Bq=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=yq(t),function(e,t){if(t&&("object"==gq(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,bq()?Reflect.construct(t,n||[],yq(e).constructor):t.apply(e,n))}(this,t)).calendar=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wq(e,t)}(t,e),function(e,t){return t&&_q(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"firstUpdated",value:function(){this.initCalendar()}},{key:"generateWeeklyEvents",value:function(e,t){for(var n=[],r=new Date(e.start),i=new Date(e.end),s=new Date(r);s<i;s.setDate(s.getDate()+1)){var a=s.getDay();if(0!==a&&6!==a){var o=new Date(s);o.setHours(8,30,0,0);var l=new Date(o);l.setHours(9,0,0,0),n.push({title:"Morning Meeting",start:o.toISOString(),end:l.toISOString(),allDay:!1});var c=new Date(s);c.setHours(12,30,0,0);var u=new Date(c);u.setHours(13,30,0,0),n.push({title:"Lunch Break",start:c.toISOString(),end:u.toISOString(),allDay:!1})}}t(n)}},{key:"initCalendar",value:function(){var e=this,t=this.renderRoot.querySelector("#calendar");t&&(this.calendar=new sW(t,{plugins:[pq,mq],initialView:"timeGridWeek",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},nowIndicator:!0,editable:!0,selectable:!0,firstDay:0,slotMinTime:"08:00:00",slotMaxTime:"20:00:00",slotDuration:"00:30:00",height:"auto",contentHeight:"auto",events:function(t,n){e.generateWeeklyEvents(t,n)},datesSet:function(){e.calendar.refetchEvents()}}),this.calendar.render())}},{key:"render",value:function(){return W(dq||(dq=vq(['<div id="calendar"></div>'])))}}])}(ce);function Nq(e){return Nq="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nq(e)}function Uq(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Hq(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return Fq(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Fq(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Fq(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,Fq(h,"constructor",c),Fq(c,"constructor",l),l.displayName="GeneratorFunction",Fq(c,i,"GeneratorFunction"),Fq(h),Fq(h,i,"Generator"),Fq(h,r,function(){return this}),Fq(h,"toString",function(){return"[object Generator]"}),(Hq=function(){return{w:s,m:d}})()}function Fq(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Fq=function(e,t,n,r){function s(t,n){Fq(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},Fq(e,t,n,r)}function jq(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function zq(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){jq(s,r,i,a,o,"next",e)}function o(e){jq(s,r,i,a,o,"throw",e)}a(void 0)})}}function Vq(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gq(r.key),r)}}function Gq(e){var t=function(e){if("object"!=Nq(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Nq(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Nq(t)?t:t+""}function Wq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Wq=function(){return!!e})()}function qq(e){return qq=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qq(e)}function Kq(e,t){return Kq=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Kq(e,t)}!function(e,t,n){(t=Sq(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Bq,"styles",o(fq||(fq=vq(["\n    :host {\n      display: block;\n      width: 100%;\n    }\n    #calendar {\n      width: 100%;\n      min-height: 600px;\n    }\n  "])))),customElements.define("streaming-calendar",Bq);var $q,Xq,Yq,Zq,Jq,Qq,eK,tK,nK,rK,iK,sK,aK,oK=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=qq(t),function(e,t){if(t&&("object"==Nq(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Wq()?Reflect.construct(t,n||[],qq(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.tenants=null,e.tenants_requested={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Kq(e,t)}(t,e),function(e,t,n){return t&&Vq(e.prototype,t),n&&Vq(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(i=zq(Hq().m(function e(){return Hq().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"renderTenantHeader",value:function(){return this.tenants?["name","lastUpdate","sessionId","services"].map(function(e){return"sessionId"==e?W(Eq||(Eq=Uq(['<th class="fw-lighter" scope="col">request</th>']))):W(Cq||(Cq=Uq(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W(xq||(xq=Uq([""])))}},{key:"renderTenantContent",value:function(){var e=this.tenants,t=this;return e||(e={}),Object.values(e).map(function(e){return W(Aq||(Aq=Uq(["<tr>","</tr>"])),["name","lastUpdate","sessionId","services"].map(function(n){if("sessionId"==n)return W(Mq||(Mq=Uq(['<td class="fw-light"><a class="btn btn-link btn-sm py-0 ','" @click="','">',"</a></td>"])),t.inori.tenant.session_id()==e[n]?"disabled":"",t.connectDevice.bind(t,e[n]),e[n]);if("services"==n)return W(kq||(kq=Uq(['<td class="fw-light align-bottom">',"</td>"])),t.inori.tenant.session_id()==e.sessionId?W(Tq||(Tq=Uq(['   \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video" viewBox="0 0 16 16">\n    <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"/>\n  </svg>\n</a>      \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cast" viewBox="0 0 16 16">\n    <path d="m7.646 9.354-3.792 3.792a.5.5 0 0 0 .353.854h7.586a.5.5 0 0 0 .354-.854L8.354 9.354a.5.5 0 0 0-.708 0z"/>\n    <path d="M11.414 11H14.5a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h3.086l-1 1H1.5A1.5 1.5 0 0 1 0 10.5v-7A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v7a1.5 1.5 0 0 1-1.5 1.5h-2.086l-1-1z"/>\n  </svg>\n</a>'])),t.inori.tenant.has_local_stream_processor()?"disabled":"",t.inori.tenant.standby_video_sharing.bind(t.inori,null),t.inori.tenant.has_local_stream_processor()?"disabled":"",function(){var e=zq(Hq().m(function e(n){return Hq().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.tenant.standby_screen_sharing(null);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()):W(Rq||(Rq=Uq(["",""])),e.role==t.inori.tenant.dataType().Role.values.SERVICE||e.role==t.inori.tenant.dataType().Role.values.BRIDGE||e.role==t.inori.tenant.dataType().Role.values.REST_API?W(Pq||(Pq=Uq(['\n<a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-terminal" viewBox="0 0 16 16">\n    <path d="M6 9a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3A.5.5 0 0 1 6 9M3.854 4.146a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708l-2-2z"/>\n    <path d="M2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z"/>\n  </svg>\n</a>'])),t.inori.tenant.standby_video_sharing.bind(t.inori,null)):W(Iq||(Iq=Uq([""])))));var r=e[n];if("lastUpdate"==n){var i=t.inori.util.formatUnix2Date(r);return W(Dq||(Dq=Uq(['<td class="fw-light">',"</td>"])),i)}return W(Oq||(Oq=Uq(['<td class="fw-light">',"</td>"])),r.length>20?r.substring(0,20)+"...":r)}))})}},{key:"processStream",value:(r=zq(Hq().m(function e(t){return Hq().w(function(e){for(;;)switch(e.n){case 0:this.requestUpdate();case 1:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"connectDevice",value:(n=zq(Hq().m(function e(t){return Hq().w(function(e){for(;;)switch(e.n){case 0:this.tenants_requested[t]=!0,this.dispatchEvent(new CustomEvent("local:stream:req",{detail:{tab_id:0,metadata:t}}));case 1:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this.inori.env.content.getL2();return W(Lq||(Lq=Uq(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <p class="card-text">',"</p>\n  <streaming-calendar></streaming-calendar>\n</main>"])),this.inori.env.content.get(),e)}}],[{key:"properties",get:function(){return{inori:{type:Object},tenants:{type:Object},tenants_requested:{type:Object}}}}]);var n,r,i}(ce);function lK(e){return lK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lK(e)}function cK(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function uK(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return hK(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(hK(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,hK(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,hK(h,"constructor",c),hK(c,"constructor",l),l.displayName="GeneratorFunction",hK(c,i,"GeneratorFunction"),hK(h),hK(h,i,"Generator"),hK(h,r,function(){return this}),hK(h,"toString",function(){return"[object Generator]"}),(uK=function(){return{w:s,m:d}})()}function hK(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}hK=function(e,t,n,r){function s(t,n){hK(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},hK(e,t,n,r)}function dK(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function fK(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){dK(s,r,i,a,o,"next",e)}function o(e){dK(s,r,i,a,o,"throw",e)}a(void 0)})}}function pK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,mK(r.key),r)}}function mK(e){var t=function(e){if("object"!=lK(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=lK(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==lK(t)?t:t+""}function gK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(gK=function(){return!!e})()}function vK(e){return vK=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},vK(e)}function _K(e,t){return _K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_K(e,t)}customElements.define("streaming-scheduler",oK);var bK,yK,wK,SK,xK,EK,CK,AK,MK,kK,TK,RK,PK,IK,DK,OK,LK,BK,NK,UK,HK,FK,jK,zK=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=vK(t),function(e,t){if(t&&("object"==lK(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,gK()?Reflect.construct(t,n||[],vK(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.tenants=null,e.tenants_requested={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_K(e,t)}(t,e),function(e,t,n){return t&&pK(e.prototype,t),n&&pK(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(i=fK(uK().m(function e(){return uK().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"renderTransactionHeader",value:function(){return this.tenants?["name","lastUpdate","sessionId","services"].map(function(e){return"sessionId"==e?W(Xq||(Xq=cK(['<th class="fw-lighter" scope="col">request</th>']))):W(Yq||(Yq=cK(['<th class="fw-lighter" scope="col">',"</th>"])),e)}):W($q||($q=cK([""])))}},{key:"renderTransactionContent",value:function(){var e=this.tenants,t=this;return e||(e={}),Object.values(e).map(function(e){return W(Zq||(Zq=cK(["<tr>","</tr>"])),["name","lastUpdate","sessionId","services"].map(function(n){if("sessionId"==n)return W(Jq||(Jq=cK(['<td class="fw-light"><a class="btn btn-link btn-sm py-0 ','" @click="','">',"</a></td>"])),t.inori.tenant.session_id()==e[n]?"disabled":"",t.connectDevice.bind(t,e[n]),e[n]);if("services"==n)return W(Qq||(Qq=cK(['<td class="fw-light align-bottom">',"</td>"])),t.inori.tenant.session_id()==e.sessionId?W(eK||(eK=cK(['   \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video" viewBox="0 0 16 16">\n    <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"/>\n  </svg>\n</a>      \n<a class="icon-link icon-link-hover m-1 ','" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cast" viewBox="0 0 16 16">\n    <path d="m7.646 9.354-3.792 3.792a.5.5 0 0 0 .353.854h7.586a.5.5 0 0 0 .354-.854L8.354 9.354a.5.5 0 0 0-.708 0z"/>\n    <path d="M11.414 11H14.5a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h3.086l-1 1H1.5A1.5 1.5 0 0 1 0 10.5v-7A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v7a1.5 1.5 0 0 1-1.5 1.5h-2.086l-1-1z"/>\n  </svg>\n</a>'])),t.inori.tenant.has_local_stream_processor()?"disabled":"",t.inori.tenant.standby_video_sharing.bind(t.inori,null),t.inori.tenant.has_local_stream_processor()?"disabled":"",function(){var e=fK(uK().m(function e(n){return uK().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.inori.tenant.standby_screen_sharing(null);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()):W(tK||(tK=cK(["",""])),e.role==t.inori.tenant.dataType().Role.values.SERVICE||e.role==t.inori.tenant.dataType().Role.values.BRIDGE||e.role==t.inori.tenant.dataType().Role.values.REST_API?W(nK||(nK=cK(['\n<a class="icon-link icon-link-hover m-1" style="--bs-icon-link-transform: translate3d(0, -.125rem, 0);" role="button" @click="','">\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-terminal" viewBox="0 0 16 16">\n    <path d="M6 9a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3A.5.5 0 0 1 6 9M3.854 4.146a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708l-2-2z"/>\n    <path d="M2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z"/>\n  </svg>\n</a>'])),t.inori.tenant.standby_video_sharing.bind(t.inori,null)):W(rK||(rK=cK([""])))));var r=e[n];if("lastUpdate"==n){var i=t.inori.util.formatUnix2Date(r);return W(iK||(iK=cK(['<td class="fw-light">',"</td>"])),i)}return W(sK||(sK=cK(['<td class="fw-light">',"</td>"])),r.length>20?r.substring(0,20)+"...":r)}))})}},{key:"processStream",value:(r=fK(uK().m(function e(t){return uK().w(function(e){for(;;)switch(e.n){case 0:this.requestUpdate();case 1:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"connectDevice",value:(n=fK(uK().m(function e(t){return uK().w(function(e){for(;;)switch(e.n){case 0:this.tenants_requested[t]=!0,this.dispatchEvent(new CustomEvent("local:stream:req",{detail:{tab_id:0,metadata:t}}));case 1:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this.inori.env.content.getL2();return W(aK||(aK=cK(['\n<main class="col-md-9 ms-sm-auto col-lg-10 py-md-4 px-md-4">\n  <h4 class="card-title mb-4">','</h4>\n  <p class="card-text">','</p>\n  <table class="table table-striped table-hover">\n      <thead>\n        <tr>\n          ',"\n        </tr>\n      </thead>\n      <tbody>\n        ","\n      </tbody>\n    </table>\n</main>"])),this.inori.env.content.get(),e,this.renderTransactionHeader(),this.renderTransactionContent())}}],[{key:"properties",get:function(){return{inori:{type:Object},tenants:{type:Object},tenants_requested:{type:Object}}}}]);var n,r,i}(ce);function VK(e){return VK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},VK(e)}function GK(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function WK(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function qK(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return KK(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(KK(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,KK(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,KK(h,"constructor",c),KK(c,"constructor",l),l.displayName="GeneratorFunction",KK(c,i,"GeneratorFunction"),KK(h),KK(h,i,"Generator"),KK(h,r,function(){return this}),KK(h,"toString",function(){return"[object Generator]"}),(qK=function(){return{w:s,m:d}})()}function KK(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}KK=function(e,t,n,r){function s(t,n){KK(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},KK(e,t,n,r)}function $K(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function XK(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){$K(s,r,i,a,o,"next",e)}function o(e){$K(s,r,i,a,o,"throw",e)}a(void 0)})}}function YK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ZK(r.key),r)}}function ZK(e){var t=function(e){if("object"!=VK(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=VK(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==VK(t)?t:t+""}function JK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(JK=function(){return!!e})()}function QK(e){return QK=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},QK(e)}function e$(e,t){return e$=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e$(e,t)}customElements.define("streaming-transactions",zK);var t$,n$,r$,i$,s$,a$,o$=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=QK(t),function(e,t){if(t&&("object"==VK(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,JK()?Reflect.construct(t,n||[],QK(e).constructor):t.apply(e,n))}(this,t)).processorInfo=null,e.inori=null,e.processorModalAlternative=null,e.liveSessionId="",e.fileDir="",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e$(e,t)}(t,e),function(e,t,n){return t&&YK(e.prototype,t),n&&YK(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"firstUpdated",value:function(){this.processorModalAlternative=new bootstrap.Modal("#processorModal")}},{key:"_deleteLocalResource",value:(o=XK(qK().m(function e(){return qK().w(function(e){for(;;)switch(e.n){case 0:if(!this.processorInfo.localFileStream){e.n=2;break}return e.n=1,this.processorInfo.delRecording();case 1:return this._deleteProcessor(),e.a(2);case 2:this.requestUpdate();case 3:return e.a(2)}},e,this)})),function(){return o.apply(this,arguments)})},{key:"_toggleStreaming",value:(a=XK(qK().m(function e(){var t;return qK().w(function(e){for(;;)switch(e.n){case 0:if("stream"==(t=this).processorInfo.status()){e.n=2;break}return e.n=1,t.processorInfo.resumeReplay();case 1:e.n=3;break;case 2:return e.n=3,t.processorInfo.stopReplay();case 3:t.requestUpdate();case 4:return e.a(2)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"_toggleRecording",value:(s=XK(qK().m(function e(){var t,n;return qK().w(function(e){for(;;)switch(e.n){case 0:if((n=(t=this).inori.tenant.get_subscription(t.sessionId)).mediaRecorder){e.n=1;break}t.processorInfo.startRecording(n.Id()),e.n=2;break;case 1:return e.n=2,t.processorInfo.stopRecording(n.Id());case 2:t.requestUpdate();case 3:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"renderTrainerModels",value:function(){var e=this;return this.trainerModels?W(yK||(yK=WK(['\n<div class="btn-group btn-group-sm" role="group">\n  <button class="btn btn-secondary dropdown-toggle ','" data-bs-toggle="dropdown" aria-expanded="false">\n    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-bounding-box" viewBox="0 0 16 16">\n      <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5M.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5"/>\n      <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>\n    </svg>\n  </button>\n  <ul class="dropdown-menu dropdown-menu-dark">\n    <li><a class="btn btn-secondary btn-sm dropdown-item" role="button" data-bs-toggle="button" @click="','">CoCo-ssd</a></li>\n    <li><hr class="dropdown-divider"></li>\n    <li class="ps-3 fw-lighter fs-6">MediaPipe</li>\n    <li><a class="btn btn-secondary btn-sm dropdown-item ps-4" role="button" data-bs-toggle="button" @click="','">Object Detector</a></li>\n    <li><hr class="dropdown-divider"></li>\n    ',"\n  </ul>\n</div>"])),this.processorInfo.isODEnabled?"text-danger":"",function(t){e._toggleOD(t,null,"coco-ssd")},function(t){e._toggleOD(t,null,"mediapipe")},this.trainerModels.map(function(t){return W(wK||(wK=WK(['\n    <li>\n      <a class="btn btn-secondary btn-sm dropdown-item" role="button" data-bs-toggle="button" @click="','">',"</a>\n    </li>"])),function(n){e._toggleOD(n,t)},t.tid)})):W(bK||(bK=WK([""])))}},{key:"renderPublishers",value:function(){var e,t=this,n=t.inori.util.dbg,r="",i=t.inori.tenant.get_active_services().find(function(e){return e.sessionId==t.processorInfo.dat.remoteId});return i&&(r=null===(e=i.device)||void 0===e?void 0:e.name),W(SK||(SK=WK(['\n<div class="btn-group btn-group-sm" role="group">\n  <button class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-broadcast" viewBox="0 0 16 16">\n      <path d="M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707m2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 1 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708m5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708m2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.313.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM10 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0"/>\n    </svg>\n  </button>\n  <ul class="dropdown-menu dropdown-menu-dark">    \n    <li><hr class="dropdown-divider"></li>\n    ',"  \n  </ul>\n</div>"])),t.inori.tenant.get_active_services().filter(function(e){return!!t.processorInfo.get_subscriber(e.sessionId)||e.opCode.includes("-np")&&r!=e.device.name}).map(function(e){var r=t.processorInfo.get_subscriber(e.sessionId);return W(xK||(xK=WK(['\n    <li><a class="btn btn-secondary btn-sm dropdown-item ','" role="button" @click="','">'," (",")</a></li>      \n      "])),t.liveSessionId==e.sessionId?"active":"",function(){var i=XK(qK().m(function i(s){var a;return qK().w(function(i){for(;;)switch(i.p=i.n){case 0:if(i.p=0,!r){i.n=4;break}if(t.liveSessionId!=e.sessionId){i.n=2;break}return i.n=1,r.liveStream(t.fileDir,!1);case 1:return t.liveSessionId="",i.a(2);case 2:return i.n=3,r.liveStream(t.fileDir,!0);case 3:i.n=6;break;case 4:if(!t.fileDir){i.n=5;break}t.processorInfo.liveStream(e.sessionId,t.fileDir),i.n=6;break;case 5:return i.n=6,t.processorInfo.publishStream(e.sessionId);case 6:t.liveSessionId=e.sessionId,t.requestUpdate(),i.n=8;break;case 7:i.p=7,a=i.v,n("this.liveSessionId not set; ".concat(a));case 8:return i.a(2)}},i,null,[[0,7]])}));return function(e){return i.apply(this,arguments)}}(),e.name,e.device.name)}))}},{key:"_toggleFullscreen",value:function(e){var t=this.inori.util.dbg,n=this.renderRoot.querySelector("#localVideo");document.fullscreenElement?document.exitFullscreen():n&&n.requestFullscreen().catch(function(e){t("failed to enable full-screen mode: ".concat(e.message))})}},{key:"renderPdxModel",value:function(){var e=this;if(!this.predictionDetail)return"";var t=this,n=t.processorInfo.get_subscriber(t.sessionId);if(!n)return"";var r=t.renderRoot.querySelector("#localVideo"),i=t.inori.util.capture_frame_area(t.predictionDetail.size,r);return W(EK||(EK=WK(['\n<div class="modal" id="modelPdxSetup" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h1 class="modal-title fs-5" id="staticBackdropLabel">Classification</h1>\n        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n      </div>\n      <div class="modal-body">\n        ','\n        <table class="table">\n          <tbody>\n            <tr>\n              <td class="fw-lighter text-end align-middle">Classify as</td>\n              <td class="fw-normal text-break"><input type="text" class="form-control-plaintext" id="classification" placeholder="my object"></td> \n            </tr> \n          </tbody>\n        </table>\n      </div>\n      <div class="modal-footer">\n      <button class="btn btn-secondary btn-sm" @click="','">Delete</button>\n      <button class="btn btn-secondary btn-sm" @click="','">Train</button>\n      <button class="btn btn-secondary btn-sm" @click="','" id="sendPdx">Sample</button>                              \n      </div>\n    </div>\n  </div>\n</div>'])),i?W(CK||(CK=WK(['<img class="img-thumbnail" src="','">'])),i):W(AK||(AK=WK([""]))),function(){var r=XK(qK().m(function r(i){var s;return qK().w(function(r){for(;;)switch(r.n){case 0:return s={bbox:t.predictionDetail.size},r.n=1,t.inori.util.unset_prediction(t.processorInfo,n,s,!1);case 1:e.predictionDetail.htmlTmpl.hide(),e.predictionDetail=null;case 2:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),function(){var e=XK(qK().m(function e(r){var i;return qK().w(function(e){for(;;)switch(e.n){case 0:return i={bbox:t.predictionDetail.size},t.processorInfo.trainerDoneCallback=function(e){t.predictionDetail=null},e.n=1,t.inori.util.train_prediction(t.processorInfo,n,i,!1);case 1:t.predictionDetail.htmlTmpl.hide();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),function(){var r=XK(qK().m(function r(i){var s,a;return qK().w(function(r){for(;;)switch(r.n){case 0:return s=t.renderRoot.querySelector("#classification"),a={bbox:t.predictionDetail.size,class:s.value,score:100},r.n=1,t.inori.util.set_prediction(t.processorInfo,n,a,!1);case 1:e.predictionDetail.htmlTmpl.hide();case 2:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}())}},{key:"createRenderRoot",value:function(){return this}},{key:"_deleteProcessor",value:(i=XK(qK().m(function e(){return qK().w(function(e){for(;;)switch(e.n){case 0:return this.inori.tenant.del_remote_processor(this.processorInfo.Id()),e.n=1,this.reset();case 1:return this.requestUpdate(),e.n=2,this.updateComplete;case 2:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"showPredictionDetail",value:(r=XK(qK().m(function e(t){var n,r,i=this;return qK().w(function(e){for(;;)switch(e.n){case 0:return n=this,this.predictionDetail={size:t},e.n=1,this.updateComplete;case 1:this.predictionDetailModel=!0,(r=n.renderRoot.querySelector("#modelPdxSetup"))&&(this.processorInfo.pauseTrainer(),this.predictionDetail.htmlTmpl=new bootstrap.Modal(r,{}),this.predictionDetail.htmlTmpl.show(),r.addEventListener("shown.bs.modal",function(e){}),r.addEventListener("hidden.bs.modal",function(){var e=XK(qK().m(function e(t){return qK().w(function(e){for(;;)switch(e.n){case 0:i.predictionDetailModel=!1,i.processorInfo.resumeTrainer(),i.liveSessionId="";case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"handleSwitchProcessor",value:(n=XK(qK().m(function e(t){var n,r,i,s,a,o,l,c;return qK().w(function(e){for(;;)switch(e.n){case 0:if(r=(n=this).inori.util.dbg,i=document.getElementById("processorModal"),s=t.detail.processorInfo,a=n.inori.tenant.get_file_type_values(),o=t.detail.fileId,n.fileDir=t.detail.fileDir,s&&t.detail.remoteId){e.n=1;break}return r("invalid processor and/or file"),e.a(2);case 1:if(l=n.inori.tenant.get_subscription(t.detail.remoteId)){e.n=5;break}if(t.detail.remoteId!=n.inori.tenant.session_id()){e.n=3;break}return e.n=2,s.add_subscriber(n.inori.tenant.session_id());case 2:l=e.v,e.n=4;break;case 3:return r("invalid subscriber ".concat(t.detail.remoteId)),e.a(2);case 4:e.n=6;break;case 5:if(s.get_subscriber(t.detail.remoteId)){e.n=6;break}return e.n=6,l.subscribe(s);case 6:if(!(t.detail.remoteId in n.localMediaStream)){e.n=8;break}if("none"===i.style.display&&!i.classList.contains("show")){e.n=7;break}return r("video modal is in use"),e.a(2);case 7:return n.remoteId==t.detail.remoteId&&n.processorInfo.dat.id==s.dat.id||(n.localMediaStream[l.Id()]=l.get_mediaStream(),n.remoteId=l.Id(),n.processorInfo=s),n.processorModalAlternative&&n.processorModalAlternative.show(i),e.a(2);case 8:return n.remoteId=l.Id(),n.processorInfo=s,n.localMediaStream[l.Id()]=l.get_mediaStream(),(c=n.renderRoot.querySelector("#localVideo")).addEventListener("play",function(){var e=XK(qK().m(function e(t){var r;return qK().w(function(e){for(;;)switch(e.n){case 0:if(!s.isLocalScreenStream&&!s.isLocalVideoStream){e.n=2;break}if(r=document.getElementById("drawing")){e.n=1;break}return e.a(2);case 1:return r.width=c.offsetWidth,r.height=c.offsetHeight,e.n=2,n.inori.util.get_prediction_size(r,c,function(e){n.inori.tenant.clog("prediction size: ".concat(JSON.stringify(e))),n.predictionDetailModel||n.showPredictionDetail(e)},function(e){var t;n.inori.tenant.clog("trim video size to: ".concat(JSON.stringify(e))),s.viewport.apply(s,function(e){if(Array.isArray(e))return GK(e)}(t=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return GK(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?GK(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())});case 2:n.inori.tenant.clog("start streaming");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),i.addEventListener("show.bs.modal",function(e){}),i.addEventListener("hidden.bs.modal",function(){var e=XK(qK().m(function e(t){var r;return qK().w(function(e){for(;;)switch(e.n){case 0:if((r=n.renderRoot.querySelector("#localVideo"))&&n.processorInfo&&n.processorInfo.retain_screenshot(r),!n.fileDir.includes("/dev/video")){e.n=1;break}return e.n=1,l.stopLiveCam(n.fileDir);case 1:return o&&n.inori.tenant.stop_remote_file(l.sessionId,o,a.VIDEO),n.requestUpdate(),e.n=2,n.updateComplete;case 2:n.liveSessionId="";case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),e.n=9,n.inori.util.get_trainer_models();case 9:n.trainerModels=e.v,n.processorModalAlternative&&n.processorModalAlternative.show(i),n.requestUpdate();case 10:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this,t=e.inori.util.dbg;return W(MK||(MK=WK(['\n    <div class="modal" id="processorModal" tabindex="-1" aria-labelledby="processorModalLabel" data-bs-backdrop="static" data-bs-keyboard="false">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h1 class="modal-title fs-5" id="processorModalLabel">','</h1>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @click="','"></button>\n          </div>\n          <div class="modal-body">\n            ','\n            <div class="position-relative">\n              <video id="localVideo" class="embed-responsive embed-responsive-16by9 border w-100 rounded" playsinline muted autoplay .srcObject="','"></video>              \n              <canvas id="drawing" class="position-absolute top-0 start-0 z-3"></canvas>\n            </div>\n          </div>\n          <div class="modal-footer">            \n          </div>\n        </div>\n      </div>\n    </div>\n    ',""])),e.processorInfo&&e.processorInfo.dat.name,function(t){e.liveSessionId="",e.requestUpdate()},e.processorInfo?W(kK||(kK=WK(['\n            <div class="btn-group btn-group-sm col-auto mb-3" role="group">\n              ','                       \n              <button class="btn btn-secondary" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>\n                  <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>\n                </svg>\n              </button>             \n              ','\n              <button class="btn btn-secondary" @click="','">',"\n              </button>\n              ","\n              ","        \n              ","\n              ",'\n              <button class="btn btn-secondary" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-fullscreen" viewBox="0 0 16 16">\n                  <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707m4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707m0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707m-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707"/>\n                </svg>\n              </button>\n              <button class="btn btn-secondary" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bootstrap-reboot" viewBox="0 0 16 16">\n                  <path d="M1.161 8a6.84 6.84 0 1 0 6.842-6.84.58.58 0 1 1 0-1.16 8 8 0 1 1-6.556 3.412l-.663-.577a.58.58 0 0 1 .227-.997l2.52-.69a.58.58 0 0 1 .728.633l-.332 2.592a.58.58 0 0 1-.956.364l-.643-.56A6.8 6.8 0 0 0 1.16 8z"/>\n                  <path d="M6.641 11.671V8.843h1.57l1.498 2.828h1.314L9.377 8.665c.897-.3 1.427-1.106 1.427-2.1 0-1.37-.943-2.246-2.456-2.246H5.5v7.352zm0-3.75V5.277h1.57c.881 0 1.416.499 1.416 1.32 0 .84-.504 1.324-1.386 1.324z"/>\n                </svg>\n              </button>\n            </div>\n            '])),e.processorInfo.localFileStream?W(TK||(TK=WK(['<button class="btn btn-secondary" @click="','">Delete Resource</button>'])),e._deleteLocalResource.bind(e)):W(RK||(RK=WK([""]))),e._deleteProcessor.bind(e),e.renderTrainerModels(),e._toggleRecording.bind(e),e.inori.tenant.get_subscription(e.sessionId)&&e.inori.tenant.get_subscription(e.sessionId).mediaRecorder?W(PK||(PK=WK(['\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause-circle" viewBox="0 0 16 16">\n                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                  <path d="M5 6.25a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0zm3.5 0a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0z"/>\n                </svg>']))):W(IK||(IK=WK(['\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-record-circle" viewBox="0 0 16 16">\n                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                  <path d="M11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>\n                </svg>']))),e.processorInfo.isLocalScreenStream||e.processorInfo.isLocalVideoStream?W(DK||(DK=WK(['\n              <button class="btn btn-secondary" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">\n                  <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z"/>\n                  <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466"/>\n                </svg>\n              </button>\n              '])),function(n){var r=e.processorInfo.reset_viewport();t("processor: ".concat(e.processorInfo.Id()," viewport reset to ").concat(JSON.stringify(r)))}):W(OK||(OK=WK([""]))),e.processorInfo.localFileStream?W(LK||(LK=WK(['<button class="btn btn-secondary" @click="','">',"</button>"])),e._toggleStreaming.bind(e),"stream"==e.processorInfo.status()?"Stop":"Start"):W(BK||(BK=WK([""]))),e.connected?W(NK||(NK=WK(['<button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#modelMessageHistory">Messaging</button>']))):W(UK||(UK=WK([""]))),e.renderPublishers(),function(t){return e._toggleFullscreen(t)},function(){var t=XK(qK().m(function t(n){var r,i;return qK().w(function(t){for(;;)switch(t.n){case 0:if(n.stopPropagation(),r=e.processorInfo.get_subscriber(),i=e.inori.util.dbg,r){t.n=1;break}return i("no subscriber available to communicate the reboot"),t.a(2);case 1:return t.n=2,r.rebootCtrl();case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()):W(HK||(HK=WK([""]))),e.localMediaStream[e.remoteId],e.processorInfo?W(FK||(FK=WK(["\n    ",""])),e.renderPdxModel()):W(jK||(jK=WK([""]))))}}],[{key:"properties",get:function(){return{inori:{type:Object},processorInfo:{type:Object},localMediaStream:{type:Object},processorModalAlternative:{type:Object}}}}]);var n,r,i,s,a,o}(ce);function l$(e){return l$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l$(e)}function c$(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function u$(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return h$(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(h$(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,h$(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,h$(h,"constructor",c),h$(c,"constructor",l),l.displayName="GeneratorFunction",h$(c,i,"GeneratorFunction"),h$(h),h$(h,i,"Generator"),h$(h,r,function(){return this}),h$(h,"toString",function(){return"[object Generator]"}),(u$=function(){return{w:s,m:d}})()}function h$(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}h$=function(e,t,n,r){function s(t,n){h$(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},h$(e,t,n,r)}function d$(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function f$(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){d$(s,r,i,a,o,"next",e)}function o(e){d$(s,r,i,a,o,"throw",e)}a(void 0)})}}function p$(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y$(r.key),r)}}function m$(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(m$=function(){return!!e})()}function g$(e,t,n,r){var i=v$(_$(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function v$(){return v$="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=_$(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},v$.apply(null,arguments)}function _$(e){return _$=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_$(e)}function b$(e,t){return b$=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b$(e,t)}function y$(e){var t=function(e){if("object"!=l$(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l$(t)?t:t+""}customElements.define("streaming-preview-modal",o$);var w$,S$,x$,E$,C$,A$,M$,k$,T$,R$,P$,I$,D$,O$,L$,B$,N$,U$,H$,F$,j$,z$,V$,G$,W$,q$,K$,$$,X$,Y$,Z$,J$,Q$,eX,tX,nX,rX,iX,sX,aX,oX,lX,cX,uX,hX,dX,fX,pX,mX,gX,vX,_X,bX,yX,wX,SX,xX,EX,CX,AX,MX,kX,TX,RX,PX,IX,DX,OX,LX,BX=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=_$(t),function(e,t){if(t&&("object"==l$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,m$()?Reflect.construct(t,n||[],_$(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.channels=[],window.addEventListener("tenant:data:channels:list:<rtmp_channels>",f$(u$().m(function t(){return u$().w(function(t){for(;;)switch(t.n){case 0:if(0!==e.inori.env.channels().length){t.n=2;break}return t.n=1,e.inori.util.delayFunction(100);case 1:t.n=0;break;case 2:e.channels=e.inori.env.channels(),e.inori.env.content.setIndex(25),e.requestUpdate();case 3:return t.a(2)}},t)})),{once:!0}),window.addEventListener("local:intd",f$(u$().m(function t(){return u$().w(function(t){for(;;)switch(t.n){case 0:return e.isProcessing=!1,e.initialised=!0,e.inori.mq.sys_dbg("inori initialised"),t.n=1,e.inori.util.init_comm(!1);case 1:if(!t.v){t.n=3;break}return t.n=2,e.inori.util.dir.load();case 2:e.inori.mq.sys_dbg("credential established"),e.requestUpdate();case 3:return t.a(2)}},t)})),{once:!0}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b$(e,t)}(t,e),function(e,t,n){return t&&p$(e.prototype,t),n&&p$(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"updated",value:function(e){(e.has("videoWidth")||e.has("videoHeight"))&&(this.style.setProperty("--video-width",this.videoWidth),this.style.setProperty("--video-height",this.videoHeight))}},{key:"createRenderRoot",value:function(){return this}},{key:"loadInori",value:(n=f$(u$().m(function e(){return u$().w(function(e){for(;;)switch(e.n){case 0:if(!this.inori){e.n=1;break}return e.a(2);case 1:return e.n=2,Qc();case 2:this.inori=e.v;case 3:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"connectedCallback",value:function(){var e=this;g$(t,"connectedCallback",this,3)([]),this.inori||this.loadInori(),window.addEventListener("resize",this._resizeHandler=function(){return e.requestUpdate()})}},{key:"disconnectedCallback",value:function(){window.removeEventListener("resize",this._resizeHandler),g$(t,"disconnectedCallback",this,3)([])}},{key:"_initializePlayer",value:function(e){var t=this.querySelector('.twitch-embed[data-channel="'.concat(e,'"]'));t&&!t.dataset.playerInitialized&&(new Twitch.Player(t,{width:this.videoWidth,height:this.videoHeight,channel:e,parent:["portal.hiddenclouds.io"]}).setVolume(0),t.dataset.playerInitialized="true")}},{key:"render",value:function(){var e=this;if(!this.inori)return W(t$||(t$=c$([""])));var t=this,n=t.inori.env.content.getL2(),r=t.inori.tenant.subject(),i=r&&r.trole&&r.trole.val||"guest";return W(n$||(n$=c$(['\n      <main class="ms-sm-auto ',' py-md-4 px-md-4">\n        <h4 class="card-title mb-4">','</h4>\n        <p class="card-text">','</p>\n        <div class="container-fluid text-center">\n          <div class="row g-0 justify-content-center">\n            ',"\n          </div>\n        </div>        \n      </main>\n    "])),t.isPublic?"col-auto":"col-md-9 col-lg-10",this.inori.env.content.get(),n,this.channels.map(function(n){return setTimeout(function(){return e._initializePlayer(n.name)},0),W(r$||(r$=c$(['\n              <div class="col-auto p-0">\n                <div class="position-relative twitch-embed" data-channel="','">\n                  ',"\n                </div>\n              </div>\n            "])),n.name,"admin"!=i.toLowerCase()?W(i$||(i$=c$([""]))):W(s$||(s$=c$(['\n                  <div class="position-absolute m-3 bottom-0 start-0 btn-group" @click="','">\n                    <button type="button" class="btn btn-sm btn-secondary">\n                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop-circle" viewBox="0 0 16 16">\n                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                        <path d="M5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5z"/>\n                      </svg>\n                    </button>\n                  </div>'])),function(e){t.inori.tenant.kill_channel(n.name).then(function(e){return e&&t.inori.tenant.clog("channel terminated successfully.")})}))}))}}],[{key:"properties",get:function(){return{videoWidth:{type:Number,reflect:!0},videoHeight:{type:Number,reflect:!0},isPublic:{type:Boolean},inori:{type:Object},channels:{type:Array}}}}]);var n}(ce);function NX(e){return NX="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},NX(e)}function UX(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function HX(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return FX(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(FX(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,FX(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,FX(h,"constructor",c),FX(c,"constructor",l),l.displayName="GeneratorFunction",FX(c,i,"GeneratorFunction"),FX(h),FX(h,i,"Generator"),FX(h,r,function(){return this}),FX(h,"toString",function(){return"[object Generator]"}),(HX=function(){return{w:s,m:d}})()}function FX(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}FX=function(e,t,n,r){function s(t,n){FX(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},FX(e,t,n,r)}function jX(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function zX(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){jX(s,r,i,a,o,"next",e)}function o(e){jX(s,r,i,a,o,"throw",e)}a(void 0)})}}function VX(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,GX(r.key),r)}}function GX(e){var t=function(e){if("object"!=NX(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=NX(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==NX(t)?t:t+""}function WX(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(WX=function(){return!!e})()}function qX(){return qX="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=KX(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},qX.apply(null,arguments)}function KX(e){return KX=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},KX(e)}function $X(e,t){return $X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$X(e,t)}!function(e,t,n){(t=y$(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(BX,"styles",o(a$||(a$=c$(["\n    :host {\n      display: block;\n    }\n\n    .twitch-embed {\n      width: 100%;\n      height: 100%;\n    }\n  "])))),customElements.define("streaming-channels",BX);var XX,YX=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=KX(t),function(e,t){if(t&&("object"==NX(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,WX()?Reflect.construct(t,n||[],KX(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.iceOffer=null,e.processorInfo=null,e.remoteProcessorList=null,e.tenants_requested={},e.processorListCollapse=!0,e.notifications=[],e.logs=[],e.leads={},e.localMediaStream={},e.remoteId="",e.trainerModels=null,e.processorModalAlternative=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$X(e,t)}(t,e),function(e,t,n){return t&&VX(e.prototype,t),n&&VX(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"firstUpdated",value:function(){}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(s=zX(HX().m(function e(){return HX().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:this.notifications=this.inori.tenant.notifications(),this.inori.env.content.setIndex(2),this.requestUpdate();case 2:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"connectedCallback",value:function(){!function(e,t,n){var r=qX(KX(e.prototype),"connectedCallback",n);return"function"==typeof r?function(e){return r.apply(n,e)}:r}(t,0,this)([])}},{key:"renderContent",value:function(){var e=this,t=this;switch(this.inori.env.content.getIndex()){case 0:return this.remoteProcessorList=this.inori.tenant.get_remote_processors(),W(w$||(w$=UX(['<streaming-services @tenant:data:processor:content="','" \n                      @local:stream:switch="','" \n                      @local:stream:reset="','" \n                      @tenant:tcp:forward:req:confimed:*token*="','"                     \n                      .inori="','" .processorInfo="','" \n                      .remoteProcessorList="','" \n                      .iceOffer="','"></streaming-services>'])),function(t){e.handleUpdRemoteProcessorList(t)},function(e){t.handleSwitchProcessor(e)},this.handleResetStream.bind(this),function(e){t.handleRemoteAccessInfo(e)},t.inori,t.processorInfo,t.remoteProcessorList,t.iceOffer);case 1:return W(S$||(S$=UX(['<streaming-tenants @local:stream:req="','" .tenants_requested=',' .tenants="','" .inori="','" @local:stream:switch="','"></streaming-tenants>'])),this.handleReqStream.bind(this),this.tenants_requested,t.inori.tenant.get_active_tenants(),t.inori,function(t){e.handleSwitchProcessor(t.detail.processorInfo)});case 6:return W(x$||(x$=UX(["<streaming-logs .tenants_requested=",' .logs="','" .inori="','"></streaming-events>'])),this.tenants_requested,t.logs,t.inori);case 7:return t.leads=this.inori.util.sql.get_leads(),W(E$||(E$=UX(['<streaming-providers @tenant:data:leads:content:*leads*="','" .leads="','" .inori="','"></streaming-providers>'])),t.handleLeads.bind(this),t.leads,t.inori);case 8:return W(C$||(C$=UX(['<streaming-training .inori="','"></streaming-training>'])),t.inori);case 20:return W(A$||(A$=UX(['<streaming-virtual-reality .inori="','"></streaming-virtual-reality>'])),t.inori);case 21:return W(M$||(M$=UX(['<streaming-hardware .inori="','"></streaming-hardware>'])),t.inori);case 22:return W(k$||(k$=UX(['<streaming-geography .inori="','"></streaming-geography>'])),t.inori);case 23:return W(T$||(T$=UX(['<streaming-scheduler .inori="','"></streaming-scheduler>'])),t.inori);case 24:return W(R$||(R$=UX(['<streaming-transactions .inori="','"></streaming-transactions>'])),t.inori);case 25:return W(P$||(P$=UX(['<streaming-channels .inori="','" .channels="','" .isPublic="','" videoWidth="320" videoHeight="240"></streaming-channels>'])),t.inori,t.inori.env.channels(),!1);case 19:return W(I$||(I$=UX(['<streaming-drives .inori="','" @local:stream:switch="','"></streaming-drives>'])),t.inori,function(e){t.handleSwitchProcessor(e)});case 10:return W(D$||(D$=UX(['<streaming-events .inori="','"></streaming-events>'])),t.inori);case 11:return W(O$||(O$=UX(['<streaming-setting .inori="','" @exiting-session-event="','"></streaming-setting>'])),t.inori,this.handleExitingSessionEvent);case 9:return W(L$||(L$=UX(['<streaming-terminal .inori="','"></streaming-terminal>'])),t.inori);case 2:return W(B$||(B$=UX(['<streaming-dashboard .inori="','"></streaming-dashboard>'])),t.inori);case 12:case 13:return W(N$||(N$=UX([""])));case 3:return W(U$||(U$=UX(['<streaming-licenses .inori="','" .licenses="','"></streaming-licenses>'])),t.inori,t.inori.tenant.get_subjects());default:return W(H$||(H$=UX(["<p>content unavaialble.</p>"])))}}},{key:"handleExitingSessionEvent",value:function(e){this.dispatchEvent(new CustomEvent("exiting-session-event",{}))}},{key:"initContentClass",value:function(e){return this.inori.env.content.getIndex()==e?"nav-link active":"nav-link"}},{key:"switchContent",value:function(e){this.inori.env.content.setIndex(e),this.requestUpdate()}},{key:"handleLeads",value:function(e){this.leads=this.inori.util.sql.get_leads(),this.requestUpdate()}},{key:"handleReqStream",value:function(e){this.processorInfo=this.inori.tenant.add_processor(e.detail.metadata),this.iceOffer=null,this.tenants_requested[e.detail.metadata]=!0,this.inori.env.content.setIndex(e.detail.tab_id),this.requestUpdate()}},{key:"handleLiveStreamReq",value:function(e){}},{key:"handleReqStreamProcess",value:function(e){"tenant:data:ice_offer:content:<ice_offer>"===e.detail.metadata.msg&&(this.processorInfo=this.inori.tenant.add_processor(e.detail.metadata.from),this.iceOffer=e.detail.metadata.metadata,this.inori.env.content.setIndex(e.detail.tab_id),this.requestUpdate())}},{key:"handleReqStreamRead",value:function(e){this.requestUpdate()}},{key:"handleResetStream",value:function(e){var t,n,r;this.processorInfo&&(null!==(t=this.processorInfo)&&void 0!==t&&t.isLocalVideoStream||null!==(n=this.processorInfo)&&void 0!==n&&n.isLocalScreenStream||null!==(r=this.processorInfo)&&void 0!==r&&r.localFileStream||this.inori.tenant.del_processor(this.processorInfo),this.processorInfo=null),this.requestUpdate()}},{key:"handleResetStreamNotify",value:function(e){}},{key:"handleNotify",value:function(e){this.notifications=this.inori.tenant.notifications(),this.requestUpdate()}},{key:"handleRemoteAccessInfo",value:function(e){var t=this.inori.util.dbg;e.detail.content&&e.detail.sender?this.renderRemoteAccessInfo(e.detail.sender,"Remote Access",e.detail.content):t("StreamingBody > handleRemoteAccessInfo > invalid token/service")}},{key:"handleSwitchProcessor",value:(i=zX(HX().m(function e(t){var n;return HX().w(function(e){for(;;)switch(e.n){case 0:if(!(n=document.querySelector("streaming-preview-modal"))){e.n=1;break}return e.n=1,n.handleSwitchProcessor(t);case 1:return e.a(2)}},e)})),function(e){return i.apply(this,arguments)})},{key:"handleUpdRemoteProcessorList",value:function(e){this.remoteProcessorList=this.inori.tenant.get_remote_processors()}},{key:"renderProcessorList",value:function(){return this.processorListCollapse?W(F$||(F$=UX(['\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" class="bi bi-arrow-right-short align-text-bottom me-1" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"/>\n</svg>']))):W(j$||(j$=UX(['\n      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" class="bi bi-arrow-down-short align-text-bottom me-1" viewBox="0 0 16 16">\n        <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"/>\n      </svg>'])))}},{key:"renderProcessorIndex",value:function(e){var t=this;return!t.processorInfo||!e&&t.processorInfo.id!==e.id?W(z$||(z$=UX(['\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down-short align-text-bottom me-1" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"/>\n</svg>'," min ago"])),t.inori.util.calculateElapsedMinutes(e.dat.lastUpdate)):W(V$||(V$=UX(['\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" class="bi bi-arrow-right-short align-text-bottom me-1" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"/>\n</svg>'," min ago"])),t.inori.util.calculateElapsedMinutes(e.dat.lastUpdate))}},{key:"renderProcessors",value:function(){var e=this,t=this.inori.tenant.get_processors();return W(G$||(G$=UX(['\n<ul class="nav nav-pills flex-column ps-4">\n  ',"\n</ul>"])),Object.values(t).map(function(t){return W(W$||(W$=UX(['\n  <li class="nav-item">\n    <a role="button" class="nav-link" @click="','">\n      ',"\n    </a>\n  </li>"])),e.handleSwitchProcessor.bind(e,t),e.renderProcessorIndex(t))}))}},{key:"renderIcon",value:function(e){switch(e){case 2:return W(q$||(q$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-door me-1" viewBox="0 0 16 16">      \n          <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4z"/>\n        </svg>'])));case 1:return W(K$||(K$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-database-gear me-1" viewBox="0 0 16 16">\n          <path d="M12.096 6.223A5 5 0 0 0 13 5.698V7c0 .289-.213.654-.753 1.007a4.5 4.5 0 0 1 1.753.25V4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.5 4.5 0 0 1-.813-.927Q8.378 15 8 15c-1.464 0-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13h.027a4.6 4.6 0 0 1 0-1H8c-1.464 0-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10q.393 0 .774-.024a4.5 4.5 0 0 1 1.102-1.132C9.298 8.944 8.666 9 8 9c-1.464 0-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777M3 4c0-.374.356-.875 1.318-1.313C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4"/>\n          <path d="M11.886 9.46c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>\n        </svg>'])));case 0:return W($$||($$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cpu me-1" viewBox="0 0 16 16">        \n          <path d="M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14a2.5 2.5 0 0 1-2.5 2.5v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0zm-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3h-7zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5v-3zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>\n        </svg>'])));case 10:return W(X$||(X$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-quote me-1" viewBox="0 0 16 16">\n          <path d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105"/>\n          <path d="M7.066 6.76A1.665 1.665 0 0 0 4 7.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 0 0 .6.58c1.486-1.54 1.293-3.214.682-4.112zm4 0A1.665 1.665 0 0 0 8 7.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 0 0 .6.58c1.486-1.54 1.293-3.214.682-4.112z"/>\n        </svg>'])));case 6:return W(Y$||(Y$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-activity me-1" viewBox="0 0 16 16">\n          <path fill-rule="evenodd" d="M6 2a.5.5 0 0 1 .47.33L10 12.036l1.53-4.208A.5.5 0 0 1 12 7.5h3.5a.5.5 0 0 1 0 1h-3.15l-1.88 5.17a.5.5 0 0 1-.94 0L6 3.964 4.47 8.171A.5.5 0 0 1 4 8.5H.5a.5.5 0 0 1 0-1h3.15l1.88-5.17A.5.5 0 0 1 6 2"/>\n        </svg>'])));case 7:return W(Z$||(Z$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear me-1" viewBox="0 0 16 16">\n          <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>\n          <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>\n        </svg>'])));case 8:return W(J$||(J$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bar-chart me-1" viewBox="0 0 16 16">\n          <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>\n        </svg>'])));case 3:return W(Q$||(Q$=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people me-1" viewBox="0 0 16 16">\n          <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>\n        </svg>'])));case 5:return W(eX||(eX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-briefcase me-1" viewBox="0 0 16 16">\n          <path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5m1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0M1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5"/>\n        </svg>'])));case 9:return W(tX||(tX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-terminal me-1" viewBox="0 0 16 16">\n          <path d="M6 9a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3A.5.5 0 0 1 6 9M3.854 4.146a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708l-2-2z"/>\n          <path d="M2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z"/>\n        </svg>'])));case 12:return W(nX||(nX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-code me-1" viewBox="0 0 16 16">\n          <path d="M6.646 5.646a.5.5 0 1 1 .708.708L5.707 8l1.647 1.646a.5.5 0 0 1-.708.708l-2-2a.5.5 0 0 1 0-.708zm2.708 0a.5.5 0 1 0-.708.708L10.293 8 8.646 9.646a.5.5 0 0 0 .708.708l2-2a.5.5 0 0 0 0-.708z"/>\n          <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1"/>\n        </svg>'])));case 13:return W(rX||(rX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-code me-1" viewBox="0 0 16 16">\n          <path d="M6.646 5.646a.5.5 0 1 1 .708.708L5.707 8l1.647 1.646a.5.5 0 0 1-.708.708l-2-2a.5.5 0 0 1 0-.708zm2.708 0a.5.5 0 1 0-.708.708L10.293 8 8.646 9.646a.5.5 0 0 0 .708.708l2-2a.5.5 0 0 0 0-.708z"/>\n          <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1"/>\n        </svg>'])));case 11:return W(iX||(iX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-app-indicator me-1" viewBox="0 0 16 16">\n          <path d="M5.5 2A3.5 3.5 0 0 0 2 5.5v5A3.5 3.5 0 0 0 5.5 14h5a3.5 3.5 0 0 0 3.5-3.5V8a.5.5 0 0 1 1 0v2.5a4.5 4.5 0 0 1-4.5 4.5h-5A4.5 4.5 0 0 1 1 10.5v-5A4.5 4.5 0 0 1 5.5 1H8a.5.5 0 0 1 0 1z"/>\n          <path d="M16 3a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>\n        </svg>'])));case 102:return W(sX||(sX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-up" viewBox="0 0 16 16">\n          <path fill-rule="evenodd" d="M3.5 10a.5.5 0 0 1-.5-.5v-8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 0 0 1h2A1.5 1.5 0 0 0 14 9.5v-8A1.5 1.5 0 0 0 12.5 0h-9A1.5 1.5 0 0 0 2 1.5v8A1.5 1.5 0 0 0 3.5 11h2a.5.5 0 0 0 0-1z"/>\n          <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708z"/>\n        </svg>'])));case 101:return W(aX||(aX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-down" viewBox="0 0 16 16">\n          <path fill-rule="evenodd" d="M3.5 6a.5.5 0 0 0-.5.5v8a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-8a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 1 0-1h2A1.5 1.5 0 0 1 14 6.5v8a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-8A1.5 1.5 0 0 1 3.5 5h2a.5.5 0 0 1 0 1z"/>\n          <path fill-rule="evenodd" d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>\n        </svg>'])));case 100:return W(oX||(oX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-door-open me-1" viewBox="0 0 16 16">\n          <path d="M8.5 10c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1z"/>\n          <path d="M10.828.122A.5.5 0 0 1 11 .5V1h.5A1.5 1.5 0 0 1 13 2.5V15h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117zM11.5 2H11v13h1V2.5a.5.5 0 0 0-.5-.5zM4 1.934V15h6V1.077l-6 .857z"/>\n        </svg>'])));case 20:return W(lX||(lX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-vr me-1" viewBox="0 0 16 16">\n          <path d="M3 12V4a1 1 0 0 1 1-1h2.5V2H4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2.5v-1H4a1 1 0 0 1-1-1m6.5 1v1H12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H9.5v1H12a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1zM8 16a.5.5 0 0 1-.5-.5V.5a.5.5 0 0 1 1 0v15a.5.5 0 0 1-.5.5"/>\n        </svg>'])));case 21:return W(cX||(cX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gpu-card me-1" viewBox="0 0 16 16">\n          <path d="M4 8a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0m7.5-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/>\n          <path d="M0 1.5A.5.5 0 0 1 .5 1h1a.5.5 0 0 1 .5.5V4h13.5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5H2v2.5a.5.5 0 0 1-1 0V2H.5a.5.5 0 0 1-.5-.5m5.5 4a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M9 8a2.5 2.5 0 1 0 5 0 2.5 2.5 0 0 0-5 0"/>\n          <path d="M3 12.5h3.5v1a.5.5 0 0 1-.5.5H3.5a.5.5 0 0 1-.5-.5zm4 1v-1h4v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5"/>\n        </svg>'])));case 19:return W(uX||(uX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hdd me-1" viewBox="0 0 16 16">\n          <path d="M4.5 11a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1M3 10.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>\n          <path d="M16 11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V9.51c0-.418.105-.83.305-1.197l2.472-4.531A1.5 1.5 0 0 1 4.094 3h7.812a1.5 1.5 0 0 1 1.317.782l2.472 4.53c.2.368.305.78.305 1.198zM3.655 4.26 1.592 8.043Q1.79 8 2 8h12q.21 0 .408.042L12.345 4.26a.5.5 0 0 0-.439-.26H4.094a.5.5 0 0 0-.44.26zM1 10v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1"/>\n        </svg>'])));case 22:return W(hX||(hX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt me-1" viewBox="0 0 16 16">\n          <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10"/>\n          <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>\n        </svg>'])));case 23:return W(dX||(dX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-alarm me-1" viewBox="0 0 16 16">\n          <path d="M8.5 5.5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9z"/>\n          <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07a7.001 7.001 0 0 0-3.273 12.474l-.602.602a.5.5 0 0 0 .707.708l.746-.746A6.97 6.97 0 0 0 8 16a6.97 6.97 0 0 0 3.422-.892l.746.746a.5.5 0 0 0 .707-.708l-.601-.602A7.001 7.001 0 0 0 9 2.07V1h.5a.5.5 0 0 0 0-1zm1.038 3.018a6 6 0 0 1 .924 0 6 6 0 1 1-.924 0M0 3.5c0 .753.333 1.429.86 1.887A8.04 8.04 0 0 1 4.387 1.86 2.5 2.5 0 0 0 0 3.5M13.5 1c-.753 0-1.429.333-1.887.86a8.04 8.04 0 0 1 3.527 3.527A2.5 2.5 0 0 0 13.5 1"/>\n        </svg>'])));case 24:return W(fX||(fX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-dollar me-1" viewBox="0 0 16 16">\n          <path d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73z"/>\n        </svg>'])));case 25:return W(pX||(pX=UX(['\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-display me-1" viewBox="0 0 16 16">\n          <path d="M0 4s0-2 2-2h12s2 0 2 2v6s0 2-2 2h-4q0 1 .25 1.5H11a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1h.75Q6 13 6 12H2s-2 0-2-2zm1.398-.855a.76.76 0 0 0-.254.302A1.5 1.5 0 0 0 1 4.01V10c0 .325.078.502.145.602q.105.156.302.254a1.5 1.5 0 0 0 .538.143L2.01 11H14c.325 0 .502-.078.602-.145a.76.76 0 0 0 .254-.302 1.5 1.5 0 0 0 .143-.538L15 9.99V4c0-.325-.078-.502-.145-.602a.76.76 0 0 0-.302-.254A1.5 1.5 0 0 0 13.99 3H2c-.325 0-.502.078-.602.145"/>\n        </svg>'])))}}},{key:"_toggleOD",value:(r=zX(HX().m(function e(t,n,r){var i;return HX().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!this.processorInfo.isODEnabled){e.n=2;break}return e.n=1,this.processorInfo.disableOD();case 1:e.n=3;break;case 2:return e.n=3,this.processorInfo.enableOD(!1,n,r);case 3:e.n=5;break;case 4:e.p=4,i=e.v,this.inori.tenant.clog("_toggleOD > err ".concat(i));case 5:return this.requestUpdate(),e.n=6,this.updateComplete;case 6:return e.a(2)}},e,this,[[0,4]])})),function(e,t,n){return r.apply(this,arguments)})},{key:"renderRemoteAccessInfo",value:(n=zX(HX().m(function e(t,n,r){var i,s,a,o,l,c;return HX().w(function(e){for(;;)switch(e.n){case 0:return document.querySelectorAll(".remote-btn").forEach(function(e){var t=bootstrap.Popover.getInstance(e);t&&t.tip&&t.hide()}),s=!1,o=(a=this).inori.util.dbg,l=bootstrap.Popover.getOrCreateInstance("#remote-btn-".concat(t),{placement:"top",trigger:"manual",html:!0,title:n,content:'<span id="remote-tkn-elm" class="text-break">'.concat(r.length>10?r.slice(0,10)+"...":r,'</span> <a id="remote-tkn-cpy-').concat(t,'" class="btn btn-link">[copy]</a>')}),null===(i=document.getElementById("remote-btn-".concat(t)))||void 0===i||i.addEventListener("shown.bs.popover",function(){o("shown.bs.popover called"),setTimeout(function(){s||l.hide()},5e3)}),l.show(),a.requestUpdate(),e.n=1,a.updateComplete;case 1:c=document.getElementById("remote-tkn-cpy-".concat(t)),document.getElementById("remote-tkn-elm")&&c&&c.addEventListener("click",function(e){var n="./inout -tkn ".concat(btoa("".concat(t,":").concat(r))," -api https://api.hiddenclouds.io/v1 -pxy 7990:host.docker.internal:5900");s=!0,navigator.clipboard.writeText(n).then(function(){c.innerText="[copied!]",c.style.fontStyle="italic",setTimeout(function(){l.hide()},1500)}).catch(function(e){return o("copy failed:",e)})});case 2:return e.a(2)}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"render",value:function(){var e,t,n=this;return 12==n.inori.env.content.getIndex()&&(e=n.inori.env.content.get(12),t="v0"),13==n.inori.env.content.getIndex()&&(e=n.inori.env.content.get(13),t="v1"),W(mX||(mX=UX(['  \n  <div class="container-fluid">\n    <div class="row">   \n      <nav id="sidebarMenu" class="border-1 border-top border-darkgrey col-md-3 col-lg-2 d-md-block bg-body-tertiary sidebar collapse">\n        <div class="position-sticky pt-3 sidebar-sticky">\n          <ul class="nav flex-column">\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">                \n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" data-bs-toggle="collapse" data-bs-target="#processors-collapse" role="button" @click="','">\n                 ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">                \n                 ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n                <span class="position-absolute mt-3 start-50 translate-middle badge rounded-pill bg-warning">\n                  ','\n                </span>\n                <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>         \n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"               \n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"               \n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="','" role="button" @click="','">\n                ',"               \n                ",'\n              </a>\n            </li>\n          </ul>\n          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-body-secondary text-uppercase">\n            <span>API Doc</span>\n            <a class="link-secondary" role="button" aria-label="Add a new report">              \n              ','\n            </a>\n          </h6>\n          <ul class="nav flex-column mb-2">\n            <li class="nav-item">\n              <a class="nav-link ','" role="button" @click="','">                \n                '," \n                ",'\n              </a>\n            </li>\n             <li class="nav-item">\n              <a class="nav-link ','" role="button" @click="','">                \n                '," \n                ",'\n              </a>\n            </li>\n          </ul>\n          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-body-secondary text-uppercase">\n            <span>System info</span>\n            <a class="link-secondary" role="button" aria-label="System info">              \n              ',' \n            </a>\n          </h6>\n          <ul class="nav flex-column mb-2">\n            <li class="nav-item">\n              <a class="nav-link ','" role="button" @click="','">                \n                ',"\n                ",'\n              </a>\n            </li>\n            <li class="nav-item">\n              <a class="nav-link" role="button" @click="','">\n                ',' \n                Sign out\n              </a>\n            </li>\n          </ul>\n        </div>\n      </nav>\n    </div>\n  </div>\n  <streaming-notify .inori="','" @local:stream:notify:process=',' @local:stream:notify:reset="','" @local:stream:notify="','" .notifications="','"></streaming-notify>\n  ','\n  <streaming-preview-modal @tenant:data:ice_offer:req:*processor_id*="','" .processorModalAlternative="','" .localMediaStream="','" .inori="','" .processorInfo="','"></streaming-preview-modal>\n  <streaming-api class="','" .inori="','" .title="','" .rev="','"></streaming-api>\n  <streaming-toolbar .inori="','" @browser-release-event="','"></streaming-toolbar>\n  '])),this.initContentClass(2),this.switchContent.bind(this,2),this.renderIcon(2),W(gX||(gX=UX(["",""])),this.inori.env.content.get(2)),this.initContentClass(1),this.switchContent.bind(this,1),this.renderIcon(1),W(vX||(vX=UX(["",""])),this.inori.env.content.get(1)),this.initContentClass(0),this.switchContent.bind(this,0),this.renderIcon(0),W(_X||(_X=UX(["",""])),this.inori.env.content.get(0)),this.initContentClass(10),this.switchContent.bind(this,10),this.renderIcon(10),W(bX||(bX=UX(["",""])),this.inori.env.content.get(10)),this.logs.length,this.initContentClass(6),this.switchContent.bind(this,6),this.renderIcon(6),W(yX||(yX=UX(["",""])),this.inori.env.content.get(6)),this.initContentClass(8),this.switchContent.bind(this,8),this.renderIcon(8),W(wX||(wX=UX(["",""])),this.inori.env.content.get(8)),this.initContentClass(7),this.switchContent.bind(this,7),this.renderIcon(7),W(SX||(SX=UX(["",""])),this.inori.env.content.get(7)),this.initContentClass(20),this.switchContent.bind(this,20),this.renderIcon(20),W(xX||(xX=UX(["",""])),this.inori.env.content.get(20)),this.initContentClass(19),this.switchContent.bind(this,19),this.renderIcon(19),W(EX||(EX=UX(["",""])),this.inori.env.content.get(19)),this.initContentClass(25),this.switchContent.bind(this,25),this.renderIcon(25),W(CX||(CX=UX(["",""])),this.inori.env.content.get(25)),this.initContentClass(21),this.switchContent.bind(this,21),this.renderIcon(21),W(AX||(AX=UX(["",""])),this.inori.env.content.get(21)),this.initContentClass(3),this.switchContent.bind(this,3),this.renderIcon(3),W(MX||(MX=UX(["",""])),this.inori.env.content.get(3)),this.initContentClass(22),this.switchContent.bind(this,22),this.renderIcon(22),W(kX||(kX=UX(["",""])),this.inori.env.content.get(22)),this.initContentClass(5),this.switchContent.bind(this,5),this.renderIcon(5),W(TX||(TX=UX(["",""])),this.inori.env.content.get(5)),this.initContentClass(9),this.switchContent.bind(this,9),this.renderIcon(9),W(RX||(RX=UX(["",""])),this.inori.env.content.get(9)),this.initContentClass(23),this.switchContent.bind(this,23),this.renderIcon(23),W(PX||(PX=UX(["",""])),this.inori.env.content.get(23)),this.initContentClass(24),this.switchContent.bind(this,24),this.renderIcon(24),W(IX||(IX=UX(["",""])),this.inori.env.content.get(24)),this.renderIcon(102),this.initContentClass(12),this.switchContent.bind(this,12),this.renderIcon(12),W(DX||(DX=UX(["",""])),this.inori.env.content.get(12)),this.initContentClass(13),this.switchContent.bind(this,13),this.renderIcon(13),W(OX||(OX=UX(["",""])),this.inori.env.content.get(13)),this.renderIcon(101),this.initContentClass(11),this.switchContent.bind(this,11),this.renderIcon(11),W(LX||(LX=UX(["",""])),this.inori.env.content.get(11)),function(e){n.dispatchEvent(new CustomEvent("exiting-session-event",{}))},this.renderIcon(100),this.inori,this.handleReqStreamProcess.bind(this),this.handleResetStreamNotify.bind(this),this.handleNotify.bind(this),this.notifications.filter(function(e){return!e.has_read&&!e.has_notified}),n.renderContent(),function(e){return n.handleLiveStreamReq(e)},n.processorModalAlternative,n.localMediaStream,n.inori,n.processorInfo,t?"d-block":"d-none",n.inori,e,t,this.inori,this.handleBrowserReleaseEvent)}}],[{key:"properties",get:function(){return{inori:{type:Object},keypairsInfo:{type:Object},processorInfo:{type:Object},iceOffer:{type:Object},tenants_requested:{type:Object},remoteProcessorList:{type:Object},logs:{type:Object},siteCode:{type:String},localMediaStream:{type:Object},processorModalAlternative:{type:Object}}}}]);var n,r,i,s}(ce);function ZX(e){return ZX="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ZX(e)}function JX(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return QX(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(QX(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,QX(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,QX(h,"constructor",c),QX(c,"constructor",l),l.displayName="GeneratorFunction",QX(c,i,"GeneratorFunction"),QX(h),QX(h,i,"Generator"),QX(h,r,function(){return this}),QX(h,"toString",function(){return"[object Generator]"}),(JX=function(){return{w:s,m:d}})()}function QX(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}QX=function(e,t,n,r){function s(t,n){QX(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},QX(e,t,n,r)}function eY(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function tY(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,nY(r.key),r)}}function nY(e){var t=function(e){if("object"!=ZX(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ZX(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ZX(t)?t:t+""}function rY(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(rY=function(){return!!e})()}function iY(e){return iY=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},iY(e)}function sY(e,t){return sY=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sY(e,t)}customElements.define("streaming-body",YX);var aY,oY,lY,cY,uY,hY,dY,fY,pY,mY=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=iY(t),function(e,t){if(t&&("object"==ZX(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,rY()?Reflect.construct(t,n||[],iY(e).constructor):t.apply(e,n))}(this,t)).initialised=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sY(e,t)}(t,e),function(e,t,n){return t&&tY(e.prototype,t),n&&tY(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("initialised")&&this.inori&&this._loggedInHandler()}},{key:"_loggedInHandler",value:(n=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){eY(s,r,i,a,o,"next",e)}function o(e){eY(s,r,i,a,o,"throw",e)}a(void 0)})}}(JX().m(function e(){return JX().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.updateComplete;case 1:this.inori.util.theme_event_registry();case 2:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"handleInitialisedEvent",value:function(e){this.initialised=e.detail}},{key:"render",value:function(){return W(XX||(XX=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">\n  <symbol id="check2" viewBox="0 0 16 16">\n    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>\n  </symbol>\n  <symbol id="circle-half" viewBox="0 0 16 16">\n    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>\n  </symbol>\n  <symbol id="moon-stars-fill" viewBox="0 0 16 16">\n    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>\n    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>\n  </symbol>\n  <symbol id="sun-fill" viewBox="0 0 16 16">\n    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>\n  </symbol>\n  <symbol id="chat-fill" viewBox="0 0 16 16">\n    <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>\n    <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9 9 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.4 10.4 0 0 1-.524 2.318l-.003.011a11 11 0 0 1-.244.637c-.079.186.074.394.273.362a22 22 0 0 0 .693-.125m.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6-3.004 6-7 6a8 8 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a11 11 0 0 0 .398-2"/>\n  </symbol>\n</svg>\n\n<div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">\n  <div class="offcanvas-header">\n    <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Backdrop with scrolling</h5>\n    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>\n  </div>\n  <div class="offcanvas-body">\n    <p>Try scrolling the rest of the page to see this option in action.</p>\n  </div>\n</div>\n\n<div class="dropdown position-fixed bottom-0 end-0 mb-3 me-3 bd-mode-toggle">\n  <button class="btn btn-bd-primary py-2 dropdown-toggle d-flex align-items-center"\n          id="bd-theme"\n          type="button"\n          aria-expanded="false"\n          data-bs-toggle="dropdown"\n          aria-label="Toggle theme (auto)">\n    <svg class="bi my-1 theme-icon-active" width="1em" height="1em"><use href="#circle-half"></use></svg>\n    <span class="visually-hidden" id="bd-theme-text">Toggle theme</span>\n  </button>\n  <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="bd-theme-text">\n    <li>\n      <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">\n        <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em"><use href="#sun-fill"></use></svg>\n        Light\n      </button>\n    </li>\n    <li>\n      <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">\n        <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em"><use href="#moon-stars-fill"></use></svg>\n        Dark\n      </button>\n    </li>\n    <li>\n      <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">\n        <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em"><use href="#circle-half"></use></svg>\n        Auto\n      </button>\n    </li>\n    <li>\n      <button type="button" class="dropdown-item d-flex align-items-center" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">\n        <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em"><use href="#chat-fill"></use></svg>\n        Chat\n      </button>\n    </li>\n  </ul>\n</div>'])))}}],[{key:"properties",get:function(){return{inori:{type:Object},initialised:{type:Boolean}}}}]);var n}(ce);function gY(e){return gY="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gY(e)}function vY(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _Y(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return bY(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(bY(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,bY(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,bY(h,"constructor",c),bY(c,"constructor",l),l.displayName="GeneratorFunction",bY(c,i,"GeneratorFunction"),bY(h),bY(h,i,"Generator"),bY(h,r,function(){return this}),bY(h,"toString",function(){return"[object Generator]"}),(_Y=function(){return{w:s,m:d}})()}function bY(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}bY=function(e,t,n,r){function s(t,n){bY(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},bY(e,t,n,r)}function yY(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function wY(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,SY(r.key),r)}}function SY(e){var t=function(e){if("object"!=gY(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=gY(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==gY(t)?t:t+""}function xY(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(xY=function(){return!!e})()}function EY(e){return EY=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},EY(e)}function CY(e,t){return CY=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},CY(e,t)}customElements.define("streaming-toolbar",mY);var AY,MY,kY,TY,RY,PY,IY,DY,OY,LY,BY,NY,UY,HY,FY,jY,zY,VY,GY,WY,qY,KY,$Y,XY,YY,ZY,JY,QY,eZ,tZ,nZ,rZ,iZ,sZ,aZ,oZ,lZ,cZ,uZ,hZ,dZ,fZ,pZ,mZ,gZ,vZ,_Z,bZ,yZ,wZ,SZ,xZ,EZ=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=EY(t),function(e,t){if(t&&("object"==gY(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xY()?Reflect.construct(t,n||[],EY(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.plan=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CY(e,t)}(t,e),function(e,t,n){return t&&wY(e.prototype,t),n&&wY(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){e.has("inori")&&this.inori&&(this.inori.env.content.setIndex(15),this.requestUpdate())}},{key:"_loggedInHandler",value:(n=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){yY(s,r,i,a,o,"next",e)}function o(e){yY(s,r,i,a,o,"throw",e)}a(void 0)})}}(_Y().m(function e(){return _Y().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return n.apply(this,arguments)})},{key:"renderIcon",value:function(e){switch(e.toLowerCase()){case"wind":return W(aY||(aY=vY(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-wind" viewBox="0 0 16 16">\n            <path d="M12.5 2A2.5 2.5 0 0 0 10 4.5a.5.5 0 0 1-1 0A3.5 3.5 0 1 1 12.5 8H.5a.5.5 0 0 1 0-1h12a2.5 2.5 0 0 0 0-5m-7 1a1 1 0 0 0-1 1 .5.5 0 0 1-1 0 2 2 0 1 1 2 2h-5a.5.5 0 0 1 0-1h5a1 1 0 0 0 0-2M0 9.5A.5.5 0 0 1 .5 9h10.042a3 3 0 1 1-3 3 .5.5 0 0 1 1 0 2 2 0 1 0 2-2H.5a.5.5 0 0 1-.5-.5"/>\n          </svg>'])));case"lightning":return W(oY||(oY=vY(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-lightning" viewBox="0 0 16 16">\n            <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641zM6.374 1 4.168 8.5H7.5a.5.5 0 0 1 .478.647L6.78 13.04 11.478 7H8a.5.5 0 0 1-.474-.658L9.306 1z"/>\n          </svg>'])));case"umbrella":return W(lY||(lY=vY(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-umbrella" viewBox="0 0 16 16">\n            <path d="M8 0a.5.5 0 0 1 .5.5v.514C12.625 1.238 16 4.22 16 8c0 0 0 .5-.5.5-.149 0-.352-.145-.352-.145l-.004-.004-.025-.023a3.5 3.5 0 0 0-.555-.394A3.17 3.17 0 0 0 13 7.5c-.638 0-1.178.213-1.564.434a3.5 3.5 0 0 0-.555.394l-.025.023-.003.003s-.204.146-.353.146-.352-.145-.352-.145l-.004-.004-.025-.023a3.5 3.5 0 0 0-.555-.394 3.3 3.3 0 0 0-1.064-.39V13.5H8h.5v.039l-.005.083a3 3 0 0 1-.298 1.102 2.26 2.26 0 0 1-.763.88C7.06 15.851 6.587 16 6 16s-1.061-.148-1.434-.396a2.26 2.26 0 0 1-.763-.88 3 3 0 0 1-.302-1.185v-.025l-.001-.009v-.003s0-.002.5-.002h-.5V13a.5.5 0 0 1 1 0v.506l.003.044a2 2 0 0 0 .195.726c.095.191.23.367.423.495.19.127.466.229.879.229s.689-.102.879-.229c.193-.128.328-.304.424-.495a2 2 0 0 0 .197-.77V7.544a3.3 3.3 0 0 0-1.064.39 3.5 3.5 0 0 0-.58.417l-.004.004S5.65 8.5 5.5 8.5s-.352-.145-.352-.145l-.004-.004a3.5 3.5 0 0 0-.58-.417A3.17 3.17 0 0 0 3 7.5c-.638 0-1.177.213-1.564.434a3.5 3.5 0 0 0-.58.417l-.004.004S.65 8.5.5 8.5C0 8.5 0 8 0 8c0-3.78 3.375-6.762 7.5-6.986V.5A.5.5 0 0 1 8 0M6.577 2.123c-2.833.5-4.99 2.458-5.474 4.854A4.1 4.1 0 0 1 3 6.5c.806 0 1.48.25 1.962.511a9.7 9.7 0 0 1 .344-2.358c.242-.868.64-1.765 1.271-2.53m-.615 4.93A4.16 4.16 0 0 1 8 6.5a4.16 4.16 0 0 1 2.038.553 8.7 8.7 0 0 0-.307-2.13C9.434 3.858 8.898 2.83 8 2.117c-.898.712-1.434 1.74-1.731 2.804a8.7 8.7 0 0 0-.307 2.131zm3.46-4.93c.631.765 1.03 1.662 1.272 2.53.233.833.328 1.66.344 2.358A4.14 4.14 0 0 1 13 6.5c.77 0 1.42.23 1.897.477-.484-2.396-2.641-4.355-5.474-4.854z"/>\n          </svg>'])));case"earth":return W(cY||(cY=vY(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-globe-americas" viewBox="0 0 16 16">\n            <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0M2.04 4.326c.325 1.329 2.532 2.54 3.717 3.19.48.263.793.434.743.484q-.121.12-.242.234c-.416.396-.787.749-.758 1.266.035.634.618.824 1.214 1.017.577.188 1.168.38 1.286.983.082.417-.075.988-.22 1.52-.215.782-.406 1.48.22 1.48 1.5-.5 3.798-3.186 4-5 .138-1.243-2-2-3.5-2.5-.478-.16-.755.081-.99.284-.172.15-.322.279-.51.216-.445-.148-2.5-2-1.5-2.5.78-.39.952-.171 1.227.182.078.099.163.208.273.318.609.304.662-.132.723-.633.039-.322.081-.671.277-.867.434-.434 1.265-.791 2.028-1.12.712-.306 1.365-.587 1.579-.88A7 7 0 1 1 2.04 4.327Z"/>\n          </svg>'])));case"moon":return W(uY||(uY=vY(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-moon" viewBox="0 0 16 16">\n            <path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278M4.858 1.311A7.27 7.27 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.32 7.32 0 0 0 5.205-2.162q-.506.063-1.029.063c-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286"/>\n          </svg>'])));case"sun":return W(hY||(hY=vY(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-sun" viewBox="0 0 16 16">\n            <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"/>\n          </svg>'])))}}},{key:"render",value:function(){var e=this,t=this;return t.inori?W(fY||(fY=vY(['\n<main class="col-lg-12 py-md-4 px-md-4">\n  <div class="row">\n    ',"\n  </div>\n</main>"])),this.inori.env.content.getAllL1().map(function(n,r){var i=e.inori.env.content.getL2(r);if((null==i?void 0:i.length)>0)return W(pY||(pY=vY(['\n     <div class="col-sm-4 mb-4">\n      <div class="card">\n        <div class="card-header text-center">\n          ','\n        </div>\n        <div class="card-body">\n          <h5 class="card-title">',' Plan</h5>\n          <p class="card-text">','</p>\n          <a role="button" class="btn btn-primary" @click="','">','</a>\n        </div>\n        <div class="card-footer">\n          PLAN_CODE: ',"\n        </div>\n      </div>\n    </div>"])),e.renderIcon(n),n,i[1],function(e){t.plan.code=i[2],t.plan.name=n,t.dispatchEvent(new CustomEvent("plan-selected-event",{}))},i[0],i[2])})):W(dY||(dY=vY([""])))}}],[{key:"properties",get:function(){return{inori:{type:Object},plan:{type:Object}}}}]);var n}(ce);function CZ(e){return CZ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CZ(e)}function AZ(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function MZ(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function kZ(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return TZ(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(TZ(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,TZ(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,TZ(h,"constructor",c),TZ(c,"constructor",l),l.displayName="GeneratorFunction",TZ(c,i,"GeneratorFunction"),TZ(h),TZ(h,i,"Generator"),TZ(h,r,function(){return this}),TZ(h,"toString",function(){return"[object Generator]"}),(kZ=function(){return{w:s,m:d}})()}function TZ(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}TZ=function(e,t,n,r){function s(t,n){TZ(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},TZ(e,t,n,r)}function RZ(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function PZ(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){RZ(s,r,i,a,o,"next",e)}function o(e){RZ(s,r,i,a,o,"throw",e)}a(void 0)})}}function IZ(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,DZ(r.key),r)}}function DZ(e){var t=function(e){if("object"!=CZ(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=CZ(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==CZ(t)?t:t+""}function OZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(OZ=function(){return!!e})()}function LZ(e,t,n,r){var i=BZ(NZ(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function BZ(){return BZ="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=NZ(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},BZ.apply(null,arguments)}function NZ(e){return NZ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},NZ(e)}function UZ(e,t){return UZ=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},UZ(e,t)}customElements.define("subscription-pricing",EZ);var HZ,FZ,jZ,zZ,VZ,GZ,WZ,qZ=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=NZ(t),function(e,t){if(t&&("object"==CZ(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,OZ()?Reflect.construct(t,n||[],NZ(e).constructor):t.apply(e,n))}(this,t))._articles=[{id:"subscription-plan",checked:!1},{id:"corp-privacy-policy",checked:!1},{id:"corp-term-of-use",checked:!1},{id:"corp-disclaimer",checked:!1}],e.stepNum=0,e.stepInProg=0,e.showTip=!1,e.showErr=!1,e.time=180,e.inori=null,e.plan=null,e.contact={Email:"",FirstName:"",LastName:"",Company:"",Phone:""},e.guestMessage={data:""},e.elements=null,e.stripe=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UZ(e,t)}(t,e),function(e,t,n){return t&&IZ(e.prototype,t),n&&IZ(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"firstUpdated",value:function(){var e=document.getElementById("my-progress");window.addEventListener("scroll",function(){var t=document.documentElement.scrollHeight-window.innerHeight,n=window.pageYOffset;e.style.width="".concat(n/t*100,"%")})}},{key:"updated",value:function(e){if(e.has("stepInProg")){this.startCountdown();var t=this.renderRoot.querySelector(".form-phone-validate");t&&(t.focus(),t.select())}}},{key:"setCookie",value:function(e,t,n){var r="";if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toUTCString()}document.cookie=e+"="+(t||"")+r+"; path=/"}},{key:"getCookie",value:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}},{key:"_loggedInHandler",value:(s=PZ(kZ().m(function e(){return kZ().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return s.apply(this,arguments)})},{key:"handleVerifyNumInput",value:(i=PZ(kZ().m(function e(t,n){var r,i;return kZ().w(function(e){for(;;)switch(e.n){case 0:if((r=t.target).value=r.value.replace(/[^0-9]/g,""),!(r.value&&n<6)){e.n=4;break}if(i=this.renderRoot.querySelectorAll(".form-phone-validate")[n+1],this.guestMessage.data+=r.value,!i){e.n=1;break}i.focus(),i.select(),e.n=4;break;case 1:return e.n=2,this.inori.util.validt_num(this.guestMessage);case 2:if(e.v){e.n=3;break}return this.showErr=!0,e.a(2);case 3:this.stopCountdown(),this.showErr=!1,this.stepNum=3,this.stepCompleted=2;case 4:return e.a(2)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"getCurrentProgressButtonClass",value:function(e){switch(e){case 0:return this.stepCompleted<0?"btn-secondary":"btn-primary";case 1:case 2:case 3:case 4:return this.stepCompleted>=e?"btn-primary":this.stepInProg==e?"btn-info":"btn-secondary";default:return"btn-secondary"}}},{key:"connectedCallback",value:function(){LZ(t,"connectedCallback",this,3)([]),this.startCountdown()}},{key:"disconnectedCallback",value:function(){LZ(t,"disconnectedCallback",this,3)([]),this.stopCountdown()}},{key:"stopCountdown",value:function(){clearInterval(this.intervalId)}},{key:"startCountdown",value:function(){var e=this;2==this.stepInProg&&(this.intervalId=setInterval(function(){e.time>0?e.time-=1:e.stopCountdown()},1e3))}},{key:"initPayment",value:(r=PZ(kZ().m(function e(){var t,n,r;return kZ().w(function(e){for(;;)switch(e.n){case 0:return this.guestMessage.data=JSON.stringify({items:[{id:"test-plan"}]}),this.guestMessage.messageType=this.inori.tenant.dataType().MessageType.values.INIT_PMT,e.n=1,this.inori.util.verify_msg(this.guestMessage);case 1:if(t=e.v){e.n=2;break}return e.a(2);case 2:if(2==(n=t.data.split("|")).length){e.n=3;break}return e.a(2);case 3:return r=n[0],this.stripe=Stripe(n[1]),e.n=4,this.updateComplete;case 4:this.renderPaymentElm(r)&&this.checkPaymentStatus(r);case 5:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"renderPaymentElm",value:function(e){this.elements=this.stripe.elements({appearance:{theme:"stripe"},clientSecret:e});var t=this.elements.create("payment",{layout:"tabs"});return!!t&&(t.mount("#payment-element"),!0)}},{key:"checkPaymentStatus",value:(n=PZ(kZ().m(function e(t){var n,r,i;return kZ().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.stripe.retrievePaymentIntent(t);case 1:n=e.v,r=n.paymentIntent,i=r.status,e.n="succeeded"===i?2:"processing"===i?3:"requires_payment_method"===i?4:5;break;case 2:return this.showMessage("Payment succeeded!"),e.a(3,6);case 3:return this.showMessage("Your payment is processing."),e.a(3,6);case 4:return this.showMessage("Your payment was not successful, please try again."),e.a(3,6);case 5:return this.showMessage("Something went wrong."),e.a(3,6);case 6:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"showMessage",value:function(e){}},{key:"setLoading",value:function(e){e?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}},{key:"updateCompany",value:function(e){this.contact.Company=e.target.value}},{key:"updateEmail",value:function(e){this.contact.Email=e.target.value}},{key:"updatePhone",value:function(e){this.contact.Phone=e.target.value}},{key:"renderIcon",value:function(e){switch(e.toLowerCase()){case"wind":return W(AY||(AY=MZ(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-wind" viewBox="0 0 16 16">\n            <path d="M12.5 2A2.5 2.5 0 0 0 10 4.5a.5.5 0 0 1-1 0A3.5 3.5 0 1 1 12.5 8H.5a.5.5 0 0 1 0-1h12a2.5 2.5 0 0 0 0-5m-7 1a1 1 0 0 0-1 1 .5.5 0 0 1-1 0 2 2 0 1 1 2 2h-5a.5.5 0 0 1 0-1h5a1 1 0 0 0 0-2M0 9.5A.5.5 0 0 1 .5 9h10.042a3 3 0 1 1-3 3 .5.5 0 0 1 1 0 2 2 0 1 0 2-2H.5a.5.5 0 0 1-.5-.5"/>\n          </svg>'])));case"lightning":return W(MY||(MY=MZ(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-lightning" viewBox="0 0 16 16">\n            <path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641zM6.374 1 4.168 8.5H7.5a.5.5 0 0 1 .478.647L6.78 13.04 11.478 7H8a.5.5 0 0 1-.474-.658L9.306 1z"/>\n          </svg>'])));case"umbrella":return W(kY||(kY=MZ(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-umbrella" viewBox="0 0 16 16">\n            <path d="M8 0a.5.5 0 0 1 .5.5v.514C12.625 1.238 16 4.22 16 8c0 0 0 .5-.5.5-.149 0-.352-.145-.352-.145l-.004-.004-.025-.023a3.5 3.5 0 0 0-.555-.394A3.17 3.17 0 0 0 13 7.5c-.638 0-1.178.213-1.564.434a3.5 3.5 0 0 0-.555.394l-.025.023-.003.003s-.204.146-.353.146-.352-.145-.352-.145l-.004-.004-.025-.023a3.5 3.5 0 0 0-.555-.394 3.3 3.3 0 0 0-1.064-.39V13.5H8h.5v.039l-.005.083a3 3 0 0 1-.298 1.102 2.26 2.26 0 0 1-.763.88C7.06 15.851 6.587 16 6 16s-1.061-.148-1.434-.396a2.26 2.26 0 0 1-.763-.88 3 3 0 0 1-.302-1.185v-.025l-.001-.009v-.003s0-.002.5-.002h-.5V13a.5.5 0 0 1 1 0v.506l.003.044a2 2 0 0 0 .195.726c.095.191.23.367.423.495.19.127.466.229.879.229s.689-.102.879-.229c.193-.128.328-.304.424-.495a2 2 0 0 0 .197-.77V7.544a3.3 3.3 0 0 0-1.064.39 3.5 3.5 0 0 0-.58.417l-.004.004S5.65 8.5 5.5 8.5s-.352-.145-.352-.145l-.004-.004a3.5 3.5 0 0 0-.58-.417A3.17 3.17 0 0 0 3 7.5c-.638 0-1.177.213-1.564.434a3.5 3.5 0 0 0-.58.417l-.004.004S.65 8.5.5 8.5C0 8.5 0 8 0 8c0-3.78 3.375-6.762 7.5-6.986V.5A.5.5 0 0 1 8 0M6.577 2.123c-2.833.5-4.99 2.458-5.474 4.854A4.1 4.1 0 0 1 3 6.5c.806 0 1.48.25 1.962.511a9.7 9.7 0 0 1 .344-2.358c.242-.868.64-1.765 1.271-2.53m-.615 4.93A4.16 4.16 0 0 1 8 6.5a4.16 4.16 0 0 1 2.038.553 8.7 8.7 0 0 0-.307-2.13C9.434 3.858 8.898 2.83 8 2.117c-.898.712-1.434 1.74-1.731 2.804a8.7 8.7 0 0 0-.307 2.131zm3.46-4.93c.631.765 1.03 1.662 1.272 2.53.233.833.328 1.66.344 2.358A4.14 4.14 0 0 1 13 6.5c.77 0 1.42.23 1.897.477-.484-2.396-2.641-4.355-5.474-4.854z"/>\n          </svg>'])));case"earth":return W(TY||(TY=MZ(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-globe-americas" viewBox="0 0 16 16">\n            <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0M2.04 4.326c.325 1.329 2.532 2.54 3.717 3.19.48.263.793.434.743.484q-.121.12-.242.234c-.416.396-.787.749-.758 1.266.035.634.618.824 1.214 1.017.577.188 1.168.38 1.286.983.082.417-.075.988-.22 1.52-.215.782-.406 1.48.22 1.48 1.5-.5 3.798-3.186 4-5 .138-1.243-2-2-3.5-2.5-.478-.16-.755.081-.99.284-.172.15-.322.279-.51.216-.445-.148-2.5-2-1.5-2.5.78-.39.952-.171 1.227.182.078.099.163.208.273.318.609.304.662-.132.723-.633.039-.322.081-.671.277-.867.434-.434 1.265-.791 2.028-1.12.712-.306 1.365-.587 1.579-.88A7 7 0 1 1 2.04 4.327Z"/>\n          </svg>'])));case"moon":return W(RY||(RY=MZ(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-moon" viewBox="0 0 16 16">\n            <path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278M4.858 1.311A7.27 7.27 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.32 7.32 0 0 0 5.205-2.162q-.506.063-1.029.063c-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286"/>\n          </svg>'])));case"sun":return W(PY||(PY=MZ(['<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-sun" viewBox="0 0 16 16">\n            <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"/>\n          </svg>'])))}}},{key:"renderPlan",value:function(e,t){var n=this;return W(IY||(IY=MZ(['\n        <div class="d-flex" style="height: 50px;" id="','">\n          <div class="vr opacity-0"></div>\n        </div>\n        <div class="row mx-2 mb-1 mt-5 z-2">\n        <div class="col-10 mx-auto">\n          <div class="card">\n            <div class="card-header text-center">\n              ','\n            </div>\n            <div class="card-body">\n              <h5 class="card-title">The ',' Plan</h5>\n              <p class="card-text">','</p>\n              <a class="btn btn-primary" role="button"  @click="','">\n                Sign up\n              </a>\n            </div>\n            <div class="card-footer">\n              PLAN_CODE: ','\n            </div>\n          </div></div>\n        </div>\n        <div class="d-flex" style="height: 100vh;">\n          <div class="vr opacity-0"></div>\n        </div>'])),this._articles[0].id,this.renderIcon(this.plan.name),this.plan.name,e[1],function(e){n._articles[0].checked=!0,n.requestUpdate(),document.getElementById(t).scrollIntoView({behavior:"smooth"})},e[2])}},{key:"renderCorpArticle",value:function(e,t){var n=this,r=this;return W(DY||(DY=MZ(['\n        <div class="d-flex" style="height: 50px;" id="','">\n          <div class="vr opacity-0"></div>\n        </div>\n        <div class="row mx-2 mb-1 mt-5 z-2 justify-content-center"> \n            <div class="col-10 mx-auto">\n                <div class="ratio ratio-16x9">\n                    <iframe src="','.html"></iframe>\n                </div>\n            </div>\n        </div>\n        <div class="row"> \n            <div class="col text-center my-3">\n                <button class="btn btn-primary" type="button"  @click="','">\n                      I agree\n                </button>\n                <button class="btn btn-outline-secondary" type="button"  @click="','">\n                      Go back\n                </button>                \n            </div>\n        </div>\n      '])),e,e,function(){var i=PZ(kZ().m(function i(s){return kZ().w(function(i){for(;;)switch(i.n){case 0:n._articles.filter(function(t){return t.id==e})[0].checked=!0,n.requestUpdate(),0==n._articles.filter(function(e){return!e.checked}).length&&r.dispatchEvent(new CustomEvent("credential-req-event",{detail:{}})),document.getElementById(t).scrollIntoView({behavior:"smooth"});case 1:return i.a(2)}},i)}));return function(e){return i.apply(this,arguments)}}(),function(t){var r=n._articles.findIndex(function(t){return t.id==e});r>0&&r--,n._articles[r].checked=!1,n.requestUpdate(),document.getElementById(n._articles[r].id).scrollIntoView({behavior:"smooth"})})}},{key:"renderSignUp",value:function(e){var t=this,n=this,r=100/(this._articles.length-1);return W(OY||(OY=MZ(['\n<main class="py-md-4 px-md-4">\n\n<div class="row fixed-top bg-user-plan z-n1">\n        <div class="col-12"></div>\n    </div>\n  <div class="row mx-2 mb-1 w-75 mt-5 mx-auto fixed-top z-3">\n    <div class="col-10 col-sm position-relative mx-4">\n      <div class="progress" style="height: 1px;">\n        <div id="my-progress" class="progress-bar" role="progressbar" aria-label="Progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>\n      </div>\n      ',"\n    </div>\n  </div>\n    ","\n</main>"])),this._articles.map(function(e,n){return W(LY||(LY=MZ(['\n        <button type="button" @click="','" id="my-btn-1" class="position-absolute top-0 translate-middle btn btn-sm ',' rounded-pill" style="width: 2rem; height:2rem; left:','%;">\n            ',"\n        </button> \n          "])),function(e){t.stepCompleted>=3&&(t.stepNum=1)},e.checked?"btn-primary":"btn-secondary",r*n,n)}),this._articles.map(function(r,i){if(0==i)return t.renderPlan(e,t._articles[1].id);var s=t._articles[i==t._articles.length-1?i:i+1];return W(BY||(BY=MZ(["\n    ","\n    ",""])),n.renderCorpArticle(r.id,s.id),i==t._articles.length-1?W(NY||(NY=MZ([""]))):W(UY||(UY=MZ(['\n    <div class="d-flex" style="height: 100vh;">\n       <div class="vr opacity-0"></div>\n   </div>\n    ']))))}))}},{key:"render",value:function(){var e=this,t=this;if(!t.inori)return W(HY||(HY=MZ([""])));var n,r=t.inori.env.content.getIndexByName("Plan"),i=t.inori.env.content.getAllL1(r).indexOf(this.plan.name);if(i>-1){var s=t.inori.env.content.getAllL2(r)[i];if(s)return this.inori.mq.sys_dbg("plan ".concat(JSON.stringify(this.plan)," selected")),this.renderSignUp(s)}return W(FY||(FY=MZ(['\n<main class="col-lg-12 py-md-4 px-md-4">\n  <div class="row">\n    <div class="col-12 col-sm" style="z-index: 9999;">\n      <div class="position-relative m-5">\n        <div class="progress" style="height: 1px;">\n          <div class="progress-bar" role="progressbar" aria-label="Progress" style="width: ','%;" aria-valuenow="','" aria-valuemin="0" aria-valuemax="100"></div>\n        </div>\n        <button type="button" @click="','" class="position-absolute top-0 translate-middle btn btn-sm ','" style="height:2rem; left:0%;">\n          Start\n          ',"\n        </button>\n        ",'\n        <button type="button" @click="','" class="position-absolute top-0 translate-middle btn btn-sm ','" style="height:2rem; left:100%;">\n          End\n          ',"\n        </button>\n      </div>\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      \n      ","\n      ","\n      ",'\n    </div>\n    <div class="col-12 col-sm" style="position:absolute; z-index: 1000;">\n      ',"    \n    </div>\n  </div>    \n</main>"])),(25*this.stepNum).toString(),(25*this.stepNum).toString(),function(t){e.stepCompleted>=3&&(e.stepNum=0)},this.getCurrentProgressButtonClass(0),0==this.stepNum?W(jY||(jY=MZ(['\n          <svg width="1em" height="1em" viewBox="0 0 16 16" class="position-absolute top-100 translate-middle mt-1" fill="','" style="left:50%;" xmlns="http://www.w3.org/2000/svg">\n            <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>\n          </svg>'])),this.stepCompleted<0?"#565e64":"#0a58ca"):"",W(zY||(zY=MZ(['\n            <button type="button" @click="','" class="position-absolute top-0 translate-middle btn btn-sm ',' rounded-pill" style="width: 2rem; height:2rem; left:25%;">1</button>          \n            <button type="button" @click="','" class="position-absolute top-0 translate-middle btn btn-sm ',' rounded-pill" style="width: 2rem; height:2rem; left:50%;">2</button>\n            <button type="button" @click="','" class="position-absolute top-0 translate-middle btn btn-sm ',' rounded-pill" style="width: 2rem; height:2rem; left:75%;">3</button>'])),function(t){e.stepCompleted>=3&&(e.stepNum=1,e.showTip=!1)},this.getCurrentProgressButtonClass(1),function(t){e.stepCompleted>=3&&(e.stepNum=2,e.showTip=!1)},this.getCurrentProgressButtonClass(2),function(t){e.stepCompleted>=3&&(e.stepNum=3,e.showTip=!1)},this.getCurrentProgressButtonClass(3)),function(t){e.stepCompleted>=3&&(e.stepNum=4,e.showTip=!1)},this.getCurrentProgressButtonClass(4),4==this.stepNum?W(VY||(VY=MZ(['\n          <svg width="1em" height="1em" viewBox="0 0 16 16" class="position-absolute top-100 translate-middle mt-1" fill="','" style="left:50%;" xmlns="http://www.w3.org/2000/svg">\n            <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>\n          </svg>'])),4==this.stepInProg?"#31d2f2":"#565e64"):"",0==this.stepNum?W(GY||(GY=MZ(['\n      <div class="row mx-2 mb-1">\n      <div class="col-sm">\n        <p class="fw-light fs-3">\n          You are signing up for -\n        </p>\n        <div class="card">\n          <div class="card-header text-center">\n            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-wind" viewBox="0 0 16 16">\n              <path d="M12.5 2A2.5 2.5 0 0 0 10 4.5a.5.5 0 0 1-1 0A3.5 3.5 0 1 1 12.5 8H.5a.5.5 0 0 1 0-1h12a2.5 2.5 0 0 0 0-5m-7 1a1 1 0 0 0-1 1 .5.5 0 0 1-1 0 2 2 0 1 1 2 2h-5a.5.5 0 0 1 0-1h5a1 1 0 0 0 0-2M0 9.5A.5.5 0 0 1 .5 9h10.042a3 3 0 1 1-3 3 .5.5 0 0 1 1 0 2 2 0 1 0 2-2H.5a.5.5 0 0 1-.5-.5"/>\n            </svg>\n          </div>\n          <div class="card-body">\n            <h5 class="card-title">The Wind Plan (Free)</h5>\n            <p class="card-text">Perfect for small businesses seeking a hassle-free design solution without the need for prior experience. Get started instantly with pre-designed templates.</p>\n            <a class="btn ','" role="button"  @click="','">\n              Subscribe\n            </a>\n          </div>\n          <div class="card-footer">\n            PLAN_CODE: 0100\n          </div>\n        </div></div>\n      </div>\n      '])),this.getCurrentProgressButtonClass(0),function(t){e.stepNum=1,e.stepCompleted<0&&(e.stepCompleted=0)}):W(WY||(WY=MZ([""]))),1==this.stepNum?W(qY||(qY=MZ(['\n      <div class="row mx-2 mb-3">\n        <div class="col-sm">\n          <label for="company" class="form-label fw-light fs-3 mb-4">\n            The name for greeting the calls?\n          </label>\n          <div class="input-group">\n            <button class="btn btn-primary" type="button"  @click="','" id="button-addon2">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-buildings" viewBox="0 0 16 16">\n                <path d="M14.763.075A.5.5 0 0 1 15 .5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V14h-1v1.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V10a.5.5 0 0 1 .342-.474L6 7.64V4.5a.5.5 0 0 1 .276-.447l8-4a.5.5 0 0 1 .487.022M6 8.694 1 10.36V15h5zM7 15h2v-1.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V15h2V1.309l-7 3.5z"/>\n                <path d="M2 11h1v1H2zm2 0h1v1H4zm-2 2h1v1H2zm2 0h1v1H4zm4-4h1v1H8zm2 0h1v1h-1zm-2 2h1v1H8zm2 0h1v1h-1zm2-2h1v1h-1zm0 2h1v1h-1zM8 7h1v1H8zm2 0h1v1h-1zm2 0h1v1h-1zM8 5h1v1H8zm2 0h1v1h-1zm2 0h1v1h-1zm0-2h1v1h-1z"/>\n              </svg>\n            </button>\n            <input type="text" name="company" id="company" class="form-control" placeholder="Organization name" aria-label="Organization name" aria-describedby="button-addon2" @input=',' .value="','">\n            <button class="btn btn-secondary" type="button" @click="','" id="button-addon2" ','>\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div> \n      '])),function(t){e.showTip=!e.showTip},this.updateCompany,this.contact.Company,function(t){e.stepCompleted<1&&(e.stepCompleted=1),e.stepNum=e.stepCompleted+1;var n=e.renderRoot.querySelector("#company");n&&(e.guestMessage.from=n.value),e.showTip=!1},0==this.stepCompleted):W(KY||(KY=MZ([""]))),-2==this.stepNum?2==this.stepInProg?W($Y||($Y=MZ(['\n      <div class="row mx-2 mb-1">\n        <p class="fw-light fs-3">\n          Confirm the 6-Digit code.        \n          <a class="btn" role="button" @click="','"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">\n              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>\n              <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"></path>\n            </svg> <span class="fw-lighter fs-6 fst-italic">what code?</span></a></p>\n      ',"\n      ",'\n        <div class="d-flex flex-row justify-content-center">\n            ','\n        </div>\n        <div class="position-fixed bottom-0 end-0 fw-lighter fs-5">Expiring in '," seconds</div>\n      </div>"])),function(t){e.showTip=!e.showTip},this.showTip?2==this.stepInProg?W(XY||(XY=MZ(['\n        <div class="row mb-3">  \n          <div class="col-sm">\n            <div class="alert alert-primary fw-light" role="alert">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">\n                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>\n                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"></path>\n              </svg>    \n              The 6-Digit code represent a company or entity within the context of your I(nteractive) V(oice) R(esponse) flow. It\'s used in message content, attribute values, to manage and to customize the interactions within your new IVR system instance.        \n            </div>\n          </div>\n        </div>']))):W(YY||(YY=MZ([""]))):W(ZY||(ZY=MZ([""]))),this.showErr?W(JY||(JY=MZ(['\n        <div class="row mb-3">  \n          <div class="col-sm">\n            <div class="alert alert-danger fw-light" role="alert">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">\n                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>\n                <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>\n              </svg>\n              Invalid code\n            </div>\n          </div>\n        </div>']))):W(QY||(QY=MZ([""]))),(n=Array(6),function(e){if(Array.isArray(e))return AZ(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return AZ(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?AZ(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map(function(t,n){return W(eZ||(eZ=MZ(['\n          <div class="p-1">\n            <input @input="','" \n              class="form-control form-phone-validate form-control-lg"\n                maxlength="1" type="text" placeholder="0" \n                  aria-label=".form-control-lg example">\n          </div>'])),function(t){return e.handleVerifyNumInput(t,n)})}),this.time):W(tZ||(tZ=MZ([""]))):W(nZ||(nZ=MZ([""]))),2==this.stepNum?W(rZ||(rZ=MZ(['\n      <div class="row mx-2 mb-1">              \n        <div class="col-sm">\n          <label for="email" class="form-label fw-light fs-3 mb-4">\n            The email to receive notifications?\n          </label>\n          <div class="input-group">\n            <button class="btn btn-primary" type="button" @click="','" id="button-addon2">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">\n                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/>\n              </svg>\n            </button>\n            <input type="email" id="email" name="email" class="form-control" placeholder="my@email.com" aria-label="my@email.com" aria-describedby="button-addon2" @input=',' .value="','">\n            <button class="btn btn-secondary" type="button" @click="','" id="button-addon2">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>\n              </svg>\n            </button>\n          </div>            \n        </div>\n      </div>'])),function(t){e.showTip=!e.showTip},this.updateEmail,this.contact.Email,function(){var t=PZ(kZ().m(function t(n){var r;return kZ().w(function(t){for(;;)switch(t.n){case 0:if(!(r=e.renderRoot.querySelector("#email"))){t.n=2;break}return e.guestMessage.to=r.value,e.guestMessage.messageType=e.inori.tenant.dataType().MessageType.values.SMTP,t.n=1,e.inori.util.verify_msg(e.guestMessage);case 1:letok=t.v,ok&&(e.stepCompleted<2&&(e.stepCompleted=2),e.stepNum=e.stepCompleted+1);case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()):W(iZ||(iZ=MZ([""]))),3==this.stepNum?W(sZ||(sZ=MZ(['\n      <div class="row mx-2 mb-1">\n        <div class="col-sm">\n          <label for="phone" class="form-label fw-light fs-3 mb-4">\n            The phone number to receiving the calls?\n          </label>\n          <div class="input-group">\n            <button class="btn btn-primary" type="button" @click="','" id="button-addon2">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone-outbound" viewBox="0 0 16 16">\n                <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877zM11 .5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V1.707l-4.146 4.147a.5.5 0 0 1-.708-.708L14.293 1H11.5a.5.5 0 0 1-.5-.5"/>\n              </svg>\n            </button>\n            <input type="text" name="phone" id="phone" class="form-control" placeholder="+12223334444" aria-label="+12223334444" aria-describedby="button-addon2" @input="','" .value="','">\n            <button class="btn btn-secondary" type="button" @click="','" id="button-addon2">\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>\n              </svg>\n            </button>\n          </div>     \n        </div>\n      </div>'])),function(t){e.showTip=!e.showTip},this.updatePhone,this.contact.Phone,function(){var t=PZ(kZ().m(function t(n){var r;return kZ().w(function(t){for(;;)switch(t.n){case 0:if(!(e.stepInProg<2)){t.n=2;break}if(!(r=e.renderRoot.querySelector("#phone"))){t.n=2;break}return e.guestMessage.to=r.value,e.guestMessage.messageType=e.inori.tenant.dataType().MessageType.values.SMS,t.n=1,e.inori.util.verify_msg(e.guestMessage);case 1:letok=t.v,ok&&(e.stepCompleted<3&&(e.stepCompleted=3),e.stepNum=e.stepCompleted+1),e.showTip=!1;case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()):W(aZ||(aZ=MZ([""]))),4==this.stepNum?W(oZ||(oZ=MZ(['\n      <div class="row mx-2 mb-1">      \n        <div class="col-sm">\n          <form id="payment-form" name="payment-form">\n          ',"\n          </form>\n        </div>\n      </div>"])),4==this.stepInProg?W(lZ||(lZ=MZ(['\n            <label class="form-label fw-light fs-3 mb-4">\n              Billing information. You will not be charged.\n            </label>          \n            <div id="payment-element" class="mb-4">\n            </div>          \n            <button id="submit" class="btn btn-secondary" type="button" @click="','"> Subscribe </button>'])),function(t){t.preventDefault();var n=e,r=n.elements,i=function(){var e=PZ(kZ().m(function e(t){return kZ().w(function(e){for(;;)switch(e.n){case 0:if(!t.error){e.n=1;break}n.showMessage(t.error.message),e.n=4;break;case 1:if(!t.paymentIntent||"succeeded"!==t.paymentIntent.status){e.n=3;break}return e.n=2,n.inori.tenant.create_contact(n.contact);case 2:let_ok=e.v,_ok&&(window.location.href="index.html"),e.n=4;break;case 3:"requires_action"===t.paymentIntent.status?stripe.handleCardAction(t.paymentIntent.client_secret).then(i):s();case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),s=function(){n.stripe.confirmPayment({elements:r,redirect:"if_required"}).then(i)};s()}):W(cZ||(cZ=MZ(['\n            <label for="cfm_company" class="form-label fw-light fs-3">\n              Contact name\n              <a class="btn" role="button" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" color="blue" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">\n                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>\n                </svg>\n              </a>\n            </label>\n            <input type="text" id="cfm_company" name="cfm_company" class="form-control mb-4" disabled id="exampleFormControlInput1" placeholder="contact name" .value="','">\n            <label for="cfm_email" class="form-label fw-light fs-3">\n              Email notification\n              <a class="btn" role="button" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" color="blue" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">\n                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>\n                </svg>\n              </a>\n            </label>\n            <input type="email" id="cfm_email" name="cfm_email" class="form-control mb-4" disabled id="exampleFormControlInput1" placeholder="name@example.com" .value="','">\n            <label for="cfm_phone" class="form-label fw-light fs-3">\n              Forward number\n              <a class="btn" role="button" @click="','">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" color="blue" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">\n                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>\n                </svg>\n              </a>\n            </label>\n            <input type="text" id="cfm_phone" name="cfm_phone" class="form-control mb-4" disabled id="exampleFormControlInput1" placeholder="123-123-1234" .value="','">\n            <button type="button" class="btn btn-secondary" @click="','">\n              Confirm\n              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>\n              </svg>\n            </button>'])),function(t){e.stepNum=1,e.showTip=!1},this.contact.Company,function(t){e.stepNum=2,e.showTip=!1},this.contact.Email,function(t){e.stepNum=3,e.showTip=!1},this.contact.Phone,function(){var t=PZ(kZ().m(function t(n){return kZ().w(function(t){for(;;)switch(t.n){case 0:e.stepInProg=4,e.initPayment(),e.showTip=!1;case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())):W(uZ||(uZ=MZ([""]))),1==this.stepNum&&this.showTip?W(hZ||(hZ=MZ(['\n      <div class="row m-2">\n        <div class="col-sm">\n          <div class="alert alert-primary fw-light" role="alert">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">\n              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>\n              <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"></path>\n            </svg>    \n            The "organization name" represent a company or entity within the context of your I(nteractive) V(oice) R(esponse) flow. It\'s used in message content, attribute values, to manage and to customize the interactions within your new IVR system instance.        \n          </div>\n        </div>\n      </div>    \n      ']))):W(dZ||(dZ=MZ([""]))),2==this.stepNum&&this.showTip?W(fZ||(fZ=MZ(["\n      ","\n      "])),2==this.stepInProg?W(pZ||(pZ=MZ([""]))):W(mZ||(mZ=MZ(['\n      <div class="row m-2">  \n        <div class="col-sm">\n          <div class="alert alert-primary fw-light" role="alert">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">\n              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>\n              <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"></path>\n            </svg>    \n            The "organization name" represent a company or entity within the context of your I(nteractive) V(oice) R(esponse) flow. It\'s used in message content, attribute values, to manage and to customize the interactions within your new IVR system instance.        \n          </div>\n        </div>\n      </div>'])))):W(gZ||(gZ=MZ([""]))),3==this.stepNum&&this.showTip?W(vZ||(vZ=MZ(['\n      <div class="row m-2">  \n        <div class="col-sm">\n          <div class="alert alert-primary fw-light" role="alert">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">\n              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>\n              <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"></path>\n            </svg>    \n            The "organization name" represent a company or entity within the context of your I(nteractive) V(oice) R(esponse) flow. It\'s used in message content, attribute values, to manage and to customize the interactions within your new IVR system instance.        \n          </div>\n        </div>\n      </div>\n      ']))):W(_Z||(_Z=MZ([""]))),function(){switch(e.stepNum){case 0:return W(bZ||(bZ=MZ(['<img src="./img/sub-user-plan.png" class="img-fluid subscription-plan-img" alt="...">'])));case 1:return W(yZ||(yZ=MZ(['<img src="./img/subs-provider-plan-no-bg.png" class="img-fluid subscription-plan-img" alt="...">'])));case 2:return W(wZ||(wZ=MZ(['<img src="./img/sub-user-plan.png" class="img-fluid subscription-plan-img" alt="...">'])));case 3:return W(SZ||(SZ=MZ(['<img src="./img/subs-enterprise-plan-no-bg.png" class="img-fluid subscription-plan-img" alt="...">'])));default:return W(xZ||(xZ=MZ(['<img src="./img/sub-user-plan.png" class="img-fluid subscription-plan-img" alt="...">'])))}}())}}],[{key:"properties",get:function(){return{elements:{type:Object},plan:{type:Object},inori:{type:Object},stepNum:{type:Number},showTip:{type:Boolean},showErr:{type:Boolean},stepCompleted:{type:Number},stepInProg:{type:Number},time:{type:Number},guestMessage:{type:Object}}}}]);var n,r,i,s}(ce);function KZ(e){return KZ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},KZ(e)}function $Z(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function XZ(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var l=r&&r.prototype instanceof o?r:o,c=Object.create(l.prototype);return YZ(c,"_invoke",function(n,r,i){var s,o,l,c=0,u=i||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return s=t,o=0,l=e,d.n=n,a}};function f(n,r){for(o=n,l=r,t=0;!h&&c&&!i&&t<u.length;t++){var i,s=u[t],f=d.p,p=s[2];n>3?(i=p===r)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=f&&((i=n<2&&f<s[1])?(o=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,o=0))}if(i||n>1)return a;throw h=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),o=u,l=p;(t=o<2?e:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(c=2,s){if(o||(i="next"),t=s[i]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,i,s),!0),c}var a={};function o(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(YZ(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,YZ(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,YZ(h,"constructor",c),YZ(c,"constructor",l),l.displayName="GeneratorFunction",YZ(c,i,"GeneratorFunction"),YZ(h),YZ(h,i,"Generator"),YZ(h,r,function(){return this}),YZ(h,"toString",function(){return"[object Generator]"}),(XZ=function(){return{w:s,m:d}})()}function YZ(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}YZ=function(e,t,n,r){function s(t,n){YZ(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},YZ(e,t,n,r)}function ZZ(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function JZ(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(e){ZZ(s,r,i,a,o,"next",e)}function o(e){ZZ(s,r,i,a,o,"throw",e)}a(void 0)})}}function QZ(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,eJ(r.key),r)}}function eJ(e){var t=function(e){if("object"!=KZ(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=KZ(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==KZ(t)?t:t+""}function tJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tJ=function(){return!!e})()}function nJ(){return nJ="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=rJ(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},nJ.apply(null,arguments)}function rJ(e){return rJ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},rJ(e)}function iJ(e,t){return iJ=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},iJ(e,t)}customElements.define("subscription-signup",qZ);var sJ=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=rJ(t),function(e,t){if(t&&("object"==KZ(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,tJ()?Reflect.construct(t,n||[],rJ(e).constructor):t.apply(e,n))}(this,t)).inori=null,e.initialised=!1,e.inSession=!1,e.isProcessing=!0,e.plan={},e.keypairsInfo={},e.logs=[],e.loadInori(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&iJ(e,t)}(t,e),function(e,t,n){return t&&QZ(e.prototype,t),n&&QZ(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"updated",value:function(e){}},{key:"connectedCallback",value:function(){!function(e,t,n){var r=nJ(rJ(e.prototype),"connectedCallback",n);return"function"==typeof r?function(e){return r.apply(n,e)}:r}(t,0,this)([])}},{key:"_loggedInHandler",value:(r=JZ(XZ().m(function e(){return XZ().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return r.apply(this,arguments)})},{key:"loadInori",value:(n=JZ(XZ().m(function e(){var t,n=this;return XZ().w(function(e){for(;;)switch(e.n){case 0:if((t=this).inori){e.n=2;break}return e.n=1,Qc();case 1:t.inori=e.v,window.addEventListener("local:intd",function(){var e=JZ(XZ().m(function e(r){return XZ().w(function(e){for(;;)switch(e.n){case 0:return t.isProcessing=!1,t.initialised=!0,t.inori.mq.sys_dbg("inori initialised"),e.n=1,t.inori.util.init_comm(!1);case 1:if(!e.v){e.n=3;break}return e.n=2,t.inori.util.dir.load();case 2:t.inori.mq.sys_dbg("credential established"),n.inSession=!0,n.plan={},n.requestUpdate();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0});case 2:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"handleExitingSessionEvent",value:function(e){var t=this;t.isProcessing=!0,t.inori.util.exit_session(t.inori).then(function(e){t.inSession=!1,t.isProcessing=!1,t.requestUpdate()}),t.requestUpdate()}},{key:"handleBrowserReleaseEvent",value:function(e){this.inori.util.render_release(10,20)}},{key:"handleSysLogs",value:function(e){this.logs=this.inori.tenant.logs(),this.requestUpdate()}},{key:"handlePlanSelected",value:function(e){this.requestUpdate()}},{key:"render",value:function(){var e=this,t=this;return W(HZ||(HZ=$Z(["\n      ","\n",""])),this.isProcessing?W(FZ||(FZ=$Z(['\n<div class="position-fixed start-50 top-50" style="height: 70vh;">\n  <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">\n      <span class="visually-hidden">Loading...</span>\n  </div>\n</div>']))):W(jZ||(jZ=$Z([""]))),this.inSession?W(WZ||(WZ=$Z(['\n<streaming-toolbar .inori="','" @browser-release-event="','">\n</streaming-toolbar>\n<streaming-body @local:system:event:*string*="','" .logs="','" .siteCode="','" .inori="','" @exiting-session-event="','">\n</streaming-body>\n  '])),this.inori,this.handleBrowserReleaseEvent,this.handleSysLogs.bind(this),this.logs,this.siteCode,this.inori,this.handleExitingSessionEvent):W(zZ||(zZ=$Z(["  \n    ",""])),null==this.plan.code?W(VZ||(VZ=$Z(['\n<subscription-pricing .plan="','" .inori="','" @plan-selected-event="','">\n</subscription-pricing>'])),this.plan,this.inori,this.handlePlanSelected):W(GZ||(GZ=$Z(['\n<subscription-signup .inori="','" .plan="','" @credential-req-event="','">\n</subscription-signup>\n  '])),this.inori,this.plan,function(){var n=JZ(XZ().m(function n(r){return XZ().w(function(n){for(;;)switch(n.n){case 0:return t.isProcessing=!0,t.requestUpdate(),n.n=1,e.updateComplete;case 1:return n.n=2,t.inori.util.init_comm(!0);case 2:if(!n.v){n.n=4;break}return n.n=3,t.inori.util.dir.load();case 3:t.inori.mq.sys_dbg("credential established"),t.inSession=!0,t.isProcessing=!1,t.requestUpdate();case 4:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}())))}}],[{key:"properties",get:function(){return{isProcessing:{type:Boolean},initialised:{type:Boolean},inSession:{type:Boolean},photo:{type:String},siteCode:{type:String,attribute:!0}}}}]);var n,r}(ce);customElements.define("streaming-portal",sJ)})()})();