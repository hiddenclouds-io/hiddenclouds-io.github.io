/*! For license information please see corp-article.min.js.LICENSE.txt */
(()=>{"use strict";var t={152(e,t){class r{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=r.toUint8Array(e),a=r.toUint8Array(t);if(n.length!==a.byteLength)return!1;for(let e=0;e<n.length;e++)if(n[e]!==a[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let r=0;for(const e of t)r+=e.byteLength;const n=new Uint8Array(r);let a=0;for(const e of t){const t=this.toUint8Array(e);n.set(t,a),a+=t.length}return e[e.length-1]instanceof Function?this.toView(n,e[e.length-1]):n.buffer}}const n="string",a=/^[0-9a-f\s]+$/i,i=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,s=/^[a-zA-Z0-9-_]+$/;class o{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){const t=r.toUint8Array(e);let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return decodeURIComponent(escape(n))}}class c{static toString(e,t=!1){const n=r.toArrayBuffer(e),a=new DataView(n);let i="";for(let e=0;e<n.byteLength;e+=2){const r=a.getUint16(e,t);i+=String.fromCharCode(r)}return i}static fromString(e,t=!1){const r=new ArrayBuffer(2*e.length),n=new DataView(r);for(let r=0;r<e.length;r++)n.setUint16(2*r,e.charCodeAt(r),t);return r}}class u{static isHex(e){return typeof e===n&&a.test(e)}static isBase64(e){return typeof e===n&&i.test(e)}static isBase64Url(e){return typeof e===n&&s.test(e)}static ToString(e,t="utf8"){const n=r.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return c.toString(n,!0);case"utf16":case"utf16be":return c.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return c.fromString(e,!0);case"utf16":case"utf16be":return c.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=r.toUint8Array(e);if("undefined"!=typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!u.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!u.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=u.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return o.fromString(e);case"utf16":case"utf16be":return c.fromString(e);case"utf16le":case"usc2":return c.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=u.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return o.toString(e);case"utf16":case"utf16be":return c.toString(e);case"utf16le":case"usc2":return c.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}static ToBinary(e){const t=r.toUint8Array(e);let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return n}static ToHex(e){const t=r.toUint8Array(e);let n="";const a=t.length;for(let e=0;e<a;e++){const r=t[e];r<16&&(n+="0"),n+=r.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!u.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t.slice(e,e+2);r[e/2]=parseInt(n,16)}return r.buffer}static ToUtf16String(e,t=!1){return c.toString(e,t)}static FromUtf16String(e,t=!1){return c.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}u.DEFAULT_UTF8_ENCODING="utf8",t._H=r,t.U$=u}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const a=globalThis,i=a.ShadowRoot&&(void 0===a.ShadyCSS||a.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class c{constructor(e,t,r){if(this._$cssResult$=!0,r!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(i&&void 0===e){const r=void 0!==t&&1===t.length;r&&(e=o.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&o.set(t,e))}return e}toString(){return this.cssText}}const u=(e,t)=>{if(i)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const r of t){const t=document.createElement("style"),n=a.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=r.cssText,e.appendChild(t)}},l=i?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const r of e.cssRules)t+=r.cssText;return(e=>new c("string"==typeof e?e:e+"",void 0,s))(t)})(e):e,{is:h,defineProperty:d,getOwnPropertyDescriptor:f,getOwnPropertyNames:m,getOwnPropertySymbols:p,getPrototypeOf:g}=Object,v=globalThis,b=v.trustedTypes,w=b?b.emptyScript:"",y=v.reactiveElementPolyfillSupport,k=(e,t)=>e,_={toAttribute(e,t){switch(t){case Boolean:e=e?w:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=null!==e;break;case Number:r=null===e?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch(e){r=null}}return r}},A=(e,t)=>!h(e,t),S={attribute:!0,type:String,converter:_,reflect:!1,useDefault:!1,hasChanged:A};Symbol.metadata??=Symbol("metadata"),v.litPropertyMetadata??=new WeakMap;class C extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=S){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const r=Symbol(),n=this.getPropertyDescriptor(e,r,t);void 0!==n&&d(this.prototype,e,n)}}static getPropertyDescriptor(e,t,r){const{get:n,set:a}=f(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:n,set(t){const i=n?.call(this);a?.call(this,t),this.requestUpdate(e,i,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??S}static _$Ei(){if(this.hasOwnProperty(k("elementProperties")))return;const e=g(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(k("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(k("properties"))){const e=this.properties,t=[...m(e),...p(e)];for(const r of t)this.createProperty(r,e[r])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,r]of t)this.elementProperties.set(e,r)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const r=this._$Eu(e,t);void 0!==r&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const e of r)t.unshift(l(e))}else void 0!==e&&t.push(l(e));return t}static _$Eu(e,t){const r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return u(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){const r=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,r);if(void 0!==n&&!0===r.reflect){const a=(void 0!==r.converter?.toAttribute?r.converter:_).toAttribute(t,r.type);this._$Em=e,null==a?this.removeAttribute(n):this.setAttribute(n,a),this._$Em=null}}_$AK(e,t){const r=this.constructor,n=r._$Eh.get(e);if(void 0!==n&&this._$Em!==n){const e=r.getPropertyOptions(n),a="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:_;this._$Em=n;const i=a.fromAttribute(t,e.type);this[n]=i??this._$Ej?.get(n)??i,this._$Em=null}}requestUpdate(e,t,r,n=!1,a){if(void 0!==e){const i=this.constructor;if(!1===n&&(a=this[e]),r??=i.getPropertyOptions(e),!((r.hasChanged??A)(a,t)||r.useDefault&&r.reflect&&a===this._$Ej?.get(e)&&!this.hasAttribute(i._$Eu(e,r))))return;this.C(e,t,r)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:r,reflect:n,wrapped:a},i){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,i??t??this[e]),!0!==a||void 0!==i)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),!0===n&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,r]of e){const{wrapped:e}=r,n=this[t];!0!==e||this._$AL.has(t)||void 0===n||this.C(t,void 0,r,n)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}}C.elementStyles=[],C.shadowRootOptions={mode:"open"},C[k("elementProperties")]=new Map,C[k("finalized")]=new Map,y?.({ReactiveElement:C}),(v.reactiveElementVersions??=[]).push("2.1.2");const x=globalThis,B=e=>e,E=x.trustedTypes,I=E?E.createPolicy("lit-html",{createHTML:e=>e}):void 0,P="$lit$",N=`lit$${Math.random().toFixed(9).slice(2)}$`,O="?"+N,L=`<${O}>`,U=document,j=()=>U.createComment(""),D=e=>null===e||"object"!=typeof e&&"function"!=typeof e,R=Array.isArray,V="[ \t\n\f\r]",H=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,T=/-->/g,$=/>/g,K=RegExp(`>|${V}(?:([^\\s"'>=/]+)(${V}*=${V}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),F=/'/g,M=/"/g,J=/^(?:script|style|textarea|title)$/i,z=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),q=z(1),W=(z(2),z(3),Symbol.for("lit-noChange")),Z=Symbol.for("lit-nothing"),G=new WeakMap,Q=U.createTreeWalker(U,129);function Y(e,t){if(!R(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==I?I.createHTML(t):t}const X=(e,t)=>{const r=e.length-1,n=[];let a,i=2===t?"<svg>":3===t?"<math>":"",s=H;for(let t=0;t<r;t++){const r=e[t];let o,c,u=-1,l=0;for(;l<r.length&&(s.lastIndex=l,c=s.exec(r),null!==c);)l=s.lastIndex,s===H?"!--"===c[1]?s=T:void 0!==c[1]?s=$:void 0!==c[2]?(J.test(c[2])&&(a=RegExp("</"+c[2],"g")),s=K):void 0!==c[3]&&(s=K):s===K?">"===c[0]?(s=a??H,u=-1):void 0===c[1]?u=-2:(u=s.lastIndex-c[2].length,o=c[1],s=void 0===c[3]?K:'"'===c[3]?M:F):s===M||s===F?s=K:s===T||s===$?s=H:(s=K,a=void 0);const h=s===K&&e[t+1].startsWith("/>")?" ":"";i+=s===H?r+L:u>=0?(n.push(o),r.slice(0,u)+P+r.slice(u)+N+h):r+N+(-2===u?t:h)}return[Y(e,i+(e[r]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),n]};class ee{constructor({strings:e,_$litType$:t},r){let n;this.parts=[];let a=0,i=0;const s=e.length-1,o=this.parts,[c,u]=X(e,t);if(this.el=ee.createElement(c,r),Q.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(n=Q.nextNode())&&o.length<s;){if(1===n.nodeType){if(n.hasAttributes())for(const e of n.getAttributeNames())if(e.endsWith(P)){const t=u[i++],r=n.getAttribute(e).split(N),s=/([.?@])?(.*)/.exec(t);o.push({type:1,index:a,name:s[2],strings:r,ctor:"."===s[1]?ie:"?"===s[1]?se:"@"===s[1]?oe:ae}),n.removeAttribute(e)}else e.startsWith(N)&&(o.push({type:6,index:a}),n.removeAttribute(e));if(J.test(n.tagName)){const e=n.textContent.split(N),t=e.length-1;if(t>0){n.textContent=E?E.emptyScript:"";for(let r=0;r<t;r++)n.append(e[r],j()),Q.nextNode(),o.push({type:2,index:++a});n.append(e[t],j())}}}else if(8===n.nodeType)if(n.data===O)o.push({type:2,index:a});else{let e=-1;for(;-1!==(e=n.data.indexOf(N,e+1));)o.push({type:7,index:a}),e+=N.length-1}a++}}static createElement(e,t){const r=U.createElement("template");return r.innerHTML=e,r}}function te(e,t,r=e,n){if(t===W)return t;let a=void 0!==n?r._$Co?.[n]:r._$Cl;const i=D(t)?void 0:t._$litDirective$;return a?.constructor!==i&&(a?._$AO?.(!1),void 0===i?a=void 0:(a=new i(e),a._$AT(e,r,n)),void 0!==n?(r._$Co??=[])[n]=a:r._$Cl=a),void 0!==a&&(t=te(e,a._$AS(e,t.values),a,n)),t}class re{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:r}=this._$AD,n=(e?.creationScope??U).importNode(t,!0);Q.currentNode=n;let a=Q.nextNode(),i=0,s=0,o=r[0];for(;void 0!==o;){if(i===o.index){let t;2===o.type?t=new ne(a,a.nextSibling,this,e):1===o.type?t=new o.ctor(a,o.name,o.strings,this,e):6===o.type&&(t=new ce(a,this,e)),this._$AV.push(t),o=r[++s]}i!==o?.index&&(a=Q.nextNode(),i++)}return Q.currentNode=U,n}p(e){let t=0;for(const r of this._$AV)void 0!==r&&(void 0!==r.strings?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}}class ne{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,r,n){this.type=2,this._$AH=Z,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=te(this,e,t),D(e)?e===Z||null==e||""===e?(this._$AH!==Z&&this._$AR(),this._$AH=Z):e!==this._$AH&&e!==W&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>R(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Z&&D(this._$AH)?this._$AA.nextSibling.data=e:this.T(U.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:r}=e,n="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=ee.createElement(Y(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new re(n,this),r=e.u(this.options);e.p(t),this.T(r),this._$AH=e}}_$AC(e){let t=G.get(e.strings);return void 0===t&&G.set(e.strings,t=new ee(e)),t}k(e){R(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let r,n=0;for(const a of e)n===t.length?t.push(r=new ne(this.O(j()),this.O(j()),this,this.options)):r=t[n],r._$AI(a),n++;n<t.length&&(this._$AR(r&&r._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=B(e).nextSibling;B(e).remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class ae{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,n,a){this.type=1,this._$AH=Z,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=a,r.length>2||""!==r[0]||""!==r[1]?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=Z}_$AI(e,t=this,r,n){const a=this.strings;let i=!1;if(void 0===a)e=te(this,e,t,0),i=!D(e)||e!==this._$AH&&e!==W,i&&(this._$AH=e);else{const n=e;let s,o;for(e=a[0],s=0;s<a.length-1;s++)o=te(this,n[r+s],t,s),o===W&&(o=this._$AH[s]),i||=!D(o)||o!==this._$AH[s],o===Z?e=Z:e!==Z&&(e+=(o??"")+a[s+1]),this._$AH[s]=o}i&&!n&&this.j(e)}j(e){e===Z?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ie extends ae{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Z?void 0:e}}class se extends ae{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Z)}}class oe extends ae{constructor(e,t,r,n,a){super(e,t,r,n,a),this.type=5}_$AI(e,t=this){if((e=te(this,e,t,0)??Z)===W)return;const r=this._$AH,n=e===Z&&r!==Z||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,a=e!==Z&&(r===Z||n);n&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ce{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){te(this,e)}}const ue=x.litHtmlPolyfillSupport;ue?.(ee,ne),(x.litHtmlVersions??=[]).push("3.3.2");const le=globalThis;class he extends C{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,r)=>{const n=r?.renderBefore??t;let a=n._$litPart$;if(void 0===a){const e=r?.renderBefore??null;n._$litPart$=a=new ne(t.insertBefore(j(),e),e,void 0,r??{})}return a._$AI(e),a})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return W}}he._$litElement$=!0,he.finalized=!0,le.litElementHydrateSupport?.({LitElement:he});const de=le.litElementPolyfillSupport;de?.({LitElement:he}),(le.litElementVersions??=[]).push("4.2.2");var fe=n(152);function me(e,t,r){var n;return e instanceof Object==0?r:null!==(n=e[t])&&void 0!==n?n:r}function pe(e,t=0,r=e.byteLength-t,n=!1){let a="";for(const i of new Uint8Array(e,t,r)){const e=i.toString(16).toUpperCase();1===e.length&&(a+="0"),a+=e,n&&(a+=" ")}return a.trim()}function ge(e,t){let r=0;if(1===e.length)return e[0];for(let n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function ve(e,t,r=-1){const n=r;let a=e,i=0,s=Math.pow(2,t);for(let r=1;r<8;r++){if(e<s){let e;if(n<0)e=new ArrayBuffer(r),i=r;else{if(n<r)return new ArrayBuffer(0);e=new ArrayBuffer(n),i=n}const s=new Uint8Array(e);for(let e=r-1;e>=0;e--){const r=Math.pow(2,e*t);s[i-e-1]=Math.floor(a/r),a-=s[i-e-1]*r}return e}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function be(...e){let t=0,r=0;for(const r of e)t+=r.byteLength;const n=new ArrayBuffer(t),a=new Uint8Array(n);for(const t of e)a.set(new Uint8Array(t),r),r+=t.byteLength;return n}function we(...e){let t=0,r=0;for(const r of e)t+=r.length;const n=new ArrayBuffer(t),a=new Uint8Array(n);for(const t of e)a.set(t,r),r+=t.length;return a}function ye(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],r=0===e[0]&&!(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(t);for(let e=0;e<this.valueHex.byteLength;e++)r[e]=0;r[0]=128&e[0];const n=ge(r,8),a=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(a);for(let t=0;t<this.valueHex.byteLength;t++)i[t]=e[t];return i[0]&=127,ge(i,8)-n}function ke(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}function _e(e,t){const r=e.toString(10);if(t<r.length)return"";const n=t-r.length,a=new Array(n);for(let e=0;e<n;e++)a[e]="0";return a.join("").concat(r)}const Ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Ce(e,t=!1,r=!1,n=!1){let a=0,i=0,s=0,o="";const c=t?Se:Ae;if(n){let t=0;for(let r=0;r<e.length;r++)if(0!==e.charCodeAt(r)){t=r;break}e=e.slice(t)}for(;a<e.length;){const t=e.charCodeAt(a++);a>=e.length&&(i=1);const n=e.charCodeAt(a++);a>=e.length&&(s=1);const u=e.charCodeAt(a++),l=t>>2,h=(3&t)<<4|n>>4;let d=(15&n)<<2|u>>6,f=63&u;1===i?d=f=64:1===s&&(f=64),o+=r?64===d?`${c.charAt(l)}${c.charAt(h)}`:64===f?`${c.charAt(l)}${c.charAt(h)}${c.charAt(d)}`:`${c.charAt(l)}${c.charAt(h)}${c.charAt(d)}${c.charAt(f)}`:`${c.charAt(l)}${c.charAt(h)}${c.charAt(d)}${c.charAt(f)}`}return o}function xe(e,t=!1,r=!1){const n=t?Se:Ae;function a(e){for(let t=0;t<64;t++)if(n.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}let s=0,o="";for(;s<e.length;){const t=a(e.charAt(s++)),r=s>=e.length?0:a(e.charAt(s++)),n=s>=e.length?0:a(e.charAt(s++)),c=s>=e.length?0:a(e.charAt(s++)),u=i(t)<<2|i(r)>>4,l=(15&i(r))<<4|i(n)>>2,h=(3&i(n))<<6|i(c);o+=String.fromCharCode(u),64!==n&&(o+=String.fromCharCode(l)),64!==c&&(o+=String.fromCharCode(h))}if(r){let e=-1;for(let t=o.length-1;t>=0;t--)if(0!==o.charCodeAt(t)){e=t;break}o=-1!==e?o.slice(0,e+1):""}return o}function Be(e){let t="";const r=new Uint8Array(e);for(const e of r)t+=String.fromCharCode(e);return t}function Ee(e){const t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return r}const Ie=Math.log(2);function Pe(e){const t=Math.log(e)/Ie,r=Math.floor(t),n=Math.round(t);return r===n?r:n}function Ne(e,t){for(const r of t)delete e[r]}function Oe(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Le(e){let t=0,r=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;const n=new Uint8Array(t);for(let t=0;t<e.length;t++){const a=e[t];n.set(new Uint8Array(a),r),r+=a.byteLength}return n.buffer}function Ue(e,t,r,n){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0&&(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",1)):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class je{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Le(this.items)}}const De=[new Uint8Array([1])],Re="0123456789",Ve="name",He="valueHexView",Te="",$e=new ArrayBuffer(0),Ke=new Uint8Array(0),Fe="EndOfContent",Me="OCTET STRING",Je="BIT STRING";function ze(e){var t;return(t=class extends e{constructor(...e){var t;super(...e);const r=e[0]||{};this.isHexOnly=null!==(t=r.isHexOnly)&&void 0!==t&&t,this.valueHexView=r.valueHex?fe._H.toUint8Array(r.valueHex):Ke}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,r){const n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Ue(this,n,t,r))return-1;const a=t+r;return this.valueHexView=n.subarray(t,a),this.valueHexView.length?(this.blockLength=r,a):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",$e)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:fe.U$.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class qe{constructor({blockLength:e=0,error:t="",warnings:r=[],valueBeforeDecode:n=Ke}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=fe._H.toUint8Array(n)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:fe.U$.ToHex(this.valueBeforeDecodeView)}}}qe.NAME="baseBlock";class We extends qe{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}We.NAME="valueBlock";class Ze extends(ze(qe)){constructor({idBlock:e={}}={}){var t,r,n,a;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?fe._H.toUint8Array(e.valueHex):Ke,this.tagClass=null!==(r=e.tagClass)&&void 0!==r?r:-1,this.tagNumber=null!==(n=e.tagNumber)&&void 0!==n?n:-1,this.isConstructed=null!==(a=e.isConstructed)&&void 0!==a&&a):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",$e}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const r=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,r[0]=t}return r.buffer}if(!this.isHexOnly){const r=ve(this.tagNumber,7),n=new Uint8Array(r),a=r.byteLength,i=new Uint8Array(a+1);if(i[0]=31|t,!e){for(let e=0;e<a-1;e++)i[e+1]=128|n[e];i[a]=n[a-1]}return i.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|t,!e){const e=this.valueHexView;for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHexView.byteLength]=e[e.length-1]}return r.buffer}fromBER(e,t,r){const n=fe._H.toUint8Array(e);if(!Ue(this,n,t,r))return-1;const a=n.subarray(t,t+r);if(0===a.length)return this.error="Zero buffer length",-1;switch(192&a[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=!(32&~a[0]),this.isHexOnly=!1;const i=31&a[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),r=255;for(;128&a[e];){if(t[e-1]=127&a[e],e++,e>=a.length)return this.error="End of input reached before message was fully decoded",-1;if(e===r){r+=255;const e=new Uint8Array(r);for(let r=0;r<t.length;r++)e[r]=t[r];t=this.valueHexView=new Uint8Array(r)}}this.blockLength=e+1,t[e-1]=127&a[e];const n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t[r];t=this.valueHexView=new Uint8Array(e),t.set(n),this.blockLength<=9?this.tagNumber=ge(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}Ze.NAME="identificationBlock";class Ge extends qe{constructor({lenBlock:e={}}={}){var t,r,n;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(r=e.longFormUsed)&&void 0!==r&&r,this.length=null!==(n=e.length)&&void 0!==n?n:0}fromBER(e,t,r){const n=fe._H.toUint8Array(e);if(!Ue(this,n,t,r))return-1;const a=n.subarray(t,t+r);if(0===a.length)return this.error="Zero buffer length",-1;if(255===a[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===a[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&a[0]),!1===this.longFormUsed)return this.length=a[0],this.blockLength=1,t+this.blockLength;const i=127&a[0];if(i>8)return this.error="Too big integer",-1;if(i+1>a.length)return this.error="End of input reached before message was fully decoded",-1;const s=t+1,o=n.subarray(s,s+i);return 0===o[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=ge(o,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const n=ve(this.length,8);if(n.byteLength>127)return this.error="Too big length",$e;if(t=new ArrayBuffer(n.byteLength+1),e)return t;const a=new Uint8Array(n);r=new Uint8Array(t),r[0]=128|n.byteLength;for(let e=0;e<n.byteLength;e++)r[e+1]=a[e];return t}return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}Ge.NAME="lengthBlock";const Qe={};class Ye extends qe{constructor({name:e="",optional:t=!1,primitiveSchema:r,...n}={},a){super(n),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new Ze(n),this.lenBlock=new Ge(n),this.valueBlock=a?new a(n):new We(n)}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}toBER(e,t){const r=t||new je;t||Xe(this);const n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;const n=this.lenBlock.toBER(e);r.write(n),r.write(t)}return t?$e:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():fe.U$.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${fe.U$.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){return this===e||e instanceof this.constructor&&ke(this.toBER(),e.toBER())}}function Xe(e){if(e instanceof Qe.Constructed)for(const t of e.valueBlock.value)Xe(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}Ye.NAME="BaseBlock";class et extends Ye{constructor({value:e="",...t}={},r){super(t,r),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}et.NAME="BaseStringBlock";class tt extends(ze(We)){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}var rt,nt,at,it,st,ot,ct,ut,lt,ht,dt,ft,mt,pt,gt,vt,bt,wt,yt,kt,_t,At,St,Ct,xt,Bt,Et,It,Pt,Nt,Ot,Lt,Ut;tt.NAME="PrimitiveValueBlock";class jt extends Ye{constructor(e={}){super(e,tt),this.idBlock.isConstructed=!1}}function Dt(e,t=0,r=e.length){const n=t;let a=new Ye({},We);const i=new qe;if(!Ue(i,e,t,r))return a.error=i.error,{offset:-1,result:a};if(!e.subarray(t,t+r).length)return a.error="Zero buffer length",{offset:-1,result:a};let s=a.idBlock.fromBER(e,t,r);if(a.idBlock.warnings.length&&a.warnings.concat(a.idBlock.warnings),-1===s)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=s,r-=a.idBlock.blockLength,s=a.lenBlock.fromBER(e,t,r),a.lenBlock.warnings.length&&a.warnings.concat(a.lenBlock.warnings),-1===s)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=s,r-=a.lenBlock.blockLength,!a.idBlock.isConstructed&&a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};let o=Ye;if(1===a.idBlock.tagClass){if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};o=Qe.EndOfContent;break;case 1:o=Qe.Boolean;break;case 2:o=Qe.Integer;break;case 3:o=Qe.BitString;break;case 4:o=Qe.OctetString;break;case 5:o=Qe.Null;break;case 6:o=Qe.ObjectIdentifier;break;case 10:o=Qe.Enumerated;break;case 12:o=Qe.Utf8String;break;case 13:o=Qe.RelativeObjectIdentifier;break;case 14:o=Qe.TIME;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:o=Qe.Sequence;break;case 17:o=Qe.Set;break;case 18:o=Qe.NumericString;break;case 19:o=Qe.PrintableString;break;case 20:o=Qe.TeletexString;break;case 21:o=Qe.VideotexString;break;case 22:o=Qe.IA5String;break;case 23:o=Qe.UTCTime;break;case 24:o=Qe.GeneralizedTime;break;case 25:o=Qe.GraphicString;break;case 26:o=Qe.VisibleString;break;case 27:o=Qe.GeneralString;break;case 28:o=Qe.UniversalString;break;case 29:o=Qe.CharacterString;break;case 30:o=Qe.BmpString;break;case 31:o=Qe.DATE;break;case 32:o=Qe.TimeOfDay;break;case 33:o=Qe.DateTime;break;case 34:o=Qe.Duration;break;default:{const e=a.idBlock.isConstructed?new Qe.Constructed:new Qe.Primitive;e.idBlock=a.idBlock,e.lenBlock=a.lenBlock,e.warnings=a.warnings,a=e}}}else o=a.idBlock.isConstructed?Qe.Constructed:Qe.Primitive;return a=function(e,t){if(e instanceof t)return e;const r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}(a,o),s=a.fromBER(e,t,a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecodeView=e.subarray(n,n+a.blockLength),{offset:s,result:a}}function Rt(e){if(!e.byteLength){const e=new Ye({},We);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Dt(fe._H.toUint8Array(e).slice(),0,e.byteLength)}function Vt(e,t){return e?1:t}rt=jt,Qe.Primitive=rt,jt.NAME="PRIMITIVE";class Ht extends We{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const n=fe._H.toUint8Array(e);if(!Ue(this,n,t,r))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let a=t;for(;Vt(this.isIndefiniteForm,r)>0;){const e=Dt(n,a,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(a=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===Fe)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Fe?this.value.pop():this.warnings.push("No EndOfContent block encoded")),a}toBER(e,t){const r=t||new je;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,r);return t?$e:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Ht.NAME="ConstructedValueBlock";class Tt extends Ye{constructor(e={}){super(e,Ht),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){const e=[];for(const t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map(e=>`  ${e}`).join("\n"));const t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :\n${e.join("\n")}`:`${t} :`}}nt=Tt,Qe.Constructed=nt,Tt.NAME="CONSTRUCTED";class $t extends We{fromBER(e,t,r){return t}toBER(e){return $e}}$t.override="EndOfContentValueBlock";class Kt extends Ye{constructor(e={}){super(e,$t),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}at=Kt,Qe.EndOfContent=at,Kt.NAME=Fe;class Ft extends Ye{constructor(e={}){super(e,We),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const e=new Uint8Array(r);e[0]=5,e[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}it=Ft,Qe.Null=it,Ft.NAME="NULL";class Mt extends(ze(We)){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=fe._H.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,r){const n=fe._H.toUint8Array(e);return Ue(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,ye.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}Mt.NAME="BooleanValueBlock";class Jt extends Ye{constructor(e={}){super(e,Mt),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}st=Jt,Qe.Boolean=st,Jt.NAME="BOOLEAN";class zt extends(ze(Ht)){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,n=Ht.prototype.fromBER.call(this,e,t,r),-1===n)return n;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.NAME;if(t===Fe){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==Me)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,r),this.blockLength=r;return n}toBER(e,t){return this.isConstructed?Ht.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}zt.NAME="OctetStringValueBlock";class qt extends Ye{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,a;null!==(n=r.isConstructed)&&void 0!==n||(r.isConstructed=!!(null===(a=r.value)||void 0===a?void 0:a.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},zt),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){const e=Dt(n,0,n.byteLength);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}}catch(e){}}return super.fromBER(e,t,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Tt.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${fe.U$.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof qt&&e.push(t.valueBlock.valueHexView);return fe._H.concat(e)}}ot=qt,Qe.OctetString=ot,qt.NAME=Me;class Wt extends(ze(Ht)){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(n=Ht.prototype.fromBER.call(this,e,t,r),-1===n)return n;for(const e of this.value){const t=e.constructor.NAME;if(t===Fe){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==Je)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const r=e.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return n}const a=fe._H.toUint8Array(e);if(!Ue(this,a,t,r))return-1;const i=a.subarray(t,t+r);if(this.unusedBits=i[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const e=i.subarray(1);try{if(e.byteLength){const t=Dt(e,0,e.byteLength);-1!==t.offset&&t.offset===r-1&&(this.value=[t.result])}}catch(e){}}return this.valueHexView=i.subarray(1),this.blockLength=i.length,t+r}toBER(e,t){if(this.isConstructed)return Ht.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return $e;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Wt.NAME="BitStringValueBlock";class Zt extends Ye{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,a;null!==(n=r.isConstructed)&&void 0!==n||(r.isConstructed=!!(null===(a=r.value)||void 0===a?void 0:a.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Wt),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Tt.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const r of t)e.push(r.toString(2).padStart(8,"0"));const r=e.join("");return`${this.constructor.NAME} : ${r.substring(0,r.length-this.valueBlock.unusedBits)}`}}}function Gt(e,t){const r=new Uint8Array([0]),n=new Uint8Array(e),a=new Uint8Array(t);let i=n.slice(0);const s=i.length-1,o=a.slice(0),c=o.length-1;let u=0,l=0;for(let e=c<s?s:c;e>=0;e--,l++)u=1==l<o.length?i[s-l]+o[c-l]+r[0]:i[s-l]+r[0],r[0]=u/10,1==l>=i.length?i=we(new Uint8Array([u%10]),i):i[s-l]=u%10;return r[0]>0&&(i=we(r,i)),i}function Qt(e){if(e>=De.length)for(let t=De.length;t<=e;t++){const e=new Uint8Array([0]);let r=De[t-1].slice(0);for(let t=r.length-1;t>=0;t--){const n=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=n[0]/10,r[t]=n[0]%10}e[0]>0&&(r=we(e,r)),De.push(r)}return De[e]}function Yt(e,t){let r=0;const n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),s=i.length-1,o=a.slice(0),c=o.length-1;let u,l=0;for(let e=c;e>=0;e--,l++)u=i[s-l]-o[c-l]-r,1==u<0?(r=1,i[s-l]=u+10):(r=0,i[s-l]=u);if(r>0)for(let e=s-c+1;e>=0;e--,l++){if(u=i[s-l]-r,!(u<0)){r=0,i[s-l]=u;break}r=1,i[s-l]=u+10}return i.slice()}ct=Zt,Qe.BitString=ct,Zt.NAME=Je;class Xt extends(ze(We)){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=ye.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){const t=e<0?-1*e:e;let r=128;for(let n=1;n<8;n++){if(t<=r){if(e<0){const e=ve(r-t,8,n);return new Uint8Array(e)[0]|=128,e}let a=ve(t,8,n),i=new Uint8Array(a);if(128&i[0]){const e=a.slice(0),t=new Uint8Array(e);a=new ArrayBuffer(a.byteLength+1),i=new Uint8Array(a);for(let r=0;r<e.byteLength;r++)i[r+1]=t[r];i[0]=0}return a}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,n=0){const a=this.fromBER(e,t,r);if(-1===a)return a;const i=this.valueHexView;return 0===i[0]&&128&i[1]?this.valueHexView=i.subarray(1):0!==n&&i.length<n&&(n-i.length>1&&(n=i.length+1),this.valueHexView=i.subarray(n-i.length)),a}toDER(e=!1){const t=this.valueHexView;switch(!0){case!!(128&t[0]):{const e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&!(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,r){const n=super.fromBER(e,t,r);return-1===n||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=8*this.valueHexView.length-1;let t,r=new Uint8Array(8*this.valueHexView.length/3),n=0;const a=this.valueHexView;let i="",s=!1;for(let s=a.byteLength-1;s>=0;s--){t=a[s];for(let a=0;a<8;a++)1&~t||(n===e?(r=Yt(Qt(n),r),i="-"):r=Gt(r,Qt(n))),n++,t>>=1}for(let e=0;e<r.length;e++)r[e]&&(s=!0),s&&(i+=Re.charAt(r[e]));return!1===s&&(i+=Re.charAt(0)),i}}ut=Xt,Xt.NAME="IntegerValueBlock",Object.defineProperty(ut.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class er extends Ye{constructor(e={}){super(e,Xt),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Oe(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Oe();const t=BigInt(e),r=new je,n=t.toString(16).replace(/^-/,""),a=new Uint8Array(fe.U$.FromHex(n));if(t<0){const e=new Uint8Array(a.length+(128&a[0]?1:0));e[0]|=128;const n=BigInt(`0x${fe.U$.ToHex(e)}`)+t,i=fe._H.toUint8Array(fe.U$.FromHex(n.toString(16)));i[0]|=128,r.write(i)}else 128&a[0]&&r.write(new Uint8Array([0])),r.write(a);return new er({valueHex:r.final()})}convertToDER(){const e=new er({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new er({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}lt=er,Qe.Integer=lt,er.NAME="INTEGER";class tr extends er{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}ht=tr,Qe.Enumerated=ht,tr.NAME="ENUMERATED";class rr extends(ze(We)){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const n=fe._H.toUint8Array(e);if(!Ue(this,n,t,r))return-1;const a=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&a[e],this.blockLength++,128&a[e]);e++);const i=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)i[e]=this.valueHexView[e];return this.valueHexView=i,128&a[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ge(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Oe();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+(e+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=ve(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",$e;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r}toString(){let e="";if(this.isHexOnly)e=fe.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}rr.NAME="sidBlock";class nr extends We{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const t=new rr;if(n=t.fromBER(e,n,r),-1===n)return this.blockLength=0,this.error=t.error,n;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,$e;t.push(n)}return Le(t)}fromString(e){this.value=[];let t=0,r=0,n="",a=!1;do{if(r=e.indexOf(".",t),n=-1===r?e.substring(t):e.substring(t,r),t=r+1,a){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return void(this.value=[])}const r=parseInt(n,10);if(isNaN(r))return;e.valueDec=r+t,a=!1}else{const e=new rr;if(n>Number.MAX_SAFE_INTEGER){Oe();const t=BigInt(n);e.valueBigInt=t}else if(e.valueDec=parseInt(n,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,a=!0),this.value.push(e)}}while(-1!==r)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?(n=`{${n}}`,this.value[r].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}nr.NAME="ObjectIdentifierValueBlock";class ar extends Ye{constructor(e={}){super(e,nr),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}dt=ar,Qe.ObjectIdentifier=dt,ar.NAME="OBJECT IDENTIFIER";class ir extends(ze(qe)){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(0===r)return t;const n=fe._H.toUint8Array(e);if(!Ue(this,n,t,r))return-1;const a=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&a[e],this.blockLength++,128&a[e]);e++);const i=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)i[e]=this.valueHexView[e];return this.valueHexView=i,128&a[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ge(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=ve(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",$e;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r.buffer}toString(){let e="";return e=this.isHexOnly?fe.U$.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}ir.NAME="relativeSidBlock";class sr extends We{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const t=new ir;if(n=t.fromBER(e,n,r),-1===n)return this.blockLength=0,this.error=t.error,n;this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e,t){const r=[];for(let t=0;t<this.value.length;t++){const n=this.value[t].toBER(e);if(0===n.byteLength)return this.error=this.value[t].error,$e;r.push(n)}return Le(r)}fromString(e){this.value=[];let t=0,r=0,n="";do{r=e.indexOf(".",t),n=-1===r?e.substring(t):e.substring(t,r),t=r+1;const a=new ir;if(a.valueDec=parseInt(n,10),isNaN(a.valueDec))return!0;this.value.push(a)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?(n=`{${n}}`,e+=n):e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}sr.NAME="RelativeObjectIdentifierValueBlock";class or extends Ye{constructor(e={}){super(e,sr),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ft=or,Qe.RelativeObjectIdentifier=ft,or.NAME="RelativeObjectIdentifier";class cr extends Tt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}mt=cr,Qe.Sequence=mt,cr.NAME="SEQUENCE";class ur extends Tt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}pt=ur,Qe.Set=pt,ur.NAME="SET";class lr extends(ze(We)){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Te}toJSON(){return{...super.toJSON(),value:this.value}}}lr.NAME="StringValueBlock";class hr extends lr{}hr.NAME="SimpleStringValueBlock";class dr extends et{constructor({...e}={}){super(e,hr)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,fe._H.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}dr.NAME="SIMPLE STRING";class fr extends dr{fromBuffer(e){this.valueBlock.valueHexView=fe._H.toUint8Array(e);try{this.valueBlock.value=fe.U$.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=fe.U$.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(fe.U$.FromUtf8String(e)),this.valueBlock.value=e}}fr.NAME="Utf8StringValueBlock";class mr extends fr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}gt=mr,Qe.Utf8String=gt,mr.NAME="UTF8String";class pr extends dr{fromBuffer(e){this.valueBlock.value=fe.U$.ToUtf16String(e),this.valueBlock.valueHexView=fe._H.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(fe.U$.FromUtf16String(e))}}pr.NAME="BmpStringValueBlock";class gr extends pr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}vt=gr,Qe.BmpString=vt,gr.NAME="BMPString";class vr extends dr{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let n=0;n<t;n++){const t=ve(e.charCodeAt(n),8),a=new Uint8Array(t);if(a.length>4)continue;const i=4-a.length;for(let e=a.length-1;e>=0;e--)r[4*n+e+i]=a[e]}this.valueBlock.value=e}}vr.NAME="UniversalStringValueBlock";class br extends vr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}bt=br,Qe.UniversalString=bt,br.NAME="UniversalString";class wr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}wt=wr,Qe.NumericString=wt,wr.NAME="NumericString";class yr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}yt=yr,Qe.PrintableString=yt,yr.NAME="PrintableString";class kr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}kt=kr,Qe.TeletexString=kt,kr.NAME="TeletexString";class _r extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}_t=_r,Qe.VideotexString=_t,_r.NAME="VideotexString";class Ar extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}At=Ar,Qe.IA5String=At,Ar.NAME="IA5String";class Sr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}St=Sr,Qe.GraphicString=St,Sr.NAME="GraphicString";class Cr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Ct=Cr,Qe.VisibleString=Ct,Cr.NAME="VisibleString";class xr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}xt=xr,Qe.GeneralString=xt,xr.NAME="GeneralString";class Br extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}Bt=Br,Qe.CharacterString=Bt,Br.NAME="CharacterString";class Er extends Cr{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,fe._H.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for conversion");const r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){const e=new Array(7);return e[0]=_e(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=_e(this.month,2),e[2]=_e(this.day,2),e[3]=_e(this.hour,2),e[4]=_e(this.minute,2),e[5]=_e(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Et=Er,Qe.UTCTime=Et,Er.NAME="UTCTime";class Ir extends Er{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,n="",a="",i=0,s=0,o=0;if("Z"===e[e.length-1])n=e.substring(0,e.length-1),r=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let e=1,t=n.indexOf("+"),r="";if(-1===t&&(t=n.indexOf("-"),e=-1),-1!==t){if(r=n.substring(t+1),n=n.substring(0,t),2!==r.length&&4!==r.length)throw new Error("Wrong input string for conversion");let a=parseInt(r.substring(0,2),10);if(isNaN(a.valueOf()))throw new Error("Wrong input string for conversion");if(s=e*a,4===r.length){if(a=parseInt(r.substring(2,4),10),isNaN(a.valueOf()))throw new Error("Wrong input string for conversion");o=e*a}}}let c=n.indexOf(".");if(-1===c&&(c=n.indexOf(",")),-1!==c){const e=new Number(`0${n.substring(c)}`);if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");i=e.valueOf(),a=n.substring(0,c)}else a=n;switch(!0){case 8===a.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==c)throw new Error("Wrong input string for conversion");break;case 10===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){const e=1e3*i;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for conversion")}const u=t.exec(a);if(null===u)throw new Error("Wrong input string for conversion");for(let e=1;e<u.length;e++)switch(e){case 1:this.year=parseInt(u[e],10);break;case 2:this.month=parseInt(u[e],10);break;case 3:this.day=parseInt(u[e],10);break;case 4:this.hour=parseInt(u[e],10)+s;break;case 5:this.minute=parseInt(u[e],10)+o;break;case 6:this.second=parseInt(u[e],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){const e=[];return e.push(_e(this.year,4)),e.push(_e(this.month,2)),e.push(_e(this.day,2)),e.push(_e(this.hour,2)),e.push(_e(this.minute,2)),e.push(_e(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(_e(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}It=Ir,Qe.GeneralizedTime=It,Ir.NAME="GeneralizedTime";class Pr extends mr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Pt=Pr,Qe.DATE=Pt,Pr.NAME="DATE";class Nr extends mr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Nt=Nr,Qe.TimeOfDay=Nt,Nr.NAME="TimeOfDay";class Or extends mr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}Ot=Or,Qe.DateTime=Ot,Or.NAME="DateTime";class Lr extends mr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Lt=Lr,Qe.Duration=Lt,Lr.NAME="Duration";class Ur extends mr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Ut=Ur,Qe.TIME=Ut,Ur.NAME="TIME";class jr{constructor({name:e="",optional:t=!1}={}){this.name=e,this.optional=t}}class Dr extends jr{constructor({value:e=[],...t}={}){super(t),this.value=e}}class Rr extends jr{constructor({value:e=new jr,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}class Vr{constructor({data:e=Ke}={}){this.dataView=fe._H.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=fe._H.toUint8Array(e)}fromBER(e,t,r){const n=t+r;return this.dataView=fe._H.toUint8Array(e).subarray(t,n),n}toBER(e){return this.dataView.slice().buffer}}function Hr(e,t,r){if(r instanceof Dr){for(let n=0;n<r.value.length;n++)if(Hr(e,t,r.value[n]).verified)return{verified:!0,result:e};{const e={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(Ve)&&(e.name=r.name),e}}if(r instanceof jr)return r.hasOwnProperty(Ve)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==0)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=r.idBlock.toBER(!1);if(0===n.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(n,0,n.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(He in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=r.idBlock.valueHexView,a=t.idBlock.valueHexView;if(n.length!==a.length)return{verified:!1,result:e};for(let t=0;t<n.length;t++)if(n[t]!==a[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Te),r.name&&(e[r.name]=t)),r instanceof Qe.Constructed){let n=0,a={verified:!1,result:{error:"Unknown error"}},i=r.valueBlock.value.length;if(i>0&&r.valueBlock.value[0]instanceof Rr&&(i=t.valueBlock.value.length),0===i)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){let t=!0;for(let e=0;e<r.valueBlock.value.length;e++)t=t&&(r.valueBlock.value[e].optional||!1);return t?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Te),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let s=0;s<i;s++)if(s-n>=t.valueBlock.value.length){if(!1===r.valueBlock.value[s].optional){const t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Te),r.name&&(delete e[r.name],t.name=r.name)),t}}else if(r.valueBlock.value[0]instanceof Rr){if(a=Hr(e,t.valueBlock.value[s],r.valueBlock.value[0].value),!1===a.verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Te),r.name&&delete e[r.name]),a;n++}if(Ve in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let n={};n="local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e,void 0===n[r.valueBlock.value[0].name]&&(n[r.valueBlock.value[0].name]=[]),n[r.valueBlock.value[0].name].push(t.valueBlock.value[s])}}else if(a=Hr(e,t.valueBlock.value[s-n],r.valueBlock.value[s]),!1===a.verified){if(!r.valueBlock.value[s].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Te),r.name&&delete e[r.name]),a;n++}if(!1===a.verified){const t={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Te),r.name&&(delete e[r.name],t.name=r.name)),t}return{verified:!0,result:e}}if(r.primitiveSchema&&He in t.valueBlock){const n=Dt(t.valueBlock.valueHexView);if(-1===n.offset){const t={verified:!1,result:n.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,Te),r.name&&(delete e[r.name],t.name=r.name)),t}return Hr(e,n.result,r.primitiveSchema)}return{verified:!0,result:e}}class Tr{constructor(e={}){this.algorithmId=me(e,"algorithmId",Tr.defaultValues("algorithmId")),"algorithmParams"in e&&(this.algorithmParams=me(e,"algorithmParams",Tr.defaultValues("algorithmParams"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new jr;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof jr;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",optional:t.optional||!1,value:[new ar({name:t.algorithmIdentifier||""}),new jr({name:t.algorithmParams||"",optional:!0})]})}fromSchema(e){Ne(e,["algorithm","params"]);const t=Hr(e,e,Tr.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=t.result.algorithm.valueBlock.toString(),"params"in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new ar({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof jr==0&&e.push(this.algorithmParams),new cr({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof jr==0&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return e instanceof Tr!=0&&this.algorithmId===e.algorithmId&&("algorithmParams"in this?"algorithmParams"in e&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!("algorithmParams"in e))}}class $r{constructor(e={}){this.x=me(e,"x",$r.defaultValues("x")),this.y=me(e,"y",$r.defaultValues("y")),this.namedCurve=me(e,"namedCurve",$r.defaultValues("namedCurve")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"x":case"y":return ke(t,$r.defaultValues(e));case"namedCurve":return""===t;default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static schema(e={}){return new Vr}fromSchema(e){if(e instanceof ArrayBuffer==0)throw new Error("Object's schema was not verified against input data for ECPublicKey");if(4!==new Uint8Array(e)[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");let t;switch(this.namedCurve){case"1.2.840.10045.3.1.7":t=32;break;case"1.3.132.0.34":t=48;break;case"1.3.132.0.35":t=66;break;default:throw new Error(`Incorrect curve OID: ${this.namedCurve}`)}if(e.byteLength!==2*t+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,t+1),this.y=e.slice(1+t,2*t+1)}toSchema(){return new Vr({data:be(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){let e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}return{crv:e,x:Ce(Be(this.x),!0,!0,!1),y:Ce(Be(this.y),!0,!0,!1)}}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("x"in e))throw new Error('Absent mandatory parameter "x"');{const r=Ee(xe(e.x,!0));if(r.byteLength<t){this.x=new ArrayBuffer(t);const e=new Uint8Array(this.x),n=new Uint8Array(r);e.set(n,1)}else this.x=r.slice(0,t)}if(!("y"in e))throw new Error('Absent mandatory parameter "y"');{const r=Ee(xe(e.y,!0));if(r.byteLength<t){this.y=new ArrayBuffer(t);const e=new Uint8Array(this.y),n=new Uint8Array(r);e.set(n,1)}else this.y=r.slice(0,t)}}}class Kr{constructor(e={}){this.modulus=me(e,"modulus",Kr.defaultValues("modulus")),this.publicExponent=me(e,"publicExponent",Kr.defaultValues("publicExponent")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"modulus":case"publicExponent":return new er;default:throw new Error(`Invalid member name for RSAPublicKey class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new er({name:t.modulus||""}),new er({name:t.publicExponent||""})]})}fromSchema(e){Ne(e,["modulus","publicExponent"]);const t=Hr(e,e,Kr.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new cr({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:Ce(Be(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Ce(Be(this.publicExponent.valueBlock.valueHex),!0,!0,!0)}}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');{const t=Ee(xe(e.n,!0));this.modulus=new er({valueHex:t.slice(0,Math.pow(2,Pe(t.byteLength)))})}if(!("e"in e))throw new Error('Absent mandatory parameter "e"');this.publicExponent=new er({valueHex:Ee(xe(e.e,!0)).slice(0,3)})}}class Fr{constructor(e={}){this.algorithm=me(e,"algorithm",Fr.defaultValues("algorithm")),this.subjectPublicKey=me(e,"subjectPublicKey",Fr.defaultValues("subjectPublicKey")),"parsedKey"in e&&(this.parsedKey=me(e,"parsedKey",Fr.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"algorithm":return new Tr;case"subjectPublicKey":return new Zt;default:throw new Error(`Invalid member name for PublicKeyInfo class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[Tr.schema(t.algorithm||{}),new Zt({name:t.subjectPublicKey||""})]})}fromSchema(e){Ne(e,["algorithm","subjectPublicKey"]);const t=Hr(e,e,Fr.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PublicKeyInfo");switch(this.algorithm=new Tr({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey,this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams instanceof ar)try{this.parsedKey=new $r({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Rt(this.subjectPublicKey.valueBlock.valueHex);if(-1!==e.offset)try{this.parsedKey=new Kr({schema:e.result})}catch(e){}}}}toSchema(){return new cr({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if("parsedKey"in this==0)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const r of Object.keys(t))e[r]=t[r];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new $r({json:e}),this.algorithm=new Tr({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ar({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Kr({json:e}),this.algorithm=new Tr({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Ft});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new Zt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}importKey(e){let t=Promise.resolve();const r=this;if(void 0===e)return Promise.reject("Need to provide publicKey input parameter");const n=nn();return void 0===n?Promise.reject("Unable to create WebCrypto object"):(t=t.then(()=>n.exportKey("spki",e)),t=t.then(e=>{const t=Rt(e);try{r.fromSchema(t.result)}catch(e){return Promise.reject("Error during initializing object from schema")}},e=>Promise.reject(`Error during exporting public key: ${e}`)),t)}}class Mr{constructor(e={}){this.type=me(e,"type",Mr.defaultValues("type")),this.values=me(e,"values",Mr.defaultValues("values")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"values":return[];default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return""===t;case"values":return 0===t.length;default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.type||""}),new ur({name:t.setName||"",value:[new Rr({name:t.values||"",value:new jr})]})]})}fromSchema(e){Ne(e,["type","values"]);const t=Hr(e,e,Mr.schema({names:{type:"type",values:"values"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Attribute");this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new cr({value:[new ar({value:this.type}),new ur({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}class Jr{constructor(e={}){this.version=me(e,"version",Jr.defaultValues("version")),this.privateKey=me(e,"privateKey",Jr.defaultValues("privateKey")),"namedCurve"in e&&(this.namedCurve=me(e,"namedCurve",Jr.defaultValues("namedCurve"))),"publicKey"in e&&(this.publicKey=me(e,"publicKey",Jr.defaultValues("publicKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 1;case"privateKey":return new qt;case"namedCurve":return"";case"publicKey":return new $r;default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return t===Jr.defaultValues(e);case"privateKey":return t.isEqual(Jr.defaultValues(e));case"namedCurve":return""===t;case"publicKey":return $r.compareWithDefault("namedCurve",t.namedCurve)&&$r.compareWithDefault("x",t.x)&&$r.compareWithDefault("y",t.y);default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new er({name:t.version||""}),new qt({name:t.privateKey||""}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ar({name:t.namedCurve||""})]}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Zt({name:t.publicKey||""})]})]})}fromSchema(e){Ne(e,["version","privateKey","namedCurve","publicKey"]);const t=Hr(e,e,Jr.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ECPrivateKey");if(this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,"namedCurve"in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),"publicKey"in t.result){const e={schema:t.result.publicKey.valueBlock.valueHex};"namedCurve"in this&&(e.namedCurve=this.namedCurve),this.publicKey=new $r(e)}}toSchema(){const e=[new er({value:this.version}),this.privateKey];return"namedCurve"in this&&e.push(new Tt({idBlock:{tagClass:3,tagNumber:0},value:[new ar({value:this.namedCurve})]})),"publicKey"in this&&e.push(new Tt({idBlock:{tagClass:3,tagNumber:1},value:[new Zt({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new cr({value:e})}toJSON(){if("namedCurve"in this==0||Jr.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');let e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}const t={crv:e,d:Ce(Be(this.privateKey.valueBlock.valueHex),!0,!0,!1)};if("publicKey"in this){const e=this.publicKey.toJSON();t.x=e.x,t.y=e.y}return t}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("d"in e))throw new Error('Absent mandatory parameter "d"');{const r=Ee(xe(e.d,!0));if(r.byteLength<t){const e=new ArrayBuffer(t),n=new Uint8Array(e),a=new Uint8Array(r);n.set(a,1),this.privateKey=new qt({valueHex:e})}else this.privateKey=new qt({valueHex:r.slice(0,t)})}"x"in e&&"y"in e&&(this.publicKey=new $r({json:e}))}}class zr{constructor(e={}){this.prime=me(e,"prime",zr.defaultValues("prime")),this.exponent=me(e,"exponent",zr.defaultValues("exponent")),this.coefficient=me(e,"coefficient",zr.defaultValues("coefficient")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"prime":case"exponent":case"coefficient":return new er;default:throw new Error(`Invalid member name for OtherPrimeInfo class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new er({name:t.prime||""}),new er({name:t.exponent||""}),new er({name:t.coefficient||""})]})}fromSchema(e){Ne(e,["prime","exponent","coefficient"]);const t=Hr(e,e,zr.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new cr({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:Ce(Be(this.prime.valueBlock.valueHex),!0,!0),d:Ce(Be(this.exponent.valueBlock.valueHex),!0,!0),t:Ce(Be(this.coefficient.valueBlock.valueHex),!0,!0)}}fromJSON(e){if(!("r"in e))throw new Error('Absent mandatory parameter "r"');if(this.prime=new er({valueHex:Ee(xe(e.r,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.exponent=new er({valueHex:Ee(xe(e.d,!0))}),!("t"in e))throw new Error('Absent mandatory parameter "t"');this.coefficient=new er({valueHex:Ee(xe(e.t,!0))})}}class qr{constructor(e={}){this.version=me(e,"version",qr.defaultValues("version")),this.modulus=me(e,"modulus",qr.defaultValues("modulus")),this.publicExponent=me(e,"publicExponent",qr.defaultValues("publicExponent")),this.privateExponent=me(e,"privateExponent",qr.defaultValues("privateExponent")),this.prime1=me(e,"prime1",qr.defaultValues("prime1")),this.prime2=me(e,"prime2",qr.defaultValues("prime2")),this.exponent1=me(e,"exponent1",qr.defaultValues("exponent1")),this.exponent2=me(e,"exponent2",qr.defaultValues("exponent2")),this.coefficient=me(e,"coefficient",qr.defaultValues("coefficient")),"otherPrimeInfos"in e&&(this.otherPrimeInfos=me(e,"otherPrimeInfos",qr.defaultValues("otherPrimeInfos"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"modulus":case"publicExponent":case"privateExponent":case"prime1":case"prime2":case"exponent1":case"exponent2":case"coefficient":return new er;case"otherPrimeInfos":return[];default:throw new Error(`Invalid member name for RSAPrivateKey class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new er({name:t.version||""}),new er({name:t.modulus||""}),new er({name:t.publicExponent||""}),new er({name:t.privateExponent||""}),new er({name:t.prime1||""}),new er({name:t.prime2||""}),new er({name:t.exponent1||""}),new er({name:t.exponent2||""}),new er({name:t.coefficient||""}),new cr({optional:!0,value:[new Rr({name:t.otherPrimeInfosName||"",value:zr.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){Ne(e,["version","modulus","publicExponent","privateExponent","prime1","prime2","exponent1","exponent2","coefficient","otherPrimeInfos"]);const t=Hr(e,e,qr.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),"otherPrimeInfos"in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,e=>new zr({schema:e})))}toSchema(){const e=[];return e.push(new er({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),"otherPrimeInfos"in this&&e.push(new cr({value:Array.from(this.otherPrimeInfos,e=>e.toSchema())})),new cr({value:e})}toJSON(){const e={n:Ce(Be(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Ce(Be(this.publicExponent.valueBlock.valueHex),!0,!0,!0),d:Ce(Be(this.privateExponent.valueBlock.valueHex),!0,!0,!0),p:Ce(Be(this.prime1.valueBlock.valueHex),!0,!0,!0),q:Ce(Be(this.prime2.valueBlock.valueHex),!0,!0,!0),dp:Ce(Be(this.exponent1.valueBlock.valueHex),!0,!0,!0),dq:Ce(Be(this.exponent2.valueBlock.valueHex),!0,!0,!0),qi:Ce(Be(this.coefficient.valueBlock.valueHex),!0,!0,!0)};return"otherPrimeInfos"in this&&(e.oth=Array.from(this.otherPrimeInfos,e=>e.toJSON())),e}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new er({valueHex:Ee(xe(e.n,!0,!0))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');if(this.publicExponent=new er({valueHex:Ee(xe(e.e,!0,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.privateExponent=new er({valueHex:Ee(xe(e.d,!0,!0))}),!("p"in e))throw new Error('Absent mandatory parameter "p"');if(this.prime1=new er({valueHex:Ee(xe(e.p,!0,!0))}),!("q"in e))throw new Error('Absent mandatory parameter "q"');if(this.prime2=new er({valueHex:Ee(xe(e.q,!0,!0))}),!("dp"in e))throw new Error('Absent mandatory parameter "dp"');if(this.exponent1=new er({valueHex:Ee(xe(e.dp,!0,!0))}),!("dq"in e))throw new Error('Absent mandatory parameter "dq"');if(this.exponent2=new er({valueHex:Ee(xe(e.dq,!0,!0))}),!("qi"in e))throw new Error('Absent mandatory parameter "qi"');this.coefficient=new er({valueHex:Ee(xe(e.qi,!0,!0))}),"oth"in e&&(this.otherPrimeInfos=Array.from(e.oth,e=>new zr({json:e})))}}class Wr{constructor(e={}){this.version=me(e,"version",Wr.defaultValues("version")),this.privateKeyAlgorithm=me(e,"privateKeyAlgorithm",Wr.defaultValues("privateKeyAlgorithm")),this.privateKey=me(e,"privateKey",Wr.defaultValues("privateKey")),"attributes"in e&&(this.attributes=me(e,"attributes",Wr.defaultValues("attributes"))),"parsedKey"in e&&(this.parsedKey=me(e,"parsedKey",Wr.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new Tr;case"privateKey":return new qt;case"attributes":return[];case"parsedKey":return{};default:throw new Error(`Invalid member name for PrivateKeyInfo class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new er({name:t.version||""}),Tr.schema(t.privateKeyAlgorithm||{}),new qt({name:t.privateKey||""}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Rr({name:t.attributes||"",value:Mr.schema()})]})]})}fromSchema(e){Ne(e,["version","privateKeyAlgorithm","privateKey","attributes"]);const t=Hr(e,e,Wr.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyInfo");switch(this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Tr({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,"attributes"in t.result&&(this.attributes=Array.from(t.result.attributes,e=>new Mr({schema:e}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const e=Rt(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new qr({schema:e.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof ar){const e=Rt(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new Jr({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:e.result}))}}}toSchema(){const e=[new er({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return"attributes"in this&&e.push(new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,e=>e.toSchema())})),new cr({value:e})}toJSON(){if("parsedKey"in this==0){const e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,e=>e.toJSON())),e}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const r of Object.keys(t))e[r]=t[r];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Jr({json:e}),this.privateKeyAlgorithm=new Tr({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ar({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new qr({json:e}),this.privateKeyAlgorithm=new Tr({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Ft});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new qt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}class Zr{constructor(e={}){if(this.contentType=me(e,"contentType",Zr.defaultValues("contentType")),this.contentEncryptionAlgorithm=me(e,"contentEncryptionAlgorithm",Zr.defaultValues("contentEncryptionAlgorithm")),"encryptedContent"in e&&(this.encryptedContent=e.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed)){const e=new qt({idBlock:{isConstructed:!0},isConstructed:!0});let t=0,r=this.encryptedContent.valueBlock.valueHex.byteLength;for(;r>0;){const n=new Uint8Array(this.encryptedContent.valueBlock.valueHex,t,t+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-t:1024),a=new ArrayBuffer(n.length),i=new Uint8Array(a);for(let e=0;e<i.length;e++)i[e]=n[e];e.valueBlock.value.push(new qt({valueHex:a})),r-=n.length,t+=n.length}this.encryptedContent=e}"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new Tr;case"encryptedContent":return new qt;default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"contentType":return""===t;case"contentEncryptionAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==0;case"encryptedContent":return t.isEqual(Zr.defaultValues(e));default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.contentType||""}),Tr.schema(t.contentEncryptionAlgorithm||{}),new Dr({value:[new Tt({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new Rr({value:new qt})]}),new jt({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){Ne(e,["contentType","contentEncryptionAlgorithm","encryptedContent"]);const t=Hr(e,e,Zr.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Tr({schema:t.result.contentEncryptionAlgorithm}),"encryptedContent"in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new ar({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new cr({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e}}class Gr{constructor(e={}){this.hashAlgorithm=me(e,"hashAlgorithm",Gr.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=me(e,"maskGenAlgorithm",Gr.defaultValues("maskGenAlgorithm")),this.saltLength=me(e,"saltLength",Gr.defaultValues("saltLength")),this.trailerField=me(e,"trailerField",Gr.defaultValues("trailerField")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"hashAlgorithm":return new Tr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ft});case"maskGenAlgorithm":return new Tr({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Tr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ft}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error(`Invalid member name for RSASSAPSSParams class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Tt({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Tr.schema(t.hashAlgorithm||{})]}),new Tt({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Tr.schema(t.maskGenAlgorithm||{})]}),new Tt({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new er({name:t.saltLength||""})]}),new Tt({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new er({name:t.trailerField||""})]})]})}fromSchema(e){Ne(e,["hashAlgorithm","maskGenAlgorithm","saltLength","trailerField"]);const t=Hr(e,e,Gr.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSASSAPSSParams");"hashAlgorithm"in t.result&&(this.hashAlgorithm=new Tr({schema:t.result.hashAlgorithm})),"maskGenAlgorithm"in t.result&&(this.maskGenAlgorithm=new Tr({schema:t.result.maskGenAlgorithm})),"saltLength"in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),"trailerField"in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Gr.defaultValues("hashAlgorithm"))||e.push(new Tt({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Gr.defaultValues("maskGenAlgorithm"))||e.push(new Tt({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==Gr.defaultValues("saltLength")&&e.push(new Tt({idBlock:{tagClass:3,tagNumber:2},value:[new er({value:this.saltLength})]})),this.trailerField!==Gr.defaultValues("trailerField")&&e.push(new Tt({idBlock:{tagClass:3,tagNumber:3},value:[new er({value:this.trailerField})]})),new cr({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Gr.defaultValues("hashAlgorithm"))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Gr.defaultValues("maskGenAlgorithm"))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==Gr.defaultValues("saltLength")&&(e.saltLength=this.saltLength),this.trailerField!==Gr.defaultValues("trailerField")&&(e.trailerField=this.trailerField),e}}class Qr{constructor(e={}){this.salt=me(e,"salt",Qr.defaultValues("salt")),this.iterationCount=me(e,"iterationCount",Qr.defaultValues("iterationCount")),"keyLength"in e&&(this.keyLength=me(e,"keyLength",Qr.defaultValues("keyLength"))),"prf"in e&&(this.prf=me(e,"prf",Qr.defaultValues("prf"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new Tr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Ft});default:throw new Error(`Invalid member name for PBKDF2Params class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Dr({value:[new qt({name:t.saltPrimitive||""}),Tr.schema(t.saltConstructed||{})]}),new er({name:t.iterationCount||""}),new er({name:t.keyLength||"",optional:!0}),Tr.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){Ne(e,["salt","iterationCount","keyLength","prf"]);const t=Hr(e,e,Qr.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:!0}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBKDF2Params");this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,"keyLength"in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),"prf"in t.result&&(this.prf=new Tr({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new er({value:this.iterationCount})),"keyLength"in this&&Qr.defaultValues("keyLength")!==this.keyLength&&e.push(new er({value:this.keyLength})),"prf"in this&&!1===Qr.defaultValues("prf").isEqual(this.prf)&&e.push(this.prf.toSchema()),new cr({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return"keyLength"in this&&Qr.defaultValues("keyLength")!==this.keyLength&&(e.keyLength=this.keyLength),"prf"in this&&!1===Qr.defaultValues("prf").isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}class Yr{constructor(e={}){this.keyDerivationFunc=me(e,"keyDerivationFunc",Yr.defaultValues("keyDerivationFunc")),this.encryptionScheme=me(e,"encryptionScheme",Yr.defaultValues("encryptionScheme")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyDerivationFunc":case"encryptionScheme":return new Tr;default:throw new Error(`Invalid member name for PBES2Params class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[Tr.schema(t.keyDerivationFunc||{}),Tr.schema(t.encryptionScheme||{})]})}fromSchema(e){Ne(e,["keyDerivationFunc","encryptionScheme"]);const t=Hr(e,e,Yr.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBES2Params");this.keyDerivationFunc=new Tr({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new Tr({schema:t.result.encryptionScheme})}toSchema(){return new cr({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}function Xr(e,t,r,n,a,i){let s,o;const c=[];switch(t.toUpperCase()){case"SHA-1":s=20,o=64;break;case"SHA-256":s=32,o=64;break;case"SHA-384":s=48,o=128;break;case"SHA-512":s=64,o=128;break;default:throw new Error("Unsupported hashing algorithm")}const u=new Uint8Array(n),l=new ArrayBuffer(2*n.byteLength+2),h=new Uint8Array(l);for(let e=0;e<u.length;e++)h[2*e]=0,h[2*e+1]=u[e];h[h.length-2]=0,h[h.length-1]=0,n=l.slice(0);const d=new ArrayBuffer(o),f=new Uint8Array(d);for(let e=0;e<d.byteLength;e++)f[e]=3;const m=a.byteLength,p=o*Math.ceil(m/o),g=new ArrayBuffer(p),v=new Uint8Array(g),b=new Uint8Array(a);for(let e=0;e<p;e++)v[e]=b[e%m];const w=n.byteLength,y=o*Math.ceil(w/o),k=new ArrayBuffer(y),_=new Uint8Array(k),A=new Uint8Array(n);for(let e=0;e<y;e++)_[e]=A[e%w];const S=g.byteLength+k.byteLength;let C=new ArrayBuffer(S),x=new Uint8Array(C);x.set(v),x.set(_,v.length);const B=Math.ceil((r>>3)/s);let E=Promise.resolve(C);for(let r=0;r<=B;r++){E=E.then(e=>{const t=new ArrayBuffer(d.byteLength+e.byteLength),r=new Uint8Array(t);return r.set(f),r.set(x,f.length),t});for(let r=0;r<i;r++)E=E.then(r=>e.digest({name:t},new Uint8Array(r)));E=E.then(e=>{const t=new ArrayBuffer(o),r=new Uint8Array(t);for(let n=0;n<t.byteLength;n++)r[n]=e[n%e.length];const n=Math.ceil(m/o)+Math.ceil(w/o),a=[];let i=0,s=o;for(let e=0;e<n;e++){const e=Array.from(new Uint8Array(C.slice(i,i+s)));i+=o,i+o>C.byteLength&&(s=C.byteLength-i);let n=511;for(let a=t.byteLength-1;a>=0;a--)n>>=8,n+=r[a]+e[a],e[a]=255&n;a.push(...e)}return C=new ArrayBuffer(a.length),x=new Uint8Array(C),x.set(a),c.push(...new Uint8Array(e)),C})}return E=E.then(()=>{const e=new ArrayBuffer(r>>3);return new Uint8Array(e).set(new Uint8Array(c).slice(0,r>>3)),e}),E}class en{constructor(e={}){this.crypto=me(e,"crypto",{}),this.subtle=me(e,"subtle",{}),this.name=me(e,"name","")}importKey(e,t,r,n,a){let i={};switch(t instanceof Uint8Array&&(t=t.buffer),e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,n,a);case"spki":{const e=Rt(t);if(-1===e.offset)return Promise.reject("Incorrect keyData");const s=new Fr;try{s.fromSchema(e.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="PS1";break;case"SHA-256":i.alg="PS256";break;case"SHA-384":i.alg="PS384";break;case"SHA-512":i.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(a=["verify"],i.kty="RSA",i.ext=n,i.key_ops=a,"1.2.840.113549.1.1.1"!==s.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`);if("alg"in i==0)switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RS1";break;case"SHA-256":i.alg="RS256";break;case"SHA-384":i.alg="RS384";break;case"SHA-512":i.alg="RS512";break;default:return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`)}const e=s.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;case"ECDSA":a=["verify"];case"ECDH":{if(i={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==s.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`);const e=s.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;case"RSA-OAEP":{if(i.kty="RSA",i.ext=n,i.key_ops=a,"safari"===this.name.toLowerCase())i.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RSA-OAEP";break;case"SHA-256":i.alg="RSA-OAEP-256";break;case"SHA-384":i.alg="RSA-OAEP-384";break;case"SHA-512":i.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`)}const e=s.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;default:return Promise.reject(`Incorrect algorithm name: ${r.name.toUpperCase()}`)}}break;case"pkcs8":{const e=new Wr,s=Rt(t);if(-1===s.offset)return Promise.reject("Incorrect keyData");try{e.fromSchema(s.result)}catch(e){return Promise.reject("Incorrect keyData")}if("parsedKey"in e==0)return Promise.reject("Incorrect keyData");switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="PS1";break;case"SHA-256":i.alg="PS256";break;case"SHA-384":i.alg="PS384";break;case"SHA-512":i.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(a=["sign"],i.kty="RSA",i.ext=n,i.key_ops=a,"1.2.840.113549.1.1.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect private key algorithm: ${e.privateKeyAlgorithm.algorithmId}`);if("alg"in i==0)switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RS1";break;case"SHA-256":i.alg="RS256";break;case"SHA-384":i.alg="RS384";break;case"SHA-512":i.alg="RS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;case"ECDSA":a=["sign"];case"ECDH":{if(i={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect algorithm: ${e.privateKeyAlgorithm.algorithmId}`);const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;case"RSA-OAEP":{if(i.kty="RSA",i.ext=n,i.key_ops=a,"safari"===this.name.toLowerCase())i.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RSA-OAEP";break;case"SHA-256":i.alg="RSA-OAEP-256";break;case"SHA-384":i.alg="RSA-OAEP-384";break;case"SHA-512":i.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;default:return Promise.reject(`Incorrect algorithm name: ${r.name.toUpperCase()}`)}}break;case"jwk":i=t;break;default:return Promise.reject(`Incorrect format: ${e}`)}return"safari"===this.name.toLowerCase()?Promise.resolve().then(()=>this.subtle.importKey("jwk",Ee(JSON.stringify(i)),r,n,a)).then(e=>e,()=>this.subtle.importKey("jwk",i,r,n,a)):this.subtle.importKey("jwk",i,r,n,a)}exportKey(e,t){let r=this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&(r=r.then(e=>e instanceof ArrayBuffer?JSON.parse(Be(e)):e)),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":r=r.then(e=>{const t=new Fr;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"pkcs8":r=r.then(e=>{const t=new Wr;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"jwk":break;default:return Promise.reject(`Incorrect format: ${e}`)}return r}convert(e,t,r,n,a,i){switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(r);case"spki":return Promise.resolve().then(()=>this.importKey("raw",r,n,a,i)).then(e=>this.exportKey("spki",e));case"pkcs8":return Promise.resolve().then(()=>this.importKey("raw",r,n,a,i)).then(e=>this.exportKey("pkcs8",e));case"jwk":return Promise.resolve().then(()=>this.importKey("raw",r,n,a,i)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("spki",r,n,a,i)).then(e=>this.exportKey("raw",e));case"spki":return Promise.resolve(r);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then(()=>this.importKey("spki",r,n,a,i)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("pkcs8",r,n,a,i)).then(e=>this.exportKey("raw",e));case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(r);case"jwk":return Promise.resolve().then(()=>this.importKey("pkcs8",r,n,a,i)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("jwk",r,n,a,i)).then(e=>this.exportKey("raw",e));case"spki":return Promise.resolve().then(()=>this.importKey("jwk",r,n,a,i)).then(e=>this.exportKey("spki",e));case"pkcs8":return Promise.resolve().then(()=>this.importKey("jwk",r,n,a,i)).then(e=>this.exportKey("pkcs8",e));case"jwk":return Promise.resolve(r);default:return Promise.reject(`Incorrect outputFormat: ${t}`)}default:return Promise.reject(`Incorrect inputFormat: ${e}`)}}encrypt(...e){return this.subtle.encrypt(...e)}decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}verify(...e){return this.subtle.verify(...e)}digest(...e){return this.subtle.digest(...e)}generateKey(...e){return this.subtle.generateKey(...e)}deriveKey(...e){return this.subtle.deriveKey(...e)}deriveBits(...e){return this.subtle.deriveBits(...e)}wrapKey(...e){return this.subtle.wrapKey(...e)}unwrapKey(...e){return this.subtle.unwrapKey(...e)}getRandomValues(e){if("getRandomValues"in this.crypto==0)throw new Error("No support for getRandomValues");return this.crypto.getRandomValues(e)}getAlgorithmByOID(e){switch(e){case"1.2.840.113549.1.1.1":case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}}getOIDByAlgorithm(e){let t="";switch(e.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13"}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11"}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35"}return t}getAlgorithmParameters(e,t){let r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return r}getHashAlgorithm(e){let t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const r=new Gr({schema:e.algorithmParams});if("hashAlgorithm"in r){const e=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in e==0)return"";t=e.name}else t="SHA-1"}catch(e){}}return t}encryptEncryptedContentInfo(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e==0)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');if("contentType"in e==0)return Promise.reject('Absent mandatory parameter "contentType"');const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm);if(""===t)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');const r=this.getOIDByAlgorithm({name:"PBKDF2"});if(""===r)return Promise.reject("Can not find OID for PBKDF2");const n=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(""===n)return Promise.reject(`Incorrect value for "hmacHashAlgorithm": ${e.hmacHashAlgorithm}`);let a=Promise.resolve();const i=new ArrayBuffer(16),s=new Uint8Array(i);this.getRandomValues(s);const o=new ArrayBuffer(64),c=new Uint8Array(o);this.getRandomValues(c);const u=new Uint8Array(e.contentToEncrypt),l=new Qr({salt:new qt({valueHex:o}),iterationCount:e.iterationCount,prf:new Tr({algorithmId:n,algorithmParams:new Ft})});return a=a.then(()=>{const t=new Uint8Array(e.password);return this.importKey("raw",t,"PBKDF2",!1,["deriveKey"])},e=>Promise.reject(e)),a=a.then(t=>this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:c,iterations:e.iterationCount},t,e.contentEncryptionAlgorithm,!1,["encrypt"]),e=>Promise.reject(e)),a=a.then(t=>this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:s},t,u),e=>Promise.reject(e)),a=a.then(n=>{const a=new Yr({keyDerivationFunc:new Tr({algorithmId:r,algorithmParams:l.toSchema()}),encryptionScheme:new Tr({algorithmId:t,algorithmParams:new qt({valueHex:i})})});return new Zr({contentType:e.contentType,contentEncryptionAlgorithm:new Tr({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:a.toSchema()}),encryptedContent:new qt({valueHex:n})})},e=>Promise.reject(e)),a}decryptEncryptedContentInfo(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("encryptedContentInfo"in e==0)return Promise.reject('Absent mandatory parameter "encryptedContentInfo"');if("1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)return Promise.reject(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t,r,n=Promise.resolve();try{t=new Yr({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}try{r=new Qr({schema:t.keyDerivationFunc.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId);if("name"in a==0)return Promise.reject(`Incorrect OID for "contentEncryptionAlgorithm": ${t.encryptionScheme.algorithmId}`);const i=t.encryptionScheme.algorithmParams.valueBlock.valueHex,s=new Uint8Array(i),o=r.salt.valueBlock.valueHex,c=new Uint8Array(o),u=r.iterationCount;let l="SHA-1";if("prf"in r){const e=this.getAlgorithmByOID(r.prf.algorithmId);if("name"in e==0)return Promise.reject("Incorrect OID for HMAC hash algorithm");l=e.hash.name}return n=n.then(()=>this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),e=>Promise.reject(e)),n=n.then(e=>this.deriveKey({name:"PBKDF2",hash:{name:l},salt:c,iterations:u},e,a,!1,["decrypt"]),e=>Promise.reject(e)),n=n.then(t=>{let r=new ArrayBuffer(0);if(!1===e.encryptedContentInfo.encryptedContent.idBlock.isConstructed)r=e.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else for(const t of e.encryptedContentInfo.encryptedContent.valueBlock.value)r=be(r,t.valueBlock.valueHex);return this.decrypt({name:a.name,iv:s},t,r)},e=>Promise.reject(e)),n}stampDataWithPassword(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "salt"');if("contentToStamp"in e==0)return Promise.reject('Absent mandatory parameter "contentToStamp"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let r=Promise.resolve();const n={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return r=r.then(()=>Xr(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)),r=r.then(e=>this.importKey("raw",new Uint8Array(e),n,!1,["sign"])),r=r.then(t=>this.sign(n,t,new Uint8Array(e.contentToStamp)),e=>Promise.reject(e)),r}verifyDataStampedWithPassword(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "salt"');if("contentToVerify"in e==0)return Promise.reject('Absent mandatory parameter "contentToVerify"');if("signatureToVerify"in e==0)return Promise.reject('Absent mandatory parameter "signatureToVerify"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let r=Promise.resolve();const n={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return r=r.then(()=>Xr(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)),r=r.then(e=>this.importKey("raw",new Uint8Array(e),n,!1,["verify"])),r=r.then(t=>this.verify(n,t,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify)),e=>Promise.reject(e)),r}getSignatureParameters(e,t="SHA-1"){if(""===this.getOIDByAlgorithm({name:t}))return Promise.reject(`Unsupported hash algorithm: ${t}`);const r=new Tr,n=this.getAlgorithmParameters(e.algorithm.name,"sign");switch(n.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(n.algorithm);break;case"RSA-PSS":{switch(t.toUpperCase()){case"SHA-256":n.algorithm.saltLength=32;break;case"SHA-384":n.algorithm.saltLength=48;break;case"SHA-512":n.algorithm.saltLength=64}const e={};if("SHA-1"!==t.toUpperCase()){const r=this.getOIDByAlgorithm({name:t});if(""===r)return Promise.reject(`Unsupported hash algorithm: ${t}`);e.hashAlgorithm=new Tr({algorithmId:r,algorithmParams:new Ft}),e.maskGenAlgorithm=new Tr({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.hashAlgorithm.toSchema()})}20!==n.algorithm.saltLength&&(e.saltLength=n.algorithm.saltLength);const a=new Gr(e);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=a.toSchema()}break;default:return Promise.reject(`Unsupported signature algorithm: ${e.algorithm.name}`)}return Promise.resolve().then(()=>({signatureAlgorithm:r,parameters:n}))}signWithPrivateKey(e,t,r){return this.sign(r.algorithm,t,new Uint8Array(e)).then(e=>("ECDSA"===r.algorithm.name&&(e=function(e){if(e.byteLength%2!=0)return new ArrayBuffer(0);const t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));const n=new er({valueHex:r}),a=new ArrayBuffer(t);new Uint8Array(a).set(new Uint8Array(e,t,t));const i=new er({valueHex:a});return new cr({value:[n.convertToDER(),i.convertToDER()]}).toBER(!1)}(e)),e),e=>Promise.reject(`Signing error: ${e}`))}fillPublicKeyParameters(e,t){const r={},n=this.getHashAlgorithm(t);if(""===n)return Promise.reject(`Unsupported signature algorithm: ${t.algorithmId}`);let a;a="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;const i=this.getAlgorithmByOID(a);if("name"in i==="")return Promise.reject(`Unsupported public key algorithm: ${t.algorithmId}`);if(r.algorithm=this.getAlgorithmParameters(i.name,"importkey"),"hash"in r.algorithm.algorithm&&(r.algorithm.algorithm.hash.name=n),"ECDSA"===i.name){let t=!1;if("algorithmParams"in e.algorithm==1&&"idBlock"in e.algorithm.algorithmParams&&1===e.algorithm.algorithmParams.idBlock.tagClass&&6===e.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const n=this.getAlgorithmByOID(e.algorithm.algorithmParams.valueBlock.toString());if("name"in n==0)return Promise.reject(`Unsupported named curve algorithm: ${e.algorithm.algorithmParams.valueBlock.toString()}`);r.algorithm.algorithm.namedCurve=n.name}return r}getPublicKey(e,t,r=null){null===r&&(r=this.fillPublicKeyParameters(e,t));const n=e.toSchema().toBER(!1),a=new Uint8Array(n);return this.importKey("spki",a,r.algorithm.algorithm,!0,r.algorithm.usages)}verifyWithPublicKey(e,t,r,n,a=null){let i=Promise.resolve();if(null===a){if(""===(a=this.getHashAlgorithm(n)))return Promise.reject(`Unsupported signature algorithm: ${n.algorithmId}`);i=i.then(()=>this.getPublicKey(r,n))}else{const e={};let t;t="1.2.840.113549.1.1.10"===n.algorithmId?n.algorithmId:r.algorithm.algorithmId;const s=this.getAlgorithmByOID(t);if("name"in s==="")return Promise.reject(`Unsupported public key algorithm: ${n.algorithmId}`);if(e.algorithm=this.getAlgorithmParameters(s.name,"importkey"),"hash"in e.algorithm.algorithm&&(e.algorithm.algorithm.hash.name=a),"ECDSA"===s.name){let t=!1;if("algorithmParams"in r.algorithm==1&&"idBlock"in r.algorithm.algorithmParams&&1===r.algorithm.algorithmParams.idBlock.tagClass&&6===r.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const n=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString());if("name"in n==0)return Promise.reject(`Unsupported named curve algorithm: ${r.algorithm.algorithmParams.valueBlock.toString()}`);e.algorithm.algorithm.namedCurve=n.name}i=i.then(()=>this.getPublicKey(r,null,e))}return i=i.then(r=>{const i=this.getAlgorithmParameters(r.algorithm.name,"verify");"hash"in i.algorithm&&(i.algorithm.hash.name=a);let s=t.valueBlock.valueHex;if("ECDSA"===r.algorithm.name&&(s=function(e){if(e instanceof cr==0)return new ArrayBuffer(0);if(2!==e.valueBlock.value.length)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof er==0)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof er==0)return new ArrayBuffer(0);const t=e.valueBlock.value[0].convertFromDER(),r=e.valueBlock.value[1].convertFromDER();switch(!0){case t.valueBlock.valueHex.byteLength<r.valueBlock.valueHex.byteLength:{if(r.valueBlock.valueHex.byteLength-t.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");const e=r.valueBlock.valueHex.byteLength,n=new Uint8Array(t.valueBlock.valueHex),a=new ArrayBuffer(e),i=new Uint8Array(a);return i.set(n,1),i[0]=0,be(a,r.valueBlock.valueHex)}case t.valueBlock.valueHex.byteLength>r.valueBlock.valueHex.byteLength:{if(t.valueBlock.valueHex.byteLength-r.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");const e=t.valueBlock.valueHex.byteLength,n=new Uint8Array(r.valueBlock.valueHex),a=new ArrayBuffer(e),i=new Uint8Array(a);return i.set(n,1),i[0]=0,be(t.valueBlock.valueHex,a)}default:if(t.valueBlock.valueHex.byteLength%2){const e=t.valueBlock.valueHex.byteLength+1,n=new Uint8Array(t.valueBlock.valueHex),a=new ArrayBuffer(e),i=new Uint8Array(a);i.set(n,1),i[0]=0;const s=new Uint8Array(r.valueBlock.valueHex),o=new ArrayBuffer(e),c=new Uint8Array(o);return c.set(s,1),c[0]=0,be(a,o)}}return be(t.valueBlock.valueHex,r.valueBlock.valueHex)}(Rt(s).result)),"RSA-PSS"===r.algorithm.name){let e;try{e=new Gr({schema:n.algorithmParams})}catch(e){return Promise.reject(e)}i.algorithm.saltLength="saltLength"in e?e.saltLength:20;let t="SHA-1";if("hashAlgorithm"in e){const r=this.getAlgorithmByOID(e.hashAlgorithm.algorithmId);if("name"in r==0)return Promise.reject(`Unrecognized hash algorithm: ${e.hashAlgorithm.algorithmId}`);t=r.name}i.algorithm.hash.name=t}return this.verify(i.algorithm,r,new Uint8Array(s),new Uint8Array(e))}),i}}let tn={name:"none",crypto:null,subtle:null};function rn(){if("undefined"!=typeof process&&"pid"in process&&void 0!==n.g){let e;try{e=n.g[process.pid].pkijs.engine}catch(e){throw new Error('Please call "setEngine" before call to "getEngine"')}return e}return tn}function nn(){const e=rn();if(null!==e.subtle)return e.subtle}function an(e){let t=!1,r="";const n=e.trim();for(let e=0;e<n.length;e++)32===n.charCodeAt(e)?!1===t&&(t=!0):(t&&(r+=" ",t=!1),r+=n[e]);return r.toLowerCase()}!function(){if("undefined"!=typeof self&&"crypto"in self){let e="webcrypto";const t=self.crypto;let r;if("webkitSubtle"in self.crypto){try{r=self.crypto.webkitSubtle}catch(e){r=self.crypto.subtle}e="safari"}"subtle"in self.crypto&&(r=self.crypto.subtle),tn=void 0===r?{name:e,crypto:t,subtle:null}:{name:e,crypto:t,subtle:new en({name:e,crypto:self.crypto,subtle:r})}}!function(e,t,r){if("undefined"!=typeof process&&"pid"in process&&void 0!==n.g&&"undefined"==typeof window){if(void 0===n.g[process.pid])n.g[process.pid]={};else if("object"!=typeof n.g[process.pid])throw new Error(`Name global.${process.pid} already exists and it is not an object`);if(void 0===n.g[process.pid].pkijs)n.g[process.pid].pkijs={};else if("object"!=typeof n.g[process.pid].pkijs)throw new Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);n.g[process.pid].pkijs.engine={name:e,crypto:t,subtle:r}}else tn={name:e,crypto:t,subtle:r}}(tn.name,tn.crypto,tn.subtle)}();class sn{constructor(e={}){this.type=me(e,"type",sn.defaultValues("type")),this.value=me(e,"value",sn.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"value":return{};default:throw new Error(`Invalid member name for AttributeTypeAndValue class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.type||""}),new jr({name:t.value||""})]})}fromSchema(e){Ne(e,["type","typeValue"]);const t=Hr(e,e,sn.schema({names:{type:"type",value:"typeValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeTypeAndValue");this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new cr({value:[new ar({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){if(e instanceof sn){if(this.type!==e.type)return!1;if(this.value instanceof mr&&e.value instanceof mr||this.value instanceof gr&&e.value instanceof gr||this.value instanceof br&&e.value instanceof br||this.value instanceof wr&&e.value instanceof wr||this.value instanceof yr&&e.value instanceof yr||this.value instanceof kr&&e.value instanceof kr||this.value instanceof _r&&e.value instanceof _r||this.value instanceof Ar&&e.value instanceof Ar||this.value instanceof Sr&&e.value instanceof Sr||this.value instanceof Cr&&e.value instanceof Cr||this.value instanceof xr&&e.value instanceof xr||this.value instanceof Br&&e.value instanceof Br){const t=an(this.value.valueBlock.value),r=an(e.value.valueBlock.value);if(0!==t.localeCompare(r))return!1}else if(!1===ke(this.value.valueBeforeDecode,e.value.valueBeforeDecode))return!1;return!0}return e instanceof ArrayBuffer&&ke(this.value.valueBeforeDecode,e)}}class on{constructor(e={}){this.typesAndValues=me(e,"typesAndValues",on.defaultValues("typesAndValues")),this.valueBeforeDecode=me(e,"valueBeforeDecode",on.defaultValues("valueBeforeDecode")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"typesAndValues":return 0===t.length;case"valueBeforeDecode":return 0===t.byteLength;default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.repeatedSequence||"",value:new ur({value:[new Rr({name:t.repeatedSet||"",value:sn.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){Ne(e,["RDN","typesAndValues"]);const t=Hr(e,e,on.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RelativeDistinguishedNames");"typesAndValues"in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,e=>new sn({schema:e}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecode}toSchema(){return 0===this.valueBeforeDecode.byteLength?new cr({value:[new ur({value:Array.from(this.typesAndValues,e=>e.toSchema())})]}):Rt(this.valueBeforeDecode).result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof on){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,r]of this.typesAndValues.entries())if(!1===r.isEqual(e.typesAndValues[t]))return!1;return!0}return e instanceof ArrayBuffer&&ke(this.valueBeforeDecode,e)}}function cn(e={},t=!1){const r=me(e,"names",{});return new cr({optional:t,value:[new Tt({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:r.country_name||"",value:[new Dr({value:[new wr,new yr]})]}),new Tt({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:r.administration_domain_name||"",value:[new Dr({value:[new wr,new yr]})]}),new jt({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:r.network_address||"",isHexOnly:!0}),new jt({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:r.terminal_identifier||"",isHexOnly:!0}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:r.private_domain_name||"",value:[new Dr({value:[new wr,new yr]})]}),new jt({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:r.organization_name||"",isHexOnly:!0}),new jt({optional:!0,name:r.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new Tt({optional:!0,name:r.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new jt({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new jt({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new jt({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new jt({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new Tt({optional:!0,name:r.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new Rr({value:new yr})]})]})}function un(e=!1){return new cr({optional:e,value:[new yr,new yr]})}function ln(e=!1){return new ur({optional:e,value:[new jt({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new jr]})]})}class hn{constructor(e={}){this.type=me(e,"type",hn.defaultValues("type")),this.value=me(e,"value",hn.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return t===hn.defaultValues(e);case"value":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new Dr({value:[new Tt({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||"",value:[new ar,new Tt({idBlock:{tagClass:3,tagNumber:0},value:[new jr]})]}),new jt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new jt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new Tt({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||"",value:[cn(t.builtInStandardAttributes||{},!1),un(!0),ln(!0)]}),new Tt({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||"",value:[on.schema(t.directoryName||{})]}),new Tt({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||"",value:[new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Dr({value:[new kr,new yr,new br,new mr,new gr]})]}),new Tt({idBlock:{tagClass:3,tagNumber:1},value:[new Dr({value:[new kr,new yr,new br,new mr,new gr]})]})]}),new jt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new jt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new jt({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){Ne(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=Hr(e,e,hn.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralName");switch(this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=22;const r=e.toBER(!1);this.value=Rt(r).result.valueBlock.value}break;case 4:this.value=new on({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new qt({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=6;const r=e.toBER(!1);this.value=Rt(r).result.valueBlock.toString()}}}toSchema(){switch(this.type){case 0:case 3:case 5:return new Tt({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new Ar({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new Tt({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new ar({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return hn.schema()}}toJSON(){const e={type:this.type,value:""};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}class dn{constructor(e={}){this.accessMethod=me(e,"accessMethod",dn.defaultValues("accessMethod")),this.accessLocation=me(e,"accessLocation",dn.defaultValues("accessLocation")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"accessMethod":return"";case"accessLocation":return new hn;default:throw new Error(`Invalid member name for AccessDescription class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.accessMethod||""}),hn.schema(t.accessLocation||{})]})}fromSchema(e){Ne(e,["accessMethod","accessLocation"]);const t=Hr(e,e,dn.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new hn({schema:t.result.accessLocation})}toSchema(){return new cr({value:[new ar({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}class fn{constructor(e={}){this.altNames=me(e,"altNames",fn.defaultValues("altNames")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("altNames"===e)return[];throw new Error(`Invalid member name for AltName class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.altNames||"",value:hn.schema()})]})}fromSchema(e){Ne(e,["altNames"]);const t=Hr(e,e,fn.schema({names:{altNames:"altNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AltName");"altNames"in t.result&&(this.altNames=Array.from(t.result.altNames,e=>new hn({schema:e})))}toSchema(){return new cr({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}class mn{constructor(e={}){this.type=me(e,"type",mn.defaultValues("type")),this.value=me(e,"value",mn.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error(`Invalid member name for Time class: ${e}`)}}static schema(e={},t=!1){const r=me(e,"names",{});return new Dr({optional:t,value:[new Er({name:r.utcTimeName||""}),new Ir({name:r.generalTimeName||""})]})}fromSchema(e){Ne(e,["utcTimeName","generalTimeName"]);const t=Hr(e,e,mn.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Time");"utcTimeName"in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),"generalTimeName"in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){let e={};return 0===this.type&&(e=new Er({valueDate:this.value})),1===this.type&&(e=new Ir({valueDate:this.value})),e}toJSON(){return{type:this.type,value:this.value}}}class pn{constructor(e={}){this.attributes=me(e,"attributes",pn.defaultValues("attributes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("attributes"===e)return[];throw new Error(`Invalid member name for SubjectDirectoryAttributes class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.attributes||"",value:Mr.schema()})]})}fromSchema(e){Ne(e,["attributes"]);const t=Hr(e,e,pn.schema({names:{attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(t.result.attributes,e=>new Mr({schema:e}))}toSchema(){return new cr({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}class gn{constructor(e={}){"notBefore"in e&&(this.notBefore=me(e,"notBefore",gn.defaultValues("notBefore"))),"notAfter"in e&&(this.notAfter=me(e,"notAfter",gn.defaultValues("notAfter"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"notBefore":case"notAfter":return new Date;default:throw new Error(`Invalid member name for PrivateKeyUsagePeriod class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new jt({name:t.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new jt({name:t.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){Ne(e,["notBefore","notAfter"]);const t=Hr(e,e,gn.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in t.result){const e=new Ir;e.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=e.toDate()}if("notAfter"in t.result){const e=new Ir({valueHex:t.result.notAfter.valueBlock.valueHex});e.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=e.toDate()}}toSchema(){const e=[];return"notBefore"in this&&e.push(new jt({idBlock:{tagClass:3,tagNumber:0},valueHex:new Ir({valueDate:this.notBefore}).valueBlock.valueHex})),"notAfter"in this&&e.push(new jt({idBlock:{tagClass:3,tagNumber:1},valueHex:new Ir({valueDate:this.notAfter}).valueBlock.valueHex})),new cr({value:e})}toJSON(){const e={};return"notBefore"in this&&(e.notBefore=this.notBefore),"notAfter"in this&&(e.notAfter=this.notAfter),e}}class vn{constructor(e={}){this.cA=me(e,"cA",!1),"pathLenConstraint"in e&&(this.pathLenConstraint=me(e,"pathLenConstraint",0)),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("cA"===e)return!1;throw new Error(`Invalid member name for BasicConstraints class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Jt({optional:!0,name:t.cA||""}),new er({optional:!0,name:t.pathLenConstraint||""})]})}fromSchema(e){Ne(e,["cA","pathLenConstraint"]);const t=Hr(e,e,vn.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for BasicConstraints");"cA"in t.result&&(this.cA=t.result.cA.valueBlock.value),"pathLenConstraint"in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==vn.defaultValues("cA")&&e.push(new Jt({value:this.cA})),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof er?e.push(this.pathLenConstraint):e.push(new er({value:this.pathLenConstraint}))),new cr({value:e})}toJSON(){const e={};return this.cA!==vn.defaultValues("cA")&&(e.cA=this.cA),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof er?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}class bn{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=me(e,"distributionPoint",bn.defaultValues("distributionPoint"))),this.onlyContainsUserCerts=me(e,"onlyContainsUserCerts",bn.defaultValues("onlyContainsUserCerts")),this.onlyContainsCACerts=me(e,"onlyContainsCACerts",bn.defaultValues("onlyContainsCACerts")),"onlySomeReasons"in e&&(this.onlySomeReasons=me(e,"onlySomeReasons",bn.defaultValues("onlySomeReasons"))),this.indirectCRL=me(e,"indirectCRL",bn.defaultValues("indirectCRL")),this.onlyContainsAttributeCerts=me(e,"onlyContainsAttributeCerts",bn.defaultValues("onlyContainsAttributeCerts")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":case"onlyContainsCACerts":case"indirectCRL":case"onlyContainsAttributeCerts":return!1;case"onlySomeReasons":return 0;default:throw new Error(`Invalid member name for IssuingDistributionPoint class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Dr({value:[new Tt({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new Rr({name:t.distributionPointNames||"",value:hn.schema()})]}),new Tt({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:on.schema().valueBlock.value})]})]}),new jt({name:t.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new jt({name:t.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new jt({name:t.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new jt({name:t.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new jt({name:t.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){Ne(e,["distributionPoint","distributionPointNames","onlyContainsUserCerts","onlyContainsCACerts","onlySomeReasons","indirectCRL","onlyContainsAttributeCerts"]);const t=Hr(e,e,bn.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new hn({schema:e}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new on({schema:new cr({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if("onlyContainsUserCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==e[0]}if("onlyContainsCACerts"in t.result){const e=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==e[0]}if("onlySomeReasons"in t.result){const e=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=e[0]}if("indirectCRL"in t.result){const e=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==e[0]}if("onlyContainsAttributeCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==e[0]}}toSchema(){const e=[];if("distributionPoint"in this){let t;this.distributionPoint instanceof Array?t=new Tt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(t)}if(this.onlyContainsUserCerts!==bn.defaultValues("onlyContainsUserCerts")&&e.push(new jt({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==bn.defaultValues("onlyContainsCACerts")&&e.push(new jt({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),"onlySomeReasons"in this){const t=new ArrayBuffer(1);new Uint8Array(t)[0]=this.onlySomeReasons,e.push(new jt({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==bn.defaultValues("indirectCRL")&&e.push(new jt({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==bn.defaultValues("onlyContainsAttributeCerts")&&e.push(new jt({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new cr({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==bn.defaultValues("onlyContainsUserCerts")&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==bn.defaultValues("onlyContainsCACerts")&&(e.onlyContainsCACerts=this.onlyContainsCACerts),"onlySomeReasons"in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==bn.defaultValues("indirectCRL")&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==bn.defaultValues("onlyContainsAttributeCerts")&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}class wn{constructor(e={}){this.names=me(e,"names",wn.defaultValues("names")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("names"===e)return[];throw new Error(`Invalid member name for GeneralNames class: ${e}`)}static schema(e={},t=!1){const r=me(e,"names",{});return new cr({optional:t,name:r.blockName||"",value:[new Rr({name:r.generalNames||"",value:hn.schema()})]})}fromSchema(e){Ne(e,["names","generalNames"]);const t=Hr(e,e,wn.schema({names:{blockName:"names",generalNames:"generalNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(t.result.generalNames,e=>new hn({schema:e}))}toSchema(){return new cr({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}class yn{constructor(e={}){this.base=me(e,"base",yn.defaultValues("base")),this.minimum=me(e,"minimum",yn.defaultValues("minimum")),"maximum"in e&&(this.maximum=me(e,"maximum",yn.defaultValues("maximum"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"base":return new hn;case"minimum":case"maximum":return 0;default:throw new Error(`Invalid member name for GeneralSubtree class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[hn.schema(t.base||{}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new er({name:t.minimum||""})]}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new er({name:t.maximum||""})]})]})}fromSchema(e){Ne(e,["base","minimum","maximum"]);const t=Hr(e,e,yn.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralSubtree");this.base=new hn({schema:t.result.base}),"minimum"in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),"maximum"in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),0!==this.minimum){let t=0;t=this.minimum instanceof er?this.minimum:new er({value:this.minimum}),e.push(new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){let t=0;t=this.maximum instanceof er?this.maximum:new er({value:this.maximum}),e.push(new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new cr({value:e})}toJSON(){const e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),"maximum"in this&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}class kn{constructor(e={}){"permittedSubtrees"in e&&(this.permittedSubtrees=me(e,"permittedSubtrees",kn.defaultValues("permittedSubtrees"))),"excludedSubtrees"in e&&(this.excludedSubtrees=me(e,"excludedSubtrees",kn.defaultValues("excludedSubtrees"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"permittedSubtrees":case"excludedSubtrees":return[];default:throw new Error(`Invalid member name for NameConstraints class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Rr({name:t.permittedSubtrees||"",value:yn.schema()})]}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Rr({name:t.excludedSubtrees||"",value:yn.schema()})]})]})}fromSchema(e){Ne(e,["permittedSubtrees","excludedSubtrees"]);const t=Hr(e,e,kn.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for NameConstraints");"permittedSubtrees"in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,e=>new yn({schema:e}))),"excludedSubtrees"in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,e=>new yn({schema:e})))}toSchema(){const e=[];return"permittedSubtrees"in this&&e.push(new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new cr({value:Array.from(this.permittedSubtrees,e=>e.toSchema())})]})),"excludedSubtrees"in this&&e.push(new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new cr({value:Array.from(this.excludedSubtrees,e=>e.toSchema())})]})),new cr({value:e})}toJSON(){const e={};return"permittedSubtrees"in this&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,e=>e.toJSON())),"excludedSubtrees"in this&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,e=>e.toJSON())),e}}class _n{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=me(e,"distributionPoint",_n.defaultValues("distributionPoint"))),"reasons"in e&&(this.reasons=me(e,"reasons",_n.defaultValues("reasons"))),"cRLIssuer"in e&&(this.cRLIssuer=me(e,"cRLIssuer",_n.defaultValues("cRLIssuer"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":case"cRLIssuer":return[];case"reasons":return new Zt;default:throw new Error(`Invalid member name for DistributionPoint class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Dr({value:[new Tt({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Rr({name:t.distributionPointNames||"",value:hn.schema()})]}),new Tt({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:on.schema().valueBlock.value})]})]}),new jt({name:t.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Tt({name:t.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Rr({name:t.cRLIssuerNames||"",value:hn.schema()})]})]})}fromSchema(e){Ne(e,["distributionPoint","distributionPointNames","reasons","cRLIssuer","cRLIssuerNames"]);const t=Hr(e,e,_n.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for DistributionPoint");"distributionPoint"in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new hn({schema:e}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new on({schema:new cr({value:t.result.distributionPoint.valueBlock.value})}))),"reasons"in t.result&&(this.reasons=new Zt({valueHex:t.result.reasons.valueBlock.valueHex})),"cRLIssuer"in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,e=>new hn({schema:e})))}toSchema(){const e=[];if("distributionPoint"in this){let t;t=this.distributionPoint instanceof Array?new Tt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):new Tt({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new Tt({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return"reasons"in this&&e.push(new jt({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex})),"cRLIssuer"in this&&e.push(new Tt({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,e=>e.toSchema())})),new cr({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),"reasons"in this&&(e.reasons=this.reasons.toJSON()),"cRLIssuer"in this&&(e.cRLIssuer=Array.from(this.cRLIssuer,e=>e.toJSON())),e}}class An{constructor(e={}){this.distributionPoints=me(e,"distributionPoints",An.defaultValues("distributionPoints")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("distributionPoints"===e)return[];throw new Error(`Invalid member name for CRLDistributionPoints class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.distributionPoints||"",value:_n.schema()})]})}fromSchema(e){Ne(e,["distributionPoints"]);const t=Hr(e,e,An.schema({names:{distributionPoints:"distributionPoints"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(t.result.distributionPoints,e=>new _n({schema:e}))}toSchema(){return new cr({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}class Sn{constructor(e={}){this.policyQualifierId=me(e,"policyQualifierId",Sn.defaultValues("policyQualifierId")),this.qualifier=me(e,"qualifier",Sn.defaultValues("qualifier")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new jr;default:throw new Error(`Invalid member name for PolicyQualifierInfo class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.policyQualifierId||""}),new jr({name:t.qualifier||""})]})}fromSchema(e){Ne(e,["policyQualifierId","qualifier"]);const t=Hr(e,e,Sn.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new cr({value:[new ar({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}class Cn{constructor(e={}){this.policyIdentifier=me(e,"policyIdentifier",Cn.defaultValues("policyIdentifier")),"policyQualifiers"in e&&(this.policyQualifiers=me(e,"policyQualifiers",Cn.defaultValues("policyQualifiers"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error(`Invalid member name for PolicyInformation class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.policyIdentifier||""}),new cr({optional:!0,value:[new Rr({name:t.policyQualifiers||"",value:Sn.schema()})]})]})}fromSchema(e){Ne(e,["policyIdentifier","policyQualifiers"]);const t=Hr(e,e,Cn.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),"policyQualifiers"in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,e=>new Sn({schema:e})))}toSchema(){const e=[];return e.push(new ar({value:this.policyIdentifier})),"policyQualifiers"in this&&e.push(new cr({value:Array.from(this.policyQualifiers,e=>e.toSchema())})),new cr({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return"policyQualifiers"in this&&(e.policyQualifiers=Array.from(this.policyQualifiers,e=>e.toJSON())),e}}class xn{constructor(e={}){this.certificatePolicies=me(e,"certificatePolicies",xn.defaultValues("certificatePolicies")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("certificatePolicies"===e)return[];throw new Error(`Invalid member name for CertificatePolicies class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.certificatePolicies||"",value:Cn.schema()})]})}fromSchema(e){Ne(e,["certificatePolicies"]);const t=Hr(e,e,xn.schema({names:{certificatePolicies:"certificatePolicies"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(t.result.certificatePolicies,e=>new Cn({schema:e}))}toSchema(){return new cr({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}class Bn{constructor(e={}){this.issuerDomainPolicy=me(e,"issuerDomainPolicy",Bn.defaultValues("issuerDomainPolicy")),this.subjectDomainPolicy=me(e,"subjectDomainPolicy",Bn.defaultValues("subjectDomainPolicy")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"issuerDomainPolicy":case"subjectDomainPolicy":return"";default:throw new Error(`Invalid member name for PolicyMapping class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.issuerDomainPolicy||""}),new ar({name:t.subjectDomainPolicy||""})]})}fromSchema(e){Ne(e,["issuerDomainPolicy","subjectDomainPolicy"]);const t=Hr(e,e,Bn.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new cr({value:[new ar({value:this.issuerDomainPolicy}),new ar({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}class En{constructor(e={}){this.mappings=me(e,"mappings",En.defaultValues("mappings")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("mappings"===e)return[];throw new Error(`Invalid member name for PolicyMappings class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.mappings||"",value:Bn.schema()})]})}fromSchema(e){Ne(e,["mappings"]);const t=Hr(e,e,En.schema({names:{mappings:"mappings"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(t.result.mappings,e=>new Bn({schema:e}))}toSchema(){return new cr({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}class In{constructor(e={}){"keyIdentifier"in e&&(this.keyIdentifier=me(e,"keyIdentifier",In.defaultValues("keyIdentifier"))),"authorityCertIssuer"in e&&(this.authorityCertIssuer=me(e,"authorityCertIssuer",In.defaultValues("authorityCertIssuer"))),"authorityCertSerialNumber"in e&&(this.authorityCertSerialNumber=me(e,"authorityCertSerialNumber",In.defaultValues("authorityCertSerialNumber"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyIdentifier":return new qt;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new er;default:throw new Error(`Invalid member name for AuthorityKeyIdentifier class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new jt({name:t.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Rr({name:t.authorityCertIssuer||"",value:hn.schema()})]}),new jt({name:t.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){Ne(e,["keyIdentifier","authorityCertIssuer","authorityCertSerialNumber"]);const t=Hr(e,e,In.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");"keyIdentifier"in t.result&&(this.keyIdentifier=new qt({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,e=>new hn({schema:e}))),"authorityCertSerialNumber"in t.result&&(this.authorityCertSerialNumber=new er({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return"keyIdentifier"in this&&e.push(new jt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in this&&e.push(new Tt({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,e=>e.toSchema())})),"authorityCertSerialNumber"in this&&e.push(new jt({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHex})),new cr({value:e})}toJSON(){const e={};return"keyIdentifier"in this&&(e.keyIdentifier=this.keyIdentifier.toJSON()),"authorityCertIssuer"in this&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,e=>e.toJSON())),"authorityCertSerialNumber"in this&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}class Pn{constructor(e={}){"requireExplicitPolicy"in e&&(this.requireExplicitPolicy=me(e,"requireExplicitPolicy",Pn.defaultValues("requireExplicitPolicy"))),"inhibitPolicyMapping"in e&&(this.inhibitPolicyMapping=me(e,"inhibitPolicyMapping",Pn.defaultValues("inhibitPolicyMapping"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"requireExplicitPolicy":case"inhibitPolicyMapping":return 0;default:throw new Error(`Invalid member name for PolicyConstraints class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new jt({name:t.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new jt({name:t.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){Ne(e,["requireExplicitPolicy","inhibitPolicyMapping"]);const t=Hr(e,e,Pn.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in t.result){const e=t.result.requireExplicitPolicy;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const r=Rt(e.toBER(!1));this.requireExplicitPolicy=r.result.valueBlock.valueDec}if("inhibitPolicyMapping"in t.result){const e=t.result.inhibitPolicyMapping;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const r=Rt(e.toBER(!1));this.inhibitPolicyMapping=r.result.valueBlock.valueDec}}toSchema(){const e=[];if("requireExplicitPolicy"in this){const t=new er({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("inhibitPolicyMapping"in this){const t=new er({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new cr({value:e})}toJSON(){const e={};return"requireExplicitPolicy"in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),"inhibitPolicyMapping"in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}class Nn{constructor(e={}){this.keyPurposes=me(e,"keyPurposes",Nn.defaultValues("keyPurposes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("keyPurposes"===e)return[];throw new Error(`Invalid member name for ExtKeyUsage class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.keyPurposes||"",value:new ar})]})}fromSchema(e){Ne(e,["keyPurposes"]);const t=Hr(e,e,Nn.schema({names:{keyPurposes:"keyPurposes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(t.result.keyPurposes,e=>e.valueBlock.toString())}toSchema(){return new cr({value:Array.from(this.keyPurposes,e=>new ar({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}class On{constructor(e={}){this.accessDescriptions=me(e,"accessDescriptions",On.defaultValues("accessDescriptions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("accessDescriptions"===e)return[];throw new Error(`Invalid member name for InfoAccess class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new Rr({name:t.accessDescriptions||"",value:dn.schema()})]})}fromSchema(e){Ne(e,["accessDescriptions"]);const t=Hr(e,e,On.schema({names:{accessDescriptions:"accessDescriptions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(t.result.accessDescriptions,e=>new dn({schema:e}))}toSchema(){return new cr({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}class Ln{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}toString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let n=e;n<e+t;n++)r+=String.fromCharCode(this.view[n]);return r}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);let n=0,a=0;for(let i=0;i<t;i++)i%2?(a|=r.get(e.charAt(i)),this.view[n]=a,n++):a=r.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let n=e;n<e+t;n++){const e=this.view[n].toString(16).toUpperCase();r=r+(1==e.length?"0":"")+e}return r}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Ln;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Ln({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Ln;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new Ln({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,r=e.length,n=e._view.subarray();this.realloc(t+r),this._view.set(n,t)}insert(e,t=0,r=this.length-t){return!(t>this.length-1||(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),0))}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n),o=e.length;if(o>i)return-1;const c=[];for(let t=0;t<o;t++)c.push(e.view[t]);for(let e=0;e<=i-o;e++){let t=!0;const r=s?a-o-e:a+e;for(let e=0;e<o;e++)if(this.view[e+r]!=c[e]){t=!1;break}if(t)return s?a-o-e:a+o+e}return-1}findFirstIn(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n),o={id:-1,position:s?0:a+i,length:0};for(let t=0;t<e.length;t++){const r=this.findPattern(e[t],a,i,s);if(-1!=r){let n=!1;const a=e[t].length;s?r-a>=o.position-o.length&&(n=!0):r-a<=o.position-o.length&&(n=!0),n&&(o.position=r,o.id=t,o.length=a)}}return o}findAllIn(e,t,r){let{start:n,length:a}=this.prepareFindParameters(t,r);const i=[];let s={id:-1,position:n};for(;;){const t=s.position;if(s=this.findFirstIn(e,s.position,a),-1==s.id)break;a-=s.position-t,i.push({id:s.id,position:s.position})}return i}findAllPatternIn(e,t,r){const{start:n,length:a}=this.prepareFindParameters(t,r),i=[],s=e.length;if(s>a)return-1;const o=Array.from(e.view);for(let e=0;e<=a-s;e++){let t=!0;const r=n+e;for(let e=0;e<s;e++)if(this.view[e+r]!=o[e]){t=!1;break}t&&(i.push(n+s+e),e+=s-1)}return i}findFirstNotIn(e,t,r,n){let{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);const o={left:{id:-1,position:a},right:{id:-1,position:0},value:new Ln};let c=i;for(;c>0;){if(o.right=this.findFirstIn(e,s?a-i+c:a+i-c,c,s),-1==o.right.id){i=c,s?a-=i:a=o.left.position,o.value=new Ln({buffer:this._buffer.slice(a,a+i)});break}if(o.right.position!=(s?o.left.position-e[o.right.id].length:o.left.position+e[o.right.id].length)){s?(a=o.right.position+e[o.right.id].length,i=o.left.position-o.right.position-e[o.right.id].length):(a=o.left.position,i=o.right.position-o.left.position-e[o.right.id].length),o.value=new Ln({buffer:this._buffer.slice(a,a+i)});break}o.left=o.right,c-=e[o.right.id].length}if(s){const e=o.right;o.right=o.left,o.left=e}return o}findAllNotIn(e,t,r){let{start:n,length:a}=this.prepareFindParameters(t,r);const i=[];let s={left:{id:-1,position:n},right:{id:-1,position:n},value:new Ln};do{const t=s.right.position;s=this.findFirstNotIn(e,s.right.position,a),a-=s.right.position-t,i.push({left:{id:s.left.id,position:s.left.position},right:{id:s.right.id,position:s.right.position},value:s.value})}while(-1!=s.right.id);return i}findFirstSequence(e,t,r,n){let{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);const o=this.skipNotPatterns(e,a,i,s);if(-1==o)return{position:-1,value:new Ln};const c=this.skipPatterns(e,o,i-(s?a-o:o-a),s);return s?(a=c,i=o-c):(a=o,i=c-o),{position:c,value:new Ln({buffer:this._buffer.slice(a,a+i)})}}findAllSequences(e,t,r){let{start:n,length:a}=this.prepareFindParameters(t,r);const i=[];let s={position:n,value:new Ln};do{const t=s.position;s=this.findFirstSequence(e,s.position,a),-1!=s.position&&(a-=s.position-t,i.push({position:s.position,value:s.value}))}while(-1!=s.position);return i}findPairedPatterns(e,t,r,n){const a=[];if(e.isEqual(t))return a;const{start:i,length:s}=this.prepareFindParameters(r,n);let o=0;const c=this.findAllPatternIn(e,i,s);if(!Array.isArray(c)||0==c.length)return a;const u=this.findAllPatternIn(t,i,s);if(!Array.isArray(u)||0==u.length)return a;for(;o<c.length&&0!=u.length;)if(c[0]!=u[0]){if(c[o]>u[0])break;for(;c[o]<u[0]&&(o++,!(o>=c.length)););a.push({left:c[o-1],right:u[0]}),c.splice(o-1,1),u.splice(0,1),o=0}else a.push({left:c[0],right:u[0]}),c.splice(0,1),u.splice(0,1);return a.sort((e,t)=>e.left-t.left),a}findPairedArrays(e,t,r,n){const{start:a,length:i}=this.prepareFindParameters(r,n),s=[];let o=0;const c=this.findAllIn(e,a,i);if(0==c.length)return s;const u=this.findAllIn(t,a,i);if(0==u.length)return s;for(;o<c.length&&0!=u.length;)if(c[0].position!=u[0].position){if(c[o].position>u[0].position)break;for(;c[o].position<u[0].position&&(o++,!(o>=c.length)););s.push({left:c[o-1],right:u[0]}),c.splice(o-1,1),u.splice(0,1),o=0}else s.push({left:c[0],right:u[0]}),c.splice(0,1),u.splice(0,1);return s.sort((e,t)=>e.left.position-t.left.position),s}replacePattern(e,t,r,n,a=null){let i,s=[];const o={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:c,length:u}=this.prepareFindParameters(r,n);if(null==a){if(s=this.findAllIn([e],c,u),0==s.length)return o}else s=a;o.searchPatternPositions.push(...Array.from(s,e=>e.position));const l=e.length-t.length,h=new ArrayBuffer(this.view.length-s.length*l),d=new Uint8Array(h);for(d.set(new Uint8Array(this.buffer,0,c)),i=0;i<s.length;i++){const r=0==i?c:s[i-1].position;d.set(new Uint8Array(this.buffer,r,s[i].position-e.length-r),r-i*l),d.set(t.view,s[i].position-e.length-i*l),o.replacePatternPositions.push(s[i].position-e.length-i*l)}return i--,d.set(new Uint8Array(this.buffer,s[i].position,this.length-s[i].position),s[i].position-e.length+t.length-i*l),this.buffer=h,this.view=new Uint8Array(this.buffer),o.status=1,o}skipPatterns(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);let o=a;for(let t=0;t<e.length;t++){const r=e[t].length,n=s?o-r:o;let c=!0;for(let a=0;a<r;a++)if(this.view[a+n]!=e[t].view[a]){c=!1;break}if(c)if(t=-1,s){if(o-=r,o<=0)return o}else if(o+=r,o>=a+i)return o}return o}skipNotPatterns(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);let o=-1;for(let t=0;t<i;t++){for(let r=0;r<e.length;r++){const n=e[r].length,i=s?a-t-n:a+t;let c=!0;for(let t=0;t<n;t++)if(this.view[t+i]!=e[r].view[t]){c=!1;break}if(c){o=s?a-t:a+t;break}}if(-1!=o)break}return o}prepareFindParameters(e=null,t=null,r=!1){return null===e&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}class Un{constructor(e={}){this._stream=new Ln,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in e?new Ln({view:e.view}):"buffer"in e?new Ln({buffer:e.buffer}):"string"in e?new Ln({string:e.string}):"hexstring"in e?new Ln({hexstring:e.hexstring}):"stream"in e?e.stream.slice():new Ln,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(null==t||t>this.length)&&(t=this.length);const r=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==r)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}findFirstIn(e,t=null){(null==t||t>this.length)&&(t=this.length);const r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==r.id)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(null==t||t>this._length)&&(t=this._length);const r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==r.left.id&&-1==r.right.id)return r;if(this.backward){if(-1!=r.right.id&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ln}}else if(-1!=r.left.id&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ln};return this.backward?-1==r.left.id?this.start=0:this.start=r.left.position:-1==r.right.id?this.start=this._start+this._length:this.start=r.right.position,r}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,r=null){(null==t||t>this._length)&&(t=this._length),(null==r||r>t)&&(r=t);const n=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==n.value.length)return n;if(this.backward){if(n.position<this._start-n.value.length-r)return{position:-1,value:new Ln}}else if(n.position>this._start+n.value.length+r)return{position:-1,value:new Ln};return this.start=n.position,n}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,r=null){(null==r||r>this.length)&&(r=this.length);const n=this.backward?this.start-this.length:this.start,a=this.stream.findPairedPatterns(e,t,n,this.length);if(a.length)if(this.backward){if(a[0].right<this.start-t.length-r)return[]}else if(a[0].left>this.start+e.length+r)return[];return a}findPairedArrays(e,t,r=null){(null==r||r>this.length)&&(r=this.length);const n=this.backward?this.start-this.length:this.start,a=this.stream.findPairedArrays(e,t,n,this.length);if(a.length)if(this.backward){if(a[0].right.position<this.start-t[a[0].right.id].length-r)return[]}else if(a[0].left.position>this.start+e[a[0].left.id].length+r)return[];return a}replacePattern(e,t){const r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);let r;if(this._length<e&&(e=this._length),this.backward){const t=this._stream.view.subarray(this._length-e,this._length);r=new Uint8Array(e);for(let n=0;n<e;n++)r[e-1-n]=t[n]}else r=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),r}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:16777216*t[0]+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Un.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Un.APPEND_BLOCK=1e3;class jn{constructor(e={}){this.version=me(e,"version",jn.defaultValues("version")),this.logID=me(e,"logID",jn.defaultValues("logID")),this.timestamp=me(e,"timestamp",jn.defaultValues("timestamp")),this.extensions=me(e,"extensions",jn.defaultValues("extensions")),this.hashAlgorithm=me(e,"hashAlgorithm",jn.defaultValues("hashAlgorithm")),this.signatureAlgorithm=me(e,"signatureAlgorithm",jn.defaultValues("signatureAlgorithm")),this.signature=me(e,"signature",jn.defaultValues("signature")),"schema"in e&&this.fromSchema(e.schema),"stream"in e&&this.fromStream(e.stream)}static defaultValues(e){switch(e){case"version":return 0;case"logID":case"extensions":return new ArrayBuffer(0);case"timestamp":return new Date(0);case"hashAlgorithm":case"signatureAlgorithm":return"";case"signature":return new jr;default:throw new Error(`Invalid member name for SignedCertificateTimestamp class: ${e}`)}}fromSchema(e){if(e instanceof Vr==0)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Un({stream:new Ln({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(ge(new Uint8Array(e.getBlock(8)),8));const r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm="none";break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm="sha1";break;case 3:this.hashAlgorithm="sha224";break;case 4:this.hashAlgorithm="sha256";break;case 5:this.hashAlgorithm="sha384";break;case 6:this.hashAlgorithm="sha512";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm="anonymous";break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm="ecdsa";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const n=e.getUint16(),a=Rt(new Uint8Array(e.getBlock(n)).buffer.slice(0));if(-1===a.offset)throw new Error("Object's stream was not correct for SignedCertificateTimestamp");if(this.signature=a.result,t!==47+r+n)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Vr({data:e.stream.buffer})}toStream(){const e=new Un;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecode.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),r=new Uint8Array(t),n=ve(this.timestamp.valueOf(),8);let a,i;switch(r.set(new Uint8Array(n),8-n.byteLength),e.appendView(r),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case"none":a=0;break;case"md5":a=1;break;case"sha1":a=2;break;case"sha224":a=3;break;case"sha256":a=4;break;case"sha384":a=5;break;case"sha512":a=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}switch(e.appendChar(a),this.signatureAlgorithm.toLowerCase()){case"anonymous":i=0;break;case"rsa":i=1;break;case"dsa":i=2;break;case"ecdsa":i=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(i);const s=this.signature.toBER(!1);return e.appendUint16(s.byteLength),e.appendView(new Uint8Array(s)),e}toJSON(){return{version:this.version,logID:pe(this.logID),timestamp:this.timestamp,extensions:pe(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,r=0){let n,a=Ce(Be(this.logID)),i=null,s=new Un;for(const t of e)if(t.log_id===a){i=t.key;break}if(null===i)throw new Error(`Public key not found for CT with logId: ${a}`);const o=Rt(Ee(xe(i)));if(-1===o.offset)throw new Error(`Incorrect key value for CT Log with logId: ${a}`);n=new Fr({schema:o.result}),s.appendChar(0),s.appendChar(0);const c=new ArrayBuffer(8),u=new Uint8Array(c),l=ve(this.timestamp.valueOf(),8);return u.set(new Uint8Array(l),8-l.byteLength),s.appendView(u),s.appendUint16(r),0===r&&s.appendUint24(t.byteLength),s.appendView(new Uint8Array(t)),s.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&s.appendView(new Uint8Array(this.extensions)),rn().subtle.verifyWithPublicKey(s._stream._buffer.slice(0,s._length),{valueBlock:{valueHex:this.signature.toBER(!1)}},n,{algorithmId:""},"SHA-256")}}class Dn{constructor(e={}){this.timestamps=me(e,"timestamps",Dn.defaultValues("timestamps")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("timestamps"===e)return[];throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static compareWithDefault(e,t){if("timestamps"===e)return 0===t.length;throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static schema(e={}){const t=me(e,"names",{});return"optional"in t==0&&(t.optional=!1),new qt({name:t.blockName||"SignedCertificateTimestampList",optional:t.optional})}fromSchema(e){if(e instanceof qt==0)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Un({stream:new Ln({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new jn({stream:t}))}toSchema(){const e=new Un;let t=0;const r=[];for(const e of this.timestamps){const n=e.toStream();r.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const t of r)e.appendView(t.stream.view);return new qt({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}class Rn{constructor(e={}){this.extnID=me(e,"extnID",Rn.defaultValues("extnID")),this.critical=me(e,"critical",Rn.defaultValues("critical")),this.extnValue="extnValue"in e?new qt({valueHex:e.extnValue}):Rn.defaultValues("extnValue"),"parsedValue"in e&&(this.parsedValue=me(e,"parsedValue",Rn.defaultValues("parsedValue"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"extnID":return"";case"critical":return!1;case"extnValue":return new qt;case"parsedValue":return{};default:throw new Error(`Invalid member name for Extension class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[new ar({name:t.extnID||""}),new Jt({name:t.critical||"",optional:!0}),new qt({name:t.extnValue||""})]})}fromSchema(e){Ne(e,["extnID","critical","extnValue"]);let t=Hr(e,e,Rn.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extension");if(this.extnID=t.result.extnID.valueBlock.toString(),"critical"in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue,t=Rt(this.extnValue.valueBlock.valueHex),-1!==t.offset)switch(this.extnID){case"2.5.29.9":try{this.parsedValue=new pn({schema:t.result})}catch(e){this.parsedValue=new pn,this.parsedValue.parsingError="Incorrectly formated SubjectDirectoryAttributes"}break;case"2.5.29.14":case"2.5.29.15":case"2.5.29.20":case"2.5.29.27":case"2.5.29.21":case"2.5.29.24":case"2.5.29.54":this.parsedValue=t.result;break;case"2.5.29.16":try{this.parsedValue=new gn({schema:t.result})}catch(e){this.parsedValue=new gn,this.parsedValue.parsingError="Incorrectly formated PrivateKeyUsagePeriod"}break;case"2.5.29.17":case"2.5.29.18":try{this.parsedValue=new fn({schema:t.result})}catch(e){this.parsedValue=new fn,this.parsedValue.parsingError="Incorrectly formated AltName"}break;case"2.5.29.19":try{this.parsedValue=new vn({schema:t.result})}catch(e){this.parsedValue=new vn,this.parsedValue.parsingError="Incorrectly formated BasicConstraints"}break;case"2.5.29.28":try{this.parsedValue=new bn({schema:t.result})}catch(e){this.parsedValue=new bn,this.parsedValue.parsingError="Incorrectly formated IssuingDistributionPoint"}break;case"2.5.29.29":try{this.parsedValue=new wn({schema:t.result})}catch(e){this.parsedValue=new wn,this.parsedValue.parsingError="Incorrectly formated GeneralNames"}break;case"2.5.29.30":try{this.parsedValue=new kn({schema:t.result})}catch(e){this.parsedValue=new kn,this.parsedValue.parsingError="Incorrectly formated NameConstraints"}break;case"2.5.29.31":case"2.5.29.46":try{this.parsedValue=new An({schema:t.result})}catch(e){this.parsedValue=new An,this.parsedValue.parsingError="Incorrectly formated CRLDistributionPoints"}break;case"2.5.29.32":try{this.parsedValue=new xn({schema:t.result})}catch(e){this.parsedValue=new xn,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.33":try{this.parsedValue=new En({schema:t.result})}catch(e){this.parsedValue=new En,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.35":try{this.parsedValue=new In({schema:t.result})}catch(e){this.parsedValue=new In,this.parsedValue.parsingError="Incorrectly formated AuthorityKeyIdentifier"}break;case"2.5.29.36":try{this.parsedValue=new Pn({schema:t.result})}catch(e){this.parsedValue=new Pn,this.parsedValue.parsingError="Incorrectly formated PolicyConstraints"}break;case"2.5.29.37":try{this.parsedValue=new Nn({schema:t.result})}catch(e){this.parsedValue=new Nn,this.parsedValue.parsingError="Incorrectly formated ExtKeyUsage"}break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":try{this.parsedValue=new On({schema:t.result})}catch(e){this.parsedValue=new On,this.parsedValue.parsingError="Incorrectly formated InfoAccess"}break;case"1.3.6.1.4.1.11129.2.4.2":try{this.parsedValue=new Dn({schema:t.result})}catch(e){this.parsedValue=new Dn,this.parsedValue.parsingError="Incorrectly formated SignedCertificateTimestampList"}}}toSchema(){const e=[];return e.push(new ar({value:this.extnID})),this.critical!==Rn.defaultValues("critical")&&e.push(new Jt({value:this.critical})),e.push(this.extnValue),new cr({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Rn.defaultValues("critical")&&(e.critical=this.critical),"parsedValue"in this&&"toJSON"in this.parsedValue&&(e.parsedValue=this.parsedValue.toJSON()),e}}class Vn{constructor(e={}){this.extensions=me(e,"extensions",Vn.defaultValues("extensions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("extensions"===e)return[];throw new Error(`Invalid member name for Extensions class: ${e}`)}static schema(e={},t=!1){const r=me(e,"names",{});return new cr({optional:t,name:r.blockName||"",value:[new Rr({name:r.extensions||"",value:Rn.schema(r.extension||{})})]})}fromSchema(e){Ne(e,["extensions"]);const t=Hr(e,e,Vn.schema({names:{extensions:"extensions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extensions");this.extensions=Array.from(t.result.extensions,e=>new Rn({schema:e}))}toSchema(){return new cr({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:Array.from(this.extensions,e=>e.toJSON())}}}function Hn(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"tbsCertificate",value:[new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new er({name:t.tbsCertificateVersion||"tbsCertificate.version"})]}),new er({name:t.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),Tr.schema(t.signature||{names:{blockName:"tbsCertificate.signature"}}),on.schema(t.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new cr({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[mn.schema(t.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),mn.schema(t.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),on.schema(t.subject||{names:{blockName:"tbsCertificate.subject"}}),Fr.schema(t.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new jt({name:t.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new jt({name:t.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Vn.schema(t.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}class Tn{constructor(e={}){this.tbs=me(e,"tbs",Tn.defaultValues("tbs")),this.version=me(e,"version",Tn.defaultValues("version")),this.serialNumber=me(e,"serialNumber",Tn.defaultValues("serialNumber")),this.signature=me(e,"signature",Tn.defaultValues("signature")),this.issuer=me(e,"issuer",Tn.defaultValues("issuer")),this.notBefore=me(e,"notBefore",Tn.defaultValues("notBefore")),this.notAfter=me(e,"notAfter",Tn.defaultValues("notAfter")),this.subject=me(e,"subject",Tn.defaultValues("subject")),this.subjectPublicKeyInfo=me(e,"subjectPublicKeyInfo",Tn.defaultValues("subjectPublicKeyInfo")),"issuerUniqueID"in e&&(this.issuerUniqueID=me(e,"issuerUniqueID",Tn.defaultValues("issuerUniqueID"))),"subjectUniqueID"in e&&(this.subjectUniqueID=me(e,"subjectUniqueID",Tn.defaultValues("subjectUniqueID"))),"extensions"in e&&(this.extensions=me(e,"extensions",Tn.defaultValues("extensions"))),this.signatureAlgorithm=me(e,"signatureAlgorithm",Tn.defaultValues("signatureAlgorithm")),this.signatureValue=me(e,"signatureValue",Tn.defaultValues("signatureValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":case"issuerUniqueID":case"subjectUniqueID":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new er;case"signature":case"signatureAlgorithm":return new Tr;case"issuer":case"subject":return new on;case"notBefore":case"notAfter":return new mn;case"subjectPublicKeyInfo":return new Fr;case"extensions":return[];case"signatureValue":return new Zt;default:throw new Error(`Invalid member name for Certificate class: ${e}`)}}static schema(e={}){const t=me(e,"names",{});return new cr({name:t.blockName||"",value:[Hn(t.tbsCertificate),Tr.schema(t.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new Zt({name:t.signatureValue||"signatureValue"})]})}fromSchema(e){Ne(e,["tbsCertificate","tbsCertificate.extensions","tbsCertificate.version","tbsCertificate.serialNumber","tbsCertificate.signature","tbsCertificate.issuer","tbsCertificate.notBefore","tbsCertificate.notAfter","tbsCertificate.subject","tbsCertificate.subjectPublicKeyInfo","tbsCertificate.issuerUniqueID","tbsCertificate.subjectUniqueID","signatureAlgorithm","signatureValue"]);const t=Hr(e,e,Tn.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Certificate");this.tbs=t.result.tbsCertificate.valueBeforeDecode,"tbsCertificate.version"in t.result&&(this.version=t.result["tbsCertificate.version"].valueBlock.valueDec),this.serialNumber=t.result["tbsCertificate.serialNumber"],this.signature=new Tr({schema:t.result["tbsCertificate.signature"]}),this.issuer=new on({schema:t.result["tbsCertificate.issuer"]}),this.notBefore=new mn({schema:t.result["tbsCertificate.notBefore"]}),this.notAfter=new mn({schema:t.result["tbsCertificate.notAfter"]}),this.subject=new on({schema:t.result["tbsCertificate.subject"]}),this.subjectPublicKeyInfo=new Fr({schema:t.result["tbsCertificate.subjectPublicKeyInfo"]}),"tbsCertificate.issuerUniqueID"in t.result&&(this.issuerUniqueID=t.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex),"tbsCertificate.subjectUniqueID"in t.result&&(this.subjectUniqueID=t.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex),"tbsCertificate.extensions"in t.result&&(this.extensions=Array.from(t.result["tbsCertificate.extensions"],e=>new Rn({schema:e}))),this.signatureAlgorithm=new Tr({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return"version"in this&&this.version!==Tn.defaultValues("version")&&e.push(new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new er({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new cr({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),"issuerUniqueID"in this&&e.push(new jt({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),"subjectUniqueID"in this&&e.push(new jt({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),"extensions"in this&&e.push(new Tt({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new cr({value:Array.from(this.extensions,e=>e.toSchema())})]})),new cr({value:e})}toSchema(e=!1){let t={};if(!1===e){if(0===this.tbs.length)return Tn.schema().value[0];t=Rt(this.tbs).result}else t=this.encodeTBS();return new cr({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:pe(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"version"in this&&this.version!==Tn.defaultValues("version")&&(e.version=this.version),"issuerUniqueID"in this&&(e.issuerUniqueID=pe(this.issuerUniqueID,0,this.issuerUniqueID.byteLength)),"subjectUniqueID"in this&&(e.subjectUniqueID=pe(this.subjectUniqueID,0,this.subjectUniqueID.byteLength)),"extensions"in this&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}getPublicKey(e=null){return rn().subtle.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}getKeyHash(e="SHA-1"){const t=nn();return void 0===t?Promise.reject("Unable to create WebCrypto object"):t.digest({name:e},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))}sign(e,t="SHA-1"){if(void 0===e)return Promise.reject("Need to provide a private key for signing");let r,n=Promise.resolve();const a=rn();return n=n.then(()=>a.subtle.getSignatureParameters(e,t)),n=n.then(e=>{r=e.parameters,this.signature=e.signatureAlgorithm,this.signatureAlgorithm=e.signatureAlgorithm}),n=n.then(()=>{this.tbs=this.encodeTBS().toBER(!1)}),n=n.then(()=>a.subtle.signWithPrivateKey(this.tbs,e,r)),n=n.then(e=>{this.signatureValue=new Zt({valueHex:e})}),n}verify(e=null){let t={};return null!==e?t=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(t=this.subjectPublicKeyInfo),t instanceof Fr==0?Promise.reject("Please provide issuer certificate as a parameter"):rn().subtle.verifyWithPublicKey(this.tbs,this.signatureValue,t,this.signatureAlgorithm)}}function $n(e){let t=e.length;for(;--t>=0;)e[t]=0}const Kn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Mn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Jn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zn=new Array(576);$n(zn);const qn=new Array(60);$n(qn);const Wn=new Array(512);$n(Wn);const Zn=new Array(256);$n(Zn);const Gn=new Array(29);$n(Gn);const Qn=new Array(30);function Yn(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let Xn,ea,ta;function ra(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}$n(Qn);const na=e=>e<256?Wn[e]:Wn[256+(e>>>7)],aa=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ia=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,aa(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},sa=(e,t,r)=>{ia(e,r[2*t],r[2*t+1])},oa=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},ca=(e,t,r)=>{const n=new Array(16);let a,i,s=0;for(a=1;a<=15;a++)s=s+r[a-1]<<1,n[a]=s;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=oa(n[t]++,t))}},ua=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},la=e=>{e.bi_valid>8?aa(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},ha=(e,t,r,n)=>{const a=2*t,i=2*r;return e[a]<e[i]||e[a]===e[i]&&n[t]<=n[r]},da=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&ha(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!ha(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},fa=(e,t,r)=>{let n,a,i,s,o=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+o++],n+=(255&e.pending_buf[e.sym_buf+o++])<<8,a=e.pending_buf[e.sym_buf+o++],0===n?sa(e,a,t):(i=Zn[a],sa(e,i+256+1,t),s=Kn[i],0!==s&&(a-=Gn[i],ia(e,a,s)),n--,i=na(n),sa(e,i,r),s=Fn[i],0!==s&&(n-=Qn[i],ia(e,n,s)))}while(o<e.sym_next);sa(e,256,t)},ma=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,i=t.stat_desc.elems;let s,o,c,u=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<i;s++)0!==r[2*s]?(e.heap[++e.heap_len]=u=s,e.depth[s]=0):r[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,a&&(e.static_len-=n[2*c+1]);for(t.max_code=u,s=e.heap_len>>1;s>=1;s--)da(e,r,s);c=i;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],da(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,r[2*c]=r[2*s]+r[2*o],e.depth[c]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,r[2*s+1]=r[2*o+1]=c,e.heap[1]=c++,da(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length;let u,l,h,d,f,m,p=0;for(d=0;d<=15;d++)e.bl_count[d]=0;for(r[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)l=e.heap[u],d=r[2*r[2*l+1]+1]+1,d>c&&(d=c,p++),r[2*l+1]=d,l>n||(e.bl_count[d]++,f=0,l>=o&&(f=s[l-o]),m=r[2*l],e.opt_len+=m*(d+f),i&&(e.static_len+=m*(a[2*l+1]+f)));if(0!==p){do{for(d=c-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[c]--,p-=2}while(p>0);for(d=c;0!==d;d--)for(l=e.bl_count[d];0!==l;)h=e.heap[--u],h>n||(r[2*h+1]!==d&&(e.opt_len+=(d-r[2*h+1])*r[2*h],r[2*h+1]=d),l--)}})(e,t),ca(r,u,e.bl_count)},pa=(e,t,r)=>{let n,a,i=-1,s=t[1],o=0,c=7,u=4;for(0===s&&(c=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)a=s,s=t[2*(n+1)+1],++o<c&&a===s||(o<u?e.bl_tree[2*a]+=o:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=a,0===s?(c=138,u=3):a===s?(c=6,u=3):(c=7,u=4))},ga=(e,t,r)=>{let n,a,i=-1,s=t[1],o=0,c=7,u=4;for(0===s&&(c=138,u=3),n=0;n<=r;n++)if(a=s,s=t[2*(n+1)+1],!(++o<c&&a===s)){if(o<u)do{sa(e,a,e.bl_tree)}while(0!==--o);else 0!==a?(a!==i&&(sa(e,a,e.bl_tree),o--),sa(e,16,e.bl_tree),ia(e,o-3,2)):o<=10?(sa(e,17,e.bl_tree),ia(e,o-3,3)):(sa(e,18,e.bl_tree),ia(e,o-11,7));o=0,i=a,0===s?(c=138,u=3):a===s?(c=6,u=3):(c=7,u=4)}};let va=!1;const ba=(e,t,r,n)=>{ia(e,0+(n?1:0),3),la(e),aa(e,r),aa(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var wa={_tr_init:e=>{va||((()=>{let e,t,r,n,a;const i=new Array(16);for(r=0,n=0;n<28;n++)for(Gn[n]=r,e=0;e<1<<Kn[n];e++)Zn[r++]=n;for(Zn[r-1]=n,a=0,n=0;n<16;n++)for(Qn[n]=a,e=0;e<1<<Fn[n];e++)Wn[a++]=n;for(a>>=7;n<30;n++)for(Qn[n]=a<<7,e=0;e<1<<Fn[n]-7;e++)Wn[256+a++]=n;for(t=0;t<=15;t++)i[t]=0;for(e=0;e<=143;)zn[2*e+1]=8,e++,i[8]++;for(;e<=255;)zn[2*e+1]=9,e++,i[9]++;for(;e<=279;)zn[2*e+1]=7,e++,i[7]++;for(;e<=287;)zn[2*e+1]=8,e++,i[8]++;for(ca(zn,287,i),e=0;e<30;e++)qn[2*e+1]=5,qn[2*e]=oa(e,5);Xn=new Yn(zn,Kn,257,286,15),ea=new Yn(qn,Fn,0,30,15),ta=new Yn(new Array(0),Mn,0,19,7)})(),va=!0),e.l_desc=new ra(e.dyn_ltree,Xn),e.d_desc=new ra(e.dyn_dtree,ea),e.bl_desc=new ra(e.bl_tree,ta),e.bi_buf=0,e.bi_valid=0,ua(e)},_tr_stored_block:ba,_tr_flush_block:(e,t,r,n)=>{let a,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ma(e,e.l_desc),ma(e,e.d_desc),s=(e=>{let t;for(pa(e,e.dyn_ltree,e.l_desc.max_code),pa(e,e.dyn_dtree,e.d_desc.max_code),ma(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Jn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=a&&(a=i)):a=i=r+5,r+4<=a&&-1!==t?ba(e,t,r,n):4===e.strategy||i===a?(ia(e,2+(n?1:0),3),fa(e,zn,qn)):(ia(e,4+(n?1:0),3),((e,t,r,n)=>{let a;for(ia(e,t-257,5),ia(e,r-1,5),ia(e,n-4,4),a=0;a<n;a++)ia(e,e.bl_tree[2*Jn[a]+1],3);ga(e,e.dyn_ltree,t-1),ga(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),fa(e,e.dyn_ltree,e.dyn_dtree)),ua(e),n&&la(e)},_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Zn[r]+256+1)]++,e.dyn_dtree[2*na(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{ia(e,2,3),sa(e,256,zn),(e=>{16===e.bi_valid?(aa(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},ya=(e,t,r,n)=>{let a=65535&e,i=e>>>16&65535,s=0;for(;0!==r;){s=r>2e3?2e3:r,r-=s;do{a=a+t[n++]|0,i=i+a|0}while(--s);a%=65521,i%=65521}return a|i<<16};const ka=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var _a=(e,t,r,n)=>{const a=ka,i=n+r;e^=-1;for(let r=n;r<i;r++)e=e>>>8^a[255&(e^t[r])];return-1^e},Aa={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Sa={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Ca,_tr_stored_block:xa,_tr_flush_block:Ba,_tr_tally:Ea,_tr_align:Ia}=wa,{Z_NO_FLUSH:Pa,Z_PARTIAL_FLUSH:Na,Z_FULL_FLUSH:Oa,Z_FINISH:La,Z_BLOCK:Ua,Z_OK:ja,Z_STREAM_END:Da,Z_STREAM_ERROR:Ra,Z_DATA_ERROR:Va,Z_BUF_ERROR:Ha,Z_DEFAULT_COMPRESSION:Ta,Z_FILTERED:$a,Z_HUFFMAN_ONLY:Ka,Z_RLE:Fa,Z_FIXED:Ma,Z_DEFAULT_STRATEGY:Ja,Z_UNKNOWN:za,Z_DEFLATED:qa}=Sa,Wa=258,Za=262,Ga=42,Qa=113,Ya=666,Xa=(e,t)=>(e.msg=Aa[t],t),ei=e=>2*e-(e>4?9:0),ti=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ri=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do{r=e.head[--n],e.head[n]=r>=a?r-a:0}while(--t);t=a,n=t;do{r=e.prev[--n],e.prev[n]=r>=a?r-a:0}while(--t)};let ni=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const ai=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},ii=(e,t)=>{Ba(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ai(e.strm)},si=(e,t)=>{e.pending_buf[e.pending++]=t},oi=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ci=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),1===e.state.wrap?e.adler=ya(e.adler,t,a,r):2===e.state.wrap&&(e.adler=_a(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},ui=(e,t)=>{let r,n,a=e.max_chain_length,i=e.strstart,s=e.prev_length,o=e.nice_match;const c=e.strstart>e.w_size-Za?e.strstart-(e.w_size-Za):0,u=e.window,l=e.w_mask,h=e.prev,d=e.strstart+Wa;let f=u[i+s-1],m=u[i+s];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(r=t,u[r+s]===m&&u[r+s-1]===f&&u[r]===u[i]&&u[++r]===u[i+1]){i+=2,r++;do{}while(u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&i<d);if(n=Wa-(d-i),i=d-Wa,n>s){if(e.match_start=t,s=n,n>=o)break;f=u[i+s-1],m=u[i+s]}}}while((t=h[t&l])>c&&0!==--a);return s<=e.lookahead?s:e.lookahead},li=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Za)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ri(e),n+=t),0===e.strm.avail_in)break;if(r=ci(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=ni(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=ni(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Za&&0!==e.strm.avail_in)},hi=(e,t)=>{let r,n,a,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(r=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>a&&(r=a),r<i&&(0===r&&t!==La||t===Pa||r!==n+e.strm.avail_in))break;s=t===La&&r===n+e.strm.avail_in?1:0,xa(e,0,0,s),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,ai(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(ci(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==Pa&&t!==La&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(ci(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,i=a>e.w_size?e.w_size:a,n=e.strstart-e.block_start,(n>=i||(n||t===La)&&t!==Pa&&0===e.strm.avail_in&&n<=a)&&(r=n>a?a:n,s=t===La&&0===e.strm.avail_in&&r===n?1:0,xa(e,e.block_start,r,s),e.block_start+=r,ai(e.strm)),s?3:1)},di=(e,t)=>{let r,n;for(;;){if(e.lookahead<Za){if(li(e),e.lookahead<Za&&t===Pa)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ni(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-Za&&(e.match_length=ui(e,r)),e.match_length>=3)if(n=Ea(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ni(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ni(e,e.ins_h,e.window[e.strstart+1]);else n=Ea(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(ii(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===La?(ii(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ii(e,!1),0===e.strm.avail_out)?1:2},fi=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<Za){if(li(e),e.lookahead<Za&&t===Pa)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ni(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Za&&(e.match_length=ui(e,r),e.match_length<=5&&(e.strategy===$a||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,n=Ea(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=ni(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(ii(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Ea(e,0,e.window[e.strstart-1]),n&&ii(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Ea(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===La?(ii(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ii(e,!1),0===e.strm.avail_out)?1:2};function mi(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const pi=[new mi(0,0,0,0,hi),new mi(4,4,8,4,di),new mi(4,5,16,8,di),new mi(4,6,32,32,di),new mi(4,4,16,16,fi),new mi(8,16,32,32,fi),new mi(8,16,128,128,fi),new mi(8,32,128,256,fi),new mi(32,128,258,1024,fi),new mi(32,258,258,4096,fi)];function gi(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=qa,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ti(this.dyn_ltree),ti(this.dyn_dtree),ti(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ti(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ti(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const vi=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ga&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Qa&&t.status!==Ya?1:0},bi=e=>{if(vi(e))return Xa(e,Ra);e.total_in=e.total_out=0,e.data_type=za;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Ga:Qa,e.adler=2===t.wrap?0:1,t.last_flush=-2,Ca(t),ja},wi=e=>{const t=bi(e);return t===ja&&(e=>{e.window_size=2*e.w_size,ti(e.head),e.max_lazy_match=pi[e.level].max_lazy,e.good_match=pi[e.level].good_length,e.nice_match=pi[e.level].nice_length,e.max_chain_length=pi[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},yi=(e,t,r,n,a,i)=>{if(!e)return Ra;let s=1;if(t===Ta&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||r!==qa||n<8||n>15||t<0||t>9||i<0||i>Ma||8===n&&1!==s)return Xa(e,Ra);8===n&&(n=9);const o=new gi;return e.state=o,o.strm=e,o.status=Ga,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=r,wi(e)};var ki=yi,_i=(e,t)=>vi(e)||2!==e.state.wrap?Ra:(e.state.gzhead=t,ja),Ai=(e,t)=>{if(vi(e)||t>Ua||t<0)return e?Xa(e,Ra):Ra;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===Ya&&t!==La)return Xa(e,0===e.avail_out?Ha:Ra);const n=r.last_flush;if(r.last_flush=t,0!==r.pending){if(ai(e),0===e.avail_out)return r.last_flush=-1,ja}else if(0===e.avail_in&&ei(t)<=ei(n)&&t!==La)return Xa(e,Ha);if(r.status===Ya&&0!==e.avail_in)return Xa(e,Ha);if(r.status===Ga&&0===r.wrap&&(r.status=Qa),r.status===Ga){let t=qa+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=Ka||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=n<<6,0!==r.strstart&&(t|=32),t+=31-t%31,oi(r,t),0!==r.strstart&&(oi(r,e.adler>>>16),oi(r,65535&e.adler)),e.adler=1,r.status=Qa,ai(e),0!==r.pending)return r.last_flush=-1,ja}if(57===r.status)if(e.adler=0,si(r,31),si(r,139),si(r,8),r.gzhead)si(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),si(r,255&r.gzhead.time),si(r,r.gzhead.time>>8&255),si(r,r.gzhead.time>>16&255),si(r,r.gzhead.time>>24&255),si(r,9===r.level?2:r.strategy>=Ka||r.level<2?4:0),si(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(si(r,255&r.gzhead.extra.length),si(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=_a(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(si(r,0),si(r,0),si(r,0),si(r,0),si(r,0),si(r,9===r.level?2:r.strategy>=Ka||r.level<2?4:0),si(r,3),r.status=Qa,ai(e),0!==r.pending)return r.last_flush=-1,ja;if(69===r.status){if(r.gzhead.extra){let t=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let a=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=_a(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=a,ai(e),0!==r.pending)return r.last_flush=-1,ja;t=0,n-=a}let a=new Uint8Array(r.gzhead.extra);r.pending_buf.set(a.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>t&&(e.adler=_a(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=_a(e.adler,r.pending_buf,r.pending-n,n)),ai(e),0!==r.pending)return r.last_flush=-1,ja;n=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,si(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=_a(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=_a(e.adler,r.pending_buf,r.pending-n,n)),ai(e),0!==r.pending)return r.last_flush=-1,ja;n=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,si(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=_a(e.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(ai(e),0!==r.pending))return r.last_flush=-1,ja;si(r,255&e.adler),si(r,e.adler>>8&255),e.adler=0}if(r.status=Qa,ai(e),0!==r.pending)return r.last_flush=-1,ja}if(0!==e.avail_in||0!==r.lookahead||t!==Pa&&r.status!==Ya){let n=0===r.level?hi(r,t):r.strategy===Ka?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(li(e),0===e.lookahead)){if(t===Pa)return 1;break}if(e.match_length=0,r=Ea(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(ii(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===La?(ii(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ii(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===Fa?((e,t)=>{let r,n,a,i;const s=e.window;for(;;){if(e.lookahead<=Wa){if(li(e),e.lookahead<=Wa&&t===Pa)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,n=s[a],n===s[++a]&&n===s[++a]&&n===s[++a])){i=e.strstart+Wa;do{}while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<i);e.match_length=Wa-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Ea(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Ea(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(ii(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===La?(ii(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ii(e,!1),0===e.strm.avail_out)?1:2})(r,t):pi[r.level].func(r,t);if(3!==n&&4!==n||(r.status=Ya),1===n||3===n)return 0===e.avail_out&&(r.last_flush=-1),ja;if(2===n&&(t===Na?Ia(r):t!==Ua&&(xa(r,0,0,!1),t===Oa&&(ti(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),ai(e),0===e.avail_out))return r.last_flush=-1,ja}return t!==La?ja:r.wrap<=0?Da:(2===r.wrap?(si(r,255&e.adler),si(r,e.adler>>8&255),si(r,e.adler>>16&255),si(r,e.adler>>24&255),si(r,255&e.total_in),si(r,e.total_in>>8&255),si(r,e.total_in>>16&255),si(r,e.total_in>>24&255)):(oi(r,e.adler>>>16),oi(r,65535&e.adler)),ai(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?ja:Da)},Si=e=>{if(vi(e))return Ra;const t=e.state.status;return e.state=null,t===Qa?Xa(e,Va):ja},Ci=(e,t)=>{let r=t.length;if(vi(e))return Ra;const n=e.state,a=n.wrap;if(2===a||1===a&&n.status!==Ga||n.lookahead)return Ra;if(1===a&&(e.adler=ya(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===a&&(ti(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(r-n.w_size,r),0),t=e,r=n.w_size}const i=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,li(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=ni(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,li(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=o,e.avail_in=i,n.wrap=a,ja};const xi=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Bi=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)xi(r,t)&&(e[t]=r[t])}}return e},Ei=e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,n=0,a=e.length;t<a;t++){let a=e[t];r.set(a,n),n+=a.length}return r};let Ii=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ii=!1}const Pi=new Uint8Array(256);for(let e=0;e<256;e++)Pi[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Pi[254]=Pi[254]=1;var Ni=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,n,a,i,s=e.length,o=0;for(a=0;a<s;a++)r=e.charCodeAt(a),55296==(64512&r)&&a+1<s&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),i=0,a=0;i<o;a++)r=e.charCodeAt(a),55296==(64512&r)&&a+1<s&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},Oi=(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,a;const i=new Array(2*r);for(a=0,n=0;n<r;){let t=e[n++];if(t<128){i[a++]=t;continue}let s=Pi[t];if(s>4)i[a++]=65533,n+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&n<r;)t=t<<6|63&e[n++],s--;s>1?i[a++]=65533:t<65536?i[a++]=t:(t-=65536,i[a++]=55296|t>>10&1023,i[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ii)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r})(i,a)},Li=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Pi[e[r]]>t?r:t},Ui=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ji=Object.prototype.toString,{Z_NO_FLUSH:Di,Z_SYNC_FLUSH:Ri,Z_FULL_FLUSH:Vi,Z_FINISH:Hi,Z_OK:Ti,Z_STREAM_END:$i,Z_DEFAULT_COMPRESSION:Ki,Z_DEFAULT_STRATEGY:Fi,Z_DEFLATED:Mi}=Sa;function Ji(e){this.options=Bi({level:Ki,method:Mi,chunkSize:16384,windowBits:15,memLevel:8,strategy:Fi},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ui,this.strm.avail_out=0;let r=ki(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Ti)throw new Error(Aa[r]);if(t.header&&_i(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ni(t.dictionary):"[object ArrayBuffer]"===ji.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=Ci(this.strm,e),r!==Ti)throw new Error(Aa[r]);this._dict_set=!0}}function zi(e,t){const r=new Ji(t);if(r.push(e,!0),r.err)throw r.msg||Aa[r.err];return r.result}Ji.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Hi:Di,"string"==typeof e?r.input=Ni(e):"[object ArrayBuffer]"===ji.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(i===Ri||i===Vi)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(a=Ai(r,i),a===$i)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=Si(this.strm),this.onEnd(a),this.ended=!0,a===Ti;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Ji.prototype.onData=function(e){this.chunks.push(e)},Ji.prototype.onEnd=function(e){e===Ti&&(this.result=Ei(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qi={Deflate:Ji,deflate:zi,deflateRaw:function(e,t){return(t=t||{}).raw=!0,zi(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,zi(e,t)},constants:Sa};const Wi=16209;var Zi=function(e,t){let r,n,a,i,s,o,c,u,l,h,d,f,m,p,g,v,b,w,y,k,_,A,S,C;const x=e.state;r=e.next_in,S=e.input,n=r+(e.avail_in-5),a=e.next_out,C=e.output,i=a-(t-e.avail_out),s=a+(e.avail_out-257),o=x.dmax,c=x.wsize,u=x.whave,l=x.wnext,h=x.window,d=x.hold,f=x.bits,m=x.lencode,p=x.distcode,g=(1<<x.lenbits)-1,v=(1<<x.distbits)-1;e:do{f<15&&(d+=S[r++]<<f,f+=8,d+=S[r++]<<f,f+=8),b=m[d&g];t:for(;;){if(w=b>>>24,d>>>=w,f-=w,w=b>>>16&255,0===w)C[a++]=65535&b;else{if(!(16&w)){if(64&w){if(32&w){x.mode=16191;break e}e.msg="invalid literal/length code",x.mode=Wi;break e}b=m[(65535&b)+(d&(1<<w)-1)];continue t}for(y=65535&b,w&=15,w&&(f<w&&(d+=S[r++]<<f,f+=8),y+=d&(1<<w)-1,d>>>=w,f-=w),f<15&&(d+=S[r++]<<f,f+=8,d+=S[r++]<<f,f+=8),b=p[d&v];;){if(w=b>>>24,d>>>=w,f-=w,w=b>>>16&255,16&w){if(k=65535&b,w&=15,f<w&&(d+=S[r++]<<f,f+=8,f<w&&(d+=S[r++]<<f,f+=8)),k+=d&(1<<w)-1,k>o){e.msg="invalid distance too far back",x.mode=Wi;break e}if(d>>>=w,f-=w,w=a-i,k>w){if(w=k-w,w>u&&x.sane){e.msg="invalid distance too far back",x.mode=Wi;break e}if(_=0,A=h,0===l){if(_+=c-w,w<y){y-=w;do{C[a++]=h[_++]}while(--w);_=a-k,A=C}}else if(l<w){if(_+=c+l-w,w-=l,w<y){y-=w;do{C[a++]=h[_++]}while(--w);if(_=0,l<y){w=l,y-=w;do{C[a++]=h[_++]}while(--w);_=a-k,A=C}}}else if(_+=l-w,w<y){y-=w;do{C[a++]=h[_++]}while(--w);_=a-k,A=C}for(;y>2;)C[a++]=A[_++],C[a++]=A[_++],C[a++]=A[_++],y-=3;y&&(C[a++]=A[_++],y>1&&(C[a++]=A[_++]))}else{_=a-k;do{C[a++]=C[_++],C[a++]=C[_++],C[a++]=C[_++],y-=3}while(y>2);y&&(C[a++]=C[_++],y>1&&(C[a++]=C[_++]))}break}if(64&w){e.msg="invalid distance code",x.mode=Wi;break e}b=p[(65535&b)+(d&(1<<w)-1)]}}break}}while(r<n&&a<s);y=f>>3,r-=y,f-=y<<3,d&=(1<<f)-1,e.next_in=r,e.next_out=a,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=a<s?s-a+257:257-(a-s),x.hold=d,x.bits=f};const Gi=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Qi=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Yi=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Xi=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var es=(e,t,r,n,a,i,s,o)=>{const c=o.bits;let u,l,h,d,f,m,p=0,g=0,v=0,b=0,w=0,y=0,k=0,_=0,A=0,S=0,C=null;const x=new Uint16Array(16),B=new Uint16Array(16);let E,I,P,N=null;for(p=0;p<=15;p++)x[p]=0;for(g=0;g<n;g++)x[t[r+g]]++;for(w=c,b=15;b>=1&&0===x[b];b--);if(w>b&&(w=b),0===b)return a[i++]=20971520,a[i++]=20971520,o.bits=1,0;for(v=1;v<b&&0===x[v];v++);for(w<v&&(w=v),_=1,p=1;p<=15;p++)if(_<<=1,_-=x[p],_<0)return-1;if(_>0&&(0===e||1!==b))return-1;for(B[1]=0,p=1;p<15;p++)B[p+1]=B[p]+x[p];for(g=0;g<n;g++)0!==t[r+g]&&(s[B[t[r+g]]++]=g);if(0===e?(C=N=s,m=20):1===e?(C=Gi,N=Qi,m=257):(C=Yi,N=Xi,m=0),S=0,g=0,p=v,f=i,y=w,k=0,h=-1,A=1<<w,d=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){E=p-k,s[g]+1<m?(I=0,P=s[g]):s[g]>=m?(I=N[s[g]-m],P=C[s[g]-m]):(I=96,P=0),u=1<<p-k,l=1<<y,v=l;do{l-=u,a[f+(S>>k)+l]=E<<24|I<<16|P}while(0!==l);for(u=1<<p-1;S&u;)u>>=1;if(0!==u?(S&=u-1,S+=u):S=0,g++,0===--x[p]){if(p===b)break;p=t[r+s[g]]}if(p>w&&(S&d)!==h){for(0===k&&(k=w),f+=v,y=p-k,_=1<<y;y+k<b&&(_-=x[y+k],!(_<=0));)y++,_<<=1;if(A+=1<<y,1===e&&A>852||2===e&&A>592)return 1;h=S&d,a[h]=w<<24|y<<16|f-i}}return 0!==S&&(a[f+S]=p-k<<24|64<<16),o.bits=w,0};const{Z_FINISH:ts,Z_BLOCK:rs,Z_TREES:ns,Z_OK:as,Z_STREAM_END:is,Z_NEED_DICT:ss,Z_STREAM_ERROR:os,Z_DATA_ERROR:cs,Z_MEM_ERROR:us,Z_BUF_ERROR:ls,Z_DEFLATED:hs}=Sa,ds=16180,fs=16190,ms=16191,ps=16192,gs=16194,vs=16199,bs=16200,ws=16206,ys=16209,ks=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function _s(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const As=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<ds||t.mode>16211?1:0},Ss=e=>{if(As(e))return os;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ds,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,as},Cs=e=>{if(As(e))return os;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ss(e)},xs=(e,t)=>{let r;if(As(e))return os;const n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?os:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,Cs(e))},Bs=(e,t)=>{if(!e)return os;const r=new _s;e.state=r,r.strm=e,r.window=null,r.mode=ds;const n=xs(e,t);return n!==as&&(e.state=null),n};let Es,Is,Ps=!0;const Ns=e=>{if(Ps){Es=new Int32Array(512),Is=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(es(1,e.lens,0,288,Es,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;es(2,e.lens,0,32,Is,0,e.work,{bits:5}),Ps=!1}e.lencode=Es,e.lenbits=9,e.distcode=Is,e.distbits=5},Os=(e,t,r,n)=>{let a;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>n&&(a=n),i.window.set(t.subarray(r-n,r-n+a),i.wnext),(n-=a)?(i.window.set(t.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0};var Ls=Cs,Us=Bs,js=(e,t)=>{let r,n,a,i,s,o,c,u,l,h,d,f,m,p,g,v,b,w,y,k,_,A,S=0;const C=new Uint8Array(4);let x,B;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(As(e)||!e.output||!e.input&&0!==e.avail_in)return os;r=e.state,r.mode===ms&&(r.mode=ps),s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,h=o,d=c,A=as;e:for(;;)switch(r.mode){case ds:if(0===r.wrap){r.mode=ps;break}for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(2&r.wrap&&35615===u){0===r.wbits&&(r.wbits=15),r.check=0,C[0]=255&u,C[1]=u>>>8&255,r.check=_a(r.check,C,2,0),u=0,l=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=ys;break}if((15&u)!==hs){e.msg="unknown compression method",r.mode=ys;break}if(u>>>=4,l-=4,_=8+(15&u),0===r.wbits&&(r.wbits=_),_>15||_>r.wbits){e.msg="invalid window size",r.mode=ys;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&u?16189:ms,u=0,l=0;break;case 16181:for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(r.flags=u,(255&r.flags)!==hs){e.msg="unknown compression method",r.mode=ys;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=ys;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,r.check=_a(r.check,C,2,0)),u=0,l=0,r.mode=16182;case 16182:for(;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,C[2]=u>>>16&255,C[3]=u>>>24&255,r.check=_a(r.check,C,4,0)),u=0,l=0,r.mode=16183;case 16183:for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,r.check=_a(r.check,C,2,0)),u=0,l=0,r.mode=16184;case 16184:if(1024&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,r.check=_a(r.check,C,2,0)),u=0,l=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(f=r.length,f>o&&(f=o),f&&(r.head&&(_=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+f),_)),512&r.flags&&4&r.wrap&&(r.check=_a(r.check,n,f,i)),o-=f,i+=f,r.length-=f),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===o)break e;f=0;do{_=n[i+f++],r.head&&_&&r.length<65536&&(r.head.name+=String.fromCharCode(_))}while(_&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=_a(r.check,n,f,i)),o-=f,i+=f,_)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===o)break e;f=0;do{_=n[i+f++],r.head&&_&&r.length<65536&&(r.head.comment+=String.fromCharCode(_))}while(_&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=_a(r.check,n,f,i)),o-=f,i+=f,_)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(4&r.wrap&&u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=ys;break}u=0,l=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=ms;break;case 16189:for(;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}e.adler=r.check=ks(u),u=0,l=0,r.mode=fs;case fs:if(0===r.havedict)return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=u,r.bits=l,ss;e.adler=r.check=1,r.mode=ms;case ms:if(t===rs||t===ns)break e;case ps:if(r.last){u>>>=7&l,l-=7&l,r.mode=ws;break}for(;l<3;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}switch(r.last=1&u,u>>>=1,l-=1,3&u){case 0:r.mode=16193;break;case 1:if(Ns(r),r.mode=vs,t===ns){u>>>=2,l-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=ys}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ys;break}if(r.length=65535&u,u=0,l=0,r.mode=gs,t===ns)break e;case gs:r.mode=16195;case 16195:if(f=r.length,f){if(f>o&&(f=o),f>c&&(f=c),0===f)break e;a.set(n.subarray(i,i+f),s),o-=f,i+=f,c-=f,s+=f,r.length-=f;break}r.mode=ms;break;case 16196:for(;l<14;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ys;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.lens[E[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[E[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,x={bits:r.lenbits},A=es(0,r.lens,0,19,r.lencode,0,r.work,x),r.lenbits=x.bits,A){e.msg="invalid code lengths set",r.mode=ys;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;S=r.lencode[u&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,b=65535&S,!(g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(b<16)u>>>=g,l-=g,r.lens[r.have++]=b;else{if(16===b){for(B=g+2;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(u>>>=g,l-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=ys;break}_=r.lens[r.have-1],f=3+(3&u),u>>>=2,l-=2}else if(17===b){for(B=g+3;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=g,l-=g,_=0,f=3+(7&u),u>>>=3,l-=3}else{for(B=g+7;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=g,l-=g,_=0,f=11+(127&u),u>>>=7,l-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ys;break}for(;f--;)r.lens[r.have++]=_}}if(r.mode===ys)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=ys;break}if(r.lenbits=9,x={bits:r.lenbits},A=es(1,r.lens,0,r.nlen,r.lencode,0,r.work,x),r.lenbits=x.bits,A){e.msg="invalid literal/lengths set",r.mode=ys;break}if(r.distbits=6,r.distcode=r.distdyn,x={bits:r.distbits},A=es(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,x),r.distbits=x.bits,A){e.msg="invalid distances set",r.mode=ys;break}if(r.mode=vs,t===ns)break e;case vs:r.mode=bs;case bs:if(o>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=u,r.bits=l,Zi(e,d),s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,r.mode===ms&&(r.back=-1);break}for(r.back=0;S=r.lencode[u&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,b=65535&S,!(g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(v&&!(240&v)){for(w=g,y=v,k=b;S=r.lencode[k+((u&(1<<w+y)-1)>>w)],g=S>>>24,v=S>>>16&255,b=65535&S,!(w+g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=w,l-=w,r.back+=w}if(u>>>=g,l-=g,r.back+=g,r.length=b,0===v){r.mode=16205;break}if(32&v){r.back=-1,r.mode=ms;break}if(64&v){e.msg="invalid literal/length code",r.mode=ys;break}r.extra=15&v,r.mode=16201;case 16201:if(r.extra){for(B=r.extra;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;S=r.distcode[u&(1<<r.distbits)-1],g=S>>>24,v=S>>>16&255,b=65535&S,!(g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(!(240&v)){for(w=g,y=v,k=b;S=r.distcode[k+((u&(1<<w+y)-1)>>w)],g=S>>>24,v=S>>>16&255,b=65535&S,!(w+g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=w,l-=w,r.back+=w}if(u>>>=g,l-=g,r.back+=g,64&v){e.msg="invalid distance code",r.mode=ys;break}r.offset=b,r.extra=15&v,r.mode=16203;case 16203:if(r.extra){for(B=r.extra;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ys;break}r.mode=16204;case 16204:if(0===c)break e;if(f=d-c,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ys;break}f>r.wnext?(f-=r.wnext,m=r.wsize-f):m=r.wnext-f,f>r.length&&(f=r.length),p=r.window}else p=a,m=s-r.offset,f=r.length;f>c&&(f=c),c-=f,r.length-=f;do{a[s++]=p[m++]}while(--f);0===r.length&&(r.mode=bs);break;case 16205:if(0===c)break e;a[s++]=r.length,c--,r.mode=bs;break;case ws:if(r.wrap){for(;l<32;){if(0===o)break e;o--,u|=n[i++]<<l,l+=8}if(d-=c,e.total_out+=d,r.total+=d,4&r.wrap&&d&&(e.adler=r.check=r.flags?_a(r.check,a,d,s-d):ya(r.check,a,d,s-d)),d=c,4&r.wrap&&(r.flags?u:ks(u))!==r.check){e.msg="incorrect data check",r.mode=ys;break}u=0,l=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(4&r.wrap&&u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=ys;break}u=0,l=0}r.mode=16208;case 16208:A=is;break e;case ys:A=cs;break e;case 16210:return us;default:return os}return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=u,r.bits=l,(r.wsize||d!==e.avail_out&&r.mode<ys&&(r.mode<ws||t!==ts))&&Os(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,r.total+=d,4&r.wrap&&d&&(e.adler=r.check=r.flags?_a(r.check,a,d,e.next_out-d):ya(r.check,a,d,e.next_out-d)),e.data_type=r.bits+(r.last?64:0)+(r.mode===ms?128:0)+(r.mode===vs||r.mode===gs?256:0),(0===h&&0===d||t===ts)&&A===as&&(A=ls),A},Ds=e=>{if(As(e))return os;let t=e.state;return t.window&&(t.window=null),e.state=null,as},Rs=(e,t)=>{if(As(e))return os;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,as):os},Vs=(e,t)=>{const r=t.length;let n,a,i;return As(e)?os:(n=e.state,0!==n.wrap&&n.mode!==fs?os:n.mode===fs&&(a=1,a=ya(a,t,r,0),a!==n.check)?cs:(i=Os(e,t,r,r),i?(n.mode=16210,us):(n.havedict=1,as)))},Hs=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ts=Object.prototype.toString,{Z_NO_FLUSH:$s,Z_FINISH:Ks,Z_OK:Fs,Z_STREAM_END:Ms,Z_NEED_DICT:Js,Z_STREAM_ERROR:zs,Z_DATA_ERROR:qs,Z_MEM_ERROR:Ws}=Sa;function Zs(e){this.options=Bi({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ui,this.strm.avail_out=0;let r=Us(this.strm,t.windowBits);if(r!==Fs)throw new Error(Aa[r]);if(this.header=new Hs,Rs(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ni(t.dictionary):"[object ArrayBuffer]"===Ts.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Vs(this.strm,t.dictionary),r!==Fs)))throw new Error(Aa[r])}function Gs(e,t){const r=new Zs(t);if(r.push(e),r.err)throw r.msg||Aa[r.err];return r.result}Zs.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let i,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Ks:$s,"[object ArrayBuffer]"===Ts.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),i=js(r,s),i===Js&&a&&(i=Vs(r,a),i===Fs?i=js(r,s):i===qs&&(i=Js));r.avail_in>0&&i===Ms&&r.state.wrap>0&&0!==e[r.next_in];)Ls(r),i=js(r,s);switch(i){case zs:case qs:case Js:case Ws:return this.onEnd(i),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(0===r.avail_out||i===Ms))if("string"===this.options.to){let e=Li(r.output,r.next_out),t=r.next_out-e,a=Oi(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(a)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==Fs||0!==o){if(i===Ms)return i=Ds(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Zs.prototype.onData=function(e){this.chunks.push(e)},Zs.prototype.onEnd=function(e){e===Fs&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ei(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Qs={Inflate:Zs,inflate:Gs,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Gs(e,t)},ungzip:Gs,constants:Sa};const{Deflate:Ys,deflate:Xs,deflateRaw:eo,gzip:to}=qi,{Inflate:ro,inflate:no,inflateRaw:ao,ungzip:io}=Qs;var so=io;function oo(e){return oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oo(e)}function co(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,s,o=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return o}}(e,t)||go(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uo(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(r,n,a,i){var c=n&&n.prototype instanceof o?n:o,u=Object.create(c.prototype);return lo(u,"_invoke",function(r,n,a){var i,o,c,u=0,l=a||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return i=t,o=0,c=e,d.n=r,s}};function f(r,n){for(o=r,c=n,t=0;!h&&u&&!a&&t<l.length;t++){var a,i=l[t],f=d.p,m=i[2];r>3?(a=m===n)&&(c=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=f&&((a=r<2&&f<i[1])?(o=0,d.v=n,d.n=i[1]):f<m&&(a=r<3||i[0]>n||n>m)&&(i[4]=r,i[5]=n,d.n=m,o=0))}if(a||r>1)return s;throw h=!0,n}return function(a,l,m){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,m),o=l,c=m;(t=o<2?e:c)||!h;){i||(o?o<3?(o>1&&(d.n=-1),f(o,c)):d.n=c:d.v=c);try{if(u=2,i){if(o||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=e}else if((t=(h=d.n<0)?c:r.call(n,d))!==s)break}catch(t){i=e,o=1,c=t}finally{u=1}}return{value:t,done:h}}}(r,a,i),!0),u}var s={};function o(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(lo(t={},n,function(){return this}),t),h=u.prototype=o.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,lo(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,lo(h,"constructor",u),lo(u,"constructor",c),c.displayName="GeneratorFunction",lo(u,a,"GeneratorFunction"),lo(h),lo(h,a,"Generator"),lo(h,n,function(){return this}),lo(h,"toString",function(){return"[object Generator]"}),(uo=function(){return{w:i,m:d}})()}function lo(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}lo=function(e,t,r,n){function i(t,r){lo(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},lo(e,t,r,n)}function ho(e,t,r,n,a,i,s){try{var o=e[i](s),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function fo(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function s(e){ho(i,n,a,s,o,"next",e)}function o(e){ho(i,n,a,s,o,"throw",e)}s(void 0)})}}function mo(e){return function(e){if(Array.isArray(e))return vo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||go(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function po(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=go(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw i}}}}function go(e,t){if(e){if("string"==typeof e)return vo(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vo(e,t):void 0}}function vo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var bo="prod",wo=function(){var e=Date.now(),t=new Date(e),r=t.toLocaleDateString("en-US"),n=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return"".concat(r," ").concat(n)},yo=function(e){"auto"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.setAttribute("data-bs-theme",e)};yo("light");var ko=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.querySelector("#bd-theme");if(r){var n=document.querySelector("#bd-theme-text"),a=document.querySelector(".theme-icon-active use"),i=document.querySelector('[data-bs-theme-value="'.concat(e,'"]')),s=i.querySelector("svg use").getAttribute("href");document.querySelectorAll("[data-bs-theme-value]").forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-pressed","false")}),i.classList.add("active"),i.setAttribute("aria-pressed","true"),a.setAttribute("href",s);var o="".concat(n.textContent," (").concat(i.dataset.bsThemeValue,")");r.setAttribute("aria-label",o),t&&r.focus()}};function _o(){ko("light"),document.querySelectorAll("[data-bs-theme-value]").forEach(function(e){e.addEventListener("click",function(){var t=e.getAttribute("data-bs-theme-value");localStorage.setItem("theme",t),yo(t),ko(t,!0)})})}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){"light"===storedTheme&&"dark"===storedTheme||yo("light")}),window.addEventListener("DOMContentLoaded",function(){_o()});var Ao,So,Co=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/javascript";return new Promise(function(n,a){try{var i=document.createElement("script");i.type=r,i.async=t,i.src=e,i.addEventListener("load",function(e){n({status:!0})}),i.addEventListener("error",function(e){n({status:!1,message:"Failed to load the script {FILE_URL}"})}),document.body.appendChild(i)}catch(e){n({status:!1,message:"util.js > loadScript> err: {JSON.stringify(error)}"})}})},xo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise(function(t){return setTimeout(t,e)})},Bo=function(e,t){if(t){var r=t,n=document.createElement("canvas");n.width=e,n.height=e/(r.width||r.videoWidth)*(r.height||r.videoHeight);var a=n.getContext("2d",{willReadFrequently:!0});a.drawImage(t,0,0,a.canvas.width,a.canvas.height);var i=a.canvas.toDataURL("image/jpeg");return n=null,a=null,i}},Eo=function(e,t){var r;if(t[2]&&t[3]){var n=e,a=t,i=n.videoWidth,s=n.videoHeight,o=document.createElement("canvas");o.width=i,o.height=s;var c=o.getContext("2d",{willReadFrequently:!0});c.drawImage(n,0,0);var u=(r=c).getImageData.apply(r,mo(a));o.width=a[2],o.height=a[3],c.putImageData(u,0,0);var l=c.canvas.toDataURL("image/jpeg");return o=null,c=null,l}},Io=function(e){var t=new Date(e),r=Date.now()-t;return Math.floor(r/6e4)},Po=function(e,t){var r=t.bbox;Uo(e,t),No(r[0],r[1],e),No(r[0]+r[2],r[1],e),No(r[0]+r[2],r[1]+r[3],e),No(r[0],r[1]+r[3],e)},No=function(e,t,r){r.fillStyle="lightgreen",r.globalAlpha=.5,r.strokeStyle="rgba(0, 128, 0, 1)",r.lineWidth=1,r.beginPath(),r.arc(e,t,6,0,2*Math.PI),r.fill(),r.closePath()},Oo=function(e,t,r){r.bbox,r.img;var n=Lo.apply(void 0,[e,t].concat(mo(r.scissorPos1.map(function(e){return e+2*r.radius})),[2*r.radius]))||Lo.apply(void 0,[e,t].concat(mo(r.scissorPos2.map(function(e){return e+2*r.radius})),[2*r.radius]))||Lo.apply(void 0,[e,t].concat(mo(r.scissorPos3.map(function(e){return e+2*r.radius})),[2*r.radius]))||Lo.apply(void 0,[e,t].concat(mo(r.scissorPos4.map(function(e){return e+2*r.radius})),[2*r.radius]));return!!n},Lo=function(e,t,r,n,a){return Math.pow(e-r,2)+Math.pow(t-n,2)<Math.pow(a,2)},Uo=function(e,t){var r=t.bbox,n=t.img;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="lightgreen",e.globalAlpha=.2,e.strokeStyle="rgba(0, 128, 0, 1)",e.lineWidth=1,e.roundRect.apply(e,mo(r).concat([3])),e.stroke(),e.fillRect.apply(e,mo(r)),Math.abs(r[2])>4*t.radius&&Math.abs(r[3])>4*t.radius&&(t.scissorPos1=[r[0]-n.width/2+r[2]/2,r[1]-n.height/2],t.scissorPos2=[r[0]-n.width/2+r[2],r[1]+r[3]/2-n.height/2],t.scissorPos3=[r[0]-n.width/2+r[2]/2,r[1]+r[3]-n.height/2],t.scissorPos4=[r[0]-n.width/2,r[1]+r[3]/2-n.height/2],e.drawImage.apply(e,[n].concat(mo(t.scissorPos1),[n.width,n.height])),e.drawImage.apply(e,[n].concat(mo(t.scissorPos2),[n.width,n.height])),e.drawImage.apply(e,[n].concat(mo(t.scissorPos3),[n.width,n.height])),e.drawImage.apply(e,[n].concat(mo(t.scissorPos4),[n.width,n.height])))},jo=function(){var e=fo(uo().m(function e(t,r,n,a){var i,s,o,c,u,l;return uo().w(function(e){for(;;)switch(e.n){case 0:return s=n,o=a,c=(i=t).getContext("2d"),u=function(){return new Promise(function(e,t){var r=new Image,n=new Image;r.src="img/scissors.svg",r.width=r.height=24,n.src="img/x-square.svg",n.width=n.height=24;var a={viewportRatio:1,radius:6,bbox:[0,0,0,0],scissorPos1:[0,0],scissorPos2:[0,0],scissorPos3:[0,0],scissorPos4:[0,0],img:r,reset_img:n,isDragging:!1,isScaling:!1,offsetX:0,offsetY:0,reset:function(){a.bbox=[0,0,0,0],a.isDragging=!1,a.isScaling=!1,a.offsetX=0,a.offsetY=0,a.scissorPos1=[0,0],a.scissorPos2=[0,0],a.scissorPos3=[0,0],a.scissorPos4=[0,0],c.clearRect(0,0,c.canvas.width,c.canvas.height)},refactor:function(e,t,r){return!(!a.offsetX||!a.offsetY)&&(a.bbox[0]=a.bbox[2]>0?Math.max(0,a.bbox[0]):a.bbox[0]+a.bbox[2],a.bbox[1]=a.bbox[3]>0?Math.max(0,a.bbox[1]):a.bbox[1]+a.bbox[3],a.bbox[2]=Math.min(e,Math.abs(a.bbox[2])),a.bbox[3]=Math.min(t,Math.abs(a.bbox[3])),a.viewportRatio=r,a.bbox.slice().map(function(e){return e*a.viewportRatio}))}};r.onload=function(){a.img=r,e(a)}})},e.n=1,u();case 1:l=e.v,i.addEventListener("mousedown",function(e){t.width=r.offsetWidth,t.height=r.offsetHeight;var n,a,s,c=e.clientX-i.getBoundingClientRect().left,u=e.clientY-i.getBoundingClientRect().top;if(l.offsetX=c-l.bbox[0],l.offsetY=u-l.bbox[1],Lo(n=c,a=u,(s=l).bbox[0],s.bbox[1],s.radius)?(s.bbox[0]=s.bbox[0]+s.bbox[2],s.bbox[1]=s.bbox[1]+s.bbox[3],1):Lo(n,a,s.bbox[0]+s.bbox[2],s.bbox[1],s.radius)?(s.bbox[1]=s.bbox[1]+s.bbox[3],1):Lo(n,a,s.bbox[0],s.bbox[1]+s.bbox[3],s.radius)?(s.bbox[0]=s.bbox[0]+s.bbox[2],1):Lo(n,a,s.bbox[0]+s.bbox[2],s.bbox[1]+s.bbox[3],s.radius))return hc("inside a corner; update original"),void(l.isScaling=!0);if(Oo(c,u,l)){hc("inside a scissor");var h=l.refactor(r.offsetWidth,r.offsetHeight,r.videoWidth/r.offsetWidth);return clearTimeout(So),void(So=setTimeout(function(){o&&o(h),l.reset()},100))}c>=l.bbox[0]&&c<l.bbox[0]+l.bbox[2]&&u>=l.bbox[1]&&u<l.bbox[1]+l.bbox[3]||c>=l.bbox[0]+l.bbox[2]&&c<l.bbox[0]&&u>=l.bbox[1]+l.bbox[3]&&u<l.bbox[1]||c>=l.bbox[0]&&c<l.bbox[0]+l.bbox[2]&&u>=l.bbox[1]+l.bbox[3]&&u<l.bbox[1]||c>=l.bbox[0]+l.bbox[2]&&c<l.bbox[0]&&u>=l.bbox[1]&&u<l.bbox[1]+l.bbox[3]?l.isDragging=!0:c>=0&&c<=i.width&&u>=0&&u<=i.height&&(l.reset(),l.isDragging=!0,l.bbox[0]=c,l.bbox[1]=u)}),document.addEventListener("mousemove",function(e){var t=e.clientX-i.getBoundingClientRect().left,r=e.clientY-i.getBoundingClientRect().top;if(Oo(t,r,l)?i.style.cursor="pointer":i.style.cursor="auto",l.isScaling)return l.bbox[2]=t-l.bbox[0],l.bbox[3]=r-l.bbox[1],void Po(c,l);if(l.isDragging){if(0!=l.offsetX&&0!=l.offsetY)return l.bbox[0]=t-l.offsetX,l.bbox[1]=r-l.offsetY,void Po(c,l);l.bbox[2]=t-l.bbox[0],l.bbox[3]=r-l.bbox[1],Po(c,l)}}),document.addEventListener("mouseup",function(e){if(t.width=r.offsetWidth,t.height=r.offsetHeight,l.isScaling&&(l.isScaling=!1,l.offsetX&&l.offsetY))hc("scaling completed. rectangle: ".concat(JSON.stringify(l)));else if(l.isDragging){l.isDragging=!1,hc("rectangle ".concat(JSON.stringify(l)));var n=l.refactor(r.offsetWidth,r.offsetHeight,r.videoWidth/r.offsetWidth);n&&(clearTimeout(Ao),Ao=setTimeout(function(){s&&s(n)},100)),Po(c,l)}}),Uo(c,l);case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),Do=function(e){var t=new Date(1e3*e);return{year:t.getFullYear(),month:String(t.getMonth()+1).padStart(2,"0"),day:String(t.getDate()).padStart(2,"0"),hours:String(t.getHours()).padStart(2,"0"),minutes:String(t.getMinutes()).padStart(2,"0"),seconds:String(t.getSeconds()).padStart(2,"0")}},Ro=function(e){var t=Do(e),r=t.year,n=t.month,a=t.day,i=t.hours,s=t.minutes,o=t.seconds;return"".concat(n,"-").concat(a," '").concat(r-2e3," ").concat(i,":").concat(s,":").concat(o)},Vo=function(e){var t=Do(e),r=t.year,n=t.month,a=t.day;return"".concat(n,"-").concat(a," '").concat(r-2e3)},Ho=function(e,t){var r=1e3*e,n=1e3*t,a=Date.now();return a>=r&&a<=n},To=function(e,t){return Object.keys(e).find(function(r){return e[r]===t})},$o=function(e){var t,r=[],n=po(e.split("/"));try{for(n.s();!(t=n.n()).done;){var a=t.value;""!==a&&"."!==a&&(".."===a?r.length>0&&r.pop():r.push(a))}}catch(e){n.e(e)}finally{n.f()}return"/"+r.join("/")},Ko=function(e){return(e=(e=e.replace(/\//g,"_").replace(/ /g,"_")).replace(/[^a-zA-Z0-9_]+/g,"")).toLowerCase()},Fo=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t},Mo=function(e,t){var r,n=e.map(Number),a=new Set(mo(Array(t).keys())),i=new Set(n),s=[],o=po(a);try{for(o.s();!(r=o.n()).done;){var c=r.value;i.has(c)||s.push(c)}}catch(e){o.e(e)}finally{o.f()}return s},Jo="",zo="",qo={},Wo={},Zo={tenant:{apiKeys:{},subscriptions:{},subject:{},cred:{},ice_offers:{},processors:[],notifications:[],file_map:{},file_info_map:{sum:{},dir:{cert:"/inori/cert",pkey:"/inori/pvtKey",bridge_cert:"/inori/cert_bridge",bridge_pkey:"/inori/pvtKey_bridge",admin_cert:"/inori/cert_admin",admin_pkey:"/inori/pvtKey_admin",tmp_cert:"/inori/tmp_cert",tmp_pkey:"/inori/tmp_pvtKey"},desc:{cert:"tenant's license",pkey:"tenant's private key",bridge_cert:"bridge license",bridge_pkey:"bridge private key",admin_cert:"admin's license",admin_pkey:"admin's private key",tmp_cert:"temporary license",tmp_pkey:"temporary private key"}}},leads:{list:[]},channels:{list:[]},ice_offers:{},ice_services:{},remote_processor_list:{list:[]},tenants:{list:[]},subjects:{list:[]},subject_reqs:{},message_infos:{},directory_list:{root:"",files:[]},mini_files:{path:{}},content:{},geo_locations:{list:[]},file_chunks:{}},Go={},Qo=!1,Yo=Jo,Xo={},ec=new Map,tc=!1;if("undefined"==typeof Worker)throw"worker is not avaialble in this browser";var rc,nc,ac,ic,sc,oc,cc,uc,lc=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];!function(e,t,r){var n,a=po(r);try{for(a.s();!(n=a.n()).done;){var i,s=n.value;if(Array.isArray(s)){var o,c=[],u=po(s);try{for(u.s();!(o=u.n()).done;){var l=o.value;Array.isArray(l)?c.push.apply(c,mo(l)):c.push(l)}}catch(e){u.e(e)}finally{u.f()}(i=console).log.apply(i,["[".concat(e,": ").concat(wo(),"]")].concat(c))}}}catch(e){a.e(e)}finally{a.f()}}(bo,0,t)},hc=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qo.postMessage({label:"local:system:event:<string>",data:t})},dc=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qo.postMessage({label:"local:system:event:<string>",data:"exception: ".concat(t.join(" "))})},fc=function(e){return new Promise(function(t){var r=!1;xo(5e3).then(function(){r||t(!1)});var n="tenant:data:chunk:pub_key:signed:<bytes>";window.addEventListener(n,function(){var a=fo(uo().m(function a(i){return uo().w(function(a){for(;;)switch(a.n){case 0:if(r=!0,Zo.tenant.subject.serialnumber.val.toLowerCase()!=e.serialNumber.toLowerCase()){a.n=2;break}return a.n=1,Jc(i.detail.content);case 1:if(a.v){a.n=2;break}return dc("received ".concat(n,"; invalid cert")),a.a(2,t(!1));case 2:t(!0);case 3:return a.a(2)}},a)}));return function(e){return a.apply(this,arguments)}}(),{once:!0}),n="tenant:data:x509:content:received:<subject>",window.addEventListener(n,function(){var e=fo(uo().m(function e(n){return uo().w(function(e){for(;;)switch(e.n){case 0:r=!0,t(!0);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),gc({to:Jo,label:"tenant:data:x509:content:<subject>",data:e})})},mc=function(){var e=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lc();case 1:return t=e.v,qo.postMessage({from:Yo,to:Yo,label:"local:register:<bytes>",data:t.publicKey.asBuffer()}),e.a(2,new Promise(function(e){var t=!1,r="tenant:data:chunk:pub_key:signed:<bytes>";window.addEventListener(r,function(){var n=fo(uo().m(function n(a){return uo().w(function(n){for(;;)switch(n.n){case 0:return t=!0,n.n=1,Jc(a.detail.content);case 1:if(n.v){n.n=2;break}return dc("received ".concat(r,"; invalid cert")),n.a(2,e(!1));case 2:e(!0);case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){t||e(!1)})}))}},e)}));return function(){return e.apply(this,arguments)}}(),pc=function(){var e=fo(uo().m(function e(){var t,r,n,a,i,s,o,c,u;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!Qo){e.n=1;break}return e.a(2);case 1:return e.n=2,Pc();case 2:if(!(t=e.v)){e.n=4;break}if(r=t.asCert(),!(n=Rc(r)).serialnumber||!n.serialnumber.val){e.n=4;break}return Zo.tenant.subject=n,e.n=3,Yc(Yo);case 3:return s=e.v,qo.postMessage({from:Yo,to:Yo,label:"local:authenticate:<bytes>",data:{id:n.serialnumber.val,metadata:s}}),o=new Date,((null===(a=n.notBefore)||void 0===a||null===(a=a.val)||void 0===a?void 0:a.value)>o||(null===(i=n.notAfter)||void 0===i||null===(i=i.val)||void 0===i?void 0:i.value)<=o)&&(gc({label:"tenant:data:chunk:pub_key:signed:req",data:{}}),c="tenant:data:chunk:pub_key:signed:<bytes>",window.addEventListener(c,function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Jc(t.detail.content);case 1:e.v||dc("received ".concat(c,"; invalid cert"));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0})),e.a(2,new Promise(function(e){var t=!1;window.addEventListener("admin:data:tenant:content:received:<tenant>",function(r){Au().filter(function(e){return e.isLocalVideoStream||e.isLocalScreenStream}).forEach(function(e){e.self_register()}),Zo.tenant.apiKeys.goog=r.detail.content.metadata,e(Zo.tenant.subject),t=!0,Qo=!0},{once:!0}),xo(5e3).then(function(){t||e(!1)})}));case 4:e.n=6;break;case 5:return e.p=5,u=e.v,dc(u),e.a(2,Promise.resolve(!1));case 6:return e.a(2)}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}(),gc=function(e){e.label_2_forward=e.label,e.label="local:bridge:send",e.from=e.from||Yo,e.to=e.to||Jo,qo.postMessage(e)},vc=function(){var e=fo(uo().m(function e(){var t,r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.ipify.org?format=json");case 1:return t=e.v,e.n=2,t.json();case 2:r=e.v,hc("geolocation updated for ".concat(r.ip)),gc({label:"tenant:data:geo:content:<geo_location>",data:{query:r.ip}});case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),bc=function(e){e.label_2_forward=e.label,e.label="local:peer:send",e.from=Yo,qo.postMessage(e)},wc=function(e){e.label="local:peer:rcvd",e.to=Yo,qo.postMessage(e)},yc=function(e,t){var r=kc(e);return"-----BEGIN ".concat(t,"-----\n").concat(Sc(r,64).join("\n"),"\n-----END ").concat(t,"-----\n")},kc=function(e){for(var t=new Uint8Array(e),r="",n=0;n<t.byteLength;n++)r+=String.fromCharCode(t[n]);return window.btoa(r)},_c=function(e,t){for(var r="-----BEGIN ".concat(t,"-----\n"),n="\n-----END ".concat(t,"-----\n"),a=e.substring(r.length,e.length-n.length),i=atob(a),s=i.length,o=new ArrayBuffer(s),c=new Uint8Array(o),u=0;u<s;u++)c[u]=i.charCodeAt(u);return o},Ac=function(e){var t=Array.from(new Uint8Array(e)).map(function(e){return e.toString(16).padStart(2,"0")});return t.join("")},Sc=function(e,t){for(var r=[],n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r},Cc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,crypto.subtle.digest("SHA-256",t);case 1:return r=e.v,e.a(2,Ac(r))}},e)}));return function(t){return e.apply(this,arguments)}}(),xc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Uu(t,"application/octet-stream");case 1:if((r=e.v)&&!((null==r?void 0:r.byteLength)<1)){e.n=2;break}return e.a(2,null);case 2:return e.a(2,{sum:function(){var e=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Cc(r);case 1:return e.a(2,e.v)}},e)}));return function(){return e.apply(this,arguments)}}()})}},e)}));return function(t){return e.apply(this,arguments)}}(),Bc=function(){var e=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,xc(t);case 1:if(r=e.v){e.n=2;break}return e.a(2,"");case 2:return e.n=3,r.sum();case 3:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),e.n=1,t(Zo.tenant.file_info_map.dir.cert);case 1:return Zo.tenant.file_info_map.sum.cert=e.v,e.n=2,t(Zo.tenant.file_info_map.dir.pkey);case 2:return Zo.tenant.file_info_map.sum.pkey=e.v,e.n=3,t(Zo.tenant.file_info_map.dir.bridge_cert);case 3:return Zo.tenant.file_info_map.sum.bridge_cert=e.v,e.n=4,t(Zo.tenant.file_info_map.dir.bridge_pkey);case 4:return Zo.tenant.file_info_map.sum.bridge_pkey=e.v,e.n=5,t(Zo.tenant.file_info_map.dir.admin_cert);case 5:return Zo.tenant.file_info_map.sum.admin_cert=e.v,e.n=6,t(Zo.tenant.file_info_map.dir.admin_pkey);case 6:Zo.tenant.file_info_map.sum.admin_pkey=e.v;case 7:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ec=function(){return Zo.subjects.list=Zo.subjects.list.filter(function(e){return e}),Zo.subjects.list},Ic=function(e){var t=Zo.subjects.list.find(function(t){return t.tenantId==e.tenantId});return!!t&&(Zo.subject_reqs[t.tenantId]?(Zo.subject_reqs[t.tenantId].push(e),!0):(Zo.subject_reqs[t.tenantId]=[e],!0))},Pc=function(){var e=fo(uo().m(function e(){var t,r,n=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"/inori/cert",e.n=1,Uu(t,"application/octet-stream");case 1:if((r=e.v)&&!((null==r?void 0:r.byteLength)<1)){e.n=2;break}return e.a(2,null);case 2:return e.a(2,Hc(r))}},e)}));return function(){return e.apply(this,arguments)}}(),Nc=function(){var e=fo(uo().m(function e(){var t,r,n=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"/inori/pvtKey",e.n=1,Uu(t,"application/octet-stream");case 1:if(r=e.v){e.n=2;break}return e.a(2,!1);case 2:return e.a(2,Tc(r))}},e)}));return function(){return e.apply(this,arguments)}}(),Oc=function(){var e=fo(uo().m(function e(){var t,r,n=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"/inori/pubKey",e.n=1,Uu(t,"application/octet-stream");case 1:if(r=e.v){e.n=2;break}return e.a(2,!1);case 2:return e.a(2,$c(r))}},e)}));return function(){return e.apply(this,arguments)}}(),Lc=function(){var e=fo(uo().m(function e(){var t,r,n,a,i,s,o,c,u=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:"/inori/pvtKey",r=u.length>1&&void 0!==u[1]?u[1]:"/inori/pubKey",e.n=1,Nc(t);case 1:return n=e.v,e.n=2,Oc(r);case 2:if(a=e.v,n&&a){e.n=8;break}return e.n=3,Uc();case 3:return i=e.v,s=i.publicKey,o=i.privateKey,e.n=4,Ku(o,t);case 4:return e.n=5,Ku(s,r);case 5:return e.n=6,Nc(t);case 6:return n=e.v,e.n=7,Oc(r);case 7:a=e.v;case 8:return c={publicKey:a,privateKey:n},e.a(2,c)}},e)}));return function(){return e.apply(this,arguments)}}(),Uc=function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]);case 1:return t=e.v,e.n=2,window.crypto.subtle.exportKey("spki",t.publicKey);case 2:return r=e.v,e.n=3,window.crypto.subtle.exportKey("pkcs8",t.privateKey);case 3:return n=e.v,e.a(2,{publicKey:r,privateKey:n})}},e)}));return function(){return e.apply(this,arguments)}}(),jc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.importKey("spki",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);case 1:return r=e.v,e.a(2,r)}},e)}));return function(t){return e.apply(this,arguments)}}(),Dc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.importKey("pkcs8",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]);case 1:return r=e.v,e.a(2,r)}},e)}));return function(t){return e.apply(this,arguments)}}(),Rc=function(e){var t={},r=el.getX509Sbj();e.subject.typesAndValues.forEach(function(e){var n=r[e.type];n&&3==n.length&&(t[n[0].toLowerCase()]={val:e.value.valueBlock.value,desc:n[1],proto:n[2]})});var n="notBefore",a="notAfter";return t[n]={desc:"Expire Before",val:e[n]},t[a]={desc:"Expire After",val:e[a]},t},Vc=function(e){var t=Rt(e);return new Tn({schema:t.result})},Hc=function(e){var t={asCert:function(){return Vc(e)},asString:function(){return yc(e,"CERTIFICATE")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(e){var r=t.asString(),n=new Blob([r],{type:"application/octet-stream"}),a=document.createElement("a"),i=URL.createObjectURL(n);a.href=i,a.download="".concat(e||Yo,".cer"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}};return t},Tc=function(e){var t,r={asKey:(t=fo(uo().m(function t(){return uo().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Dc(e);case 1:return t.a(2,t.v)}},t)})),function(){return t.apply(this,arguments)}),asString:function(){return yc(e,"PRIVATE KEY")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=r.asString(),t=new Blob([e],{type:"application/octet-stream"}),n=document.createElement("a"),a=URL.createObjectURL(t);n.href=a,n.download="".concat(Yo,".key"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}};return r},$c=function(e){var t,r={asKey:(t=fo(uo().m(function t(){return uo().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,jc(e);case 1:return t.a(2,t.v)}},t)})),function(){return t.apply(this,arguments)}),asString:function(){return yc(e,"PUBLIC KEY")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=r.asString(),t=new Blob([e],{type:"application/octet-stream"}),n=document.createElement("a"),a=URL.createObjectURL(t);n.href=a,n.download="".concat(Yo,".pub"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}};return r},Kc=function(e){var t=_c(e,"CERTIFICATE");return Hc(t)},Fc=function(e){var t=_c(e,"PRIVATE KEY");return Tc(t)},Mc=function(e){var t=_c(e,"PUBLIC KEY");return $c(t)},Jc=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s,o;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,zo){e.n=1;break}throw"invalid SYS_CERT";case 1:return e.n=2,Vc(t);case 2:return r=e.v,e.n=3,Zc(zo,r);case 3:if((n=e.v).certIssuer,n.issuerSubject,a=n.isValidIssuer,i=n.signatureVerified,a&&i){e.n=4;break}return e.a(2,!1);case 4:return e.n=5,Ku(t.buffer,"/inori/cert");case 5:if(!(s=Rc(r)).tid||!s.tid.val){e.n=6;break}return Zo.tenant.subject=s,e.a(2,!0);case 6:return e.a(2,!1);case 7:return e.p=7,o=e.v,dc("_update_cert > err: ".concat(o)),e.a(2,!1)}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),zc=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,zo){e.n=1;break}throw"invalid SYS_CERT";case 1:return e.n=2,Vc(t);case 2:return r=e.v,e.n=3,Zc(zo,r);case 3:if((n=e.v).certIssuer,n.issuerSubject,a=n.isValidIssuer,i=n.signatureVerified,a&&i){e.n=4;break}return e.a(2,!1);case 4:return e.n=5,Ku(t.buffer,Zo.tenant.file_info_map.dir.bridge_cert);case 5:return e.a(2,r);case 6:return e.p=6,s=e.v,dc("_add_bridge_cert > err: ".concat(s)),e.a(2,!1)}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),qc=function(){var e=fo(uo().m(function e(t,r){var n,a,i,s,o;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Vc(t);case 1:return n=e.v,e.n=2,Zc(r,n);case 2:if((a=e.v).certIssuer,a.issuerSubject,i=a.isValidIssuer,s=a.signatureVerified,i&&s){e.n=3;break}return e.a(2,!1);case 3:return e.n=4,Ku(t.buffer,"/inori/cert_admin");case 4:return e.a(2,n);case 5:return e.p=5,o=e.v,dc("_add_admin_cert > err: ".concat(o)),e.a(2,!1)}},e,null,[[0,5]])}));return function(t,r){return e.apply(this,arguments)}}(),Wc=function(){var e=fo(uo().m(function e(t,r,n){var a,i,s,o,c,u,l;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pc();case 1:return a=e.v,e.n=2,null==a?void 0:a.asCert();case 2:return i=e.v,e.n=3,Vc(t);case 3:if(s=e.v,!i){e.n=5;break}return e.n=4,Zc(s,i);case 4:if((o=e.v).certIssuer,o.issuerSubject,c=o.isValidIssuer,u=o.signatureVerified,c&&u){e.n=5;break}return e.a(2,!1);case 5:return zo=s,Jo=n.toLowerCase(),Yo=r.toLowerCase(),e.n=6,Cc(t);case 6:return Zo.tenant.file_info_map.sum.ca_cert=e.v,e.a(2,!0);case 7:return e.p=7,l=e.v,dc("_update_root_cert > err: ".concat(l)),e.a(2,!1)}},e,null,[[0,7]])}));return function(t,r,n){return e.apply(this,arguments)}}(),Zc=function(){var e=fo(uo().m(function e(t,r){var n,a,i,s,o;return uo().w(function(e){for(;;)switch(e.n){case 0:if(n=r.issuer.typesAndValues.map(function(e){return"".concat(e.type,": ").concat(e.value.valueBlock.value)}).join("\n"),a=t.subject.typesAndValues.map(function(e){return"".concat(e.type,": ").concat(e.value.valueBlock.value)}).join("\n"),i=r.issuer.isEqual(t.subject),s=nn()){e.n=1;break}throw new Error("No WebCrypto extension found");case 1:return e.n=2,t.getPublicKey();case 2:return e.v,e.n=3,r.verify(t,s);case 3:return o=e.v,e.a(2,{certIssuer:n,issuerSubject:a,isValidIssuer:i,signatureVerified:o})}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Gc=function(e,t){var r=function(e){var t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!1),t},n=r(e.byteLength),a=r(t.byteLength),i=n.byteLength+e.byteLength+a.byteLength+t.byteLength,s=new ArrayBuffer(i),o=new Uint8Array(s),c=0;return o.set(new Uint8Array(n),c),c+=n.byteLength,o.set(new Uint8Array(e),c),c+=e.byteLength,o.set(new Uint8Array(a),c),c+=a.byteLength,o.set(new Uint8Array(t),c),s},Qc=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s,o,c;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lc();case 1:return r=e.v,e.n=2,r.privateKey.asKey();case 2:if(n=e.v){e.n=3;break}return e.a(2,null);case 3:return a=new TextEncoder,i=a.encode(t),e.n=4,crypto.subtle.digest("SHA-256",i);case 4:return s=e.v,e.n=5,crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},n,s);case 5:return o=e.v,c=Gc(o,s),e.a(2,{signature:o,hash:s,joined:c})}},e)}));return function(t){return e.apply(this,arguments)}}(),Yc=function(){var e=fo(uo().m(function e(t){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Qc(Yo);case 1:return(r=e.v).signature,r.hash,n=r.joined,e.a(2,Ac(n))}},e)}));return function(t){return e.apply(this,arguments)}}(),Xc=function(){var e=fo(uo().m(function e(){var t,r,n,a,i,s;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=Zo.tenant.file_info_map.dir,e.n=1,Lc(t.admin_pkey,t.admin_cert);case 1:return r=e.v,n=r.publicKey,r.privateKey,a=new Promise(function(e){window.addEventListener("tenant:data:chunk:pub_key:admin:signed:<bytes>",function(){var t=fo(uo().m(function t(r){return uo().w(function(t){for(;;)switch(t.n){case 0:e(r.detail.content);case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),{once:!0})}),i=new Promise(function(e){window.addEventListener("tenant:data:chunk:pvt_key:bridge:<bytes>",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,Dc(n.detail.content);case 1:return r.n=2,Ku(n.detail.content,t.bridge_pkey);case 2:e(!0);case 3:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0})}),s=new Promise(function(e){var t="tenant:data:chunk:pub_key:bridge:signed:<bytes>";window.addEventListener(t,function(){var r=fo(uo().m(function r(n){var a;return uo().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,zc(n.detail.content);case 1:if(a=r.v){r.n=2;break}return dc("received ".concat(t,"; invalid cert")),r.a(2,e(!1));case 2:e(a);case 3:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0})}),gc({label:"tenant:data:chunk:pub_key:admin:<bytes>",data:n.asBuffer()}),e.a(2,{admCertPms:a,bridgePkeyPms:i,bridgeCertPms:s})}},e)}));return function(){return e.apply(this,arguments)}}(),eu=function(){var e=!1;return new Promise(function(){var t=fo(uo().m(function t(r){var n,a,i,s,o,c,u;return uo().w(function(t){for(;;)switch(t.n){case 0:return xo(5e3).then(function(){e||r(!1)}),t.n=1,Xc();case 1:return n=t.v,a=n.admCertPms,i=n.bridgePkeyPms,s=n.bridgeCertPms,t.n=2,a;case 2:return o=t.v,t.n=3,i;case 3:return c=t.v,t.n=4,s;case 4:return u=t.v,t.n=5,qc(o,u);case 5:if(t.v){t.n=6;break}return dc("_bootstrap_bridge_keypairs > _upd_admin_cert > invalid cert"),t.a(2,r(!1));case 6:return t.n=7,Bc();case 7:r(o&&c&&u),e=!0;case 8:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())},tu=function(){var t=fo(uo().m(function t(r){return uo().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,n){try{FS.mkdir(r),FS.mount(IDBFS,{},r),FS.syncfs(!0,function(a){if(a)n(a);else{var i=!1;if(FS.readdir("".concat(r)).indexOf("logs")<0&&(FS.mkdir("".concat(r,"/logs")),i=!0),FS.readdir("".concat(r)).indexOf("video")<0&&(FS.mkdir("".concat(r,"/video")),i=!0),FS.readdir("".concat(r)).indexOf("model")<0&&(FS.mkdir("".concat(r,"/model")),i=!0),FS.readdir("".concat(r)).indexOf("image")<0&&(FS.mkdir("".concat(r,"/image")),i=!0),FS.readdir("".concat(r,"/image")).indexOf("mini")<0&&(FS.mkdir("".concat(r,"/image/mini")),i=!0),FS.readdir("".concat(r,"/model")).indexOf("json")<0&&(FS.mkdir("".concat(r,"/model/json")),i=!0),FS.readdir("".concat(r,"/model")).indexOf("json")<0&&(FS.mkdir("".concat(r,"/model/json")),i=!0),FS.readdir("".concat(r,"/model")).indexOf("weight")<0&&(FS.mkdir("".concat(r,"/model/weight")),i=!0),i)return FS.syncfs(!1,function(r){return r?(dc("_bootstrap_fs > err: ".concat(e)),n(e),t(!1)):(hc("_bootstrap_fs > files re-sync"),t(!0))}),t(!1);t(!0)}})}catch(e){dc("_bootstrap_fs > err: ".concat(e)),n(e)}}))},t)}));return function(e){return t.apply(this,arguments)}}(),ru=function(){return!!(Zo.tenants&&Zo.tenants.list&&Zo.tenants.list.length>0)&&Zo.tenants.list.filter(function(e){return e})},nu=function(){var e=ru();return e?e.filter(function(e){return e.device}):[]},au=function(){return Object.keys(Wo.HardwareVendor.values).map(function(e){return{name:e,id:Wo.HardwareVendor.values[e]}})},iu=function(e){var t=lu(e),r=Object.keys(Wo.Role.values).filter(function(e){return Wo.Role.values[e]==t.role});if(r.length>0)return r[0]},su=function(e){Zo.remote_processor_list.list.find(function(t){return t.id.toLowerCase()==e.id.toLowerCase()})||Zo.remote_processor_list.list.push(e)},ou=function(e){e&&e.list&&e.list.forEach(function(e){su(e)}),cu()},cu=function(){var e=Zo.remote_processor_list.list.filter(function(e){return Zo.tenants.list.find(function(t){return e.sessionId.toLowerCase()==t.sessionId.toLowerCase()})});Zo.remote_processor_list.list=e.filter(function(e){return e})},uu=function(e){Zo.tenants.list.length?(new Map(Zo.tenants.list.map(function(e){return[e.sessionId.toLowerCase(),e]})),e.list.forEach(function(e){var t=e.sessionId.toLowerCase(),r=(e.id.toLowerCase(),Zo.tenants.list.find(function(e){return e.sessionId.toLowerCase()===t}));r?r.sessionId!==Yo&&(Object.entries(Zo.tenant.subscriptions).forEach(function(e){var n=co(e,2),a=n[0],i=n[1];a.toLowerCase()===r.sessionId.toLowerCase()&&a.toLowerCase()!==t&&(i.sessionId=t,Zo.tenant.subscriptions[t]=i,delete Zo.tenant.subscriptions[a])}),Object.assign(r,e)):Zo.tenants.list.push(e)}),Zo.tenants.list=Zo.tenants.list.filter(function(t){return!!e.list.some(function(e){return e.sessionId.toLowerCase()===t.sessionId.toLowerCase()})||(delete Zo.tenant.subscriptions[t.sessionId.toLowerCase()],!1)})):Zo.tenants=e},lu=function(e){return Zo.tenants.list.find(function(t){return(null==t?void 0:t.sessionId.toLowerCase())==e.toLowerCase()})},hu=function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:for(t=Au(),r=0;r<t.length;r++)((n=t[r]).isLocalScreenStream||n.isLocalVideoStream)&&n.mediaStream&&n.dat.sessionId;case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),du=function(){var e=fo(uo().m(function e(t){var r,n;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(r=Qu("screen-preview-".concat(Yo))).streamInitCallback=function(){var e=fo(uo().m(function e(t){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:n=0;case 1:if(!(n<3)){e.n=5;break}return e.p=2,e.n=3,r.self_register();case 3:return e.a(2);case 4:e.p=4,a=e.v,dc("standby_screen_sharing > streamInitCallback > self_register ".concat(a,". #").concat(n+1," re-trying..")),n++,e.n=1;break;case 5:return e.n=6,yu(r);case 6:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}(),e.n=1,r.share_screen();case 1:if(e.v){e.n=3;break}return e.n=2,yu(r);case 2:return e.a(2,null);case 3:return e.a(2,r);case 4:e.p=4,n=e.v,dc("standby_screen_sharing > err",n);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),fu=function(){var e=fo(uo().m(function e(){var t,r;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(t=Qu("cam-preview-".concat(Yo))).streamInitCallback=function(){var e=fo(uo().m(function e(r){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:n=0;case 1:if(!(n<3)){e.n=5;break}return e.p=2,e.n=3,t.self_register();case 3:return e.a(2);case 4:e.p=4,a=e.v,dc("standby_video_sharing > streamInitCallback > self_register ".concat(a,". #").concat(n+1," re-trying..")),n++,e.n=1;break;case 5:return e.n=6,yu(t);case 6:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}(),e.n=1,t.share_camera();case 1:if(e.v){e.n=3;break}return e.n=2,yu(t);case 2:return e.a(2,null);case 3:return e.a(2,t);case 4:e.p=4,r=e.v,dc("standby_video_sharing > err",r);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(){return e.apply(this,arguments)}}(),mu=function(e){var t=!1;return gc({to:Jo,label:"admin:data:message_info:content:<message_info>",data:e}),new Promise(function(e){window.addEventListener("admin:data:message_info:content:<message_info>:received",function(r){if(r.detail.content.code<0)pu(r.detail.content.label);else{var n=vu(r.label);n?n=r.content:gu(r.detail.content)}e(r.detail.content),t=!0}),xo(5e3).then(function(){t||(dc("_set_message_info > timeout"),e(!1))})})},pu=function(e){var t=Zo.message_infos&&Zo.message_infos.list&&Zo.message_infos.list.filter(function(t){return t.label!=e});Zo.message_infos.list=t},gu=function(e){vu(e.label)||Zo.message_infos&&Zo.message_infos.list&&Zo.message_infos.list.push(e)},vu=function(e){var t=Zo.message_infos&&Zo.message_infos.list&&Zo.message_infos.list.filter(function(t){return t.label==e});if(1==(null==t?void 0:t.length))return t[0]},bu=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Yo,a=Zo.tenant.notifications.find(function(n){return n.msg===r&&n.from===e&&n.metadata===t});a?a.last_update.push(Date.now()):(a={from:e,to:n,metadata:t,msg:r,last_update:[Date.now()],has_read:!0,has_notified:!(r.indexOf("local:")<0),id:Zo.tenant.notifications.length,htmlTmpl:null},Zo.tenant.notifications.push(a));var i=function(e){var t=vu(e);return t&&t.events?t.events:[]}(r),s={status:r,sender:e,content:t};return i&&i.forEach(function(e){e.msgKey&&t[e.msgKey]&&(r="".concat(r,":").concat(t[e.msgKey])),xo(500).then(function(t){switch(e.targetType.toLowerCase()){case"dom":var n=document.querySelector(e.targetKey);if(n){var a=r.replace(/[<>]/g,"*");n.dispatchEvent(new CustomEvent(a,{detail:s}))}case"window":window.dispatchEvent(new CustomEvent(r,{detail:s}))}})}),a},wu=function(){var e=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=JSON.stringify(Zo.tenant.notifications,null,2),FS.writeFile("/inori/logs/".concat(Yo),t),e.n=1,Ou();case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),yu=function(){var e=fo(uo().m(function e(t){var r,n,a,i;return uo().w(function(e){for(;;)switch(e.n){case 0:return a=Zo.tenant.processors.findIndex(function(e){var r;return!!e&&e.Id().toLowerCase()===(null===(r=t)||void 0===r?void 0:r.Id().toLowerCase())}),-1!==a&&(Zo.tenant.processors[a]=null),hc("processor# ".concat(null===(r=t)||void 0===r?void 0:r.Id()," removed")),(t.isLocalScreenStream||t.isLocalVideoStream)&&(null===(i=t)||void 0===i||i.stop_mediaStream()),e.n=1,null===(n=t)||void 0===n?void 0:n.deinit();case 1:t=null;case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ku=function(e,t){var r=Au();if(t&&(r=_u(t)),e)return r.find(function(t){return!!t&&t.Id().toLowerCase()===e.toLowerCase()})},_u=function(e){if(e)return Au().filter(function(t){return t.dat.remoteId.toLowerCase()===e.toLowerCase()})},Au=function(){Zo.tenant.processors=Zo.tenant.processors.filter(function(e){return e});var e=Zo.tenant.processors.sort(function(e,t){return t.dat.lastUpdate-e.dat.lastUpdate});return e},Su=function(){var e=Zo.remote_processor_list.list&&Zo.remote_processor_list.list.map(function(e){var t=Au().find(function(e){return e.dat.remoteId==e.dat.sessionId});return t&&t._screenshot&&(e.screenshot=t._screenshot),e}).sort(function(e,t){return t.last_update-e.last_update});return e},Cu=function(e){var t,r=Su();return t=e,r.reduce(function(e,r){var n=r[t];return e[n]||(e[n]=[]),e[n].push(r),e},{})},xu=function(e){if(e){var t,r=null===(t=Zo.remote_processor_list)||void 0===t||null===(t=t.list)||void 0===t?void 0:t.find(function(t){return t.id.toLowerCase()===e.toLowerCase()});if(r){var n=ku(r.id);return n&&(r.screenshot=n._screenshot),r}}},Bu=function(e){var t;Zo.remote_processor_list.list=null===(t=Zo.remote_processor_list)||void 0===t||null===(t=t.list)||void 0===t?void 0:t.filter(function(t){return t.id.toLowerCase()!=e.toLowerCase()})},Eu=function(e){var t=xu(e);t&&gc({to:t.sessionId,label:"tenant:data:processor:delete:<processor_id>",data:t.id})},Iu=function(e){try{return FS.stat(e)}catch(t){dc("_file_exists > filename: ".concat(e," err ").concat(t))}return!1},Pu=function(e,t){return FS.analyzePath(t).exists&&FS.unlink(t),FS.rename(e,t),Ou()},Nu=function(e){return FS.unlink(e),Ou()},Ou=function(){return new Promise(function(e){try{FS.syncfs(!1,function(t){return t?(dc("_sync_files > FS.syncfs err: ".concat(JSON.stringify(t))),e(!1)):(hc("_sync_files > FS.syncfs > successful"),e(!0))})}catch(t){dc("_sync_files > FS.syncfs err: ".concat(JSON.stringify(t))),e(!1)}})},Lu=function(e,t){try{var r=FS.readFile(e,{encoding:"binary"});return r?new Blob([r],{type:t}):new ArrayBuffer(0)}catch(t){dc("_read_file_blob > from ".concat(e," > e: ").concat(t))}return new ArrayBuffer(0)},Uu=function(){var e=fo(uo().m(function e(t,r,n){var a;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lu(t,r);case 1:if(!((a=e.v).byteLength<1)){e.n=2;break}return e.a(2,Promise.resolve(!1));case 2:return e.a(2,new Promise(function(e,t){try{var r=new FileReader;r.onload=function(t){var r=t.target.result;if(!n)return e(r);var a=function(e){for(var t=e.toLowerCase().replace(/-/g,""),r=new Uint8Array(16),n=0;n<16;n++)r[n]=parseInt(t.substr(2*n,2),16);return r}(n),i=new Uint8Array(r),s=new Uint8Array(i.length+a.length);return s.set(a,0),s.set(i,a.length),e(s)},r.readAsArrayBuffer(a)}catch(t){return dc("_read_file_buffer > ",t),e(!1)}}))}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),ju=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lu(t,"video/webm");case 1:return r=e.v,e.a(2,URL.createObjectURL(r))}},e)}));return function(t){return e.apply(this,arguments)}}(),Du=function(e){try{var t=Lu(e,"image/png");if(t.size>0)return URL.createObjectURL(t)}catch(e){dc("read_img_obj > err: ".concat(e))}return!1},Ru=function(e){return new Promise(function(t){try{var r=new FileReader;r.onerror=function(e){dc("_read_blob_2_arraybuffer  > reader.onerror: ".concat(JSON.stringify(e.target.error))),t(!1)},r.onload=function(){var e=r.result;t(e)},r.readAsArrayBuffer(e)}catch(e){dc("_read_blob_2_arraybuffer  > err: ".concat(JSON.stringify(e))),t(!1)}})},Vu=function(){var e=fo(uo().m(function e(t){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ru(t);case 1:return r=e.v,n=so(new Uint8Array(r)),e.a(2,{decompressedData:n})}},e)}));return function(t){return e.apply(this,arguments)}}(),Hu=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},Tu=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ru(t);case 1:if(!(r=e.v)){e.n=2;break}return e.a(2,Hu(r));case 2:return e.a(2,!1)}},e)}));return function(t){return e.apply(this,arguments)}}(),$u=function(){var e=fo(uo().m(function e(t,r){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ru(t);case 1:if(!(n=e.v)){e.n=3;break}return e.n=2,Ku(n,r);case 2:return e.a(2,!0);case 3:return e.a(2,!1)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Ku=function(){var e=fo(uo().m(function e(t,r){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=new Uint8Array(t),FS.writeFile(r,n,{encoding:"binary"}),tc){e.n=3;break}return tc=!0,e.n=1,xo(3e3);case 1:return e.n=2,Ou();case 2:tc=!1;case 3:t=null,e.n=5;break;case 4:return e.p=4,a=e.v,dc("_write_arrbuf_2_file > to ".concat(r," e: ").concat(a)),e.a(2,!1);case 5:return e.a(2,!0)}},e,null,[[0,4]])}));return function(t,r){return e.apply(this,arguments)}}(),Fu=function(e,t){return new Promise(function(r,n){fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return Ku(e,t).then(function(e){r(!0)})}).catch(function(e){n(e)})})},Mu=function(){if(Zo.ice_services&&Zo.ice_services.list&&Zo.ice_services.list.length>0){Zo.ice_services.list=Zo.ice_services.list.map(function(e){return{credential:e.credential,urls:[e.urls],username:e.username}});var e={iceServers:Zo.ice_services.list,iceTransportPolicy:"all"};return new RTCPeerConnection(e)}return!1},Ju=function(){var e=fo(uo().m(function e(t,r){var n,a,i,s,o;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=r){e.n=1;break}return console.warn("Received ICE candidate with empty metadata"),e.a(2);case 1:return a=atob(n),i=JSON.parse(a),s=new RTCIceCandidate(i),e.n=2,t.addIceCandidate(s);case 2:hc("Successfully added candidate: ".concat(r.id)),e.n=4;break;case 3:e.p=3,o=e.v,dc("Error handling ICE candidate ".concat(r.id,": ").concat(o));case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}(),zu=function(){var e=fo(uo().m(function e(t,r,n){return uo().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,a){if(t.dat.sessionId.toLowerCase()!=Jo.toLowerCase()){var i=window.crypto.randomUUID().toLowerCase(),s={id:i,uid:t.dat.sessionId,biStream:!1,processorId:t.Id(),metadata:btoa(JSON.stringify(n)),lastUpdate:(new Date).getTime(),connectionType:Wo.ConnectionType.values.CONN_STREAM},o="tenant:data:ice_offer:content:answered:<ice_offer>:".concat(i),c=!1,u=function(){var t=fo(uo().m(function t(n){var i,s,o;return uo().w(function(t){for(;;)switch(t.p=t.n){case 0:if(hc("iceoffer: ".concat(n.detail.content.id," answered.")),c=!0,i=n.detail.content,t.p=1,!i||""==i.answer){t.n=2;break}return s=JSON.parse(atob(i.answer)),t.n=2,r.setRemoteDescription(s);case 2:e(i),t.n=4;break;case 3:t.p=3,o=t.v,dc("Error applying server answer: ".concat(o)),a(o);case 4:return t.a(2)}},t,null,[[1,3]])}));return function(e){return t.apply(this,arguments)}}();window.addEventListener(o,u,{once:!0}),Zo.tenant.ice_offers[i]=s,gc({from:t.dat.sessionId,to:t.dat.remoteId,label:"tenant:data:ice_offer:content:<ice_offer>",data:s}),xo(2e4).then(function(){c||(window.removeEventListener(o,u),a(new Error("Signaling timeout: No answer received from peer")))})}else a(!1)}))},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),qu=function(e,t){if(Yo.toLowerCase()!=Jo.toLowerCase())return e.aid=Yo.toString(),e.answer=btoa(JSON.stringify(t)),gc({to:e.uid,label:"tenant:data:ice_offer:content:answered:<ice_offer>",data:e}),e;dc("_answer_offer > invalid session id.")},Wu=function(e,t,r){return new Promise(function(n,a){var i={id:window.crypto.randomUUID(),processorId:t.Id(),uid:t.dat.sessionId.toLowerCase(),metadata:btoa(JSON.stringify(e)),biStream:r,lastUpdate:(new Date).getTime(),candidates:[]},s="tenant:data:ice_offer:content:updated:<ice_offer>:".concat(i.id);window.addEventListener(s,function(e){hc("offer# ".concat(e.detail.content.id," updated for processor# ").concat(e.detail.content.processorId)),n(e.detail.content)},{once:!0}),bc({from:t.dat.sessionId,to:t.dat.remoteId,label:msg,data:i})})},Zu=function(){var e=fo(uo().m(function e(t,r,n){var a,i,s,o,c,u,l,h,d,f,m,p,g,v,b,w,y,k,_,A,S,C,x,B,E,I,P,N,O,L,U,j,D,R,V,H,T,$,K,F,M,J,z,q;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.data.label&&t.data.data){e.n=1;break}return wc({data:t.data}),e.a(2);case 1:if(o=[t.data.from,t.data.to,t.data.label,t.data.data],c=r,u=n,o){e.n=2;break}return dc("".concat(t.data," invalid}")),e.a(2);case 2:if("open"==c.readyState){e.n=3;break}return dc("data channel (".concat(c.label,") invalid}")),e.a(2);case 3:l=o[0]||Yo,h=o[1]||Yo,bu(l,o[3],o[2],h),d=o[2],z=d,e.n="tenant:data:ice_offer:content:<ice_offer>"===z?4:"service:drive:content:dir:<file_descs>"===z?5:"tenant:data:action:content:<action>"===z?6:"service:drive:file:chunk:<file_chunk>"===z?42:"tenant:data:processors:content:<processors>"===z?43:"tenant:data:processor:req:<processor_id>"===z?44:"tenant:data:action:content:completed<action>"===z?46:"tenant:data:prediction:setup:<prediction>:received"===z?47:"tenant:data:prediction:train:<prediction>"===z?48:"tenant:data:prediction:train:<prediction>:received"===z?51:"tenant:data:prediction:setup:<prediction>"===z?52:"tenant:data:prediction:unset:<prediction>:received"===z?55:"tenant:data:prediction:unset:<prediction>"===z?56:"tenant:data:ice_offer:content:updated:<ice_offer>"===z?59:"tenant:data:processor:content:<processor>"===z?60:"tenant:data:chunk:content:<bytes>"===z?61:"tenant:data:processor:content:received:<processor>"===z?62:66;break;case 4:return hc("".concat(d," iceoffer by service: ").concat(l)),e.a(3,67);case 5:return hc("".concat(d," acknowledged by service: ").concat(l)),e.a(3,67);case 6:if(!(f=o[3])){e.n=41;break}hc("cmd:",f),u.add_setting(l,f.setting),q=f.command,e.n=q===Wo.Command.values.NONE?7:q===Wo.Command.values.STANDBY?8:q===Wo.Command.values.STOP_RECORDING?9:q===Wo.Command.values.START_RECORDING?11:q===Wo.Command.values.PAUSE_REPLAY?12:q===Wo.Command.values.RESUME_REPLAY?14:q===Wo.Command.values.DELETE_RECORDING?16:q===Wo.Command.values.START_OD?18:q===Wo.Command.values.STOP_OD?20:q===Wo.Command.values.REGISTER_PROCESSOR?22:q===Wo.Command.values.SWITCH_PROCESSOR?24:q===Wo.Command.values.START_OD_DATA_ONLY?26:q===Wo.Command.values.LANDSCAPE_VIEW?27:q===Wo.Command.values.PORTRAIT_VIEW?28:q===Wo.Command.values.START_BINARY?29:q===Wo.Command.values.STOP_BINARY?31:39;break;case 7:return e.a(3,40);case 8:return null==(m=Zo.tenant.subscriptions[l])||m.unsubscribe(),e.a(3,40);case 9:return e.n=10,u.stopRecording(l);case 10:return e.a(3,40);case 11:return u.startRecording(l),e.a(3,40);case 12:return e.n=13,u.stopReplay();case 13:return e.a(3,40);case 14:return e.n=15,u.resumeReplay();case 15:return e.a(3,40);case 16:return e.n=17,u.delRecording();case 17:return e.a(3,40);case 18:return e.n=19,u.enableOD(!0,null,"mediapipe");case 19:return e.a(3,40);case 20:return e.n=21,u.disableOD(!0);case 21:return e.a(3,40);case 22:return e.n=23,u.self_register();case 23:return e.a(3,40);case 24:return e.n=25,Gu(f.setting.processorId,l);case 25:return e.a(3,40);case 26:return null===(a=u.compute)||void 0===a||a.postMessage({ODData:!0,renderOD:!1,renderFrame:!1,status:"ODData|renderOD|renderFrame"}),e.a(3,40);case 27:return null===(i=u.compute)||void 0===i||i.postMessage({landscape:!0,status:"landscape"}),e.a(3,40);case 28:return null===(s=u.compute)||void 0===s||s.postMessage({landscape:!1,status:"landscape"}),e.a(3,40);case 29:if(p=Zo.file_chunks[f.setting.metadata]){e.n=30;break}return hc("invalid file id ".concat(f.setting.metadata,". transmission discarded.")),e.a(2);case 30:return p.totalChunks=f.setting.metadataExt3,p.fileType=f.setting.metadataExt1,p.chunks={},hc("".concat(d," starting transmitting file# ").concat(f.setting.metadata)),(g=Zo.tenant.subscriptions[l]).onLoadSignal&&g.onLoadSignal(f.setting.metadata),e.a(3,40);case 31:if(!(v=Zo.file_chunks[f.setting.metadata])||!v.chunks){e.n=38;break}if((b=Object.keys(v.chunks)).length===v.totalChunks){e.n=32;break}return w={list:[],metadata:f.setting.metadata,metadataExt1:f.setting.metadataExt1,metadataExt2:f.setting.metadataExt2},Mo(b,v.totalChunks).forEach(function(e){w.list.push({chunkId:"".concat(e)})}),bc({from:h,to:l,label:"service:drive:file:chunk:req:<file_chunks>",data:w}),e.a(3,40);case 32:if(!((y=b.filter(function(e){return!v.chunks[e].verified}))>0)){e.n=33;break}return k={list:[],metadata:f.setting.metadata,metadataExt1:f.setting.metadataExt1,metadataExt2:f.setting.metadataExt2},y.forEach(function(e){k.list.push({chunkId:e})}),bc({from:h,to:l,label:"service:drive:file:chunk:req:<file_chunks>",data:k}),e.a(3,40);case 33:return hc("".concat(d," file# ").concat(f.setting.metadata," path: ").concat(f.setting.metadataExt2," totalChunks: ").concat(b.length," transmitted successully")),bc({from:h,to:l,label:"service:drive:file:chunk:del:<file_chunks>",data:{metadata:f.setting.metadata}}),_=b.map(function(e){return v.chunks[e].data}),A=new Blob(_,{type:"application/octet-stream"}),e.n=34,Vu(A);case 34:if(S=e.v,C=S.decompressedData,x=Zo.tenant.subscriptions[l],f.setting.metadataExt1!=Wo.FileType.values.MINIMUM){e.n=36;break}return e.n=35,Ku(C,"/inori/image/mini/".concat(Ko(f.setting.metadataExt2)),!1);case 35:return x.onLoadedMiniSignal&&x.onLoadedMiniSignal(f.setting.metadataExt2),e.a(3,40);case 36:if(!x.onLoadedSignal){e.n=37;break}return e.n=37,x.onLoadedSignal(f.setting.metadata,C);case 37:delete Zo.file_chunks[f.setting.metadata];case 38:return e.a(3,40);case 39:return dc("invalid command# ".concat(f.command)),e.a(2);case 40:return"open"===c.readyState&&bc({from:h,to:l,label:"tenant:data:action:content:completed<action>",data:f}),e.a(3,67);case 41:return e.a(3,67);case 42:return B=o[3],E=Fo(B.chunk),(I=Zo.file_chunks[B.metadata])&&(I.chunks&&(I.chunks[B.chunkId]={data:B.chunk,verified:E===B.checksum}),I.fileType!==Wo.FileType.values.MINIMUM&&(P=Zo.tenant.subscriptions[l]).onLoadingSignal&&P.onLoadingSignal()),e.a(3,67);case 43:return(N=o[3])&&N.list&&(ou(N),hc("".concat(d," by runtime# ").concat(l))),e.a(2);case 44:if(O=o[3]){e.n=45;break}return dc("".concat(d," invalid processor id")),e.a(2);case 45:return L=ku(O),bc({from:h,to:l,label:"tenant:data:processor:content:<processor>",data:L.dat}),e.a(3,67);case 46:return e.a(3,67);case 47:return(U=o[3])&&hc("prediction setup",U,"received by the remote vm"),e.a(3,67);case 48:if(!(j=o[3])){e.n=50;break}return hc("pd: ".concat(JSON.stringify(j))),e.n=49,u.procTrainer(j);case 49:bc({from:Yo,to:l,label:"tenant:data:prediction:train:<prediction>:received",data:R});case 50:return e.a(3,67);case 51:return(D=o[3])&&hc("prediction train ".concat(JSON.stringify(D)," received by the remote vm")),e.a(3,67);case 52:if(!(R=o[3])){e.n=54;break}return hc("pd: ".concat(JSON.stringify(R))),e.n=53,u.configTrainer(R);case 53:bc({from:Yo,to:l,label:"tenant:data:prediction:setup:<prediction>:received",data:R});case 54:return e.a(3,67);case 55:return(V=o[3])&&hc("prediction ".concat(JSON.stringify(V)," setup and vm are received")),e.a(3,67);case 56:if(!(H=o[3])){e.n=58;break}return hc("pd: ".concat(JSON.stringify(H))),e.n=57,u.disableTrainer();case 57:bc({from:Yo,to:l,label:"tenant:data:prediction:unset:<prediction>:received",data:R});case 58:return e.a(3,67);case 59:return gc(t.data),e.a(3,67);case 60:return(T=o[3])&&T.id&&(su(T),bc({from:o[1],to:o[0],label:"tenant:data:processor:content:received:<processor>",data:T})),e.a(3,67);case 61:return $=new Blob([o[3].slice(16).buffer],{type:"image/png"}),K=URL.createObjectURL($),(F=lu(l))&&(F._photo_src=K),e.a(3,67);case 62:return M=lu(Yo),e.n=63,Uu("/inori/photo","image/png",M.id);case 63:if(J=e.v){e.n=64;break}return hc("tenant# ".concat(JSON.stringify(M)," snapshot unavailable.")),e.a(3,67);case 64:return bc({from:Yo,to:l,label:"tenant:data:chunk:content:<bytes>",data:J}),e.n=65,xo();case 65:return u.renderCanvas(Date.now()),e.a(3,67);case 66:return e.a(3,67);case 67:return e.a(2)}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),Gu=function(){var e=fo(uo().m(function e(t,r){var n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(!(n=ku(t))){e.n=3;break}if(!(a=Zo.tenant.subscriptions[r])||!a.peerChannel){e.n=2;break}return a.peerChannel.onmessage=function(e){Zu(e,a.peerChannel,n)},e.n=1,a.subscribe(n);case 1:return e.a(2);case 2:return dc("invalid subscriber:",a),e.a(2);case 3:dc("to_processor:",n,"invalid");case 4:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Qu=function(e){var t=Zo.tenant.processors.find(function(t){return t.dat.name.toLowerCase()==e.toLowerCase()});if(t)return t;var r=function(e){return{messageHistory:"",mediaStream:null,videoObj:document.createElement("video"),shadowCtxObj:new OffscreenCanvas(0,0).getContext("2d",{willReadFrequently:!0}),ctxObj:document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),compute:null,trainer:null,isRemoteVideoStream:!1,isLocalVideoStream:!1,isLocalScreenStream:!1,localFileStream:"",isPilotEnabled:!0,isODEnabled:!1,odInitCallback:null,isTrainerSampling:!1,trainerInitCallback:null,trainerDoneCallback:null,frameNo:0,_viewport:[0,0,0,0],_screenshot:"",dat:{name:"".concat(e),remoteId:Yo,sessionId:Yo,screenshot:"",id:window.crypto.randomUUID(),lastUpdate:(new Date).getTime(),width:0,height:0,status:Wo.ProcessorStatus.values.INIT},subscribers:{},peerChannelCallback:null,streamRcvdCallback:null,streamInitCallback:null}}(e);r.get_subscriber=function(e){var t;e||(e=r.dat.remoteId);var n=(null==r?void 0:r.subscribers)&&(null==r?void 0:r.subscribers[null===(t=e)||void 0===t?void 0:t.toLowerCase()]);if(n)return n},r.get_subscribers=function(){return r.subscribers},r.add_subscriber=function(){var e=fo(uo().m(function e(t){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:return(n={processorId:null,sessionId:t,infers:[],mediaRecorder:null,recordedChunks:[],peerChannel:null,dataChannel:null,conn:null,mediaStream:new MediaStream,onTerminalSignal:null,onLoadedSignal:null}).get_conn=function(){return n.conn},n.set_conn=function(e){n.conn=e},n.Id=function(){var e;return null===(e=n.sessionId)||void 0===e?void 0:e.toLowerCase()},n.addInfer=function(e){return!n.getInfers().find(function(t){return t==e})&&(n.infers.push(e),!0)},n.delInfer=function(e){var t=n.getInfers().indexOf(e);return-1!==t&&(n.infers.splice(t,1),!0)},n.getInfers=function(){return n.infers},n.processor_id=function(){var e;return null===(e=n.processorId)||void 0===e?void 0:e.toLowerCase()},n.dispose=function(){var e,t;n.processorId=null,n.sessionId=null,n.mediaRecorder=null,n.recordedChunks=null,n.peerChannel=null,n.dataChannel=null,"closed"!=(null===(e=n.get_conn())||void 0===e?void 0:e.connectionState)&&(null===(t=n.get_conn())||void 0===t||t.close()),n.conn=null},n.capture_frame=function(e){return Bo(e,n.canvasObj())},n.get_mediaStream=function(){var e,t,r=Au().find(function(e){return e.Id()==n.processorId});if(!r)return!1;var a=n.mediaStream;if(null==a||null===(e=a.getTracks())||void 0===e||e.forEach(function(e){a.removeTrack(e)}),(null===(t=r.mediaStream)||void 0===t?void 0:t.getAudioTracks().length)>0){var i=r.mediaStream.getAudioTracks()[0];a.addTrack(i)}return r.ctxObj.canvas.captureStream().getTracks().forEach(function(e){return a.addTrack(e)}),a},n.get_4x3_MediaStream=function(){var e,t,r=Au().find(function(e){return e.Id()==n.processorId});if(!r)return!1;var a=n.mediaStream;if(null==a||null===(e=a.getTracks())||void 0===e||e.forEach(function(e){a.removeTrack(e)}),(null===(t=r.mediaStream)||void 0===t?void 0:t.getAudioTracks().length)>0){var i=r.mediaStream.getAudioTracks()[0];a.addTrack(i)}var s=r.ctxObj.canvas,o=document.createElement("canvas");o.width=640,o.height=480;var c=o.getContext("2d");return function e(){c.fillStyle="black",c.fillRect(0,0,640,480);var t=0,r=0,n=640,a=480;if(640!==s.width||480!==s.height){var i=Math.min(640/s.width,480/s.height);t=(640-(n=s.width*i))/2,r=(480-(a=s.height*i))/2}c.drawImage(s,t,r,n,a),requestAnimationFrame(e)}(),o.captureStream().getTracks().forEach(function(e){return a.addTrack(e)}),a},n.req_processors=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;xo(1e3).then(function(){bc({from:Yo,to:n.sessionId,label:"tenant:data:processors:req:<processors>",data:{totalNumOfPage:0,totalNumPerPage:t,pageIndex:e,list:[]}})})},n.rebootCtrl=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.n){case 0:return r=Wo.Command.values.REBOOT_CTRL,a={command:r,setting:{metadata:"/dev/video10",metadataExt1:t?1:-1}},e.n=1,n.sendAction(a);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.gimbalCtrl=function(){var e=fo(uo().m(function e(t){var r,a,i,s;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:i=t,e.n="up"===i?1:"down"===i?2:"left"===i?3:"right"===i?4:5;break;case 1:return r=Wo.Command.values.CTRL_UP,e.a(3,6);case 2:return r=Wo.Command.values.CTRL_DW,e.a(3,6);case 3:return r=Wo.Command.values.CTRL_LT,e.a(3,6);case 4:return r=Wo.Command.values.CTRL_RT,e.a(3,6);case 5:return dc("Invalid gimbal direction: ".concat(t)),e.a(2);case 6:return a={command:r,setting:{}},e.p=7,e.n=8,n.sendAction(a);case 8:return e.a(2,e.v);case 9:throw e.p=9,s=e.v,dc("Gimbal control failed for direction '".concat(t,"':"),s),s;case 10:return e.a(2)}},e,null,[[7,9]])}));return function(t){return e.apply(this,arguments)}}(),n.stopCtrl=fo(uo().m(function e(){var t,r;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=Wo.Command.values.STOP_CTRL,r={command:t,setting:{metadata:"/dev/video10"}},e.n=1,n.sendAction(r);case 1:return e.a(2,e.v)}},e)})),n.toggleOD=function(){var e=fo(uo().m(function e(t,r){var a,i,s,o,c,u,l=arguments;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:a=l.length>2&&void 0!==l[2]?l[2]:n.Id(),i=Wo.Command.values.START_OD,s="people-net",n.getInfers().includes(s)?(n.delInfer(s),i=Wo.Command.values.STOP_OD):(n.addInfer(s),i=Wo.Command.values.START_OD),c=r,e.n="media-pipe"===c?1:"coco-ssd"===c?2:3;break;case 1:case 2:return s="people-net",e.a(3,3);case 3:return o={command:i,setting:{metadata:s,metadataExt2:a}},e.p=4,e.n=5,n.sendAction(o);case 5:return e.a(2,e.v);case 6:e.p=6,u=e.v,dc("Toggle OD failed sending for data model '".concat(s,"':"),u);case 7:return e.a(2)}},e,null,[[4,6]])}));return function(t,r){return e.apply(this,arguments)}}(),n.updFD=function(){var e=fo(uo().m(function e(t,r){var a,i;return uo().w(function(e){for(;;)switch(e.n){case 0:return a=Wo.Command.values.SWITCH_FD,i={command:a,setting:{metadata:t,metadataExt6:r,metadataExt7:1}},e.n=1,n.sendAction(i);case 1:return e.a(2,e.v)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),n.liveStream=function(){var e=fo(uo().m(function e(t,r){var a,i;return uo().w(function(e){for(;;)switch(e.n){case 0:return a=Wo.Command.values.LIVE_STREAM,(t.includes("/dev/video")||t.includes("/dev/bus/usb")||t.includes("/live/FLV"))&&(a=Wo.Command.values.START_LIVE_CAM),i={command:a,setting:{metadata:"".concat(t),metadataExt1:r?1:-1}},e.n=1,n.sendAction(i);case 1:return e.a(2,e.v)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),n.stopLiveCam=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.n){case 0:return r=Wo.Command.values.STOP_LIVE_CAM,a={command:r,setting:{metadata:"".concat(t)}},e.n=1,n.sendAction(a);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.publishStream=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if((r=xu(t)).sessionId.toLowerCase()==n.Id()){e.n=1;break}return dc("processor# ".concat(t," is unavailable for subscriber# ").concat(n.Id())),e.a(2);case 1:return a={command:Wo.Command.values.LIVE_PROCESSOR,setting:{metadata:"vision",processorId:r.id}},e.n=2,n.sendAction(a);case 2:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.subscribe_remote=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r=xu(t)){e.n=1;break}return dc("processor# ".concat(t," not found}")),e.a(2);case 1:return a={command:Wo.Command.values.SWITCH_PROCESSOR,setting:{metadata:"vision",processorId:r.id}},e.n=2,n.sendAction(a);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.unsubscribe=function(){var e,t=n.get_conn();return"connected"===(null==t?void 0:t.connectionState)?(t.getSenders().forEach(function(e){t.removeTrack(e)}),t.getReceivers().forEach(function(e){e.track&&e.track.stop()}),n):(Zo.tenant.subscriptions[null===(e=n.Id())||void 0===e?void 0:e.toLowerCase()]=n,Au().forEach(function(e){e.del_subscriber(n.Id())}),n)},n.subscribe=function(){var e=fo(uo().m(function e(t){var r,a,i,s;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=1,n.unsubscribe(),n.processorId=t.Id(),(r=n.get_conn())&&"connected"===r.connectionState){e.n=2;break}hc("[".concat(n.Id(),"] preview only")),e.n=6;break;case 2:if("stable"===r.signalingState){e.n=3;break}return hc("[".concat(n.Id(),"] Connection not stable, skipping renegotiation.")),e.a(2,n);case 3:return(a=n.get_4x3_MediaStream())&&a.getTracks().forEach(function(e){r.addTrack(e,a),hc("[Subscribe] Adding track: ".concat(e.kind))}),e.n=4,r.createOffer({offerToReceiveVideo:1});case 4:return i=e.v,e.n=5,r.setLocalDescription(i);case 5:return t.dat&&(t.dat.remoteId=n.Id()),e.n=6,zu(t,r,i);case 6:return t.subscribers[n.Id().toLowerCase()]=n,e.n=7,xo();case 7:return t.status(Wo.ProcessorStatus.values.STREAM),t.renderCanvas&&t.renderCanvas(Date.now()),e.a(2,n);case 8:throw e.p=8,s=e.v,dc("subscribe error: ".concat(s)),s;case 9:return e.a(2)}},e,null,[[1,8]])}));return function(t){return e.apply(this,arguments)}}(),n.sendAction=function(e){return bc({from:Yo,to:n.sessionId,label:"tenant:data:action:content:<action>",data:e}),new Promise(function(e,t){var r=!1;window.addEventListener("tenant:data:action:content:completed<action>",function(t){hc("sendAction > received ".concat(t.detail)),r=!0,e(!0)},{once:!0}),xo(5e3).then(function(){r||e(!1)})})},e.n=1,n.subscribe(r);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.del_subscriber=function(e){r.get_subscriber(e)&&(delete r.subscribers[e.toLowerCase()],hc("subscriber# ".concat(e," removed from processor# ").concat(r.Id())))},r.viewport=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=r._viewport;return 0==e&&0==t&&0==n&&0==a||(i[0]=Math.max(i[0]+e,0),i[1]=Math.max(i[1]+t,0),i[2]=Math.abs(n||r.dat.width),i[3]=Math.abs(a||r.dat.height)),i},r.reset_viewport=function(){return r._viewport=[0,0,r.dat.width,r.dat.height],r._viewport},r.status=function(e){switch(e&&(r.dat.status=e),r.dat.status){case Wo.ProcessorStatus.values.INIT:return"init";case Wo.ProcessorStatus.values.STOP:return"stop";case Wo.ProcessorStatus.values.STREAM:return"stream";case Wo.ProcessorStatus.values.PAUSE:return"pause";default:return"invalid"}},r.canvasObj=function(e){var t;return null===(t=r.get_subscriber(e))||void 0===t?void 0:t.canvasObj()},r.peer_channel=function(e){var t;return null===(t=r.get_subscriber(e))||void 0===t?void 0:t.peerChannel},r.data_channel=function(e){var t;return null===(t=r.get_subscriber(e))||void 0===t?void 0:t.dataChannel},r.get_conn=function(){var e;return null===(e=r.get_subscriber(r.dat.remoteId))||void 0===e?void 0:e.get_conn()},r.add_conn=function(){var e=fo(uo().m(function e(t){var n,a,i;return uo().w(function(e){for(;;)switch(e.n){case 0:if(!(n=r.get_subscriber(t))){e.n=2;break}return e.n=1,n.unsubscribe();case 1:if("connected"!==(null===(a=n.get_conn())||void 0===a?void 0:a.connectionState)){e.n=2;break}return e.a(2,n.get_conn());case 2:return e.n=3,r.add_subscriber(t);case 3:return n=e.v,Zo.tenant.subscriptions[n.Id().toLowerCase()]=n,r.dat.remoteId=t,(i=Mu()).addEventListener("negotiationneeded",function(e){hc("**** negotiation is needed.")}),i.addEventListener("icegatheringstatechange",function(e){switch(hc("icegatheringstatechange: ".concat(e.target.iceGatheringState)),e.target.iceGatheringState){case"new":case"complete":return}}),i.addEventListener("connectionstatechange",function(){var e=fo(uo().m(function e(a){var s;return uo().w(function(e){for(;;)switch(e.n){case 0:hc("status changed: ".concat(i.connectionState," subscriber# ").concat(t," processor# ").concat(r.Id())),s=i.connectionState,e.n="new"===s||"connecting"===s?1:"connected"===s?2:"disconnected"===s||"failed"===s||"closed"===s?3:6;break;case 1:case 2:case 6:return e.a(3,7);case 3:return e.n=4,xo(2e4);case 4:if("connected"!=i.connectionState){e.n=5;break}return e.a(2);case 5:return n.unsubscribe(),n.dispose(),e.a(3,7);case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),i.addEventListener("icecandidate",function(e){var r,n,a,i;null!=e.candidate?(r=t,n=e.candidate,a=JSON.stringify(n.toJSON()),i=btoa(a),gc({to:r,label:"tenant:data:ice_candidate:content:<ice_candidate>",data:{id:1002,metadata:i,isOffer:true}})):hc("null icecandidate")}),i.addEventListener("datachannel",function(e){r._onRemoteDataChannel(e,t)}),i.addEventListener("track",function(e){r._onRemoteStream(e,t)}),n.conn=i,e.a(2,i)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.add_peer_channel=function(e,t){var n=r.get_subscriber(e);if(n)return n.peerChannel=t,Go[e]=t,n},r.add_setting=function(e,t){var n=r.get_subscriber(e);if(n)return n.setting=t,n},r.add_data_channel=function(e,t){var n=r.get_subscriber(e);if(n)return n.dataChannel=t,n},r.Id=function(){return r.dat.id.toLowerCase()},r.setId=function(e){for(var t=0,n=Object.entries(r.subscribers);t<n.length;t++){var a=co(n[t],2);a[0],a[1].processorId=e}r.dat.id=e},r.Name=function(){return r.dat.name},r.stopReplay=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r.reset();case 1:return e.a(2)}},e)})),r.resumeReplay=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r.reset();case 1:return e.a(2,r.playRecording(r.localFileStream))}},e)})),r.playRecording=function(){var e=fo(uo().m(function e(t){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,ju(t);case 1:return n=e.v,r.set_mediaStream(n,!1),r.localFileStream=t,e.a(2,!0);case 2:return e.p=2,a=e.v,dc("playRecording > _read_video_obj > err: ".concat(a)),e.a(2,!1)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),r.startRecording=function(e){try{var t=r.get_subscriber(e);if(!t)throw"invalid subscription# ${remote_id}";var n=t.get_mediaStream(e);t.mediaRecorder=new MediaRecorder(n,{mimeType:"video/webm; codecs=vp9"}),t.recordedChunks=[],t.mediaRecorder.ondataavailable=function(e){e.data.size>0&&t.recordedChunks.push(e.data)},t.mediaRecorder.start()}catch(e){dc("error stream recording: ".concat(e))}},r.stopRecording=function(e){return new Promise(function(t,n){var a=r.get_subscriber(e);if("inactive"!==a.mediaRecorder.state){var i=!1;a.mediaRecorder.onstop=fo(uo().m(function r(){var n,s,o,c;return uo().w(function(r){for(;;)switch(r.n){case 0:return n=new Blob(a.recordedChunks,{type:"video/webm"}),s=window.crypto.randomUUID(),o="/inori/video/".concat(s),r.n=1,$u(n,o);case 1:return a.recordedChunks=[],c=Qu("record_".concat(s.split("-")[0])),r.n=2,c.add_conn(e);case 2:return c.streamInitCallback=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,c.self_register();case 1:e.n=4;break;case 2:return e.p=2,r=e.v,e.n=3,yu(c);case 3:dc("mediaRecorder.onstop > streamInitCallback > self_register ".concat(r));case 4:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),r.n=3,c.playRecording(o);case 3:t(!0),i=!0,a.mediaRecorder=null;case 4:return r.a(2)}},r)})),a.mediaRecorder.stop(),xo(1e4).then(function(){i||t(!1)})}})},r.delRecording=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Nu(r.localFileStream);case 1:return e.a(2)}},e)})),r.capture_frame=function(e){return Bo(e,r.videoObj)},r.retain_screenshot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.videoObj;r._screenshot=function(e){if(e.videoWidth&&e.videoHeight){var t=e.videoWidth/e.videoHeight,r=document.createElement("canvas");r.width=100,r.height=100/t;var n=r.getContext("2d",{willReadFrequently:!0});n.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,r.width,r.height),n.getImageData(0,0,r.width,r.height);var a=n.canvas.toDataURL("image/jpeg");return r=null,n=null,a}}(e)},r.screenshot=function(){return r._screenshot},r.disableTrainer=function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.isTrainerSampling=!1,r.trainer){e.n=1;break}return e.a(2);case 1:return e.n=2,r.delTrainer();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.disableOD=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.isODEnabled){e.n=1;break}return e.a(2);case 1:return r.isODEnabled=!1,e.n=2,r.delWorker();case 2:return e.a(2)}},e)})),r.pauseTrainer=fo(uo().m(function e(){var t,n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.trainer){e.n=1;break}return e.a(2);case 1:return n={req:"pause"},null===(t=r.trainer)||void 0===t||t.postMessage(n),e.n=2,xo();case 2:return e.a(2)}},e)})),r.resumeTrainer=fo(uo().m(function e(){var t,n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.trainer){e.n=1;break}return e.a(2);case 1:return n={req:"resume"},null===(t=r.trainer)||void 0===t||t.postMessage(n),e.n=2,xo();case 2:return e.a(2)}},e)})),r.enableTrainer=fo(uo().m(function e(){var t,n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(!r.trainer){e.n=1;break}return e.a(2);case 1:return r.trainer=new Worker("workers/trainer.".concat("min.","js")),e.n=2,xo(3e3);case 2:return r.setTrainerEvent(),n={id:window.crypto.randomUUID().toLowerCase(),req:"bootstrap"},null===(t=r.trainer)||void 0===t||t.postMessage(n),e.n=3,xo();case 3:return e.a(2)}},e)})),r.configTrainer=function(){var e=fo(uo().m(function e(t){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.trainer){e.n=1;break}return e.n=1,r.enableTrainer();case 1:return n={bound:t.bbox,objective:t.class,req:"config"},r.trainer.postMessage(n),e.n=2,xo();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.sampleTrainer=function(){var e=fo(uo().m(function e(t,n,a){var i;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.trainer){e.n=1;break}return e.a(2);case 1:i={source:t,metric:n,tag:a,req:"collect"},r.trainer.postMessage(i);case 2:return e.a(2)}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),r.resumeSampleTrainer=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.trainer){e.n=1;break}return e.a(2,!1);case 1:t={source:_imgData,metric:_metric,tag:_tag,req:"collect"},r.trainer.postMessage(t);case 2:return e.a(2)}},e)})),r.procTrainer=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.trainer){e.n=1;break}return e.a(2);case 1:return t={req:"train"},r.trainer.postMessage(t),e.n=2,xo();case 2:return e.a(2)}},e)})),r.enableOD=fo(uo().m(function e(){var t,n,a,i,s,o=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:t=o.length>0&&void 0!==o[0]&&o[0],n=o.length>1?o[1]:void 0,a=o.length>2&&void 0!==o[2]?o[2]:"coco-ssd",r.compute,i={tm:n,width:r.dat.width,height:r.dat.height,ODData:!1,renderOD:!1,renderFrame:!1,landscape:!1,status:"bootstrap"},t?(i.ODData=!0,r.isLocalVideoStream||r.isLocalScreenStream||r.localFileStream?i.renderFrame=!0:i.renderFrame=!1,i.renderOD=!1):(i.renderOD=!0,i.ODData=!1),s=a,e.n="media-pipe"===s?1:"coco-ssd"===s?2:3;break;case 1:return r.compute=new Worker("workers/compute-mediapipe.".concat("min.","js"),{type:"module"}),e.a(3,4);case 2:return r.compute=new Worker("workers/compute-coco-ssd.".concat("min.","js"),{type:"module"}),e.a(3,4);case 3:return hc("unsupported pretrained model: ".concat(a)),e.a(2);case 4:return r.setVisionEvent(i),e.a(2,new Promise(function(e,t){var n=!1;r.odInitCallback=function(t){e(!0),n=!0,hc("object detection lauched")},xo(1e4).then(function(){n||e(!1)})}))}},e)})),r.renderCanvas=function(){var e=fo(uo().m(function e(t){var n,a,i,s,o,c,u,l,h,d;return uo().w(function(e){for(;;)switch(e.n){case 0:if(0!=(null===(n=r.dat)||void 0===n?void 0:n.width)&&0!=(null===(a=r.dat)||void 0===a?void 0:a.height)){e.n=1;break}return dc("processor# ".concat(r.Id()," returns on invalid render size}")),e.a(2);case 1:if("pause"!=r.status()){e.n=4;break}return e.n=2,r.disableOD();case 2:return e.n=3,r.disableTrainer();case 3:return hc("processor# ".concat(r.Id()," paused")),e.a(2);case 4:if(1==r.frameNo&&(i=r.capture_frame(150),r._screenshot=i,r.streamInitCallback&&r.streamInitCallback(i),r.streamInitCallback=null),r.isLocalScreenStream||r.isLocalVideoStream)r.shadowCtxObj&&r.shadowCtxObj.drawImage(r.videoObj,0,0,r.dat.width,r.dat.height),s=null===(o=r.shadowCtxObj)||void 0===o?void 0:o.getImageData.apply(o,mo(r.viewport()));else try{u=r.videoObj.videoWidth/r.videoObj.videoHeight,l=r.shadowCtxObj.canvas.width,h=r.shadowCtxObj.canvas.width/u,r.viewport()[3]=h,r.shadowCtxObj.canvas.height=h,r.shadowCtxObj.drawImage(r.videoObj,0,0,r.videoObj.videoWidth,r.videoObj.videoHeight,0,0,l,h),s=null===(c=r.shadowCtxObj)||void 0===c?void 0:c.getImageData(0,0,l,h)}catch(e){hc("_p.renderCanvas err: ".concat(e," processor: ").concat(r.Id()," paused")),r.status(Wo.ProcessorStatus.values.PAUSE)}r.frameNo++,r.isTrainerSampling&&r.sampleTrainer(s,null,null),r.isODEnabled?null===(d=r.compute)||void 0===d||d.postMessage(s):(Object.values(r.subscribers||[]).length<1&&r.frameNo>1&&r.status(Wo.ProcessorStatus.values.PAUSE),r.ctxObj.canvas.width=r.viewport()[2],r.ctxObj.canvas.height=r.viewport()[3],s&&r.ctxObj.putImageData(s,0,0),requestAnimationFrame(function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r.renderCanvas(t);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}()));case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),r.delWorker=fo(uo().m(function e(){var t,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return null===(t=r.compute)||void 0===t||t.postMessage({status:"dispose"}),e.n=1,xo();case 1:return null===(n=r.compute)||void 0===n||n.terminate(),e.n=2,xo();case 2:delete r.compute;case 3:return e.a(2)}},e)})),r.delTrainer=fo(uo().m(function e(){var t,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return null===(t=r.trainer)||void 0===t||t.postMessage({req:"dispose"}),e.n=1,xo();case 1:return null===(n=r.trainer)||void 0===n||n.terminate(),e.n=2,xo();case 2:delete r.trainer;case 3:return e.a(2)}},e)})),r.deinit=fo(uo().m(function e(){var t,n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.subscribers)for(t=0,n=Object.entries(r.subscribers);t<n.length;t++)(a=co(n[t],2))[0],a[1].unsubscribe();return delete r.subscribers,delete r.videoObj,delete r.shadowCtxObj,delete r.mediaRecorder,e.n=1,r.disableOD();case 1:return e.n=2,r.disableTrainer();case 2:return e.a(2)}},e)})),r.reset=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return delete r.mediaStream,delete r.videoObj,delete r.shadowCtxObj,e.n=1,r.disableOD();case 1:return e.n=2,r.disableTrainer();case 2:r.isTrackShared=!1,r.isLocalVideoStream=!1,r.isLocalScreenStream=!1,r.isPilotEnabled=!0,r.isODEnabled=!1,r.isTrainerSampling=!1,r.frameNo=2,delete r.peerChannelCallback,delete r.streamInitCallback,r.videoObj=document.createElement("video"),r.shadowCtxObj=new OffscreenCanvas(r.dat.width,r.dat.width).getContext("2d",{willReadFrequently:!0}),r.status(Wo.ProcessorStatus.values.STOP);case 3:return e.a(2)}},e)})),r.stop_mediaStream=function(){var e,t;(null===(e=r.mediaStream)||void 0===e?void 0:e.getTracks)&&(null===(t=r.mediaStream)||void 0===t||null===(t=t.getTracks())||void 0===t||t.forEach(function(e){var t;e.stop(),null===(t=r.mediaStream)||void 0===t||t.removeTrack(e)})),delete r.mediaStream},r.set_mediaStream=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r.videoObj?(r.videoObj.addEventListener("play",function(e){var t,n;if(r.videoObj){var a=null===(t=r.videoObj)||void 0===t?void 0:t.videoWidth,i=null===(n=r.videoObj)||void 0===n?void 0:n.videoHeight;r.dat.width=a,r.dat.height=i,r.viewport(0,0,a,i),r.shadowCtxObj.canvas.width=a,r.shadowCtxObj.canvas.height=i,r.status(Wo.ProcessorStatus.values.STREAM),r.renderCanvas(Date.now())}else hc("processor has been terminated")},{once:!0}),r.videoObj.autoplay=!0,t?r.videoObj.srcObject||(r.videoObj.srcObject=e):(r.videoObj.loop=!0,r.videoObj.src||(r.videoObj.src=e)),r.mediaStream=e):hc("processor has been terminated")},r.self_register=function(){return new Promise(function(e,t){var n="tenant:data:processor:content:received:<processor>:".concat(r.Id()),a=!1;window.addEventListener(n,function(t){var n=t.detail.content;hc("processor request: ".concat(n.id," received.")),r.dat=n,r.dat.lastUpdate=(new Date).getTime(),a=!0,Zo.remote_processor_list.list.push(n),e(r)},{once:!0}),r.dat.sessionId=Yo;var i="tenant:data:processor:content:<processor>";gc({to:r.dat.sessionId,label:i,data:r.dat}),xo(2e4).then(function(){a||(window.removeEventListener(n,function(e){dc("".concat(i," > timeout"))}),t(!1))})})},r.share_camera=function(){var e=fo(uo().m(function e(t){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!t){e.n=1;break}n=t,e.n=3;break;case 1:return e.n=2,navigator.mediaDevices.getUserMedia({video:{frameRate:{ideal:20,max:20}},audio:!1});case 2:n=e.v;case 3:if(n){e.n=4;break}return e.a(2,!1);case 4:return r.set_mediaStream(n),r.isLocalVideoStream=!0,e.a(2,!0);case 5:return e.p=5,a=e.v,dc("Error accessing media devices.",a),e.a(2,!1)}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),r.share_screen=function(){var e=fo(uo().m(function e(t){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!t){e.n=1;break}n=t,e.n=3;break;case 1:return e.n=2,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});case 2:n=e.v;case 3:if(n){e.n=4;break}return e.a(2,!1);case 4:return r.set_mediaStream(n),r.isLocalScreenStream=!0,e.a(2,!0);case 5:return e.p=5,a=e.v,dc("Error accessing media devices.",a),e.a(2,!1)}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),r.resp2RemoteStream=function(){var e=fo(uo().m(function e(t){var n,a,i=arguments;return uo().w(function(e){for(;;)if(0===e.n)return a=(n=!(i.length>1&&void 0!==i[1])||i[1])?t.uid:r.dat.remoteId,e.a(2,new Promise(function(){var e=fo(uo().m(function e(i,s){var o,c,u,l,h,d;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,r.get_conn();case 1:return o=e.v,n&&(c=r.get_subscriber(a))&&(u=c.get_mediaStream()).getTracks().forEach(function(e){o.addTrack(e,u)}),l=t,h=JSON.parse(atob(l.metadata)),e.a(2,o.setRemoteDescription(h).then(function(e){return o.createAnswer().then(function(e){o.setLocalDescription(e);var t=qu(l,e);if(!t)return s("invalid answer");hc("finalise offer# ".concat(t.id," for processor# ").concat(r.Id())),i(t)})}).catch(function(e){dc("initRemoteAnswer err: ",e),o.close()}));case 2:e.p=2,d=e.v,i(!1),dc(d);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()))},e)}));return function(t){return e.apply(this,arguments)}}(),r.req2RemoteStream=function(){try{return gc({from:r.dat.sessionId,to:r.dat.remoteId,label:"tenant:data:ice_offer:req:<processor_id>",data:r.Id()}),new Promise(function(e,t){var n="tenant:data:ice_offer:content:<ice_offer>:".concat(r.Id());window.addEventListener(n,function(){var t=fo(uo().m(function t(n){var a,i;return uo().w(function(t){for(;;)switch(t.p=t.n){case 0:return a=n.detail.content,t.p=1,t.n=2,r.resp2RemoteStream(a,!1);case 2:e(!0),t.n=5;break;case 3:return t.p=3,i=t.v,dc("req2RemoteStream > err: ".concat(i)),t.n=4,yu(r);case 4:e(!1);case 5:return t.a(2)}},t,null,[[1,3]])}));return function(e){return t.apply(this,arguments)}}())})}catch(e){dc(e)}},r.resp2StreamReq=function(){var e=fo(uo().m(function e(t){var n,a,i,s,o,c,u,l;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,r.get_conn();case 1:if(a=e.v,!(i=r.get_subscriber(t))){e.n=3;break}if((s=i.get_4x3_MediaStream()).getTracks().forEach(function(e){a.addTrack(e,s)}),o=a.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),o){e.n=2;break}return e.a(2,reje("expected a video transceiver after addTrack()"));case 2:c=RTCRtpSender.getCapabilities("video").codecs,u=c.filter(function(e){return"video/h264"===e.mimeType.toLowerCase()||"video/rtx"===e.mimeType.toLowerCase()&&/apt=\d+/.test(e.sdpFmtpLine)}),o.setCodecPreferences(u);case 3:return n=a.createDataChannel("ProcessorData",{ordered:!0}),r.add_peer_channel(t,n),n.binaryType="arraybuffer",n.addEventListener("open",fo(uo().m(function e(){var a;return uo().w(function(e){for(;;)switch(e.n){case 0:hc("channel: ".concat(n.label," opened")),n.onmessage=function(e){Zu(e,n,r)},r.dat.lastUpdate=(new Date).getTime(),(a=Au().filter(function(e){return e.dat.sessionId==Yo&&(e.isLocalScreenStream||e.isLocalVideoStream)}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}))&&bc({from:r.dat.sessionId,to:t,label:"tenant:data:processors:content:<processors>",data:{list:a}});case 1:return e.a(2)}},e)})),{once:!0}),n.addEventListener("close",fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:hc("channel: ".concat(n.label," closed. closing conn..")),i.unsubscribe();case 1:return e.a(2)}},e)})),{once:!0}),e.a(2,a.createOffer({offerToReceiveVideo:1}).then(function(e){return new Promise(function(t,n){a.setLocalDescription(e).then(function(i){zu(r,a,e).then(function(e){if(hc("register local offer:",e),e&&""!=e.answer&&e.candidates.length>0){var r=JSON.parse(atob(e.answer));a.setRemoteDescription(r),t(e)}}).catch(function(e){n(e)})})})}));case 4:e.p=4,l=e.v,dc(l);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),r.liveStream=function(e,t){gc({label:"service:stream:live:req:<service>",to:e,data:{sessionId:r.dat.remoteId,metadata:t}})},r.publishStream=function(){var e=fo(uo().m(function e(t){var n,a,i,s,o,c;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,r.add_conn(t);case 1:if(a=e.v,i=r.get_subscriber(t)){e.n=2;break}return e.a(2,!1);case 2:return(s=i.get_4x3_MediaStream()).getTracks().forEach(function(e){a.addTrack(e,s)}),n=a.createDataChannel("ProcessorData",{ordered:!0}),r.add_peer_channel(t,n),n.binaryType="arraybuffer",n.addEventListener("open",fo(uo().m(function e(){var a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(hc("channel: ".concat(n.label," opened")),n.onmessage=function(e){Zu(e,n,r)},r.dat.lastUpdate=(new Date).getTime(),(a=Au().filter(function(e){return e.dat.sessionId==Yo}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}))&&bc({from:r.dat.sessionId,to:t,label:"tenant:data:processors:content:<processors>",data:{list:a}}),!r.isLocalScreenStream&&!r.isLocalVideoStream){e.n=1;break}return e.n=1,i.updFD("localStream",Date.now());case 1:return e.a(2)}},e)})),{once:!0}),n.addEventListener("close",fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:hc("channel: ".concat(n.label," closed. closing conn..")),i.unsubscribe();case 1:return e.a(2)}},e)})),{once:!0}),e.n=3,a.createOffer({offerToReceiveVideo:1});case 3:return o=e.v,e.n=4,a.setLocalDescription(o);case 4:return e.n=5,zu(r,a,o);case 5:return e.a(2,e.v);case 6:throw e.p=6,c=e.v,dc(c),c;case 7:return e.a(2)}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),r.setTrainerEvent=function(){r.trainer.onmessage=function(e){if(e.data.conf&&"initialised"==e.data.conf.summary.status)return hc("processor# ".concat(r.Id()," trainer initialised")),r.trainer.onmessage=function(){var e=fo(uo().m(function e(t){var n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.data){e.n=1;break}return dc("empty message received"),e.a(2);case 1:a=t.data.req,e.n="status"===a?2:"pause"===a?3:"resume"===a?4:"collect"===a?5:"train"===a?6:"dispose"===a?10:"config"===a?11:12;break;case 2:return hc("current config:",t.data.conf),e.a(3,13);case 3:return"paused"==t.data.conf.summary.status&&(r.isTrainerSampling=!1),e.a(3,13);case 4:return hc("trainer resumes sampling",t.data.conf),r.isTrainerSampling=!0,e.a(3,13);case 5:return hc("data collected",t.data.conf),e.a(3,13);case 6:if(r.isTrainerSampling=!1,n=t.data.conf,hc("model trained",n),!n.summary.modelBlob||!n.summary.weightsBlob){e.n=9;break}return e.n=7,Fu(n.summary.modelBlob,"/inori/model/json/".concat(n.id));case 7:return e.n=8,Fu(n.summary.weightsBlob,"/inori/model/weight/".concat(n.id));case 8:r.trainerDoneCallback&&r.trainerDoneCallback(n);case 9:return e.a(3,13);case 10:return r.isTrainerSampling=!1,hc("trainer disposed",t.data.conf),e.a(3,13);case 11:return hc("config acknowledged:",t.data.conf),r.isTrainerSampling=!0,e.a(3,13);case 12:return hc("unknown message:",t.data.reply),e.a(3,13);case 13:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),void(r.trainerInitCallback&&r.trainerInitCallback(e.data.conf))}},r.setVisionMPEvent=function(e){var t=document.createElement("iframe");t.onload=function(){r.setVisionEvent(e)},t.src="mediapipe.html",t.width=0,t.height=0,t.frameborder=0,document.body.appendChild(t)},r.setVisionEvent=function(e){r.compute||dc("_p.compute: channel invalid"),r.compute.onmessage=function(e){if(e.data.status&&"initialised"==e.data.status){hc("processor# ".concat(r.Id()," vision initialised"));var t=function(e,t){if(r&&r.subscribers)for(var n=0,a=Object.entries(r.subscribers);n<a.length;n++){var i,s=co(a[n],2),o=s[0],c=s[1],u=c.peerChannel;"open"==(null==u?void 0:u.readyState)&&null!==(i=c.setting)&&void 0!==i&&i.isOd&&bc({from:r.dat.sessionId,to:o,label:"tenant:data:predictions:content:<predictions>",data:{list:e,width:t.width,height:t.height,frameNo:r.frameNo}})}};return r.compute.onmessage=function(e){var n;if((null===(n=e.data)||void 0===n?void 0:n.length)>1)if(e.data[2],e.data[0]instanceof ImageData)Array.isArray(e.data[1])&&e.data[1].length>0&&t(e.data[1],e.data[2]),r.putImageData(e.data[0],0,0,r.viewport()[2],r.viewport()[3]).then(function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:t||r.status(Wo.ProcessorStatus.values.PAUSE);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());else{if(!Array.isArray(e.data[1]))return void hc("non-frame message received:",e.data);e.data[1].length>0&&t(e.data[1],e.data[2])}else{if("object"!==oo(e.data))return void dc("invalid message received:",e.data);hc("compute message received:",e.data)}r.renderCanvas(Date.now())},r.isODEnabled=!0,r.odInitCallback&&r.odInitCallback(e.data),void r.renderCanvas(Date.now())}},r.compute.postMessage(e)},r._onRemoteDataChannel=function(e,t){hc("onRemoteDataChannel: ".concat(JSON.stringify(e)));var n=e.channel;"ProcessorData"===n.label&&(n.onmessage=function(e){Zu(e,n,r)}),n.binaryType="arraybuffer",n.addEventListener("close",function(){var e;hc("channel: ".concat(n.label," closed. closing conn..")),null===(e=r.conn(t))||void 0===e||e.close()},{once:!0}),n.addEventListener("open",function(){hc("channel: ".concat(n.label," opened.")),"ProcessorData"===n.label?r.add_peer_channel(t,n):r.add_data_channel(t,n),r.peerChannelCallback&&r.peerChannelCallback(n),r.peerChannelCallback=null},{once:!0})},r._onRemoteStream=function(){var e=fo(uo().m(function e(t,n){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!t.streams||!t.streams[0]){e.n=1;break}r.set_mediaStream(t.streams[0]),r.streamRcvdCallback&&r.streamRcvdCallback(t.streams[0]),e.n=2;break;case 1:return dc("invalid remote stream"),e.a(2);case 2:hc("processing remote stream");case 3:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Zo.tenant.processors.push(r);var n=Au().filter(function(e){return!e.dat.name.includes("preview")}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat});return n&&Object.values(Zo.tenant.subscriptions).forEach(function(e){var t;"connected"===(null===(t=e.get_conn())||void 0===t?void 0:t.connectionState)&&bc({from:Yo,to:e.Id(),label:"tenant:data:processors:content:<processors>",data:{list:n}})}),r},Yu=function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=FS.readdir("/inori/model/json"),r=t.slice(2).map(function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Xu(t);case 1:if(r=e.v){e.n=2;break}return e.a(2);case 2:return hc("_model# ".concat(r.tid.val)),e.a(2,r)}},e)}));return function(t){return e.apply(this,arguments)}}()),e.n=1,Promise.all(r);case 1:return n=e.v,e.a(2,n.filter(function(e){return e}))}},e)}));return function(){return e.apply(this,arguments)}}(),Xu=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Uu("/inori/model/json/".concat(t),"application/json");case 1:return r=e.v,n=new TextDecoder("utf-8"),a=n.decode(r),i=JSON.parse(a),e.n=2,Uu("/inori/model/weight/".concat(t),"application/octet-stream");case 2:return s=e.v,i.weightData=s,i.tid=t,e.a(2,i)}},e)}));return function(t){return e.apply(this,arguments)}}(),el={get:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Zo.content.content;return e>-1?t&&t[e]:t&&t[el.getIndex()]},getAll:function(){return Zo.content.content},setIndex:function(e){Zo.content.contentIndex=e},getIndexByName:function(e){return Zo.content.content.indexOf(e)},getIndex:function(){return Zo.content.contentIndex},getL1:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Zo.content.contentL1[el.getIndex()];return e>-1?t&&t[e]:t&&t[el.getL1Index()]},getAllL1:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Zo.content.contentL1[el.getIndex()]:Zo.content.contentL1[e]},setL1Index:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t<0?Zo.content.contentL1Index[el.getIndex()]=e:Zo.content.contentL1Index[t]=e},getL1Index:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Zo.content.contentL1Index[el.getIndex()]:Zo.content.contentL1Index[e]},getL2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Zo.content.contentL2&&Zo.content.contentL2[el.getIndex()];return e>-1?t&&t[e]:t&&t[el.getL1Index()]},getAllL2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Zo.content.contentL2&&Zo.content.contentL2[el.getIndex()]:Zo.content.contentL2&&Zo.content.contentL2[e]},getAllL3:function(){return Zo.content.contentL3},getX509Sbj:function(){return Zo.content.contentX509}},tl=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s,o,c,u,l,h,d,f,m,p,g,v,b,w,y,k,_,A,S,C,x,B,E,I,P,N,O,L,U,j,D,R,V,H,T,$,K,F,M,J,z,q,W,Z,G,Q;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.data.label){e.n=1;break}return dc("".concat(t.data," invalid}")),e.a(2);case 1:ec.has(t.data.label)||ec.set(t.data.label,[]),n=ec.get(t.data.label),t.data.last_update=Date.now(),n.push(t.data),a=[t.data.from,t.data.to,t.data.label,t.data.data],i=a[0]||Yo,s=a[1]||Yo,bu(i,a[3],a[2],s),o=a[2].split(":"),R=o[0],e.n="admin"===R?2:"tenant"===R?28:"guest"===R?64:"local"===R?71:113;break;case 2:V=o[1],e.n="heartbeat"===V?3:"data"===V?4:"system"===V?18:26;break;case 3:return hc("".concat(o.join(":")," by admin")),e.a(2);case 4:H=o.slice(2).join(":"),e.n="geos:content:<geo_locations>"===H?5:"tenant:content:received:<tenant>"===H?6:"service:status:<setting>:confirmed"===H?7:"subjects:content:<subjects>"===H?8:"ice_servces:content:<ice_services>"===H?9:"ice_offers:content:<ice_offers>"===H?10:"ice_offers:content:received:<ice_offers>"===H?11:"ice_offer:content:<ice_offer>"===H?12:"invalid_content"===H||"invalid_cred"===H?13:"message_info:content:<message_info>:received"===H?14:"message_infos:content:<message_infos>"===H?15:16;break;case 5:return hc("".concat(o.join(":")," sent by bridge")),Zo.geo_locations=a[3],e.a(3,17);case 6:return hc("".concat(o.join(":")," acknowledged by admin")),e.a(3,17);case 7:return null!==(r=a[3])&&void 0!==r&&r.isLive||(l=null===(c=a[3])||void 0===c?void 0:c.metadataExt4,h=null===(u=a[3])||void 0===u?void 0:u.metadataExt5,d=_u(h).find(function(e){return e.dat.sessionId==l}),d&&yu(d)),e.a(3,17);case 8:return hc("".concat(o.join(":")," sent by bridge")),Zo.subjects=a[3],e.a(3,17);case 9:return hc("".concat(o.join(":")," sent by bridge")),Zo.ice_services=a[3],e.a(3,17);case 10:return e.a(3,17);case 11:return f=a[3],Zo.ice_offers=f,e.a(3,17);case 12:return e.a(3,17);case 13:return hc("".concat(o.join(":")," by cell")),e.a(2);case 14:return Zo.message_infos.list=Zo.message_infos.list.filter(function(e){return e.code!=a[3].code}),Zo.message_infos.list.push(a[3]),e.a(2);case 15:return hc("".concat(o.join(":")," upd msg bus in util")),Zo.message_infos=a[3],e.a(2);case 16:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 17:return e.a(3,27);case 18:T=o.slice(2).join(":"),e.n="profile:metric:<bytes>:confirmed"===T?19:"event:timeout"===T||"event:notice"===T?20:"received:<string>"===T||"event:service:<string>"===T?21:"event:tenant_online"===T||"event:tenant_offline"===T||"event:tenant_exit"===T||"event:tenant_exit:received"===T?22:"error:<string>"===T?23:24;break;case 19:try{m=(new TextDecoder).decode(a[3]),p=JSON.parse(m),hc("".concat(o.join(":"),":"),p)}catch(e){g=new Blob([a[3]],{type:"application/octet-stream"}),v=URL.createObjectURL(g),(b=document.createElement("a")).href=v,b.download="profile.pprof",b.click(),URL.revokeObjectURL(v)}return e.a(3,25);case 20:return e.a(3,25);case 21:return hc("".concat(o.join(":")," > ").concat(a[3])),e.a(3,25);case 22:return hc("".concat(o.join(":")," by ").concat(i)),e.a(3,25);case 23:return dc("".concat(o.join(":")," > ").concat(a[3])),e.a(3,25);case 24:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 25:return e.a(3,27);case 26:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 27:return e.a(3,114);case 28:$=o[1],e.n="data"===$?29:62;break;case 29:K=o.slice(2).join(":"),e.n="x509:content:received:<subject>"===K?30:"x509:content:<subject>"===K?31:"chunk:root_cert:<bytes>"===K?32:"chunk:pub_key:signed:<bytes>"===K?35:"leads:content:<leads>"===K?36:"ice_offer:req:<processor_id>"===K?37:"processor:delete:<processor_id>:received"===K?40:"processor:delete:<processor_id>"===K?42:"ice_offer:content:<ice_offer>"===K?46:"ice_offer:content:updated:<ice_offer>"===K||"ice_offer:content:answered:<ice_offer>"===K?50:"ice_candidate:content:<ice_candidate>"===K?52:"processor:content:<processor>"===K?54:"processor:content:received:<processor>"===K?55:"tenants:content:<active_tenants>"===K?57:"channels:list:<rtmp_channels>"===K?59:60;break;case 30:return hc("received ".concat(o.join(":"))),e.a(2);case 31:return Ic(a[3])||dc("failed updating license info for tenant: ".concat(a[3].tenantId)),hc("received ".concat(o.join(":"))),e.a(2);case 32:return e.n=33,Wc(a[3],s,i);case 33:if(e.v){e.n=34;break}return dc("received ".concat(o.join(":"),"; invalid root cert")),e.a(2);case 34:return pc(),hc("received ".concat(o.join(":"))),e.a(2);case 35:return hc("received ".concat(o.join(":"))),e.a(2);case 36:return hc("received ".concat(o.join(":"))),Zo.leads=a[3],e.a(2);case 37:if(w=a[3],!(y=ku(w))||!y.isPilotEnabled){e.n=39;break}return hc("".concat(o.join(":")," for processor# ").concat(w)),e.n=38,y.resp2StreamReq(a[0]);case 38:e.v;case 39:return e.a(2);case 40:if(k=a[3]){e.n=41;break}return dc("".concat(o.join(":")," invalid processor id")),e.a(2);case 41:return Bu(k),hc("".concat(o.join(":")," with processor id: ").concat(k," answered.")),e.a(2);case 42:if(_=a[3]){e.n=43;break}return dc("".concat(o.join(":")," invalid processor id")),e.a(2);case 43:if(hc("".concat(o.join(":")," with processor id: ").concat(_," received.")),!(A=ku(_))){e.n=45;break}return e.n=44,yu(A,!0);case 44:gc({from:a[1],to:a[0],label:"tenant:data:processor:delete:<processor_id>:received",data:a[3]});case 45:return e.a(2);case 46:if(!(S=a[3])||!S.uid){e.n=50;break}if(hc("received ".concat(o.join(":")," with offer# ").concat(S.id," from runtime# ").concat(a[0])),C=lu(a[0])){e.n=47;break}return dc("".concat(o.join(":")," discarded. invalid session# ").concat(a[0])),e.a(2);case 47:if(!ku(S.processorId)){e.n=48;break}return e.a(2);case 48:return(x=Qu("live-preview-".concat(C.sessionId.split("-")[0]))).add_conn(a[0]),x.peerChannelCallback=function(){var e=fo(uo().m(function e(t){var r,n;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,r=Au().filter(function(e){return e.dat.sessionId==Yo&&(e.isLocalScreenStream||e.isLocalVideoStream)}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}),r&&bc({from:a[1],to:a[0],label:"tenant:data:processors:content:<processors>",data:{list:r}}),e.n=2;break;case 1:return e.p=1,n=e.v,dc("resp2RemoteStream > streamInitCallback > err: ".concat(n)),e.n=2,yu(x);case 2:return e.a(2)}},e,null,[[0,1]])}));return function(t){return e.apply(this,arguments)}}(),e.n=49,x.resp2RemoteStream(S);case 49:return e.a(2);case 50:if(!(B=a[3])||!B.uid){e.n=51;break}return hc("received ".concat(o.join(":")," with offer# ").concat(B.uid," from runtime# ").concat(a[0])),e.a(3,61);case 51:return e.a(2);case 52:if(!(E=a[3])||!E.id){e.n=53;break}if(!(P=null===(I=Zo.tenant.subscriptions[i])||void 0===I?void 0:I.get_conn())){e.n=53;break}return e.n=53,Ju(P,E.metadata);case 53:return e.a(3,61);case 54:return(N=a[3])&&(ou({list:[N]}),O=Au().filter(function(e){return e.Id()==N.id&&0==e.dat.name.indexOf("guest")}),1==O.length&&(O[0].dat=N),hc("".concat(o.join(":")," by runtime# ").concat(a[0]))),e.a(2);case 55:if(!a[3]||!a[3].id){e.n=56;break}return e.a(2);case 56:return dc("".concat(o.join(":")," failed in decoding")),e.a(2);case 57:return L=a[3],uu(L),e.n=58,hu();case 58:return hc("".concat(o.join(":")," by runtime# ").concat(a[0]),L),e.a(3,61);case 59:return Zo.channels=a[3],hc("".concat(o.join(":")," by runtime# ").concat(a[0]),Zo.channels),e.a(3,61);case 60:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 61:return e.a(3,63);case 62:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 63:return e.a(3,114);case 64:F=o[1],e.n="data"===F?65:69;break;case 65:a[3],M=o.slice(2).join(":"),e.n="contact:content:<contact>"===M||"contact:content:<contact>:received"===M||"message:content:<tenant_message>:received"===M||"message:content:<tenant_message>:confirmed"===M?66:67;break;case 66:return e.a(3,68);case 67:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 68:return e.a(3,70);case 69:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 70:return e.a(3,114);case 71:J=o[1],e.n="authenticated"===J?72:"profile"===J?73:"fs"===J?76:"file"===J?80:"intd"===J?81:"init"===J?83:"bootstrapped"===J?84:"bootstrap"===J?85:"logout"===J?86:"conn"===J?90:"dchn"===J?94:"system"===J?98:"peer"===J?107:"content"===J?110:111;break;case 72:return hc("".concat(o.join(":")," tenant authenticated.")),e.a(3,112);case 73:o[2],e.n=74;break;case 74:return hc("".concat(o.join(":")," by local")),e.a(2);case 75:return e.a(3,112);case 76:z=o[2],e.n="bootstrapped"===z?77:78;break;case 77:return e.a(3,79);case 78:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 79:return e.a(3,112);case 80:return U=new CustomEvent("browser-file-saved",{detail:o.join(":")}),document.dispatchEvent(U),e.a(3,112);case 81:return e.n=82,tu("/inori");case 82:return hc("compute vm initialised."),e.a(3,112);case 83:return hc("compute vm initialising in process."),e.a(3,112);case 84:return hc("compute vm bootstrapped. _this.env.in_session: ".concat(Qo)),e.a(3,112);case 85:return hc("compute vm bootstrap in process."),e.a(3,112);case 86:q=o[2],e.n="done"===q||"timeout"===q?87:88;break;case 87:return hc("".concat(o.join(":")," by local")),e.a(3,89);case 88:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 89:return e.a(3,112);case 90:W=o[2],e.n="timeout"===W||"ice_gather"===W||"ice_gather_completed"===W?91:92;break;case 91:return hc("".concat(o.join(":")," by local")),e.a(3,93);case 92:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 93:return e.a(3,112);case 94:Z=o[2],e.n="close"===Z||"failed"===Z||"error"===Z||"closg"===Z||"disconnected"===Z||"open"===Z?95:96;break;case 95:return hc("".concat(o.join(":")," by local")),e.a(3,97);case 96:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 97:return e.a(3,112);case 98:G=o.slice(2).join(":"),e.n="protobuf:<enum>"===G?99:"event:<string>"===G?100:"closed"===G?101:"open"===G?103:105;break;case 99:return hc("".concat(o.join(":"),":"),a[3]),Wo=a[3],e.a(3,106);case 100:return lc(a[3]),e.a(3,106);case 101:return Qo=!1,e.n=102,pc();case 102:return e.a(3,106);case 103:return e.n=104,vc();case 104:return e.a(3,106);case 105:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 106:return e.a(3,112);case 107:Q=o[2],e.n="send"===Q?108:"rcvd"===Q?109:110;break;case 108:return(j=Zo.tenant.subscriptions[s])&&j.peerChannel&&"open"==j.peerChannel.readyState&&j.peerChannel.send(a[3]),e.a(2);case 109:return(D=Zo.tenant.subscriptions[i])&&D.peerChannel&&D.peerChannel.onmessage&&D.peerChannel.onmessage({data:{from:i,to:s,label:t.data.label_2_forward,data:a[3]},type:"message",target:D.peerChannel}),e.a(2);case 110:return Zo.content=a[3],hc("".concat(o.join(":"),":"),a[3]),e.a(2);case 111:return hc("".concat(o.join(":"),":"),"unprocessed"),e.a(2);case 112:return e.a(3,114);case 113:return hc("".concat(o.join(":")," unprocessed")),e.a(2);case 114:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),rl=function(){var e=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:e.n=1;break;case 1:return e.n=2,Co("workers/inori.js");case 2:return e.a(2,new Promise(function(){var e=fo(uo().m(function e(t,r){return uo().w(function(e){for(;;)switch(e.n){case 0:Module.onRuntimeInitialized=fo(uo().m(function e(){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:(qo=new Worker("workers/mq-worker.".concat("min.","js"))).onmessage=tl,r={env:{channels:function(){return Zo.channels.list},scenes:{earth:!1,nav:!1,room:!1},sceneStats:{objects:[],isStreetView:!0},content:el,bridge_id:function(){return Jo},bridge_sbj:function(){return!!zo&&Rc(zo)},in_session:function(){return Qo},name:bo},mq:{set_message_info:mu,msg_ts:function(e){return ec.get(e)||[]},msg_infos:function(){return Zo.message_infos.list.sort(function(e,t){return e.label.localeCompare(t.label)})},sys_dbg:function(e){hc(e)},event:Xo,worker:function(){return qo}},tenant:{kill_channel:function(e){return gc({label:"admin:data:service:status:<setting>",data:{isLive:!1,metadataExt2:e}}),new Promise(function(t){var r=!1;window.addEventListener("admin:data:service:status:<setting>:confirmed",function(){var n=fo(uo().m(function n(a){var i;return uo().w(function(n){for(;;)switch(n.n){case 0:a.detail.content.metadataExt2==e?(t(!0),r=!0):(i=new CustomEvent(a.type,{detail:a.detail,bubbles:a.bubbles,cancelable:a.cancelable,composed:a.composed}),window.dispatchEvent(i));case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){r||t(!1)})})},get_channels:function(){return gc({label:"tenant:data:channels:list:req"}),new Promise(function(e){var t=!1;window.addEventListener("tenant:data:channels:list:<rtmp_channels>",function(r){Zo.channels=r.detail.content,t=!0;var n=Zo.channels.list;e(n)},{once:!0}),xo(5e3).then(function(){t||e(!1)})})},get_file_type_values:function(){return Wo.FileType.values},get_file_chunks:function(){return Zo.file_chunks},get_mini_files:function(){return Zo.mini_files},get_video_file:function(e,t,r,n,a){Zo.file_chunks[r]={fileId:r},bc({from:Yo,to:e,label:"tenant:video:chunk:process:req:<file_desc>",data:{path:t,metadata:r,type:n,contentType:a}})},get_remote_file:function(e,t,r,n,a){Zo.file_chunks[r]={fileId:r},bc({from:Yo,to:e,label:"tenant:data:chunk:content:req:<file_desc>",data:{path:t,metadata:r,type:n,contentType:a,isLive:!1}})},stop_remote_file:function(e,t,r){bc({from:Yo,to:e,label:"service:drive:file:chunk:del:<file_chunks>",data:{metadata:t,metadataExt1:r}})},upd_remote_file_list:function(e,t,r){bc({from:Yo,to:e,label:"service:drive:content:dir:req:<file_desc>",data:{path:t}}),Zo.directory_list={remoteId:e,root:t,files:[]},window.addEventListener("service:drive:content:dir:<file_descs>",function(e){if(e.detail.content&&e.detail.content.list){var t=Zo.directory_list,n=e.detail.content.list;n=n.filter(function(e){return!t.files.some(function(t){return"".concat(e.path,"/").concat(e.name)==="".concat(t.path,"/").concat(t.name)})}),t.files=[].concat(mo(t.files),mo(n)),r&&r(t)}})},req_drive_backup:function(e,t,r,n,a){bc({from:Yo,to:e,label:"service:drive:backup:req:<file_desc>",data:{name:t,path:r,metadata:n,metadata1:a}})},api_keys:function(){return Zo.tenant.apiKeys},session_info:function(){return Zo.tenants.list.find(function(e){return e.sessionId.toLowerCase()==Yo.toLowerCase()})},subject:function(){return Zo.tenant.subject},disable_license:function(e){gc({label:"admin:data:license:expire:<serial_number>",data:e})},renew_license:function(e){gc({label:"admin:data:license:renew:<serial_number>",data:e})},download_license:function(e){gc({label:"tenant:data:chunk:pub_key:signed:req",data:e}),window.addEventListener("tenant:data:chunk:pub_key:signed:<bytes>",function(){var t=fo(uo().m(function t(r){return uo().w(function(t){for(;;)switch(t.n){case 0:Hc(r.detail.content).asFile(e);case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),{once:!0})},get_subjects:Ec,get_subject_upd_reqs:function(e){return Zo.subject_reqs[e]||[]},del_subject_upd_req:function(e,t){var r=Zo.subject_reqs[e]&&Zo.subject_reqs[e].filter(function(e){return e.metadata!=t});Zo.subject_reqs[e]=r},cred:function(){return Zo.tenant.cred},get_geo_locations:function(){return Zo.geo_locations.list},get_subscription:function(e){if(!e)return!1;var t,r=ru().find(function(t){return t.sessionId==e});if(t=r?Object.values(Zo.tenant.subscriptions).find(function(e){return e.sessionId==r.sessionId}):Zo.tenant.subscriptions[e]){if(t.sessionId!=r.sessionId&&(t.unsubscribe(),t.sessionId=r.sessionId),r.sessionId.toLowerCase()==Yo.toLowerCase())return t;var n;if("connected"==(null===(n=t.get_conn())||void 0===n?void 0:n.connectionState))return t;hc("remote subscription# ".concat(t.Id()," not connected"))}},get_command_values:function(){return Wo.Command.values},add_processor:Qu,del_processor:yu,get_processor:ku,get_remote_processors:Su,get_remote_processors_in_groups:Cu,get_remote_processor:xu,del_remote_processor:Eu,get_processors:Au,get_processors_by_session_id:_u,set_file:function(e,t){Zo.tenant.file_map[e]=t},has_local_stream_processor:function(){return Au().filter(function(e){return e.dat.sessionId==Yo&&(e.isLocalScreenStream||e.isLocalVideoStream||e.localFileStream)}).length>0},add_notification:bu,notifications:function(){var e=Zo.tenant.notifications.filter(function(e){return"local:system:event:<string>"!=e.msg}).sort(function(e,t){return t.last_update-e.last_update});return e},logs:function(){var e=Zo.tenant.notifications.filter(function(e){return"local:system:event:<string>"==e.msg}).sort(function(e,t){return t.last_update-e.last_update});return e},dataset:function(){return Zo},dataType:function(){return Wo},session_id:function(){return Yo},bridge_id:function(){return Jo},clog:lc,exit_session:function(){var e=fo(uo().m(function e(t){var r,n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:for(Zo.tenant.processors.forEach(function(e){e&&(e.stop_mediaStream(),e.deinit(),e=null)}),Zo.tenant.processors=[],r=0,n=Object.entries(Zo.tenant.subscriptions);r<n.length;r++)(a=co(n[r],2))[0],a[1].dispose();return Zo.tenant.subscriptions={},e.n=1,wu();case 1:FS.unmount("/inori"),FS.rmdir("/inori");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),answer_offer:qu,checkout_offer:function(e){var t=Object.values(Zo.tenant.ice_offers).filter(function(t){return t.uid.toLowerCase()==e.dat.remoteId.toLowerCase()}).sort(function(e,t){return t.lastUpdate>e.dat.lastUpdate});if(t.length>0)return t[0]},standby_screen_sharing:du,standby_video_sharing:fu,resume_offer:function(e){var t=Object.values(Zo.tenant.ice_offers).filter(function(t){return t.aid&&t.aid.toLowerCase()==e.dat.remoteId.toLowerCase()}).sort(function(e,t){return t.lastUpdate>e.dat.lastUpdate});if(t.length>0)return t[0]},create_offer:zu,update_offer:Wu,create_contact:function(e){return e.LastName||(e.LastName=e.Email),gc({to:Jo,label:"guest:data:contact:content:<contact>",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:contact:content:<contact>:received",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:e(!0),t=!0;case 1:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),xo(15e3).then(function(){t||e(!1)})})},get_bridge_offers:function(){return!!(Zo.ice_offers&&Zo.ice_offers.list&&Zo.ice_offers.list.length>0)&&Zo.ice_offers},get_active_tenants_owned_by_current_session:function(){return ru().filter(function(e){return e.id.toLowerCase()==Zo.tenant.subject.serialnumber.val.toLowerCase()})},get_active_tenants:ru,get_active_services:nu,get_tenant_role_by_session_id:iu,get_vendors:au,get_tkn:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Yc();case 1:return r=e.v,e.a(2,btoa("".concat(Yo,":").concat(r)))}},e)}));return function(t){return e.apply(this,arguments)}}(),get_shadow_tkn:function(e){gc({to:e,label:"tenant:tcp:forward:req:<token>",data:""})},upd_x509_sbj:function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fc(t);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}()},util:{get_app_metrics:function(e){gc({to:e,label:"admin:system:profile:metric:<keys>",data:{keys:["/app/profile:10:10","/app/process:5","/cpu/classes/gc/mark/assist:cpu-seconds"]}})},get_sys_profile:function(){},fileExists:Iu,syncFiles:Ou,normalizePath:$o,findKeyByValue:To,formatUnix2Detail:Ro,formatUnix2Date:Vo,validateCurrentTime:Ho,dbg:hc,exp:dc,sql:{get_leads:function(){return Zo.leads.list.length<1&&gc({label:"tenant:sql:query:<sql>",data:{table:"leads",type:Wo.SqlType.values.SELECT,limit:100}}),Zo.leads}},verify_msg:function(e){return e.id=Yo,e.lastUpdate=(new Date).getTime(),gc({to:Jo,label:"guest:data:message:content:<tenant_message>",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:message:content:<tenant_message>:received",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:e(n.detail.content),t=!0;case 1:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){t||e(!1)})})},validt_num:function(e){return e.id=Yo,e.messageType=Wo.MessageType.values.IVR,e.lastUpdate=(new Date).getTime(),gc({to:Jo,label:"guest:data:message:content:<tenant_message>:confirm",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:message:content:<tenant_message>:confirmed",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:e(!0),t=!0;case 1:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){t||e(!1)})})},del_trainer_file:function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Nu("/inori/model/json/".concat(t));case 1:return e.n=2,Nu("/inori/model/weight/".concat(t));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),get_trainer_models:Yu,get_prediction_size:jo,set_prediction:function(){var e=fo(uo().m(function e(t,r,n,a){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!a){e.n=1;break}bc({from:Yo,to:null==r?void 0:r.sessionId,label:"tenant:data:prediction:setup:<prediction>",data:n}),e.n=2;break;case 1:return e.n=2,t.configTrainer(n);case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),train_prediction:function(){var e=fo(uo().m(function e(t,r,n,a){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!a){e.n=1;break}bc({from:Yo,to:null==r?void 0:r.sessionId,label:"tenant:data:prediction:train:<prediction>",data:n}),e.n=2;break;case 1:return e.n=2,t.procTrainer();case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),unset_prediction:function(){var e=fo(uo().m(function e(t,r,n,a){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!a){e.n=1;break}bc({from:Yo,to:null==r?void 0:r.sessionId,label:"tenant:data:prediction:unset:<prediction>",data:n}),e.n=2;break;case 1:return e.n=2,t.disableTrainer(n);case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),capture_frame:function(e,t){var r=Bo(150,t),n=xu(null==e?void 0:e.Id());n&&(n.screenshot=r,hc("video frame captured"))},capture_frame_area:function(e,t){return Eo(t,e)},delayFunction:xo,model:function(){return _model},calculateElapsedMinutes:Io,init_comm:function(){var e=fo(uo().m(function e(){var t=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:if(!(t.length>0&&void 0!==t[0]&&t[0])){e.n=2;break}return e.n=1,mc();case 1:if(e.v){e.n=2;break}return e.a(2,!1);case 2:return e.n=3,xo(100);case 3:if(!Qo){e.n=4;break}return e.a(2,Promise.resolve(!0));case 4:e.n=2;break;case 5:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),dir:{info:function(){return Zo.tenant.file_info_map},load:Bc},clog:lc,download_cert:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pc(Zo.tenant.file_info_map.dir[t]);case 1:return r=e.v,e.a(2,r.asFile())}},e)}));return function(t){return e.apply(this,arguments)}}(),download_pkey:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Nc(Zo.tenant.file_info_map.dir[t]);case 1:return r=e.v,e.a(2,r.asFile())}},e)}));return function(t){return e.apply(this,arguments)}}(),bootstrap_bridge_keypairs:eu,get_sbj_by_key:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pc(Zo.tenant.file_info_map.dir[t]);case 1:if(!(r=e.v)){e.n=2;break}return e.a(2,Rc(r.asCert()));case 2:return e.a(2,!1)}},e)}));return function(t){return e.apply(this,arguments)}}(),replace_keypair:function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=Zo.tenant.file_info_map.dir,e.n=1,Pu(t.tmp_pkey,t.pkey);case 1:return r=e.v,e.n=2,Pu(t.tmp_cert,t.cert);case 2:if(n=e.v,!r||!n){e.n=3;break}return e.a(2,!0);case 3:return e.a(2,!1)}},e)}));return function(){return e.apply(this,arguments)}}(),convert_path_2_Id:Ko,read_image_obj:Du,write_file:function(e,t,r){return new Promise(function(){var e=fo(uo().m(function e(n,a){var i,s;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Fu(t,r);case 1:if(!(i=Du(r))){e.n=2;break}n(i),e.n=3;break;case 2:throw new Error("read_image_obj err");case 3:e.n=5;break;case 4:e.p=4,s=e.v,a(s);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t,r){return e.apply(this,arguments)}}())},write_blob_2_file:$u,write_arrbuf_2_file:Ku,read_blob_2_str:Tu,parse_pvtkey_str:Fc,parse_pubkey_str:Mc,parse_cert_str:Kc,clear_comm:function(){return Promise.resolve(!0)},exit_session:function(e){return new Promise(function(){var t=fo(uo().m(function t(r){var n;return uo().w(function(t){for(;;)switch(t.n){case 0:return n=!1,t.n=1,e.tenant.exit_session(e);case 1:window.addEventListener("admin:system:event:tenant_exit:received",function(t){e.env.in_session=!1,r(t.detail),n=!0},{once:!0}),xo(5e3).then(function(){n||(dc("exit_session time out"),r(!1))}),e.util.clear_comm().then(function(e){gc({label:"admin:system:event:tenant_exit",data:"placeholder"})});case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())},get_jwt_cred:function(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)},bootstrap_fs:tu,theme_event_registry:_o}},t(r);case 1:return e.a(2)}},e)}));case 1:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}()))}},e)}));return function(){return e.apply(this,arguments)}}();function nl(e){return nl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nl(e)}function al(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function il(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(r,n,a,i){var c=n&&n.prototype instanceof o?n:o,u=Object.create(c.prototype);return sl(u,"_invoke",function(r,n,a){var i,o,c,u=0,l=a||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return i=t,o=0,c=e,d.n=r,s}};function f(r,n){for(o=r,c=n,t=0;!h&&u&&!a&&t<l.length;t++){var a,i=l[t],f=d.p,m=i[2];r>3?(a=m===n)&&(c=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=f&&((a=r<2&&f<i[1])?(o=0,d.v=n,d.n=i[1]):f<m&&(a=r<3||i[0]>n||n>m)&&(i[4]=r,i[5]=n,d.n=m,o=0))}if(a||r>1)return s;throw h=!0,n}return function(a,l,m){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,m),o=l,c=m;(t=o<2?e:c)||!h;){i||(o?o<3?(o>1&&(d.n=-1),f(o,c)):d.n=c:d.v=c);try{if(u=2,i){if(o||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=e}else if((t=(h=d.n<0)?c:r.call(n,d))!==s)break}catch(t){i=e,o=1,c=t}finally{u=1}}return{value:t,done:h}}}(r,a,i),!0),u}var s={};function o(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(sl(t={},n,function(){return this}),t),h=u.prototype=o.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,sl(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,sl(h,"constructor",u),sl(u,"constructor",c),c.displayName="GeneratorFunction",sl(u,a,"GeneratorFunction"),sl(h),sl(h,a,"Generator"),sl(h,n,function(){return this}),sl(h,"toString",function(){return"[object Generator]"}),(il=function(){return{w:i,m:d}})()}function sl(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}sl=function(e,t,r,n){function i(t,r){sl(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},sl(e,t,r,n)}function ol(e,t,r,n,a,i,s){try{var o=e[i](s),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function cl(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function s(e){ol(i,n,a,s,o,"next",e)}function o(e){ol(i,n,a,s,o,"throw",e)}s(void 0)})}}function ul(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ll(n.key),n)}}function ll(e){var t=function(e){if("object"!=nl(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=nl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==nl(t)?t:t+""}function hl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(hl=function(){return!!e})()}function dl(e){return dl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dl(e)}function fl(e,t){return fl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fl(e,t)}var ml=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,r){return t=dl(t),function(e,t){if(t&&("object"==nl(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,hl()?Reflect.construct(t,r||[],dl(e).constructor):t.apply(e,r))}(this,t)).index=-1,e.content=null,e.inori=null,e.loadInori(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fl(e,t)}(t,e),function(e,t,r){return t&&ul(e.prototype,t),r&&ul(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"firstUpdated",value:(a=cl(il().m(function e(){return il().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return a.apply(this,arguments)})},{key:"updated",value:function(e){}},{key:"_loggedInHandler",value:(n=cl(il().m(function e(){return il().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return n.apply(this,arguments)})},{key:"handleScrolling",value:function(e){document.getElementById(e).scrollIntoView({behavior:"smooth"})}},{key:"loadInori",value:(r=cl(il().m(function e(){var t,r=this;return il().w(function(e){for(;;)switch(e.n){case 0:return t=this,window.addEventListener("local:intd",function(){var e=cl(il().m(function e(n){return il().w(function(e){for(;;)switch(e.n){case 0:if(!t.inori){e.n=4;break}return t.inori.mq.sys_dbg("inori initialised"),t.content=t.inori.env.content,e.n=1,t.inori.util.init_comm(!1);case 1:if(!e.v){e.n=3;break}return e.n=2,t.inori.util.dir.load();case 2:t.inori.mq.sys_dbg("credential established");case 3:r.requestUpdate();case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),e.n=1,rl();case 1:t.inori=e.v;case 2:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"render",value:function(){var e=this;if(!this.content||this.index<0)return q(rc||(rc=al([""])));var t=this.content.get(this.index),r=this.content.getAllL1(this.index),n=this.content.getAllL2(this.index),a=this.content.getAllL3(this.index);return t&&r&&n&&a?q(ac||(ac=al(['\n<main class="col-lg-12 py-md-4 px-md-4">\n<h1 class="fw-lighter text-center mb-5">','</h1>\n  <div class="row">\n     <div class="col mb-4">\n       <ul>\n       ','\n       </ul>\n    </div>    \n    <div class="col mb-4"> \n      <p class="fs-6 fw-lighter">\n        ','\n      </p>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col mb-4"> \n\n  ',"\n    </div>\n  </div>\n</main>"])),t,r.map(function(t){return q(ic||(ic=al(['\n        <li role="button" @click="','">',"</li>"])),function(t){e.handleScrolling("h4-aot")},t)}),a,r.map(function(e,t){return q(sc||(sc=al(['\n      <h4 id="h4-aot" class="fw-lighter">','</h4>\n      <p class="mb-5">',"</p>\n      ",""])),e,n[t],n[t].length>1?q(oc||(oc=al(['\n      <ul class="mb-5">\n      ',"\n      </ul>\n"])),n[t].map(function(e){return q(cc||(cc=al(["\n        <li>","</li>\n        "])),e)})):q(uc||(uc=al([""]))))})):q(nc||(nc=al([""])))}}],[{key:"properties",get:function(){return{index:{type:Number}}}}]);var r,n,a}(he);customElements.define("corp-article",ml)})();