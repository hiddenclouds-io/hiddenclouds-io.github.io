/*! For license information please see corp-article.min.js.LICENSE.txt */
(()=>{"use strict";var t={152:(e,t)=>{class r{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=r.toUint8Array(e),a=r.toUint8Array(t);if(n.length!==a.byteLength)return!1;for(let e=0;e<n.length;e++)if(n[e]!==a[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let r=0;for(const e of t)r+=e.byteLength;const n=new Uint8Array(r);let a=0;for(const e of t){const t=this.toUint8Array(e);n.set(t,a),a+=t.length}return e[e.length-1]instanceof Function?this.toView(n,e[e.length-1]):n.buffer}}const n="string",a=/^[0-9a-f\s]+$/i,i=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,s=/^[a-zA-Z0-9-_]+$/;class o{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){const t=r.toUint8Array(e);let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return decodeURIComponent(escape(n))}}class c{static toString(e,t=!1){const n=r.toArrayBuffer(e),a=new DataView(n);let i="";for(let e=0;e<n.byteLength;e+=2){const r=a.getUint16(e,t);i+=String.fromCharCode(r)}return i}static fromString(e,t=!1){const r=new ArrayBuffer(2*e.length),n=new DataView(r);for(let r=0;r<e.length;r++)n.setUint16(2*r,e.charCodeAt(r),t);return r}}class u{static isHex(e){return typeof e===n&&a.test(e)}static isBase64(e){return typeof e===n&&i.test(e)}static isBase64Url(e){return typeof e===n&&s.test(e)}static ToString(e,t="utf8"){const n=r.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return c.toString(n,!0);case"utf16":case"utf16be":return c.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return c.fromString(e,!0);case"utf16":case"utf16be":return c.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=r.toUint8Array(e);if("undefined"!=typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!u.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!u.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=u.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return o.fromString(e);case"utf16":case"utf16be":return c.fromString(e);case"utf16le":case"usc2":return c.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=u.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return o.toString(e);case"utf16":case"utf16be":return c.toString(e);case"utf16le":case"usc2":return c.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}static ToBinary(e){const t=r.toUint8Array(e);let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return n}static ToHex(e){const t=r.toUint8Array(e);let n="";const a=t.length;for(let e=0;e<a;e++){const r=t[e];r<16&&(n+="0"),n+=r.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!u.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const n=t.slice(e,e+2);r[e/2]=parseInt(n,16)}return r.buffer}static ToUtf16String(e,t=!1){return c.toString(e,t)}static FromUtf16String(e,t=!1){return c.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}u.DEFAULT_UTF8_ENCODING="utf8",t._H=r,t.U$=u}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const a=globalThis,i=a.ShadowRoot&&(void 0===a.ShadyCSS||a.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class c{constructor(e,t,r){if(this._$cssResult$=!0,r!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(i&&void 0===e){const r=void 0!==t&&1===t.length;r&&(e=o.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&o.set(t,e))}return e}toString(){return this.cssText}}const u=(e,t)=>{if(i)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const r of t){const t=document.createElement("style"),n=a.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=r.cssText,e.appendChild(t)}},l=i?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const r of e.cssRules)t+=r.cssText;return(e=>new c("string"==typeof e?e:e+"",void 0,s))(t)})(e):e,{is:h,defineProperty:f,getOwnPropertyDescriptor:d,getOwnPropertyNames:m,getOwnPropertySymbols:p,getPrototypeOf:g}=Object,v=globalThis,b=v.trustedTypes,w=b?b.emptyScript:"",y=v.reactiveElementPolyfillSupport,k=(e,t)=>e,_={toAttribute(e,t){switch(t){case Boolean:e=e?w:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=null!==e;break;case Number:r=null===e?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch(e){r=null}}return r}},A=(e,t)=>!h(e,t),S={attribute:!0,type:String,converter:_,reflect:!1,useDefault:!1,hasChanged:A};Symbol.metadata??=Symbol("metadata"),v.litPropertyMetadata??=new WeakMap;class C extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=S){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const r=Symbol(),n=this.getPropertyDescriptor(e,r,t);void 0!==n&&f(this.prototype,e,n)}}static getPropertyDescriptor(e,t,r){const{get:n,set:a}=d(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:n,set(t){const i=n?.call(this);a?.call(this,t),this.requestUpdate(e,i,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??S}static _$Ei(){if(this.hasOwnProperty(k("elementProperties")))return;const e=g(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(k("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(k("properties"))){const e=this.properties,t=[...m(e),...p(e)];for(const r of t)this.createProperty(r,e[r])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,r]of t)this.elementProperties.set(e,r)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const r=this._$Eu(e,t);void 0!==r&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const e of r)t.unshift(l(e))}else void 0!==e&&t.push(l(e));return t}static _$Eu(e,t){const r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const r of t.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return u(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){const r=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,r);if(void 0!==n&&!0===r.reflect){const a=(void 0!==r.converter?.toAttribute?r.converter:_).toAttribute(t,r.type);this._$Em=e,null==a?this.removeAttribute(n):this.setAttribute(n,a),this._$Em=null}}_$AK(e,t){const r=this.constructor,n=r._$Eh.get(e);if(void 0!==n&&this._$Em!==n){const e=r.getPropertyOptions(n),a="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:_;this._$Em=n;const i=a.fromAttribute(t,e.type);this[n]=i??this._$Ej?.get(n)??i,this._$Em=null}}requestUpdate(e,t,r){if(void 0!==e){const n=this.constructor,a=this[e];if(r??=n.getPropertyOptions(e),!((r.hasChanged??A)(a,t)||r.useDefault&&r.reflect&&a===this._$Ej?.get(e)&&!this.hasAttribute(n._$Eu(e,r))))return;this.C(e,t,r)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:r,reflect:n,wrapped:a},i){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,i??t??this[e]),!0!==a||void 0!==i)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),!0===n&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,r]of e){const{wrapped:e}=r,n=this[t];!0!==e||this._$AL.has(t)||void 0===n||this.C(t,void 0,r,n)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}}C.elementStyles=[],C.shadowRootOptions={mode:"open"},C[k("elementProperties")]=new Map,C[k("finalized")]=new Map,y?.({ReactiveElement:C}),(v.reactiveElementVersions??=[]).push("2.1.1");const x=globalThis,B=x.trustedTypes,E=B?B.createPolicy("lit-html",{createHTML:e=>e}):void 0,I="$lit$",P=`lit$${Math.random().toFixed(9).slice(2)}$`,N="?"+P,O=`<${N}>`,L=document,U=()=>L.createComment(""),j=e=>null===e||"object"!=typeof e&&"function"!=typeof e,D=Array.isArray,R="[ \t\n\f\r]",V=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,H=/-->/g,T=/>/g,$=RegExp(`>|${R}(?:([^\\s"'>=/]+)(${R}*=${R}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),K=/'/g,F=/"/g,M=/^(?:script|style|textarea|title)$/i,J=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),z=J(1),q=(J(2),J(3),Symbol.for("lit-noChange")),W=Symbol.for("lit-nothing"),Z=new WeakMap,G=L.createTreeWalker(L,129);function Q(e,t){if(!D(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==E?E.createHTML(t):t}const Y=(e,t)=>{const r=e.length-1,n=[];let a,i=2===t?"<svg>":3===t?"<math>":"",s=V;for(let t=0;t<r;t++){const r=e[t];let o,c,u=-1,l=0;for(;l<r.length&&(s.lastIndex=l,c=s.exec(r),null!==c);)l=s.lastIndex,s===V?"!--"===c[1]?s=H:void 0!==c[1]?s=T:void 0!==c[2]?(M.test(c[2])&&(a=RegExp("</"+c[2],"g")),s=$):void 0!==c[3]&&(s=$):s===$?">"===c[0]?(s=a??V,u=-1):void 0===c[1]?u=-2:(u=s.lastIndex-c[2].length,o=c[1],s=void 0===c[3]?$:'"'===c[3]?F:K):s===F||s===K?s=$:s===H||s===T?s=V:(s=$,a=void 0);const h=s===$&&e[t+1].startsWith("/>")?" ":"";i+=s===V?r+O:u>=0?(n.push(o),r.slice(0,u)+I+r.slice(u)+P+h):r+P+(-2===u?t:h)}return[Q(e,i+(e[r]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),n]};class X{constructor({strings:e,_$litType$:t},r){let n;this.parts=[];let a=0,i=0;const s=e.length-1,o=this.parts,[c,u]=Y(e,t);if(this.el=X.createElement(c,r),G.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(n=G.nextNode())&&o.length<s;){if(1===n.nodeType){if(n.hasAttributes())for(const e of n.getAttributeNames())if(e.endsWith(I)){const t=u[i++],r=n.getAttribute(e).split(P),s=/([.?@])?(.*)/.exec(t);o.push({type:1,index:a,name:s[2],strings:r,ctor:"."===s[1]?ae:"?"===s[1]?ie:"@"===s[1]?se:ne}),n.removeAttribute(e)}else e.startsWith(P)&&(o.push({type:6,index:a}),n.removeAttribute(e));if(M.test(n.tagName)){const e=n.textContent.split(P),t=e.length-1;if(t>0){n.textContent=B?B.emptyScript:"";for(let r=0;r<t;r++)n.append(e[r],U()),G.nextNode(),o.push({type:2,index:++a});n.append(e[t],U())}}}else if(8===n.nodeType)if(n.data===N)o.push({type:2,index:a});else{let e=-1;for(;-1!==(e=n.data.indexOf(P,e+1));)o.push({type:7,index:a}),e+=P.length-1}a++}}static createElement(e,t){const r=L.createElement("template");return r.innerHTML=e,r}}function ee(e,t,r=e,n){if(t===q)return t;let a=void 0!==n?r._$Co?.[n]:r._$Cl;const i=j(t)?void 0:t._$litDirective$;return a?.constructor!==i&&(a?._$AO?.(!1),void 0===i?a=void 0:(a=new i(e),a._$AT(e,r,n)),void 0!==n?(r._$Co??=[])[n]=a:r._$Cl=a),void 0!==a&&(t=ee(e,a._$AS(e,t.values),a,n)),t}class te{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:r}=this._$AD,n=(e?.creationScope??L).importNode(t,!0);G.currentNode=n;let a=G.nextNode(),i=0,s=0,o=r[0];for(;void 0!==o;){if(i===o.index){let t;2===o.type?t=new re(a,a.nextSibling,this,e):1===o.type?t=new o.ctor(a,o.name,o.strings,this,e):6===o.type&&(t=new oe(a,this,e)),this._$AV.push(t),o=r[++s]}i!==o?.index&&(a=G.nextNode(),i++)}return G.currentNode=L,n}p(e){let t=0;for(const r of this._$AV)void 0!==r&&(void 0!==r.strings?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}}class re{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,r,n){this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=ee(this,e,t),j(e)?e===W||null==e||""===e?(this._$AH!==W&&this._$AR(),this._$AH=W):e!==this._$AH&&e!==q&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>D(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==W&&j(this._$AH)?this._$AA.nextSibling.data=e:this.T(L.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:r}=e,n="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=X.createElement(Q(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new te(n,this),r=e.u(this.options);e.p(t),this.T(r),this._$AH=e}}_$AC(e){let t=Z.get(e.strings);return void 0===t&&Z.set(e.strings,t=new X(e)),t}k(e){D(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let r,n=0;for(const a of e)n===t.length?t.push(r=new re(this.O(U()),this.O(U()),this,this.options)):r=t[n],r._$AI(a),n++;n<t.length&&(this._$AR(r&&r._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class ne{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,n,a){this.type=1,this._$AH=W,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=a,r.length>2||""!==r[0]||""!==r[1]?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=W}_$AI(e,t=this,r,n){const a=this.strings;let i=!1;if(void 0===a)e=ee(this,e,t,0),i=!j(e)||e!==this._$AH&&e!==q,i&&(this._$AH=e);else{const n=e;let s,o;for(e=a[0],s=0;s<a.length-1;s++)o=ee(this,n[r+s],t,s),o===q&&(o=this._$AH[s]),i||=!j(o)||o!==this._$AH[s],o===W?e=W:e!==W&&(e+=(o??"")+a[s+1]),this._$AH[s]=o}i&&!n&&this.j(e)}j(e){e===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ae extends ne{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===W?void 0:e}}class ie extends ne{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==W)}}class se extends ne{constructor(e,t,r,n,a){super(e,t,r,n,a),this.type=5}_$AI(e,t=this){if((e=ee(this,e,t,0)??W)===q)return;const r=this._$AH,n=e===W&&r!==W||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,a=e!==W&&(r===W||n);n&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class oe{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){ee(this,e)}}const ce=x.litHtmlPolyfillSupport;ce?.(X,re),(x.litHtmlVersions??=[]).push("3.3.1");const ue=globalThis;class le extends C{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,r)=>{const n=r?.renderBefore??t;let a=n._$litPart$;if(void 0===a){const e=r?.renderBefore??null;n._$litPart$=a=new re(t.insertBefore(U(),e),e,void 0,r??{})}return a._$AI(e),a})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return q}}le._$litElement$=!0,le.finalized=!0,ue.litElementHydrateSupport?.({LitElement:le});const he=ue.litElementPolyfillSupport;he?.({LitElement:le}),(ue.litElementVersions??=[]).push("4.2.1");var fe=n(152);function de(e,t,r){var n;return e instanceof Object==0?r:null!==(n=e[t])&&void 0!==n?n:r}function me(e,t=0,r=e.byteLength-t,n=!1){let a="";for(const i of new Uint8Array(e,t,r)){const e=i.toString(16).toUpperCase();1===e.length&&(a+="0"),a+=e,n&&(a+=" ")}return a.trim()}function pe(e,t){let r=0;if(1===e.length)return e[0];for(let n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function ge(e,t,r=-1){const n=r;let a=e,i=0,s=Math.pow(2,t);for(let r=1;r<8;r++){if(e<s){let e;if(n<0)e=new ArrayBuffer(r),i=r;else{if(n<r)return new ArrayBuffer(0);e=new ArrayBuffer(n),i=n}const s=new Uint8Array(e);for(let e=r-1;e>=0;e--){const r=Math.pow(2,e*t);s[i-e-1]=Math.floor(a/r),a-=s[i-e-1]*r}return e}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function ve(...e){let t=0,r=0;for(const r of e)t+=r.byteLength;const n=new ArrayBuffer(t),a=new Uint8Array(n);for(const t of e)a.set(new Uint8Array(t),r),r+=t.byteLength;return n}function be(...e){let t=0,r=0;for(const r of e)t+=r.length;const n=new ArrayBuffer(t),a=new Uint8Array(n);for(const t of e)a.set(t,r),r+=t.length;return a}function we(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],r=0===e[0]&&!(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(t);for(let e=0;e<this.valueHex.byteLength;e++)r[e]=0;r[0]=128&e[0];const n=pe(r,8),a=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(a);for(let t=0;t<this.valueHex.byteLength;t++)i[t]=e[t];return i[0]&=127,pe(i,8)-n}function ye(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}function ke(e,t){const r=e.toString(10);if(t<r.length)return"";const n=t-r.length,a=new Array(n);for(let e=0;e<n;e++)a[e]="0";return a.join("").concat(r)}const _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Se(e,t=!1,r=!1,n=!1){let a=0,i=0,s=0,o="";const c=t?Ae:_e;if(n){let t=0;for(let r=0;r<e.length;r++)if(0!==e.charCodeAt(r)){t=r;break}e=e.slice(t)}for(;a<e.length;){const t=e.charCodeAt(a++);a>=e.length&&(i=1);const n=e.charCodeAt(a++);a>=e.length&&(s=1);const u=e.charCodeAt(a++),l=t>>2,h=(3&t)<<4|n>>4;let f=(15&n)<<2|u>>6,d=63&u;1===i?f=d=64:1===s&&(d=64),o+=r?64===f?`${c.charAt(l)}${c.charAt(h)}`:64===d?`${c.charAt(l)}${c.charAt(h)}${c.charAt(f)}`:`${c.charAt(l)}${c.charAt(h)}${c.charAt(f)}${c.charAt(d)}`:`${c.charAt(l)}${c.charAt(h)}${c.charAt(f)}${c.charAt(d)}`}return o}function Ce(e,t=!1,r=!1){const n=t?Ae:_e;function a(e){for(let t=0;t<64;t++)if(n.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}let s=0,o="";for(;s<e.length;){const t=a(e.charAt(s++)),r=s>=e.length?0:a(e.charAt(s++)),n=s>=e.length?0:a(e.charAt(s++)),c=s>=e.length?0:a(e.charAt(s++)),u=i(t)<<2|i(r)>>4,l=(15&i(r))<<4|i(n)>>2,h=(3&i(n))<<6|i(c);o+=String.fromCharCode(u),64!==n&&(o+=String.fromCharCode(l)),64!==c&&(o+=String.fromCharCode(h))}if(r){let e=-1;for(let t=o.length-1;t>=0;t--)if(0!==o.charCodeAt(t)){e=t;break}o=-1!==e?o.slice(0,e+1):""}return o}function xe(e){let t="";const r=new Uint8Array(e);for(const e of r)t+=String.fromCharCode(e);return t}function Be(e){const t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return r}const Ee=Math.log(2);function Ie(e){const t=Math.log(e)/Ee,r=Math.floor(t),n=Math.round(t);return r===n?r:n}function Pe(e,t){for(const r of t)delete e[r]}function Ne(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Oe(e){let t=0,r=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;const n=new Uint8Array(t);for(let t=0;t<e.length;t++){const a=e[t];n.set(new Uint8Array(a),r),r+=a.byteLength}return n.buffer}function Le(e,t,r,n){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0&&(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",1)):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Ue{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Oe(this.items)}}const je=[new Uint8Array([1])],De="0123456789",Re="name",Ve="valueHexView",He="",Te=new ArrayBuffer(0),$e=new Uint8Array(0),Ke="EndOfContent",Fe="OCTET STRING",Me="BIT STRING";function Je(e){var t;return(t=class extends e{constructor(...e){var t;super(...e);const r=e[0]||{};this.isHexOnly=null!==(t=r.isHexOnly)&&void 0!==t&&t,this.valueHexView=r.valueHex?fe._H.toUint8Array(r.valueHex):$e}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,r){const n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Le(this,n,t,r))return-1;const a=t+r;return this.valueHexView=n.subarray(t,a),this.valueHexView.length?(this.blockLength=r,a):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Te)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:fe.U$.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class ze{constructor({blockLength:e=0,error:t="",warnings:r=[],valueBeforeDecode:n=$e}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=fe._H.toUint8Array(n)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:fe.U$.ToHex(this.valueBeforeDecodeView)}}}ze.NAME="baseBlock";class qe extends ze{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}qe.NAME="valueBlock";class We extends(Je(ze)){constructor({idBlock:e={}}={}){var t,r,n,a;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?fe._H.toUint8Array(e.valueHex):$e,this.tagClass=null!==(r=e.tagClass)&&void 0!==r?r:-1,this.tagNumber=null!==(n=e.tagNumber)&&void 0!==n?n:-1,this.isConstructed=null!==(a=e.isConstructed)&&void 0!==a&&a):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Te}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const r=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,r[0]=t}return r.buffer}if(!this.isHexOnly){const r=ge(this.tagNumber,7),n=new Uint8Array(r),a=r.byteLength,i=new Uint8Array(a+1);if(i[0]=31|t,!e){for(let e=0;e<a-1;e++)i[e+1]=128|n[e];i[a]=n[a-1]}return i.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|t,!e){const e=this.valueHexView;for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHexView.byteLength]=e[e.length-1]}return r.buffer}fromBER(e,t,r){const n=fe._H.toUint8Array(e);if(!Le(this,n,t,r))return-1;const a=n.subarray(t,t+r);if(0===a.length)return this.error="Zero buffer length",-1;switch(192&a[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=!(32&~a[0]),this.isHexOnly=!1;const i=31&a[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),r=255;for(;128&a[e];){if(t[e-1]=127&a[e],e++,e>=a.length)return this.error="End of input reached before message was fully decoded",-1;if(e===r){r+=255;const e=new Uint8Array(r);for(let r=0;r<t.length;r++)e[r]=t[r];t=this.valueHexView=new Uint8Array(r)}}this.blockLength=e+1,t[e-1]=127&a[e];const n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t[r];t=this.valueHexView=new Uint8Array(e),t.set(n),this.blockLength<=9?this.tagNumber=pe(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}We.NAME="identificationBlock";class Ze extends ze{constructor({lenBlock:e={}}={}){var t,r,n;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(r=e.longFormUsed)&&void 0!==r&&r,this.length=null!==(n=e.length)&&void 0!==n?n:0}fromBER(e,t,r){const n=fe._H.toUint8Array(e);if(!Le(this,n,t,r))return-1;const a=n.subarray(t,t+r);if(0===a.length)return this.error="Zero buffer length",-1;if(255===a[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===a[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&a[0]),!1===this.longFormUsed)return this.length=a[0],this.blockLength=1,t+this.blockLength;const i=127&a[0];if(i>8)return this.error="Too big integer",-1;if(i+1>a.length)return this.error="End of input reached before message was fully decoded",-1;const s=t+1,o=n.subarray(s,s+i);return 0===o[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=pe(o,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const n=ge(this.length,8);if(n.byteLength>127)return this.error="Too big length",Te;if(t=new ArrayBuffer(n.byteLength+1),e)return t;const a=new Uint8Array(n);r=new Uint8Array(t),r[0]=128|n.byteLength;for(let e=0;e<n.byteLength;e++)r[e+1]=a[e];return t}return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}Ze.NAME="lengthBlock";const Ge={};class Qe extends ze{constructor({name:e="",optional:t=!1,primitiveSchema:r,...n}={},a){super(n),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new We(n),this.lenBlock=new Ze(n),this.valueBlock=a?new a(n):new qe(n)}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}toBER(e,t){const r=t||new Ue;t||Ye(this);const n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;const n=this.lenBlock.toBER(e);r.write(n),r.write(t)}return t?Te:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():fe.U$.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${fe.U$.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){return this===e||e instanceof this.constructor&&ye(this.toBER(),e.toBER())}}function Ye(e){if(e instanceof Ge.Constructed)for(const t of e.valueBlock.value)Ye(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}Qe.NAME="BaseBlock";class Xe extends Qe{constructor({value:e="",...t}={},r){super(t,r),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}Xe.NAME="BaseStringBlock";class et extends(Je(qe)){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}var tt,rt,nt,at,it,st,ot,ct,ut,lt,ht,ft,dt,mt,pt,gt,vt,bt,wt,yt,kt,_t,At,St,Ct,xt,Bt,Et,It,Pt,Nt,Ot,Lt;et.NAME="PrimitiveValueBlock";class Ut extends Qe{constructor(e={}){super(e,et),this.idBlock.isConstructed=!1}}function jt(e,t=0,r=e.length){const n=t;let a=new Qe({},qe);const i=new ze;if(!Le(i,e,t,r))return a.error=i.error,{offset:-1,result:a};if(!e.subarray(t,t+r).length)return a.error="Zero buffer length",{offset:-1,result:a};let s=a.idBlock.fromBER(e,t,r);if(a.idBlock.warnings.length&&a.warnings.concat(a.idBlock.warnings),-1===s)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=s,r-=a.idBlock.blockLength,s=a.lenBlock.fromBER(e,t,r),a.lenBlock.warnings.length&&a.warnings.concat(a.lenBlock.warnings),-1===s)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=s,r-=a.lenBlock.blockLength,!a.idBlock.isConstructed&&a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};let o=Qe;if(1===a.idBlock.tagClass){if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};o=Ge.EndOfContent;break;case 1:o=Ge.Boolean;break;case 2:o=Ge.Integer;break;case 3:o=Ge.BitString;break;case 4:o=Ge.OctetString;break;case 5:o=Ge.Null;break;case 6:o=Ge.ObjectIdentifier;break;case 10:o=Ge.Enumerated;break;case 12:o=Ge.Utf8String;break;case 13:o=Ge.RelativeObjectIdentifier;break;case 14:o=Ge.TIME;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:o=Ge.Sequence;break;case 17:o=Ge.Set;break;case 18:o=Ge.NumericString;break;case 19:o=Ge.PrintableString;break;case 20:o=Ge.TeletexString;break;case 21:o=Ge.VideotexString;break;case 22:o=Ge.IA5String;break;case 23:o=Ge.UTCTime;break;case 24:o=Ge.GeneralizedTime;break;case 25:o=Ge.GraphicString;break;case 26:o=Ge.VisibleString;break;case 27:o=Ge.GeneralString;break;case 28:o=Ge.UniversalString;break;case 29:o=Ge.CharacterString;break;case 30:o=Ge.BmpString;break;case 31:o=Ge.DATE;break;case 32:o=Ge.TimeOfDay;break;case 33:o=Ge.DateTime;break;case 34:o=Ge.Duration;break;default:{const e=a.idBlock.isConstructed?new Ge.Constructed:new Ge.Primitive;e.idBlock=a.idBlock,e.lenBlock=a.lenBlock,e.warnings=a.warnings,a=e}}}else o=a.idBlock.isConstructed?Ge.Constructed:Ge.Primitive;return a=function(e,t){if(e instanceof t)return e;const r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}(a,o),s=a.fromBER(e,t,a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecodeView=e.subarray(n,n+a.blockLength),{offset:s,result:a}}function Dt(e){if(!e.byteLength){const e=new Qe({},qe);return e.error="Input buffer has zero length",{offset:-1,result:e}}return jt(fe._H.toUint8Array(e).slice(),0,e.byteLength)}function Rt(e,t){return e?1:t}tt=Ut,Ge.Primitive=tt,Ut.NAME="PRIMITIVE";class Vt extends qe{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const n=fe._H.toUint8Array(e);if(!Le(this,n,t,r))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let a=t;for(;Rt(this.isIndefiniteForm,r)>0;){const e=jt(n,a,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(a=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===Ke)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Ke?this.value.pop():this.warnings.push("No EndOfContent block encoded")),a}toBER(e,t){const r=t||new Ue;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,r);return t?Te:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Vt.NAME="ConstructedValueBlock";class Ht extends Qe{constructor(e={}){super(e,Vt),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){const e=[];for(const t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map(e=>`  ${e}`).join("\n"));const t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :\n${e.join("\n")}`:`${t} :`}}rt=Ht,Ge.Constructed=rt,Ht.NAME="CONSTRUCTED";class Tt extends qe{fromBER(e,t,r){return t}toBER(e){return Te}}Tt.override="EndOfContentValueBlock";class $t extends Qe{constructor(e={}){super(e,Tt),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}nt=$t,Ge.EndOfContent=nt,$t.NAME=Ke;class Kt extends Qe{constructor(e={}){super(e,qe),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const e=new Uint8Array(r);e[0]=5,e[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}at=Kt,Ge.Null=at,Kt.NAME="NULL";class Ft extends(Je(qe)){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=fe._H.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,r){const n=fe._H.toUint8Array(e);return Le(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,we.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}Ft.NAME="BooleanValueBlock";class Mt extends Qe{constructor(e={}){super(e,Ft),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}it=Mt,Ge.Boolean=it,Mt.NAME="BOOLEAN";class Jt extends(Je(Vt)){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,n=Vt.prototype.fromBER.call(this,e,t,r),-1===n)return n;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.NAME;if(t===Ke){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==Fe)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,r),this.blockLength=r;return n}toBER(e,t){return this.isConstructed?Vt.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}Jt.NAME="OctetStringValueBlock";class zt extends Qe{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,a;null!==(n=r.isConstructed)&&void 0!==n||(r.isConstructed=!!(null===(a=r.value)||void 0===a?void 0:a.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Jt),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){const e=jt(n,0,n.byteLength);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}}catch(e){}}return super.fromBER(e,t,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Ht.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${fe.U$.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof zt&&e.push(t.valueBlock.valueHexView);return fe._H.concat(e)}}st=zt,Ge.OctetString=st,zt.NAME=Fe;class qt extends(Je(Vt)){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(n=Vt.prototype.fromBER.call(this,e,t,r),-1===n)return n;for(const e of this.value){const t=e.constructor.NAME;if(t===Ke){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==Me)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const r=e.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return n}const a=fe._H.toUint8Array(e);if(!Le(this,a,t,r))return-1;const i=a.subarray(t,t+r);if(this.unusedBits=i[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const e=i.subarray(1);try{if(e.byteLength){const t=jt(e,0,e.byteLength);-1!==t.offset&&t.offset===r-1&&(this.value=[t.result])}}catch(e){}}return this.valueHexView=i.subarray(1),this.blockLength=i.length,t+r}toBER(e,t){if(this.isConstructed)return Vt.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Te;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}qt.NAME="BitStringValueBlock";class Wt extends Qe{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,a;null!==(n=r.isConstructed)&&void 0!==n||(r.isConstructed=!!(null===(a=r.value)||void 0===a?void 0:a.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},qt),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Ht.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const r of t)e.push(r.toString(2).padStart(8,"0"));const r=e.join("");return`${this.constructor.NAME} : ${r.substring(0,r.length-this.valueBlock.unusedBits)}`}}}function Zt(e,t){const r=new Uint8Array([0]),n=new Uint8Array(e),a=new Uint8Array(t);let i=n.slice(0);const s=i.length-1,o=a.slice(0),c=o.length-1;let u=0,l=0;for(let e=c<s?s:c;e>=0;e--,l++)u=1==l<o.length?i[s-l]+o[c-l]+r[0]:i[s-l]+r[0],r[0]=u/10,1==l>=i.length?i=be(new Uint8Array([u%10]),i):i[s-l]=u%10;return r[0]>0&&(i=be(r,i)),i}function Gt(e){if(e>=je.length)for(let t=je.length;t<=e;t++){const e=new Uint8Array([0]);let r=je[t-1].slice(0);for(let t=r.length-1;t>=0;t--){const n=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=n[0]/10,r[t]=n[0]%10}e[0]>0&&(r=be(e,r)),je.push(r)}return je[e]}function Qt(e,t){let r=0;const n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),s=i.length-1,o=a.slice(0),c=o.length-1;let u,l=0;for(let e=c;e>=0;e--,l++)u=i[s-l]-o[c-l]-r,1==u<0?(r=1,i[s-l]=u+10):(r=0,i[s-l]=u);if(r>0)for(let e=s-c+1;e>=0;e--,l++){if(u=i[s-l]-r,!(u<0)){r=0,i[s-l]=u;break}r=1,i[s-l]=u+10}return i.slice()}ot=Wt,Ge.BitString=ot,Wt.NAME=Me;class Yt extends(Je(qe)){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=we.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){const t=e<0?-1*e:e;let r=128;for(let n=1;n<8;n++){if(t<=r){if(e<0){const e=ge(r-t,8,n);return new Uint8Array(e)[0]|=128,e}let a=ge(t,8,n),i=new Uint8Array(a);if(128&i[0]){const e=a.slice(0),t=new Uint8Array(e);a=new ArrayBuffer(a.byteLength+1),i=new Uint8Array(a);for(let r=0;r<e.byteLength;r++)i[r+1]=t[r];i[0]=0}return a}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,n=0){const a=this.fromBER(e,t,r);if(-1===a)return a;const i=this.valueHexView;return 0===i[0]&&128&i[1]?this.valueHexView=i.subarray(1):0!==n&&i.length<n&&(n-i.length>1&&(n=i.length+1),this.valueHexView=i.subarray(n-i.length)),a}toDER(e=!1){const t=this.valueHexView;switch(!0){case!!(128&t[0]):{const e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&!(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,r){const n=super.fromBER(e,t,r);return-1===n||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=8*this.valueHexView.length-1;let t,r=new Uint8Array(8*this.valueHexView.length/3),n=0;const a=this.valueHexView;let i="",s=!1;for(let s=a.byteLength-1;s>=0;s--){t=a[s];for(let a=0;a<8;a++)1&~t||(n===e?(r=Qt(Gt(n),r),i="-"):r=Zt(r,Gt(n))),n++,t>>=1}for(let e=0;e<r.length;e++)r[e]&&(s=!0),s&&(i+=De.charAt(r[e]));return!1===s&&(i+=De.charAt(0)),i}}ct=Yt,Yt.NAME="IntegerValueBlock",Object.defineProperty(ct.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class Xt extends Qe{constructor(e={}){super(e,Yt),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Ne(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Ne();const t=BigInt(e),r=new Ue,n=t.toString(16).replace(/^-/,""),a=new Uint8Array(fe.U$.FromHex(n));if(t<0){const e=new Uint8Array(a.length+(128&a[0]?1:0));e[0]|=128;const n=BigInt(`0x${fe.U$.ToHex(e)}`)+t,i=fe._H.toUint8Array(fe.U$.FromHex(n.toString(16)));i[0]|=128,r.write(i)}else 128&a[0]&&r.write(new Uint8Array([0])),r.write(a);return new Xt({valueHex:r.final()})}convertToDER(){const e=new Xt({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Xt({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}ut=Xt,Ge.Integer=ut,Xt.NAME="INTEGER";class er extends Xt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}lt=er,Ge.Enumerated=lt,er.NAME="ENUMERATED";class tr extends(Je(qe)){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const n=fe._H.toUint8Array(e);if(!Le(this,n,t,r))return-1;const a=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&a[e],this.blockLength++,128&a[e]);e++);const i=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)i[e]=this.valueHexView[e];return this.valueHexView=i,128&a[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=pe(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Ne();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+(e+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=ge(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",Te;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r}toString(){let e="";if(this.isHexOnly)e=fe.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}tr.NAME="sidBlock";class rr extends qe{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const t=new tr;if(n=t.fromBER(e,n,r),-1===n)return this.blockLength=0,this.error=t.error,n;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,Te;t.push(n)}return Oe(t)}fromString(e){this.value=[];let t=0,r=0,n="",a=!1;do{if(r=e.indexOf(".",t),n=-1===r?e.substring(t):e.substring(t,r),t=r+1,a){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return void(this.value=[])}const r=parseInt(n,10);if(isNaN(r))return;e.valueDec=r+t,a=!1}else{const e=new tr;if(n>Number.MAX_SAFE_INTEGER){Ne();const t=BigInt(n);e.valueBigInt=t}else if(e.valueDec=parseInt(n,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,a=!0),this.value.push(e)}}while(-1!==r)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?(n=`{${n}}`,this.value[r].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}rr.NAME="ObjectIdentifierValueBlock";class nr extends Qe{constructor(e={}){super(e,rr),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ht=nr,Ge.ObjectIdentifier=ht,nr.NAME="OBJECT IDENTIFIER";class ar extends(Je(ze)){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(0===r)return t;const n=fe._H.toUint8Array(e);if(!Le(this,n,t,r))return-1;const a=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&a[e],this.blockLength++,128&a[e]);e++);const i=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)i[e]=this.valueHexView[e];return this.valueHexView=i,128&a[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=pe(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=ge(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",Te;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),n=t.byteLength-1;for(let t=0;t<n;t++)r[t]=128|e[t];r[n]=e[n]}return r.buffer}toString(){let e="";return e=this.isHexOnly?fe.U$.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}ar.NAME="relativeSidBlock";class ir extends qe{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const t=new ar;if(n=t.fromBER(e,n,r),-1===n)return this.blockLength=0,this.error=t.error,n;this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return n}toBER(e,t){const r=[];for(let t=0;t<this.value.length;t++){const n=this.value[t].toBER(e);if(0===n.byteLength)return this.error=this.value[t].error,Te;r.push(n)}return Oe(r)}fromString(e){this.value=[];let t=0,r=0,n="";do{r=e.indexOf(".",t),n=-1===r?e.substring(t):e.substring(t,r),t=r+1;const a=new ar;if(a.valueDec=parseInt(n,10),isNaN(a.valueDec))return!0;this.value.push(a)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();0!==r&&(e=`${e}.`),t?(n=`{${n}}`,e+=n):e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}ir.NAME="RelativeObjectIdentifierValueBlock";class sr extends Qe{constructor(e={}){super(e,ir),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ft=sr,Ge.RelativeObjectIdentifier=ft,sr.NAME="RelativeObjectIdentifier";class or extends Ht{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}dt=or,Ge.Sequence=dt,or.NAME="SEQUENCE";class cr extends Ht{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}mt=cr,Ge.Set=mt,cr.NAME="SET";class ur extends(Je(qe)){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=He}toJSON(){return{...super.toJSON(),value:this.value}}}ur.NAME="StringValueBlock";class lr extends ur{}lr.NAME="SimpleStringValueBlock";class hr extends Xe{constructor({...e}={}){super(e,lr)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,fe._H.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}hr.NAME="SIMPLE STRING";class fr extends hr{fromBuffer(e){this.valueBlock.valueHexView=fe._H.toUint8Array(e);try{this.valueBlock.value=fe.U$.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=fe.U$.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(fe.U$.FromUtf8String(e)),this.valueBlock.value=e}}fr.NAME="Utf8StringValueBlock";class dr extends fr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}pt=dr,Ge.Utf8String=pt,dr.NAME="UTF8String";class mr extends hr{fromBuffer(e){this.valueBlock.value=fe.U$.ToUtf16String(e),this.valueBlock.valueHexView=fe._H.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(fe.U$.FromUtf16String(e))}}mr.NAME="BmpStringValueBlock";class pr extends mr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}gt=pr,Ge.BmpString=gt,pr.NAME="BMPString";class gr extends hr{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let n=0;n<t;n++){const t=ge(e.charCodeAt(n),8),a=new Uint8Array(t);if(a.length>4)continue;const i=4-a.length;for(let e=a.length-1;e>=0;e--)r[4*n+e+i]=a[e]}this.valueBlock.value=e}}gr.NAME="UniversalStringValueBlock";class vr extends gr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}vt=vr,Ge.UniversalString=vt,vr.NAME="UniversalString";class br extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}bt=br,Ge.NumericString=bt,br.NAME="NumericString";class wr extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}wt=wr,Ge.PrintableString=wt,wr.NAME="PrintableString";class yr extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}yt=yr,Ge.TeletexString=yt,yr.NAME="TeletexString";class kr extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}kt=kr,Ge.VideotexString=kt,kr.NAME="VideotexString";class _r extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}_t=_r,Ge.IA5String=_t,_r.NAME="IA5String";class Ar extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}At=Ar,Ge.GraphicString=At,Ar.NAME="GraphicString";class Sr extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}St=Sr,Ge.VisibleString=St,Sr.NAME="VisibleString";class Cr extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Ct=Cr,Ge.GeneralString=Ct,Cr.NAME="GeneralString";class xr extends hr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}xt=xr,Ge.CharacterString=xt,xr.NAME="CharacterString";class Br extends Sr{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,fe._H.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for conversion");const r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){const e=new Array(7);return e[0]=ke(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=ke(this.month,2),e[2]=ke(this.day,2),e[3]=ke(this.hour,2),e[4]=ke(this.minute,2),e[5]=ke(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Bt=Br,Ge.UTCTime=Bt,Br.NAME="UTCTime";class Er extends Br{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,n="",a="",i=0,s=0,o=0;if("Z"===e[e.length-1])n=e.substring(0,e.length-1),r=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let e=1,t=n.indexOf("+"),r="";if(-1===t&&(t=n.indexOf("-"),e=-1),-1!==t){if(r=n.substring(t+1),n=n.substring(0,t),2!==r.length&&4!==r.length)throw new Error("Wrong input string for conversion");let a=parseInt(r.substring(0,2),10);if(isNaN(a.valueOf()))throw new Error("Wrong input string for conversion");if(s=e*a,4===r.length){if(a=parseInt(r.substring(2,4),10),isNaN(a.valueOf()))throw new Error("Wrong input string for conversion");o=e*a}}}let c=n.indexOf(".");if(-1===c&&(c=n.indexOf(",")),-1!==c){const e=new Number(`0${n.substring(c)}`);if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");i=e.valueOf(),a=n.substring(0,c)}else a=n;switch(!0){case 8===a.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==c)throw new Error("Wrong input string for conversion");break;case 10===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){const e=1e3*i;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for conversion")}const u=t.exec(a);if(null===u)throw new Error("Wrong input string for conversion");for(let e=1;e<u.length;e++)switch(e){case 1:this.year=parseInt(u[e],10);break;case 2:this.month=parseInt(u[e],10);break;case 3:this.day=parseInt(u[e],10);break;case 4:this.hour=parseInt(u[e],10)+s;break;case 5:this.minute=parseInt(u[e],10)+o;break;case 6:this.second=parseInt(u[e],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){const e=[];return e.push(ke(this.year,4)),e.push(ke(this.month,2)),e.push(ke(this.day,2)),e.push(ke(this.hour,2)),e.push(ke(this.minute,2)),e.push(ke(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(ke(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Et=Er,Ge.GeneralizedTime=Et,Er.NAME="GeneralizedTime";class Ir extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}It=Ir,Ge.DATE=It,Ir.NAME="DATE";class Pr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Pt=Pr,Ge.TimeOfDay=Pt,Pr.NAME="TimeOfDay";class Nr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}Nt=Nr,Ge.DateTime=Nt,Nr.NAME="DateTime";class Or extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Ot=Or,Ge.Duration=Ot,Or.NAME="Duration";class Lr extends dr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Lt=Lr,Ge.TIME=Lt,Lr.NAME="TIME";class Ur{constructor({name:e="",optional:t=!1}={}){this.name=e,this.optional=t}}class jr extends Ur{constructor({value:e=[],...t}={}){super(t),this.value=e}}class Dr extends Ur{constructor({value:e=new Ur,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}class Rr{constructor({data:e=$e}={}){this.dataView=fe._H.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=fe._H.toUint8Array(e)}fromBER(e,t,r){const n=t+r;return this.dataView=fe._H.toUint8Array(e).subarray(t,n),n}toBER(e){return this.dataView.slice().buffer}}function Vr(e,t,r){if(r instanceof jr){for(let n=0;n<r.value.length;n++)if(Vr(e,t,r.value[n]).verified)return{verified:!0,result:e};{const e={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(Re)&&(e.name=r.name),e}}if(r instanceof Ur)return r.hasOwnProperty(Re)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==0)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=r.idBlock.toBER(!1);if(0===n.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(n,0,n.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(Ve in r.idBlock==0)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=r.idBlock.valueHexView,a=t.idBlock.valueHexView;if(n.length!==a.length)return{verified:!1,result:e};for(let t=0;t<n.length;t++)if(n[t]!==a[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,He),r.name&&(e[r.name]=t)),r instanceof Ge.Constructed){let n=0,a={verified:!1,result:{error:"Unknown error"}},i=r.valueBlock.value.length;if(i>0&&r.valueBlock.value[0]instanceof Dr&&(i=t.valueBlock.value.length),0===i)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){let t=!0;for(let e=0;e<r.valueBlock.value.length;e++)t=t&&(r.valueBlock.value[e].optional||!1);return t?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,He),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let s=0;s<i;s++)if(s-n>=t.valueBlock.value.length){if(!1===r.valueBlock.value[s].optional){const t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,He),r.name&&(delete e[r.name],t.name=r.name)),t}}else if(r.valueBlock.value[0]instanceof Dr){if(a=Vr(e,t.valueBlock.value[s],r.valueBlock.value[0].value),!1===a.verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,He),r.name&&delete e[r.name]),a;n++}if(Re in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let n={};n="local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e,void 0===n[r.valueBlock.value[0].name]&&(n[r.valueBlock.value[0].name]=[]),n[r.valueBlock.value[0].name].push(t.valueBlock.value[s])}}else if(a=Vr(e,t.valueBlock.value[s-n],r.valueBlock.value[s]),!1===a.verified){if(!r.valueBlock.value[s].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,He),r.name&&delete e[r.name]),a;n++}if(!1===a.verified){const t={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,He),r.name&&(delete e[r.name],t.name=r.name)),t}return{verified:!0,result:e}}if(r.primitiveSchema&&Ve in t.valueBlock){const n=jt(t.valueBlock.valueHexView);if(-1===n.offset){const t={verified:!1,result:n.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,He),r.name&&(delete e[r.name],t.name=r.name)),t}return Vr(e,n.result,r.primitiveSchema)}return{verified:!0,result:e}}class Hr{constructor(e={}){this.algorithmId=de(e,"algorithmId",Hr.defaultValues("algorithmId")),"algorithmParams"in e&&(this.algorithmParams=de(e,"algorithmParams",Hr.defaultValues("algorithmParams"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new Ur;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof Ur;default:throw new Error(`Invalid member name for AlgorithmIdentifier class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",optional:t.optional||!1,value:[new nr({name:t.algorithmIdentifier||""}),new Ur({name:t.algorithmParams||"",optional:!0})]})}fromSchema(e){Pe(e,["algorithm","params"]);const t=Vr(e,e,Hr.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=t.result.algorithm.valueBlock.toString(),"params"in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new nr({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof Ur==0&&e.push(this.algorithmParams),new or({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof Ur==0&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return e instanceof Hr!=0&&this.algorithmId===e.algorithmId&&("algorithmParams"in this?"algorithmParams"in e&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!("algorithmParams"in e))}}class Tr{constructor(e={}){this.x=de(e,"x",Tr.defaultValues("x")),this.y=de(e,"y",Tr.defaultValues("y")),this.namedCurve=de(e,"namedCurve",Tr.defaultValues("namedCurve")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"x":case"y":return ye(t,Tr.defaultValues(e));case"namedCurve":return""===t;default:throw new Error(`Invalid member name for ECCPublicKey class: ${e}`)}}static schema(e={}){return new Rr}fromSchema(e){if(e instanceof ArrayBuffer==0)throw new Error("Object's schema was not verified against input data for ECPublicKey");if(4!==new Uint8Array(e)[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");let t;switch(this.namedCurve){case"1.2.840.10045.3.1.7":t=32;break;case"1.3.132.0.34":t=48;break;case"1.3.132.0.35":t=66;break;default:throw new Error(`Incorrect curve OID: ${this.namedCurve}`)}if(e.byteLength!==2*t+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,t+1),this.y=e.slice(1+t,2*t+1)}toSchema(){return new Rr({data:ve(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){let e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}return{crv:e,x:Se(xe(this.x),!0,!0,!1),y:Se(xe(this.y),!0,!0,!1)}}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("x"in e))throw new Error('Absent mandatory parameter "x"');{const r=Be(Ce(e.x,!0));if(r.byteLength<t){this.x=new ArrayBuffer(t);const e=new Uint8Array(this.x),n=new Uint8Array(r);e.set(n,1)}else this.x=r.slice(0,t)}if(!("y"in e))throw new Error('Absent mandatory parameter "y"');{const r=Be(Ce(e.y,!0));if(r.byteLength<t){this.y=new ArrayBuffer(t);const e=new Uint8Array(this.y),n=new Uint8Array(r);e.set(n,1)}else this.y=r.slice(0,t)}}}class $r{constructor(e={}){this.modulus=de(e,"modulus",$r.defaultValues("modulus")),this.publicExponent=de(e,"publicExponent",$r.defaultValues("publicExponent")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"modulus":case"publicExponent":return new Xt;default:throw new Error(`Invalid member name for RSAPublicKey class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Xt({name:t.modulus||""}),new Xt({name:t.publicExponent||""})]})}fromSchema(e){Pe(e,["modulus","publicExponent"]);const t=Vr(e,e,$r.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new or({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:Se(xe(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Se(xe(this.publicExponent.valueBlock.valueHex),!0,!0,!0)}}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');{const t=Be(Ce(e.n,!0));this.modulus=new Xt({valueHex:t.slice(0,Math.pow(2,Ie(t.byteLength)))})}if(!("e"in e))throw new Error('Absent mandatory parameter "e"');this.publicExponent=new Xt({valueHex:Be(Ce(e.e,!0)).slice(0,3)})}}class Kr{constructor(e={}){this.algorithm=de(e,"algorithm",Kr.defaultValues("algorithm")),this.subjectPublicKey=de(e,"subjectPublicKey",Kr.defaultValues("subjectPublicKey")),"parsedKey"in e&&(this.parsedKey=de(e,"parsedKey",Kr.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"algorithm":return new Hr;case"subjectPublicKey":return new Wt;default:throw new Error(`Invalid member name for PublicKeyInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[Hr.schema(t.algorithm||{}),new Wt({name:t.subjectPublicKey||""})]})}fromSchema(e){Pe(e,["algorithm","subjectPublicKey"]);const t=Vr(e,e,Kr.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PublicKeyInfo");switch(this.algorithm=new Hr({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey,this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams instanceof nr)try{this.parsedKey=new Tr({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=Dt(this.subjectPublicKey.valueBlock.valueHex);if(-1!==e.offset)try{this.parsedKey=new $r({schema:e.result})}catch(e){}}}}toSchema(){return new or({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if("parsedKey"in this==0)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const r of Object.keys(t))e[r]=t[r];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Tr({json:e}),this.algorithm=new Hr({algorithmId:"1.2.840.10045.2.1",algorithmParams:new nr({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new $r({json:e}),this.algorithm=new Hr({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Kt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new Wt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}importKey(e){let t=Promise.resolve();const r=this;if(void 0===e)return Promise.reject("Need to provide publicKey input parameter");const n=rn();return void 0===n?Promise.reject("Unable to create WebCrypto object"):(t=t.then(()=>n.exportKey("spki",e)),t=t.then(e=>{const t=Dt(e);try{r.fromSchema(t.result)}catch(e){return Promise.reject("Error during initializing object from schema")}},e=>Promise.reject(`Error during exporting public key: ${e}`)),t)}}class Fr{constructor(e={}){this.type=de(e,"type",Fr.defaultValues("type")),this.values=de(e,"values",Fr.defaultValues("values")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"values":return[];default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return""===t;case"values":return 0===t.length;default:throw new Error(`Invalid member name for Attribute class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.type||""}),new cr({name:t.setName||"",value:[new Dr({name:t.values||"",value:new Ur})]})]})}fromSchema(e){Pe(e,["type","values"]);const t=Vr(e,e,Fr.schema({names:{type:"type",values:"values"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Attribute");this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new or({value:[new nr({value:this.type}),new cr({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}class Mr{constructor(e={}){this.version=de(e,"version",Mr.defaultValues("version")),this.privateKey=de(e,"privateKey",Mr.defaultValues("privateKey")),"namedCurve"in e&&(this.namedCurve=de(e,"namedCurve",Mr.defaultValues("namedCurve"))),"publicKey"in e&&(this.publicKey=de(e,"publicKey",Mr.defaultValues("publicKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 1;case"privateKey":return new zt;case"namedCurve":return"";case"publicKey":return new Tr;default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"version":return t===Mr.defaultValues(e);case"privateKey":return t.isEqual(Mr.defaultValues(e));case"namedCurve":return""===t;case"publicKey":return Tr.compareWithDefault("namedCurve",t.namedCurve)&&Tr.compareWithDefault("x",t.x)&&Tr.compareWithDefault("y",t.y);default:throw new Error(`Invalid member name for ECCPrivateKey class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Xt({name:t.version||""}),new zt({name:t.privateKey||""}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new nr({name:t.namedCurve||""})]}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Wt({name:t.publicKey||""})]})]})}fromSchema(e){Pe(e,["version","privateKey","namedCurve","publicKey"]);const t=Vr(e,e,Mr.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ECPrivateKey");if(this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,"namedCurve"in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),"publicKey"in t.result){const e={schema:t.result.publicKey.valueBlock.valueHex};"namedCurve"in this&&(e.namedCurve=this.namedCurve),this.publicKey=new Tr(e)}}toSchema(){const e=[new Xt({value:this.version}),this.privateKey];return"namedCurve"in this&&e.push(new Ht({idBlock:{tagClass:3,tagNumber:0},value:[new nr({value:this.namedCurve})]})),"publicKey"in this&&e.push(new Ht({idBlock:{tagClass:3,tagNumber:1},value:[new Wt({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new or({value:e})}toJSON(){if("namedCurve"in this==0||Mr.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');let e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}const t={crv:e,d:Se(xe(this.privateKey.valueBlock.valueHex),!0,!0,!1)};if("publicKey"in this){const e=this.publicKey.toJSON();t.x=e.x,t.y=e.y}return t}fromJSON(e){let t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("d"in e))throw new Error('Absent mandatory parameter "d"');{const r=Be(Ce(e.d,!0));if(r.byteLength<t){const e=new ArrayBuffer(t),n=new Uint8Array(e),a=new Uint8Array(r);n.set(a,1),this.privateKey=new zt({valueHex:e})}else this.privateKey=new zt({valueHex:r.slice(0,t)})}"x"in e&&"y"in e&&(this.publicKey=new Tr({json:e}))}}class Jr{constructor(e={}){this.prime=de(e,"prime",Jr.defaultValues("prime")),this.exponent=de(e,"exponent",Jr.defaultValues("exponent")),this.coefficient=de(e,"coefficient",Jr.defaultValues("coefficient")),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"prime":case"exponent":case"coefficient":return new Xt;default:throw new Error(`Invalid member name for OtherPrimeInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Xt({name:t.prime||""}),new Xt({name:t.exponent||""}),new Xt({name:t.coefficient||""})]})}fromSchema(e){Pe(e,["prime","exponent","coefficient"]);const t=Vr(e,e,Jr.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new or({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:Se(xe(this.prime.valueBlock.valueHex),!0,!0),d:Se(xe(this.exponent.valueBlock.valueHex),!0,!0),t:Se(xe(this.coefficient.valueBlock.valueHex),!0,!0)}}fromJSON(e){if(!("r"in e))throw new Error('Absent mandatory parameter "r"');if(this.prime=new Xt({valueHex:Be(Ce(e.r,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.exponent=new Xt({valueHex:Be(Ce(e.d,!0))}),!("t"in e))throw new Error('Absent mandatory parameter "t"');this.coefficient=new Xt({valueHex:Be(Ce(e.t,!0))})}}class zr{constructor(e={}){this.version=de(e,"version",zr.defaultValues("version")),this.modulus=de(e,"modulus",zr.defaultValues("modulus")),this.publicExponent=de(e,"publicExponent",zr.defaultValues("publicExponent")),this.privateExponent=de(e,"privateExponent",zr.defaultValues("privateExponent")),this.prime1=de(e,"prime1",zr.defaultValues("prime1")),this.prime2=de(e,"prime2",zr.defaultValues("prime2")),this.exponent1=de(e,"exponent1",zr.defaultValues("exponent1")),this.exponent2=de(e,"exponent2",zr.defaultValues("exponent2")),this.coefficient=de(e,"coefficient",zr.defaultValues("coefficient")),"otherPrimeInfos"in e&&(this.otherPrimeInfos=de(e,"otherPrimeInfos",zr.defaultValues("otherPrimeInfos"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"modulus":case"publicExponent":case"privateExponent":case"prime1":case"prime2":case"exponent1":case"exponent2":case"coefficient":return new Xt;case"otherPrimeInfos":return[];default:throw new Error(`Invalid member name for RSAPrivateKey class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Xt({name:t.version||""}),new Xt({name:t.modulus||""}),new Xt({name:t.publicExponent||""}),new Xt({name:t.privateExponent||""}),new Xt({name:t.prime1||""}),new Xt({name:t.prime2||""}),new Xt({name:t.exponent1||""}),new Xt({name:t.exponent2||""}),new Xt({name:t.coefficient||""}),new or({optional:!0,value:[new Dr({name:t.otherPrimeInfosName||"",value:Jr.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){Pe(e,["version","modulus","publicExponent","privateExponent","prime1","prime2","exponent1","exponent2","coefficient","otherPrimeInfos"]);const t=Vr(e,e,zr.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),"otherPrimeInfos"in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,e=>new Jr({schema:e})))}toSchema(){const e=[];return e.push(new Xt({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),"otherPrimeInfos"in this&&e.push(new or({value:Array.from(this.otherPrimeInfos,e=>e.toSchema())})),new or({value:e})}toJSON(){const e={n:Se(xe(this.modulus.valueBlock.valueHex),!0,!0,!0),e:Se(xe(this.publicExponent.valueBlock.valueHex),!0,!0,!0),d:Se(xe(this.privateExponent.valueBlock.valueHex),!0,!0,!0),p:Se(xe(this.prime1.valueBlock.valueHex),!0,!0,!0),q:Se(xe(this.prime2.valueBlock.valueHex),!0,!0,!0),dp:Se(xe(this.exponent1.valueBlock.valueHex),!0,!0,!0),dq:Se(xe(this.exponent2.valueBlock.valueHex),!0,!0,!0),qi:Se(xe(this.coefficient.valueBlock.valueHex),!0,!0,!0)};return"otherPrimeInfos"in this&&(e.oth=Array.from(this.otherPrimeInfos,e=>e.toJSON())),e}fromJSON(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new Xt({valueHex:Be(Ce(e.n,!0,!0))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');if(this.publicExponent=new Xt({valueHex:Be(Ce(e.e,!0,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.privateExponent=new Xt({valueHex:Be(Ce(e.d,!0,!0))}),!("p"in e))throw new Error('Absent mandatory parameter "p"');if(this.prime1=new Xt({valueHex:Be(Ce(e.p,!0,!0))}),!("q"in e))throw new Error('Absent mandatory parameter "q"');if(this.prime2=new Xt({valueHex:Be(Ce(e.q,!0,!0))}),!("dp"in e))throw new Error('Absent mandatory parameter "dp"');if(this.exponent1=new Xt({valueHex:Be(Ce(e.dp,!0,!0))}),!("dq"in e))throw new Error('Absent mandatory parameter "dq"');if(this.exponent2=new Xt({valueHex:Be(Ce(e.dq,!0,!0))}),!("qi"in e))throw new Error('Absent mandatory parameter "qi"');this.coefficient=new Xt({valueHex:Be(Ce(e.qi,!0,!0))}),"oth"in e&&(this.otherPrimeInfos=Array.from(e.oth,e=>new Jr({json:e})))}}class qr{constructor(e={}){this.version=de(e,"version",qr.defaultValues("version")),this.privateKeyAlgorithm=de(e,"privateKeyAlgorithm",qr.defaultValues("privateKeyAlgorithm")),this.privateKey=de(e,"privateKey",qr.defaultValues("privateKey")),"attributes"in e&&(this.attributes=de(e,"attributes",qr.defaultValues("attributes"))),"parsedKey"in e&&(this.parsedKey=de(e,"parsedKey",qr.defaultValues("parsedKey"))),"schema"in e&&this.fromSchema(e.schema),"json"in e&&this.fromJSON(e.json)}static defaultValues(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new Hr;case"privateKey":return new zt;case"attributes":return[];case"parsedKey":return{};default:throw new Error(`Invalid member name for PrivateKeyInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Xt({name:t.version||""}),Hr.schema(t.privateKeyAlgorithm||{}),new zt({name:t.privateKey||""}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Dr({name:t.attributes||"",value:Fr.schema()})]})]})}fromSchema(e){Pe(e,["version","privateKeyAlgorithm","privateKey","attributes"]);const t=Vr(e,e,qr.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyInfo");switch(this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Hr({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,"attributes"in t.result&&(this.attributes=Array.from(t.result.attributes,e=>new Fr({schema:e}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const e=Dt(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new zr({schema:e.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof nr){const e=Dt(this.privateKey.valueBlock.valueHex);-1!==e.offset&&(this.parsedKey=new Mr({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:e.result}))}}}toSchema(){const e=[new Xt({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return"attributes"in this&&e.push(new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,e=>e.toSchema())})),new or({value:e})}toJSON(){if("parsedKey"in this==0){const e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,e=>e.toJSON())),e}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();for(const r of Object.keys(t))e[r]=t[r];return e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Mr({json:e}),this.privateKeyAlgorithm=new Hr({algorithmId:"1.2.840.10045.2.1",algorithmParams:new nr({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new zr({json:e}),this.privateKeyAlgorithm=new Hr({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Kt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new zt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}class Wr{constructor(e={}){if(this.contentType=de(e,"contentType",Wr.defaultValues("contentType")),this.contentEncryptionAlgorithm=de(e,"contentEncryptionAlgorithm",Wr.defaultValues("contentEncryptionAlgorithm")),"encryptedContent"in e&&(this.encryptedContent=e.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed)){const e=new zt({idBlock:{isConstructed:!0},isConstructed:!0});let t=0,r=this.encryptedContent.valueBlock.valueHex.byteLength;for(;r>0;){const n=new Uint8Array(this.encryptedContent.valueBlock.valueHex,t,t+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-t:1024),a=new ArrayBuffer(n.length),i=new Uint8Array(a);for(let e=0;e<i.length;e++)i[e]=n[e];e.valueBlock.value.push(new zt({valueHex:a})),r-=n.length,t+=n.length}this.encryptedContent=e}"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new Hr;case"encryptedContent":return new zt;default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"contentType":return""===t;case"contentEncryptionAlgorithm":return""===t.algorithmId&&"algorithmParams"in t==0;case"encryptedContent":return t.isEqual(Wr.defaultValues(e));default:throw new Error(`Invalid member name for EncryptedContentInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.contentType||""}),Hr.schema(t.contentEncryptionAlgorithm||{}),new jr({value:[new Ht({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new Dr({value:new zt})]}),new Ut({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){Pe(e,["contentType","contentEncryptionAlgorithm","encryptedContent"]);const t=Vr(e,e,Wr.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Hr({schema:t.result.contentEncryptionAlgorithm}),"encryptedContent"in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new nr({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new or({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e}}class Zr{constructor(e={}){this.hashAlgorithm=de(e,"hashAlgorithm",Zr.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=de(e,"maskGenAlgorithm",Zr.defaultValues("maskGenAlgorithm")),this.saltLength=de(e,"saltLength",Zr.defaultValues("saltLength")),this.trailerField=de(e,"trailerField",Zr.defaultValues("trailerField")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"hashAlgorithm":return new Hr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Kt});case"maskGenAlgorithm":return new Hr({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Hr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Kt}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error(`Invalid member name for RSASSAPSSParams class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Ht({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Hr.schema(t.hashAlgorithm||{})]}),new Ht({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Hr.schema(t.maskGenAlgorithm||{})]}),new Ht({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new Xt({name:t.saltLength||""})]}),new Ht({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new Xt({name:t.trailerField||""})]})]})}fromSchema(e){Pe(e,["hashAlgorithm","maskGenAlgorithm","saltLength","trailerField"]);const t=Vr(e,e,Zr.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RSASSAPSSParams");"hashAlgorithm"in t.result&&(this.hashAlgorithm=new Hr({schema:t.result.hashAlgorithm})),"maskGenAlgorithm"in t.result&&(this.maskGenAlgorithm=new Hr({schema:t.result.maskGenAlgorithm})),"saltLength"in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),"trailerField"in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Zr.defaultValues("hashAlgorithm"))||e.push(new Ht({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Zr.defaultValues("maskGenAlgorithm"))||e.push(new Ht({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==Zr.defaultValues("saltLength")&&e.push(new Ht({idBlock:{tagClass:3,tagNumber:2},value:[new Xt({value:this.saltLength})]})),this.trailerField!==Zr.defaultValues("trailerField")&&e.push(new Ht({idBlock:{tagClass:3,tagNumber:3},value:[new Xt({value:this.trailerField})]})),new or({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Zr.defaultValues("hashAlgorithm"))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Zr.defaultValues("maskGenAlgorithm"))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==Zr.defaultValues("saltLength")&&(e.saltLength=this.saltLength),this.trailerField!==Zr.defaultValues("trailerField")&&(e.trailerField=this.trailerField),e}}class Gr{constructor(e={}){this.salt=de(e,"salt",Gr.defaultValues("salt")),this.iterationCount=de(e,"iterationCount",Gr.defaultValues("iterationCount")),"keyLength"in e&&(this.keyLength=de(e,"keyLength",Gr.defaultValues("keyLength"))),"prf"in e&&(this.prf=de(e,"prf",Gr.defaultValues("prf"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new Hr({algorithmId:"1.3.14.3.2.26",algorithmParams:new Kt});default:throw new Error(`Invalid member name for PBKDF2Params class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new jr({value:[new zt({name:t.saltPrimitive||""}),Hr.schema(t.saltConstructed||{})]}),new Xt({name:t.iterationCount||""}),new Xt({name:t.keyLength||"",optional:!0}),Hr.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){Pe(e,["salt","iterationCount","keyLength","prf"]);const t=Vr(e,e,Gr.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:!0}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBKDF2Params");this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,"keyLength"in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),"prf"in t.result&&(this.prf=new Hr({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new Xt({value:this.iterationCount})),"keyLength"in this&&Gr.defaultValues("keyLength")!==this.keyLength&&e.push(new Xt({value:this.keyLength})),"prf"in this&&!1===Gr.defaultValues("prf").isEqual(this.prf)&&e.push(this.prf.toSchema()),new or({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return"keyLength"in this&&Gr.defaultValues("keyLength")!==this.keyLength&&(e.keyLength=this.keyLength),"prf"in this&&!1===Gr.defaultValues("prf").isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}class Qr{constructor(e={}){this.keyDerivationFunc=de(e,"keyDerivationFunc",Qr.defaultValues("keyDerivationFunc")),this.encryptionScheme=de(e,"encryptionScheme",Qr.defaultValues("encryptionScheme")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyDerivationFunc":case"encryptionScheme":return new Hr;default:throw new Error(`Invalid member name for PBES2Params class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[Hr.schema(t.keyDerivationFunc||{}),Hr.schema(t.encryptionScheme||{})]})}fromSchema(e){Pe(e,["keyDerivationFunc","encryptionScheme"]);const t=Vr(e,e,Qr.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PBES2Params");this.keyDerivationFunc=new Hr({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new Hr({schema:t.result.encryptionScheme})}toSchema(){return new or({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}function Yr(e,t,r,n,a,i){let s,o;const c=[];switch(t.toUpperCase()){case"SHA-1":s=20,o=64;break;case"SHA-256":s=32,o=64;break;case"SHA-384":s=48,o=128;break;case"SHA-512":s=64,o=128;break;default:throw new Error("Unsupported hashing algorithm")}const u=new Uint8Array(n),l=new ArrayBuffer(2*n.byteLength+2),h=new Uint8Array(l);for(let e=0;e<u.length;e++)h[2*e]=0,h[2*e+1]=u[e];h[h.length-2]=0,h[h.length-1]=0,n=l.slice(0);const f=new ArrayBuffer(o),d=new Uint8Array(f);for(let e=0;e<f.byteLength;e++)d[e]=3;const m=a.byteLength,p=o*Math.ceil(m/o),g=new ArrayBuffer(p),v=new Uint8Array(g),b=new Uint8Array(a);for(let e=0;e<p;e++)v[e]=b[e%m];const w=n.byteLength,y=o*Math.ceil(w/o),k=new ArrayBuffer(y),_=new Uint8Array(k),A=new Uint8Array(n);for(let e=0;e<y;e++)_[e]=A[e%w];const S=g.byteLength+k.byteLength;let C=new ArrayBuffer(S),x=new Uint8Array(C);x.set(v),x.set(_,v.length);const B=Math.ceil((r>>3)/s);let E=Promise.resolve(C);for(let r=0;r<=B;r++){E=E.then(e=>{const t=new ArrayBuffer(f.byteLength+e.byteLength),r=new Uint8Array(t);return r.set(d),r.set(x,d.length),t});for(let r=0;r<i;r++)E=E.then(r=>e.digest({name:t},new Uint8Array(r)));E=E.then(e=>{const t=new ArrayBuffer(o),r=new Uint8Array(t);for(let n=0;n<t.byteLength;n++)r[n]=e[n%e.length];const n=Math.ceil(m/o)+Math.ceil(w/o),a=[];let i=0,s=o;for(let e=0;e<n;e++){const e=Array.from(new Uint8Array(C.slice(i,i+s)));i+=o,i+o>C.byteLength&&(s=C.byteLength-i);let n=511;for(let a=t.byteLength-1;a>=0;a--)n>>=8,n+=r[a]+e[a],e[a]=255&n;a.push(...e)}return C=new ArrayBuffer(a.length),x=new Uint8Array(C),x.set(a),c.push(...new Uint8Array(e)),C})}return E=E.then(()=>{const e=new ArrayBuffer(r>>3);return new Uint8Array(e).set(new Uint8Array(c).slice(0,r>>3)),e}),E}class Xr{constructor(e={}){this.crypto=de(e,"crypto",{}),this.subtle=de(e,"subtle",{}),this.name=de(e,"name","")}importKey(e,t,r,n,a){let i={};switch(t instanceof Uint8Array&&(t=t.buffer),e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,n,a);case"spki":{const e=Dt(t);if(-1===e.offset)return Promise.reject("Incorrect keyData");const s=new Kr;try{s.fromSchema(e.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="PS1";break;case"SHA-256":i.alg="PS256";break;case"SHA-384":i.alg="PS384";break;case"SHA-512":i.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(a=["verify"],i.kty="RSA",i.ext=n,i.key_ops=a,"1.2.840.113549.1.1.1"!==s.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`);if("alg"in i==0)switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RS1";break;case"SHA-256":i.alg="RS256";break;case"SHA-384":i.alg="RS384";break;case"SHA-512":i.alg="RS512";break;default:return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`)}const e=s.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;case"ECDSA":a=["verify"];case"ECDH":{if(i={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==s.algorithm.algorithmId)return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`);const e=s.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;case"RSA-OAEP":{if(i.kty="RSA",i.ext=n,i.key_ops=a,"safari"===this.name.toLowerCase())i.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RSA-OAEP";break;case"SHA-256":i.alg="RSA-OAEP-256";break;case"SHA-384":i.alg="RSA-OAEP-384";break;case"SHA-512":i.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`)}const e=s.toJSON();for(const t of Object.keys(e))i[t]=e[t]}break;default:return Promise.reject(`Incorrect algorithm name: ${r.name.toUpperCase()}`)}}break;case"pkcs8":{const e=new qr,s=Dt(t);if(-1===s.offset)return Promise.reject("Incorrect keyData");try{e.fromSchema(s.result)}catch(e){return Promise.reject("Incorrect keyData")}if("parsedKey"in e==0)return Promise.reject("Incorrect keyData");switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="PS1";break;case"SHA-256":i.alg="PS256";break;case"SHA-384":i.alg="PS384";break;case"SHA-512":i.alg="PS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(a=["sign"],i.kty="RSA",i.ext=n,i.key_ops=a,"1.2.840.113549.1.1.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect private key algorithm: ${e.privateKeyAlgorithm.algorithmId}`);if("alg"in i==0)switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RS1";break;case"SHA-256":i.alg="RS256";break;case"SHA-384":i.alg="RS384";break;case"SHA-512":i.alg="RS512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;case"ECDSA":a=["sign"];case"ECDH":{if(i={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==e.privateKeyAlgorithm.algorithmId)return Promise.reject(`Incorrect algorithm: ${e.privateKeyAlgorithm.algorithmId}`);const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;case"RSA-OAEP":{if(i.kty="RSA",i.ext=n,i.key_ops=a,"safari"===this.name.toLowerCase())i.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":i.alg="RSA-OAEP";break;case"SHA-256":i.alg="RSA-OAEP-256";break;case"SHA-384":i.alg="RSA-OAEP-384";break;case"SHA-512":i.alg="RSA-OAEP-512";break;default:return Promise.reject(`Incorrect hash algorithm: ${r.hash.name.toUpperCase()}`)}const t=e.toJSON();for(const e of Object.keys(t))i[e]=t[e]}break;default:return Promise.reject(`Incorrect algorithm name: ${r.name.toUpperCase()}`)}}break;case"jwk":i=t;break;default:return Promise.reject(`Incorrect format: ${e}`)}return"safari"===this.name.toLowerCase()?Promise.resolve().then(()=>this.subtle.importKey("jwk",Be(JSON.stringify(i)),r,n,a)).then(e=>e,()=>this.subtle.importKey("jwk",i,r,n,a)):this.subtle.importKey("jwk",i,r,n,a)}exportKey(e,t){let r=this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&(r=r.then(e=>e instanceof ArrayBuffer?JSON.parse(xe(e)):e)),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":r=r.then(e=>{const t=new Kr;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"pkcs8":r=r.then(e=>{const t=new qr;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"jwk":break;default:return Promise.reject(`Incorrect format: ${e}`)}return r}convert(e,t,r,n,a,i){switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(r);case"spki":return Promise.resolve().then(()=>this.importKey("raw",r,n,a,i)).then(e=>this.exportKey("spki",e));case"pkcs8":return Promise.resolve().then(()=>this.importKey("raw",r,n,a,i)).then(e=>this.exportKey("pkcs8",e));case"jwk":return Promise.resolve().then(()=>this.importKey("raw",r,n,a,i)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("spki",r,n,a,i)).then(e=>this.exportKey("raw",e));case"spki":return Promise.resolve(r);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then(()=>this.importKey("spki",r,n,a,i)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("pkcs8",r,n,a,i)).then(e=>this.exportKey("raw",e));case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(r);case"jwk":return Promise.resolve().then(()=>this.importKey("pkcs8",r,n,a,i)).then(e=>this.exportKey("jwk",e));default:return Promise.reject(`Incorrect outputFormat: ${t}`)}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(()=>this.importKey("jwk",r,n,a,i)).then(e=>this.exportKey("raw",e));case"spki":return Promise.resolve().then(()=>this.importKey("jwk",r,n,a,i)).then(e=>this.exportKey("spki",e));case"pkcs8":return Promise.resolve().then(()=>this.importKey("jwk",r,n,a,i)).then(e=>this.exportKey("pkcs8",e));case"jwk":return Promise.resolve(r);default:return Promise.reject(`Incorrect outputFormat: ${t}`)}default:return Promise.reject(`Incorrect inputFormat: ${e}`)}}encrypt(...e){return this.subtle.encrypt(...e)}decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}verify(...e){return this.subtle.verify(...e)}digest(...e){return this.subtle.digest(...e)}generateKey(...e){return this.subtle.generateKey(...e)}deriveKey(...e){return this.subtle.deriveKey(...e)}deriveBits(...e){return this.subtle.deriveBits(...e)}wrapKey(...e){return this.subtle.wrapKey(...e)}unwrapKey(...e){return this.subtle.unwrapKey(...e)}getRandomValues(e){if("getRandomValues"in this.crypto==0)throw new Error("No support for getRandomValues");return this.crypto.getRandomValues(e)}getAlgorithmByOID(e){switch(e){case"1.2.840.113549.1.1.1":case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}}getOIDByAlgorithm(e){let t="";switch(e.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13"}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11"}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35"}return t}getAlgorithmParameters(e,t){let r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return r}getHashAlgorithm(e){let t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const r=new Zr({schema:e.algorithmParams});if("hashAlgorithm"in r){const e=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in e==0)return"";t=e.name}else t="SHA-1"}catch(e){}}return t}encryptEncryptedContentInfo(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e==0)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');if("contentType"in e==0)return Promise.reject('Absent mandatory parameter "contentType"');const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm);if(""===t)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');const r=this.getOIDByAlgorithm({name:"PBKDF2"});if(""===r)return Promise.reject("Can not find OID for PBKDF2");const n=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(""===n)return Promise.reject(`Incorrect value for "hmacHashAlgorithm": ${e.hmacHashAlgorithm}`);let a=Promise.resolve();const i=new ArrayBuffer(16),s=new Uint8Array(i);this.getRandomValues(s);const o=new ArrayBuffer(64),c=new Uint8Array(o);this.getRandomValues(c);const u=new Uint8Array(e.contentToEncrypt),l=new Gr({salt:new zt({valueHex:o}),iterationCount:e.iterationCount,prf:new Hr({algorithmId:n,algorithmParams:new Kt})});return a=a.then(()=>{const t=new Uint8Array(e.password);return this.importKey("raw",t,"PBKDF2",!1,["deriveKey"])},e=>Promise.reject(e)),a=a.then(t=>this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:c,iterations:e.iterationCount},t,e.contentEncryptionAlgorithm,!1,["encrypt"]),e=>Promise.reject(e)),a=a.then(t=>this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:s},t,u),e=>Promise.reject(e)),a=a.then(n=>{const a=new Qr({keyDerivationFunc:new Hr({algorithmId:r,algorithmParams:l.toSchema()}),encryptionScheme:new Hr({algorithmId:t,algorithmParams:new zt({valueHex:i})})});return new Wr({contentType:e.contentType,contentEncryptionAlgorithm:new Hr({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:a.toSchema()}),encryptedContent:new zt({valueHex:n})})},e=>Promise.reject(e)),a}decryptEncryptedContentInfo(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("encryptedContentInfo"in e==0)return Promise.reject('Absent mandatory parameter "encryptedContentInfo"');if("1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)return Promise.reject(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t,r,n=Promise.resolve();try{t=new Qr({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}try{r=new Gr({schema:t.keyDerivationFunc.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId);if("name"in a==0)return Promise.reject(`Incorrect OID for "contentEncryptionAlgorithm": ${t.encryptionScheme.algorithmId}`);const i=t.encryptionScheme.algorithmParams.valueBlock.valueHex,s=new Uint8Array(i),o=r.salt.valueBlock.valueHex,c=new Uint8Array(o),u=r.iterationCount;let l="SHA-1";if("prf"in r){const e=this.getAlgorithmByOID(r.prf.algorithmId);if("name"in e==0)return Promise.reject("Incorrect OID for HMAC hash algorithm");l=e.hash.name}return n=n.then(()=>this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),e=>Promise.reject(e)),n=n.then(e=>this.deriveKey({name:"PBKDF2",hash:{name:l},salt:c,iterations:u},e,a,!1,["decrypt"]),e=>Promise.reject(e)),n=n.then(t=>{let r=new ArrayBuffer(0);if(!1===e.encryptedContentInfo.encryptedContent.idBlock.isConstructed)r=e.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else for(const t of e.encryptedContentInfo.encryptedContent.valueBlock.value)r=ve(r,t.valueBlock.valueHex);return this.decrypt({name:a.name,iv:s},t,r)},e=>Promise.reject(e)),n}stampDataWithPassword(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "salt"');if("contentToStamp"in e==0)return Promise.reject('Absent mandatory parameter "contentToStamp"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let r=Promise.resolve();const n={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return r=r.then(()=>Yr(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)),r=r.then(e=>this.importKey("raw",new Uint8Array(e),n,!1,["sign"])),r=r.then(t=>this.sign(n,t,new Uint8Array(e.contentToStamp)),e=>Promise.reject(e)),r}verifyDataStampedWithPassword(e){if(e instanceof Object==0)return Promise.reject('Parameters must have type "Object"');if("password"in e==0)return Promise.reject('Absent mandatory parameter "password"');if("hashAlgorithm"in e==0)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');if("salt"in e==0)return Promise.reject('Absent mandatory parameter "iterationCount"');if("iterationCount"in e==0)return Promise.reject('Absent mandatory parameter "salt"');if("contentToVerify"in e==0)return Promise.reject('Absent mandatory parameter "contentToVerify"');if("signatureToVerify"in e==0)return Promise.reject('Absent mandatory parameter "signatureToVerify"');let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:return Promise.reject(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let r=Promise.resolve();const n={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}};return r=r.then(()=>Yr(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount)),r=r.then(e=>this.importKey("raw",new Uint8Array(e),n,!1,["verify"])),r=r.then(t=>this.verify(n,t,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify)),e=>Promise.reject(e)),r}getSignatureParameters(e,t="SHA-1"){if(""===this.getOIDByAlgorithm({name:t}))return Promise.reject(`Unsupported hash algorithm: ${t}`);const r=new Hr,n=this.getAlgorithmParameters(e.algorithm.name,"sign");switch(n.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(n.algorithm);break;case"RSA-PSS":{switch(t.toUpperCase()){case"SHA-256":n.algorithm.saltLength=32;break;case"SHA-384":n.algorithm.saltLength=48;break;case"SHA-512":n.algorithm.saltLength=64}const e={};if("SHA-1"!==t.toUpperCase()){const r=this.getOIDByAlgorithm({name:t});if(""===r)return Promise.reject(`Unsupported hash algorithm: ${t}`);e.hashAlgorithm=new Hr({algorithmId:r,algorithmParams:new Kt}),e.maskGenAlgorithm=new Hr({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.hashAlgorithm.toSchema()})}20!==n.algorithm.saltLength&&(e.saltLength=n.algorithm.saltLength);const a=new Zr(e);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=a.toSchema()}break;default:return Promise.reject(`Unsupported signature algorithm: ${e.algorithm.name}`)}return Promise.resolve().then(()=>({signatureAlgorithm:r,parameters:n}))}signWithPrivateKey(e,t,r){return this.sign(r.algorithm,t,new Uint8Array(e)).then(e=>("ECDSA"===r.algorithm.name&&(e=function(e){if(e.byteLength%2!=0)return new ArrayBuffer(0);const t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));const n=new Xt({valueHex:r}),a=new ArrayBuffer(t);new Uint8Array(a).set(new Uint8Array(e,t,t));const i=new Xt({valueHex:a});return new or({value:[n.convertToDER(),i.convertToDER()]}).toBER(!1)}(e)),e),e=>Promise.reject(`Signing error: ${e}`))}fillPublicKeyParameters(e,t){const r={},n=this.getHashAlgorithm(t);if(""===n)return Promise.reject(`Unsupported signature algorithm: ${t.algorithmId}`);let a;a="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;const i=this.getAlgorithmByOID(a);if("name"in i==="")return Promise.reject(`Unsupported public key algorithm: ${t.algorithmId}`);if(r.algorithm=this.getAlgorithmParameters(i.name,"importkey"),"hash"in r.algorithm.algorithm&&(r.algorithm.algorithm.hash.name=n),"ECDSA"===i.name){let t=!1;if("algorithmParams"in e.algorithm==1&&"idBlock"in e.algorithm.algorithmParams&&1===e.algorithm.algorithmParams.idBlock.tagClass&&6===e.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const n=this.getAlgorithmByOID(e.algorithm.algorithmParams.valueBlock.toString());if("name"in n==0)return Promise.reject(`Unsupported named curve algorithm: ${e.algorithm.algorithmParams.valueBlock.toString()}`);r.algorithm.algorithm.namedCurve=n.name}return r}getPublicKey(e,t,r=null){null===r&&(r=this.fillPublicKeyParameters(e,t));const n=e.toSchema().toBER(!1),a=new Uint8Array(n);return this.importKey("spki",a,r.algorithm.algorithm,!0,r.algorithm.usages)}verifyWithPublicKey(e,t,r,n,a=null){let i=Promise.resolve();if(null===a){if(""===(a=this.getHashAlgorithm(n)))return Promise.reject(`Unsupported signature algorithm: ${n.algorithmId}`);i=i.then(()=>this.getPublicKey(r,n))}else{const e={};let t;t="1.2.840.113549.1.1.10"===n.algorithmId?n.algorithmId:r.algorithm.algorithmId;const s=this.getAlgorithmByOID(t);if("name"in s==="")return Promise.reject(`Unsupported public key algorithm: ${n.algorithmId}`);if(e.algorithm=this.getAlgorithmParameters(s.name,"importkey"),"hash"in e.algorithm.algorithm&&(e.algorithm.algorithm.hash.name=a),"ECDSA"===s.name){let t=!1;if("algorithmParams"in r.algorithm==1&&"idBlock"in r.algorithm.algorithmParams&&1===r.algorithm.algorithmParams.idBlock.tagClass&&6===r.algorithm.algorithmParams.idBlock.tagNumber&&(t=!0),!1===t)return Promise.reject("Incorrect type for ECDSA public key parameters");const n=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString());if("name"in n==0)return Promise.reject(`Unsupported named curve algorithm: ${r.algorithm.algorithmParams.valueBlock.toString()}`);e.algorithm.algorithm.namedCurve=n.name}i=i.then(()=>this.getPublicKey(r,null,e))}return i=i.then(r=>{const i=this.getAlgorithmParameters(r.algorithm.name,"verify");"hash"in i.algorithm&&(i.algorithm.hash.name=a);let s=t.valueBlock.valueHex;if("ECDSA"===r.algorithm.name&&(s=function(e){if(e instanceof or==0)return new ArrayBuffer(0);if(2!==e.valueBlock.value.length)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof Xt==0)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof Xt==0)return new ArrayBuffer(0);const t=e.valueBlock.value[0].convertFromDER(),r=e.valueBlock.value[1].convertFromDER();switch(!0){case t.valueBlock.valueHex.byteLength<r.valueBlock.valueHex.byteLength:{if(r.valueBlock.valueHex.byteLength-t.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");const e=r.valueBlock.valueHex.byteLength,n=new Uint8Array(t.valueBlock.valueHex),a=new ArrayBuffer(e),i=new Uint8Array(a);return i.set(n,1),i[0]=0,ve(a,r.valueBlock.valueHex)}case t.valueBlock.valueHex.byteLength>r.valueBlock.valueHex.byteLength:{if(t.valueBlock.valueHex.byteLength-r.valueBlock.valueHex.byteLength!==1)throw new Error("Incorrect DER integer decoding");const e=t.valueBlock.valueHex.byteLength,n=new Uint8Array(r.valueBlock.valueHex),a=new ArrayBuffer(e),i=new Uint8Array(a);return i.set(n,1),i[0]=0,ve(t.valueBlock.valueHex,a)}default:if(t.valueBlock.valueHex.byteLength%2){const e=t.valueBlock.valueHex.byteLength+1,n=new Uint8Array(t.valueBlock.valueHex),a=new ArrayBuffer(e),i=new Uint8Array(a);i.set(n,1),i[0]=0;const s=new Uint8Array(r.valueBlock.valueHex),o=new ArrayBuffer(e),c=new Uint8Array(o);return c.set(s,1),c[0]=0,ve(a,o)}}return ve(t.valueBlock.valueHex,r.valueBlock.valueHex)}(Dt(s).result)),"RSA-PSS"===r.algorithm.name){let e;try{e=new Zr({schema:n.algorithmParams})}catch(e){return Promise.reject(e)}i.algorithm.saltLength="saltLength"in e?e.saltLength:20;let t="SHA-1";if("hashAlgorithm"in e){const r=this.getAlgorithmByOID(e.hashAlgorithm.algorithmId);if("name"in r==0)return Promise.reject(`Unrecognized hash algorithm: ${e.hashAlgorithm.algorithmId}`);t=r.name}i.algorithm.hash.name=t}return this.verify(i.algorithm,r,new Uint8Array(s),new Uint8Array(e))}),i}}let en={name:"none",crypto:null,subtle:null};function tn(){if("undefined"!=typeof process&&"pid"in process&&void 0!==n.g){let e;try{e=n.g[process.pid].pkijs.engine}catch(e){throw new Error('Please call "setEngine" before call to "getEngine"')}return e}return en}function rn(){const e=tn();if(null!==e.subtle)return e.subtle}function nn(e){let t=!1,r="";const n=e.trim();for(let e=0;e<n.length;e++)32===n.charCodeAt(e)?!1===t&&(t=!0):(t&&(r+=" ",t=!1),r+=n[e]);return r.toLowerCase()}!function(){if("undefined"!=typeof self&&"crypto"in self){let e="webcrypto";const t=self.crypto;let r;if("webkitSubtle"in self.crypto){try{r=self.crypto.webkitSubtle}catch(e){r=self.crypto.subtle}e="safari"}"subtle"in self.crypto&&(r=self.crypto.subtle),en=void 0===r?{name:e,crypto:t,subtle:null}:{name:e,crypto:t,subtle:new Xr({name:e,crypto:self.crypto,subtle:r})}}!function(e,t,r){if("undefined"!=typeof process&&"pid"in process&&void 0!==n.g&&"undefined"==typeof window){if(void 0===n.g[process.pid])n.g[process.pid]={};else if("object"!=typeof n.g[process.pid])throw new Error(`Name global.${process.pid} already exists and it is not an object`);if(void 0===n.g[process.pid].pkijs)n.g[process.pid].pkijs={};else if("object"!=typeof n.g[process.pid].pkijs)throw new Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);n.g[process.pid].pkijs.engine={name:e,crypto:t,subtle:r}}else en={name:e,crypto:t,subtle:r}}(en.name,en.crypto,en.subtle)}();class an{constructor(e={}){this.type=de(e,"type",an.defaultValues("type")),this.value=de(e,"value",an.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return"";case"value":return{};default:throw new Error(`Invalid member name for AttributeTypeAndValue class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.type||""}),new Ur({name:t.value||""})]})}fromSchema(e){Pe(e,["type","typeValue"]);const t=Vr(e,e,an.schema({names:{type:"type",value:"typeValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AttributeTypeAndValue");this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new or({value:[new nr({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){if(e instanceof an){if(this.type!==e.type)return!1;if(this.value instanceof dr&&e.value instanceof dr||this.value instanceof pr&&e.value instanceof pr||this.value instanceof vr&&e.value instanceof vr||this.value instanceof br&&e.value instanceof br||this.value instanceof wr&&e.value instanceof wr||this.value instanceof yr&&e.value instanceof yr||this.value instanceof kr&&e.value instanceof kr||this.value instanceof _r&&e.value instanceof _r||this.value instanceof Ar&&e.value instanceof Ar||this.value instanceof Sr&&e.value instanceof Sr||this.value instanceof Cr&&e.value instanceof Cr||this.value instanceof xr&&e.value instanceof xr){const t=nn(this.value.valueBlock.value),r=nn(e.value.valueBlock.value);if(0!==t.localeCompare(r))return!1}else if(!1===ye(this.value.valueBeforeDecode,e.value.valueBeforeDecode))return!1;return!0}return e instanceof ArrayBuffer&&ye(this.value.valueBeforeDecode,e)}}class sn{constructor(e={}){this.typesAndValues=de(e,"typesAndValues",sn.defaultValues("typesAndValues")),this.valueBeforeDecode=de(e,"valueBeforeDecode",sn.defaultValues("valueBeforeDecode")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"typesAndValues":return 0===t.length;case"valueBeforeDecode":return 0===t.byteLength;default:throw new Error(`Invalid member name for RelativeDistinguishedNames class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.repeatedSequence||"",value:new cr({value:[new Dr({name:t.repeatedSet||"",value:an.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){Pe(e,["RDN","typesAndValues"]);const t=Vr(e,e,sn.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for RelativeDistinguishedNames");"typesAndValues"in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,e=>new an({schema:e}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecode}toSchema(){return 0===this.valueBeforeDecode.byteLength?new or({value:[new cr({value:Array.from(this.typesAndValues,e=>e.toSchema())})]}):Dt(this.valueBeforeDecode).result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof sn){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,r]of this.typesAndValues.entries())if(!1===r.isEqual(e.typesAndValues[t]))return!1;return!0}return e instanceof ArrayBuffer&&ye(this.valueBeforeDecode,e)}}function on(e={},t=!1){const r=de(e,"names",{});return new or({optional:t,value:[new Ht({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:r.country_name||"",value:[new jr({value:[new br,new wr]})]}),new Ht({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:r.administration_domain_name||"",value:[new jr({value:[new br,new wr]})]}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:r.network_address||"",isHexOnly:!0}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:r.terminal_identifier||"",isHexOnly:!0}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:r.private_domain_name||"",value:[new jr({value:[new br,new wr]})]}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:r.organization_name||"",isHexOnly:!0}),new Ut({optional:!0,name:r.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new Ht({optional:!0,name:r.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new Ut({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new Ht({optional:!0,name:r.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new Dr({value:new wr})]})]})}function cn(e=!1){return new or({optional:e,value:[new wr,new wr]})}function un(e=!1){return new cr({optional:e,value:[new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ur]})]})}class ln{constructor(e={}){this.type=de(e,"type",ln.defaultValues("type")),this.value=de(e,"value",ln.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static compareWithDefault(e,t){switch(e){case"type":return t===ln.defaultValues(e);case"value":return 0===Object.keys(t).length;default:throw new Error(`Invalid member name for GeneralName class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new jr({value:[new Ht({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||"",value:[new nr,new Ht({idBlock:{tagClass:3,tagNumber:0},value:[new Ur]})]}),new Ut({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new Ut({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new Ht({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||"",value:[on(t.builtInStandardAttributes||{},!1),cn(!0),un(!0)]}),new Ht({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||"",value:[sn.schema(t.directoryName||{})]}),new Ht({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||"",value:[new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new jr({value:[new yr,new wr,new vr,new dr,new pr]})]}),new Ht({idBlock:{tagClass:3,tagNumber:1},value:[new jr({value:[new yr,new wr,new vr,new dr,new pr]})]})]}),new Ut({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new Ut({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new Ut({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){Pe(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=Vr(e,e,ln.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralName");switch(this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=22;const r=e.toBER(!1);this.value=Dt(r).result.valueBlock.value}break;case 4:this.value=new sn({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new zt({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=6;const r=e.toBER(!1);this.value=Dt(r).result.valueBlock.toString()}}}toSchema(){switch(this.type){case 0:case 3:case 5:return new Ht({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new _r({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new Ht({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new nr({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return ln.schema()}}toJSON(){const e={type:this.type,value:""};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}class hn{constructor(e={}){this.accessMethod=de(e,"accessMethod",hn.defaultValues("accessMethod")),this.accessLocation=de(e,"accessLocation",hn.defaultValues("accessLocation")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"accessMethod":return"";case"accessLocation":return new ln;default:throw new Error(`Invalid member name for AccessDescription class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.accessMethod||""}),ln.schema(t.accessLocation||{})]})}fromSchema(e){Pe(e,["accessMethod","accessLocation"]);const t=Vr(e,e,hn.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new ln({schema:t.result.accessLocation})}toSchema(){return new or({value:[new nr({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}class fn{constructor(e={}){this.altNames=de(e,"altNames",fn.defaultValues("altNames")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("altNames"===e)return[];throw new Error(`Invalid member name for AltName class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.altNames||"",value:ln.schema()})]})}fromSchema(e){Pe(e,["altNames"]);const t=Vr(e,e,fn.schema({names:{altNames:"altNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AltName");"altNames"in t.result&&(this.altNames=Array.from(t.result.altNames,e=>new ln({schema:e})))}toSchema(){return new or({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}class dn{constructor(e={}){this.type=de(e,"type",dn.defaultValues("type")),this.value=de(e,"value",dn.defaultValues("value")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error(`Invalid member name for Time class: ${e}`)}}static schema(e={},t=!1){const r=de(e,"names",{});return new jr({optional:t,value:[new Br({name:r.utcTimeName||""}),new Er({name:r.generalTimeName||""})]})}fromSchema(e){Pe(e,["utcTimeName","generalTimeName"]);const t=Vr(e,e,dn.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Time");"utcTimeName"in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),"generalTimeName"in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){let e={};return 0===this.type&&(e=new Br({valueDate:this.value})),1===this.type&&(e=new Er({valueDate:this.value})),e}toJSON(){return{type:this.type,value:this.value}}}class mn{constructor(e={}){this.attributes=de(e,"attributes",mn.defaultValues("attributes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("attributes"===e)return[];throw new Error(`Invalid member name for SubjectDirectoryAttributes class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.attributes||"",value:Fr.schema()})]})}fromSchema(e){Pe(e,["attributes"]);const t=Vr(e,e,mn.schema({names:{attributes:"attributes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(t.result.attributes,e=>new Fr({schema:e}))}toSchema(){return new or({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}class pn{constructor(e={}){"notBefore"in e&&(this.notBefore=de(e,"notBefore",pn.defaultValues("notBefore"))),"notAfter"in e&&(this.notAfter=de(e,"notAfter",pn.defaultValues("notAfter"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"notBefore":case"notAfter":return new Date;default:throw new Error(`Invalid member name for PrivateKeyUsagePeriod class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Ut({name:t.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ut({name:t.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){Pe(e,["notBefore","notAfter"]);const t=Vr(e,e,pn.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in t.result){const e=new Er;e.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=e.toDate()}if("notAfter"in t.result){const e=new Er({valueHex:t.result.notAfter.valueBlock.valueHex});e.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=e.toDate()}}toSchema(){const e=[];return"notBefore"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:0},valueHex:new Er({valueDate:this.notBefore}).valueBlock.valueHex})),"notAfter"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:1},valueHex:new Er({valueDate:this.notAfter}).valueBlock.valueHex})),new or({value:e})}toJSON(){const e={};return"notBefore"in this&&(e.notBefore=this.notBefore),"notAfter"in this&&(e.notAfter=this.notAfter),e}}class gn{constructor(e={}){this.cA=de(e,"cA",!1),"pathLenConstraint"in e&&(this.pathLenConstraint=de(e,"pathLenConstraint",0)),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("cA"===e)return!1;throw new Error(`Invalid member name for BasicConstraints class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Mt({optional:!0,name:t.cA||""}),new Xt({optional:!0,name:t.pathLenConstraint||""})]})}fromSchema(e){Pe(e,["cA","pathLenConstraint"]);const t=Vr(e,e,gn.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for BasicConstraints");"cA"in t.result&&(this.cA=t.result.cA.valueBlock.value),"pathLenConstraint"in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==gn.defaultValues("cA")&&e.push(new Mt({value:this.cA})),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof Xt?e.push(this.pathLenConstraint):e.push(new Xt({value:this.pathLenConstraint}))),new or({value:e})}toJSON(){const e={};return this.cA!==gn.defaultValues("cA")&&(e.cA=this.cA),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof Xt?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}class vn{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=de(e,"distributionPoint",vn.defaultValues("distributionPoint"))),this.onlyContainsUserCerts=de(e,"onlyContainsUserCerts",vn.defaultValues("onlyContainsUserCerts")),this.onlyContainsCACerts=de(e,"onlyContainsCACerts",vn.defaultValues("onlyContainsCACerts")),"onlySomeReasons"in e&&(this.onlySomeReasons=de(e,"onlySomeReasons",vn.defaultValues("onlySomeReasons"))),this.indirectCRL=de(e,"indirectCRL",vn.defaultValues("indirectCRL")),this.onlyContainsAttributeCerts=de(e,"onlyContainsAttributeCerts",vn.defaultValues("onlyContainsAttributeCerts")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":case"onlyContainsCACerts":case"indirectCRL":case"onlyContainsAttributeCerts":return!1;case"onlySomeReasons":return 0;default:throw new Error(`Invalid member name for IssuingDistributionPoint class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new jr({value:[new Ht({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new Dr({name:t.distributionPointNames||"",value:ln.schema()})]}),new Ht({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:sn.schema().valueBlock.value})]})]}),new Ut({name:t.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ut({name:t.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Ut({name:t.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Ut({name:t.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Ut({name:t.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){Pe(e,["distributionPoint","distributionPointNames","onlyContainsUserCerts","onlyContainsCACerts","onlySomeReasons","indirectCRL","onlyContainsAttributeCerts"]);const t=Vr(e,e,vn.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new ln({schema:e}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new sn({schema:new or({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if("onlyContainsUserCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==e[0]}if("onlyContainsCACerts"in t.result){const e=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==e[0]}if("onlySomeReasons"in t.result){const e=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=e[0]}if("indirectCRL"in t.result){const e=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==e[0]}if("onlyContainsAttributeCerts"in t.result){const e=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==e[0]}}toSchema(){const e=[];if("distributionPoint"in this){let t;this.distributionPoint instanceof Array?t=new Ht({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(t)}if(this.onlyContainsUserCerts!==vn.defaultValues("onlyContainsUserCerts")&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==vn.defaultValues("onlyContainsCACerts")&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),"onlySomeReasons"in this){const t=new ArrayBuffer(1);new Uint8Array(t)[0]=this.onlySomeReasons,e.push(new Ut({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==vn.defaultValues("indirectCRL")&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==vn.defaultValues("onlyContainsAttributeCerts")&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new or({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==vn.defaultValues("onlyContainsUserCerts")&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==vn.defaultValues("onlyContainsCACerts")&&(e.onlyContainsCACerts=this.onlyContainsCACerts),"onlySomeReasons"in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==vn.defaultValues("indirectCRL")&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==vn.defaultValues("onlyContainsAttributeCerts")&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}class bn{constructor(e={}){this.names=de(e,"names",bn.defaultValues("names")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("names"===e)return[];throw new Error(`Invalid member name for GeneralNames class: ${e}`)}static schema(e={},t=!1){const r=de(e,"names",{});return new or({optional:t,name:r.blockName||"",value:[new Dr({name:r.generalNames||"",value:ln.schema()})]})}fromSchema(e){Pe(e,["names","generalNames"]);const t=Vr(e,e,bn.schema({names:{blockName:"names",generalNames:"generalNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(t.result.generalNames,e=>new ln({schema:e}))}toSchema(){return new or({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}class wn{constructor(e={}){this.base=de(e,"base",wn.defaultValues("base")),this.minimum=de(e,"minimum",wn.defaultValues("minimum")),"maximum"in e&&(this.maximum=de(e,"maximum",wn.defaultValues("maximum"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"base":return new ln;case"minimum":case"maximum":return 0;default:throw new Error(`Invalid member name for GeneralSubtree class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[ln.schema(t.base||{}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Xt({name:t.minimum||""})]}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Xt({name:t.maximum||""})]})]})}fromSchema(e){Pe(e,["base","minimum","maximum"]);const t=Vr(e,e,wn.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for GeneralSubtree");this.base=new ln({schema:t.result.base}),"minimum"in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),"maximum"in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),0!==this.minimum){let t=0;t=this.minimum instanceof Xt?this.minimum:new Xt({value:this.minimum}),e.push(new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){let t=0;t=this.maximum instanceof Xt?this.maximum:new Xt({value:this.maximum}),e.push(new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new or({value:e})}toJSON(){const e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),"maximum"in this&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}class yn{constructor(e={}){"permittedSubtrees"in e&&(this.permittedSubtrees=de(e,"permittedSubtrees",yn.defaultValues("permittedSubtrees"))),"excludedSubtrees"in e&&(this.excludedSubtrees=de(e,"excludedSubtrees",yn.defaultValues("excludedSubtrees"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"permittedSubtrees":case"excludedSubtrees":return[];default:throw new Error(`Invalid member name for NameConstraints class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Dr({name:t.permittedSubtrees||"",value:wn.schema()})]}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Dr({name:t.excludedSubtrees||"",value:wn.schema()})]})]})}fromSchema(e){Pe(e,["permittedSubtrees","excludedSubtrees"]);const t=Vr(e,e,yn.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for NameConstraints");"permittedSubtrees"in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,e=>new wn({schema:e}))),"excludedSubtrees"in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,e=>new wn({schema:e})))}toSchema(){const e=[];return"permittedSubtrees"in this&&e.push(new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new or({value:Array.from(this.permittedSubtrees,e=>e.toSchema())})]})),"excludedSubtrees"in this&&e.push(new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new or({value:Array.from(this.excludedSubtrees,e=>e.toSchema())})]})),new or({value:e})}toJSON(){const e={};return"permittedSubtrees"in this&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,e=>e.toJSON())),"excludedSubtrees"in this&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,e=>e.toJSON())),e}}class kn{constructor(e={}){"distributionPoint"in e&&(this.distributionPoint=de(e,"distributionPoint",kn.defaultValues("distributionPoint"))),"reasons"in e&&(this.reasons=de(e,"reasons",kn.defaultValues("reasons"))),"cRLIssuer"in e&&(this.cRLIssuer=de(e,"cRLIssuer",kn.defaultValues("cRLIssuer"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"distributionPoint":case"cRLIssuer":return[];case"reasons":return new Wt;default:throw new Error(`Invalid member name for DistributionPoint class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new jr({value:[new Ht({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Dr({name:t.distributionPointNames||"",value:ln.schema()})]}),new Ht({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:sn.schema().valueBlock.value})]})]}),new Ut({name:t.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ht({name:t.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Dr({name:t.cRLIssuerNames||"",value:ln.schema()})]})]})}fromSchema(e){Pe(e,["distributionPoint","distributionPointNames","reasons","cRLIssuer","cRLIssuerNames"]);const t=Vr(e,e,kn.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for DistributionPoint");"distributionPoint"in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new ln({schema:e}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new sn({schema:new or({value:t.result.distributionPoint.valueBlock.value})}))),"reasons"in t.result&&(this.reasons=new Wt({valueHex:t.result.reasons.valueBlock.valueHex})),"cRLIssuer"in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,e=>new ln({schema:e})))}toSchema(){const e=[];if("distributionPoint"in this){let t;t=this.distributionPoint instanceof Array?new Ht({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):new Ht({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new Ht({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return"reasons"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex})),"cRLIssuer"in this&&e.push(new Ht({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,e=>e.toSchema())})),new or({value:e})}toJSON(){const e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),"reasons"in this&&(e.reasons=this.reasons.toJSON()),"cRLIssuer"in this&&(e.cRLIssuer=Array.from(this.cRLIssuer,e=>e.toJSON())),e}}class _n{constructor(e={}){this.distributionPoints=de(e,"distributionPoints",_n.defaultValues("distributionPoints")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("distributionPoints"===e)return[];throw new Error(`Invalid member name for CRLDistributionPoints class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.distributionPoints||"",value:kn.schema()})]})}fromSchema(e){Pe(e,["distributionPoints"]);const t=Vr(e,e,_n.schema({names:{distributionPoints:"distributionPoints"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(t.result.distributionPoints,e=>new kn({schema:e}))}toSchema(){return new or({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}class An{constructor(e={}){this.policyQualifierId=de(e,"policyQualifierId",An.defaultValues("policyQualifierId")),this.qualifier=de(e,"qualifier",An.defaultValues("qualifier")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new Ur;default:throw new Error(`Invalid member name for PolicyQualifierInfo class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.policyQualifierId||""}),new Ur({name:t.qualifier||""})]})}fromSchema(e){Pe(e,["policyQualifierId","qualifier"]);const t=Vr(e,e,An.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new or({value:[new nr({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}class Sn{constructor(e={}){this.policyIdentifier=de(e,"policyIdentifier",Sn.defaultValues("policyIdentifier")),"policyQualifiers"in e&&(this.policyQualifiers=de(e,"policyQualifiers",Sn.defaultValues("policyQualifiers"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error(`Invalid member name for PolicyInformation class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.policyIdentifier||""}),new or({optional:!0,value:[new Dr({name:t.policyQualifiers||"",value:An.schema()})]})]})}fromSchema(e){Pe(e,["policyIdentifier","policyQualifiers"]);const t=Vr(e,e,Sn.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),"policyQualifiers"in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,e=>new An({schema:e})))}toSchema(){const e=[];return e.push(new nr({value:this.policyIdentifier})),"policyQualifiers"in this&&e.push(new or({value:Array.from(this.policyQualifiers,e=>e.toSchema())})),new or({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return"policyQualifiers"in this&&(e.policyQualifiers=Array.from(this.policyQualifiers,e=>e.toJSON())),e}}class Cn{constructor(e={}){this.certificatePolicies=de(e,"certificatePolicies",Cn.defaultValues("certificatePolicies")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("certificatePolicies"===e)return[];throw new Error(`Invalid member name for CertificatePolicies class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.certificatePolicies||"",value:Sn.schema()})]})}fromSchema(e){Pe(e,["certificatePolicies"]);const t=Vr(e,e,Cn.schema({names:{certificatePolicies:"certificatePolicies"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(t.result.certificatePolicies,e=>new Sn({schema:e}))}toSchema(){return new or({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}class xn{constructor(e={}){this.issuerDomainPolicy=de(e,"issuerDomainPolicy",xn.defaultValues("issuerDomainPolicy")),this.subjectDomainPolicy=de(e,"subjectDomainPolicy",xn.defaultValues("subjectDomainPolicy")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"issuerDomainPolicy":case"subjectDomainPolicy":return"";default:throw new Error(`Invalid member name for PolicyMapping class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.issuerDomainPolicy||""}),new nr({name:t.subjectDomainPolicy||""})]})}fromSchema(e){Pe(e,["issuerDomainPolicy","subjectDomainPolicy"]);const t=Vr(e,e,xn.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new or({value:[new nr({value:this.issuerDomainPolicy}),new nr({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}class Bn{constructor(e={}){this.mappings=de(e,"mappings",Bn.defaultValues("mappings")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("mappings"===e)return[];throw new Error(`Invalid member name for PolicyMappings class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.mappings||"",value:xn.schema()})]})}fromSchema(e){Pe(e,["mappings"]);const t=Vr(e,e,Bn.schema({names:{mappings:"mappings"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(t.result.mappings,e=>new xn({schema:e}))}toSchema(){return new or({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}class En{constructor(e={}){"keyIdentifier"in e&&(this.keyIdentifier=de(e,"keyIdentifier",En.defaultValues("keyIdentifier"))),"authorityCertIssuer"in e&&(this.authorityCertIssuer=de(e,"authorityCertIssuer",En.defaultValues("authorityCertIssuer"))),"authorityCertSerialNumber"in e&&(this.authorityCertSerialNumber=de(e,"authorityCertSerialNumber",En.defaultValues("authorityCertSerialNumber"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"keyIdentifier":return new zt;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new Xt;default:throw new Error(`Invalid member name for AuthorityKeyIdentifier class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Ut({name:t.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Dr({name:t.authorityCertIssuer||"",value:ln.schema()})]}),new Ut({name:t.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){Pe(e,["keyIdentifier","authorityCertIssuer","authorityCertSerialNumber"]);const t=Vr(e,e,En.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");"keyIdentifier"in t.result&&(this.keyIdentifier=new zt({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,e=>new ln({schema:e}))),"authorityCertSerialNumber"in t.result&&(this.authorityCertSerialNumber=new Xt({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return"keyIdentifier"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHex})),"authorityCertIssuer"in this&&e.push(new Ht({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,e=>e.toSchema())})),"authorityCertSerialNumber"in this&&e.push(new Ut({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHex})),new or({value:e})}toJSON(){const e={};return"keyIdentifier"in this&&(e.keyIdentifier=this.keyIdentifier.toJSON()),"authorityCertIssuer"in this&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,e=>e.toJSON())),"authorityCertSerialNumber"in this&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}class In{constructor(e={}){"requireExplicitPolicy"in e&&(this.requireExplicitPolicy=de(e,"requireExplicitPolicy",In.defaultValues("requireExplicitPolicy"))),"inhibitPolicyMapping"in e&&(this.inhibitPolicyMapping=de(e,"inhibitPolicyMapping",In.defaultValues("inhibitPolicyMapping"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"requireExplicitPolicy":case"inhibitPolicyMapping":return 0;default:throw new Error(`Invalid member name for PolicyConstraints class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Ut({name:t.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ut({name:t.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){Pe(e,["requireExplicitPolicy","inhibitPolicyMapping"]);const t=Vr(e,e,In.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in t.result){const e=t.result.requireExplicitPolicy;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const r=Dt(e.toBER(!1));this.requireExplicitPolicy=r.result.valueBlock.valueDec}if("inhibitPolicyMapping"in t.result){const e=t.result.inhibitPolicyMapping;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;const r=Dt(e.toBER(!1));this.inhibitPolicyMapping=r.result.valueBlock.valueDec}}toSchema(){const e=[];if("requireExplicitPolicy"in this){const t=new Xt({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("inhibitPolicyMapping"in this){const t=new Xt({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new or({value:e})}toJSON(){const e={};return"requireExplicitPolicy"in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),"inhibitPolicyMapping"in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}class Pn{constructor(e={}){this.keyPurposes=de(e,"keyPurposes",Pn.defaultValues("keyPurposes")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("keyPurposes"===e)return[];throw new Error(`Invalid member name for ExtKeyUsage class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.keyPurposes||"",value:new nr})]})}fromSchema(e){Pe(e,["keyPurposes"]);const t=Vr(e,e,Pn.schema({names:{keyPurposes:"keyPurposes"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(t.result.keyPurposes,e=>e.valueBlock.toString())}toSchema(){return new or({value:Array.from(this.keyPurposes,e=>new nr({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}class Nn{constructor(e={}){this.accessDescriptions=de(e,"accessDescriptions",Nn.defaultValues("accessDescriptions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("accessDescriptions"===e)return[];throw new Error(`Invalid member name for InfoAccess class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new Dr({name:t.accessDescriptions||"",value:hn.schema()})]})}fromSchema(e){Pe(e,["accessDescriptions"]);const t=Vr(e,e,Nn.schema({names:{accessDescriptions:"accessDescriptions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(t.result.accessDescriptions,e=>new hn({schema:e}))}toSchema(){return new or({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}class On{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}toString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let n=e;n<e+t;n++)r+=String.fromCharCode(this.view[n]);return r}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);let n=0,a=0;for(let i=0;i<t;i++)i%2?(a|=r.get(e.charAt(i)),this.view[n]=a,n++):a=r.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let n=e;n<e+t;n++){const e=this.view[n].toString(16).toUpperCase();r=r+(1==e.length?"0":"")+e}return r}copy(e=0,t=this.length-e){if(!e&&!this.length)return new On;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new On({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new On;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new On({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,r=e.length,n=e._view.subarray();this.realloc(t+r),this._view.set(n,t)}insert(e,t=0,r=this.length-t){return!(t>this.length-1||(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),0))}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n),o=e.length;if(o>i)return-1;const c=[];for(let t=0;t<o;t++)c.push(e.view[t]);for(let e=0;e<=i-o;e++){let t=!0;const r=s?a-o-e:a+e;for(let e=0;e<o;e++)if(this.view[e+r]!=c[e]){t=!1;break}if(t)return s?a-o-e:a+o+e}return-1}findFirstIn(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n),o={id:-1,position:s?0:a+i,length:0};for(let t=0;t<e.length;t++){const r=this.findPattern(e[t],a,i,s);if(-1!=r){let n=!1;const a=e[t].length;s?r-a>=o.position-o.length&&(n=!0):r-a<=o.position-o.length&&(n=!0),n&&(o.position=r,o.id=t,o.length=a)}}return o}findAllIn(e,t,r){let{start:n,length:a}=this.prepareFindParameters(t,r);const i=[];let s={id:-1,position:n};for(;;){const t=s.position;if(s=this.findFirstIn(e,s.position,a),-1==s.id)break;a-=s.position-t,i.push({id:s.id,position:s.position})}return i}findAllPatternIn(e,t,r){const{start:n,length:a}=this.prepareFindParameters(t,r),i=[],s=e.length;if(s>a)return-1;const o=Array.from(e.view);for(let e=0;e<=a-s;e++){let t=!0;const r=n+e;for(let e=0;e<s;e++)if(this.view[e+r]!=o[e]){t=!1;break}t&&(i.push(n+s+e),e+=s-1)}return i}findFirstNotIn(e,t,r,n){let{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);const o={left:{id:-1,position:a},right:{id:-1,position:0},value:new On};let c=i;for(;c>0;){if(o.right=this.findFirstIn(e,s?a-i+c:a+i-c,c,s),-1==o.right.id){i=c,s?a-=i:a=o.left.position,o.value=new On({buffer:this._buffer.slice(a,a+i)});break}if(o.right.position!=(s?o.left.position-e[o.right.id].length:o.left.position+e[o.right.id].length)){s?(a=o.right.position+e[o.right.id].length,i=o.left.position-o.right.position-e[o.right.id].length):(a=o.left.position,i=o.right.position-o.left.position-e[o.right.id].length),o.value=new On({buffer:this._buffer.slice(a,a+i)});break}o.left=o.right,c-=e[o.right.id].length}if(s){const e=o.right;o.right=o.left,o.left=e}return o}findAllNotIn(e,t,r){let{start:n,length:a}=this.prepareFindParameters(t,r);const i=[];let s={left:{id:-1,position:n},right:{id:-1,position:n},value:new On};do{const t=s.right.position;s=this.findFirstNotIn(e,s.right.position,a),a-=s.right.position-t,i.push({left:{id:s.left.id,position:s.left.position},right:{id:s.right.id,position:s.right.position},value:s.value})}while(-1!=s.right.id);return i}findFirstSequence(e,t,r,n){let{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);const o=this.skipNotPatterns(e,a,i,s);if(-1==o)return{position:-1,value:new On};const c=this.skipPatterns(e,o,i-(s?a-o:o-a),s);return s?(a=c,i=o-c):(a=o,i=c-o),{position:c,value:new On({buffer:this._buffer.slice(a,a+i)})}}findAllSequences(e,t,r){let{start:n,length:a}=this.prepareFindParameters(t,r);const i=[];let s={position:n,value:new On};do{const t=s.position;s=this.findFirstSequence(e,s.position,a),-1!=s.position&&(a-=s.position-t,i.push({position:s.position,value:s.value}))}while(-1!=s.position);return i}findPairedPatterns(e,t,r,n){const a=[];if(e.isEqual(t))return a;const{start:i,length:s}=this.prepareFindParameters(r,n);let o=0;const c=this.findAllPatternIn(e,i,s);if(!Array.isArray(c)||0==c.length)return a;const u=this.findAllPatternIn(t,i,s);if(!Array.isArray(u)||0==u.length)return a;for(;o<c.length&&0!=u.length;)if(c[0]!=u[0]){if(c[o]>u[0])break;for(;c[o]<u[0]&&(o++,!(o>=c.length)););a.push({left:c[o-1],right:u[0]}),c.splice(o-1,1),u.splice(0,1),o=0}else a.push({left:c[0],right:u[0]}),c.splice(0,1),u.splice(0,1);return a.sort((e,t)=>e.left-t.left),a}findPairedArrays(e,t,r,n){const{start:a,length:i}=this.prepareFindParameters(r,n),s=[];let o=0;const c=this.findAllIn(e,a,i);if(0==c.length)return s;const u=this.findAllIn(t,a,i);if(0==u.length)return s;for(;o<c.length&&0!=u.length;)if(c[0].position!=u[0].position){if(c[o].position>u[0].position)break;for(;c[o].position<u[0].position&&(o++,!(o>=c.length)););s.push({left:c[o-1],right:u[0]}),c.splice(o-1,1),u.splice(0,1),o=0}else s.push({left:c[0],right:u[0]}),c.splice(0,1),u.splice(0,1);return s.sort((e,t)=>e.left.position-t.left.position),s}replacePattern(e,t,r,n,a=null){let i,s=[];const o={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:c,length:u}=this.prepareFindParameters(r,n);if(null==a){if(s=this.findAllIn([e],c,u),0==s.length)return o}else s=a;o.searchPatternPositions.push(...Array.from(s,e=>e.position));const l=e.length-t.length,h=new ArrayBuffer(this.view.length-s.length*l),f=new Uint8Array(h);for(f.set(new Uint8Array(this.buffer,0,c)),i=0;i<s.length;i++){const r=0==i?c:s[i-1].position;f.set(new Uint8Array(this.buffer,r,s[i].position-e.length-r),r-i*l),f.set(t.view,s[i].position-e.length-i*l),o.replacePatternPositions.push(s[i].position-e.length-i*l)}return i--,f.set(new Uint8Array(this.buffer,s[i].position,this.length-s[i].position),s[i].position-e.length+t.length-i*l),this.buffer=h,this.view=new Uint8Array(this.buffer),o.status=1,o}skipPatterns(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);let o=a;for(let t=0;t<e.length;t++){const r=e[t].length,n=s?o-r:o;let c=!0;for(let a=0;a<r;a++)if(this.view[a+n]!=e[t].view[a]){c=!1;break}if(c)if(t=-1,s){if(o-=r,o<=0)return o}else if(o+=r,o>=a+i)return o}return o}skipNotPatterns(e,t,r,n){const{start:a,length:i,backward:s}=this.prepareFindParameters(t,r,n);let o=-1;for(let t=0;t<i;t++){for(let r=0;r<e.length;r++){const n=e[r].length,i=s?a-t-n:a+t;let c=!0;for(let t=0;t<n;t++)if(this.view[t+i]!=e[r].view[t]){c=!1;break}if(c){o=s?a-t:a+t;break}}if(-1!=o)break}return o}prepareFindParameters(e=null,t=null,r=!1){return null===e&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}class Ln{constructor(e={}){this._stream=new On,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in e?new On({view:e.view}):"buffer"in e?new On({buffer:e.buffer}):"string"in e?new On({string:e.string}):"hexstring"in e?new On({hexstring:e.hexstring}):"stream"in e?e.stream.slice():new On,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(null==t||t>this.length)&&(t=this.length);const r=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==r)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}findFirstIn(e,t=null){(null==t||t>this.length)&&(t=this.length);const r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==r.id)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(null==t||t>this._length)&&(t=this._length);const r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==r.left.id&&-1==r.right.id)return r;if(this.backward){if(-1!=r.right.id&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new On}}else if(-1!=r.left.id&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new On};return this.backward?-1==r.left.id?this.start=0:this.start=r.left.position:-1==r.right.id?this.start=this._start+this._length:this.start=r.right.position,r}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,r=null){(null==t||t>this._length)&&(t=this._length),(null==r||r>t)&&(r=t);const n=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==n.value.length)return n;if(this.backward){if(n.position<this._start-n.value.length-r)return{position:-1,value:new On}}else if(n.position>this._start+n.value.length+r)return{position:-1,value:new On};return this.start=n.position,n}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,r=null){(null==r||r>this.length)&&(r=this.length);const n=this.backward?this.start-this.length:this.start,a=this.stream.findPairedPatterns(e,t,n,this.length);if(a.length)if(this.backward){if(a[0].right<this.start-t.length-r)return[]}else if(a[0].left>this.start+e.length+r)return[];return a}findPairedArrays(e,t,r=null){(null==r||r>this.length)&&(r=this.length);const n=this.backward?this.start-this.length:this.start,a=this.stream.findPairedArrays(e,t,n,this.length);if(a.length)if(this.backward){if(a[0].right.position<this.start-t[a[0].right.id].length-r)return[]}else if(a[0].left.position>this.start+e[a[0].left.id].length+r)return[];return a}replacePattern(e,t){const r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);let r;if(this._length<e&&(e=this._length),this.backward){const t=this._stream.view.subarray(this._length-e,this._length);r=new Uint8Array(e);for(let n=0;n<e;n++)r[e-1-n]=t[n]}else r=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),r}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:16777216*t[0]+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+Ln.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}Ln.APPEND_BLOCK=1e3;class Un{constructor(e={}){this.version=de(e,"version",Un.defaultValues("version")),this.logID=de(e,"logID",Un.defaultValues("logID")),this.timestamp=de(e,"timestamp",Un.defaultValues("timestamp")),this.extensions=de(e,"extensions",Un.defaultValues("extensions")),this.hashAlgorithm=de(e,"hashAlgorithm",Un.defaultValues("hashAlgorithm")),this.signatureAlgorithm=de(e,"signatureAlgorithm",Un.defaultValues("signatureAlgorithm")),this.signature=de(e,"signature",Un.defaultValues("signature")),"schema"in e&&this.fromSchema(e.schema),"stream"in e&&this.fromStream(e.stream)}static defaultValues(e){switch(e){case"version":return 0;case"logID":case"extensions":return new ArrayBuffer(0);case"timestamp":return new Date(0);case"hashAlgorithm":case"signatureAlgorithm":return"";case"signature":return new Ur;default:throw new Error(`Invalid member name for SignedCertificateTimestamp class: ${e}`)}}fromSchema(e){if(e instanceof Rr==0)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Ln({stream:new On({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(pe(new Uint8Array(e.getBlock(8)),8));const r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm="none";break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm="sha1";break;case 3:this.hashAlgorithm="sha224";break;case 4:this.hashAlgorithm="sha256";break;case 5:this.hashAlgorithm="sha384";break;case 6:this.hashAlgorithm="sha512";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm="anonymous";break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm="ecdsa";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const n=e.getUint16(),a=Dt(new Uint8Array(e.getBlock(n)).buffer.slice(0));if(-1===a.offset)throw new Error("Object's stream was not correct for SignedCertificateTimestamp");if(this.signature=a.result,t!==47+r+n)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Rr({data:e.stream.buffer})}toStream(){const e=new Ln;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecode.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),r=new Uint8Array(t),n=ge(this.timestamp.valueOf(),8);let a,i;switch(r.set(new Uint8Array(n),8-n.byteLength),e.appendView(r),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case"none":a=0;break;case"md5":a=1;break;case"sha1":a=2;break;case"sha224":a=3;break;case"sha256":a=4;break;case"sha384":a=5;break;case"sha512":a=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}switch(e.appendChar(a),this.signatureAlgorithm.toLowerCase()){case"anonymous":i=0;break;case"rsa":i=1;break;case"dsa":i=2;break;case"ecdsa":i=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(i);const s=this.signature.toBER(!1);return e.appendUint16(s.byteLength),e.appendView(new Uint8Array(s)),e}toJSON(){return{version:this.version,logID:me(this.logID),timestamp:this.timestamp,extensions:me(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,r=0){let n,a=Se(xe(this.logID)),i=null,s=new Ln;for(const t of e)if(t.log_id===a){i=t.key;break}if(null===i)throw new Error(`Public key not found for CT with logId: ${a}`);const o=Dt(Be(Ce(i)));if(-1===o.offset)throw new Error(`Incorrect key value for CT Log with logId: ${a}`);n=new Kr({schema:o.result}),s.appendChar(0),s.appendChar(0);const c=new ArrayBuffer(8),u=new Uint8Array(c),l=ge(this.timestamp.valueOf(),8);return u.set(new Uint8Array(l),8-l.byteLength),s.appendView(u),s.appendUint16(r),0===r&&s.appendUint24(t.byteLength),s.appendView(new Uint8Array(t)),s.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&s.appendView(new Uint8Array(this.extensions)),tn().subtle.verifyWithPublicKey(s._stream._buffer.slice(0,s._length),{valueBlock:{valueHex:this.signature.toBER(!1)}},n,{algorithmId:""},"SHA-256")}}class jn{constructor(e={}){this.timestamps=de(e,"timestamps",jn.defaultValues("timestamps")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("timestamps"===e)return[];throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static compareWithDefault(e,t){if("timestamps"===e)return 0===t.length;throw new Error(`Invalid member name for SignedCertificateTimestampList class: ${e}`)}static schema(e={}){const t=de(e,"names",{});return"optional"in t==0&&(t.optional=!1),new zt({name:t.blockName||"SignedCertificateTimestampList",optional:t.optional})}fromSchema(e){if(e instanceof zt==0)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Ln({stream:new On({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Un({stream:t}))}toSchema(){const e=new Ln;let t=0;const r=[];for(const e of this.timestamps){const n=e.toStream();r.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const t of r)e.appendView(t.stream.view);return new zt({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}class Dn{constructor(e={}){this.extnID=de(e,"extnID",Dn.defaultValues("extnID")),this.critical=de(e,"critical",Dn.defaultValues("critical")),this.extnValue="extnValue"in e?new zt({valueHex:e.extnValue}):Dn.defaultValues("extnValue"),"parsedValue"in e&&(this.parsedValue=de(e,"parsedValue",Dn.defaultValues("parsedValue"))),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"extnID":return"";case"critical":return!1;case"extnValue":return new zt;case"parsedValue":return{};default:throw new Error(`Invalid member name for Extension class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[new nr({name:t.extnID||""}),new Mt({name:t.critical||"",optional:!0}),new zt({name:t.extnValue||""})]})}fromSchema(e){Pe(e,["extnID","critical","extnValue"]);let t=Vr(e,e,Dn.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extension");if(this.extnID=t.result.extnID.valueBlock.toString(),"critical"in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue,t=Dt(this.extnValue.valueBlock.valueHex),-1!==t.offset)switch(this.extnID){case"2.5.29.9":try{this.parsedValue=new mn({schema:t.result})}catch(e){this.parsedValue=new mn,this.parsedValue.parsingError="Incorrectly formated SubjectDirectoryAttributes"}break;case"2.5.29.14":case"2.5.29.15":case"2.5.29.20":case"2.5.29.27":case"2.5.29.21":case"2.5.29.24":case"2.5.29.54":this.parsedValue=t.result;break;case"2.5.29.16":try{this.parsedValue=new pn({schema:t.result})}catch(e){this.parsedValue=new pn,this.parsedValue.parsingError="Incorrectly formated PrivateKeyUsagePeriod"}break;case"2.5.29.17":case"2.5.29.18":try{this.parsedValue=new fn({schema:t.result})}catch(e){this.parsedValue=new fn,this.parsedValue.parsingError="Incorrectly formated AltName"}break;case"2.5.29.19":try{this.parsedValue=new gn({schema:t.result})}catch(e){this.parsedValue=new gn,this.parsedValue.parsingError="Incorrectly formated BasicConstraints"}break;case"2.5.29.28":try{this.parsedValue=new vn({schema:t.result})}catch(e){this.parsedValue=new vn,this.parsedValue.parsingError="Incorrectly formated IssuingDistributionPoint"}break;case"2.5.29.29":try{this.parsedValue=new bn({schema:t.result})}catch(e){this.parsedValue=new bn,this.parsedValue.parsingError="Incorrectly formated GeneralNames"}break;case"2.5.29.30":try{this.parsedValue=new yn({schema:t.result})}catch(e){this.parsedValue=new yn,this.parsedValue.parsingError="Incorrectly formated NameConstraints"}break;case"2.5.29.31":case"2.5.29.46":try{this.parsedValue=new _n({schema:t.result})}catch(e){this.parsedValue=new _n,this.parsedValue.parsingError="Incorrectly formated CRLDistributionPoints"}break;case"2.5.29.32":try{this.parsedValue=new Cn({schema:t.result})}catch(e){this.parsedValue=new Cn,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.33":try{this.parsedValue=new Bn({schema:t.result})}catch(e){this.parsedValue=new Bn,this.parsedValue.parsingError="Incorrectly formated CertificatePolicies"}break;case"2.5.29.35":try{this.parsedValue=new En({schema:t.result})}catch(e){this.parsedValue=new En,this.parsedValue.parsingError="Incorrectly formated AuthorityKeyIdentifier"}break;case"2.5.29.36":try{this.parsedValue=new In({schema:t.result})}catch(e){this.parsedValue=new In,this.parsedValue.parsingError="Incorrectly formated PolicyConstraints"}break;case"2.5.29.37":try{this.parsedValue=new Pn({schema:t.result})}catch(e){this.parsedValue=new Pn,this.parsedValue.parsingError="Incorrectly formated ExtKeyUsage"}break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":try{this.parsedValue=new Nn({schema:t.result})}catch(e){this.parsedValue=new Nn,this.parsedValue.parsingError="Incorrectly formated InfoAccess"}break;case"1.3.6.1.4.1.11129.2.4.2":try{this.parsedValue=new jn({schema:t.result})}catch(e){this.parsedValue=new jn,this.parsedValue.parsingError="Incorrectly formated SignedCertificateTimestampList"}}}toSchema(){const e=[];return e.push(new nr({value:this.extnID})),this.critical!==Dn.defaultValues("critical")&&e.push(new Mt({value:this.critical})),e.push(this.extnValue),new or({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Dn.defaultValues("critical")&&(e.critical=this.critical),"parsedValue"in this&&"toJSON"in this.parsedValue&&(e.parsedValue=this.parsedValue.toJSON()),e}}class Rn{constructor(e={}){this.extensions=de(e,"extensions",Rn.defaultValues("extensions")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){if("extensions"===e)return[];throw new Error(`Invalid member name for Extensions class: ${e}`)}static schema(e={},t=!1){const r=de(e,"names",{});return new or({optional:t,name:r.blockName||"",value:[new Dr({name:r.extensions||"",value:Dn.schema(r.extension||{})})]})}fromSchema(e){Pe(e,["extensions"]);const t=Vr(e,e,Rn.schema({names:{extensions:"extensions"}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Extensions");this.extensions=Array.from(t.result.extensions,e=>new Dn({schema:e}))}toSchema(){return new or({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:Array.from(this.extensions,e=>e.toJSON())}}}function Vn(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"tbsCertificate",value:[new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Xt({name:t.tbsCertificateVersion||"tbsCertificate.version"})]}),new Xt({name:t.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),Hr.schema(t.signature||{names:{blockName:"tbsCertificate.signature"}}),sn.schema(t.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new or({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[dn.schema(t.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),dn.schema(t.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),sn.schema(t.subject||{names:{blockName:"tbsCertificate.subject"}}),Kr.schema(t.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new Ut({name:t.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ut({name:t.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Rn.schema(t.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}class Hn{constructor(e={}){this.tbs=de(e,"tbs",Hn.defaultValues("tbs")),this.version=de(e,"version",Hn.defaultValues("version")),this.serialNumber=de(e,"serialNumber",Hn.defaultValues("serialNumber")),this.signature=de(e,"signature",Hn.defaultValues("signature")),this.issuer=de(e,"issuer",Hn.defaultValues("issuer")),this.notBefore=de(e,"notBefore",Hn.defaultValues("notBefore")),this.notAfter=de(e,"notAfter",Hn.defaultValues("notAfter")),this.subject=de(e,"subject",Hn.defaultValues("subject")),this.subjectPublicKeyInfo=de(e,"subjectPublicKeyInfo",Hn.defaultValues("subjectPublicKeyInfo")),"issuerUniqueID"in e&&(this.issuerUniqueID=de(e,"issuerUniqueID",Hn.defaultValues("issuerUniqueID"))),"subjectUniqueID"in e&&(this.subjectUniqueID=de(e,"subjectUniqueID",Hn.defaultValues("subjectUniqueID"))),"extensions"in e&&(this.extensions=de(e,"extensions",Hn.defaultValues("extensions"))),this.signatureAlgorithm=de(e,"signatureAlgorithm",Hn.defaultValues("signatureAlgorithm")),this.signatureValue=de(e,"signatureValue",Hn.defaultValues("signatureValue")),"schema"in e&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":case"issuerUniqueID":case"subjectUniqueID":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new Xt;case"signature":case"signatureAlgorithm":return new Hr;case"issuer":case"subject":return new sn;case"notBefore":case"notAfter":return new dn;case"subjectPublicKeyInfo":return new Kr;case"extensions":return[];case"signatureValue":return new Wt;default:throw new Error(`Invalid member name for Certificate class: ${e}`)}}static schema(e={}){const t=de(e,"names",{});return new or({name:t.blockName||"",value:[Vn(t.tbsCertificate),Hr.schema(t.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new Wt({name:t.signatureValue||"signatureValue"})]})}fromSchema(e){Pe(e,["tbsCertificate","tbsCertificate.extensions","tbsCertificate.version","tbsCertificate.serialNumber","tbsCertificate.signature","tbsCertificate.issuer","tbsCertificate.notBefore","tbsCertificate.notAfter","tbsCertificate.subject","tbsCertificate.subjectPublicKeyInfo","tbsCertificate.issuerUniqueID","tbsCertificate.subjectUniqueID","signatureAlgorithm","signatureValue"]);const t=Vr(e,e,Hn.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(!1===t.verified)throw new Error("Object's schema was not verified against input data for Certificate");this.tbs=t.result.tbsCertificate.valueBeforeDecode,"tbsCertificate.version"in t.result&&(this.version=t.result["tbsCertificate.version"].valueBlock.valueDec),this.serialNumber=t.result["tbsCertificate.serialNumber"],this.signature=new Hr({schema:t.result["tbsCertificate.signature"]}),this.issuer=new sn({schema:t.result["tbsCertificate.issuer"]}),this.notBefore=new dn({schema:t.result["tbsCertificate.notBefore"]}),this.notAfter=new dn({schema:t.result["tbsCertificate.notAfter"]}),this.subject=new sn({schema:t.result["tbsCertificate.subject"]}),this.subjectPublicKeyInfo=new Kr({schema:t.result["tbsCertificate.subjectPublicKeyInfo"]}),"tbsCertificate.issuerUniqueID"in t.result&&(this.issuerUniqueID=t.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex),"tbsCertificate.subjectUniqueID"in t.result&&(this.subjectUniqueID=t.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex),"tbsCertificate.extensions"in t.result&&(this.extensions=Array.from(t.result["tbsCertificate.extensions"],e=>new Dn({schema:e}))),this.signatureAlgorithm=new Hr({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return"version"in this&&this.version!==Hn.defaultValues("version")&&e.push(new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Xt({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new or({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),"issuerUniqueID"in this&&e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),"subjectUniqueID"in this&&e.push(new Ut({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),"extensions"in this&&e.push(new Ht({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new or({value:Array.from(this.extensions,e=>e.toSchema())})]})),new or({value:e})}toSchema(e=!1){let t={};if(!1===e){if(0===this.tbs.length)return Hn.schema().value[0];t=Dt(this.tbs).result}else t=this.encodeTBS();return new or({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:me(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"version"in this&&this.version!==Hn.defaultValues("version")&&(e.version=this.version),"issuerUniqueID"in this&&(e.issuerUniqueID=me(this.issuerUniqueID,0,this.issuerUniqueID.byteLength)),"subjectUniqueID"in this&&(e.subjectUniqueID=me(this.subjectUniqueID,0,this.subjectUniqueID.byteLength)),"extensions"in this&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}getPublicKey(e=null){return tn().subtle.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}getKeyHash(e="SHA-1"){const t=rn();return void 0===t?Promise.reject("Unable to create WebCrypto object"):t.digest({name:e},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))}sign(e,t="SHA-1"){if(void 0===e)return Promise.reject("Need to provide a private key for signing");let r,n=Promise.resolve();const a=tn();return n=n.then(()=>a.subtle.getSignatureParameters(e,t)),n=n.then(e=>{r=e.parameters,this.signature=e.signatureAlgorithm,this.signatureAlgorithm=e.signatureAlgorithm}),n=n.then(()=>{this.tbs=this.encodeTBS().toBER(!1)}),n=n.then(()=>a.subtle.signWithPrivateKey(this.tbs,e,r)),n=n.then(e=>{this.signatureValue=new Wt({valueHex:e})}),n}verify(e=null){let t={};return null!==e?t=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(t=this.subjectPublicKeyInfo),t instanceof Kr==0?Promise.reject("Please provide issuer certificate as a parameter"):tn().subtle.verifyWithPublicKey(this.tbs,this.signatureValue,t,this.signatureAlgorithm)}}function Tn(e){let t=e.length;for(;--t>=0;)e[t]=0}const $n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Kn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Fn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Mn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jn=new Array(576);Tn(Jn);const zn=new Array(60);Tn(zn);const qn=new Array(512);Tn(qn);const Wn=new Array(256);Tn(Wn);const Zn=new Array(29);Tn(Zn);const Gn=new Array(30);function Qn(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let Yn,Xn,ea;function ta(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Tn(Gn);const ra=e=>e<256?qn[e]:qn[256+(e>>>7)],na=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},aa=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,na(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},ia=(e,t,r)=>{aa(e,r[2*t],r[2*t+1])},sa=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},oa=(e,t,r)=>{const n=new Array(16);let a,i,s=0;for(a=1;a<=15;a++)s=s+r[a-1]<<1,n[a]=s;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=sa(n[t]++,t))}},ca=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},ua=e=>{e.bi_valid>8?na(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},la=(e,t,r,n)=>{const a=2*t,i=2*r;return e[a]<e[i]||e[a]===e[i]&&n[t]<=n[r]},ha=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&la(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!la(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},fa=(e,t,r)=>{let n,a,i,s,o=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+o++],n+=(255&e.pending_buf[e.sym_buf+o++])<<8,a=e.pending_buf[e.sym_buf+o++],0===n?ia(e,a,t):(i=Wn[a],ia(e,i+256+1,t),s=$n[i],0!==s&&(a-=Zn[i],aa(e,a,s)),n--,i=ra(n),ia(e,i,r),s=Kn[i],0!==s&&(n-=Gn[i],aa(e,n,s)))}while(o<e.sym_next);ia(e,256,t)},da=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,i=t.stat_desc.elems;let s,o,c,u=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<i;s++)0!==r[2*s]?(e.heap[++e.heap_len]=u=s,e.depth[s]=0):r[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,a&&(e.static_len-=n[2*c+1]);for(t.max_code=u,s=e.heap_len>>1;s>=1;s--)ha(e,r,s);c=i;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ha(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,r[2*c]=r[2*s]+r[2*o],e.depth[c]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,r[2*s+1]=r[2*o+1]=c,e.heap[1]=c++,ha(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length;let u,l,h,f,d,m,p=0;for(f=0;f<=15;f++)e.bl_count[f]=0;for(r[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)l=e.heap[u],f=r[2*r[2*l+1]+1]+1,f>c&&(f=c,p++),r[2*l+1]=f,l>n||(e.bl_count[f]++,d=0,l>=o&&(d=s[l-o]),m=r[2*l],e.opt_len+=m*(f+d),i&&(e.static_len+=m*(a[2*l+1]+d)));if(0!==p){do{for(f=c-1;0===e.bl_count[f];)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,p-=2}while(p>0);for(f=c;0!==f;f--)for(l=e.bl_count[f];0!==l;)h=e.heap[--u],h>n||(r[2*h+1]!==f&&(e.opt_len+=(f-r[2*h+1])*r[2*h],r[2*h+1]=f),l--)}})(e,t),oa(r,u,e.bl_count)},ma=(e,t,r)=>{let n,a,i=-1,s=t[1],o=0,c=7,u=4;for(0===s&&(c=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)a=s,s=t[2*(n+1)+1],++o<c&&a===s||(o<u?e.bl_tree[2*a]+=o:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=a,0===s?(c=138,u=3):a===s?(c=6,u=3):(c=7,u=4))},pa=(e,t,r)=>{let n,a,i=-1,s=t[1],o=0,c=7,u=4;for(0===s&&(c=138,u=3),n=0;n<=r;n++)if(a=s,s=t[2*(n+1)+1],!(++o<c&&a===s)){if(o<u)do{ia(e,a,e.bl_tree)}while(0!==--o);else 0!==a?(a!==i&&(ia(e,a,e.bl_tree),o--),ia(e,16,e.bl_tree),aa(e,o-3,2)):o<=10?(ia(e,17,e.bl_tree),aa(e,o-3,3)):(ia(e,18,e.bl_tree),aa(e,o-11,7));o=0,i=a,0===s?(c=138,u=3):a===s?(c=6,u=3):(c=7,u=4)}};let ga=!1;const va=(e,t,r,n)=>{aa(e,0+(n?1:0),3),ua(e),na(e,r),na(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var ba={_tr_init:e=>{ga||((()=>{let e,t,r,n,a;const i=new Array(16);for(r=0,n=0;n<28;n++)for(Zn[n]=r,e=0;e<1<<$n[n];e++)Wn[r++]=n;for(Wn[r-1]=n,a=0,n=0;n<16;n++)for(Gn[n]=a,e=0;e<1<<Kn[n];e++)qn[a++]=n;for(a>>=7;n<30;n++)for(Gn[n]=a<<7,e=0;e<1<<Kn[n]-7;e++)qn[256+a++]=n;for(t=0;t<=15;t++)i[t]=0;for(e=0;e<=143;)Jn[2*e+1]=8,e++,i[8]++;for(;e<=255;)Jn[2*e+1]=9,e++,i[9]++;for(;e<=279;)Jn[2*e+1]=7,e++,i[7]++;for(;e<=287;)Jn[2*e+1]=8,e++,i[8]++;for(oa(Jn,287,i),e=0;e<30;e++)zn[2*e+1]=5,zn[2*e]=sa(e,5);Yn=new Qn(Jn,$n,257,286,15),Xn=new Qn(zn,Kn,0,30,15),ea=new Qn(new Array(0),Fn,0,19,7)})(),ga=!0),e.l_desc=new ta(e.dyn_ltree,Yn),e.d_desc=new ta(e.dyn_dtree,Xn),e.bl_desc=new ta(e.bl_tree,ea),e.bi_buf=0,e.bi_valid=0,ca(e)},_tr_stored_block:va,_tr_flush_block:(e,t,r,n)=>{let a,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),da(e,e.l_desc),da(e,e.d_desc),s=(e=>{let t;for(ma(e,e.dyn_ltree,e.l_desc.max_code),ma(e,e.dyn_dtree,e.d_desc.max_code),da(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Mn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=a&&(a=i)):a=i=r+5,r+4<=a&&-1!==t?va(e,t,r,n):4===e.strategy||i===a?(aa(e,2+(n?1:0),3),fa(e,Jn,zn)):(aa(e,4+(n?1:0),3),((e,t,r,n)=>{let a;for(aa(e,t-257,5),aa(e,r-1,5),aa(e,n-4,4),a=0;a<n;a++)aa(e,e.bl_tree[2*Mn[a]+1],3);pa(e,e.dyn_ltree,t-1),pa(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),fa(e,e.dyn_ltree,e.dyn_dtree)),ca(e),n&&ua(e)},_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Wn[r]+256+1)]++,e.dyn_dtree[2*ra(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{aa(e,2,3),ia(e,256,Jn),(e=>{16===e.bi_valid?(na(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},wa=(e,t,r,n)=>{let a=65535&e,i=e>>>16&65535,s=0;for(;0!==r;){s=r>2e3?2e3:r,r-=s;do{a=a+t[n++]|0,i=i+a|0}while(--s);a%=65521,i%=65521}return a|i<<16};const ya=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var ka=(e,t,r,n)=>{const a=ya,i=n+r;e^=-1;for(let r=n;r<i;r++)e=e>>>8^a[255&(e^t[r])];return-1^e},_a={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Aa={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Sa,_tr_stored_block:Ca,_tr_flush_block:xa,_tr_tally:Ba,_tr_align:Ea}=ba,{Z_NO_FLUSH:Ia,Z_PARTIAL_FLUSH:Pa,Z_FULL_FLUSH:Na,Z_FINISH:Oa,Z_BLOCK:La,Z_OK:Ua,Z_STREAM_END:ja,Z_STREAM_ERROR:Da,Z_DATA_ERROR:Ra,Z_BUF_ERROR:Va,Z_DEFAULT_COMPRESSION:Ha,Z_FILTERED:Ta,Z_HUFFMAN_ONLY:$a,Z_RLE:Ka,Z_FIXED:Fa,Z_DEFAULT_STRATEGY:Ma,Z_UNKNOWN:Ja,Z_DEFLATED:za}=Aa,qa=258,Wa=262,Za=42,Ga=113,Qa=666,Ya=(e,t)=>(e.msg=_a[t],t),Xa=e=>2*e-(e>4?9:0),ei=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ti=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do{r=e.head[--n],e.head[n]=r>=a?r-a:0}while(--t);t=a,n=t;do{r=e.prev[--n],e.prev[n]=r>=a?r-a:0}while(--t)};let ri=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const ni=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},ai=(e,t)=>{xa(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ni(e.strm)},ii=(e,t)=>{e.pending_buf[e.pending++]=t},si=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},oi=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),1===e.state.wrap?e.adler=wa(e.adler,t,a,r):2===e.state.wrap&&(e.adler=ka(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},ci=(e,t)=>{let r,n,a=e.max_chain_length,i=e.strstart,s=e.prev_length,o=e.nice_match;const c=e.strstart>e.w_size-Wa?e.strstart-(e.w_size-Wa):0,u=e.window,l=e.w_mask,h=e.prev,f=e.strstart+qa;let d=u[i+s-1],m=u[i+s];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(r=t,u[r+s]===m&&u[r+s-1]===d&&u[r]===u[i]&&u[++r]===u[i+1]){i+=2,r++;do{}while(u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&i<f);if(n=qa-(f-i),i=f-qa,n>s){if(e.match_start=t,s=n,n>=o)break;d=u[i+s-1],m=u[i+s]}}}while((t=h[t&l])>c&&0!==--a);return s<=e.lookahead?s:e.lookahead},ui=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Wa)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ti(e),n+=t),0===e.strm.avail_in)break;if(r=oi(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=ri(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=ri(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Wa&&0!==e.strm.avail_in)},li=(e,t)=>{let r,n,a,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(r=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>a&&(r=a),r<i&&(0===r&&t!==Oa||t===Ia||r!==n+e.strm.avail_in))break;s=t===Oa&&r===n+e.strm.avail_in?1:0,Ca(e,0,0,s),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,ni(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(oi(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==Ia&&t!==Oa&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(oi(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,i=a>e.w_size?e.w_size:a,n=e.strstart-e.block_start,(n>=i||(n||t===Oa)&&t!==Ia&&0===e.strm.avail_in&&n<=a)&&(r=n>a?a:n,s=t===Oa&&0===e.strm.avail_in&&r===n?1:0,Ca(e,e.block_start,r,s),e.block_start+=r,ni(e.strm)),s?3:1)},hi=(e,t)=>{let r,n;for(;;){if(e.lookahead<Wa){if(ui(e),e.lookahead<Wa&&t===Ia)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ri(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-Wa&&(e.match_length=ci(e,r)),e.match_length>=3)if(n=Ba(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ri(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ri(e,e.ins_h,e.window[e.strstart+1]);else n=Ba(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(ai(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Oa?(ai(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ai(e,!1),0===e.strm.avail_out)?1:2},fi=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<Wa){if(ui(e),e.lookahead<Wa&&t===Ia)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ri(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Wa&&(e.match_length=ci(e,r),e.match_length<=5&&(e.strategy===Ta||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,n=Ba(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=ri(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(ai(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Ba(e,0,e.window[e.strstart-1]),n&&ai(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Ba(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Oa?(ai(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ai(e,!1),0===e.strm.avail_out)?1:2};function di(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const mi=[new di(0,0,0,0,li),new di(4,4,8,4,hi),new di(4,5,16,8,hi),new di(4,6,32,32,hi),new di(4,4,16,16,fi),new di(8,16,32,32,fi),new di(8,16,128,128,fi),new di(8,32,128,256,fi),new di(32,128,258,1024,fi),new di(32,258,258,4096,fi)];function pi(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=za,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ei(this.dyn_ltree),ei(this.dyn_dtree),ei(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ei(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ei(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const gi=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Za&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Ga&&t.status!==Qa?1:0},vi=e=>{if(gi(e))return Ya(e,Da);e.total_in=e.total_out=0,e.data_type=Ja;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Za:Ga,e.adler=2===t.wrap?0:1,t.last_flush=-2,Sa(t),Ua},bi=e=>{const t=vi(e);return t===Ua&&(e=>{e.window_size=2*e.w_size,ei(e.head),e.max_lazy_match=mi[e.level].max_lazy,e.good_match=mi[e.level].good_length,e.nice_match=mi[e.level].nice_length,e.max_chain_length=mi[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},wi=(e,t,r,n,a,i)=>{if(!e)return Da;let s=1;if(t===Ha&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||r!==za||n<8||n>15||t<0||t>9||i<0||i>Fa||8===n&&1!==s)return Ya(e,Da);8===n&&(n=9);const o=new pi;return e.state=o,o.strm=e,o.status=Za,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=r,bi(e)};var yi=wi,ki=(e,t)=>gi(e)||2!==e.state.wrap?Da:(e.state.gzhead=t,Ua),_i=(e,t)=>{if(gi(e)||t>La||t<0)return e?Ya(e,Da):Da;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===Qa&&t!==Oa)return Ya(e,0===e.avail_out?Va:Da);const n=r.last_flush;if(r.last_flush=t,0!==r.pending){if(ni(e),0===e.avail_out)return r.last_flush=-1,Ua}else if(0===e.avail_in&&Xa(t)<=Xa(n)&&t!==Oa)return Ya(e,Va);if(r.status===Qa&&0!==e.avail_in)return Ya(e,Va);if(r.status===Za&&0===r.wrap&&(r.status=Ga),r.status===Za){let t=za+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=$a||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=n<<6,0!==r.strstart&&(t|=32),t+=31-t%31,si(r,t),0!==r.strstart&&(si(r,e.adler>>>16),si(r,65535&e.adler)),e.adler=1,r.status=Ga,ni(e),0!==r.pending)return r.last_flush=-1,Ua}if(57===r.status)if(e.adler=0,ii(r,31),ii(r,139),ii(r,8),r.gzhead)ii(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ii(r,255&r.gzhead.time),ii(r,r.gzhead.time>>8&255),ii(r,r.gzhead.time>>16&255),ii(r,r.gzhead.time>>24&255),ii(r,9===r.level?2:r.strategy>=$a||r.level<2?4:0),ii(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ii(r,255&r.gzhead.extra.length),ii(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=ka(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(ii(r,0),ii(r,0),ii(r,0),ii(r,0),ii(r,0),ii(r,9===r.level?2:r.strategy>=$a||r.level<2?4:0),ii(r,3),r.status=Ga,ni(e),0!==r.pending)return r.last_flush=-1,Ua;if(69===r.status){if(r.gzhead.extra){let t=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let a=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=ka(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=a,ni(e),0!==r.pending)return r.last_flush=-1,Ua;t=0,n-=a}let a=new Uint8Array(r.gzhead.extra);r.pending_buf.set(a.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>t&&(e.adler=ka(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=ka(e.adler,r.pending_buf,r.pending-n,n)),ni(e),0!==r.pending)return r.last_flush=-1,Ua;n=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ii(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=ka(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=ka(e.adler,r.pending_buf,r.pending-n,n)),ni(e),0!==r.pending)return r.last_flush=-1,Ua;n=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ii(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=ka(e.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(ni(e),0!==r.pending))return r.last_flush=-1,Ua;ii(r,255&e.adler),ii(r,e.adler>>8&255),e.adler=0}if(r.status=Ga,ni(e),0!==r.pending)return r.last_flush=-1,Ua}if(0!==e.avail_in||0!==r.lookahead||t!==Ia&&r.status!==Qa){let n=0===r.level?li(r,t):r.strategy===$a?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(ui(e),0===e.lookahead)){if(t===Ia)return 1;break}if(e.match_length=0,r=Ba(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(ai(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Oa?(ai(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ai(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===Ka?((e,t)=>{let r,n,a,i;const s=e.window;for(;;){if(e.lookahead<=qa){if(ui(e),e.lookahead<=qa&&t===Ia)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,n=s[a],n===s[++a]&&n===s[++a]&&n===s[++a])){i=e.strstart+qa;do{}while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<i);e.match_length=qa-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Ba(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Ba(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(ai(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Oa?(ai(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ai(e,!1),0===e.strm.avail_out)?1:2})(r,t):mi[r.level].func(r,t);if(3!==n&&4!==n||(r.status=Qa),1===n||3===n)return 0===e.avail_out&&(r.last_flush=-1),Ua;if(2===n&&(t===Pa?Ea(r):t!==La&&(Ca(r,0,0,!1),t===Na&&(ei(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),ni(e),0===e.avail_out))return r.last_flush=-1,Ua}return t!==Oa?Ua:r.wrap<=0?ja:(2===r.wrap?(ii(r,255&e.adler),ii(r,e.adler>>8&255),ii(r,e.adler>>16&255),ii(r,e.adler>>24&255),ii(r,255&e.total_in),ii(r,e.total_in>>8&255),ii(r,e.total_in>>16&255),ii(r,e.total_in>>24&255)):(si(r,e.adler>>>16),si(r,65535&e.adler)),ni(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Ua:ja)},Ai=e=>{if(gi(e))return Da;const t=e.state.status;return e.state=null,t===Ga?Ya(e,Ra):Ua},Si=(e,t)=>{let r=t.length;if(gi(e))return Da;const n=e.state,a=n.wrap;if(2===a||1===a&&n.status!==Za||n.lookahead)return Da;if(1===a&&(e.adler=wa(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===a&&(ei(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(r-n.w_size,r),0),t=e,r=n.w_size}const i=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,ui(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=ri(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,ui(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=o,e.avail_in=i,n.wrap=a,Ua};const Ci=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var xi=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)Ci(r,t)&&(e[t]=r[t])}}return e},Bi=e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,n=0,a=e.length;t<a;t++){let a=e[t];r.set(a,n),n+=a.length}return r};let Ei=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ei=!1}const Ii=new Uint8Array(256);for(let e=0;e<256;e++)Ii[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ii[254]=Ii[254]=1;var Pi=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,n,a,i,s=e.length,o=0;for(a=0;a<s;a++)r=e.charCodeAt(a),55296==(64512&r)&&a+1<s&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),a++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),i=0,a=0;i<o;a++)r=e.charCodeAt(a),55296==(64512&r)&&a+1<s&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},Ni=(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,a;const i=new Array(2*r);for(a=0,n=0;n<r;){let t=e[n++];if(t<128){i[a++]=t;continue}let s=Ii[t];if(s>4)i[a++]=65533,n+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&n<r;)t=t<<6|63&e[n++],s--;s>1?i[a++]=65533:t<65536?i[a++]=t:(t-=65536,i[a++]=55296|t>>10&1023,i[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ei)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r})(i,a)},Oi=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Ii[e[r]]>t?r:t},Li=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ui=Object.prototype.toString,{Z_NO_FLUSH:ji,Z_SYNC_FLUSH:Di,Z_FULL_FLUSH:Ri,Z_FINISH:Vi,Z_OK:Hi,Z_STREAM_END:Ti,Z_DEFAULT_COMPRESSION:$i,Z_DEFAULT_STRATEGY:Ki,Z_DEFLATED:Fi}=Aa;function Mi(e){this.options=xi({level:$i,method:Fi,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ki},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Li,this.strm.avail_out=0;let r=yi(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Hi)throw new Error(_a[r]);if(t.header&&ki(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Pi(t.dictionary):"[object ArrayBuffer]"===Ui.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=Si(this.strm,e),r!==Hi)throw new Error(_a[r]);this._dict_set=!0}}function Ji(e,t){const r=new Mi(t);if(r.push(e,!0),r.err)throw r.msg||_a[r.err];return r.result}Mi.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Vi:ji,"string"==typeof e?r.input=Pi(e):"[object ArrayBuffer]"===Ui.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(i===Di||i===Ri)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(a=_i(r,i),a===Ti)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=Ai(this.strm),this.onEnd(a),this.ended=!0,a===Hi;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Mi.prototype.onData=function(e){this.chunks.push(e)},Mi.prototype.onEnd=function(e){e===Hi&&(this.result=Bi(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var zi={Deflate:Mi,deflate:Ji,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Ji(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Ji(e,t)},constants:Aa};const qi=16209;var Wi=function(e,t){let r,n,a,i,s,o,c,u,l,h,f,d,m,p,g,v,b,w,y,k,_,A,S,C;const x=e.state;r=e.next_in,S=e.input,n=r+(e.avail_in-5),a=e.next_out,C=e.output,i=a-(t-e.avail_out),s=a+(e.avail_out-257),o=x.dmax,c=x.wsize,u=x.whave,l=x.wnext,h=x.window,f=x.hold,d=x.bits,m=x.lencode,p=x.distcode,g=(1<<x.lenbits)-1,v=(1<<x.distbits)-1;e:do{d<15&&(f+=S[r++]<<d,d+=8,f+=S[r++]<<d,d+=8),b=m[f&g];t:for(;;){if(w=b>>>24,f>>>=w,d-=w,w=b>>>16&255,0===w)C[a++]=65535&b;else{if(!(16&w)){if(64&w){if(32&w){x.mode=16191;break e}e.msg="invalid literal/length code",x.mode=qi;break e}b=m[(65535&b)+(f&(1<<w)-1)];continue t}for(y=65535&b,w&=15,w&&(d<w&&(f+=S[r++]<<d,d+=8),y+=f&(1<<w)-1,f>>>=w,d-=w),d<15&&(f+=S[r++]<<d,d+=8,f+=S[r++]<<d,d+=8),b=p[f&v];;){if(w=b>>>24,f>>>=w,d-=w,w=b>>>16&255,16&w){if(k=65535&b,w&=15,d<w&&(f+=S[r++]<<d,d+=8,d<w&&(f+=S[r++]<<d,d+=8)),k+=f&(1<<w)-1,k>o){e.msg="invalid distance too far back",x.mode=qi;break e}if(f>>>=w,d-=w,w=a-i,k>w){if(w=k-w,w>u&&x.sane){e.msg="invalid distance too far back",x.mode=qi;break e}if(_=0,A=h,0===l){if(_+=c-w,w<y){y-=w;do{C[a++]=h[_++]}while(--w);_=a-k,A=C}}else if(l<w){if(_+=c+l-w,w-=l,w<y){y-=w;do{C[a++]=h[_++]}while(--w);if(_=0,l<y){w=l,y-=w;do{C[a++]=h[_++]}while(--w);_=a-k,A=C}}}else if(_+=l-w,w<y){y-=w;do{C[a++]=h[_++]}while(--w);_=a-k,A=C}for(;y>2;)C[a++]=A[_++],C[a++]=A[_++],C[a++]=A[_++],y-=3;y&&(C[a++]=A[_++],y>1&&(C[a++]=A[_++]))}else{_=a-k;do{C[a++]=C[_++],C[a++]=C[_++],C[a++]=C[_++],y-=3}while(y>2);y&&(C[a++]=C[_++],y>1&&(C[a++]=C[_++]))}break}if(64&w){e.msg="invalid distance code",x.mode=qi;break e}b=p[(65535&b)+(f&(1<<w)-1)]}}break}}while(r<n&&a<s);y=d>>3,r-=y,d-=y<<3,f&=(1<<d)-1,e.next_in=r,e.next_out=a,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=a<s?s-a+257:257-(a-s),x.hold=f,x.bits=d};const Zi=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Gi=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Qi=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Yi=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Xi=(e,t,r,n,a,i,s,o)=>{const c=o.bits;let u,l,h,f,d,m,p=0,g=0,v=0,b=0,w=0,y=0,k=0,_=0,A=0,S=0,C=null;const x=new Uint16Array(16),B=new Uint16Array(16);let E,I,P,N=null;for(p=0;p<=15;p++)x[p]=0;for(g=0;g<n;g++)x[t[r+g]]++;for(w=c,b=15;b>=1&&0===x[b];b--);if(w>b&&(w=b),0===b)return a[i++]=20971520,a[i++]=20971520,o.bits=1,0;for(v=1;v<b&&0===x[v];v++);for(w<v&&(w=v),_=1,p=1;p<=15;p++)if(_<<=1,_-=x[p],_<0)return-1;if(_>0&&(0===e||1!==b))return-1;for(B[1]=0,p=1;p<15;p++)B[p+1]=B[p]+x[p];for(g=0;g<n;g++)0!==t[r+g]&&(s[B[t[r+g]]++]=g);if(0===e?(C=N=s,m=20):1===e?(C=Zi,N=Gi,m=257):(C=Qi,N=Yi,m=0),S=0,g=0,p=v,d=i,y=w,k=0,h=-1,A=1<<w,f=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){E=p-k,s[g]+1<m?(I=0,P=s[g]):s[g]>=m?(I=N[s[g]-m],P=C[s[g]-m]):(I=96,P=0),u=1<<p-k,l=1<<y,v=l;do{l-=u,a[d+(S>>k)+l]=E<<24|I<<16|P}while(0!==l);for(u=1<<p-1;S&u;)u>>=1;if(0!==u?(S&=u-1,S+=u):S=0,g++,0===--x[p]){if(p===b)break;p=t[r+s[g]]}if(p>w&&(S&f)!==h){for(0===k&&(k=w),d+=v,y=p-k,_=1<<y;y+k<b&&(_-=x[y+k],!(_<=0));)y++,_<<=1;if(A+=1<<y,1===e&&A>852||2===e&&A>592)return 1;h=S&f,a[h]=w<<24|y<<16|d-i}}return 0!==S&&(a[d+S]=p-k<<24|64<<16),o.bits=w,0};const{Z_FINISH:es,Z_BLOCK:ts,Z_TREES:rs,Z_OK:ns,Z_STREAM_END:as,Z_NEED_DICT:is,Z_STREAM_ERROR:ss,Z_DATA_ERROR:os,Z_MEM_ERROR:cs,Z_BUF_ERROR:us,Z_DEFLATED:ls}=Aa,hs=16180,fs=16190,ds=16191,ms=16192,ps=16194,gs=16199,vs=16200,bs=16206,ws=16209,ys=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function ks(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const _s=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<hs||t.mode>16211?1:0},As=e=>{if(_s(e))return ss;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=hs,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,ns},Ss=e=>{if(_s(e))return ss;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,As(e)},Cs=(e,t)=>{let r;if(_s(e))return ss;const n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ss:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,Ss(e))},xs=(e,t)=>{if(!e)return ss;const r=new ks;e.state=r,r.strm=e,r.window=null,r.mode=hs;const n=Cs(e,t);return n!==ns&&(e.state=null),n};let Bs,Es,Is=!0;const Ps=e=>{if(Is){Bs=new Int32Array(512),Es=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Xi(1,e.lens,0,288,Bs,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Xi(2,e.lens,0,32,Es,0,e.work,{bits:5}),Is=!1}e.lencode=Bs,e.lenbits=9,e.distcode=Es,e.distbits=5},Ns=(e,t,r,n)=>{let a;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>n&&(a=n),i.window.set(t.subarray(r-n,r-n+a),i.wnext),(n-=a)?(i.window.set(t.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0};var Os=Ss,Ls=xs,Us=(e,t)=>{let r,n,a,i,s,o,c,u,l,h,f,d,m,p,g,v,b,w,y,k,_,A,S=0;const C=new Uint8Array(4);let x,B;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(_s(e)||!e.output||!e.input&&0!==e.avail_in)return ss;r=e.state,r.mode===ds&&(r.mode=ms),s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,h=o,f=c,A=ns;e:for(;;)switch(r.mode){case hs:if(0===r.wrap){r.mode=ms;break}for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(2&r.wrap&&35615===u){0===r.wbits&&(r.wbits=15),r.check=0,C[0]=255&u,C[1]=u>>>8&255,r.check=ka(r.check,C,2,0),u=0,l=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=ws;break}if((15&u)!==ls){e.msg="unknown compression method",r.mode=ws;break}if(u>>>=4,l-=4,_=8+(15&u),0===r.wbits&&(r.wbits=_),_>15||_>r.wbits){e.msg="invalid window size",r.mode=ws;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&u?16189:ds,u=0,l=0;break;case 16181:for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(r.flags=u,(255&r.flags)!==ls){e.msg="unknown compression method",r.mode=ws;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=ws;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,r.check=ka(r.check,C,2,0)),u=0,l=0,r.mode=16182;case 16182:for(;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,C[2]=u>>>16&255,C[3]=u>>>24&255,r.check=ka(r.check,C,4,0)),u=0,l=0,r.mode=16183;case 16183:for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,r.check=ka(r.check,C,2,0)),u=0,l=0,r.mode=16184;case 16184:if(1024&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&4&r.wrap&&(C[0]=255&u,C[1]=u>>>8&255,r.check=ka(r.check,C,2,0)),u=0,l=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(d=r.length,d>o&&(d=o),d&&(r.head&&(_=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+d),_)),512&r.flags&&4&r.wrap&&(r.check=ka(r.check,n,d,i)),o-=d,i+=d,r.length-=d),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===o)break e;d=0;do{_=n[i+d++],r.head&&_&&r.length<65536&&(r.head.name+=String.fromCharCode(_))}while(_&&d<o);if(512&r.flags&&4&r.wrap&&(r.check=ka(r.check,n,d,i)),o-=d,i+=d,_)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===o)break e;d=0;do{_=n[i+d++],r.head&&_&&r.length<65536&&(r.head.comment+=String.fromCharCode(_))}while(_&&d<o);if(512&r.flags&&4&r.wrap&&(r.check=ka(r.check,n,d,i)),o-=d,i+=d,_)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(4&r.wrap&&u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=ws;break}u=0,l=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=ds;break;case 16189:for(;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}e.adler=r.check=ys(u),u=0,l=0,r.mode=fs;case fs:if(0===r.havedict)return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=u,r.bits=l,is;e.adler=r.check=1,r.mode=ds;case ds:if(t===ts||t===rs)break e;case ms:if(r.last){u>>>=7&l,l-=7&l,r.mode=bs;break}for(;l<3;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}switch(r.last=1&u,u>>>=1,l-=1,3&u){case 0:r.mode=16193;break;case 1:if(Ps(r),r.mode=gs,t===rs){u>>>=2,l-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=ws}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ws;break}if(r.length=65535&u,u=0,l=0,r.mode=ps,t===rs)break e;case ps:r.mode=16195;case 16195:if(d=r.length,d){if(d>o&&(d=o),d>c&&(d=c),0===d)break e;a.set(n.subarray(i,i+d),s),o-=d,i+=d,c-=d,s+=d,r.length-=d;break}r.mode=ds;break;case 16196:for(;l<14;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ws;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.lens[E[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[E[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,x={bits:r.lenbits},A=Xi(0,r.lens,0,19,r.lencode,0,r.work,x),r.lenbits=x.bits,A){e.msg="invalid code lengths set",r.mode=ws;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;S=r.lencode[u&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,b=65535&S,!(g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(b<16)u>>>=g,l-=g,r.lens[r.have++]=b;else{if(16===b){for(B=g+2;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(u>>>=g,l-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=ws;break}_=r.lens[r.have-1],d=3+(3&u),u>>>=2,l-=2}else if(17===b){for(B=g+3;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=g,l-=g,_=0,d=3+(7&u),u>>>=3,l-=3}else{for(B=g+7;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=g,l-=g,_=0,d=11+(127&u),u>>>=7,l-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ws;break}for(;d--;)r.lens[r.have++]=_}}if(r.mode===ws)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=ws;break}if(r.lenbits=9,x={bits:r.lenbits},A=Xi(1,r.lens,0,r.nlen,r.lencode,0,r.work,x),r.lenbits=x.bits,A){e.msg="invalid literal/lengths set",r.mode=ws;break}if(r.distbits=6,r.distcode=r.distdyn,x={bits:r.distbits},A=Xi(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,x),r.distbits=x.bits,A){e.msg="invalid distances set",r.mode=ws;break}if(r.mode=gs,t===rs)break e;case gs:r.mode=vs;case vs:if(o>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=u,r.bits=l,Wi(e,f),s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,r.mode===ds&&(r.back=-1);break}for(r.back=0;S=r.lencode[u&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,b=65535&S,!(g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(v&&!(240&v)){for(w=g,y=v,k=b;S=r.lencode[k+((u&(1<<w+y)-1)>>w)],g=S>>>24,v=S>>>16&255,b=65535&S,!(w+g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=w,l-=w,r.back+=w}if(u>>>=g,l-=g,r.back+=g,r.length=b,0===v){r.mode=16205;break}if(32&v){r.back=-1,r.mode=ds;break}if(64&v){e.msg="invalid literal/length code",r.mode=ws;break}r.extra=15&v,r.mode=16201;case 16201:if(r.extra){for(B=r.extra;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;S=r.distcode[u&(1<<r.distbits)-1],g=S>>>24,v=S>>>16&255,b=65535&S,!(g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(!(240&v)){for(w=g,y=v,k=b;S=r.distcode[k+((u&(1<<w+y)-1)>>w)],g=S>>>24,v=S>>>16&255,b=65535&S,!(w+g<=l);){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}u>>>=w,l-=w,r.back+=w}if(u>>>=g,l-=g,r.back+=g,64&v){e.msg="invalid distance code",r.mode=ws;break}r.offset=b,r.extra=15&v,r.mode=16203;case 16203:if(r.extra){for(B=r.extra;l<B;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ws;break}r.mode=16204;case 16204:if(0===c)break e;if(d=f-c,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ws;break}d>r.wnext?(d-=r.wnext,m=r.wsize-d):m=r.wnext-d,d>r.length&&(d=r.length),p=r.window}else p=a,m=s-r.offset,d=r.length;d>c&&(d=c),c-=d,r.length-=d;do{a[s++]=p[m++]}while(--d);0===r.length&&(r.mode=vs);break;case 16205:if(0===c)break e;a[s++]=r.length,c--,r.mode=vs;break;case bs:if(r.wrap){for(;l<32;){if(0===o)break e;o--,u|=n[i++]<<l,l+=8}if(f-=c,e.total_out+=f,r.total+=f,4&r.wrap&&f&&(e.adler=r.check=r.flags?ka(r.check,a,f,s-f):wa(r.check,a,f,s-f)),f=c,4&r.wrap&&(r.flags?u:ys(u))!==r.check){e.msg="incorrect data check",r.mode=ws;break}u=0,l=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break e;o--,u+=n[i++]<<l,l+=8}if(4&r.wrap&&u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=ws;break}u=0,l=0}r.mode=16208;case 16208:A=as;break e;case ws:A=os;break e;case 16210:return cs;default:return ss}return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=o,r.hold=u,r.bits=l,(r.wsize||f!==e.avail_out&&r.mode<ws&&(r.mode<bs||t!==es))&&Ns(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,r.total+=f,4&r.wrap&&f&&(e.adler=r.check=r.flags?ka(r.check,a,f,e.next_out-f):wa(r.check,a,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===ds?128:0)+(r.mode===gs||r.mode===ps?256:0),(0===h&&0===f||t===es)&&A===ns&&(A=us),A},js=e=>{if(_s(e))return ss;let t=e.state;return t.window&&(t.window=null),e.state=null,ns},Ds=(e,t)=>{if(_s(e))return ss;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,ns):ss},Rs=(e,t)=>{const r=t.length;let n,a,i;return _s(e)?ss:(n=e.state,0!==n.wrap&&n.mode!==fs?ss:n.mode===fs&&(a=1,a=wa(a,t,r,0),a!==n.check)?os:(i=Ns(e,t,r,r),i?(n.mode=16210,cs):(n.havedict=1,ns)))},Vs=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Hs=Object.prototype.toString,{Z_NO_FLUSH:Ts,Z_FINISH:$s,Z_OK:Ks,Z_STREAM_END:Fs,Z_NEED_DICT:Ms,Z_STREAM_ERROR:Js,Z_DATA_ERROR:zs,Z_MEM_ERROR:qs}=Aa;function Ws(e){this.options=xi({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Li,this.strm.avail_out=0;let r=Ls(this.strm,t.windowBits);if(r!==Ks)throw new Error(_a[r]);if(this.header=new Vs,Ds(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Pi(t.dictionary):"[object ArrayBuffer]"===Hs.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Rs(this.strm,t.dictionary),r!==Ks)))throw new Error(_a[r])}function Zs(e,t){const r=new Ws(t);if(r.push(e),r.err)throw r.msg||_a[r.err];return r.result}Ws.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let i,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?$s:Ts,"[object ArrayBuffer]"===Hs.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),i=Us(r,s),i===Ms&&a&&(i=Rs(r,a),i===Ks?i=Us(r,s):i===zs&&(i=Ms));r.avail_in>0&&i===Fs&&r.state.wrap>0&&0!==e[r.next_in];)Os(r),i=Us(r,s);switch(i){case Js:case zs:case Ms:case qs:return this.onEnd(i),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(0===r.avail_out||i===Fs))if("string"===this.options.to){let e=Oi(r.output,r.next_out),t=r.next_out-e,a=Ni(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(a)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==Ks||0!==o){if(i===Fs)return i=js(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Ws.prototype.onData=function(e){this.chunks.push(e)},Ws.prototype.onEnd=function(e){e===Ks&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Bi(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Gs={Inflate:Ws,inflate:Zs,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Zs(e,t)},ungzip:Zs,constants:Aa};const{Deflate:Qs,deflate:Ys,deflateRaw:Xs,gzip:eo}=zi,{Inflate:to,inflate:ro,inflateRaw:no,ungzip:ao}=Gs;var io=ao;function so(e){return so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},so(e)}function oo(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(so(e)+" is not iterable")}function co(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,s,o=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return o}}(e,t)||go(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uo(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(r,n,a,i){var c=n&&n.prototype instanceof o?n:o,u=Object.create(c.prototype);return lo(u,"_invoke",function(r,n,a){var i,o,c,u=0,l=a||[],h=!1,f={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return i=t,o=0,c=e,f.n=r,s}};function d(r,n){for(o=r,c=n,t=0;!h&&u&&!a&&t<l.length;t++){var a,i=l[t],d=f.p,m=i[2];r>3?(a=m===n)&&(c=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=d&&((a=r<2&&d<i[1])?(o=0,f.v=n,f.n=i[1]):d<m&&(a=r<3||i[0]>n||n>m)&&(i[4]=r,i[5]=n,f.n=m,o=0))}if(a||r>1)return s;throw h=!0,n}return function(a,l,m){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&d(l,m),o=l,c=m;(t=o<2?e:c)||!h;){i||(o?o<3?(o>1&&(f.n=-1),d(o,c)):f.n=c:f.v=c);try{if(u=2,i){if(o||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=e}else if((t=(h=f.n<0)?c:r.call(n,f))!==s)break}catch(t){i=e,o=1,c=t}finally{u=1}}return{value:t,done:h}}}(r,a,i),!0),u}var s={};function o(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(lo(t={},n,function(){return this}),t),h=u.prototype=o.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,lo(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,lo(h,"constructor",u),lo(u,"constructor",c),c.displayName="GeneratorFunction",lo(u,a,"GeneratorFunction"),lo(h),lo(h,a,"Generator"),lo(h,n,function(){return this}),lo(h,"toString",function(){return"[object Generator]"}),(uo=function(){return{w:i,m:f}})()}function lo(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}lo=function(e,t,r,n){function i(t,r){lo(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},lo(e,t,r,n)}function ho(e,t,r,n,a,i,s){try{var o=e[i](s),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function fo(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function s(e){ho(i,n,a,s,o,"next",e)}function o(e){ho(i,n,a,s,o,"throw",e)}s(void 0)})}}function mo(e){return function(e){if(Array.isArray(e))return vo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||go(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function po(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=go(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw i}}}}function go(e,t){if(e){if("string"==typeof e)return vo(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vo(e,t):void 0}}function vo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var bo="prod",wo=function(){var e=Date.now(),t=new Date(e),r=t.toLocaleDateString("en-US"),n=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return"".concat(r," ").concat(n)},yo=function(e){"auto"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.setAttribute("data-bs-theme",e)};yo("light");var ko=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.querySelector("#bd-theme");if(r){var n=document.querySelector("#bd-theme-text"),a=document.querySelector(".theme-icon-active use"),i=document.querySelector('[data-bs-theme-value="'.concat(e,'"]')),s=i.querySelector("svg use").getAttribute("href");document.querySelectorAll("[data-bs-theme-value]").forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-pressed","false")}),i.classList.add("active"),i.setAttribute("aria-pressed","true"),a.setAttribute("href",s);var o="".concat(n.textContent," (").concat(i.dataset.bsThemeValue,")");r.setAttribute("aria-label",o),t&&r.focus()}};function _o(){ko("light"),document.querySelectorAll("[data-bs-theme-value]").forEach(function(e){e.addEventListener("click",function(){var t=e.getAttribute("data-bs-theme-value");localStorage.setItem("theme",t),yo(t),ko(t,!0)})})}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){"light"===storedTheme&&"dark"===storedTheme||yo("light")}),window.addEventListener("DOMContentLoaded",function(){_o()});var Ao,So,Co=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/javascript";return new Promise(function(n,a){try{var i=document.createElement("script");i.type=r,i.async=t,i.src=e,i.addEventListener("load",function(e){n({status:!0})}),i.addEventListener("error",function(e){n({status:!1,message:"Failed to load the script ＄{FILE_URL}"})}),document.body.appendChild(i)}catch(e){n({status:!1,message:"util.js > loadScript> err: ＄{JSON.stringify(error)}"})}})},xo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise(function(t){return setTimeout(t,e)})},Bo=function(e,t){if(t){var r=t,n=document.createElement("canvas");n.width=e,n.height=e/(r.width||r.videoWidth)*(r.height||r.videoHeight);var a=n.getContext("2d",{willReadFrequently:!0});a.drawImage(t,0,0,a.canvas.width,a.canvas.height);var i=a.canvas.toDataURL("image/jpeg");return n=null,a=null,i}},Eo=function(e,t){var r;if(t[2]&&t[3]){var n=e,a=t,i=n.videoWidth,s=n.videoHeight,o=document.createElement("canvas");o.width=i,o.height=s;var c=o.getContext("2d",{willReadFrequently:!0});c.drawImage(n,0,0);var u=(r=c).getImageData.apply(r,mo(a));o.width=a[2],o.height=a[3],c.putImageData(u,0,0);var l=c.canvas.toDataURL("image/jpeg");return o=null,c=null,l}},Io=function(e){var t=new Date(e),r=Date.now()-t;return Math.floor(r/6e4)},Po=function(e,t){var r=t.bbox;Uo(e,t),No(r[0],r[1],e),No(r[0]+r[2],r[1],e),No(r[0]+r[2],r[1]+r[3],e),No(r[0],r[1]+r[3],e)},No=function(e,t,r){r.fillStyle="lightgreen",r.globalAlpha=.5,r.strokeStyle="rgba(0, 128, 0, 1)",r.lineWidth=1,r.beginPath(),r.arc(e,t,6,0,2*Math.PI),r.fill(),r.closePath()},Oo=function(e,t,r){r.bbox,r.img;var n=Lo.apply(void 0,[e,t].concat(mo(r.scissorPos1.map(function(e){return e+2*r.radius})),[2*r.radius]))||Lo.apply(void 0,[e,t].concat(mo(r.scissorPos2.map(function(e){return e+2*r.radius})),[2*r.radius]))||Lo.apply(void 0,[e,t].concat(mo(r.scissorPos3.map(function(e){return e+2*r.radius})),[2*r.radius]))||Lo.apply(void 0,[e,t].concat(mo(r.scissorPos4.map(function(e){return e+2*r.radius})),[2*r.radius]));return!!n},Lo=function(e,t,r,n,a){return Math.pow(e-r,2)+Math.pow(t-n,2)<Math.pow(a,2)},Uo=function(e,t){var r=t.bbox,n=t.img;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="lightgreen",e.globalAlpha=.2,e.strokeStyle="rgba(0, 128, 0, 1)",e.lineWidth=1,e.roundRect.apply(e,mo(r).concat([3])),e.stroke(),e.fillRect.apply(e,mo(r)),Math.abs(r[2])>4*t.radius&&Math.abs(r[3])>4*t.radius&&(t.scissorPos1=[r[0]-n.width/2+r[2]/2,r[1]-n.height/2],t.scissorPos2=[r[0]-n.width/2+r[2],r[1]+r[3]/2-n.height/2],t.scissorPos3=[r[0]-n.width/2+r[2]/2,r[1]+r[3]-n.height/2],t.scissorPos4=[r[0]-n.width/2,r[1]+r[3]/2-n.height/2],e.drawImage.apply(e,[n].concat(mo(t.scissorPos1),[n.width,n.height])),e.drawImage.apply(e,[n].concat(mo(t.scissorPos2),[n.width,n.height])),e.drawImage.apply(e,[n].concat(mo(t.scissorPos3),[n.width,n.height])),e.drawImage.apply(e,[n].concat(mo(t.scissorPos4),[n.width,n.height])))},jo=function(){var e=fo(uo().m(function e(t,r,n,a){var i,s,o,c,u,l;return uo().w(function(e){for(;;)switch(e.n){case 0:return s=n,o=a,c=(i=t).getContext("2d"),u=function(){return new Promise(function(e,t){var r=new Image,n=new Image;r.src="img/scissors.svg",r.width=r.height=24,n.src="img/x-square.svg",n.width=n.height=24;var a={viewportRatio:1,radius:6,bbox:[0,0,0,0],scissorPos1:[0,0],scissorPos2:[0,0],scissorPos3:[0,0],scissorPos4:[0,0],img:r,reset_img:n,isDragging:!1,isScaling:!1,offsetX:0,offsetY:0,reset:function(){a.bbox=[0,0,0,0],a.isDragging=!1,a.isScaling=!1,a.offsetX=0,a.offsetY=0,a.scissorPos1=[0,0],a.scissorPos2=[0,0],a.scissorPos3=[0,0],a.scissorPos4=[0,0],c.clearRect(0,0,c.canvas.width,c.canvas.height)},refactor:function(e,t,r){return!(!a.offsetX||!a.offsetY)&&(a.bbox[0]=a.bbox[2]>0?Math.max(0,a.bbox[0]):a.bbox[0]+a.bbox[2],a.bbox[1]=a.bbox[3]>0?Math.max(0,a.bbox[1]):a.bbox[1]+a.bbox[3],a.bbox[2]=Math.min(e,Math.abs(a.bbox[2])),a.bbox[3]=Math.min(t,Math.abs(a.bbox[3])),a.viewportRatio=r,a.bbox.slice().map(function(e){return e*a.viewportRatio}))}};r.onload=function(){a.img=r,e(a)}})},e.n=1,u();case 1:l=e.v,i.addEventListener("mousedown",function(e){t.width=r.offsetWidth,t.height=r.offsetHeight;var n,a,s,c=e.clientX-i.getBoundingClientRect().left,u=e.clientY-i.getBoundingClientRect().top;if(l.offsetX=c-l.bbox[0],l.offsetY=u-l.bbox[1],Lo(n=c,a=u,(s=l).bbox[0],s.bbox[1],s.radius)?(s.bbox[0]=s.bbox[0]+s.bbox[2],s.bbox[1]=s.bbox[1]+s.bbox[3],1):Lo(n,a,s.bbox[0]+s.bbox[2],s.bbox[1],s.radius)?(s.bbox[1]=s.bbox[1]+s.bbox[3],1):Lo(n,a,s.bbox[0],s.bbox[1]+s.bbox[3],s.radius)?(s.bbox[0]=s.bbox[0]+s.bbox[2],1):Lo(n,a,s.bbox[0]+s.bbox[2],s.bbox[1]+s.bbox[3],s.radius))return hc("inside a corner; update original"),void(l.isScaling=!0);if(Oo(c,u,l)){hc("inside a scissor");var h=l.refactor(r.offsetWidth,r.offsetHeight,r.videoWidth/r.offsetWidth);return clearTimeout(So),void(So=setTimeout(function(){o&&o(h),l.reset()},100))}c>=l.bbox[0]&&c<l.bbox[0]+l.bbox[2]&&u>=l.bbox[1]&&u<l.bbox[1]+l.bbox[3]||c>=l.bbox[0]+l.bbox[2]&&c<l.bbox[0]&&u>=l.bbox[1]+l.bbox[3]&&u<l.bbox[1]||c>=l.bbox[0]&&c<l.bbox[0]+l.bbox[2]&&u>=l.bbox[1]+l.bbox[3]&&u<l.bbox[1]||c>=l.bbox[0]+l.bbox[2]&&c<l.bbox[0]&&u>=l.bbox[1]&&u<l.bbox[1]+l.bbox[3]?l.isDragging=!0:c>=0&&c<=i.width&&u>=0&&u<=i.height&&(l.reset(),l.isDragging=!0,l.bbox[0]=c,l.bbox[1]=u)}),document.addEventListener("mousemove",function(e){var t=e.clientX-i.getBoundingClientRect().left,r=e.clientY-i.getBoundingClientRect().top;if(Oo(t,r,l)?i.style.cursor="pointer":i.style.cursor="auto",l.isScaling)return l.bbox[2]=t-l.bbox[0],l.bbox[3]=r-l.bbox[1],void Po(c,l);if(l.isDragging){if(0!=l.offsetX&&0!=l.offsetY)return l.bbox[0]=t-l.offsetX,l.bbox[1]=r-l.offsetY,void Po(c,l);l.bbox[2]=t-l.bbox[0],l.bbox[3]=r-l.bbox[1],Po(c,l)}}),document.addEventListener("mouseup",function(e){if(t.width=r.offsetWidth,t.height=r.offsetHeight,l.isScaling&&(l.isScaling=!1,l.offsetX&&l.offsetY))hc("scaling completed. rectangle: ".concat(JSON.stringify(l)));else if(l.isDragging){l.isDragging=!1,hc("rectangle ".concat(JSON.stringify(l)));var n=l.refactor(r.offsetWidth,r.offsetHeight,r.videoWidth/r.offsetWidth);n&&(clearTimeout(Ao),Ao=setTimeout(function(){s&&s(n)},100)),Po(c,l)}}),Uo(c,l);case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),Do=function(e){var t=new Date(1e3*e);return{year:t.getFullYear(),month:String(t.getMonth()+1).padStart(2,"0"),day:String(t.getDate()).padStart(2,"0"),hours:String(t.getHours()).padStart(2,"0"),minutes:String(t.getMinutes()).padStart(2,"0"),seconds:String(t.getSeconds()).padStart(2,"0")}},Ro=function(e){var t=Do(e),r=t.year,n=t.month,a=t.day,i=t.hours,s=t.minutes,o=t.seconds;return"".concat(n,"-").concat(a," '").concat(r-2e3," ").concat(i,":").concat(s,":").concat(o)},Vo=function(e){var t=Do(e),r=t.year,n=t.month,a=t.day;return"".concat(n,"-").concat(a," '").concat(r-2e3)},Ho=function(e,t){var r=1e3*e,n=1e3*t,a=Date.now();return a>=r&&a<=n},To=function(e,t){return Object.keys(e).find(function(r){return e[r]===t})},$o=function(e){var t,r=[],n=po(e.split("/"));try{for(n.s();!(t=n.n()).done;){var a=t.value;""!==a&&"."!==a&&(".."===a?r.length>0&&r.pop():r.push(a))}}catch(e){n.e(e)}finally{n.f()}return"/"+r.join("/")},Ko=function(e){return(e=(e=e.replace(/\//g,"_").replace(/ /g,"_")).replace(/[^a-zA-Z0-9_]+/g,"")).toLowerCase()},Fo=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t},Mo=function(e,t){var r,n=e.map(Number),a=new Set(mo(Array(t).keys())),i=new Set(n),s=[],o=po(a);try{for(o.s();!(r=o.n()).done;){var c=r.value;i.has(c)||s.push(c)}}catch(e){o.e(e)}finally{o.f()}return s},Jo="",zo="",qo={},Wo={},Zo={tenant:{apiKeys:{},subscriptions:{},subject:{},cred:{},ice_offers:{},processors:[],notifications:[],file_map:{},file_info_map:{sum:{},dir:{cert:"/inori/cert",pkey:"/inori/pvtKey",bridge_cert:"/inori/cert_bridge",bridge_pkey:"/inori/pvtKey_bridge",admin_cert:"/inori/cert_admin",admin_pkey:"/inori/pvtKey_admin",tmp_cert:"/inori/tmp_cert",tmp_pkey:"/inori/tmp_pvtKey"},desc:{cert:"tenant's license",pkey:"tenant's private key",bridge_cert:"bridge license",bridge_pkey:"bridge private key",admin_cert:"admin's license",admin_pkey:"admin's private key",tmp_cert:"temporary license",tmp_pkey:"temporary private key"}}},leads:{list:[]},channels:{list:[]},ice_offers:{},ice_services:{},remote_processor_list:{list:[]},tenants:{list:[]},subjects:{list:[]},subject_reqs:{},message_infos:{},directory_list:{root:"",files:[]},mini_files:{path:{}},content:{},geo_locations:{list:[]},file_chunks:{}},Go={},Qo=!1,Yo=Jo,Xo={},ec=new Map,tc=!1;if("undefined"==typeof Worker)throw"worker is not avaialble in this browser";var rc,nc,ac,ic,sc,oc,cc,uc,lc=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];!function(e,t,r){var n,a=po(r);try{for(a.s();!(n=a.n()).done;){var i,s=n.value;if(Array.isArray(s)){var o,c=[],u=po(s);try{for(u.s();!(o=u.n()).done;){var l=o.value;Array.isArray(l)?c.push.apply(c,mo(l)):c.push(l)}}catch(e){u.e(e)}finally{u.f()}(i=console).log.apply(i,["[".concat(e,": ").concat(wo(),"]")].concat(c))}}}catch(e){a.e(e)}finally{a.f()}}(bo,0,t)},hc=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qo.postMessage({label:"local:system:event:<string>",data:t})},fc=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qo.postMessage({label:"local:system:event:<string>",data:"exception: ".concat(t.join(" "))})},dc=function(e){return new Promise(function(t){var r=!1;xo(5e3).then(function(){r||t(!1)});var n="tenant:data:chunk:pub_key:signed:<bytes>";window.addEventListener(n,function(){var e=fo(uo().m(function e(a){return uo().w(function(e){for(;;)switch(e.n){case 0:return r=!0,e.n=1,Jc(a.detail.content);case 1:if(e.v){e.n=2;break}return fc("received ".concat(n,"; invalid cert")),e.a(2,t(!1));case 2:t(!0);case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),n="tenant:data:x509:content:received:<subject>",window.addEventListener(n,function(){var e=fo(uo().m(function e(n){return uo().w(function(e){for(;;)switch(e.n){case 0:r=!0,t(!0);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),gc({to:Jo,label:"tenant:data:x509:content:<subject>",data:e})})},mc=function(){var e=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lc();case 1:return t=e.v,qo.postMessage({from:Yo,to:Yo,label:"local:register:<bytes>",data:t.publicKey.asBuffer()}),e.a(2,new Promise(function(e){var t=!1,r="tenant:data:chunk:pub_key:signed:<bytes>";window.addEventListener(r,function(){var n=fo(uo().m(function n(a){return uo().w(function(n){for(;;)switch(n.n){case 0:return t=!0,n.n=1,Jc(a.detail.content);case 1:if(n.v){n.n=2;break}return fc("received ".concat(r,"; invalid cert")),n.a(2,e(!1));case 2:e(!0);case 3:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){t||e(!1)})}))}},e)}));return function(){return e.apply(this,arguments)}}(),pc=function(){var e=fo(uo().m(function e(){var t,r,n,a,i;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!Qo){e.n=1;break}return e.a(2);case 1:return e.n=2,Pc();case 2:if(!(t=e.v)){e.n=4;break}if(r=t.asCert(),!(n=Rc(r)).serialnumber||!n.serialnumber.val){e.n=4;break}return Zo.tenant.subject=n,e.n=3,Yc(Yo);case 3:return a=e.v,qo.postMessage({from:Yo,to:Yo,label:"local:authenticate:<bytes>",data:{id:n.serialnumber.val,metadata:a}}),e.a(2,new Promise(function(e){var t=!1;window.addEventListener("admin:data:tenant:content:received:<tenant>",function(r){t=!0,Qo=!0,Au().filter(function(e){return e.isLocalVideoStream||e.isLocalScreenStream}).forEach(function(e){e.self_register()}),Zo.tenant.apiKeys.goog=r.detail.content.metadata,e(Zo.tenant.subject)},{once:!0}),xo(5e3).then(function(){t||e(!1)})}));case 4:e.n=6;break;case 5:return e.p=5,i=e.v,fc(i),e.a(2,Promise.resolve(!1));case 6:return e.a(2)}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}(),gc=function(e){e.label_2_forward=e.label,e.label="local:bridge:send",e.from=e.from||Yo,e.to=e.to||Jo,qo.postMessage(e)},vc=function(){var e=fo(uo().m(function e(){var t,r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.ipify.org?format=json");case 1:return t=e.v,e.n=2,t.json();case 2:r=e.v,hc("geolocation updated for ".concat(r.ip)),gc({label:"tenant:data:geo:content:<geo_location>",data:{query:r.ip}});case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),bc=function(e){e.label_2_forward=e.label,e.label="local:peer:send",e.from=Yo,qo.postMessage(e)},wc=function(e){e.label="local:peer:rcvd",e.to=Yo,qo.postMessage(e)},yc=function(e,t){var r=kc(e);return"-----BEGIN ".concat(t,"-----\n").concat(Sc(r,64).join("\n"),"\n-----END ").concat(t,"-----\n")},kc=function(e){for(var t=new Uint8Array(e),r="",n=0;n<t.byteLength;n++)r+=String.fromCharCode(t[n]);return window.btoa(r)},_c=function(e,t){for(var r="-----BEGIN ".concat(t,"-----\n"),n="\n-----END ".concat(t,"-----\n"),a=e.substring(r.length,e.length-n.length),i=atob(a),s=i.length,o=new ArrayBuffer(s),c=new Uint8Array(o),u=0;u<s;u++)c[u]=i.charCodeAt(u);return o},Ac=function(e){var t=Array.from(new Uint8Array(e)).map(function(e){return e.toString(16).padStart(2,"0")});return t.join("")},Sc=function(e,t){for(var r=[],n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r},Cc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,crypto.subtle.digest("SHA-256",t);case 1:return r=e.v,e.a(2,Ac(r))}},e)}));return function(t){return e.apply(this,arguments)}}(),xc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Uu(t,"application/octet-stream");case 1:if((r=e.v)&&!((null==r?void 0:r.byteLength)<1)){e.n=2;break}return e.a(2,null);case 2:return e.a(2,{sum:function(){var e=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Cc(r);case 1:return e.a(2,e.v)}},e)}));return function(){return e.apply(this,arguments)}}()})}},e)}));return function(t){return e.apply(this,arguments)}}(),Bc=function(){var e=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,xc(t);case 1:if(r=e.v){e.n=2;break}return e.a(2,"");case 2:return e.n=3,r.sum();case 3:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),e.n=1,t(Zo.tenant.file_info_map.dir.cert);case 1:return Zo.tenant.file_info_map.sum.cert=e.v,e.n=2,t(Zo.tenant.file_info_map.dir.pkey);case 2:return Zo.tenant.file_info_map.sum.pkey=e.v,e.n=3,t(Zo.tenant.file_info_map.dir.bridge_cert);case 3:return Zo.tenant.file_info_map.sum.bridge_cert=e.v,e.n=4,t(Zo.tenant.file_info_map.dir.bridge_pkey);case 4:return Zo.tenant.file_info_map.sum.bridge_pkey=e.v,e.n=5,t(Zo.tenant.file_info_map.dir.admin_cert);case 5:return Zo.tenant.file_info_map.sum.admin_cert=e.v,e.n=6,t(Zo.tenant.file_info_map.dir.admin_pkey);case 6:Zo.tenant.file_info_map.sum.admin_pkey=e.v;case 7:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),Ec=function(){return Zo.subjects.list=Zo.subjects.list.filter(function(e){return e}),Zo.subjects.list},Ic=function(e){var t=Zo.subjects.list.find(function(t){return t.tenantId==e.tenantId});return!!t&&(Zo.subject_reqs[t.tenantId]?(Zo.subject_reqs[t.tenantId].push(e),!0):(Zo.subject_reqs[t.tenantId]=[e],!0))},Pc=function(){var e=fo(uo().m(function e(){var t,r,n=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"/inori/cert",e.n=1,Uu(t,"application/octet-stream");case 1:if((r=e.v)&&!((null==r?void 0:r.byteLength)<1)){e.n=2;break}return e.a(2,null);case 2:return e.a(2,Hc(r))}},e)}));return function(){return e.apply(this,arguments)}}(),Nc=function(){var e=fo(uo().m(function e(){var t,r,n=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"/inori/pvtKey",e.n=1,Uu(t,"application/octet-stream");case 1:if(r=e.v){e.n=2;break}return e.a(2,!1);case 2:return e.a(2,Tc(r))}},e)}));return function(){return e.apply(this,arguments)}}(),Oc=function(){var e=fo(uo().m(function e(){var t,r,n=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"/inori/pubKey",e.n=1,Uu(t,"application/octet-stream");case 1:if(r=e.v){e.n=2;break}return e.a(2,!1);case 2:return e.a(2,$c(r))}},e)}));return function(){return e.apply(this,arguments)}}(),Lc=function(){var e=fo(uo().m(function e(){var t,r,n,a,i,s,o,c,u=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:"/inori/pvtKey",r=u.length>1&&void 0!==u[1]?u[1]:"/inori/pubKey",e.n=1,Nc(t);case 1:return n=e.v,e.n=2,Oc(r);case 2:if(a=e.v,n&&a){e.n=8;break}return e.n=3,Uc();case 3:return i=e.v,s=i.publicKey,o=i.privateKey,e.n=4,Ku(o,t);case 4:return e.n=5,Ku(s,r);case 5:return e.n=6,Nc(t);case 6:return n=e.v,e.n=7,Oc(r);case 7:a=e.v;case 8:return c={publicKey:a,privateKey:n},e.a(2,c)}},e)}));return function(){return e.apply(this,arguments)}}(),Uc=function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]);case 1:return t=e.v,e.n=2,window.crypto.subtle.exportKey("spki",t.publicKey);case 2:return r=e.v,e.n=3,window.crypto.subtle.exportKey("pkcs8",t.privateKey);case 3:return n=e.v,e.a(2,{publicKey:r,privateKey:n})}},e)}));return function(){return e.apply(this,arguments)}}(),jc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.importKey("spki",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);case 1:return r=e.v,e.a(2,r)}},e)}));return function(t){return e.apply(this,arguments)}}(),Dc=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,window.crypto.subtle.importKey("pkcs8",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]);case 1:return r=e.v,e.a(2,r)}},e)}));return function(t){return e.apply(this,arguments)}}(),Rc=function(e){var t={},r=Xu.getX509Sbj();return e.subject.typesAndValues.forEach(function(e){var n=r[e.type];n&&3==n.length&&(t[n[0].toLowerCase()]={val:e.value.valueBlock.value,desc:n[1],proto:n[2]})}),t},Vc=function(e){var t=Dt(e);return new Hn({schema:t.result})},Hc=function(e){var t={asCert:function(){return Vc(e)},asString:function(){return yc(e,"CERTIFICATE")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=t.asString(),r=new Blob([e],{type:"application/octet-stream"}),n=document.createElement("a"),a=URL.createObjectURL(r);n.href=a,n.download="".concat(Yo,".cer"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}};return t},Tc=function(e){var t,r={asKey:(t=fo(uo().m(function t(){return uo().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Dc(e);case 1:return t.a(2,t.v)}},t)})),function(){return t.apply(this,arguments)}),asString:function(){return yc(e,"PRIVATE KEY")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=r.asString(),t=new Blob([e],{type:"application/octet-stream"}),n=document.createElement("a"),a=URL.createObjectURL(t);n.href=a,n.download="".concat(Yo,".key"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}};return r},$c=function(e){var t,r={asKey:(t=fo(uo().m(function t(){return uo().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,jc(e);case 1:return t.a(2,t.v)}},t)})),function(){return t.apply(this,arguments)}),asString:function(){return yc(e,"PUBLIC KEY")},asBuffer:function(){return e},asBlob:function(){return new Blob([e],{type:"application/octet-stream"})},asFile:function(){var e=r.asString(),t=new Blob([e],{type:"application/octet-stream"}),n=document.createElement("a"),a=URL.createObjectURL(t);n.href=a,n.download="".concat(Yo,".pub"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}};return r},Kc=function(e){var t=_c(e,"CERTIFICATE");return Hc(t)},Fc=function(e){var t=_c(e,"PRIVATE KEY");return Tc(t)},Mc=function(e){var t=_c(e,"PUBLIC KEY");return $c(t)},Jc=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s,o;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,zo){e.n=1;break}throw"invalid SYS_CERT";case 1:return e.n=2,Vc(t);case 2:return r=e.v,e.n=3,Zc(zo,r);case 3:if((n=e.v).certIssuer,n.issuerSubject,a=n.isValidIssuer,i=n.signatureVerified,a&&i){e.n=4;break}return e.a(2,!1);case 4:return e.n=5,Ku(t.buffer,"/inori/cert");case 5:if(!(s=Rc(r)).tid||!s.tid.val){e.n=6;break}return Zo.tenant.subject=s,e.a(2,!0);case 6:return e.a(2,!1);case 7:return e.p=7,o=e.v,fc("_update_cert > err: ".concat(o)),e.a(2,!1)}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),zc=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,zo){e.n=1;break}throw"invalid SYS_CERT";case 1:return e.n=2,Vc(t);case 2:return r=e.v,e.n=3,Zc(zo,r);case 3:if((n=e.v).certIssuer,n.issuerSubject,a=n.isValidIssuer,i=n.signatureVerified,a&&i){e.n=4;break}return e.a(2,!1);case 4:return e.n=5,Ku(t.buffer,Zo.tenant.file_info_map.dir.bridge_cert);case 5:return e.a(2,r);case 6:return e.p=6,s=e.v,fc("_add_bridge_cert > err: ".concat(s)),e.a(2,!1)}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),qc=function(){var e=fo(uo().m(function e(t,r){var n,a,i,s,o;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Vc(t);case 1:return n=e.v,e.n=2,Zc(r,n);case 2:if((a=e.v).certIssuer,a.issuerSubject,i=a.isValidIssuer,s=a.signatureVerified,i&&s){e.n=3;break}return e.a(2,!1);case 3:return e.n=4,Ku(t.buffer,"/inori/cert_admin");case 4:return e.a(2,n);case 5:return e.p=5,o=e.v,fc("_add_admin_cert > err: ".concat(o)),e.a(2,!1)}},e,null,[[0,5]])}));return function(t,r){return e.apply(this,arguments)}}(),Wc=function(){var e=fo(uo().m(function e(t,r,n){var a,i,s,o,c,u,l;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pc();case 1:return a=e.v,e.n=2,null==a?void 0:a.asCert();case 2:return i=e.v,e.n=3,Vc(t);case 3:if(s=e.v,!i){e.n=5;break}return e.n=4,Zc(s,i);case 4:if((o=e.v).certIssuer,o.issuerSubject,c=o.isValidIssuer,u=o.signatureVerified,c&&u){e.n=5;break}return e.a(2,!1);case 5:return zo=s,Jo=n.toLowerCase(),Yo=r.toLowerCase(),e.n=6,Cc(t);case 6:return Zo.tenant.file_info_map.sum.ca_cert=e.v,e.a(2,!0);case 7:return e.p=7,l=e.v,fc("_update_root_cert > err: ".concat(l)),e.a(2,!1)}},e,null,[[0,7]])}));return function(t,r,n){return e.apply(this,arguments)}}(),Zc=function(){var e=fo(uo().m(function e(t,r){var n,a,i,s,o;return uo().w(function(e){for(;;)switch(e.n){case 0:if(n=r.issuer.typesAndValues.map(function(e){return"".concat(e.type,": ").concat(e.value.valueBlock.value)}).join("\n"),a=t.subject.typesAndValues.map(function(e){return"".concat(e.type,": ").concat(e.value.valueBlock.value)}).join("\n"),i=r.issuer.isEqual(t.subject),s=rn()){e.n=1;break}throw new Error("No WebCrypto extension found");case 1:return e.n=2,t.getPublicKey();case 2:return e.v,e.n=3,r.verify(t,s);case 3:return o=e.v,e.a(2,{certIssuer:n,issuerSubject:a,isValidIssuer:i,signatureVerified:o})}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Gc=function(e,t){var r=function(e){var t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!1),t},n=r(e.byteLength),a=r(t.byteLength),i=n.byteLength+e.byteLength+a.byteLength+t.byteLength,s=new ArrayBuffer(i),o=new Uint8Array(s),c=0;return o.set(new Uint8Array(n),c),c+=n.byteLength,o.set(new Uint8Array(e),c),c+=e.byteLength,o.set(new Uint8Array(a),c),c+=a.byteLength,o.set(new Uint8Array(t),c),s},Qc=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s,o,c;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lc();case 1:return r=e.v,e.n=2,r.privateKey.asKey();case 2:if(n=e.v){e.n=3;break}return e.a(2,null);case 3:return a=new TextEncoder,i=a.encode(t),e.n=4,crypto.subtle.digest("SHA-256",i);case 4:return s=e.v,e.n=5,crypto.subtle.sign({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},n,s);case 5:return o=e.v,c=Gc(o,s),e.a(2,{signature:o,hash:s,joined:c})}},e)}));return function(t){return e.apply(this,arguments)}}(),Yc=function(){var e=fo(uo().m(function e(t){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Qc(Yo);case 1:return(r=e.v).signature,r.hash,n=r.joined,e.a(2,Ac(n))}},e)}));return function(t){return e.apply(this,arguments)}}(),Xc=function(){var e=fo(uo().m(function e(){var t,r,n,a,i,s;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=Zo.tenant.file_info_map.dir,e.n=1,Lc(t.admin_pkey,t.admin_cert);case 1:return r=e.v,n=r.publicKey,r.privateKey,a=new Promise(function(e){window.addEventListener("tenant:data:chunk:pub_key:admin:signed:<bytes>",function(){var t=fo(uo().m(function t(r){return uo().w(function(t){for(;;)switch(t.n){case 0:e(r.detail.content);case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),{once:!0})}),i=new Promise(function(e){window.addEventListener("tenant:data:chunk:pvt_key:bridge:<bytes>",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,Dc(n.detail.content);case 1:return r.n=2,Ku(n.detail.content,t.bridge_pkey);case 2:e(!0);case 3:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0})}),s=new Promise(function(e){var t="tenant:data:chunk:pub_key:bridge:signed:<bytes>";window.addEventListener(t,function(){var r=fo(uo().m(function r(n){var a;return uo().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,zc(n.detail.content);case 1:if(a=r.v){r.n=2;break}return fc("received ".concat(t,"; invalid cert")),r.a(2,e(!1));case 2:e(a);case 3:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0})}),gc({label:"tenant:data:chunk:pub_key:admin:<bytes>",data:n.asBuffer()}),e.a(2,{admCertPms:a,bridgePkeyPms:i,bridgeCertPms:s})}},e)}));return function(){return e.apply(this,arguments)}}(),eu=function(){var e=!1;return new Promise(function(){var t=fo(uo().m(function t(r){var n,a,i,s,o,c,u;return uo().w(function(t){for(;;)switch(t.n){case 0:return xo(5e3).then(function(){e||r(!1)}),t.n=1,Xc();case 1:return n=t.v,a=n.admCertPms,i=n.bridgePkeyPms,s=n.bridgeCertPms,t.n=2,a;case 2:return o=t.v,t.n=3,i;case 3:return c=t.v,t.n=4,s;case 4:return u=t.v,t.n=5,qc(o,u);case 5:if(t.v){t.n=6;break}return fc("_bootstrap_bridge_keypairs > _upd_admin_cert > invalid cert"),t.a(2,r(!1));case 6:return t.n=7,Bc();case 7:r(o&&c&&u),e=!0;case 8:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())},tu=function(){var t=fo(uo().m(function t(r){return uo().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,n){try{FS.mkdir(r),FS.mount(IDBFS,{},r),FS.syncfs(!0,function(a){if(a)n(a);else{var i=!1;if(FS.readdir("".concat(r)).indexOf("logs")<0&&(FS.mkdir("".concat(r,"/logs")),i=!0),FS.readdir("".concat(r)).indexOf("video")<0&&(FS.mkdir("".concat(r,"/video")),i=!0),FS.readdir("".concat(r)).indexOf("model")<0&&(FS.mkdir("".concat(r,"/model")),i=!0),FS.readdir("".concat(r)).indexOf("image")<0&&(FS.mkdir("".concat(r,"/image")),i=!0),FS.readdir("".concat(r,"/image")).indexOf("mini")<0&&(FS.mkdir("".concat(r,"/image/mini")),i=!0),FS.readdir("".concat(r,"/model")).indexOf("json")<0&&(FS.mkdir("".concat(r,"/model/json")),i=!0),FS.readdir("".concat(r,"/model")).indexOf("json")<0&&(FS.mkdir("".concat(r,"/model/json")),i=!0),FS.readdir("".concat(r,"/model")).indexOf("weight")<0&&(FS.mkdir("".concat(r,"/model/weight")),i=!0),i)return FS.syncfs(!1,function(r){return r?(fc("_bootstrap_fs > err: ".concat(e)),n(e),t(!1)):(hc("_bootstrap_fs > files re-sync"),t(!0))}),t(!1);t(!0)}})}catch(e){fc("_bootstrap_fs > err: ".concat(e)),n(e)}}))},t)}));return function(e){return t.apply(this,arguments)}}(),ru=function(){return!!(Zo.tenants&&Zo.tenants.list&&Zo.tenants.list.length>0)&&Zo.tenants.list.filter(function(e){return e})},nu=function(){var e=ru();return e?e.filter(function(e){return e.device}):[]},au=function(){return Object.keys(Wo.HardwareVendor.values).map(function(e){return{name:e,id:Wo.HardwareVendor.values[e]}})},iu=function(e){var t=lu(e),r=Object.keys(Wo.Role.values).filter(function(e){return Wo.Role.values[e]==t.role});if(r.length>0)return r[0]},su=function(e){Zo.remote_processor_list.list.find(function(t){return t.id.toLowerCase()==e.id.toLowerCase()})||Zo.remote_processor_list.list.push(e)},ou=function(e){e&&e.list&&e.list.forEach(function(e){su(e)}),cu()},cu=function(){var e=Zo.remote_processor_list.list.filter(function(e){return Zo.tenants.list.find(function(t){return e.sessionId.toLowerCase()==t.sessionId.toLowerCase()})});Zo.remote_processor_list.list=e.filter(function(e){return e})},uu=function(e){Zo.tenants.list.length?(new Map(Zo.tenants.list.map(function(e){return[e.sessionId.toLowerCase(),e]})),e.list.forEach(function(e){var t=e.sessionId.toLowerCase(),r=(e.id.toLowerCase(),Zo.tenants.list.find(function(e){return e.sessionId.toLowerCase()===t}));r?r.sessionId!==Yo&&(Object.entries(Zo.tenant.subscriptions).forEach(function(e){var n=co(e,2),a=n[0],i=n[1];a.toLowerCase()===r.sessionId.toLowerCase()&&a.toLowerCase()!==t&&(i.sessionId=t,Zo.tenant.subscriptions[t]=i,delete Zo.tenant.subscriptions[a])}),Object.assign(r,e)):Zo.tenants.list.push(e)}),Zo.tenants.list=Zo.tenants.list.filter(function(t){return!!e.list.some(function(e){return e.sessionId.toLowerCase()===t.sessionId.toLowerCase()})||(delete Zo.tenant.subscriptions[t.sessionId.toLowerCase()],!1)})):Zo.tenants=e},lu=function(e){return Zo.tenants.list.find(function(t){return(null==t?void 0:t.sessionId.toLowerCase())==e.toLowerCase()})},hu=function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:for(t=Au(),r=0;r<t.length;r++)((n=t[r]).isLocalScreenStream||n.isLocalVideoStream)&&n.mediaStream&&n.dat.sessionId;case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),fu=function(){var e=fo(uo().m(function e(t){var r,n;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(r=Gu("screen-preview-".concat(Yo))).streamInitCallback=function(){var e=fo(uo().m(function e(t){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:n=0;case 1:if(!(n<3)){e.n=5;break}return e.p=2,e.n=3,r.self_register();case 3:return e.a(2);case 4:e.p=4,a=e.v,fc("standby_screen_sharing > streamInitCallback > self_register ".concat(a,". #").concat(n+1," re-trying..")),n++,e.n=1;break;case 5:return e.n=6,yu(r);case 6:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}(),e.n=1,r.share_screen();case 1:if(e.v){e.n=3;break}return e.n=2,yu(r);case 2:return e.a(2,null);case 3:return e.a(2,r);case 4:e.p=4,n=e.v,fc("standby_screen_sharing > err",n);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),du=function(){var e=fo(uo().m(function e(){var t,r;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(t=Gu("cam-preview-".concat(Yo))).streamInitCallback=function(){var e=fo(uo().m(function e(r){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:n=0;case 1:if(!(n<3)){e.n=5;break}return e.p=2,e.n=3,t.self_register();case 3:return e.a(2);case 4:e.p=4,a=e.v,fc("standby_video_sharing > streamInitCallback > self_register ".concat(a,". #").concat(n+1," re-trying..")),n++,e.n=1;break;case 5:return e.n=6,yu(t);case 6:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}(),e.n=1,t.share_camera();case 1:if(e.v){e.n=3;break}return e.n=2,yu(t);case 2:return e.a(2,null);case 3:return e.a(2,t);case 4:e.p=4,r=e.v,fc("standby_video_sharing > err",r);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(){return e.apply(this,arguments)}}(),mu=function(e){var t=!1;return gc({to:Jo,label:"admin:data:message_info:content:<message_info>",data:e}),new Promise(function(e){window.addEventListener("admin:data:message_info:content:<message_info>:received",function(r){if(r.detail.content.code<0)pu(r.detail.content.label);else{var n=vu(r.label);n?n=r.content:gu(r.detail.content)}e(r.detail.content),t=!0}),xo(5e3).then(function(){t||(fc("_set_message_info > timeout"),e(!1))})})},pu=function(e){var t=Zo.message_infos&&Zo.message_infos.list&&Zo.message_infos.list.filter(function(t){return t.label!=e});Zo.message_infos.list=t},gu=function(e){vu(e.label)||Zo.message_infos&&Zo.message_infos.list&&Zo.message_infos.list.push(e)},vu=function(e){var t=Zo.message_infos&&Zo.message_infos.list&&Zo.message_infos.list.filter(function(t){return t.label==e});if(1==(null==t?void 0:t.length))return t[0]},bu=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Yo,a=Zo.tenant.notifications.find(function(n){return n.msg===r&&n.from===e&&n.metadata===t});a?a.last_update.push(Date.now()):(a={from:e,to:n,metadata:t,msg:r,last_update:[Date.now()],has_read:!0,has_notified:!(r.indexOf("local:")<0),id:Zo.tenant.notifications.length,htmlTmpl:null},Zo.tenant.notifications.push(a));var i=function(e){var t=vu(e);return t&&t.events?t.events:[]}(r),s={status:r,sender:e,content:t};return i&&i.forEach(function(e){e.msgKey&&t[e.msgKey]&&(r="".concat(r,":").concat(t[e.msgKey])),xo(500).then(function(t){switch(e.targetType.toLowerCase()){case"dom":var n=document.querySelector(e.targetKey);if(n){var a=r.replace(/[<>]/g,"*");n.dispatchEvent(new CustomEvent(a,{detail:s}))}case"window":window.dispatchEvent(new CustomEvent(r,{detail:s}))}})}),a},wu=function(){var e=fo(uo().m(function e(){var t;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=JSON.stringify(Zo.tenant.notifications,null,2),FS.writeFile("/inori/logs/".concat(Yo),t),e.n=1,Ou();case 1:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),yu=function(){var e=fo(uo().m(function e(t){var r,n,a,i;return uo().w(function(e){for(;;)switch(e.n){case 0:return a=Zo.tenant.processors.findIndex(function(e){var r;return!!e&&e.Id().toLowerCase()===(null===(r=t)||void 0===r?void 0:r.Id().toLowerCase())}),-1!==a&&(Zo.tenant.processors[a]=null),hc("processor# ".concat(null===(r=t)||void 0===r?void 0:r.dat.id," removed")),(t.isLocalScreenStream||t.isLocalVideoStream)&&(null===(i=t)||void 0===i||i.stop_mediaStream()),e.n=1,null===(n=t)||void 0===n?void 0:n.deinit();case 1:t=null;case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),ku=function(e,t){var r=Au();if(t&&(r=_u(t)),e)return r.find(function(t){return!!t&&t.Id().toLowerCase()===e.toLowerCase()})},_u=function(e){if(e)return Au().filter(function(t){return t.dat.remoteId.toLowerCase()===e.toLowerCase()})},Au=function(){Zo.tenant.processors=Zo.tenant.processors.filter(function(e){return e});var e=Zo.tenant.processors.sort(function(e,t){return t.dat.lastUpdate-e.dat.lastUpdate});return e},Su=function(){var e=Zo.remote_processor_list.list&&Zo.remote_processor_list.list.map(function(e){var t=Au().find(function(e){return e.dat.id==e.id});return t&&t._screenshot&&(e.screenshot=t._screenshot),e}).sort(function(e,t){return t.last_update-e.last_update});return e},Cu=function(e){var t,r=Su();return t=e,r.reduce(function(e,r){var n=r[t];return e[n]||(e[n]=[]),e[n].push(r),e},{})},xu=function(e){if(e){var t,r=null===(t=Zo.remote_processor_list)||void 0===t||null===(t=t.list)||void 0===t?void 0:t.find(function(t){return t.id.toLowerCase()===e.toLowerCase()});if(r){var n=ku(r.id);return n&&(r.screenshot=n._screenshot),r}}},Bu=function(e){var t;Zo.remote_processor_list.list=null===(t=Zo.remote_processor_list)||void 0===t||null===(t=t.list)||void 0===t?void 0:t.filter(function(t){return t.id.toLowerCase()!=e.toLowerCase()})},Eu=function(e){var t=xu(e);t&&gc({to:t.sessionId,label:"tenant:data:processor:delete:<processor_id>",data:t.id})},Iu=function(e){try{return FS.stat(e)}catch(t){fc("_file_exists > filename: ".concat(e," err ").concat(t))}return!1},Pu=function(e,t){return FS.analyzePath(t).exists&&FS.unlink(t),FS.rename(e,t),Ou()},Nu=function(e){return FS.unlink(e),Ou()},Ou=function(){return new Promise(function(e){try{FS.syncfs(!1,function(t){return t?(fc("_sync_files > FS.syncfs err: ".concat(JSON.stringify(t))),e(!1)):(hc("_sync_files > FS.syncfs > successful"),e(!0))})}catch(t){fc("_sync_files > FS.syncfs err: ".concat(JSON.stringify(t))),e(!1)}})},Lu=function(e,t){try{var r=FS.readFile(e,{encoding:"binary"});return r?new Blob([r],{type:t}):new ArrayBuffer(0)}catch(t){fc("_read_file_blob > from ".concat(e," > e: ").concat(t))}return new ArrayBuffer(0)},Uu=function(){var e=fo(uo().m(function e(t,r,n){var a;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lu(t,r);case 1:if(!((a=e.v).byteLength<1)){e.n=2;break}return e.a(2,Promise.resolve(!1));case 2:return e.a(2,new Promise(function(e,t){try{var r=new FileReader;r.onload=function(t){var r=t.target.result;if(!n)return e(r);var a=function(e){for(var t=e.toLowerCase().replace(/-/g,""),r=new Uint8Array(16),n=0;n<16;n++)r[n]=parseInt(t.substr(2*n,2),16);return r}(n),i=new Uint8Array(r),s=new Uint8Array(i.length+a.length);return s.set(a,0),s.set(i,a.length),e(s)},r.readAsArrayBuffer(a)}catch(t){return fc("_read_file_buffer > ",t),e(!1)}}))}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),ju=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Lu(t,"video/webm");case 1:return r=e.v,e.a(2,URL.createObjectURL(r))}},e)}));return function(t){return e.apply(this,arguments)}}(),Du=function(e){try{var t=Lu(e,"image/png");if(t.size>0)return URL.createObjectURL(t)}catch(e){fc("read_img_obj > err: ".concat(e))}return!1},Ru=function(e){return new Promise(function(t){try{var r=new FileReader;r.onerror=function(e){fc("_read_blob_2_arraybuffer  > reader.onerror: ".concat(JSON.stringify(e.target.error))),t(!1)},r.onload=function(){var e=r.result;t(e)},r.readAsArrayBuffer(e)}catch(e){fc("_read_blob_2_arraybuffer  > err: ".concat(JSON.stringify(e))),t(!1)}})},Vu=function(){var e=fo(uo().m(function e(t){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ru(t);case 1:return r=e.v,n=io(new Uint8Array(r)),e.a(2,{decompressedData:n})}},e)}));return function(t){return e.apply(this,arguments)}}(),Hu=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},Tu=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ru(t);case 1:if(!(r=e.v)){e.n=2;break}return e.a(2,Hu(r));case 2:return e.a(2,!1)}},e)}));return function(t){return e.apply(this,arguments)}}(),$u=function(){var e=fo(uo().m(function e(t,r){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ru(t);case 1:if(!(n=e.v)){e.n=3;break}return e.n=2,Ku(n,r);case 2:return e.a(2,!0);case 3:return e.a(2,!1)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Ku=function(){var e=fo(uo().m(function e(t,r){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=new Uint8Array(t),FS.writeFile(r,n,{encoding:"binary"}),tc){e.n=3;break}return tc=!0,e.n=1,xo(3e3);case 1:return e.n=2,Ou();case 2:tc=!1;case 3:t=null,e.n=5;break;case 4:return e.p=4,a=e.v,fc("_write_arrbuf_2_file > to ".concat(r," e: ").concat(a)),e.a(2,!1);case 5:return e.a(2,!0)}},e,null,[[0,4]])}));return function(t,r){return e.apply(this,arguments)}}(),Fu=function(e,t){return new Promise(function(r,n){fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return Ku(e,t).then(function(e){r(!0)})}).catch(function(e){n(e)})})},Mu=function(){if(Zo.ice_services&&Zo.ice_services.list&&Zo.ice_services.list.length>0){Zo.ice_services.list=Zo.ice_services.list.map(function(e){return{credential:e.credential,urls:[e.urls],username:e.username}});var e={iceServers:Zo.ice_services.list,iceTransportPolicy:"all"};return new RTCPeerConnection(e)}return!1},Ju=function(){var e=fo(uo().m(function e(t,r,n){return uo().w(function(e){for(;;)switch(e.n){case 0:if(0!=n.length){e.n=1;break}return e.n=1,xo(2e3);case 1:return e.a(2,new Promise(function(e,a){var i=!1;if(t.dat.sessionId.toLowerCase()!=Jo.toLowerCase()){var s=window.crypto.randomUUID().toLowerCase(),o={id:s,uid:t.dat.sessionId,biStream:!1,processorId:t.Id(),metadata:btoa(JSON.stringify(r)),lastUpdate:(new Date).getTime(),candidates:[],connectionType:Wo.ConnectionType.values.CONN_STREAM};n.forEach(function(e){o.candidates.push({metadata:btoa(JSON.stringify(e)),isOffer:!0,lastUpdate:(new Date).getTime()})});var c="tenant:data:ice_offer:content:answered:<ice_offer>:".concat(s);window.addEventListener(c,function(t){hc("iceoffer: ".concat(t.detail.content.id," answered.")),i=!0,e(t.detail.content)},{once:!0}),Zo.tenant.ice_offers[s]=o,gc({from:t.dat.sessionId,to:t.dat.remoteId,label:"tenant:data:ice_offer:content:<ice_offer>",data:o}),xo(2e4).then(function(){i||(window.removeEventListener(c,function(e){fc("create_offer > timeout")}),a(!1))})}else reject(!1)}))}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),zu=function(e,t,r){if(Yo.toLowerCase()!=Jo.toLowerCase())return e.aid=Yo.toString(),e.answer=btoa(JSON.stringify(t)),r.forEach(function(t){e.candidates.push({id:0,offerId:e.id,metadata:btoa(JSON.stringify(t)),isOffer:!1,lastUpdate:(new Date).getTime()})}),gc({to:e.uid,label:"tenant:data:ice_offer:content:answered:<ice_offer>",data:e}),e;fc("_answer_offer > invalid session id.")},qu=function(e,t,r){return new Promise(function(n,a){var i={id:window.crypto.randomUUID(),processorId:t.Id(),uid:t.dat.sessionId.toLowerCase(),metadata:btoa(JSON.stringify(e)),biStream:r,lastUpdate:(new Date).getTime(),candidates:[]},s="tenant:data:ice_offer:content:updated:<ice_offer>:".concat(i.id);window.addEventListener(s,function(e){hc("offer# ".concat(e.detail.content.id," updated for processor# ").concat(e.detail.content.processorId)),n(e.detail.content)},{once:!0}),bc({from:t.dat.sessionId,to:t.dat.remoteId,label:msg,data:i})})},Wu=function(){var e=fo(uo().m(function e(t,r,n){var a,i,s,o,c,u,l,h,f,d,m,p,g,v,b,w,y,k,_,A,S,C,x,B,E,I,P,N,O,L,U,j,D,R,V,H,T,$,K,F,M,J,z,q;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.data.label&&t.data.data){e.n=1;break}return wc({data:t.data}),e.a(2);case 1:if(o=[t.data.from,t.data.to,t.data.label,t.data.data],c=r,u=n,o){e.n=2;break}return fc("".concat(t.data," invalid}")),e.a(2);case 2:if("open"==c.readyState){e.n=3;break}return fc("data channel (".concat(c.label,") invalid}")),e.a(2);case 3:l=o[0]||Yo,h=o[1]||Yo,bu(l,o[3],o[2],h),f=o[2],z=f,e.n="tenant:data:ice_offer:content:<ice_offer>"===z?4:"service:drive:content:dir:<file_descs>"===z?5:"tenant:data:action:content:<action>"===z?6:"service:drive:file:chunk:<file_chunk>"===z?42:"tenant:data:processors:content:<processors>"===z?43:"tenant:data:processor:req:<processor_id>"===z?44:"tenant:data:action:content:completed<action>"===z?46:"tenant:data:prediction:setup:<prediction>:received"===z?47:"tenant:data:prediction:train:<prediction>"===z?48:"tenant:data:prediction:train:<prediction>:received"===z?51:"tenant:data:prediction:setup:<prediction>"===z?52:"tenant:data:prediction:unset:<prediction>:received"===z?55:"tenant:data:prediction:unset:<prediction>"===z?56:"tenant:data:ice_offer:content:updated:<ice_offer>"===z?59:"tenant:data:processor:content:<processor>"===z?60:"tenant:data:chunk:content:<bytes>"===z?61:"tenant:data:processor:content:received:<processor>"===z?62:66;break;case 4:return hc("".concat(f," iceoffer by service: ").concat(l)),e.a(3,67);case 5:return hc("".concat(f," acknowledged by service: ").concat(l)),e.a(3,67);case 6:if(!(d=o[3])){e.n=41;break}hc("cmd:",d),u.add_setting(l,d.setting),q=d.command,e.n=q===Wo.Command.values.NONE?7:q===Wo.Command.values.STANDBY?8:q===Wo.Command.values.STOP_RECORDING?9:q===Wo.Command.values.START_RECORDING?11:q===Wo.Command.values.PAUSE_REPLAY?12:q===Wo.Command.values.RESUME_REPLAY?14:q===Wo.Command.values.DELETE_RECORDING?16:q===Wo.Command.values.START_OD?18:q===Wo.Command.values.STOP_OD?20:q===Wo.Command.values.REGISTER_PROCESSOR?22:q===Wo.Command.values.SWITCH_PROCESSOR?24:q===Wo.Command.values.START_OD_DATA_ONLY?26:q===Wo.Command.values.LANDSCAPE_VIEW?27:q===Wo.Command.values.PORTRAIT_VIEW?28:q===Wo.Command.values.START_BINARY?29:q===Wo.Command.values.STOP_BINARY?31:39;break;case 7:return e.a(3,40);case 8:return null==(m=Zo.tenant.subscriptions[l])||m.unsubscribe(),e.a(3,40);case 9:return e.n=10,u.stopRecording(l);case 10:return e.a(3,40);case 11:return u.startRecording(l),e.a(3,40);case 12:return e.n=13,u.stopReplay();case 13:return e.a(3,40);case 14:return e.n=15,u.resumeReplay();case 15:return e.a(3,40);case 16:return e.n=17,u.delRecording();case 17:return e.a(3,40);case 18:return e.n=19,u.enableOD(!0,null,"mediapipe");case 19:return e.a(3,40);case 20:return e.n=21,u.disableOD(!0);case 21:return e.a(3,40);case 22:return e.n=23,u.self_register();case 23:return e.a(3,40);case 24:return e.n=25,Zu(d.setting.processorId,l);case 25:return e.a(3,40);case 26:return null===(a=u.compute)||void 0===a||a.postMessage({ODData:!0,renderOD:!1,renderFrame:!1,status:"ODData|renderOD|renderFrame"}),e.a(3,40);case 27:return null===(i=u.compute)||void 0===i||i.postMessage({landscape:!0,status:"landscape"}),e.a(3,40);case 28:return null===(s=u.compute)||void 0===s||s.postMessage({landscape:!1,status:"landscape"}),e.a(3,40);case 29:if(p=Zo.file_chunks[d.setting.metadata]){e.n=30;break}return hc("invalid file id ".concat(d.setting.metadata,". transmission discarded.")),e.a(2);case 30:return p.totalChunks=d.setting.metadataExt3,p.fileType=d.setting.metadataExt1,p.chunks={},hc("".concat(f," starting transmitting file# ").concat(d.setting.metadata)),(g=Zo.tenant.subscriptions[l]).onLoadSignal&&g.onLoadSignal(d.setting.metadata),e.a(3,40);case 31:if(!(v=Zo.file_chunks[d.setting.metadata])||!v.chunks){e.n=38;break}if((b=Object.keys(v.chunks)).length===v.totalChunks){e.n=32;break}return w={list:[],metadata:d.setting.metadata,metadataExt1:d.setting.metadataExt1,metadataExt2:d.setting.metadataExt2},Mo(b,v.totalChunks).forEach(function(e){w.list.push({chunkId:"".concat(e)})}),bc({from:h,to:l,label:"service:drive:file:chunk:req:<file_chunks>",data:w}),e.a(3,40);case 32:if(!((y=b.filter(function(e){return!v.chunks[e].verified}))>0)){e.n=33;break}return k={list:[],metadata:d.setting.metadata,metadataExt1:d.setting.metadataExt1,metadataExt2:d.setting.metadataExt2},y.forEach(function(e){k.list.push({chunkId:e})}),bc({from:h,to:l,label:"service:drive:file:chunk:req:<file_chunks>",data:k}),e.a(3,40);case 33:return hc("".concat(f," file# ").concat(d.setting.metadata," path: ").concat(d.setting.metadataExt2," totalChunks: ").concat(b.length," transmitted successully")),bc({from:h,to:l,label:"service:drive:file:chunk:del:<file_chunks>",data:{metadata:d.setting.metadata}}),_=b.map(function(e){return v.chunks[e].data}),A=new Blob(_,{type:"application/octet-stream"}),e.n=34,Vu(A);case 34:if(S=e.v,C=S.decompressedData,x=Zo.tenant.subscriptions[l],d.setting.metadataExt1!=Wo.FileType.values.MINIMUM){e.n=36;break}return e.n=35,Ku(C,"/inori/image/mini/".concat(Ko(d.setting.metadataExt2)),!1);case 35:return x.onLoadedMiniSignal&&x.onLoadedMiniSignal(d.setting.metadataExt2),e.a(3,40);case 36:if(!x.onLoadedSignal){e.n=37;break}return e.n=37,x.onLoadedSignal(d.setting.metadata,C);case 37:delete Zo.file_chunks[d.setting.metadata];case 38:return e.a(3,40);case 39:return fc("invalid command# ".concat(d.command)),e.a(2);case 40:return"open"===c.readyState&&bc({from:h,to:l,label:"tenant:data:action:content:completed<action>",data:d}),e.a(3,67);case 41:return e.a(3,67);case 42:return B=o[3],E=Fo(B.chunk),(I=Zo.file_chunks[B.metadata])&&(I.chunks&&(I.chunks[B.chunkId]={data:B.chunk,verified:E===B.checksum}),I.fileType!==Wo.FileType.values.MINIMUM&&(P=Zo.tenant.subscriptions[l]).onLoadingSignal&&P.onLoadingSignal()),e.a(3,67);case 43:return(N=o[3])&&N.list&&(ou(N),hc("".concat(f," by runtime# ").concat(l))),e.a(2);case 44:if(O=o[3]){e.n=45;break}return fc("".concat(f," invalid processor id")),e.a(2);case 45:return L=ku(O),bc({from:h,to:l,label:"tenant:data:processor:content:<processor>",data:L.dat}),e.a(3,67);case 46:return e.a(3,67);case 47:return(U=o[3])&&hc("prediction setup",U,"received by the remote vm"),e.a(3,67);case 48:if(!(j=o[3])){e.n=50;break}return hc("pd: ".concat(JSON.stringify(j))),e.n=49,u.procTrainer(j);case 49:bc({from:Yo,to:l,label:"tenant:data:prediction:train:<prediction>:received",data:R});case 50:return e.a(3,67);case 51:return(D=o[3])&&hc("prediction train ".concat(JSON.stringify(D)," received by the remote vm")),e.a(3,67);case 52:if(!(R=o[3])){e.n=54;break}return hc("pd: ".concat(JSON.stringify(R))),e.n=53,u.configTrainer(R);case 53:bc({from:Yo,to:l,label:"tenant:data:prediction:setup:<prediction>:received",data:R});case 54:return e.a(3,67);case 55:return(V=o[3])&&hc("prediction ".concat(JSON.stringify(V)," setup and vm are received")),e.a(3,67);case 56:if(!(H=o[3])){e.n=58;break}return hc("pd: ".concat(JSON.stringify(H))),e.n=57,u.disableTrainer();case 57:bc({from:Yo,to:l,label:"tenant:data:prediction:unset:<prediction>:received",data:R});case 58:return e.a(3,67);case 59:return gc(t.data),e.a(3,67);case 60:return(T=o[3])&&T.id&&(su(T),bc({from:o[1],to:o[0],label:"tenant:data:processor:content:received:<processor>",data:T})),e.a(3,67);case 61:return $=new Blob([o[3].slice(16).buffer],{type:"image/png"}),K=URL.createObjectURL($),(F=lu(l))&&(F._photo_src=K),e.a(3,67);case 62:return M=lu(Yo),e.n=63,Uu("/inori/photo","image/png",M.id);case 63:if(J=e.v){e.n=64;break}return hc("tenant# ".concat(JSON.stringify(M)," snapshot unavailable.")),e.a(3,67);case 64:return bc({from:Yo,to:l,label:"tenant:data:chunk:content:<bytes>",data:J}),e.n=65,xo();case 65:return u.renderCanvas(Date.now()),e.a(3,67);case 66:return e.a(3,67);case 67:return e.a(2)}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),Zu=function(){var e=fo(uo().m(function e(t,r){var n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(!(n=ku(t))){e.n=3;break}if(!(a=Zo.tenant.subscriptions[r])||!a.peerChannel){e.n=2;break}return a.peerChannel.onmessage=function(e){Wu(e,a.peerChannel,n)},e.n=1,a.subscribe(n);case 1:return e.a(2);case 2:return fc("invalid subscriber:",a),e.a(2);case 3:fc("to_processor:",n,"invalid");case 4:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Gu=function(e){var t=Zo.tenant.processors.find(function(t){return t.dat.name.toLowerCase()==e.toLowerCase()});if(t)return t;t=function(e){return{messageHistory:"",mediaStream:null,videoObj:document.createElement("video"),shadowCtxObj:new OffscreenCanvas(0,0).getContext("2d",{willReadFrequently:!0}),ctxObj:document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),compute:null,trainer:null,isRemoteVideoStream:!1,isLocalVideoStream:!1,isLocalScreenStream:!1,localFileStream:"",isPilotEnabled:!0,isODEnabled:!1,odInitCallback:null,isTrainerSampling:!1,trainerInitCallback:null,trainerDoneCallback:null,frameNo:0,_viewport:[0,0,0,0],_screenshot:"",dat:{name:"".concat(e),remoteId:Yo,sessionId:Yo,screenshot:"",id:window.crypto.randomUUID(),lastUpdate:(new Date).getTime(),width:0,height:0,status:Wo.ProcessorStatus.values.INIT},subscribers:{},peerChannelCallback:null,streamRcvdCallback:null,streamInitCallback:null}}(e),t.get_subscriber=function(e){var r,n,a;e||(e=t.dat.remoteId);var i=(null===(r=t)||void 0===r?void 0:r.subscribers)&&(null===(n=t)||void 0===n?void 0:n.subscribers[null===(a=e)||void 0===a?void 0:a.toLowerCase()]);if(i)return i},t.get_subscribers=function(){return t.subscribers},t.viewport=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t._viewport;return 0==e&&0==r&&0==n&&0==a||(i[0]=Math.max(i[0]+e,0),i[1]=Math.max(i[1]+r,0),i[2]=Math.abs(n||t.dat.width),i[3]=Math.abs(a||t.dat.height)),i},t.reset_viewport=function(){return t._viewport=[0,0,t.dat.width,t.dat.height],t._viewport},t.status=function(e){switch(e&&(t.dat.status=e),t.dat.status){case Wo.ProcessorStatus.values.INIT:return"init";case Wo.ProcessorStatus.values.STOP:return"stop";case Wo.ProcessorStatus.values.STREAM:return"stream";case Wo.ProcessorStatus.values.PAUSE:return"pause";default:return"invalid"}},t.canvasObj=function(e){var r;return null===(r=t.get_subscriber(e))||void 0===r?void 0:r.canvasObj()},t.add_subscriber=function(){var e=fo(uo().m(function e(r){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:return(n={processorId:null,sessionId:r,mediaRecorder:null,recordedChunks:[],peerChannel:null,dataChannel:null,conn:null,mediaStream:new MediaStream,onTerminalSignal:null,onLoadedSignal:null}).Id=function(){var e;return null===(e=n.sessionId)||void 0===e?void 0:e.toLowerCase()},n.processor_id=function(){var e;return null===(e=n.processorId)||void 0===e?void 0:e.toLowerCase()},n.dispose=function(){var e,t;n.processorId=null,n.sessionId=null,n.mediaRecorder=null,n.recordedChunks=null,n.peerChannel=null,n.dataChannel=null,"closed"!=(null===(e=n.conn)||void 0===e?void 0:e.connectionState)&&(null===(t=n.conn)||void 0===t||t.close()),n.conn=null},n.capture_frame=function(e){return Bo(e,n.canvasObj())},n.get_mediaStream=function(){var e,t,r=Au().find(function(e){return e.dat.id==n.processorId});if(!r)return!1;var a=n.mediaStream;if(null==a||null===(e=a.getTracks())||void 0===e||e.forEach(function(e){a.removeTrack(e)}),(null===(t=r.mediaStream)||void 0===t?void 0:t.getAudioTracks().length)>0){var i=r.mediaStream.getAudioTracks()[0];a.addTrack(i)}return r.ctxObj.canvas.captureStream().getTracks().forEach(function(e){return a.addTrack(e)}),a},n.get_4To3_MediaStream=function(){var e,t,r=Au().find(function(e){return e.dat.id==n.processorId});if(!r)return!1;var a=n.mediaStream;if(null==a||null===(e=a.getTracks())||void 0===e||e.forEach(function(e){a.removeTrack(e)}),(null===(t=r.mediaStream)||void 0===t?void 0:t.getAudioTracks().length)>0){var i=r.mediaStream.getAudioTracks()[0];a.addTrack(i)}var s=r.ctxObj.canvas,o=document.createElement("canvas");o.width=640,o.height=480;var c=o.getContext("2d");return function e(){c.fillStyle="black",c.fillRect(0,0,640,480);var t=0,r=0,n=640,a=480;if(640!==s.width||480!==s.height){var i=Math.min(640/s.width,480/s.height);t=(640-(n=s.width*i))/2,r=(480-(a=s.height*i))/2}c.drawImage(s,t,r,n,a),requestAnimationFrame(e)}(),o.captureStream().getTracks().forEach(function(e){return a.addTrack(e)}),a},n.req_processors=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;xo(1e3).then(function(){bc({from:Yo,to:n.sessionId,label:"tenant:data:processors:req:<processors>",data:{totalNumOfPage:0,totalNumPerPage:t,pageIndex:e,list:[]}})})},n.rebootCtrl=fo(uo().m(function e(){var t,r;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=Wo.Command.values.REBOOT_CTRL,r={command:t,setting:{metadata:"/dev/video"}},e.n=1,n.sendAction(r);case 1:return e.a(2,e.v)}},e)})),n.liveStream=function(){var e=fo(uo().m(function e(t,r){var a,i;return uo().w(function(e){for(;;)switch(e.n){case 0:return a=Wo.Command.values.LIVE_STREAM,t.includes("/dev/video")&&(a=Wo.Command.values.START_LIVE_CAM),i={command:a,setting:{metadata:"".concat(t),metadataExt1:r?1:-1}},e.n=1,n.sendAction(i);case 1:return e.a(2,e.v)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),n.stopLiveCam=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.n){case 0:return r=Wo.Command.values.STOP_LIVE_CAM,a={command:r,setting:{metadata:"".concat(t)}},e.n=1,n.sendAction(a);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.publishStream=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if((r=xu(t)).sessionId.toLowerCase()==n.Id()){e.n=1;break}return fc("processor# ".concat(t," is unavailable for subscriber# ").concat(n.Id())),e.a(2);case 1:return a={command:Wo.Command.values.LIVE_PROCESSOR,setting:{metadata:"vision",processorId:r.id}},e.n=2,n.sendAction(a);case 2:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.subscribe_remote=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r=xu(t)){e.n=1;break}return fc("processor# ".concat(t," not found}")),e.a(2);case 1:return a={command:Wo.Command.values.SWITCH_PROCESSOR,setting:{metadata:"vision",processorId:r.id}},e.n=2,n.sendAction(a);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.unsubscribe=function(){var e;Zo.tenant.subscriptions[null===(e=n.Id())||void 0===e?void 0:e.toLowerCase()]=n;for(var t=Au(),r=0;r<t.length;r++)t[r].del_subscriber(n.Id());return n},n.subscribe=function(){var e=fo(uo().m(function e(t){var r,a,i,s,o;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n.unsubscribe(),n.processorId=t.Id(),!n.conn||"connected"!==n.conn.connectionState){e.n=8;break}r=n.conn.getSenders(),a=po(r),e.p=1,s=uo().m(function e(){var r,a,s,o;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if((r=i.value).track){e.n=1;break}return e.a(2,1);case 1:if("audio"==r.track.kind&&(null===(s=t.mediaStream)||void 0===s?void 0:s.getAudioTracks().length)>0&&(a=t.mediaStream.getTracks().find(function(e){return e.kind===r.track.kind})),"video"==r.track.kind&&(a=t.ctxObj.canvas.captureStream().getTracks().find(function(e){return e.kind===r.track.kind})),!a){e.n=5;break}return e.p=2,e.n=3,r.replaceTrack(a);case 3:hc("subscriber# ".concat(n.Id()," replaced ").concat(r.track.kind," track from processor# ").concat(t.Id())),e.n=5;break;case 4:e.p=4,o=e.v,fc("subscriber# ".concat(n.Id()," replacing ").concat(r.track.kind," track exception: ").concat(o));case 5:return e.a(2)}},e,null,[[2,4]])}),a.s();case 2:if((i=a.n()).done){e.n=5;break}return e.d(oo(s()),3);case 3:if(!e.v){e.n=4;break}return e.a(3,4);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,o=e.v,a.e(o);case 7:return e.p=7,a.f(),e.f(7);case 8:return t.subscribers[n.Id().toLowerCase()]=n,e.n=9,xo();case 9:return t.status(Wo.ProcessorStatus.values.STREAM),t.renderCanvas(Date.now()),e.a(2,n)}},e,null,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}(),n.sendAction=function(e){return bc({from:Yo,to:n.sessionId,label:"tenant:data:action:content:<action>",data:e}),new Promise(function(e,t){var r=!1;window.addEventListener("tenant:data:action:content:completed<action>",function(t){hc("sendAction > received ".concat(t.detail)),r=!0,e(!0)},{once:!0}),xo(5e3).then(function(){r||e(!1)})})},e.n=1,n.subscribe(t);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.peer_channel=function(e){var r;return null===(r=t.get_subscriber(e))||void 0===r?void 0:r.peerChannel},t.data_channel=function(e){var r;return null===(r=t.get_subscriber(e))||void 0===r?void 0:r.dataChannel},t.conn=function(e){var r;return null===(r=t.get_subscriber(e))||void 0===r?void 0:r.conn},t.del_subscriber=function(e){t.get_subscriber(e)&&(delete t.subscribers[e.toLowerCase()],hc("subscriber# ".concat(e," removed from processor# ").concat(t.dat.id)))},t.add_conn=function(){var e=fo(uo().m(function e(r){var n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(n=t.get_subscriber(r)){e.n=2;break}return e.n=1,t.add_subscriber(r);case 1:n=e.v;case 2:if(!n.conn||"connected"!==n.conn.connectionState){e.n=3;break}return n.conn.getSenders().forEach(function(e){n.conn.removeTrack(e)}),n.conn.getReceivers().forEach(function(e){e.track&&e.track.stop()}),e.a(2,n.conn);case 3:return(a=Mu()).addEventListener("negotiationneeded",function(e){hc("**** negotiation is needed.")}),a.addEventListener("connectionstatechange",function(){var e=fo(uo().m(function e(i){var s;return uo().w(function(e){for(;;)switch(e.n){case 0:hc("status changed: ".concat(a.connectionState," subscriber# ").concat(r," processor# ").concat(t.dat.id)),s=a.connectionState,e.n="new"===s||"connecting"===s?1:"connected"===s?2:"disconnected"===s||"failed"===s||"closed"===s?3:6;break;case 1:case 2:case 6:return e.a(3,7);case 3:return e.n=4,xo(2e4);case 4:if("connected"!=a.connectionState){e.n=5;break}return e.a(2);case 5:return n.unsubscribe(),n.dispose(),e.a(3,7);case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),!1),n.conn=a,e.a(2,a)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.add_peer_channel=function(e,r){var n=t.get_subscriber(e);if(n)return n.peerChannel=r,Go[e]=r,n},t.add_setting=function(e,r){var n=t.get_subscriber(e);if(n)return n.setting=r,n},t.add_data_channel=function(e,r){var n=t.get_subscriber(e);if(n)return n.dataChannel=r,n},t.Id=function(){return t.dat.id.toLowerCase()},t.stopReplay=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.reset();case 1:return e.a(2)}},e)})),t.resumeReplay=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.reset();case 1:return e.a(2,t.playRecording(t.localFileStream))}},e)})),t.playRecording=function(){var e=fo(uo().m(function e(r){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,ju(r);case 1:return n=e.v,t.set_mediaStream(n,!1),t.localFileStream=r,e.a(2,!0);case 2:return e.p=2,a=e.v,fc("playRecording > _read_video_obj > err: ".concat(a)),e.a(2,!1)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),t.startRecording=function(e){try{var r=t.get_subscriber(e);if(!r)throw"invalid subscription# ${remote_id}";var n=r.get_mediaStream(e);r.mediaRecorder=new MediaRecorder(n,{mimeType:"video/webm; codecs=vp9"}),r.recordedChunks=[],r.mediaRecorder.ondataavailable=function(e){e.data.size>0&&r.recordedChunks.push(e.data)},r.mediaRecorder.start()}catch(e){fc("error stream recording: ".concat(e))}},t.stopRecording=function(e){return new Promise(function(r,n){var a=t.get_subscriber(e);if("inactive"!==a.mediaRecorder.state){var i=!1;a.mediaRecorder.onstop=fo(uo().m(function e(){var t,n,s,o;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=new Blob(a.recordedChunks,{type:"video/webm"}),n=window.crypto.randomUUID(),s="/inori/video/".concat(n),e.n=1,$u(t,s);case 1:return a.recordedChunks=[],(o=Gu("record_".concat(n.split("-")[0]))).streamInitCallback=function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,o.self_register();case 1:e.n=4;break;case 2:return e.p=2,r=e.v,e.n=3,yu(o);case 3:fc("mediaRecorder.onstop > streamInitCallback > self_register ".concat(r));case 4:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),e.n=2,o.playRecording(s);case 2:r(!0),i=!0,a.mediaRecorder=null;case 3:return e.a(2)}},e)})),a.mediaRecorder.stop(),xo(1e4).then(function(){i||r(!1)})}})},t.delRecording=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Nu(t.localFileStream);case 1:return e.a(2)}},e)})),t.capture_frame=function(e){return Bo(e,t.videoObj)},t.retain_screenshot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.videoObj;t._screenshot=function(e){if(e.videoWidth&&e.videoHeight){var t=e.videoWidth/e.videoHeight,r=document.createElement("canvas");r.width=100,r.height=100/t;var n=r.getContext("2d",{willReadFrequently:!0});n.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,r.width,r.height),n.getImageData(0,0,r.width,r.height);var a=n.canvas.toDataURL("image/jpeg");return r=null,n=null,a}}(e)},t.screenshot=function(){return t._screenshot},t.disableTrainer=function(){var e=fo(uo().m(function e(r){return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.isTrainerSampling=!1,t.trainer){e.n=1;break}return e.a(2);case 1:return e.n=2,t.delTrainer();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.disableOD=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.isODEnabled){e.n=1;break}return e.a(2);case 1:return t.isODEnabled=!1,e.n=2,t.delWorker();case 2:return e.a(2)}},e)})),t.pauseTrainer=fo(uo().m(function e(){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:return n={req:"pause"},null===(r=t.trainer)||void 0===r||r.postMessage(n),e.n=2,xo();case 2:return e.a(2)}},e)})),t.resumeTrainer=fo(uo().m(function e(){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:return n={req:"resume"},null===(r=t.trainer)||void 0===r||r.postMessage(n),e.n=2,xo();case 2:return e.a(2)}},e)})),t.enableTrainer=fo(uo().m(function e(){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(!t.trainer){e.n=1;break}return e.a(2);case 1:return t.trainer=new Worker("workers/trainer.".concat("min.","js")),e.n=2,xo(3e3);case 2:return t.setTrainerEvent(),n={id:window.crypto.randomUUID().toLowerCase(),req:"bootstrap"},null===(r=t.trainer)||void 0===r||r.postMessage(n),e.n=3,xo();case 3:return e.a(2)}},e)})),t.configTrainer=function(){var e=fo(uo().m(function e(r){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.n=1,t.enableTrainer();case 1:return n={bound:r.bbox,objective:r.class,req:"config"},t.trainer.postMessage(n),e.n=2,xo();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.sampleTrainer=function(){var e=fo(uo().m(function e(r,n,a){var i;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:i={source:r,metric:n,tag:a,req:"collect"},t.trainer.postMessage(i);case 2:return e.a(2)}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),t.resumeSampleTrainer=fo(uo().m(function e(){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2,!1);case 1:r={source:_imgData,metric:_metric,tag:_tag,req:"collect"},t.trainer.postMessage(r);case 2:return e.a(2)}},e)})),t.procTrainer=fo(uo().m(function e(){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.trainer){e.n=1;break}return e.a(2);case 1:return r={req:"train"},t.trainer.postMessage(r),e.n=2,xo();case 2:return e.a(2)}},e)})),t.enableOD=fo(uo().m(function e(){var r,n,a,i,s,o=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:r=o.length>0&&void 0!==o[0]&&o[0],n=o.length>1?o[1]:void 0,a=o.length>2&&void 0!==o[2]?o[2]:"coco-ssd",t.compute,i={tm:n,width:t.dat.width,height:t.dat.height,ODData:!1,renderOD:!1,renderFrame:!1,landscape:!1,status:"bootstrap"},r?(i.ODData=!0,t.isLocalVideoStream||t.isLocalScreenStream||t.localFileStream?i.renderFrame=!0:i.renderFrame=!1,i.renderOD=!1):(i.renderOD=!0,i.ODData=!1),s=a,e.n="mediapipe"===s?1:2;break;case 1:return t.compute=new Worker("workers/compute-mediapipe.".concat("min.","js"),{type:"module"}),e.a(3,3);case 2:t.compute=new Worker("workers/compute-coco-ssd.".concat("min.","js"),{type:"module"});case 3:return t.setVisionEvent(i),e.a(2,new Promise(function(e,r){var n=!1;t.odInitCallback=function(t){e(!0),n=!0,hc("object detection lauched")},xo(1e4).then(function(){n||e(!1)})}))}},e)})),t.renderCanvas=function(){var e=fo(uo().m(function e(r){var n,a,i,s,o,c,u,l,h,f;return uo().w(function(e){for(;;)switch(e.n){case 0:if(0!=(null===(n=t.dat)||void 0===n?void 0:n.width)&&0!=(null===(a=t.dat)||void 0===a?void 0:a.height)){e.n=1;break}return fc("processor# ".concat(t.Id()," returns on invalid render size}")),e.a(2);case 1:if("pause"!=t.status()){e.n=4;break}return e.n=2,t.disableOD();case 2:return e.n=3,t.disableTrainer();case 3:return hc("processor# ".concat(t.Id()," paused")),e.a(2);case 4:if(1==t.frameNo&&(i=t.capture_frame(150),t._screenshot=i,t.streamInitCallback&&t.streamInitCallback(i),t.streamInitCallback=null),t.isLocalScreenStream||t.isLocalVideoStream)t.shadowCtxObj&&t.shadowCtxObj.drawImage(t.videoObj,0,0,t.dat.width,t.dat.height),s=null===(o=t.shadowCtxObj)||void 0===o?void 0:o.getImageData.apply(o,mo(t.viewport()));else try{u=t.videoObj.videoWidth/t.videoObj.videoHeight,l=t.shadowCtxObj.canvas.width,h=t.shadowCtxObj.canvas.width/u,t.viewport()[3]=h,t.shadowCtxObj.canvas.height=h,t.shadowCtxObj.drawImage(t.videoObj,0,0,t.videoObj.videoWidth,t.videoObj.videoHeight,0,0,l,h),s=null===(c=t.shadowCtxObj)||void 0===c?void 0:c.getImageData(0,0,l,h)}catch(e){hc("_p.renderCanvas err: ".concat(e," processor: ").concat(t.Id()," paused")),t.status(Wo.ProcessorStatus.values.PAUSE)}t.frameNo++,t.isTrainerSampling&&t.sampleTrainer(s,null,null),t.isODEnabled?null===(f=t.compute)||void 0===f||f.postMessage(s):(Object.values(t.subscribers||[]).length<1&&t.frameNo>1&&t.status(Wo.ProcessorStatus.values.PAUSE),t.ctxObj.canvas.width=t.viewport()[2],t.ctxObj.canvas.height=t.viewport()[3],s&&t.ctxObj.putImageData(s,0,0),requestAnimationFrame(function(){var e=fo(uo().m(function e(r){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.renderCanvas(r);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}()));case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t.delWorker=fo(uo().m(function e(){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return null===(r=t.compute)||void 0===r||r.postMessage({status:"dispose"}),e.n=1,xo();case 1:return null===(n=t.compute)||void 0===n||n.terminate(),e.n=2,xo();case 2:delete t.compute;case 3:return e.a(2)}},e)})),t.delTrainer=fo(uo().m(function e(){var r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return null===(r=t.trainer)||void 0===r||r.postMessage({req:"dispose"}),e.n=1,xo();case 1:return null===(n=t.trainer)||void 0===n||n.terminate(),e.n=2,xo();case 2:delete t.trainer;case 3:return e.a(2)}},e)})),t.deinit=fo(uo().m(function e(){var r,n,a,i;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.subscribers)for(r=0,n=Object.entries(t.subscribers);r<n.length;r++)a=co(n[r],2),i=a[0],a[1],t.del_subscriber(i);return delete t.subscribers,delete t.videoObj,delete t.shadowCtxObj,delete t.mediaRecorder,e.n=1,t.disableOD();case 1:return e.n=2,t.disableTrainer();case 2:return e.a(2)}},e)})),t.reset=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:return delete t.mediaStream,delete t.videoObj,delete t.shadowCtxObj,e.n=1,t.disableOD();case 1:return e.n=2,t.disableTrainer();case 2:t.isTrackShared=!1,t.isLocalVideoStream=!1,t.isLocalScreenStream=!1,t.isPilotEnabled=!0,t.isODEnabled=!1,t.isTrainerSampling=!1,t.frameNo=2,delete t.peerChannelCallback,delete t.streamInitCallback,t.videoObj=document.createElement("video"),t.shadowCtxObj=new OffscreenCanvas(t.dat.width,t.dat.width).getContext("2d",{willReadFrequently:!0}),t.status(Wo.ProcessorStatus.values.STOP);case 3:return e.a(2)}},e)})),t.stop_mediaStream=function(){var e,r;(null===(e=t.mediaStream)||void 0===e?void 0:e.getTracks)&&(null===(r=t.mediaStream)||void 0===r||null===(r=r.getTracks())||void 0===r||r.forEach(function(e){var r;e.stop(),null===(r=t.mediaStream)||void 0===r||r.removeTrack(e)})),delete t.mediaStream},t.set_mediaStream=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.videoObj?(t.videoObj.addEventListener("play",function(e){var r,n;if(t.videoObj){var a=null===(r=t.videoObj)||void 0===r?void 0:r.videoWidth,i=null===(n=t.videoObj)||void 0===n?void 0:n.videoHeight;t.dat.width=a,t.dat.height=i,t.viewport(0,0,a,i),t.shadowCtxObj.canvas.width=a,t.shadowCtxObj.canvas.height=i,t.status(Wo.ProcessorStatus.values.STREAM),t.renderCanvas(Date.now())}else hc("processor has been terminated")},{once:!0}),t.videoObj.autoplay=!0,r?t.videoObj.srcObject=e:(t.videoObj.loop=!0,t.videoObj.src=e),t.mediaStream=e):hc("processor has been terminated")},t.self_register=function(){return new Promise(function(e,r){var n="tenant:data:processor:content:received:<processor>:".concat(t.Id()),a=!1;window.addEventListener(n,function(r){var n=r.detail.content;hc("processor request: ".concat(n.id," received.")),t.dat=n,t.dat.lastUpdate=(new Date).getTime(),a=!0,Zo.remote_processor_list.list.push(n),e(t)},{once:!0}),t.dat.sessionId=Yo;var i="tenant:data:processor:content:<processor>";gc({to:t.dat.sessionId,label:i,data:t.dat}),xo(2e4).then(function(){a||(window.removeEventListener(n,function(e){fc("".concat(i," > timeout"))}),r(!1))})})},t.share_camera=function(){var e=fo(uo().m(function e(r){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!r){e.n=1;break}n=r,e.n=3;break;case 1:return e.n=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 2:n=e.v;case 3:if(n){e.n=4;break}return e.a(2,!1);case 4:return t.set_mediaStream(n),t.isLocalVideoStream=!0,e.a(2,!0);case 5:return e.p=5,a=e.v,fc("Error accessing media devices.",a),e.a(2,!1)}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),t.share_screen=function(){var e=fo(uo().m(function e(r){var n,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!r){e.n=1;break}n=r,e.n=3;break;case 1:return e.n=2,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});case 2:n=e.v;case 3:if(n){e.n=4;break}return e.a(2,!1);case 4:return t.set_mediaStream(n),t.isLocalScreenStream=!0,e.a(2,!0);case 5:return e.p=5,a=e.v,fc("Error accessing media devices.",a),e.a(2,!1)}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),t.resp2RemoteStream=function(){var e=fo(uo().m(function e(r){var n,a,i,s=arguments;return uo().w(function(e){for(;;)if(0===e.n)return a=[],i=(n=!(s.length>1&&void 0!==s[1])||s[1])?r.uid:t.dat.remoteId,e.a(2,new Promise(function(){var e=fo(uo().m(function e(s,o){var c,u,l,h,f,d;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,t.add_conn(i);case 1:return(c=e.v).addEventListener("icecandidate",function(e){e.candidate&&a.push(e.candidate)}),n&&(u=t.get_subscriber(i))&&(l=u.get_4To3_MediaStream()).getTracks().forEach(function(e){c.addTrack(e,l)}),c.addEventListener("datachannel",function(e){t._onRemoteDataChannel(e,i)}),c.addEventListener("track",function(e){t._onRemoteStream(e,i)}),h=r,f=JSON.parse(atob(h.metadata)),e.a(2,c.setRemoteDescription(f).then(function(e){return c.createAnswer().then(function(e){if(c.addEventListener("icegatheringstatechange",function(r){switch(hc("resp2RemoteStream > _conn.iceGatheringState: ".concat(c.iceGatheringState)),c.iceGatheringState){case"new":case"gathering":return;case"complete":h.candidates.forEach(function(e){if(e.isOffer){var t=JSON.parse(atob(e.metadata));c.addIceCandidate(t)}});var n=zu(h,e,a);if(!n)return o("invalid answer");hc("finalise offer# ".concat(n.id," for processor# ").concat(t.Id())),s(n)}}),c.setLocalDescription(e),0==h.candidates.length){var r=zu(h,e,[]);return r?(hc("finalise offer# ".concat(r.id," for processor# ").concat(t.Id())),s(r)):o("invalid answer")}})}).catch(function(e){fc("initRemoteAnswer err: ",e),c.close()}));case 2:e.p=2,d=e.v,s(!1),fc(d);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()))},e)}));return function(t){return e.apply(this,arguments)}}(),t.req2RemoteStream=function(){try{return gc({from:t.dat.sessionId,to:t.dat.remoteId,label:"tenant:data:ice_offer:req:<processor_id>",data:t.Id()}),new Promise(function(e,r){var n="tenant:data:ice_offer:content:<ice_offer>:".concat(t.Id());window.addEventListener(n,function(){var r=fo(uo().m(function r(n){var a,i,s;return uo().w(function(r){for(;;)switch(r.p=r.n){case 0:return a=n.detail.content,r.p=1,r.n=2,t.resp2RemoteStream(a,!1);case 2:(i=t.get_subscriber(t.dat.remoteId))&&(Zo.tenant.subscriptions[i.Id()]=i),e(!0),r.n=5;break;case 3:return r.p=3,s=r.v,fc("req2RemoteStream > err: ".concat(s)),r.n=4,yu(t);case 4:e(!1);case 5:return r.a(2)}},r,null,[[1,3]])}));return function(e){return r.apply(this,arguments)}}())})}catch(e){fc(e)}},t.resp2StreamReq=function(){var e=fo(uo().m(function e(r){var n,a,i,s,o,c,u,l,h;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=[],e.p=1,e.n=2,t.add_conn(r);case 2:if((i=e.v).addEventListener("icecandidate",function(e){null!=e.candidate?n.push(e.candidate):hc("icecandidate finalised")}),i.addEventListener("track",function(e){}),!(s=t.get_subscriber(r))){e.n=4;break}if((o=s.get_4To3_MediaStream()).getTracks().forEach(function(e){i.addTrack(e,o)}),c=i.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),c){e.n=3;break}return e.a(2,reje("expected a video transceiver after addTrack()"));case 3:u=RTCRtpSender.getCapabilities("video").codecs,l=u.filter(function(e){return"video/h264"===e.mimeType.toLowerCase()||"video/rtx"===e.mimeType.toLowerCase()&&/apt=\d+/.test(e.sdpFmtpLine)}),c.setCodecPreferences(l);case 4:return a=i.createDataChannel("ProcessorData",{ordered:!0}),t.add_peer_channel(r,a),a.binaryType="arraybuffer",a.addEventListener("open",fo(uo().m(function e(){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:hc("channel: ".concat(a.label," opened")),a.onmessage=function(e){Wu(e,a,t)},t.dat.lastUpdate=(new Date).getTime(),(n=Au().filter(function(e){return e.dat.sessionId==Yo&&(e.isLocalScreenStream||e.isLocalVideoStream)}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}))&&bc({from:t.dat.sessionId,to:r,label:"tenant:data:processors:content:<processors>",data:{list:n}});case 1:return e.a(2)}},e)})),{once:!0}),a.addEventListener("close",fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:hc("channel: ".concat(a.label," closed. closing conn..")),s.unsubscribe();case 1:return e.a(2)}},e)})),{once:!0}),e.a(2,i.createOffer({offerToReceiveVideo:1}).then(function(e){return new Promise(function(a,s){i.setLocalDescription(e).then(function(o){i.addEventListener("icegatheringstatechange",function(){var e=fo(uo().m(function e(r){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:hc("icegatheringstatechange: ".concat(r.target.iceGatheringState)),n=r.target.iceGatheringState,e.n="new"===n||"complete"===n?1:"gathering"===n?2:4;break;case 1:case 4:return e.a(2);case 2:return e.n=3,xo(2e3);case 3:return i.dispatchEvent(new CustomEvent("local:connect:icecandidate:complete:".concat(t.Id()),{})),e.a(3,4)}},e)}));return function(t){return e.apply(this,arguments)}}()),i.addEventListener("local:connect:icecandidate:complete:".concat(t.Id()),function(o){t.dat.remoteId=r,Ju(t,e,n).then(function(e){if(hc("register local offer:",e),e&&""!=e.answer&&e.candidates.length>0){var t=JSON.parse(atob(e.answer));return i.setRemoteDescription(t).then(function(t){e.candidates.forEach(function(e){if(!e.isOffer){var t=JSON.parse(atob(e.metadata));i.addIceCandidate(t)}}),a(e)})}}).catch(function(e){s(e)})},{once:!0})})})}));case 5:e.p=5,h=e.v,fc(h);case 6:return e.a(2)}},e,null,[[1,5]])}));return function(t){return e.apply(this,arguments)}}(),t.liveStream=function(e,r){gc({label:"service:stream:live:req:<service>",to:e,data:{sessionId:t.dat.remoteId,metadata:r}})},t.publishStream=function(){var e=fo(uo().m(function e(r){var n,a,i,s,o,c;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=[],e.p=1,e.n=2,t.add_conn(r);case 2:if((i=e.v).addEventListener("icecandidate",function(e){null!=e.candidate?n.push(e.candidate):hc("icecandidate finalised")}),s=t.get_subscriber(r)){e.n=3;break}return e.a(2,!1);case 3:return(o=s.get_4To3_MediaStream()).getTracks().forEach(function(e){i.addTrack(e,o)}),a=i.createDataChannel("ProcessorData",{ordered:!0}),t.add_peer_channel(r,a),a.binaryType="arraybuffer",a.addEventListener("open",fo(uo().m(function e(){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:hc("channel: ".concat(a.label," opened")),a.onmessage=function(e){Wu(e,a,t)},t.dat.lastUpdate=(new Date).getTime(),(n=Au().filter(function(e){return e.dat.sessionId==Yo}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}))&&bc({from:t.dat.sessionId,to:r,label:"tenant:data:processors:content:<processors>",data:{list:n}});case 1:return e.a(2)}},e)})),{once:!0}),a.addEventListener("close",fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:hc("channel: ".concat(a.label," closed. closing conn..")),s.unsubscribe();case 1:return e.a(2)}},e)})),{once:!0}),e.a(2,i.createOffer({offerToReceiveVideo:1}).then(function(e){return new Promise(function(a,s){i.setLocalDescription(e).then(function(o){i.addEventListener("local:connect:icecandidate:complete:".concat(t.Id()),function(o){t.dat.remoteId=r,Ju(t,e,n).then(function(e){if(hc("register local offer:",e),e&&""!=e.answer&&e.candidates.length>0){var t=JSON.parse(atob(e.answer));i.setRemoteDescription(t).then(function(t){e.candidates.forEach(function(e){if(!e.isOffer){var t=JSON.parse(atob(e.metadata));i.addIceCandidate(t)}}),a(e)})}}).catch(function(e){s(e)})},{once:!0}),i.addEventListener("icegatheringstatechange",function(){var e=fo(uo().m(function e(r){var n;return uo().w(function(e){for(;;)switch(e.n){case 0:hc("icegatheringstatechange: ".concat(r.target.iceGatheringState)),n=r.target.iceGatheringState,e.n="new"===n||"complete"===n?1:"gathering"===n?2:4;break;case 1:case 4:return e.a(2);case 2:return e.n=3,xo(2e3);case 3:return i.dispatchEvent(new CustomEvent("local:connect:icecandidate:complete:".concat(t.Id()),{})),e.a(3,4)}},e)}));return function(t){return e.apply(this,arguments)}}())})})}));case 4:e.p=4,c=e.v,fc(c);case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),t.setTrainerEvent=function(){t.trainer.onmessage=function(e){if(e.data.conf&&"initialised"==e.data.conf.summary.status)return hc("processor# ".concat(t.Id()," trainer initialised")),t.trainer.onmessage=function(){var e=fo(uo().m(function e(r){var n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:if(r.data){e.n=1;break}return fc("empty message received"),e.a(2);case 1:a=r.data.req,e.n="status"===a?2:"pause"===a?3:"resume"===a?4:"collect"===a?5:"train"===a?6:"dispose"===a?10:"config"===a?11:12;break;case 2:return hc("current config:",r.data.conf),e.a(3,13);case 3:return"paused"==r.data.conf.summary.status&&(t.isTrainerSampling=!1),e.a(3,13);case 4:return hc("trainer resumes sampling",r.data.conf),t.isTrainerSampling=!0,e.a(3,13);case 5:return hc("data collected",r.data.conf),e.a(3,13);case 6:if(t.isTrainerSampling=!1,n=r.data.conf,hc("model trained",n),!n.summary.modelBlob||!n.summary.weightsBlob){e.n=9;break}return e.n=7,Fu(n.summary.modelBlob,"/inori/model/json/".concat(n.id));case 7:return e.n=8,Fu(n.summary.weightsBlob,"/inori/model/weight/".concat(n.id));case 8:t.trainerDoneCallback&&t.trainerDoneCallback(n);case 9:return e.a(3,13);case 10:return t.isTrainerSampling=!1,hc("trainer disposed",r.data.conf),e.a(3,13);case 11:return hc("config acknowledged:",r.data.conf),t.isTrainerSampling=!0,e.a(3,13);case 12:return hc("unknown message:",r.data.reply),e.a(3,13);case 13:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),void(t.trainerInitCallback&&t.trainerInitCallback(e.data.conf))}},t.setVisionMPEvent=function(e){var r=document.createElement("iframe");r.onload=function(){t.setVisionEvent(e)},r.src="mediapipe.html",r.width=0,r.height=0,r.frameborder=0,document.body.appendChild(r)},t.setVisionEvent=function(e){t.compute||fc("_p.compute: channel invalid"),t.compute.onmessage=function(e){if(e.data.status&&"initialised"==e.data.status){hc("processor# ".concat(t.Id()," vision initialised"));var r=function(e,r){if(t&&t.subscribers)for(var n=0,a=Object.entries(t.subscribers);n<a.length;n++){var i,s=co(a[n],2),o=s[0],c=s[1],u=c.peerChannel;"open"==(null==u?void 0:u.readyState)&&null!==(i=c.setting)&&void 0!==i&&i.isOd&&bc({from:t.dat.sessionId,to:o,label:"tenant:data:predictions:content:<predictions>",data:{list:e,width:r.width,height:r.height,frameNo:t.frameNo}})}};return t.compute.onmessage=function(e){var n;if((null===(n=e.data)||void 0===n?void 0:n.length)>1)if(e.data[2],e.data[0]instanceof ImageData)Array.isArray(e.data[1])&&e.data[1].length>0&&r(e.data[1],e.data[2]),t.putImageData(e.data[0],0,0,t.viewport()[2],t.viewport()[3]).then(function(){var e=fo(uo().m(function e(r){return uo().w(function(e){for(;;)switch(e.n){case 0:r||t.status(Wo.ProcessorStatus.values.PAUSE);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());else{if(!Array.isArray(e.data[1]))return void hc("non-frame message received:",e.data);e.data[1].length>0&&r(e.data[1],e.data[2])}else{if("object"!==so(e.data))return void fc("invalid message received:",e.data);hc("compute message received:",e.data)}t.renderCanvas(Date.now())},t.isODEnabled=!0,t.odInitCallback&&t.odInitCallback(e.data),void t.renderCanvas(Date.now())}},t.compute.postMessage(e)},t._onRemoteDataChannel=function(e,r){hc("onRemoteDataChannel: ".concat(JSON.stringify(e)));var n=e.channel;"ProcessorData"===n.label&&(n.onmessage=function(e){Wu(e,n,t)}),n.binaryType="arraybuffer",n.addEventListener("close",function(){var e;hc("channel: ".concat(n.label," closed. closing conn..")),null===(e=t.conn(r))||void 0===e||e.close()},{once:!0}),n.addEventListener("open",function(){hc("channel: ".concat(n.label," opened.")),"ProcessorData"===n.label?t.add_peer_channel(r,n):t.add_data_channel(r,n),t.peerChannelCallback&&t.peerChannelCallback(n),t.peerChannelCallback=null},{once:!0})},t._onRemoteStream=function(){var e=fo(uo().m(function e(r,n){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!r.streams||!r.streams[0]){e.n=1;break}t.set_mediaStream(r.streams[0]),t.streamRcvdCallback&&t.streamRcvdCallback(r.streams[0]),e.n=2;break;case 1:return fc("invalid remote stream"),e.a(2);case 2:hc("processing remote stream");case 3:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Zo.tenant.processors.push(t);var r=Au().filter(function(e){return!e.dat.name.includes("preview")}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat});return r&&Object.values(Zo.tenant.subscriptions).forEach(function(e){e.conn&&"connected"===e.conn.connectionState&&bc({from:Yo,to:e.Id(),label:"tenant:data:processors:content:<processors>",data:{list:r}})}),t},Qu=function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=FS.readdir("/inori/model/json"),r=t.slice(2).map(function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Yu(t);case 1:if(r=e.v){e.n=2;break}return e.a(2);case 2:return hc("_model# ".concat(r.tid.val)),e.a(2,r)}},e)}));return function(t){return e.apply(this,arguments)}}()),e.n=1,Promise.all(r);case 1:return n=e.v,e.a(2,n.filter(function(e){return e}))}},e)}));return function(){return e.apply(this,arguments)}}(),Yu=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Uu("/inori/model/json/".concat(t),"application/json");case 1:return r=e.v,n=new TextDecoder("utf-8"),a=n.decode(r),i=JSON.parse(a),e.n=2,Uu("/inori/model/weight/".concat(t),"application/octet-stream");case 2:return s=e.v,i.weightData=s,i.tid=t,e.a(2,i)}},e)}));return function(t){return e.apply(this,arguments)}}(),Xu={get:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Zo.content.content;return e>-1?t&&t[e]:t&&t[Xu.getIndex()]},getAll:function(){return Zo.content.content},setIndex:function(e){Zo.content.contentIndex=e},getIndexByName:function(e){return Zo.content.content.indexOf(e)},getIndex:function(){return Zo.content.contentIndex},getL1:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Zo.content.contentL1[Xu.getIndex()];return e>-1?t&&t[e]:t&&t[Xu.getL1Index()]},getAllL1:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Zo.content.contentL1[Xu.getIndex()]:Zo.content.contentL1[e]},setL1Index:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t<0?Zo.content.contentL1Index[Xu.getIndex()]=e:Zo.content.contentL1Index[t]=e},getL1Index:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Zo.content.contentL1Index[Xu.getIndex()]:Zo.content.contentL1Index[e]},getL2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=Zo.content.contentL2&&Zo.content.contentL2[Xu.getIndex()];return e>-1?t&&t[e]:t&&t[Xu.getL1Index()]},getAllL2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return e<0?Zo.content.contentL2&&Zo.content.contentL2[Xu.getIndex()]:Zo.content.contentL2&&Zo.content.contentL2[e]},getAllL3:function(){return Zo.content.contentL3},getX509Sbj:function(){return Zo.content.contentX509}},el=function(){var e=fo(uo().m(function e(t){var r,n,a,i,s,o,c,u,l,h,f,d,m,p,g,v,b,w,y,k,_,A,S,C,x,B,E,I,P,N,O,L,U,j,D,R,V,H,T,$,K;return uo().w(function(e){for(;;)switch(e.n){case 0:if(t.data.label){e.n=1;break}return fc("".concat(t.data," invalid}")),e.a(2);case 1:ec.has(t.data.label)||ec.set(t.data.label,[]),r=ec.get(t.data.label),t.data.last_update=Date.now(),r.push(t.data),n=[t.data.from,t.data.to,t.data.label,t.data.data],a=n[0]||Yo,i=n[1]||Yo,bu(a,n[3],n[2],i),s=n[2].split(":"),E=s[0],e.n="admin"===E?2:"tenant"===E?27:"guest"===E?61:"local"===E?68:110;break;case 2:I=s[1],e.n="heartbeat"===I?3:"data"===I?4:"system"===I?17:25;break;case 3:return hc("".concat(s.join(":")," by admin")),e.a(2);case 4:P=s.slice(2).join(":"),e.n="geos:content:<geo_locations>"===P?5:"tenant:content:received:<tenant>"===P?6:"subjects:content:<subjects>"===P?7:"ice_servces:content:<ice_services>"===P?8:"ice_offers:content:<ice_offers>"===P?9:"ice_offers:content:received:<ice_offers>"===P?10:"ice_offer:content:<ice_offer>"===P?11:"invalid_content"===P||"invalid_cred"===P?12:"message_info:content:<message_info>:received"===P?13:"message_infos:content:<message_infos>"===P?14:15;break;case 5:return hc("".concat(s.join(":")," sent by bridge")),Zo.geo_locations=n[3],e.a(3,16);case 6:return hc("".concat(s.join(":")," acknowledged by admin")),e.a(3,16);case 7:return hc("".concat(s.join(":")," sent by bridge")),Zo.subjects=n[3],e.a(3,16);case 8:return hc("".concat(s.join(":")," sent by bridge")),Zo.ice_services=n[3],e.a(3,16);case 9:return e.a(3,16);case 10:return o=n[3],Zo.ice_offers=o,e.a(3,16);case 11:return e.a(3,16);case 12:return hc("".concat(s.join(":")," by cell")),e.a(2);case 13:return Zo.message_infos.list=Zo.message_infos.list.filter(function(e){return e.code!=n[3].code}),Zo.message_infos.list.push(n[3]),e.a(2);case 14:return hc("".concat(s.join(":")," upd msg bus in util")),Zo.message_infos=n[3],e.a(2);case 15:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 16:return e.a(3,26);case 17:N=s.slice(2).join(":"),e.n="profile:metric:<bytes>:confirmed"===N?18:"event:timeout"===N||"event:notice"===N?19:"received:<string>"===N||"event:service:<string>"===N?20:"event:tenant_online"===N||"event:tenant_offline"===N||"event:tenant_exit"===N||"event:tenant_exit:received"===N?21:"error:<string>"===N?22:23;break;case 18:try{c=(new TextDecoder).decode(n[3]),u=JSON.parse(c),hc("".concat(s.join(":"),":"),u)}catch(e){l=new Blob([n[3]],{type:"application/octet-stream"}),h=URL.createObjectURL(l),(f=document.createElement("a")).href=h,f.download="profile.pprof",f.click(),URL.revokeObjectURL(h)}return e.a(3,24);case 19:return e.a(3,24);case 20:return hc("".concat(s.join(":")," > ").concat(n[3])),e.a(3,24);case 21:return hc("".concat(s.join(":")," by ").concat(a)),e.a(3,24);case 22:return fc("".concat(s.join(":")," > ").concat(n[3])),e.a(3,24);case 23:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 24:return e.a(3,26);case 25:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 26:return e.a(3,111);case 27:O=s[1],e.n="data"===O?28:59;break;case 28:L=s.slice(2).join(":"),e.n="x509:content:received:<subject>"===L?29:"x509:content:<subject>"===L?30:"chunk:root_cert:<bytes>"===L?31:"chunk:pub_key:signed:<bytes>"===L?34:"leads:content:<leads>"===L?35:"ice_offer:req:<processor_id>"===L?36:"processor:delete:<processor_id>:received"===L?39:"processor:delete:<processor_id>"===L?41:"ice_offer:content:<ice_offer>"===L?45:"ice_offer:content:updated:<ice_offer>"===L||"ice_offer:content:answered:<ice_offer>"===L?49:"processor:content:<processor>"===L?51:"processor:content:received:<processor>"===L?52:"tenants:content:<active_tenants>"===L?54:"channels:list:<rtmp_channels>"===L?56:57;break;case 29:return hc("received ".concat(s.join(":"))),e.a(2);case 30:return Ic(n[3])||fc("failed updating license info for tenant: ".concat(n[3].tenantId)),hc("received ".concat(s.join(":"))),e.a(2);case 31:return e.n=32,Wc(n[3],i,a);case 32:if(e.v){e.n=33;break}return fc("received ".concat(s.join(":"),"; invalid root cert")),e.a(2);case 33:return pc(),hc("received ".concat(s.join(":"))),e.a(2);case 34:return hc("received ".concat(s.join(":"))),e.a(2);case 35:return hc("received ".concat(s.join(":"))),Zo.leads=n[3],e.a(2);case 36:if(d=n[3],!(m=ku(d))||!m.isPilotEnabled){e.n=38;break}return hc("".concat(s.join(":")," for processor# ").concat(d)),e.n=37,m.resp2StreamReq(n[0]);case 37:e.v;case 38:return e.a(2);case 39:if(p=n[3]){e.n=40;break}return fc("".concat(s.join(":")," invalid processor id")),e.a(2);case 40:return Bu(p),hc("".concat(s.join(":")," with processor id: ").concat(p," answered.")),e.a(2);case 41:if(g=n[3]){e.n=42;break}return fc("".concat(s.join(":")," invalid processor id")),e.a(2);case 42:if(hc("".concat(s.join(":")," with processor id: ").concat(g," received.")),!(v=ku(g))){e.n=44;break}return e.n=43,yu(v,!0);case 43:gc({from:n[1],to:n[0],label:"tenant:data:processor:delete:<processor_id>:received",data:n[3]});case 44:return e.a(2);case 45:if(!(b=n[3])||!b.uid){e.n=49;break}if(hc("received ".concat(s.join(":")," with offer# ").concat(b.id," from runtime# ").concat(n[0])),w=lu(n[0])){e.n=46;break}return fc("".concat(s.join(":")," discarded. invalid session# ").concat(n[0])),e.a(2);case 46:if(!ku(b.processorId)){e.n=47;break}return e.a(2);case 47:return(y=Gu("live-preview-".concat(w.sessionId.split("-")[0]))).peerChannelCallback=function(){var e=fo(uo().m(function e(t){var r,a;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,r=Au().filter(function(e){return e.dat.sessionId==Yo&&(e.isLocalScreenStream||e.isLocalVideoStream)}).map(function(e){return e._screenshot&&(e.dat.screenshot=e._screenshot),e.dat}),r&&bc({from:n[1],to:n[0],label:"tenant:data:processors:content:<processors>",data:{list:r}}),e.n=2;break;case 1:return e.p=1,a=e.v,fc("resp2RemoteStream > streamInitCallback > err: ".concat(a)),e.n=2,yu(y);case 2:return e.a(2)}},e,null,[[0,1]])}));return function(t){return e.apply(this,arguments)}}(),e.n=48,y.resp2RemoteStream(b);case 48:return e.a(2);case 49:if(!(k=n[3])||!k.uid){e.n=50;break}return hc("received ".concat(s.join(":")," with offer# ").concat(k.uid," from runtime# ").concat(n[0])),e.a(3,58);case 50:return e.a(2);case 51:return(_=n[3])&&(ou({list:[_]}),A=Au().filter(function(e){return e.Id()==_.id&&0==e.dat.name.indexOf("guest")}),1==A.length&&(A[0].dat=_),hc("".concat(s.join(":")," by runtime# ").concat(n[0]))),e.a(2);case 52:if(!n[3]||!n[3].id){e.n=53;break}return e.a(2);case 53:return fc("".concat(s.join(":")," failed in decoding")),e.a(2);case 54:return S=n[3],uu(S),e.n=55,hu();case 55:return hc("".concat(s.join(":")," by runtime# ").concat(n[0]),S),e.a(3,58);case 56:return Zo.channels=n[3],hc("".concat(s.join(":")," by runtime# ").concat(n[0]),Zo.channels),e.a(3,58);case 57:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 58:return e.a(3,60);case 59:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 60:return e.a(3,111);case 61:U=s[1],e.n="data"===U?62:66;break;case 62:n[3],j=s.slice(2).join(":"),e.n="contact:content:<contact>"===j||"contact:content:<contact>:received"===j||"message:content:<tenant_message>:received"===j||"message:content:<tenant_message>:confirmed"===j?63:64;break;case 63:return e.a(3,65);case 64:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 65:return e.a(3,67);case 66:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 67:return e.a(3,111);case 68:D=s[1],e.n="authenticated"===D?69:"profile"===D?70:"fs"===D?73:"file"===D?77:"intd"===D?78:"init"===D?80:"bootstrapped"===D?81:"bootstrap"===D?82:"logout"===D?83:"conn"===D?87:"dchn"===D?91:"system"===D?95:"peer"===D?104:"content"===D?107:108;break;case 69:return hc("".concat(s.join(":")," tenant authenticated.")),e.a(3,109);case 70:s[2],e.n=71;break;case 71:return hc("".concat(s.join(":")," by local")),e.a(2);case 72:return e.a(3,109);case 73:R=s[2],e.n="bootstrapped"===R?74:75;break;case 74:return e.a(3,76);case 75:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 76:return e.a(3,109);case 77:return C=new CustomEvent("browser-file-saved",{detail:s.join(":")}),document.dispatchEvent(C),e.a(3,109);case 78:return e.n=79,tu("/inori");case 79:return hc("compute vm initialised."),e.a(3,109);case 80:return hc("compute vm initialising in process."),e.a(3,109);case 81:return hc("compute vm bootstrapped. _this.env.in_session: ".concat(Qo)),e.a(3,109);case 82:return hc("compute vm bootstrap in process."),e.a(3,109);case 83:V=s[2],e.n="done"===V||"timeout"===V?84:85;break;case 84:return hc("".concat(s.join(":")," by local")),e.a(3,86);case 85:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 86:return e.a(3,109);case 87:H=s[2],e.n="timeout"===H||"ice_gather"===H||"ice_gather_completed"===H?88:89;break;case 88:return hc("".concat(s.join(":")," by local")),e.a(3,90);case 89:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 90:return e.a(3,109);case 91:T=s[2],e.n="close"===T||"failed"===T||"error"===T||"closg"===T||"disconnected"===T||"open"===T?92:93;break;case 92:return hc("".concat(s.join(":")," by local")),e.a(3,94);case 93:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 94:return e.a(3,109);case 95:$=s.slice(2).join(":"),e.n="protobuf:<enum>"===$?96:"event:<string>"===$?97:"closed"===$?98:"open"===$?100:102;break;case 96:return hc("".concat(s.join(":"),":"),n[3]),Wo=n[3],e.a(3,103);case 97:return lc(n[3]),e.a(3,103);case 98:return Qo=!1,e.n=99,pc();case 99:return e.a(3,103);case 100:return e.n=101,vc();case 101:return e.a(3,103);case 102:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 103:return e.a(3,109);case 104:K=s[2],e.n="send"===K?105:"rcvd"===K?106:107;break;case 105:return(x=Zo.tenant.subscriptions[i])&&x.peerChannel&&"open"==x.peerChannel.readyState&&x.peerChannel.send(n[3]),e.a(2);case 106:return(B=Zo.tenant.subscriptions[a])&&B.peerChannel&&B.peerChannel.onmessage&&B.peerChannel.onmessage({data:{from:a,to:i,label:t.data.label_2_forward,data:n[3]},type:"message",target:B.peerChannel}),e.a(2);case 107:return Zo.content=n[3],hc("".concat(s.join(":"),":"),n[3]),e.a(2);case 108:return hc("".concat(s.join(":"),":"),"unprocessed"),e.a(2);case 109:return e.a(3,111);case 110:return hc("".concat(s.join(":")," unprocessed")),e.a(2);case 111:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),tl=function(){var e=fo(uo().m(function e(){return uo().w(function(e){for(;;)switch(e.n){case 0:e.n=1;break;case 1:return e.n=2,Co("workers/inori.js");case 2:return e.a(2,new Promise(function(){var e=fo(uo().m(function e(t,r){return uo().w(function(e){for(;;)switch(e.n){case 0:Module.onRuntimeInitialized=fo(uo().m(function e(){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:(qo=new Worker("workers/mq-worker.".concat("min.","js"))).onmessage=el,r={env:{channels:function(){return Zo.channels.list},scenes:{earth:!1,nav:!1,room:!1},sceneStats:{objects:[],isStreetView:!0},content:Xu,bridge_id:function(){return Jo},bridge_sbj:function(){return!!zo&&Rc(zo)},in_session:function(){return Qo},name:bo},mq:{set_message_info:mu,msg_ts:function(e){return ec.get(e)||[]},msg_infos:function(){return Zo.message_infos.list.sort(function(e,t){return e.label.localeCompare(t.label)})},sys_dbg:function(e){hc(e)},event:Xo,worker:function(){return qo}},tenant:{kill_channel:function(e){return gc({label:"admin:data:service:status:<setting>",data:{isLive:!1,metadataExt2:e}}),new Promise(function(t){var r=!1;window.addEventListener("admin:data:service:status:<setting>:confirmed",function(){var n=fo(uo().m(function n(a){var i;return uo().w(function(n){for(;;)switch(n.n){case 0:a.detail.content.metadataExt2==e?(t(!0),r=!0):(i=new CustomEvent(a.type,{detail:a.detail,bubbles:a.bubbles,cancelable:a.cancelable,composed:a.composed}),window.dispatchEvent(i));case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){r||t(!1)})})},get_file_type_values:function(){return Wo.FileType.values},get_file_chunks:function(){return Zo.file_chunks},get_mini_files:function(){return Zo.mini_files},get_video_file:function(e,t,r,n,a){Zo.file_chunks[r]={fileId:r},bc({from:Yo,to:e,label:"tenant:video:chunk:process:req:<file_desc>",data:{path:t,metadata:r,type:n,contentType:a}})},get_remote_file:function(e,t,r,n,a){Zo.file_chunks[r]={fileId:r},bc({from:Yo,to:e,label:"tenant:data:chunk:content:req:<file_desc>",data:{path:t,metadata:r,type:n,contentType:a,isLive:!1}})},stop_remote_file:function(e,t,r){bc({from:Yo,to:e,label:"service:drive:file:chunk:del:<file_chunks>",data:{metadata:t,metadataExt1:r}})},upd_remote_file_list:function(e,t,r){bc({from:Yo,to:e,label:"service:drive:content:dir:req:<file_desc>",data:{path:t}}),Zo.directory_list={remoteId:e,root:t,files:[]},window.addEventListener("service:drive:content:dir:<file_descs>",function(e){if(e.detail.content&&e.detail.content.list){var t=Zo.directory_list,n=e.detail.content.list;n=n.filter(function(e){return!t.files.some(function(t){return"".concat(e.path,"/").concat(e.name)==="".concat(t.path,"/").concat(t.name)})}),t.files=[].concat(mo(t.files),mo(n)),r&&r(t)}})},req_drive_backup:function(e,t,r,n,a){bc({from:Yo,to:e,label:"service:drive:backup:req:<file_desc>",data:{name:t,path:r,metadata:n,metadata1:a}})},api_keys:function(){return Zo.tenant.apiKeys},session_info:function(){return Zo.tenants.list.find(function(e){return e.sessionId.toLowerCase()==Yo.toLowerCase()})},subject:function(){return Zo.tenant.subject},disable_license:function(e){gc({label:"admin:data:license:expire:<serial_number>",data:e})},renew_license:function(e){gc({label:"admin:data:license:renew:<serial_number>",data:e})},get_subjects:Ec,get_subject_upd_reqs:function(e){return Zo.subject_reqs[e]||[]},del_subject_upd_req:function(e,t){var r=Zo.subject_reqs[e]&&Zo.subject_reqs[e].filter(function(e){return e.metadata!=t});Zo.subject_reqs[e]=r},cred:function(){return Zo.tenant.cred},get_geo_locations:function(){return Zo.geo_locations.list},get_subscription:function(e){if(!e)return!1;var t,r=ru().find(function(t){return t.sessionId==e});if(t=r?Object.values(Zo.tenant.subscriptions).find(function(e){return e.sessionId==r.sessionId}):Zo.tenant.subscriptions[e]){if(t.sessionId!=r.sessionId&&(t.unsubscribe(),t.sessionId=r.sessionId),r.sessionId.toLowerCase()==Yo.toLowerCase())return hc("local subscription# ".concat(t.Id()," available")),t;var n;if("connected"==(null===(n=t.conn)||void 0===n?void 0:n.connectionState))return t;hc("remote subscription# ".concat(t.Id()," not connected"))}},del_subscription:function(e){var t=Zo.tenant.subscriptions[e];t&&(t.dispose(),delete Zo.tenant.subscriptions[e])},add_subscription:function(e){Zo.tenant.subscriptions[e.Id()]=e},get_command_values:function(){return Wo.Command.values},add_processor:Gu,del_processor:yu,get_processor:ku,get_remote_processors:Su,get_remote_processors_in_groups:Cu,get_remote_processor:xu,del_remote_processor:Eu,get_processors:Au,get_processors_by_session_id:_u,set_file:function(e,t){Zo.tenant.file_map[e]=t},has_local_stream_processor:function(){return Au().filter(function(e){return e.dat.sessionId==Yo&&(e.isLocalScreenStream||e.isLocalVideoStream||e.localFileStream)}).length>0},add_notification:bu,notifications:function(){var e=Zo.tenant.notifications.filter(function(e){return"local:system:event:<string>"!=e.msg}).sort(function(e,t){return t.last_update-e.last_update});return e},logs:function(){var e=Zo.tenant.notifications.filter(function(e){return"local:system:event:<string>"==e.msg}).sort(function(e,t){return t.last_update-e.last_update});return e},dataset:function(){return Zo},dataType:function(){return Wo},session_id:function(){return Yo},bridge_id:function(){return Jo},clog:lc,exit_session:function(){var e=fo(uo().m(function e(t){var r,n,a;return uo().w(function(e){for(;;)switch(e.n){case 0:for(Zo.tenant.processors.forEach(function(e){e&&(e.stop_mediaStream(),e.deinit(),e=null)}),Zo.tenant.processors=[],r=0,n=Object.entries(Zo.tenant.subscriptions);r<n.length;r++)(a=co(n[r],2))[0],a[1].dispose();return Zo.tenant.subscriptions={},e.n=1,wu();case 1:FS.unmount("/inori"),FS.rmdir("/inori");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),answer_offer:zu,checkout_offer:function(e){var t=Object.values(Zo.tenant.ice_offers).filter(function(t){return t.uid.toLowerCase()==e.dat.remoteId.toLowerCase()}).sort(function(e,t){return t.lastUpdate>e.dat.lastUpdate});if(t.length>0)return t[0]},standby_screen_sharing:fu,standby_video_sharing:du,resume_offer:function(e){var t=Object.values(Zo.tenant.ice_offers).filter(function(t){return t.aid&&t.aid.toLowerCase()==e.dat.remoteId.toLowerCase()}).sort(function(e,t){return t.lastUpdate>e.dat.lastUpdate});if(t.length>0)return t[0]},create_offer:Ju,update_offer:qu,create_contact:function(e){return e.LastName||(e.LastName=e.Email),gc({to:Jo,label:"guest:data:contact:content:<contact>",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:contact:content:<contact>:received",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:e(!0),t=!0;case 1:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),xo(15e3).then(function(){t||e(!1)})})},get_bridge_offers:function(){return!!(Zo.ice_offers&&Zo.ice_offers.list&&Zo.ice_offers.list.length>0)&&Zo.ice_offers},get_active_tenants_owned_by_current_session:function(){return ru().filter(function(e){return e.id.toLowerCase()==Zo.tenant.subject.serialnumber.val.toLowerCase()})},get_active_tenants:ru,get_active_services:nu,get_tenant_role_by_session_id:iu,get_vendors:au,get_tkn:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Yc();case 1:return r=e.v,e.a(2,btoa("".concat(Yo,":").concat(r)))}},e)}));return function(t){return e.apply(this,arguments)}}(),get_shadow_tkn:function(e){gc({to:e,label:"tenant:tcp:forward:req:<token>",data:""})},upd_x509_sbj:function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,dc(t);case 1:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}()},util:{get_app_metrics:function(e){gc({to:e,label:"admin:system:profile:metric:<keys>",data:{keys:["/app/profile:10:10","/app/process:5","/cpu/classes/gc/mark/assist:cpu-seconds"]}})},get_sys_profile:function(){},fileExists:Iu,syncFiles:Ou,normalizePath:$o,findKeyByValue:To,formatUnix2Detail:Ro,formatUnix2Date:Vo,validateCurrentTime:Ho,dbg:hc,exp:fc,sql:{get_leads:function(){return Zo.leads.list.length<1&&gc({label:"tenant:sql:query:<sql>",data:{table:"leads",type:Wo.SqlType.values.SELECT,limit:100}}),Zo.leads}},verify_msg:function(e){return e.id=Yo,e.lastUpdate=(new Date).getTime(),gc({to:Jo,label:"guest:data:message:content:<tenant_message>",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:message:content:<tenant_message>:received",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:e(n.detail.content),t=!0;case 1:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){t||e(!1)})})},validt_num:function(e){return e.id=Yo,e.messageType=Wo.MessageType.values.IVR,e.lastUpdate=(new Date).getTime(),gc({to:Jo,label:"guest:data:message:content:<tenant_message>:confirm",data:e}),new Promise(function(e){var t=!1;window.addEventListener("guest:data:message:content:<tenant_message>:confirmed",function(){var r=fo(uo().m(function r(n){return uo().w(function(r){for(;;)switch(r.n){case 0:e(!0),t=!0;case 1:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}(),{once:!0}),xo(5e3).then(function(){t||e(!1)})})},del_trainer_file:function(){var e=fo(uo().m(function e(t){return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Nu("/inori/model/json/".concat(t));case 1:return e.n=2,Nu("/inori/model/weight/".concat(t));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),get_trainer_models:Qu,get_prediction_size:jo,set_prediction:function(){var e=fo(uo().m(function e(t,r,n,a){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!a){e.n=1;break}bc({from:Yo,to:null==r?void 0:r.sessionId,label:"tenant:data:prediction:setup:<prediction>",data:n}),e.n=2;break;case 1:return e.n=2,t.configTrainer(n);case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),train_prediction:function(){var e=fo(uo().m(function e(t,r,n,a){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!a){e.n=1;break}bc({from:Yo,to:null==r?void 0:r.sessionId,label:"tenant:data:prediction:train:<prediction>",data:n}),e.n=2;break;case 1:return e.n=2,t.procTrainer();case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),unset_prediction:function(){var e=fo(uo().m(function e(t,r,n,a){return uo().w(function(e){for(;;)switch(e.n){case 0:if(!a){e.n=1;break}bc({from:Yo,to:null==r?void 0:r.sessionId,label:"tenant:data:prediction:unset:<prediction>",data:n}),e.n=2;break;case 1:return e.n=2,t.disableTrainer(n);case 2:return e.a(2)}},e)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),capture_frame:function(e,t){var r=Bo(150,t),n=xu(null==e?void 0:e.Id());n&&(n.screenshot=r,hc("video frame captured"))},capture_frame_area:function(e,t){return Eo(t,e)},delayFunction:xo,model:function(){return _model},calculateElapsedMinutes:Io,init_comm:function(){var e=fo(uo().m(function e(){var t=arguments;return uo().w(function(e){for(;;)switch(e.n){case 0:if(!(t.length>0&&void 0!==t[0]&&t[0])){e.n=2;break}return e.n=1,mc();case 1:if(e.v){e.n=2;break}return e.a(2,!1);case 2:return e.n=3,pc();case 3:return e.a(2,e.v)}},e)}));return function(){return e.apply(this,arguments)}}(),dir:{info:function(){return Zo.tenant.file_info_map},load:Bc},clog:lc,download_cert:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pc(Zo.tenant.file_info_map.dir[t]);case 1:return r=e.v,e.a(2,r.asFile())}},e)}));return function(t){return e.apply(this,arguments)}}(),download_pkey:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Nc(Zo.tenant.file_info_map.dir[t]);case 1:return r=e.v,e.a(2,r.asFile())}},e)}));return function(t){return e.apply(this,arguments)}}(),bootstrap_bridge_keypairs:eu,get_sbj_by_key:function(){var e=fo(uo().m(function e(t){var r;return uo().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pc(Zo.tenant.file_info_map.dir[t]);case 1:if(!(r=e.v)){e.n=2;break}return e.a(2,Rc(r.asCert()));case 2:return e.a(2,!1)}},e)}));return function(t){return e.apply(this,arguments)}}(),replace_keypair:function(){var e=fo(uo().m(function e(){var t,r,n;return uo().w(function(e){for(;;)switch(e.n){case 0:return t=Zo.tenant.file_info_map.dir,e.n=1,Pu(t.tmp_pkey,t.pkey);case 1:return r=e.v,e.n=2,Pu(t.tmp_cert,t.cert);case 2:if(n=e.v,!r||!n){e.n=3;break}return e.a(2,!0);case 3:return e.a(2,!1)}},e)}));return function(){return e.apply(this,arguments)}}(),convert_path_2_Id:Ko,read_image_obj:Du,write_file:function(e,t,r){return new Promise(function(){var e=fo(uo().m(function e(n,a){var i,s;return uo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Fu(t,r);case 1:if(!(i=Du(r))){e.n=2;break}n(i),e.n=3;break;case 2:throw new Error("read_image_obj err");case 3:e.n=5;break;case 4:e.p=4,s=e.v,a(s);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(t,r){return e.apply(this,arguments)}}())},write_blob_2_file:$u,write_arrbuf_2_file:Ku,read_blob_2_str:Tu,parse_pvtkey_str:Fc,parse_pubkey_str:Mc,parse_cert_str:Kc,clear_comm:function(){return Promise.resolve(!0)},exit_session:function(e){return new Promise(function(){var t=fo(uo().m(function t(r){var n;return uo().w(function(t){for(;;)switch(t.n){case 0:return n=!1,t.n=1,e.tenant.exit_session(e);case 1:window.addEventListener("admin:system:event:tenant_exit:received",function(t){e.env.in_session=!1,r(t.detail),n=!0},{once:!0}),xo(5e3).then(function(){n||(fc("exit_session time out"),r(!1))}),e.util.clear_comm().then(function(e){gc({label:"admin:system:event:tenant_exit",data:"placeholder"})});case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())},get_jwt_cred:function(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)},bootstrap_fs:tu,theme_event_registry:_o}},t(r);case 1:return e.a(2)}},e)}));case 1:return e.a(2)}},e)}));return function(t,r){return e.apply(this,arguments)}}()))}},e)}));return function(){return e.apply(this,arguments)}}();function rl(e){return rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rl(e)}function nl(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function al(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(r,n,a,i){var c=n&&n.prototype instanceof o?n:o,u=Object.create(c.prototype);return il(u,"_invoke",function(r,n,a){var i,o,c,u=0,l=a||[],h=!1,f={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return i=t,o=0,c=e,f.n=r,s}};function d(r,n){for(o=r,c=n,t=0;!h&&u&&!a&&t<l.length;t++){var a,i=l[t],d=f.p,m=i[2];r>3?(a=m===n)&&(c=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=d&&((a=r<2&&d<i[1])?(o=0,f.v=n,f.n=i[1]):d<m&&(a=r<3||i[0]>n||n>m)&&(i[4]=r,i[5]=n,f.n=m,o=0))}if(a||r>1)return s;throw h=!0,n}return function(a,l,m){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&d(l,m),o=l,c=m;(t=o<2?e:c)||!h;){i||(o?o<3?(o>1&&(f.n=-1),d(o,c)):f.n=c:f.v=c);try{if(u=2,i){if(o||(a="next"),t=i[a]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=e}else if((t=(h=f.n<0)?c:r.call(n,f))!==s)break}catch(t){i=e,o=1,c=t}finally{u=1}}return{value:t,done:h}}}(r,a,i),!0),u}var s={};function o(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(il(t={},n,function(){return this}),t),h=u.prototype=o.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,il(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,il(h,"constructor",u),il(u,"constructor",c),c.displayName="GeneratorFunction",il(u,a,"GeneratorFunction"),il(h),il(h,a,"Generator"),il(h,n,function(){return this}),il(h,"toString",function(){return"[object Generator]"}),(al=function(){return{w:i,m:f}})()}function il(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}il=function(e,t,r,n){function i(t,r){il(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},il(e,t,r,n)}function sl(e,t,r,n,a,i,s){try{var o=e[i](s),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function ol(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function s(e){sl(i,n,a,s,o,"next",e)}function o(e){sl(i,n,a,s,o,"throw",e)}s(void 0)})}}function cl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ul(n.key),n)}}function ul(e){var t=function(e){if("object"!=rl(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=rl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==rl(t)?t:t+""}function ll(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ll=function(){return!!e})()}function hl(e){return hl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hl(e)}function fl(e,t){return fl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fl(e,t)}var dl=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,r){return t=hl(t),function(e,t){if(t&&("object"==rl(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ll()?Reflect.construct(t,r||[],hl(e).constructor):t.apply(e,r))}(this,t)).index=-1,e.content=null,e.inori=null,e.loadInori(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fl(e,t)}(t,e),function(e,t,r){return t&&cl(e.prototype,t),r&&cl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"createRenderRoot",value:function(){return this}},{key:"firstUpdated",value:(a=ol(al().m(function e(){return al().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return a.apply(this,arguments)})},{key:"updated",value:function(e){}},{key:"_loggedInHandler",value:(n=ol(al().m(function e(){return al().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)})),function(){return n.apply(this,arguments)})},{key:"handleScrolling",value:function(e){document.getElementById(e).scrollIntoView({behavior:"smooth"})}},{key:"loadInori",value:(r=ol(al().m(function e(){var t,r=this;return al().w(function(e){for(;;)switch(e.n){case 0:return t=this,window.addEventListener("local:intd",function(){var e=ol(al().m(function e(n){return al().w(function(e){for(;;)switch(e.n){case 0:if(!t.inori){e.n=4;break}return t.inori.mq.sys_dbg("inori initialised"),t.content=t.inori.env.content,e.n=1,t.inori.util.init_comm(!1);case 1:if(!e.v){e.n=3;break}return e.n=2,t.inori.util.dir.load();case 2:t.inori.mq.sys_dbg("credential established");case 3:r.requestUpdate();case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),{once:!0}),e.n=1,tl();case 1:t.inori=e.v;case 2:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"render",value:function(){var e=this;if(!this.content||this.index<0)return z(rc||(rc=nl([""])));var t=this.content.get(this.index),r=this.content.getAllL1(this.index),n=this.content.getAllL2(this.index),a=this.content.getAllL3(this.index);return t&&r&&n&&a?z(ac||(ac=nl(['\n<main class="col-lg-12 py-md-4 px-md-4">\n<h1 class="fw-lighter text-center mb-5">','</h1>\n  <div class="row">\n     <div class="col mb-4">\n       <ul>\n       ','\n       </ul>\n    </div>    \n    <div class="col mb-4"> \n      <p class="fs-6 fw-lighter">\n        ','\n      </p>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col mb-4"> \n\n  ',"\n    </div>\n  </div>\n</main>"])),t,r.map(function(t){return z(ic||(ic=nl(['\n        <li role="button" @click="','">',"</li>"])),function(t){e.handleScrolling("h4-aot")},t)}),a,r.map(function(e,t){return z(sc||(sc=nl(['\n      <h4 id="h4-aot" class="fw-lighter">','</h4>\n      <p class="mb-5">',"</p>\n      ",""])),e,n[t],n[t].length>1?z(oc||(oc=nl(['\n      <ul class="mb-5">\n      ',"\n      </ul>\n"])),n[t].map(function(e){return z(cc||(cc=nl(["\n        <li>","</li>\n        "])),e)})):z(uc||(uc=nl([""]))))})):z(nc||(nc=nl([""])))}}],[{key:"properties",get:function(){return{index:{type:Number}}}}]);var r,n,a}(le);customElements.define("corp-article",dl)})();