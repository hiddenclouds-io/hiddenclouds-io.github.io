/*! For license information please see mq-worker.min.js.LICENSE.txt */
(()=>{function e(){var n,r,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",c=a.toStringTag||"@@toStringTag";function s(e,a,o,c){var s=a&&a.prototype instanceof l?a:l,u=Object.create(s.prototype);return t(u,"_invoke",function(e,t,a){var o,c,s,l=0,u=a||[],f=!1,d={p:0,n:0,v:n,a:b,f:b.bind(n,4),d:function(e,t){return o=e,c=0,s=n,d.n=t,i}};function b(e,t){for(c=e,s=t,r=0;!f&&l&&!a&&r<u.length;r++){var a,o=u[r],b=d.p,p=o[2];e>3?(a=p===t)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=n):o[0]<=b&&((a=e<2&&b<o[1])?(c=0,d.v=t,d.n=o[1]):b<p&&(a=e<3||o[0]>t||t>p)&&(o[4]=e,o[5]=t,d.n=p,c=0))}if(a||e>1)return i;throw f=!0,t}return function(a,u,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&b(u,p),c=u,s=p;(r=c<2?n:s)||!f;){o||(c?c<3?(c>1&&(d.n=-1),b(c,s)):d.n=s:d.v=s);try{if(l=2,o){if(c||(a="next"),r=o[a]){if(!(r=r.call(o,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,c<2&&(c=0)}else 1===c&&(r=o.return)&&r.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);o=n}else if((r=(f=d.n<0)?s:e.call(t,d))!==i)break}catch(e){o=n,c=1,s=e}finally{l=1}}return{value:r,done:f}}}(e,o,c),!0),u}var i={};function l(){}function u(){}function f(){}r=Object.getPrototypeOf;var d=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),b=f.prototype=l.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e}return u.prototype=f,t(b,"constructor",f),t(f,"constructor",u),u.displayName="GeneratorFunction",t(f,c,"GeneratorFunction"),t(b),t(b,c,"Generator"),t(b,o,function(){return this}),t(b,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m:p}})()}function t(e,n,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,a){function c(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},t(e,n,r,a)}function n(e,t,n,r,a,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var c=e.apply(t,r);function s(e){n(c,a,o,s,i,"next",e)}function i(e){n(c,a,o,s,i,"throw",e)}s(void 0)})}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var o;importScripts("./../pkg/protobufjs/dist/protobuf.min.js");var c="prod",s="https://api.hiddenclouds.io",i={list:[{label:"local:intd",type:"",code:1001,events:[{targetType:"window",targetKey:"",msgKey:"",msgType:""}]},{label:"local:content:<json>",type:"JSON",code:1002,events:[]},{label:"local:authenticate:<bytes>",type:"[]byte",code:1003,events:[]},{label:"local:register:<bytes>",type:"[]byte",code:1004,events:[]},{label:"local:init",type:"",code:1005,events:[{targetType:"window",targetKey:"",msgKey:"",msgType:""}]},{label:"admin:heartbeat",type:"",code:218,events:[]},{label:"local:system:protobuf:<enum>",type:"enum",code:188,events:[]},{label:"local:system:event:<string>",type:"string",code:186,events:[]},{label:"admin:data:tenant:content:<tenant>",type:"Tenant",code:225,events:[]},{label:"admin:data:tenant:content:received:<tenant>",type:"Tenant",code:226,events:[]},{label:"admin:data:message_infos:content:<message_infos>",type:"MessageInfos",code:252,events:[]},{label:"tenant:data:tenants:content:<active_tenants>",type:"ActiveTenants",code:238,events:[]},{label:"tenant:data:processors:content:<processors>",type:"Processors",code:243,events:[]},{label:"tenant:data:chunk:root_cert:<bytes>",type:"[]byte",code:189,events:[]},{label:"tenant:data:chunk:pub_key:<bytes>",type:"[]byte",code:191,events:[]},{label:"tenant:data:chunk:pub_key:signed:<bytes>",type:"[]byte",code:190,events:[]},{label:"admin:data:ice_servces:content:<ice_services>",type:"IceServices",code:241,events:[]}]},l={},u=function(e){return new Promise(function(t){return setTimeout(t,e)})},f=function(e){o&&1==o.readyState?o.send(e):(p("connection not avaialble; re-connecting.."),u(3e3).then(function(){O()}))},d=function(e){self.postMessage({label:"local:system:event:<string>",data:e})},b=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];d(["debug:"].concat(t))},p=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];d(["exception:"].concat(t))},y=function(e){self.postMessage({from:e.from,to:e.to,label:e.label,label_2_forward:e.label_2_forward,data:e.data})},v=function(e){for(var t=e.toLowerCase().replace(/-/g,""),n=new Uint8Array(16),r=0;r<16;r++)n[r]=parseInt(t.substr(2*r,2),16);return n},g=function(e){var t=Array.from(e,function(e){return e.toString(16).padStart(2,"0")}).join("");return"".concat(t.substr(0,8),"-").concat(t.substr(8,4),"-").concat(t.substr(12,4),"-").concat(t.substr(16,4),"-").concat(t.substr(20)).toLowerCase()},m=function(){return i&&i.list&&i.list.length>0?i.list.filter(function(e){return e}):[]},h=function(e){var t,n=m().filter(function(e){return e.code>255});n.push.apply(n,function(e){if(Array.isArray(e))return a(e)}(t=e.list)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i.list=n},_=function(e){var t,n;t=e.code,n=m().filter(function(e){return e.code!=t}),i.list=n,i.list.push(e)},w=function(e){var t=m().filter(function(t){return t.label==e});return 1==t.length?t[0]:null},T=function(e){if(e.constructor===Object)return b(c,"_get_decoded_msg_buffer > ref (Object):",e),null;var t=new Uint8Array(e);if(!t)return null;var n,r,a=t.slice(33),o=(n=t[32],1==(r=m().filter(function(e){return e.code==n})).length?r[0]:null);if(!o)return null;if(l[o.type]){var s=l[o.type].decode(a);return[g(t.slice(0,16)),g(t.slice(16,32)),o.label,s]}switch(o.type){case"string":a=new TextDecoder("utf-8").decode(new Uint8Array(a));break;case"[]byte":o.label.includes("<processor_id>")&&(a=g(a));break;default:a=null}return[g(t.slice(0,16)),g(t.slice(16,32)),o.label,a]},j=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3?arguments[3]:void 0,o=function(e,t,n,r){var a=new Uint8Array(v(e)),o=new Uint8Array(v(t)),c=new Uint8Array(r),s=new Uint8Array(a.length+o.length+c.length+1);return s.set(a,0),s.set(o,a.length),s.set([n],a.length+o.length),s.set(c,a.length+o.length+1),s.buffer},s=new TextEncoder,i=w(r);switch(i.type){case"string":return o(e,t,255&i.code,s.encode(a).buffer);case"[]byte":return o(e,t,255&i.code,a);case"":return o(e,t,255&i.code);default:n=S(i.type,a)}return n?o(e,t,255&i.code,n):(p(c,"".concat(r," invalid")),null)},S=function(e,t){var n=l[e].verify(t);if(n)return p(c,["_get_buffer > errMsg: ".concat(n)]),null;var r=l[e].create(t);return l[e].encode(r).finish()},k=function(e){return new Promise(function(t,n){switch(e.constructor){case Object:if(e.label)switch(e.label){case"local:peer:send":var r=j(e.from,e.to,e.label_2_forward,e.data);return r?(y({from:e.from,to:e.to,label:e.label,label_2_forward:e.label_2_forward,data:r}),t(!1)):(p("_msg_spec_val > Object > _get_encoded_msg_buffer failed"),t(!1));case"local:peer:rcvd":var a=T(e.data);return a?(y({from:a[0],to:a[1],label:e.label,label_2_forward:a[2],data:a[3]}),t(!1)):(p("_msg_spec_val > Object > _get_decoded_msg_buffer failed"),t(!1));case"local:bridge:send":return e.label_2_forward&&f(j(e.from,e.to,e.label_2_forward,e.data)),t(!1);case"local:system:event:<string>":return d(e.data),t(!1);default:var o=w(e.label);return t(!!o&&[e.from,e.to,o.label,e.data])}break;case Blob:return e.arrayBuffer().then(function(e){var r=T(e);return r?t([r[0],r[1],r[2],r[3]]):n("Blob > _get_decoded_msg_buffer failed")});case ArrayBuffer:var c=T(e);return c?t([c[0],c[1],c[2],c[3]]):n("ArrayBuffer > _get_decoded_msg_buffer failed");case String:return b(e),t(!1)}return n("_msg_spec_val failed; unhandled type: ".concat(e.constructor))})},A=function(){var t=r(e().m(function t(n){var r,a,o,c,s,i,l;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,k(n.data);case 1:r=e.v,e.n=3;break;case 2:return e.p=2,o=e.v,p("invalid event e:",o),e.a(2);case 3:if(r){e.n=4;break}return e.a(2);case 4:a=r[2].split(":"),c=a[0],e.n="admin"===c?5:"local"===c?10:14;break;case 5:s=a[1],e.n="data"===s?6:9;break;case 6:i=a.slice(2).join(":"),e.n="message_info:content:<message_info>:received"===i?7:"message_infos:content:<message_infos>"===i?8:9;break;case 7:return _(r[3]),e.a(3,9);case 8:return h(r[3]),r[3]={list:m()},e.a(3,9);case 9:return e.a(3,14);case 10:l=a.slice(1).join(":"),e.n="register:<bytes>"===l?11:"authenticate:<bytes>"===l?12:13;break;case 11:return b("".concat(a.join(":")," tenant registration.")),f(j(r[0],r[1],"tenant:data:chunk:pub_key:<bytes>",r[3])),e.a(2);case 12:return b("".concat(a.join(":")," authenticate tenant.")),f(j(r[0],r[1],"admin:data:tenant:content:<tenant>",r[3])),e.a(2);case 13:return e.a(3,14);case 14:y({from:r[0],to:r[1],label:r[2],data:r[3]});case 15:return e.a(2)}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}(),O=function(){WebSocket&&((o=new WebSocket("".concat(s.replace("https","wss"),"/v0/ws"))).addEventListener("close",function(e){b("conn closed. re-trying."),u(3e3).then(function(){y({label:"local:system:closed",data:""})})}),o.addEventListener("message",A),o.addEventListener("open",function(){var t=r(e().m(function t(n){return e().w(function(e){for(;;)switch(e.n){case 0:y({label:"local:system:open",data:""});case 1:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),o.addEventListener("error",function(e){p("conn err: ".concat(e))}))};protobuf.load(["./../content/collab.proto","./../content/product.proto"],function(){var t=r(e().m(function t(n,a){var o,u,f;return e().w(function(t){for(;;)switch(t.n){case 0:if(!n){t.n=1;break}return t.a(2,p(n));case 1:return["Leads","Lead","GeoLocation","IceService","IceServices","IceOffer","IceOffers","IceCandidate","IceCandidates","Tenant","Tenants","ActiveTenant","FileChunk","ActiveTenants","Processor","Processors","Action","Predictions","FileChunks","Drive","Prediction","TenantMessage","Contact","MessageInfo","GeoLocations","Device","Devices","MessageInfos","EventEmitter","Sql","Subject","Subjects","FileDesc","FileDescs","Setting","Scheduler","Schedulers","Transaction","Transactions","RTMPChannel","RTMPChannels","AppMetricsKeys"].forEach(function(e){l[e]=a.lookupType(e)}),o={},["Command","HardwareVendor","ProcessorStatus","Role","Plan","SqlType","MessageType","FileType","ConnectionType"].forEach(function(e){l[e]=a.lookupEnum(e),o[e]={values:l[e].values}}),O(),y({label:"admin:data:message_infos:content:<message_infos>",data:i}),u=function(){var t=r(e().m(function t(){var n;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(s,"/portal/").concat(c,".json"));case 1:return n=e.v,e.n=2,n.json();case 2:case 4:return e.a(2,e.v);case 3:return e.p=3,e.v,e.n=4,u()}},t,null,[[0,3]])}));return function(){return t.apply(this,arguments)}}(),t.n=2,u();case 2:f=t.v,y({label:"local:content:<json>",data:f}),y({label:"local:system:protobuf:<enum>",data:o}),y({label:"local:intd",data:""});case 3:return t.a(2)}},t)}));return function(e,n){return t.apply(this,arguments)}}()),self.onmessage=A,y({label:"local:init",data:""})})();