/*! For license information please see trainer.min.js.LICENSE.txt */
(()=>{function t(){var n,r,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.toStringTag||"@@toStringTag";function u(t,a,o,s){var u=a&&a.prototype instanceof c?a:c,f=Object.create(u.prototype);return e(f,"_invoke",function(t,e,a){var o,s,u,c=0,f=a||[],p=!1,l={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(t,e){return o=t,s=0,u=n,l.n=e,i}};function m(t,e){for(s=t,u=e,r=0;!p&&c&&!a&&r<f.length;r++){var a,o=f[r],m=l.p,d=o[2];t>3?(a=d===e)&&(u=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=n):o[0]<=m&&((a=t<2&&m<o[1])?(s=0,l.v=e,l.n=o[1]):m<d&&(a=t<3||o[0]>e||e>d)&&(o[4]=t,o[5]=e,l.n=d,s=0))}if(a||t>1)return i;throw p=!0,e}return function(a,f,d){if(c>1)throw TypeError("Generator is already running");for(p&&1===f&&m(f,d),s=f,u=d;(r=s<2?n:u)||!p;){o||(s?s<3?(s>1&&(l.n=-1),m(s,u)):l.n=u:l.v=u);try{if(c=2,o){if(s||(a="next"),r=o[a]){if(!(r=r.call(o,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,s<2&&(s=0)}else 1===s&&(r=o.return)&&r.call(o),s<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=n}else if((r=(p=l.n<0)?u:t.call(e,l))!==i)break}catch(t){o=n,s=1,u=t}finally{c=1}}return{value:r,done:p}}}(t,o,s),!0),f}var i={};function c(){}function f(){}function p(){}r=Object.getPrototypeOf;var l=[][o]?r(r([][o]())):(e(r={},o,function(){return this}),r),m=p.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,e(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t}return f.prototype=p,e(m,"constructor",p),e(p,"constructor",f),f.displayName="GeneratorFunction",e(p,s,"GeneratorFunction"),e(m),e(m,s,"Generator"),e(m,o,function(){return this}),e(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:u,m:d}})()}function e(t,n,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}e=function(t,n,r,a){function s(n,r){e(t,n,function(t){return this._invoke(n,r,t)})}n?o?o(t,n,{value:r,enumerable:!a,configurable:!a,writable:!a}):t[n]=r:(s("next",0),s("throw",1),s("return",2))},e(t,n,r,a)}function n(t,e,n,r,a,o,s){try{var u=t[o](s),i=u.value}catch(t){return void n(t)}u.done?e(i):Promise.resolve(i).then(r,a)}function r(t){return function(){var e=this,r=arguments;return new Promise(function(a,o){var s=t.apply(e,r);function u(t){n(s,a,o,u,i,"next",t)}function i(t){n(s,a,o,u,i,"throw",t)}u(void 0)})}}importScripts("https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js","https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgpu@4.11.0/dist/tf-backend-webgpu.min.js");var a,o,s,u,i,c=function(){var e=r(t().m(function e(n){return t().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,tf.setBackend("webgpu");case 1:o={id:n.data.id,summary:{status:"initialised"}},self.onmessage=f,self.postMessage({req:"initialised",conf:o});case 2:return t.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=r(t().m(function e(n){var r,a;return t().w(function(t){for(;;)switch(t.n){case 0:a=n.data.req,t.n="status"===a?1:"collect"===a?2:"pause"===a?6:"resume"===a?9:"train"===a?12:"config"===a?16:"dispose"===a?18:19;break;case 1:return t.a(3,20);case 2:if(!o.bound||!o.objective||"sampling"!=o.summary.status){t.n=4;break}return t.n=3,m(n.data.source,n.data.metric);case 3:t.n=5;break;case 4:return t.a(2);case 5:return t.a(3,20);case 6:if("sampling"!=o.summary.status){t.n=7;break}o.summary.status="paused",t.n=8;break;case 7:return t.a(2);case 8:return t.a(3,20);case 9:if("paused"!=o.summary.status){t.n=10;break}o.summary.status="sampling",t.n=11;break;case 10:return t.a(2);case 11:return t.a(3,20);case 12:if("paused"!=o.summary.status&&"sampling"!=o.summary.status){t.n=14;break}return t.n=13,d();case 13:t.n=15;break;case 14:return t.a(2);case 15:return t.a(3,20);case 16:return u=[],i=[],o.bound=n.data.bound,o.objective=n.data.objective,o.summary.num_collected=0,o.summary.status="sampling",t.n=17,p();case 17:return o.resp=t.v,t.a(3,20);case 18:return null===(r=tf)||void 0===r||r.dispose(),tf=null,t.a(3,20);case 19:return t.a(2);case 20:self.postMessage({req:n.data.req,conf:o});case 21:return t.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}();function p(){return l.apply(this,arguments)}function l(){return(l=r(t().m(function e(){return t().w(function(t){for(;;)switch(t.n){case 0:if(!a){t.n=1;break}return t.a(2,!0);case 1:return t.a(2,new Promise(function(t,e){tf.tidy(function(){var e=s.predict(tf.zeros([1,MOBILE_NET_INPUT_HEIGHT,MOBILE_NET_INPUT_WIDTH,3]));(a=tf.sequential()).add(tf.layers.dense({inputShape:[1024],units:128,activation:"relu"})),a.add(tf.layers.dense({units:4})),a.compile({optimizer:"adam",loss:"binaryCrossentropy",metrics:["accuracy"]}),t(e)})}))}},e)}))).apply(this,arguments)}var m=function(){var e=r(t().m(function e(n){var r,a,s;return t().w(function(t){for(;;)switch(t.n){case 0:r=tf.tidy(function(){return{t_image:y(n),t_target:tf.tensor1d(o.bound)}}),a=r.t_image,s=r.t_target,u.push(a),i.push(s),o.summary.num_collected=u.length;case 1:return t.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=r(t().m(function e(){var n,s,c,f,p,l,m;return t().w(function(e){for(;;)switch(e.n){case 0:return o.summary.status="training",n=u.splice(0),s=i.splice(0),c=tf.stack(n),f=tf.stack(s),e.n=1,a.fit(c,f,{shuffle:!0,batchSize:5,epochs:10,callbacks:{onEpochEnd:function(t,e){}}});case 1:return e.v,tf.dispose([n,s]),e.n=2,a.save(tf.io.withSaveHandler(function(){var e=r(t().m(function e(n){var r,a,o,s;return t().w(function(t){for(;;)if(0===t.n)return r=new Blob([JSON.stringify(n)],{type:"application/json"}),a=new Blob([n.weightData],{type:"application/octet-stream"}),o=URL.createObjectURL(r),s=URL.createObjectURL(a),t.a(2,{modelBlob:o,weightsBlob:s})},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:p=e.v,l=p.modelBlob,m=p.weightsBlob,o.summary.modelBlob=l,o.summary.weightsBlob=m,o.summary.status="completed";case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),y=function(t){return tf.tidy(function(){tf.browser.fromPixels(t);var e=resizedTensorFrame.div(255);return s.predict(e.expandDims()).squeeze()})};self.onmessage=c})();